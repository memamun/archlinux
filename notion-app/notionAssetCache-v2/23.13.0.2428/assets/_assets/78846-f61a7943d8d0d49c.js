"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[78846],{33218:(e,o,t)=>{t.d(o,{UQ:()=>m,gL:()=>y});t(16280),t(898992),t(672577),t(803949);var r=()=>t(651124),i=()=>t(792071),n=()=>t(688728),a=()=>t(369186),d=()=>t(475140),l=()=>t(235692),s=()=>t(778781),p=()=>t(696706),u=()=>t(896628),c=()=>t(317909);function m(e){let{environment:o,transaction:t,layoutStore:r,position:l,updatedModule:s,sessionId:p}=e;const u=n().Zm[l.area],m=r.getRawModules();if("form_conditional_modules"===u){const e=null==m?void 0:m[u];if(!(null==e?void 0:e[l.moduleId]))throw new Error("Unable to find module being updated.");return void c().createAndCommitOrAppend({environment:o,transaction:t,canUndo:!0,perform(e){c().applyOperation({transaction:e,store:r,operation:i().N4X.updateModuleInArea({pointer:r.pointer,area:u,module:(0,a().Lv)(s)})})},userAction:"BuilderLayoutModules.updateModule"})}if(!m)throw new Error("Unable to find modules");const f=(0,d().LC)(m,(e=>e.id===l.moduleId));if(!f||f.area!==u)throw new Error("Unable to find module being updated.");c().createAndCommitOrAppend({environment:o,transaction:t,canUndo:!0,perform(e){c().applyOperation({transaction:e,store:r,operation:i().N4X.updateModuleInArea({pointer:r.pointer,module:(0,a().Lv)(s),..."views_main_tab_modules"===f.area?{area:f.area,viewId:f.viewId}:{area:f.area}})})},userAction:"BuilderLayoutModules.updateModule"})}function f(e){var o,t,r;let{collectionStore:i,layoutStore:n}=e;const a=new Map,d=i.getFormat(),l=[...null===(o=n.getModules())||void 0===o?void 0:o.page_main,...null===(t=n.getModules())||void 0===t?void 0:t.page_details],p=new Map;null===(r=d.property_visibility)||void 0===r||r.forEach((e=>{p.set(e.property,e)})),l.forEach((e=>{if(!(0,s()._Q)(e))return(0,s().gx)(e)?(a.set(e.propertyId,{property:e.propertyId}),void p.set(e.propertyId,{property:e.propertyId,visibility:"show"})):void 0;e.propertyIds.forEach((e=>{a.set(e,{property:e}),p.set(e,{property:e,visibility:"show"})}))}));const u=i.getNormalizedPropertyGroups();var c;u?u.forEach((e=>{var o;null===(o=e.propertyIds)||void 0===o||o.forEach((e=>{a.has(e)||a.set(e,{property:e})}))})):null===(c=d.collection_page_properties)||void 0===c||c.forEach((e=>{a.has(e.property)||a.set(e.property,e)}));return{propertiesFormat:Array.from(a.values()),propertyVisibility:Array.from(p.values())}}function y(e){let{environment:o,transaction:t,collectionStore:n,layoutStore:a}=e;const{propertiesFormat:d,propertyVisibility:m}=f({collectionStore:n,layoutStore:a});c().createAndCommitOrAppend({environment:o,transaction:t,canUndo:!0,perform(e){const o=a.getBlockChildrenPointers(),t=a.getFormat(),f=a.firstModuleOfType("viewsMain");f&&(0,s().y6)(f)&&o.find((e=>p().L3.isEqual(e,f.collection_view_block_pointer)))&&c().applyOperation({transaction:e,store:a,operation:i().N4X.removeBlockChild(a.pointer,f.collection_view_block_pointer.id)});const y=null==t?void 0:t.previousViewsMainCollectionViewBlockPointer,_=y&&o.find((e=>p().L3.isEqual(e,y)));_&&c().applyOperation({transaction:e,store:a,operation:i().N4X.removeBlockChild(a.pointer,_.id)}),c().applyOperation({transaction:e,store:a,operation:i().N4X.setModulesByAreas(a.pointer,(0,l().K5)())}),c().applyOperation({transaction:e,store:a,operation:i().N4X.deleteFormat(a.pointer)});const v=n.getFormat(),{page_section_visibility:w}=v;u().zA({stores:[n],update:{property_groups:void 0,collection_page_properties:d,property_visibility:m,...w?{page_section_visibility:r().Zi}:void 0},transaction:e})},userAction:"BuilderLayoutModules.resetLayoutToDefault"})}},155185:(e,o,t)=>{t.d(o,{I:()=>a,_:()=>n});const r={normalizedTitleWithIcon:!0,properties:!0,property_number:!0,property_title:!0,property_person:!0,property_file:!0,property_text:!0,property_checkbox:!0,property_url:!0,property_email:!0,property_phone_number:!0,property_created_by:!0,property_last_edited_by:!0,property_button:!0,property_select:!0,property_multi_select:!0,property_status:!0,property_date:!0,property_created_time:!0,property_last_edited_time:!0,property_last_visited_time:!0,property_relation:!0,property_rollup:!0,property_formula:!0,property_auto_increment_id:!0,property_location:!0,property_verification:!0,property_geo_point:!0,views:!0,viewsMain:!0,relationsGroup:!0,formQuestion:!0,placeholder:!0,deleted_property:!1,cover:!1,inlinePageSections:!1,expandedBacklinks:!1,discussions:!1,bottomControls:!1,editor:!1,transcript:!1,formTitle:!1,formSubmit:!1},i={properties:!0,property:!0,relationsGroup:!0,formQuestion:!0,placeholder:!0,titleWithIcon:!0,cover:!1,inlinePageSections:!1,expandedBacklinks:!1,discussions:!1,bottomControls:!1,editor:!1,transcript:!1,formTitle:!1,formSubmit:!1,views:!0,viewsMain:!0,collectionView:!0,collectionViewV2:!0};function n(e){return r[e.type]}function a(e){return i[e.type]}},235692:(e,o,t)=>{t.d(o,{K5:()=>u,_u:()=>s,oP:()=>c,wC:()=>l,xN:()=>p});t(898992),t(354520),t(581454);var r=()=>t(183558),i=()=>t(155185),n=()=>t(778781),a=()=>t(369186);const d={page_main:[{id:"cover",type:"cover"},{id:"title_with_icon",type:"normalizedTitleWithIcon",propertyIds:[]},{id:"properties",type:"properties"},{id:"discussions",type:"discussions"},{id:"editor",type:"editor"}],page_details:[],form_layout_schema:[]},l={page_main:[{id:"title_with_icon",type:"normalizedTitleWithIcon",propertyIds:[]},{id:"editor",type:"editor"}],page_details:[],form_layout_schema:[]},s={page_main:[{id:"title_with_icon",type:"normalizedTitleWithIcon",propertyLabels:"hide",propertyIds:[]},{id:"editor",type:"editor"},{id:"discussions",type:"discussions"}],page_details:[],form_layout_schema:[]};function p(e){return(0,a().jr)({modulesByArea:d,collectionSchema:null==e?void 0:e.collectionSchema,collectionFormat:null==e?void 0:e.collectionFormat})}function u(){return{page_layout_schema:(0,a().ke)(d.page_main).map((e=>{if(!(0,n().cn)(e))return(0,i().I)(e)?{...e,id:(0,r().Ay)()}:e})).filter((e=>void 0!==e)),page_info_layout_schema:(0,a().ke)(d.page_details).map((e=>{if(!(0,n().cn)(e))return(0,i().I)(e)?{...e,id:(0,r().Ay)()}:e})).filter((e=>void 0!==e)),form_layout_schema:void 0}}function c(e,o){const t=void 0===o?[{id:(0,r().Ay)(),type:"formQuestion",formQuestionId:e}]:[{id:(0,r().Ay)(),type:"formQuestion",formQuestionId:e},{id:(0,r().Ay)(),type:"formQuestion",formQuestionId:o}];return{page_layout_schema:void 0,page_info_layout_schema:void 0,form_layout_schema:[{id:(0,r().Ay)(),type:"cover"},{id:(0,r().Ay)(),type:"formTitle"},...t,{id:(0,r().Ay)(),type:"formSubmit"}]}}},447934:(e,o,t)=>{t.d(o,{$L:()=>S,Fv:()=>E,HD:()=>U,V_:()=>T,bV:()=>x,jP:()=>C,nh:()=>P,w8:()=>k});t(16280),t(18107),t(967357),t(898992),t(354520);var r=()=>t(206267),i=()=>t(792071),n=()=>t(688728),a=()=>t(475140),d=()=>t(235692),l=()=>t(924329),s=()=>t(778781),p=()=>t(144081),u=()=>t(334261),c=()=>t(661920),m=()=>t(435009),f=()=>t(317909),y=()=>t(519839),_=()=>t(594794),v=()=>t(869562),w=()=>t(351360),I=()=>t(712505),b=()=>t(630116),A=()=>t(449476),h=()=>t(640868),g=()=>t(204521),M=()=>t(33218);function S(e){let{environment:o,transaction:t,collectionStore:r,userId:n,modules:a}=e;const l=(0,_().zP)({environment:o,spaceId:r.getSpaceId(),table:p().zx}),s=b().sk.createChildStore(r,l),{model:u,operations:[c]}=i().wfN.create({pointer:l,parent:r.pointer,createdByUserId:n,modules:a??(0,d().K5)()});f().applyOperation({transaction:t,store:s,operation:c});const m=i().BnK.setLayout(r.pointer,l);return f().applyOperation({transaction:t,store:r,operation:m}),{model:u,store:s}}function O(e){let o;return e?o=e:I().default.state.open&&I().default.state.targetStore?o=I().default.state.targetStore:w().default.state.mainEditorCurrentBlockStore&&(o=w().default.state.mainEditorCurrentBlockStore),o}function B(e){v().setUpdateExpand({environment:e,isExpanded:!1,from:"keyboard_default",saveDetailsSidebarPreference:!1}),c().VN({environment:e,from:"open_page_layout_editor",preventAnimation:!0})}function P(e){var o,t;let{environment:i,blockStore:n,collectionStore:a,collectionViewStore:d,from:l,initialSelectedModuleType:s}=e;const p=function(e){var o;let t=O(e);if(null!==(o=t)&&void 0!==o&&o.isCollectionView()){const e=(0,y().UH)(t);t=e?e.resultsInViewOrder(1).at(0):void 0}return t}(n),u=window.location.href;B(i);const c=r().JW();A().A.setState({isOpen:!0,mode:"layout-editor",collectionStore:a,pageStore:p,siteRootBlockStore:void 0,sessionId:c,initialSelectedModuleId:null==p||null===(o=p.getAssociatedCollectionStore())||void 0===o||null===(o=o.getLayoutStore())||void 0===o||null===(o=o.getModel())||void 0===o||null===(o=o.firstRawModuleOfType(s??"titleWithIcon"))||void 0===o?void 0:o.id,urlOnOpen:u}),(0,g().Ko)({environment:i,from:l,context:"layout",sessionId:c,collectionId:null==a?void 0:a.id,existingLayoutId:null==a||null===(t=a.getLayoutStore())||void 0===t?void 0:t.id,collectionViewId:null==d?void 0:d.id})}function C(e){let{environment:o,store:t,siteRootBlockStore:i,from:n}=e;const a=O(t);B(o);const d=r().JW();A().A.setState({isOpen:!0,mode:"site-settings-editor",pageStore:a,siteRootBlockStore:i,sessionId:d}),(0,g().Ko)({environment:o,context:"site",from:n,sessionId:d,collectionId:void 0,existingLayoutId:void 0})}function T(e){let{slideBlockStore:o}=e;const t=o.getNavigableBlockStore(),i=r().JW();A().A.setState({isOpen:!0,mode:"presentation",pageStore:t,currentSlideStore:o,sessionId:i}),window.document.documentElement.requestFullscreen()}function x(e){let{slideBlockStore:o}=e;A().A.setState({isOpen:!1}),window.document.fullscreenElement&&window.document.exitFullscreen()}function k(e){A().A.getState().isOpen&&E(e)}function E(e){let{environment:o}=e;const t=A().A.getState();if(!t.isOpen)throw new Error("Cannot close page layout editor. Page layout editor is not open.");"layout-editor"===t.mode&&t.urlOnOpen&&window.location.href!==t.urlOnOpen&&m().aX(o),A().A.setState({isOpen:!1})}function U(e){var o;let{environment:t,transaction:r,property:i,layoutStore:d}=e;const p=A().A.getSessionId(),c=null===(o=d.getModel())||void 0===o?void 0:o.getRawModules(),m=d.getCollectionModel();if(!c||!m)return;const f=b().md.createChildStore(d,m.pointer),y=(0,a().yn)(c,(e=>"titleWithIcon"===e.type));if(y&&(0,s().Mj)(y.module)){var _;const{module:e,position:o}=y,a={...e,type:"titleWithIcon",propertyIds:null===(_=e.propertyIds)||void 0===_?void 0:_.filter((e=>e!==i))};(0,M().UQ)({environment:t,sessionId:p,transaction:r,layoutStore:d,position:{area:(0,n().Fw)(o.area),moduleId:e.id},updatedModule:(0,l().X)(a)})}const v=(0,a().LP)(c,(e=>"property"===e.type&&e.propertyId===i));for(const{module:a,position:l}of v){const e=a.id,o=(0,n().Fw)(l.area);(0,h().U)({environment:t,sessionId:p,transaction:r,layoutStore:d,position:{area:o,moduleId:e}})}const w=m.getFormat().collection_page_sections;if(w){const e=w.filter((e=>e.section!==i));u().LK({store:f,pageSectionFormats:e,transaction:r,environment:t})}}},640868:(e,o,t)=>{t.d(o,{U:()=>u});t(16280);var r=()=>t(454984),i=()=>t(688728),n=()=>t(475140),a=()=>t(789280),d=()=>t(778781),l=()=>t(317909),s=()=>t(204521),p=()=>t(658616);function u(e){let{environment:o,transaction:t,layoutStore:u,position:c,sessionId:m,beforePerformDeleteModule:f}=e;const y=u.getModules();if(!y)throw new Error("[deleteModuleAtPosition] modules by area not found for layout store");const _=(0,n().EX)(y,(e=>e.id===c.moduleId));if(!_)return;const{module:v,position:w}=_;if(!(0,a().Fe)(v))throw new Error("[deleteModuleAtPosition] module to delete is not removeable");var I;(l().createAndCommitOrAppend({environment:o,transaction:t,canUndo:!0,perform(e){!function(e){const{transaction:o,layoutStore:t,moduleLocation:n,moduleToDelete:a,beforePerformDeleteModule:s}=e;s&&s(o);(0,d().V6)(a)&&(0,p().deleteViewsModuleDependencies)({layoutStore:t,viewsModule:a,transaction:o});if("form_conditional_modules"===n.area){const e=r().N4.removeChildModule({pointer:t.pointer,modulesByArea:t.getModules(),module:a});for(const r of e)l().applyOperation({transaction:o,store:t,operation:r})}else{const e="views_main_tab_modules"===n.area?{area:n.area,viewId:n.viewId}:{area:i().Zm[n.area]};l().applyOperation({transaction:o,store:t,operation:r().N4.deleteModuleInArea({...e,pointer:t.pointer,moduleId:a.id})})}}({environment:o,transaction:e,layoutStore:u,moduleLocation:w,moduleToDelete:v,beforePerformDeleteModule:f})},userAction:"pageLayout.deleteActions.deleteModuleAtPosition"}),m)&&s().PS({environment:o,module:v,sessionId:m,collectionId:null===(I=u.getCollectionModel())||void 0===I?void 0:I.id,layoutId:u.id,context:(0,i().We)(c.area),area:c.area})}},658616:(e,o,t)=>{t.r(o),t.d(o,{deleteViewsModuleDependencies:()=>a});var r=()=>t(220719),i=()=>t(44729),n=()=>t(630116);function a(e){const{layoutStore:o,viewsModule:t,transaction:a}=e,d=(0,r().o9)(n().Bv.createChildStore(o,t.collection_view_block_pointer));i().zz({childStore:d,parentStore:o,transaction:a})}},789280:(e,o,t)=>{t.d(o,{Fe:()=>n,wm:()=>a});const r={property_number:!0,property_title:!0,property_person:!0,property_file:!0,property_text:!0,property_checkbox:!0,property_url:!0,property_email:!0,property_phone_number:!0,property_created_by:!0,property_last_edited_by:!0,property_button:!0,property_select:!0,property_multi_select:!0,property_status:!0,property_date:!0,property_created_time:!0,property_last_edited_time:!0,property_last_visited_time:!0,property_relation:!0,property_rollup:!0,property_formula:!0,property_auto_increment_id:!0,property_location:!0,property_verification:!0,property_geo_point:!0,deleted_property:!1,relationsGroup:!0,formSubmit:!0,formQuestion:!0,formTitle:!0,placeholder:!0,transcript:!0,cover:!1,normalizedTitleWithIcon:!1,properties:!1,inlinePageSections:!1,expandedBacklinks:!1,discussions:!1,bottomControls:!1,editor:!1,views:!0,viewsMain:!1},i={property_number:!0,property_title:!0,property_person:!0,property_file:!0,property_text:!0,property_checkbox:!0,property_url:!0,property_email:!0,property_phone_number:!0,property_created_by:!0,property_last_edited_by:!0,property_button:!0,property_select:!0,property_multi_select:!0,property_status:!0,property_date:!0,property_created_time:!0,property_last_edited_time:!0,property_last_visited_time:!0,property_relation:!0,property_rollup:!0,property_formula:!0,property_auto_increment_id:!0,property_location:!0,property_verification:!0,property_geo_point:!0,deleted_property:!1,formSubmit:!1,formQuestion:!1,formTitle:!1,placeholder:!1,transcript:!1,cover:!1,normalizedTitleWithIcon:!1,properties:!1,inlinePageSections:!1,expandedBacklinks:!1,discussions:!1,bottomControls:!1,relationsGroup:!0,editor:!1,views:!1,viewsMain:!1};function n(e){return r[e.type]}function a(e){return i[e.type]}},978846:(e,o,t)=>{t.d(o,{E:()=>_,UQ:()=>v});t(16280),t(18107),t(944114),t(967357);var r=()=>t(792071),i=()=>t(688728),n=()=>t(500993),a=()=>t(369186),d=()=>t(475140),l=()=>t(120997),s=()=>t(251822),p=()=>t(778781),u=()=>t(496603),c=()=>t(534177),m=()=>t(317909),f=()=>t(447934),y=()=>t(204521);function _(e){const{moduleId:o,layoutStore:t,sessionId:r,environment:n,position:a}=e,d=t.getModuleById(o);if(!d)throw new Error(`Cannot move module with id ${o} because a module with that id is not in the layout`);const l=(0,y().TR)({modulesByArea:t.getModules(),moduleId:o,newPosition:a});w({...e,module:d,userAction:"BuilderLayoutModules.moveModuleToPosition",afterUpsertTransaction:()=>{var e;(0,y().Ib)({environment:n,sessionId:r,collectionId:null===(e=t.getCollectionModel())||void 0===e?void 0:e.id,layoutId:t.id,context:(0,i().We)(a.area),action:l,moduleType:d.type})}})}function v(e){const{position:o,module:t,layoutStore:r,sessionId:n,environment:a}=e;if(r.getModuleById(t.id))throw new Error(`Cannot add module with id ${t.id} because a module with that id is already in the layout`);w({...e,userAction:"BuilderLayoutModules.addModuleAtPosition",performBeforeApplyUpsertOperations:e=>{const{transaction:i}=e;"page_main"!==o.area&&"page_details"!==o.area||(0,p().gx)(t)&&(0,f().HD)({environment:a,transaction:i,layoutStore:r,property:t.propertyId})},afterUpsertTransaction:()=>{var d;(0,y().zb)({environment:a,module:t,sessionId:n,collectionId:null===(d=r.getCollectionModel())||void 0===d?void 0:d.id,layoutId:r.id,context:(0,i().We)(o.area),isPropertyCreation:e.isPropertyCreation,area:o.area})}})}function w(e){const{environment:o,position:t,layoutStore:s,module:p,transaction:u,userAction:f,performBeforeApplyUpsertOperations:y,afterUpsertTransaction:_}=e,v=s.pointer,w=s.getModules(),h=s.getRawModules(),g=h&&(0,d().c7)(h,(e=>e.id===p.id))||(0,a().Lv)(p),M="page_main"===t.area||"page_details"===t.area?function(e){const{layoutPointer:o,modulesByArea:t,rawModulesByArea:n}=e,l=(0,d().EX)(t,(e=>"relationsGroup"===e.type));if("form_conditional_modules"===(null==l?void 0:l.position.area))return;const s=n&&(0,d().LC)(n,(e=>"relationsGroup"===e.type));if(!l)return;if(l&&s)return;const p=l.module;if(!p||"relationsGroup"!==p.type)throw new Error("relations group module location in normalized was incorrect, cannot backfill relations group module");return function(e){var o;const{module:t,modulesByArea:n,layoutPointer:l}=e,s=(0,d().JO)(n,(e=>e.id===t.id));if(!s)throw new Error("cannot upsert module at current position because module does not have a current position");if("form_conditional_modules"===s.area)throw new Error("[Forms Conditional Logic Not Implemented] form_conditional_modules area is not supported for adding and moving modules");const p="views_main_tab_modules"===s.area?null===(o=n.views_main_tab_modules)||void 0===o?void 0:o[s.viewId]:n[s.area];if(!p||0===p.length)throw new Error("cannot upsert module at current position in area because that area is empty");const u={module:(0,a().Lv)(t),pointer:l,..."views_main_tab_modules"===s.area?{area:i().Zm[s.area],viewId:s.viewId}:{area:i().Zm[s.area]}};if(0===s.index)return r().N4X.putModuleAfter({...u,afterId:void 0});const c=p.at(s.index+1);if(!c)return r().N4X.putModuleAfter({...u,afterId:void 0});return r().N4X.putModuleBefore({...u,beforeId:c.id})}({module:p,layoutPointer:o,modulesByArea:t})}({layoutPointer:v,modulesByArea:w,rawModulesByArea:h}):null;M&&m().createAndCommitOrAppend({environment:o,perform:e=>{m().applyOperation({transaction:e,store:s,operation:M})},canUndo:!0,transaction:u,userAction:`${f||"BuilderLayoutModules.upsert"}.preOpBackfill`});const S=[],O=function(e){const{layoutStore:o,module:t,upsertPosition:n}=e,a=o.getModules(),l=(0,d().JO)(a,(e=>t.id===e.id));if(!l)return;if("form_conditional_modules"===l.area)return r().N4X.deleteModuleInArea({pointer:o.pointer,area:l.area,moduleId:t.id});if("views_main_tab_modules"===l.area){const e="absolute"===n.type&&"views_main_tab_modules"===n.area?n.viewId:void 0,i=l.viewId;if(e===i)return;return r().N4X.deleteModuleInArea({pointer:o.pointer,area:l.area,moduleId:t.id,viewId:i})}if("page_main"===l.area||"page_details"===l.area||"form_layout_schema"===l.area){if(l.area===n.area)return;return r().N4X.deleteModuleInArea({pointer:o.pointer,area:i().Zm[l.area],moduleId:t.id})}(0,c().HB)(l.area)}({upsertPosition:t,module:p,layoutStore:s});O&&S.push(O);const B=function(e){const{upsertPosition:o,layoutPointer:t,modulesByArea:a,rawModuleToUpsert:s}=e;if("absolute"===o.type)return function(e){const{upsertPosition:o,rawModuleToUpsert:t,layoutPointer:a,modulesByArea:s}=e,p=(0,d().JO)(s,(e=>t.id===e.id)),{area:u}=o;if("form_conditional_modules"===u){const{parentConditionalGroupId:e,parentModuleId:i}=o;if(!(0,l().V)(t,"form_conditional_modules"))throw new Error("Can only add form question or placeholder modules to form_conditional_modules area.");const p=(0,d().Ib)({modulesByArea:s,find:e=>e.id===t.parentModuleId}),u=(0,n().A)(i,s);return r().N4X.upsertChildModule({pointer:a,module:t,previousParentModuleAndArea:p,newParentModule:{area:u.area,module:u.module,conditionalGroupId:e,index:o.index},modulesByArea:s})}const c=o.index;if(c<0)throw new Error(`Cannot upsert module with id ${t.id} to a negative position`);if("views_main_tab_modules"===u){const e=o.viewId;if(!s[u]||!s[u][e])throw new Error("Cannot upsert module into views_main_tab_modules area that does not have views");const n="views_main_tab_modules"===(null==p?void 0:p.area)&&(null==p?void 0:p.viewId)===e?p.index:void 0,d=I({modulesInArea:s[u][e],indexOfModuleToUpsertInArea:n,indexToUpsertTo:c});if(!d)return;return[r().N4X.putModuleBeforeOrAfter({pointer:a,area:i().Zm[u],viewId:e,module:t,direction:d.insertDirection,beforeOrAfterId:d.beforeOrAfterId})]}const m=s[u],f=(null==p?void 0:p.area)===u?p.index:void 0,y=I({modulesInArea:m,indexOfModuleToUpsertInArea:f,indexToUpsertTo:c});if(!y)return;return[r().N4X.putModuleBeforeOrAfter({pointer:a,area:i().Zm[u],module:t,direction:y.insertDirection,beforeOrAfterId:y.beforeOrAfterId})]}({upsertPosition:o,rawModuleToUpsert:s,layoutPointer:t,modulesByArea:a});if("module_relative"===o.type)return[b({upsertPosition:o,rawModuleToUpsert:s,layoutPointer:t,modulesByArea:a})];if("area_relative"===o.type)return[A({upsertPosition:o,rawModuleToUpsert:s,layoutPointer:t,modulesByArea:a})];(0,c().HB)(o)}({module:p,upsertPosition:t,modulesByArea:w,layoutPointer:v,rawModuleToUpsert:g});B&&S.push(...B);const P="placeholder"===p.type&&"form_layout_schema"===t.area?`form_layout_new_question_${p.id}`:void 0;m().createAndCommitOrAppend({environment:o,undoCheckpoint:P,canUndo:!0,perform:e=>{y&&y({transaction:e});for(const o of S)m().applyOperation({transaction:e,store:s,operation:o})},transaction:u,userAction:f||"BuilderLayoutModules.upsert"}),_&&_()}function I(e){const{modulesInArea:o,indexOfModuleToUpsertInArea:t,indexToUpsertTo:r}=e;if(0===r||0===o.length)return{insertDirection:"before",beforeOrAfterId:void 0};const i=o.at(r);return i?void 0===t?{insertDirection:"before",beforeOrAfterId:i.id}:t!==r?t<r?{insertDirection:"after",beforeOrAfterId:i.id}:{insertDirection:"before",beforeOrAfterId:i.id}:void 0:{insertDirection:"after",beforeOrAfterId:void 0}}function b(e){const{upsertPosition:o,rawModuleToUpsert:t,layoutPointer:n,modulesByArea:a}=e,{area:l,direction:s,relativeToModuleId:p}=o,u=i().Zm[l],c=(0,d().JO)(a,(e=>e.id===p));if(!c||c.area!==l)throw new Error(`Cannot find module with id: ${p} to add upsert relative to in ${l}`);if("views_main_tab_modules"===u){const e="views_main_tab_modules"===c.area?c.viewId:void 0;if(!e)throw new Error("Cannot upsert module into views_main_tab_modules area that does not have views");return r().N4X.putModuleBeforeOrAfter({pointer:n,area:"views_main_tab_modules",viewId:e,module:t,direction:"above"===s?"before":"after",beforeOrAfterId:p})}return r().N4X.putModuleBeforeOrAfter({pointer:n,area:u,module:t,direction:"above"===s?"before":"after",beforeOrAfterId:p})}function A(e){const{upsertPosition:o,rawModuleToUpsert:t,layoutPointer:n,modulesByArea:a}=e,{location:d}=o;if("views_main_tab_modules"===o.area){const e=o.viewId,s={pointer:n,area:i().Zm[o.area],viewId:e,module:t};if("start"===d||"end"===d)return r().N4X.putModuleBeforeOrAfter({...s,direction:"start"===d?"before":"after",beforeOrAfterId:void 0});if("end_moveable"===d){var l;const e=h({area:o.area,modulesInArea:(null===(l=a.views_main_tab_modules)||void 0===l?void 0:l[o.viewId])??[]});return r().N4X.putModuleBeforeOrAfter({...s,direction:e.insertDirection,beforeOrAfterId:e.beforeOrAfterId})}(0,c().HB)(d)}const s={pointer:n,area:i().Zm[o.area],module:t};if("start"===d||"end"===d)return r().N4X.putModuleBeforeOrAfter({...s,direction:"start"===d?"before":"after",beforeOrAfterId:void 0});if("end_moveable"===d){const e=a[o.area],t=h({area:o.area,modulesInArea:e});return r().N4X.putModuleBeforeOrAfter({...s,direction:t.insertDirection,beforeOrAfterId:t.beforeOrAfterId})}(0,c().HB)(d)}function h(e){const{area:o,modulesInArea:t}=e,{nonMoveableHeaderModules:r,moveableModules:i,nonMoveableFooterModules:n}=(0,s().jS)(o,t);if(i.length){const e=(0,u().HV)(i);if(!e)throw new Error("cannot find last moveable module to add below for end moveable");return{insertDirection:"after",beforeOrAfterId:e.id}}if(r.length){const e=(0,u().HV)(r);if(!e)throw new Error("cannot find last header module to add below for end moveable");return{insertDirection:"after",beforeOrAfterId:e.id}}if(n.length){const e=n.at(0);if(!e)throw new Error("cannot find last header module to add below for end moveable");return{insertDirection:"before",beforeOrAfterId:e.id}}return{insertDirection:"after",beforeOrAfterId:void 0}}}}]);