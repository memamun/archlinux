"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[15780],{236190:(e,t,o)=>{o.d(t,{c:()=>i});o(296540);var n=o(474848);const i=(0,o(340498).wt)("minus",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M3.037 8.844h9.92a.705.705 0 00.368-.103.825.825 0 00.28-.28.73.73 0 000-.773.752.752 0 00-.28-.28.705.705 0 00-.369-.102H3.037a.705.705 0 00-.369.102.824.824 0 00-.28.28.73.73 0 000 .772.914.914 0 00.28.281.705.705 0 00.37.103z"})})},802512:(e,t,o)=>{o.r(t),o.d(t,{ConfigureIntegrationModal:()=>$});o(16280),o(581454);var n=o(296540),i=()=>o(484714),a=()=>o(56366),r=()=>o(401497),s=()=>o(66913),l=()=>o(332393),d=()=>o(798880),c=()=>o(606219),g=()=>o(20498),u=()=>o(959013),h=()=>o(496603),p=()=>o(973647),f=()=>o(515402),v=()=>o(901389),b=()=>o(436572),x=()=>o(633457),m=()=>o(847307),y=()=>o(972435),k=()=>o(836251),w=()=>o(963589),M=()=>o(962730),j=()=>o(351360),A=()=>o(561585),I=()=>o(508496),S=()=>o(630116),C=(o(898992),o(354520),()=>o(851979)),T=()=>o(987555),U=()=>o(236190),L=()=>o(689094),B=()=>o(493823),K=()=>o(285790),_=()=>o(623580),z=()=>o(125565),H=()=>o(101919),P=o(474848);const R=(0,u().YK)({remove:{id:"integrations.configureIntegrationModal.webhookHeadersRemove",defaultMessage:"Remove"},toggleSecretVisibility:{id:"integrations.configureIntegrationModal.toggleSecretVisibility",defaultMessage:"Toggle secret visibility"}});function V(e){const{headers:t,onChange:o}=e,i=D(),a=(0,n.useCallback)(((e,n)=>{const i=t.map(((t,o)=>o===n?e:t));o(i)}),[t,o]),r=(0,n.useCallback)((e=>{const n=t.filter(((t,o)=>o!==e));o(n)}),[t,o]);return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(H().A,{style:{display:"flex",alignItems:"center",marginTop:24},children:(0,P.jsx)(u().sA,{id:"integrations.configureIntegrationModal.webhookHeadersInput",defaultMessage:"Webhook Headers"})}),(0,P.jsxs)("div",{style:{maxHeight:"30vh",overflow:"auto",width:"100%"},children:[t.length>0&&(0,P.jsxs)("div",{style:i.headerRow,children:[(0,P.jsx)(z().A,{style:i.columnLabel,isSmall:!0,children:(0,P.jsx)(u().sA,{id:"integrations.configureIntegrationModal.webhookHeadersKey",defaultMessage:"Key"})}),(0,P.jsx)(z().A,{style:{...i.columnLabel,marginLeft:8,marginRight:32},isSmall:!0,children:(0,P.jsx)(u().sA,{id:"integrations.configureIntegrationModal.webhookHeadersValue",defaultMessage:"Value"})})]}),t.map(((e,t)=>(0,P.jsx)(W,{header:e,onChange:a,onDelete:r,index:t},t)))]}),(0,P.jsx)(B().p,{style:{marginTop:8},isGray:!0,icon:L().W,onClick:()=>{o([...t,{key:"",value:""}])},children:(0,P.jsx)(u().sA,{id:"integrations.configureIntegrationModal.webhookHeadersAdd",defaultMessage:"New"})})]})}function W(e){const{header:t,index:o,onChange:i,onDelete:a}=e,r=D(),[s,l]=n.useState(!1);return(0,P.jsxs)("div",{style:r.headerRow,children:[(0,P.jsx)(_().A,{value:t.key,onChange:e=>{i({key:e.target.value,value:t.value},o)}}),(0,P.jsx)(_().A,{style:r.valueColumn,value:t.value,onChange:e=>{i({key:t.key,value:e.target.value},o)},type:s?"text":"password",right:(0,P.jsx)("div",{style:{display:"flex"},children:(0,P.jsx)(K().A,{icon:s?C().h:T().T,onClick:()=>l(!s),ariaLabel:y().A.formatMessage(R.toggleSecretVisibility),isBlue:!0,iconStyle:{height:18,width:18},style:{height:18}})})}),(0,P.jsx)(K().A,{style:r.removeButton,onClick:()=>{a(o)},icon:U().c,ariaLabel:y().A.formatMessage(R.remove)})]})}function D(){return(0,r().IS)((e=>({removeButton:{width:28,height:28,marginLeft:4},headerRow:{marginTop:8,display:"flex"},valueColumn:{marginLeft:8},columnLabel:{width:"100%",textAlign:"start"}})),[])}const N=(0,u().YK)({toggleSecretVisibility:{id:"integrations.configureIntegrationShowSecret.toggleSecretVisibility",defaultMessage:"Toggle secret visibility"}});function E(e){const{secret:t,onChange:o,submit:i,placeholder:a}=e,[r,s]=n.useState(!1);return(0,P.jsx)(_().A,{type:r?"text":"password",value:t,onChange:o,placeholder:a,style:{padding:"4px 8px"},focusInitial:!1,onKeyDown:e=>{"Enter"===e.key&&i()},right:t&&(0,P.jsx)("div",{style:{display:"flex"},children:(0,P.jsx)(K().A,{icon:r?C().h:T().T,onClick:()=>{s(!r)},ariaLabel:y().A.formatMessage(N.toggleSecretVisibility),isBlue:!0,iconStyle:{height:18,width:18},style:{height:18}})})})}var F=()=>o(346934),O=()=>o(148375),X=()=>o(331542),Y=()=>o(204063),q=()=>o(859428),G=()=>o(126001),Q=()=>o(641514),J=()=>o(690197);const Z=(0,u().YK)({webhookUrlPlaceholder:{id:"integrations.configureIntegrationModal.webhookUrlInput.placeholder",defaultMessage:"Paste webhook URL"},webhookSecretPlaceholder:{id:"integrations.configureIntegrationModal.webhookSecretInput.placeholder",defaultMessage:"Paste token"},updateButton:{id:"integrations.configureIntegrationModal.submitButton.update",defaultMessage:"Update"},createButton:{id:"integrations.configureIntegrationModal.submitButton.create",defaultMessage:"Connect"},errorOccurred:{id:"integrations.configureIntegrationModal.error.dialog",defaultMessage:"Failed to connect {integration}. Please contact support."},closeModalAriaLabel:{id:"integrations.configureIntegrationModal.closeButtonLabel",defaultMessage:"Close integration configuration modal"}});function $(){const e=(0,i().v3)(),t=(0,r().IS)((e=>({errorText:{color:e.errorText,fontSize:12},input:{display:"flex",flexDirection:"column",alignItems:"flex-start",width:360},helpInfo:{display:"inline-flex",marginLeft:1}})),[]),o=(0,O().useConnectIntegrationModalStyles)(),C=(0,a().K8)((()=>A().A.state.open),[]),T=(0,a().K8)((()=>A().A.state.open?A().A.state.integrationId:void 0),[]),U=(0,a().K8)((()=>A().A.state.open?A().A.state.webhookSubscriptionId:void 0),[]),L=(0,a().K8)((()=>j().default.state.currentSpaceStore),[]),B=T&&L?S().CX.createChildStore(L,{id:T,table:l().Li}):void 0,z=U&&L?S().Pr.createChildStore(L,{id:U,table:c().TF,spaceId:L.id}):void 0;(0,n.useEffect)((()=>{const{webhookUrl:e,webhookSecret:t,webhookCustomization:o}={webhookUrl:(null==z?void 0:z.getWebhookUrl())||"",webhookSecret:(null==z?void 0:z.getWebhookSecret())||"",webhookCustomization:(null==z?void 0:z.getWebhookCustomization())||void 0};W(e),N(t);const n=(null==o?void 0:o.headers)||{},i=Object.entries(n).map((e=>{let[t,o]=e;return{key:t,value:o}})).sort(((e,t)=>e.key.localeCompare(t.key)));ee(i)}),[z]);const[R,W]=n.useState(""),[D,N]=n.useState(""),[$,ee]=n.useState([]),[te,oe]=n.useState(!1),[ne,ie]=n.useState(!1),[ae,re]=n.useState(!1),se=(0,a().K8)((()=>{if(B)return B.getModel()}),[B]),le=(0,g().D4)(T),de=h().h1({},g().bX,null==le?void 0:le.customization).headers.hmac,ce=(0,w().X)("allow_customize_integration_headers"),ge=(0,n.useCallback)((e=>{if("internal"===(null==se?void 0:se.type))throw new Error("internal integrations are not supported");e&&(re(!1),v().f1(y().A.formatMessage(Z.errorOccurred,{integration:null==se?void 0:se.getInfo().developer_name})))}),[se]),ue=(0,n.useCallback)((async()=>{if(!ae){if(!le||!(0,g().Nl)({env:"production",integrationConfig:le,webhookUrlToValidate:R,experimentService:I().default,actor:{table:d().oo,id:e.currentUser.id||""},spaceId:(null==L?void 0:L.id)||""}))return oe(!0),void re(!1);if(oe(!1),de&&!D)return ie(!0),void re(!1);if(re(!0),se){const t=await m().v({environment:e,integration:se,webhookUrl:R,webhookSecret:D,webhookHeaders:$,webhookSubscriptionId:U,onError:ge,onSuccess:()=>b().D6({label:(0,P.jsx)(u().sA,{id:"configureIntegrationModal.snackbar.title",defaultMessage:"Added {integrationName} to your workspace",values:{integrationName:se.name}})})});if(p().Q.isFail(t))return void re(!1);await x().oX({environment:e}),await f().g({environment:e}),fe()}}}),[e,ge,se,ae,D,$,de,U,R,le,L]),he=(0,n.useCallback)((e=>N(e.target.value)),[]),pe=(0,n.useCallback)((e=>{ee(e)}),[]),fe=()=>{A().A.setState({open:!1}),W(""),N(""),oe(!1),ie(!1),re(!1)};return se&&le&&L&&"internal"!==se.type?(0,P.jsx)(Q().A,{innerStyle:o.modal,isOpen:C,onDismiss:fe,render:()=>(0,P.jsxs)("div",{style:o.mobileModal,children:[(0,P.jsxs)("div",{style:o.innerModal,children:[(0,P.jsx)(K().A,{icon:s().V,onClick:fe,style:o.cancelButton,hoveredStyle:o.hovered,ariaLabel:y().A.formatMessage(Z.closeModalAriaLabel)}),(0,P.jsx)(F().K,{integrationModel:se,integrationConfig:le,spaceStore:L}),(0,P.jsxs)("div",{style:t.input,children:[(0,P.jsxs)(H().A,{style:{display:"flex",alignItems:"center",marginTop:40},children:[(0,P.jsx)(u().sA,{id:"integrations.configureIntegrationModal.webhookUrlInput",defaultMessage:"Webhook URL"}),(0,P.jsx)(q().A,{placement:M().W.Bottom,render:e=>(0,P.jsx)(J().A,{...e,href:(0,k().xS)("guides.publicAPI"),analyticsFrom:"workspace_connections",style:t.helpInfo}),renderTooltip:()=>(0,P.jsx)(u().sA,{id:"integrations.configureIntegrationModal.webhookUrlInput.tooltip",defaultMessage:"Enter the webhook URL provided by {integrationName}",values:{integrationName:(null==se?void 0:se.getInfo().developer_name)??"Unknown"}})})]}),(0,P.jsx)(_().A,{type:"text",style:{padding:"4px 8px"},value:R,onChange:e=>{W(e.target.value),oe(!1)},placeholder:y().A.formatMessage(Z.webhookUrlPlaceholder),focusInitial:!0,onKeyDown:async e=>{"Enter"===e.key&&await ue()}}),te?(0,P.jsx)("div",{style:{marginTop:5,...t.errorText},children:(0,P.jsx)(u().sA,{id:"integrations.configureIntegrationModal.invalidUrl",defaultMessage:"Invalid webhook URL"})}):null]}),le.acceptsSecretToken&&(0,P.jsxs)("div",{style:t.input,children:[(0,P.jsxs)(H().A,{style:{display:"flex",alignItems:"center",marginTop:24},children:[(0,P.jsx)(u().sA,{id:"integrations.configureIntegrationModal.webhookSecretInput",defaultMessage:"Token"}),(0,P.jsx)(q().A,{placement:M().W.Bottom,render:e=>(0,P.jsx)(J().A,{...e,href:(0,k().xS)("guides.publicAPI"),analyticsFrom:"workspace_connections",style:t.helpInfo}),renderTooltip:()=>{var e;return(0,P.jsx)(u().sA,{id:"integrations.configureIntegrationModal.webhookTokenInput.tooltip",defaultMessage:"Enter the token provided by {integrationName}",values:{integrationName:(null==se||null===(e=se.getInfo())||void 0===e?void 0:e.developer_name)??"Unknown"}})}})]}),(0,P.jsx)(E,{secret:D,onChange:he,submit:ue,placeholder:y().A.formatMessage(Z.webhookSecretPlaceholder)}),ne?(0,P.jsx)("div",{style:{marginTop:5,...t.errorText},children:(0,P.jsx)(u().sA,{id:"integrations.configureIntegrationModal.invalidSecret",defaultMessage:"Webhook secret is required."})}):null]}),le.acceptsCustomHeaders&&ce&&(0,P.jsx)("div",{style:t.input,children:(0,P.jsx)(V,{headers:$,onChange:pe})}),(0,P.jsx)(Y().A,{style:o.connect,onClick:ue,disabled:""===R||de&&""===D,children:ae?(0,P.jsx)(X().A,{}):(0,P.jsx)("span",{children:U?y().A.formatMessage(Z.updateButton):y().A.formatMessage(Z.createButton)})})]}),le.website_url&&(0,P.jsx)(G().r,{signupUrl:le.signupUrl??le.website_url})]})}):null}},851979:(e,t,o)=>{o.d(t,{h:()=>i});o(296540);var n=o(474848);const i=(0,o(340498).wt)("eye",{viewBox:"0 0 32 32",svg:(0,n.jsx)("path",{d:"M16.006 25.812c8.863 0 14.994-7.17 14.994-9.406C31 14.16 24.858 7 16.006 7 7.252 7 1 14.16 1 16.406c0 2.236 6.252 9.406 15.006 9.406zm0-3.242a6.194 6.194 0 01-6.197-6.164c-.012-3.452 2.744-6.164 6.197-6.164 3.419 0 6.185 2.711 6.185 6.164 0 3.364-2.766 6.164-6.185 6.164zm0-3.94c1.228 0 2.246-1.007 2.246-2.224 0-1.228-1.018-2.235-2.246-2.235-1.24 0-2.258 1.007-2.258 2.235 0 1.217 1.018 2.224 2.258 2.224z"})})}}]);