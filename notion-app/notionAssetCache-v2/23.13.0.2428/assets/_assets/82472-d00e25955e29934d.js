"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[82472],{102777:(e,o,t)=>{t.d(o,{b:()=>n});t(296540);var r=t(474848);const n=(0,t(340498).wt)("sendArrow",{viewBox:"0 0 20 20",svg:(0,r.jsx)("path",{d:"M9.79883 18.5894C14.6216 18.5894 18.5894 14.6216 18.5894 9.79883C18.5894 4.96777 14.6216 1 9.79053 1C4.95947 1 1 4.96777 1 9.79883C1 14.6216 4.96777 18.5894 9.79883 18.5894ZM9.79883 14.3062C9.20947 14.3062 8.76953 13.9077 8.76953 13.3433V9.69922L8.86914 8.00586L8.25488 8.84424L7.3916 9.81543C7.23389 10.0063 6.98486 10.1143 6.72754 10.1143C6.21289 10.1143 5.84766 9.75732 5.84766 9.25928C5.84766 8.99365 5.92236 8.79443 6.12158 8.58691L8.96045 5.61523C9.19287 5.35791 9.4585 5.2417 9.79883 5.2417C10.1309 5.2417 10.4048 5.36621 10.6372 5.61523L13.4761 8.58691C13.667 8.79443 13.75 8.99365 13.75 9.25928C13.75 9.75732 13.3848 10.1143 12.8618 10.1143C12.6128 10.1143 12.3638 10.0063 12.2061 9.81543L11.3428 8.86914L10.7202 7.99756L10.8281 9.69922V13.3433C10.8281 13.9077 10.3799 14.3062 9.79883 14.3062Z"})})},179070:(e,o,t)=>{t.r(o),t.d(o,{autofillPropertyForBlocks:()=>$,autofillPropertyForCollection:()=>J,fillAllPagesMessages:()=>V,getDefaultAiInference:()=>X,getPropertyCompletionForBlock:()=>G,saveOrRemovePropertyAiInference:()=>Q,submitFeedbackForAiAutofill:()=>Y,triggerAiAutofillUpsell:()=>z});t(944114),t(517642),t(658004),t(733853),t(845876),t(432475),t(515024),t(731698),t(898992),t(354520),t(672577),t(803949),t(581454);var r=t(296540),n=()=>t(221844),i=()=>t(970013),a=()=>t(713998),s=()=>t(206267),l=()=>t(134025),c=()=>t(441738),d=()=>t(959013),u=()=>t(532659),p=()=>t(534177),f=()=>t(937075),m=()=>t(299709),v=()=>t(449506),w=()=>t(884107),g=()=>t(583289),y=()=>t(901389),S=()=>t(896628),h=()=>t(436572),k=()=>t(606952),I=()=>t(317909),C=()=>t(831566),A=()=>t(289190),_=()=>t(364280),b=()=>t(104012),M=t(474848);const P=function(e){let{environment:o,inferenceIds:n,aiInference:i}=e;const a=(0,t(56366).K8)((()=>{const{state:e}=A().m;return"uninitialized"===e.type?null:{numBlocksToAutofill:e.numBlocksToAutofill,numBlocksAutofilled:e.numBlocksAutofilled,propertySchema:e.propertySchema,collectionId:e.collectionId,sessionId:e.sessionId,haveAllBlocksCompletedAutofill:e.haveAllBlocksCompletedAutofill}}),[]),s=(0,r.useCallback)((()=>{a&&(n.forEach((e=>{f().oe(o,{ai_inference_type:i.type,type:"undo_from_snackbar",inference_id:e,collection_id:a.collectionId,session_id:a.sessionId})})),t(495262).tN({environment:o,preventSelectText:!0}),h().N2(),A().m.setState({type:"filling",...a,didInterruptStreaming:!0}))}),[a,o,i,n]);if(!a)return null;const{numBlocksToAutofill:l,numBlocksAutofilled:c,propertySchema:{name:u}}=a;return c===l?(0,M.jsxs)(_().fI,{gap:4,alignItems:"center",children:[(0,t(413267).b)({width:16}),(0,M.jsx)(d().sA,{defaultMessage:'AI updated "{propertyName}" on {numPages, plural, one {1 page} other {# pages}}',id:"snackbar.aiAutofill.autofillInProgress",values:{propertyName:u,numPages:l}}),(0,M.jsx)(b().Ag,{onClick:s,children:(0,M.jsx)(d().sA,{defaultMessage:"Undo",id:"snackbar.aiAutofill.undo"})}),(0,M.jsx)(b().Ag,{onClick:()=>{h().N2()},children:(0,M.jsx)(d().sA,{defaultMessage:"Close",id:"snackbar.aiAutofill.close"})})]}):(0,M.jsxs)(_().fI,{gap:4,alignItems:"center",children:[(0,M.jsx)(t(331542).A,{}),0===c?(0,M.jsx)(d().sA,{defaultMessage:'AI updating "{propertyName}" on {numPages, plural, one {1 page} other {# pages}}',id:"snackbar.aiAutofill.autofillStarting",values:{propertyName:u,numPages:l}}):(0,M.jsx)(d().sA,{defaultMessage:'AI updated "{propertyName}" on {numFilledPages} of {numTotalPages} pages',id:"snackbar.aiAutofill.completedAutofill",values:{propertyName:u,numFilledPages:c,numTotalPages:l}}),(0,M.jsx)(b().Ag,{onClick:s,children:(0,M.jsx)(d().sA,{defaultMessage:"Stop & undo",id:"snackbar.aiAutofill.undoAndStop"})})]})};var T=()=>t(659602),W=()=>t(335722),x=()=>t(972435),O=()=>t(71304),L=()=>t(351360),F=()=>t(630116),N=()=>t(666429),j=()=>t(991249),R=()=>t(749240),U=()=>t(108184);const V=(0,d().YK)({fillAllPagesTooltip:{defaultMessage:"{hasNames, select, true {Autofill {propertyName} for all pages in {collectionName}} other {Autofill this property for all pages in the database}}",id:"aiAutofill.fillAllPages.buttonTooltip"},fillAllPagesAddOnMessage:{defaultMessage:"Only with Notion AI add-on",id:"aiAutofill.fillAllPages.onlyWithAiAddOnMessageInTooltip"}});function B(e){const{environment:o,propertyId:t,propertySchema:r,storesWithCompletions:n,blockIdToInferenceId:i,useTemporaryStore:a,markdownLinkifyIt:s,tinyMceMicrosoftWordPasteFilter:l,clipboardActions:c,doneStreaming:d,aiInferenceOverride:u}=e;I().createAndCommit({userAction:"BlockPropertyValue.handleActionButtonClick.aiAutofill",environment:o,canUndo:!Boolean(a),undoCheckpoint:!0,perform:e=>{E({environment:o,propertyId:t,propertySchema:r,storesWithCompletions:n,blockIdToInferenceId:i,useTemporaryStore:a,markdownLinkifyIt:s,tinyMceMicrosoftWordPasteFilter:l,clipboardActions:c,doneStreaming:d,aiInferenceOverride:u,transaction:e})}})}function E(e){var o;const{environment:t,propertyId:r,propertySchema:n,storesWithCompletions:s,blockIdToInferenceId:l,useTemporaryStore:c,markdownLinkifyIt:d,tinyMceMicrosoftWordPasteFilter:u,clipboardActions:f,doneStreaming:m,aiInferenceOverride:v,transaction:w}=e;for(const{store:g,temporaryStore:y,completion:h}of s){const e=c?y:g;let s;switch(n.type){case"text":s=f.getInlineTitleValueFromClipboardTextHtml({text:h.trim(),stripText:!1,stripSurroundingWhitespace:!0,markdownLinkifyIt:d,tinyMceMicrosoftWordPasteFilter:u});break;case"multi_select":case"select":const e=c?null===(o=g.getAssociatedCollectionStore())||void 0===o?void 0:o.clone(y.inMemoryRecordCache):g.getAssociatedCollectionStore(),t=v??n.select_ai_inference;let l=h.trim().split(",").map((e=>e.trim()));if(m||(l=l.slice(0,-1)),e&&null!=t&&t.add_options){const o=(0,i().nP)({newTokenValues:l.length>0&&"select"===n.type?[[l[0]]]:[l],property:r,propertySchema:n,collectionId:e.id});if(o)for(const t of o)I().applyOperation({store:e,operation:t,transaction:w})}null!=t&&t.add_options||(l=l.filter((e=>{var o;return null===(o=n.options)||void 0===o?void 0:o.find((o=>o.value===e))}))),s=(0,a().rK)(l);break;default:(0,p().HB)(n)}k().KY({environment:t,store:e.getPropertyStore(r),value:s,transaction:w});const C=e.getFormat().ai_property_inference_map??{},A=l[g.id]??"";S().zA({stores:[e],update:{ai_property_inference_map:{...C,[r]:{inference_id:A,created_time:Date.now()}}},transaction:w})}}const D=(0,d().YK)({FAILED_TO_AUTOFILL:{defaultMessage:"Something went wrong. Please try again later",id:"propertyCompletionActions.error.unableToAutofill"},INVALID_PROPERTY_FOR_AUTOFILL:{defaultMessage:"Invalid property configuration for AI autofill",id:"propertyCompletionActions.error.invalidPropertyForAutofill"},NO_BLOCKS_TO_AUTOFILL:{defaultMessage:"Nothing to update with AI",id:"propertyCompletionActions.error.noBlocksToAutofill"}}),H=(0,d().YK)({featureUnavailable:{id:"completionActions.featureNotEnabledError",defaultMessage:"This feature is not currently enabled"}});function q(e){let{autofillPropertyResult:o}=e;const t=x().A.formatMessage(D[o]);h().N2(),y().c1(t)}const K={ai_limit_property_autofill:(0,M.jsx)(d().sA,{defaultMessage:"This workspace has used all of its free AI responses. Contact your workspace owner to add Notion AI.",id:"aiAutofill.outOfAiUpsellDialogMessage"}),ai_autofill_on_page_edit:(0,M.jsx)(d().sA,{defaultMessage:"Auto-update requires the Notion AI Add-on. Contact your workspace owner to add Notion AI.",id:"aiAutofill.autoUpdateOnPageEditUpsellDialogMessage"}),ai_autofill_fill_all_pages:(0,M.jsx)(d().sA,{defaultMessage:"Updating all pages requires the Notion AI Add-on. Contact your workspace owner to add Notion AI.",id:"aiAutofill.fillAllPagesUpsellDialogMessage"}),ai_autofill_bulk_fill:(0,M.jsx)(d().sA,{defaultMessage:"Filling more pages at once requires the Notion AI Add-on. Contact your workspace owner to add Notion AI.",id:"aiAutofill.bulkFillUpsellDialogMessage"})};function z(e){var o;let{environment:t,from:r}=e;null!==(o=L().default.state.currentSpaceStore)&&void 0!==o&&o.canAdmin()||y().c1(K[r]),j().K(t,{from:r,upsell:{type:"product",product:"ai",limit:{type:"none"}}})}function Z(e){let{errorCode:o,environment:t}=e;return 405===o?h().D6({label:x().A.formatMessage(H.featureUnavailable)}):(402===o&&(h().N2(),z({environment:t,from:"ai_limit_property_autofill"})),U().showCompletionErrorWithCode(o))}async function $(e){var o;let{environment:t,stores:r,property:a,propertySchema:l,userEventForAnalytics:c,sessionIdForAnalytics:d,collectionContextStore:g,from:y,isBulkAction:S,aiInferenceOverride:k,transaction:I}=e;const C=d||s().JW(),_=a,b=r.map((e=>({spaceId:e.getSpaceId(),...e.pointer,propertyId:_,inferenceId:s().JW()}))),x=r[0].getAssociatedCollectionId()??(null===(o=r[0].getCollectionStore())||void 0===o?void 0:o.id),O=new(n().A)({name:"propertyCompletionActions.autofillPropertyForBlocks"});if(A().m.setIsWriting({stores:r,propertySchema:l,sessionIdForAnalytics:d}),"uninitialized"!==A().m.state.type&&(0,i().$M)(l)&&x){h().D6({label:(0,M.jsx)(P,{environment:t,inferenceIds:b.map((e=>e.inferenceId)),aiInference:(0,i().om)(l)}),durationMs:N().LX});try{var F;if(t.defaultRecordCache.inMemoryRecordCache.addCacheOverride(O),!(0,p().EI)(b))return q({autofillPropertyResult:"NO_BLOCKS_TO_AUTOFILL"});const e=k||(0,i().om)(l);if(!e)return q({autofillPropertyResult:"INVALID_PROPERTY_FOR_AUTOFILL"});b.forEach((o=>{f().oe(t,{type:c,inference_id:o.inferenceId,ai_inference_type:e.type,collection_id:x,session_id:C})})),null!==(F=L().default.state.currentSpaceStore)&&void 0!==F&&F.id&&v().callApi({eventName:"publishAiSession",environment:t,data:{inference_type:"autofill",id:C,spaceId:L().default.state.currentSpaceStore.id,metadata:{blockPropertyPointers:b,aiInference:e,collection_id:x}}});const o=await v().callStreamApi({eventName:"getCompletionForProperty",environment:t,data:{blockPropertyPointers:b,aiInference:e,aiSessionId:C,model:"default"}});if("success"!==o.type)return q({autofillPropertyResult:"FAILED_TO_AUTOFILL"});g&&(0,m().E)({block_id:r[0].pointer.id,property:_,property_type:l.type,from:y,environment:t,collectionContextStore:g,isFromBulkActionsToolbar:S});const n=Object.fromEntries(r.map((e=>[e.pointer.id,{store:e,temporaryStore:e.clone(O),completion:""}]))),a=Object.fromEntries(b.map((e=>[e.id,e.inferenceId]))),s=new Set,[d,h,M]=await Promise.all([T().g.load(),W().S.load(),w().R.clipboardActions.load()]);if(u().hS.is(o.data)){for await(const e of o.data){if("error"===e.type)return A().m.setState({...A().m.state,didInterruptStreaming:!0}),Z({errorCode:e.errorCode,environment:t});if(A().m.state.didInterruptStreaming)return;const o=n[e.blockPropertyPointer.id],r=o.completion+e.completion;n[e.blockPropertyPointer.id]={...o,completion:r},s.add(e.blockPropertyPointer.id),I?E({environment:t,propertyId:_,propertySchema:l,storesWithCompletions:Object.values(n),blockIdToInferenceId:a,useTemporaryStore:!0,markdownLinkifyIt:d,tinyMceMicrosoftWordPasteFilter:h,clipboardActions:M,doneStreaming:!0,aiInferenceOverride:k,transaction:I}):B({environment:t,propertyId:_,propertySchema:l,storesWithCompletions:Object.values(n),blockIdToInferenceId:a,useTemporaryStore:!0,markdownLinkifyIt:d,tinyMceMicrosoftWordPasteFilter:h,clipboardActions:M,aiInferenceOverride:k}),A().m.setState({...A().m.state,numBlocksAutofilled:s.size})}A().m.setState({...A().m.state,haveAllBlocksCompletedAutofill:!0})}t.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(O),I?E({environment:t,propertyId:_,propertySchema:l,storesWithCompletions:Object.values(n),blockIdToInferenceId:a,useTemporaryStore:!1,markdownLinkifyIt:d,tinyMceMicrosoftWordPasteFilter:h,clipboardActions:M,doneStreaming:!0,aiInferenceOverride:k,transaction:I}):B({environment:t,propertyId:_,propertySchema:l,storesWithCompletions:Object.values(n),blockIdToInferenceId:a,useTemporaryStore:!1,markdownLinkifyIt:d,tinyMceMicrosoftWordPasteFilter:h,clipboardActions:M,doneStreaming:!0,aiInferenceOverride:k})}finally{t.defaultRecordCache.inMemoryRecordCache.hasCacheOverride(O)&&t.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(O)}}}function Y(e){const{environment:o,inferenceId:t,feedbackType:r,userContent:n,shareWithNotion:i}=e;f().I5(o,{type:"property_autofill",inference_id:t,feedback_type:r,timestamp:(new Date).toUTCString(),user_comment:n,share_with_notion:i})}async function J(e){var o;let{environment:t,collectionStore:r,propertySchema:n,property:a,sessionIdForAnalytics:d}=e;if(!(0,i().$M)(n))return;const u=(0,i().om)(n);if(!r||!n||!u)return;const p=(null===(o=R().subscriptionDataStoreInstance.state)||void 0===o?void 0:o.addOns)??[];if(!(0,c().GI)(p))return void z({environment:t,from:"ai_autofill_fill_all_pages"});const m=x().A.getIntl(),v=(0,O().tS)({environment:t,intl:m,store:r});if(!(await g().U({sourceAction:"fill_all_pages",propertyName:n.name,collectionName:v})))return;f().oe(t,{type:"generate_from_fill_all_pages",inference_id:s().JW(),ai_inference_type:u.type,collection_id:r.id,session_id:d??s().JW()});const w=[];w.push(l().op.update({pointer:r.pointer,path:["format","update_ai_inferences_status"],args:{[a]:{type:"requested",created_time:Date.now()}}})),(0,C().p)({environment:t,collectionStore:r,performTransaction:e=>{for(const o of w)I().applyOperation({store:(0,F().Oo)(r,o.pointer),operation:o,transaction:e})}})}function Q(e){const{environment:o,propertySchema:t,collectionStore:r,property:n,draftAiInference:a}=e;let s="";switch(t.type){case"text":s="ai_inference";break;case"select":case"multi_select":s="select_ai_inference";break;default:return}const l=[];if(l.push({pointer:r.pointer,command:"set",path:["schema",n,s],args:a}),a)f().Nj(o,{type:"set_ai_inference",ai_inference_type:a.type,collection_id:r.id});else{const e=(0,i().om)(t);f().Nj(o,{type:"remove_ai_inference",ai_inference_type:null==e?void 0:e.type,collection_id:r.id})}(0,C().p)({environment:o,collectionStore:r,performTransaction:e=>{for(const o of l)I().applyOperation({store:(0,F().Oo)(r,o.pointer),operation:o,transaction:e})}})}async function G(e){var o;let{environment:t,store:r,property:n,propertySchema:i,userEventForAnalytics:a,sessionIdForAnalytics:l}=e;const c=l||s().JW(),d=n,p={spaceId:r.getSpaceId(),...r.pointer,propertyId:d,inferenceId:s().JW()},m=r.getAssociatedCollectionId()??(null===(o=r.getCollectionStore())||void 0===o?void 0:o.id),w=X(i,!1);if(!w)return"";f().oe(t,{type:a,inference_id:p.inferenceId,ai_inference_type:w.type,collection_id:m,session_id:c});const g=s().JW();v().callApi({eventName:"publishAiSession",environment:t,data:{inference_type:"autofill",id:g,metadata:{blockPropertyPointers:[p],aiInference:w,collection_id:m}}});const y=await v().callStreamApi({eventName:"getCompletionForProperty",environment:t,data:{blockPropertyPointers:[p],aiInference:w,aiSessionId:g,model:"default"}});if("success"!==y.type)return"";let S="";if(u().hS.is(y.data))for await(const s of y.data)"error"!==s.type&&(S+=s.completion);return S}function X(e,o){if(!(0,i().$M)(e))return;const t=(0,i().om)(e);return!t&&(0,i().lx)(e)?{type:e.type,auto_update_on_edit:o,add_options:!1}:t}},247345:(e,o,t)=>{t.d(o,{J:()=>f});t(296540);var r=()=>t(484714),n=()=>t(56366),i=()=>t(102777),a=()=>t(959013),s=()=>t(285790),l=()=>t(35392),c=()=>t(859428),d=()=>t(962730),u=()=>t(286088),p=t(474848);function f(e){const o=(0,a().tz)(),{onSubmit:t,canSend:f}=e,m=(0,u().q2)(),v=(0,r().v3)(),w=(0,n().K8)((()=>v.device.isPhone),[v]),g=o.formatMessage({id:"completions.CompletionMenuActionBar.sendTooltip",defaultMessage:"Send to AI"});return(0,p.jsx)(c().A,{renderTooltip:()=>(0,p.jsxs)("div",{children:[g,(0,p.jsx)(l().A,{style:m.keyboardShortcutInverted,name:"enter"})]}),placement:d().W.Bottom,render:e=>(0,p.jsx)(s().A,{icon:i().b,onClick:t,isPurple:f,disabled:!f,iconStyle:{height:w?24:20,width:w?24:20},ariaLabel:g,style:{pointerEvents:"auto",height:w?24:20,width:w?24:20},...e})})}},353731:(e,o,t)=>{t.d(o,{$:()=>n});t(296540);var r=t(474848);const n=(0,t(340498).wt)("database",{viewBox:"0 0 20 20",svg:(0,r.jsx)("path",{d:"M16.25 5v1.25c0 1.381-2.797 2.5-6.25 2.5s-6.25-1.119-6.25-2.5V5c0-1.381 2.797-2.5 6.25-2.5s6.25 1.119 6.25 2.5zM10 14.375c-2.784 0-4.744-.569-5.963-1.378-.187.237-.287.49-.287.753V15c0 1.381 2.797 2.5 6.25 2.5s6.25-1.119 6.25-2.5v-1.25c0-.262-.103-.516-.287-.753-1.22.806-3.179 1.378-5.963 1.378zM10 10c-2.784 0-4.744-.569-5.963-1.378-.187.237-.287.49-.287.753v1.25c0 1.381 2.797 2.5 6.25 2.5s6.25-1.119 6.25-2.5v-1.25c0-.262-.103-.516-.287-.753C14.742 9.428 12.784 10 10 10z"})})},363186:(e,o,t)=>{t.d(o,{$O:()=>c,HH:()=>d,X9:()=>u,_o:()=>l});t(16280);var r=t(296540),n=()=>t(56366),i=()=>t(890754),a=()=>t(847),s=t(474848);const l=(0,r.createContext)(null);function c(){const e=(0,r.useContext)(l);if(!e)throw new Error("useWorkflowEditorContext must be used inside WorkflowEditorContextProvider");return e}function d(){return(0,r.useContext)(l)??void 0}l.displayName="WorkflowEditorContext";const u=r.memo((function(e){let{children:o,store:c}=e;const d=(0,t(484714).v3)(),u=(0,t(424141).y)(c),p=t(985554).K,f=(0,i().useChatSidebarState)(),m=(null==f?void 0:f.chatThreadId)!==i().NEW_CHAT_THREAD_ID?null==f?void 0:f.chatThreadId:void 0,v=null==f?void 0:f.workflowStepId,w=(0,n().K8)((()=>{const{currentSpaceStore:e}=t(351360).default.state;if(e&&m)return t(630116).Ei.createChildStore(e,{table:t(234459).To,id:m,spaceId:e.id})}),[m]),g=(0,r.useCallback)((async e=>{var o;const{threadId:r,stepId:n}=e;if(r===m&&n===v)return;if(w&&"update"===(null===(o=(0,t(900535).t)({threadStore:w,workflowStore:u,clientStore:p,focusedWorkflowStepId:v}))||void 0===o?void 0:o.type)){const{accept:e}=await t(901389).Gh({message:"You have unsaved changes",description:"You can return to this chat to resume editing.",acceptLabel:"Continue without saving",cancelLabel:"Cancel"});if(!e)return}(0,t(118078).openChatSidebar)({environment:d,chatThreadId:r,workflowStepId:n})}),[m,v,w,u,p,d]),y=(0,n().K8)((()=>{if(t(508496).default.checkGate({gateName:"workflows_simple_mode"})){return{type:"simple-workflow"}}return{type:"workflow",workflowBlockId:c.id}}),[c]),S=(0,r.useCallback)((e=>{if(!u)throw new Error("Cannot save trigger without a workflow store");const o=a().saveTrigger({workflowStore:u,trigger:e,environment:d,threadStore:w,clientStore:p});g({threadId:o})}),[p,d,g,w,u]),h=(0,r.useCallback)((e=>{if(!u)throw new Error("Cannot save trigger without a workflow store");const o=a().saveTriggers({workflowStore:u,triggers:e,environment:d,threadStore:w,clientStore:p});g({threadId:o})}),[p,d,g,w,u]),k=(0,r.useCallback)((e=>{if(!u)throw new Error("Cannot save module without a workflow store");const o=a().saveModule({workflowStore:u,module:e,environment:d,threadStore:w,clientStore:p});g({threadId:o})}),[p,d,g,w,u]),I=(0,r.useCallback)((e=>{if(!u)throw new Error("Cannot add module without a workflow store");const o=a().addModule({workflowStore:u,module:e,environment:d,threadStore:w,clientStore:p});g({threadId:o})}),[p,d,g,w,u]),C=(0,r.useCallback)((e=>{const{functionStore:o,fn:t}=e;if(!u)throw new Error("Cannot save function without a workflow store");const r=a().saveFunction({functionStore:o,fn:t,environment:d,threadStore:w,clientStore:p,workflowStore:u});g({threadId:r})}),[p,d,g,w,u]),A=(0,r.useCallback)((e=>{const{functionStore:o,test:t}=e;if(!u)throw new Error("Cannot save test without a workflow store");const r=a().saveTest({functionStore:o,environment:d,test:t,threadStore:w,clientStore:p,workflowStore:u});g({threadId:r})}),[p,d,g,w,u]),_=(0,r.useMemo)((()=>({store:c,workflowStore:u,threadStore:w,clientStore:p,saveTrigger:S,saveTriggers:h,saveModule:k,addModule:I,saveFunction:C,saveTest:A,config:y,onThreadChange:g})),[p,y,S,h,k,I,C,A,c,w,u,g]);return(0,s.jsx)(l.Provider,{value:_,children:o})}))},450859:(e,o,t)=>{t.d(o,{mA:()=>I});t(16280),t(517642),t(658004),t(733853),t(845876),t(432475),t(515024),t(731698),t(898992),t(354520);var r=()=>t(329199),n=()=>t(416504),i=()=>t(696706),a=()=>t(179034),s=()=>t(973647),l=()=>t(534177),c=()=>t(862292),d=()=>t(186445),u=()=>t(909470),p=()=>t(972435),f=()=>t(508496),m=()=>t(38789),v=()=>t(630116),w=()=>t(449506);const g=1e3;class y extends Error{constructor(e,o){super(o),this.type=e}}class S extends y{constructor(){super("query_collection_limit_outside_range",`Query collection limit must be between 0 and ${g}`)}}class h extends y{constructor(e){super("query_collection_failed",`Query collection failed: ${e.reason}`),this.data=e}}class k extends y{constructor(){super("query_collection_too_many_items","Query collection updating too many items")}}async function I(e,o){const{source:t,parentRecordStore:y,collectionPointer:I,filter:C,sort:A,limit:_}=o,b=_??g;if(b<0||b>g)return{error:new S};const M=v().md.createChildStore(y,I);await M.load();const P=M.getModel();if(!P)return{error:new h({reason:"no collection value"})};const T=M.getParentBlockStore();if(!T)return{error:new h({reason:"no collection parent"})};await T.load();const W=T.getCollectionViewStores()[0],x=W.getSpaceId();if(!W||!x)return{error:new h({reason:"no first collection view"})};const O="results",L={[O]:{type:"results",limit:b}},F=Object.keys(o.aggregations??{});for(const r of F){var N;if(r===O)return{error:new h({reason:`${O} is a reserved reducer keyword.`})};const e=null===(N=o.aggregations)||void 0===N?void 0:N[r];if(!e)return{error:new h({reason:`no aggregation provided for ${r}.`})};e&&(L[r]={type:"aggregation",aggregation:e})}const j=M.getSchema(),R={filter:C&&r().SK(C,j),sort:A&&r().g4(A,j),userId:e.currentUser.id,userTimeZone:(0,n().P)(),searchQuery:void 0,reducers:L},U=await w().callApi({eventName:"queryCollection",environment:e,data:{source:{type:"collection",id:I.id,spaceId:I.spaceId},collectionView:{id:W.id,spaceId:x},loader:R},tracking:{src:t}});if("failed"===U.type)return{error:new h({reason:"server query failed",cause:U.error})};const V=U.data.result.reducerResults[O];if(!V||"results"!==V.type)return{error:new h({reason:"unexpected server result"})};if(V.blockIds.length===g&&V.hasMore)return{error:new k};const{groupsReducerIds:B,reducerIdsWithNoGroupDependencies:E}=r().M(R.reducers,R.reducerDependencies),D=f().default.getConfigKey("collection_request_settings","clientFormulaTimeoutMs"),H=Date.now(),q=await c().T.formulas.load(),K={pageSort:[],schema:j,loader:R,userId:e.currentUser.id,userStartOfWeek:d().XX.state,currentTime:H,getRecordModel:y.getRecordModel,getRecordRole:y.getRecordRole,intl:p().A.getIntl(),isSorted:!1,visibleProperties:void 0,relativeVariableResult:null==U?void 0:U.data.relativeVariableResult,currentPageInRelatedCollection:void 0,isSprintPlanningView:!1,collectionSourceType:"collection",groupsReducerIds:B,reducerIdsWithNoGroupDependencies:E,formulaTimeoutMs:D,resultCache:new Map,regExpCache:new Map,experimentService:f().default,collectionFeatureGates:(0,u().i)(),formulasModule:q},z=r().zl(K);for(const n of V.blockIds){var Z;const e=v().Bv.createChildStore(y,{table:a().ev,id:n}),o=null===(Z=e.getAssociatedCollectionStore())||void 0===Z?void 0:Z.pointer;if(!(o&&i().L3.isEqualIdTable(o,M.pointer)))continue;const t=y.getRecordModel(e);t&&r().UC(t,P,K,z)}const $=m().A.getEditedBlocksForCollection(P.id),Y=new Set(V.blockIds);for(const n of $){if(Y.has(n))continue;const e=y.getRecordModel({table:a().ev,id:n});e&&r().UC(e,P,K,z)}const{result:J}=r().Mo(K,z),Q=r().uX({result:J}),G={};for(const n of F){var X;const e=r().VI({expectedAggregator:null===(X=o.aggregations)||void 0===X||null===(X=X[n])||void 0===X?void 0:X.aggregator,aggregationReducerResult:U.data.result.reducerResults[n]});if(s().Q.isFail(e)){const o="no aggregation provided"===e.error?`no aggregation provided for ${n}`:"unexpected response returned for aggregation"===e.error?`unexpected response returned for aggregation ${n}`:(0,l().HB)(e.error);return{error:new h({reason:o})}}G[n]=e.value}return{value:{blockIds:Q,...G}}}},462892:(e,o,t)=>{t.d(o,{_:()=>n});t(296540);var r=t(474848);const n=(0,t(340498).wt)("layout",{viewBox:"0 0 14 14",svg:(0,r.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2.39999 2.19999C2.28953 2.19999 2.19999 2.28953 2.19999 2.39998V11.5999C2.19999 11.7103 2.28953 11.7999 2.39999 11.7999H4.99997C5.11042 11.7999 5.19997 11.7103 5.19997 11.5999V2.39998C5.19997 2.28953 5.11042 2.19999 4.99997 2.19999H2.39999ZM1 2.39998C1 1.6268 1.62679 1 2.39999 1H4.99997C5.77316 1 6.39995 1.6268 6.39995 2.39998V11.5999C6.39995 12.3731 5.77316 12.9999 4.99997 12.9999H2.39999C1.62679 12.9999 1 12.3731 1 11.5999V2.39998ZM9 8.80036C8.88954 8.80036 8.8 8.88991 8.8 9.00036V11.6003C8.8 11.7108 8.88954 11.8003 9 11.8003H11.6C11.7105 11.8003 11.8 11.7108 11.8 11.6003V9.00036C11.8 8.88991 11.7105 8.80036 11.6 8.80036H9ZM7.60001 9.00036C7.60001 8.22717 8.2268 7.60037 9 7.60037H11.6C12.3731 7.60037 13 8.22717 13 9.00036V11.6003C13 12.3736 12.3731 13.0003 11.6 13.0003H9C8.2268 13.0003 7.60001 12.3736 7.60001 11.6003V9.00036ZM8.79994 2.39998C8.79994 2.28953 8.88949 2.19999 8.99994 2.19999H11.5999C11.7104 2.19999 11.7999 2.28953 11.7999 2.39998V4.99997C11.7999 5.11043 11.7104 5.19996 11.5999 5.19996H8.99994C8.88949 5.19996 8.79994 5.11043 8.79994 4.99997V2.39998ZM8.99994 1C8.22675 1 7.59995 1.6268 7.59995 2.39998V4.99997C7.59995 5.77316 8.22675 6.39995 8.99994 6.39995H11.5999C12.3731 6.39995 12.9999 5.77316 12.9999 4.99997V2.39998C12.9999 1.6268 12.3731 1 11.5999 1H8.99994Z"})})},583289:(e,o,t)=>{t.d(o,{U:()=>n});var r=()=>t(388182);async function n(e){return new Promise((o=>{r().A.setState({open:!0,onClose:()=>{r().A.setState({open:!1}),o(!1)},onConfirm:()=>{r().A.setState({open:!1}),o(!0)},...e})}))}},589982:(e,o,t)=>{t.d(o,{u:()=>n});t(296540);var r=t(474848);const n=(0,t(340498).wt)("basicClock",{viewBox:"0 0 16 16",svg:(0,r.jsx)("path",{d:"M4.541 7.919a.53.53 0 01-.39-.157.53.53 0 01-.157-.39c0-.155.053-.282.157-.383a.53.53 0 01.39-.157h2.905V2.895c0-.15.053-.278.158-.383a.521.521 0 01.382-.158.53.53 0 01.39.158.521.521 0 01.157.383v4.477a.53.53 0 01-.157.39.53.53 0 01-.39.157H4.541zm3.452 6.207a6.789 6.789 0 01-2.727-.554 7.124 7.124 0 01-2.256-1.524 7.277 7.277 0 01-1.525-2.256 6.788 6.788 0 01-.553-2.728c0-.966.184-1.875.553-2.727A7.241 7.241 0 015.258.557 6.788 6.788 0 017.987.003c.971 0 1.882.184 2.735.554.852.369 1.604.88 2.256 1.53a7.136 7.136 0 011.53 2.25c.37.852.555 1.761.555 2.727 0 .967-.185 1.876-.554 2.728a7.218 7.218 0 01-3.787 3.78 6.789 6.789 0 01-2.728.554zm0-1.395c.789 0 1.525-.145 2.208-.437a5.678 5.678 0 001.805-1.217 5.68 5.68 0 001.217-1.805c.291-.683.437-1.42.437-2.208a5.55 5.55 0 00-.437-2.2 5.66 5.66 0 00-3.029-3.029 5.567 5.567 0 00-2.208-.438c-.784 0-1.52.146-2.208.438A5.6 5.6 0 003.98 3.052a5.715 5.715 0 00-1.21 1.811 5.55 5.55 0 00-.437 2.201c0 .789.146 1.525.438 2.208a5.735 5.735 0 001.21 1.805 5.598 5.598 0 004.013 1.654z"})})},713838:(e,o,t)=>{t.d(o,{e:()=>n});t(296540);var r=t(474848);const n=(0,t(340498).wt)("tag",{viewBox:"0 0 17 17",svg:(0,r.jsx)("path",{d:"M9.49219 15.4951C8.47363 16.5205 7.40039 16.5273 6.36133 15.4883L2 11.1406C0.960938 10.1084 0.981445 9.02148 1.99316 8.00977L8.70605 1.31055C9.23926 0.777344 9.54688 0.71582 10.3193 0.71582H12.917C13.6689 0.71582 13.9219 0.900391 14.4756 1.44727L16.041 3.0127C16.5947 3.56641 16.7725 3.81934 16.7725 4.57129V7.16895C16.7725 7.94141 16.7178 8.25586 16.1846 8.78906L9.49219 15.4951ZM8.62402 14.4697L15.248 7.83887C15.3779 7.70215 15.4531 7.57227 15.4531 7.34668V4.57812C15.4531 4.37305 15.3779 4.23633 15.2412 4.09961L13.3887 2.24707C13.2588 2.11035 13.1152 2.03516 12.9102 2.03516H10.1484C9.92285 2.03516 9.79297 2.11035 9.65625 2.25391L3.02539 8.87109C2.57422 9.32227 2.56055 9.80078 3.03223 10.2725L7.22266 14.4629C7.69434 14.9277 8.16602 14.9209 8.62402 14.4697ZM12.0693 6.40332C11.5088 6.40332 11.0918 5.96582 11.0918 5.41895C11.0918 4.87207 11.5088 4.44141 12.0693 4.44141C12.6299 4.44141 13.0469 4.87207 13.0469 5.41895C13.0469 5.96582 12.6299 6.40332 12.0693 6.40332Z"})})},851979:(e,o,t)=>{t.d(o,{h:()=>n});t(296540);var r=t(474848);const n=(0,t(340498).wt)("eye",{viewBox:"0 0 32 32",svg:(0,r.jsx)("path",{d:"M16.006 25.812c8.863 0 14.994-7.17 14.994-9.406C31 14.16 24.858 7 16.006 7 7.252 7 1 14.16 1 16.406c0 2.236 6.252 9.406 15.006 9.406zm0-3.242a6.194 6.194 0 01-6.197-6.164c-.012-3.452 2.744-6.164 6.197-6.164 3.419 0 6.185 2.711 6.185 6.164 0 3.364-2.766 6.164-6.185 6.164zm0-3.94c1.228 0 2.246-1.007 2.246-2.224 0-1.228-1.018-2.235-2.246-2.235-1.24 0-2.258 1.007-2.258 2.235 0 1.217 1.018 2.224 2.258 2.224z"})})},900535:(e,o,t)=>{t.d(o,{t:()=>d});t(16280),t(813451),t(898992),t(354520);var r=()=>t(724639),n=()=>t(496603),i=()=>t(255299),a=()=>t(630116),s=()=>t(94522);function l(e){const{transcript:o,saved:t,toIndex:n}=e,i=n?o.slice(0,n):o,a=i.findLastIndex((e=>"workflow"===e.type&&(void 0===t||e.saved===t)));if(-1===a)return;const s=i[a];if("workflow"!==s.type)return;const l=(0,r().Uj)({workflowStepIndex:a,transcript:o});return{step:s,index:a,mergedWorkflow:(0,r().Kq)({workflowValue:s.value,operationSteps:l}),operationSteps:l}}function c(e){var o,t;const{threadStore:r,versionPointer:n,savedVersionPointer:i}=e,s=a().je.createChildStore(r,n);if(!s.isVersion())return;const l=null===(o=s.getData())||void 0===o?void 0:o.version;if(!l)return;const c=a().je.createChildStore(r,i);if(!c.isVersion())return;const d=null===(t=c.getData())||void 0===t?void 0:t.version;return d?d===l?"equal":l<d?"restore":"update":void 0}function d(e){var o;const{threadStore:t,workflowStore:a,clientStore:d,focusedWorkflowStepId:p}=e;if(d.state.loading)return;const f=(0,i().A3)({clientStore:d,threadStore:t});if(p){var m;const e=f.findIndex((e=>e.id===p));if(-1===e)return;const o=f[e];if("workflow"!==o.type)throw new Error("Focused build step is not a workflow");if(null===(m=o.value)||void 0===m||!m.versionPointer)return;const i=(0,r().Uj)({workflowStepIndex:e,transcript:f}),d=(0,r().Kq)({workflowValue:o.value,operationSteps:i}),v=u(f.slice(e+1));if(!a)return{type:"create",workflowStepToSave:o,newWorkflow:d,threadStore:t,numUnsavedWorkflowOperationSteps:i.length,numUnsavedWorkflowSteps:v};const w=l({transcript:f,saved:!0,toIndex:e});if(!w)return;const g=(0,s().dh)(a);if(!g.versionPointer)return n().n4(g,d)?void 0:{type:"update",baseWorkflow:g,workflowStepToSave:o,newWorkflow:d,threadStore:t,workflowStore:a,numUnsavedWorkflowOperationSteps:i.length,numUnsavedWorkflowSteps:v};const y=c({threadStore:t,versionPointer:o.value.versionPointer,savedVersionPointer:g.versionPointer});if("equal"===y)return;return"restore"===y?{type:"restore",workflowStepToSave:o,newWorkflow:d,threadStore:t,workflowStore:a,numUnsavedWorkflowOperationSteps:i.length,numUnsavedWorkflowSteps:v}:{type:"update",baseWorkflow:w.mergedWorkflow,workflowStepToSave:o,newWorkflow:d,threadStore:t,workflowStore:a,numUnsavedWorkflowOperationSteps:i.length,numUnsavedWorkflowSteps:v}}const v=f.findLastIndex((e=>"workflow"===e.type&&e.saved)),w=u(f.slice(v+1)),g=l({transcript:f});if(null==g||null===(o=g.mergedWorkflow)||void 0===o||!o.versionPointer)return;if(!a)return{type:"create",workflowStepToSave:g.step,newWorkflow:g.mergedWorkflow,threadStore:t,numUnsavedWorkflowOperationSteps:g.operationSteps.length,numUnsavedWorkflowSteps:w};const y=l({transcript:f,saved:!0,toIndex:g.index});if(!y)return;const S=(0,s().dh)(a);if(!S.versionPointer)return n().n4(S,g.mergedWorkflow)?void 0:{type:"update",baseWorkflow:S,workflowStepToSave:g.step,newWorkflow:g.mergedWorkflow,threadStore:t,workflowStore:a,numUnsavedWorkflowOperationSteps:g.operationSteps.length,numUnsavedWorkflowSteps:w};const h=c({threadStore:t,versionPointer:g.mergedWorkflow.versionPointer,savedVersionPointer:S.versionPointer});return"equal"!==h?"restore"===h?{type:"restore",workflowStepToSave:g.step,newWorkflow:g.mergedWorkflow,threadStore:t,workflowStore:a,numUnsavedWorkflowOperationSteps:g.operationSteps.length,numUnsavedWorkflowSteps:w}:{type:"update",baseWorkflow:y.mergedWorkflow,workflowStepToSave:g.step,newWorkflow:g.mergedWorkflow,threadStore:t,workflowStore:a,numUnsavedWorkflowOperationSteps:g.operationSteps.length,numUnsavedWorkflowSteps:w}:void 0}function u(e){return e.filter((e=>"workflow"===e.type&&"user-edit"!==e.tag)).length}},931077:(e,o,t)=>{t.d(o,{Q:()=>s});t(296540);var r=()=>t(484714),n=()=>t(401497),i=()=>t(494379),a=t(474848);function s(e){const{isMobile:o}=(0,r().Y0)(),t=(0,n().DP)();return(0,a.jsx)(i().Q,{...e,theme:t,isMobile:o})}}}]);