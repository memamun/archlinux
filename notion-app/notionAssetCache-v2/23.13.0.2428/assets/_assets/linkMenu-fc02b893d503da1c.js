"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[4586],{553679:(e,t,n)=>{n.r(t),n.d(t,{default:()=>ke});var o=n(296540),i=()=>n(908006),s=()=>n(484714),r=()=>n(56366),l=()=>n(777447),a=()=>n(959013),u=()=>n(264879),c=()=>n(501666),d=()=>n(317909),p=()=>n(805751),k=()=>n(545805),f=()=>n(928600),m=()=>n(939740),v=()=>n(45552),g=()=>n(14235),y=()=>n(156988),x=()=>n(722872),h=()=>n(231722),I=()=>n(328347),S=()=>n(332737),b=()=>n(179034),A=()=>n(919709),T=()=>n(496603),w=()=>n(534177),B=()=>n(939768),P=()=>n(559926),C=()=>n(606952),L=()=>n(760217),M=()=>n(89924),j=()=>n(780054),U=()=>n(989423),E=()=>n(186445),R=()=>n(781286),V=()=>n(958163),_=()=>n(18158),F=()=>n(419357),H=()=>n(711319);var K=n(474848);function N(e){const{state:t,focusInitial:n,defaultValue:o,onBlur:i,onKeyDown:r,style:l,inputComboboxProps:u}=e,c=(0,s().WS)(),d=(0,a().tz)(),p=d.formatMessage({defaultMessage:"Paste link or search pages",id:"selectionLinkButton.search.createNewLinkPlaceholder"}),k=d.formatMessage({defaultMessage:"Edit link or search pages",id:"selectionLinkButton.search.editLinkPlaceholder"}),f=!c||!t.showCreateIn,m=c?void 0:!t.showCreateIn&&t.focusLinkInput,v=(0,y().lR)(t)?k:p;return f?(0,K.jsx)(F().Ay,{onFocus:y().Nd,placeholder:v,value:o||t.url,onChange:W,onBlur:i,onKeyDown:r,focus:m,focusInitial:n,focusAfterAnimation:!0,preventCaptureArrowShortcuts:!0,style:l,...u}):null}function W(e){const t=(0,y().t4)();t&&function(e,t){switch(e.type){case"text":return void H().A.setState({...e,url:t.target.value,focusLinkInput:!0});case"image":return void V().A.setState({...e,url:t.target.value,focusLinkInput:!0});default:(0,w().HB)(e)}}(t,e)}function q(e){const{state:t,showPreview:n,store:o,inputComboboxProps:i}=e,r=(0,s().WS)(),l=(0,y().Hx)(t),a=(0,y().lR)(t);return n&&o?(0,K.jsx)(_().k,{store:o,onClick:y().Nd}):(0,K.jsx)(N,{state:t,onBlur:y().gZ,onKeyDown:O,defaultValue:n?l:void 0,style:a?void 0:{marginTop:6},focusInitial:!a||r&&"text"===t.type&&!t.focusTitleInput,inputComboboxProps:i})}function O(e){"Escape"===e.key&&(e.stopPropagation(),(0,y().OY)())}function Q(e){const{title:t,focus:n,defaultTitle:i}=e,r=(0,s().v3)(),l=(0,s().WS)(),[a,u]=(0,o.useState)(),c=(0,o.useRef)(!1),d=(0,o.useMemo)((()=>({environment:r,defaultTitle:i,setPlaceholder:u,hasTitleChanged:c})),[i,r]);return(0,o.useEffect)((()=>{const e=c.current;return()=>{e&&P().st(r)}}),[c,r]),(0,K.jsx)(F().Ay,{focus:n,focusInitial:l,onFocus:z,onBlur:()=>G(d),onChange:e=>function(e,t){D(e.target.value,t)}(e,d),onKeyDown:e=>function(e,t){"Enter"!==e.key&&"Escape"!==e.key||(e.stopPropagation(),G(t))}(e,d),value:a?"":t,placeholder:a,preventCaptureArrowShortcuts:!0,style:{paddingBottom:8}})}function D(e,t){const n=H().A.state;if(!n.open)return;const{editingToken:o,savedTextSelectionState:i}=n;if(!o)return;if(!e)return void H().A.setState({...n,title:""});const{environment:s,setPlaceholder:r,hasTitleChanged:l}=t;d().createAndCommit({userAction:"LinkMenu.updateTitle",environment:s,canUndo:!0,perform:t=>{const a=c().ar({environment:s,title:e,transaction:t,editingToken:o,savedTextSelectionState:i});a&&H().A.setState({...n,...a,title:e}),r(void 0),l.current=!0}})}function z(){(0,y().zE)(!0)}function G(e){!function(e){const t=H().A.state;if(!t.open)return;const{defaultTitle:n,setPlaceholder:o}=e;t.title||(D(n,e),o(n))}(e),(0,y().zE)(!1)}var J=()=>n(227440),Y=()=>n(630116),Z=(n(898992),n(581454),n(737550),()=>n(17022)),X=()=>n(187174),$=()=>n(305390),ee=()=>n(825972),te=()=>n(106628),ne=()=>n(645873),oe=()=>n(62856);var ie=()=>n(857437),se=()=>n(735384);function re(e){const{state:t,onUnlink:n}=e,[i,u]=(0,ie().$)(),c=(0,o.useMemo)((()=>(0,y().V8)(t)),[t]),d=(0,o.useMemo)((()=>(0,y().KX)(c)),[c]),p=function(e){const{state:t,inputUrl:n,query:i,handleLinkSelection:l}=e,{url:u}=t,c=(0,s().v3)(),d=(0,s().WS)(),p=(0,r().K8)((()=>J().A.state.online),[]),k=!!u,f=(0,o.useMemo)((()=>{let e,o=!1;if(!n&&k)e=(0,K.jsx)(a().sA,{defaultMessage:"Type a complete URL to link",id:"selectionLinkButton.invalidUrl"}),o=!0;else{if(!n)return;if("notion"===n.type&&p)return;"web"===n.type?e=(0,K.jsx)(a().sA,{id:"selectionLinkButton.linkToWebPage",defaultMessage:"Link to web page"}):"notion"===n.type?e=(0,K.jsx)(a().sA,{id:"selectionLinkButton.linkToPage",defaultMessage:"Link to page"}):"other"===n.type?e=(0,K.jsx)(a().sA,{id:"selectionLinkButton.linkToURL",defaultMessage:"Link to URL"}):(0,w().HB)(n.type)}return{key:"link to url",action:()=>l(c,t,i,d),render:t=>(0,K.jsx)(L().A,{...t,title:u,caption:e,icon:(0,I().h)({width:16,paddingTop:4}),disabled:o})}}),[t,i,c,d,p,n,l,k,u]);return f}({state:t,inputUrl:d,query:c,handleLinkSelection:le}),k=function(e){const{state:t,inputUrl:n,query:i,additionalItem:u}=e,c="text"===t.type?t.editingToken:t.imageHyperlink,d=(0,y().lR)(t),p=function(e){const{state:t,inputUrl:n,query:i,handleLinkSelection:u,disableEmptyQueryResults:c}=e,d=(0,s().v3)(),p=(0,s().WS)(),[{online:k}]=(0,r().$y)(J().A),f=(0,o.useMemo)((()=>{var e;const n="text"===t.type?null===(e=(0,h().H7)(t.savedTextSelectionState.multiSelection))||void 0===e?void 0:e.store:t.store;if(n&&n instanceof Y().Bv)return n}),[t]),m=(0,ne().fJ)(te().T.searchActions),[{value:v,status:g}]=(0,X().Yb)((async()=>{if(!k||"resolved"!==m.status)return[];if(!i)return c?[]:ee().NK.state.map((e=>e.pageId));const e=m.value;return(await e.searchMentionablePages({nearBlock:f,environment:d,query:i,source:"mention_menu",limit:10})).map((e=>e.id))}),[i,f,d,k,c,m.status,m.value]),y=(0,oe().A)("resolved"===g,300,300),x=(0,o.useMemo)((()=>{if(n&&"notion"===n.type){const e="page"===n.notionPage.name?n.notionPage.blockId:n.notionPage.peekViewBlockId,t=v?T().FF(v,e):[];return[n,...t]}return v}),[v,n]);return(0,o.useMemo)((()=>{if(!x||0===x.length)return;if(n&&"web"===n.type&&n.url===i)return;const e=Z().A.withListenerIgnored(E().ZO);if(!e)return;const o=t.url?5:3,s=(0,K.jsx)(a().sA,{id:"selectionLinkButton.linkToPage.linkToBlock",defaultMessage:"Link to block"}),r=(0,K.jsx)(a().sA,{defaultMessage:"Link to page",id:"selectionLinkButton.linkToPageSection.title"});return{items:(0,T().oE)(x.map(((n,o)=>{const{pageId:i,peekViewBlockId:r,scrollToBlockId:c,discussionId:k,collectionViewId:f}="object"==typeof n?{pageId:"page"===n.notionPage.name?n.notionPage.blockId:n.notionPage.peekViewBlockId,..."page"===n.notionPage.name?{scrollToBlockId:n.notionPage.scrollToBlockId,peekViewBlockId:n.notionPage.peekViewBlockId,discussionId:n.notionPage.discussionId,collectionViewId:n.notionPage.collectionViewId}:{scrollToBlockId:void 0,peekViewBlockId:void 0,discussionId:void 0,collectionViewId:void 0}}:{pageId:n,peekViewBlockId:void 0,scrollToBlockId:void 0,discussionId:void 0,collectionViewId:void 0};if(!i)return;const m=Y().Bv.createChildStore(e,{table:b().ev,id:i});return{key:o,action:()=>{if("object"==typeof n){const e=(0,l().wv)({pageId:i,peekViewBlockId:r,peekMode:n.notionPage.peekMode,discussionId:k,collectionViewId:f,scrollToBlockId:c});u(d,t,e,p,m)}else u(d,t,(0,l().wv)({pageId:i}),p,m)},render:e=>{const t="object"==typeof n&&c;return(0,K.jsx)($().A,{...e,store:m,caption:t?s:void 0,placeholder:y?(0,K.jsx)(a().sA,{id:"selectionLinkButton.linkToPage.unknownBlock",defaultMessage:"Unknown block"}):(0,K.jsx)(a().sA,{id:"selectionLinkButton.linkToPage.loading",defaultMessage:"Loading..."})})}}}))).slice(0,o),title:x.some((e=>Boolean("object"==typeof e&&"page"===e.notionPage.name&&e.notionPage.scrollToBlockId)))?s:r}}),[x,t,d,p,i,n,u,y])}({state:t,inputUrl:n,query:i,handleLinkSelection:le,disableEmptyQueryResults:d}),k=(0,o.useMemo)((()=>{if(p||u){return{key:"results",items:T().oE([...(null==p?void 0:p.items)||[],u]),render:e=>(0,K.jsx)(M().A,{...e,title:c||i?void 0:(0,K.jsx)(a().sA,{id:"selectionLinkButton.recents.title",defaultMessage:"Recents"})})}}}),[p,u,c,i]);return k}({state:t,inputUrl:d,query:c,additionalItem:p}),f=(0,y().Hx)(t),m=f&&(0,l().lX)({url:f,baseUrl:j().A.domainBaseUrl,publicDomainName:j().A.publicDomainName}),v=(0,r().K8)((()=>{if(!m)return;const e=(0,E().ZO)();return e?Y().Bv.createChildStore(e,{table:b().ev,id:m}):void 0}),[m]),g=function(e){const{state:t,url:n,isEmptyResults:i,pageStore:s,inputComboboxProps:r}=e,l=(0,o.useMemo)((()=>{let e=(0,K.jsx)(a().sA,{defaultMessage:"Page or URL",id:"selectionLinkButton.currentInfo.pageOrUrl"});const o=!t.focusLinkInput&&i;let l;return s?l={key:"link to page",action:()=>{},render:()=>(0,K.jsx)(q,{state:t,showPreview:o,store:s,inputComboboxProps:r})}:n?l={key:"link to web",action:()=>{},render:()=>(0,K.jsx)(q,{state:t,showPreview:!0,inputComboboxProps:r})}:(e=void 0,l={key:"create link",action:()=>{},render:()=>(0,K.jsx)(q,{state:t,showPreview:o,inputComboboxProps:r})}),{key:"page or url",render:t=>(0,K.jsx)(M().A,{title:e,...t}),items:[l]}}),[t,n,i,s,r]);return l}({state:t,url:f,isEmptyResults:!Boolean(k),pageStore:v,inputComboboxProps:i}),x=function(e){const{state:t,url:n,pageStore:i}=e,s=(0,r().K8)((()=>i?A().q4_(i.getTitleValue()):void 0),[i]),l=(0,o.useMemo)((()=>{if("text"!==t.type)return;const{editingToken:e,title:o,focusTitleInput:i}=t;return e?{key:"link title",render:e=>(0,K.jsx)(M().A,{title:(0,K.jsx)(a().sA,{defaultMessage:"Link title",id:"selectionLinkButton.currentInfo.linkTitle"}),...e}),items:[{key:"update title",action:()=>{},render:()=>(0,K.jsx)(Q,{title:o,defaultTitle:s??n,focus:i})}]}:void 0}),[t,n,s]);return l}({state:t,url:f,pageStore:v}),S=function(e){const{state:t,onUnlink:n}=e,i=function(e){const{state:t,onUnlink:n}=e,i=(0,s().v3)();return(0,o.useMemo)((()=>{if((0,y().lR)(t))return{key:"unlink",action:()=>{n(i);const e=(0,y().Hx)(t);switch(t.type){case"text":P().Mi(i,{type:"remove_link",url:e});break;case"image":const n=e?(0,B().bk)(e):void 0;(0,U().u4)({environment:i,event:{eventName:"image_hyperlink_action",eventProperties:{action:"remove_link",url_type:null!=n&&n.hostname?"external":"notion"}}});break;default:(0,w().HB)(t)}},render:e=>(0,K.jsx)(L().A,{...e,title:(0,K.jsx)(a().sA,{id:"selectionLinkButton.removeLink",defaultMessage:"Remove link"}),icon:(0,se().I)({width:16})})}}),[n,t,i])}({state:t,onUnlink:n}),r=(0,o.useMemo)((()=>{const e=T().oE([i]);if(0!==e.length)return{key:"link actions",render:e=>(0,K.jsx)(M().A,{topBorder:!0,...e}),items:e}}),[i]);return r}({state:t,onUnlink:n});let C,R;return k?(R=1,C=T().oE([g,k])):(R=void 0,C=T().oE([g,x,S])),{initialFocus:R,sections:C,comboboxProps:u}}function le(e,t,n,o,i){const s=(0,S().l)(n);if(!s)return;const r=(0,y().Hx)(t);if(d().createAndCommit({userAction:"LinkMenu.handleLinkSelection",environment:e,canUndo:!0,perform:n=>{switch(t.type){case"text":const{editingToken:r,savedTextSelectionState:l,title:a}=t;(0,h().kM)(l.multiSelection)&&(i?C().Gf({environment:e,editorMode:"default",store:l.multiSelection.start.store,selection:{startIndex:l.multiSelection.start.index,endIndex:l.multiSelection.end.index},annotation:A().ld4(i.id,i.getSpaceId()),transaction:n,analyticsFrom:"block"}):C().yr({environment:e,store:l.multiSelection.start.store,tokens:[[s,[["a",s]]]],index:l.multiSelection.start.index,transaction:n}));const u=c().BK({environment:e,transaction:n,url:s,title:a,editingToken:r,savedTextSelectionState:l});u?(P().Mi(e,{type:"edit_link",url:s}),H().A.setState({...t,...u,url:"",focusLinkInput:!1,focusTitleInput:Boolean(o)})):(P().Mi(e,{type:"create_link",url:s}),H().A.reset());break;case"image":R().Uc({url:s,transaction:n}),V().A.reset()}}}),"image"===t.type){var l;const t=null!==(l=(0,B().bk)(s))&&void 0!==l&&l.hostname?"external":"notion";(0,U().u4)({environment:e,event:{eventName:"image_hyperlink_action",eventProperties:{action:r?"edit_link":"create_link",url_type:t}}})}}var ae=()=>n(691298),ue=()=>n(349471),ce=()=>n(962730),de=()=>n(377586),pe=()=>n(611371);function ke(){const e=(0,r().K8)((()=>(0,y().t4)()),[]),t=(0,s().Y0)(),n=null==e?void 0:e.trapFocus,i=(0,r().K8)((()=>!e||function(e){switch(e.type){case"text":return c().GC();case"image":return!e.open;default:(0,w().HB)(e)}}(e)),[e]);(0,o.useEffect)((()=>{e&&i&&function(e){switch(e){case"text":return void c().d();case"image":return void R().J6();default:(0,w().HB)(e)}}(e.type)}),[i,e]);const l=function(e){if(e)switch(e.type){case"text":return{onClose:c().d,onUnlink:c().sp};case"image":return{onClose:R().J6,onUnlink:R().PA};default:(0,w().HB)(e)}}(e);return l&&e?(0,K.jsx)(g().Ay,{popupType:t.isMobile?t.isTablet?de().n.Popup:de().n.SlideUp:de().n.Popup,style:{width:xe},keepFocus:t.isPhone,open:e.open,originRect:e.open?e.selectionRect:void 0,placementToOrigin:ce().W.Bottom,alignmentToOrigin:ce().C.Center,originGap:8,disableContentScroll:!0,onDismiss:l.onClose,render:()=>e.open?(0,K.jsx)(fe,{state:e,onClose:l.onClose,onUnlink:l.onUnlink}):void 0,preventBlockRenderQueueOnEnter:!t.isMobile,trapFocus:n}):null}function fe(e){const{state:t,onClose:n,onUnlink:r}=e,l=(0,s().WS)(),[u,c]=(0,o.useState)(!0);(0,o.useEffect)((()=>c(!1)),[]);const d=(0,o.useRef)(null);(0,o.useEffect)((()=>(d.current=document.createElement("input"),d.current.style.position="fixed",d.current.style.top="-9999px",d.current.style.left="-9999px",document.body.appendChild(d.current),()=>{d.current&&document.body.removeChild(d.current)})),[]);const m=l&&t.focusLinkInput&&("text"!==t.type||!t.focusTitleInput);(0,o.useEffect)((()=>{m&&i().default.afterNextFlush((()=>{d.current&&d.current.focus()}))}),[m]);const h=(0,o.useCallback)((()=>{i().default.afterNextFlush((()=>{d.current&&document.activeElement===d.current&&d.current.blur()}))}),[]);if((0,ae().A)({shouldPreserveTextSelection:m,shouldPreserveBlockSelection:!0,shouldRestoreSelection:!0,onClearSelection:h}),t.showCreateIn&&!l)return(0,K.jsx)(ve,{state:t});let I;return I=l?{menuType:x().gu.Modal,title:(0,K.jsx)(a().sA,{defaultMessage:"Link",id:"selectionLinkButton.mobile.title"}),right:(0,K.jsx)(v().CancelMenuText,{}),onClickRight:n,footer:(0,K.jsx)(g().Ay,{popupType:de().n.SlideUp,open:t.showCreateIn||!1,render:()=>(0,K.jsx)(ve,{state:t})})}:{menuType:x().gu.Popup},(0,K.jsxs)(p().A,{debugName:"LinkMenu",capture:t.open&&(u||t.focusLinkInput||"text"===t.type&&t.focusTitleInput),allowEsc:!0,children:[(0,K.jsx)(f().A,{...I,children:(0,K.jsx)(me,{state:t,onUnlink:r})}),(0,K.jsx)(k().A,{debugName:"LinkMenu",capture:!0,onCommandSlash:y().Nd})]})}function me(e){const{state:t,onUnlink:n}=e,{initialFocus:o,sections:i,comboboxProps:s}=re({state:t,onUnlink:n});return(0,K.jsx)(m().Ay,{type:m().Oh.Vertical,initialFocus:o,sections:i,comboboxProps:s})}function ve(e){var t;const{state:n}=e,i=(0,s().v3)(),r=(0,o.useCallback)((async e=>{var t;if(!(0,pe().EF)(i))return;const o="text"===n.type?null===(t=(0,h().H7)(n.savedTextSelectionState.multiSelection))||void 0===t?void 0:t.store:void 0;if(!o)return;const{performResult:{createInState:s}}=await d().createAndCommitAsync({environment:i,userAction:"LinkMenu.LinkCreateInMenu",waitForServerCommit:!0,perform:async t=>{const s=u().oj({environment:i,transaction:t,titleText:n.url||"",createInValue:e,recordStoreParentStore:o}),[r]=s.createdPages;return r&&"text"===n.type&&(c().BK({environment:i,url:(0,l().wv)({pageId:r.id}),transaction:t,editingToken:n.editingToken,savedTextSelectionState:n.savedTextSelectionState}),H().A.reset()),await s.moveToStorePromise,{createInState:s}}});await u().nT({analyticsFrom:"link_menu",createInState:s})}),[n,i]),a="text"===n.type?null===(t=(0,h().H7)(n.savedTextSelectionState.multiSelection))||void 0===t?void 0:t.store:void 0,p=a&&"block"===a.table?a.id:void 0;return(0,K.jsx)(ue().Ay,{targets:[],isAddTo:!0,isCreateIn:!0,onAccept:r,parentBlockId:p,onAutocompleteQueryChange:ge,autocompleteQuery:n.createInQuery||"",desktopWidth:xe,onCancel:ye})}function ge(e){const t=H().A.state;t.open&&H().A.setState({...t,createInQuery:e})}function ye(){const e=H().A.state;e.open&&H().A.setState({...e,showCreateIn:!1,createInQuery:""})}const xe=330}}]);