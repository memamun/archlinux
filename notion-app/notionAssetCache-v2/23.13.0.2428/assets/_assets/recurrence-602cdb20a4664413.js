"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[29021],{528411:(e,t,o)=>{o.r(t),o.d(t,{TemplateRecurrenceConfigMenu:()=>v});var n=o(296540),a=()=>o(484714),r=()=>o(406699),i=()=>o(104636),c=()=>o(401497),s=()=>o(643381),d=()=>o(959013),l=()=>o(496603),u=()=>o(493823),m=()=>o(553965),p=o(474848);function g(e){const{buttonPopupEvents:t,focused:n,tooltipLabel:r,recurrence:i,showTooltip:g,variant:v="dropdown"}=e,S=(0,a().v3)(),{device:A}=S,h=(0,c().DP)(),y=(0,d().tz)(),b=function(){const{isMobile:e}=(0,a().Y0)();return(0,c().IS)((t=>({iconStyle:{fill:t.regularIconColor,width:e?18:16}})),[e])}(),C=Boolean(i);return(0,p.jsx)(o(859428).A,{disableTooltip:!g,delayThreshold:300,renderTooltip:()=>r,render:e=>{switch(v){case"dropdown":return(0,p.jsx)(o(113474)._,{...(0,m().A)(e,t),focused:n,icon:(0,s().l)(b.iconStyle),title:(0,p.jsx)(d().sA,{defaultMessage:"Repeat",id:"database.templatePickerItem.actionMenu.repeat"}),showExtensionArrow:A.isMobile,right:f({isActive:C,recurrence:i,intl:y})});case"icon":return(0,p.jsx)(u().p,{...l().cJ((0,m().A)(e,t),["focused","ignoreLocalHoverState"]),disallowTabbing:!1,size:"sm",role:"button",children:(0,s().l)({color:o(100622).Ay.blue,width:14})});case"label":return(0,p.jsxs)(u().p,{...(0,m().A)(e,t),children:[f({isActive:C,recurrence:i,intl:y}),(0,o(668725).b)({fill:h.lightIconColor,marginLeft:4,width:10})]})}}})}function f(e){let{isActive:t,recurrence:o,intl:n}=e;return t?o?(0,p.jsx)(p.Fragment,{children:(0,l().ZH)((0,i().LS)({recurrence:o,intl:n}))}):void 0:(0,p.jsx)(d().sA,{defaultMessage:"Off",id:"database.templatePickerItem.recurrenceConfigMenuLabel.off"})}const v=(0,n.forwardRef)((function(e,t){const{recurrence:n,onChange:c,disabled:s,buttonPopupStore:d}=e,l=(0,a().v3)(),{device:u}=l,m=u.isMobile?r().z7.SlideUp:r().z7.Popup,f=(0,o(621627).$)({recurrence:e.recurrence,onChange:c,disabled:s,requireExplicitSaveAndAllowDelete:!0,buttonPopupStore:d});return(0,p.jsx)(o(811979).A,{...e,popupType:m,ref:t,stopClickPropagation:!0,buttonPopupStore:f.buttonPopupStore,disabled:!1,onClose:async()=>{f.hasUnpersistedChanges()&&!(await o(898125).lT({hasPendingChanges:!0}))||(f.onClose(),f.buttonPopupStore.setState({open:!1}))},persistOnClose:!0,renderOrigin:t=>(0,p.jsx)(g,{buttonPopupEvents:t,focused:e.focused,tooltipLabel:n&&(0,i()._b)(n.frequency),recurrence:e.recurrence,showTooltip:e.showTooltip,variant:e.variant}),render:f.render})}))},541181:(e,t,o)=>{o.d(t,{n:()=>r});var n=()=>o(645873);const a=new(n().O2)("react-day-picker",(async()=>await Promise.all([o.e(95555),o.e(75831),o.e(68548)]).then(o.bind(o,762290)))),r=(0,n()._h)(a,(e=>e.default))},573351:(e,t,o)=>{o.d(t,{A:()=>r});var n=o(296540),a=o(474848);const r=function(e){let{firstDayOfWeek:t,value:r,selectValue:i=!0,onChange:c,onFocus:s,onBlur:d,disabledDays:l,className:u}=e;const m=(0,n.useMemo)((()=>new Date(r)),[r]),[p,g]=(0,n.useState)(m),f=(0,n.useRef)(r);(0,n.useLayoutEffect)((()=>{f.current!==r&&(g(new Date(r)),f.current=r)}),[r]);const v=(0,n.useCallback)(((e,t,o)=>{c(e.getTime())}),[c]);return(0,a.jsx)("div",{style:{paddingRight:8,paddingBottom:8,paddingLeft:8,paddingTop:4},children:(0,a.jsx)(o(541181).n,{locale:o(662303).locale,className:u??"notion-calendar-picker",numberOfMonths:1,weekStartsOn:t,modifiers:i?{value:m}:{},showOutsideDays:!0,fixedWeeks:!0,onDayClick:v,onMonthSelected:g,disabled:l,month:p,onDayBlur:d,onDayFocus:s})})}},643381:(e,t,o)=>{o.d(t,{l:()=>a});o(296540);var n=o(474848);const a=(0,o(340498).wt)("repeat",{viewBox:"0 0 16 14",svg:(0,n.jsx)("path",{d:"M1.185 7.317a.689.689 0 00.697-.704v-.601c0-1.19.806-1.942 2.064-1.942H9.23v1.573c0 .328.199.52.527.52a.66.66 0 00.403-.144l2.68-2.236c.253-.212.26-.547 0-.765L10.16.782A.62.62 0 009.757.64c-.328 0-.527.184-.527.52v1.53H4.05C1.875 2.69.48 3.9.48 5.875v.738c0 .397.308.704.705.704zm13.624-.649a.689.689 0 00-.698.704v.608c0 1.19-.806 1.942-2.064 1.942H6.763V8.35c0-.329-.199-.52-.527-.52a.66.66 0 00-.403.144l-2.68 2.242c-.26.212-.26.547 0 .759l2.68 2.242a.66.66 0 00.403.143c.328 0 .527-.191.527-.52v-1.544h5.181c2.174 0 3.569-1.21 3.569-3.179v-.745a.695.695 0 00-.704-.704z"})})},839916:(e,t,o)=>{o.r(t),o.d(t,{addRecurrence:()=>S,createRecurrenceInner:()=>h,deleteRecurrence:()=>A});var n=()=>o(390527),a=()=>o(206267),r=()=>o(912720),i=()=>o(199378),c=()=>o(519831),s=()=>o(534177),d=()=>o(896628),l=()=>o(246826),u=()=>o(317909),m=()=>o(989423),p=()=>o(594794),g=()=>o(351360),f=()=>o(630116),v=()=>o(324587);function S(e){let{environment:t,blockStore:o,recurrence:a}=e;const s=o.getAutomationId(),d=(0,n().convertFromUnpersistedRecurrenceConfig)(a);s?function(e,t,o,n){const a=o.getParentStore();if(!a||a.table!==c().Vl)return;const s=o.getSpaceId(),d={table:r().yB,id:t,spaceId:s},m=f().dn.createChildStore(o,d),g=m.getTrigger();if(!g)return;const v=m.getActionStores()[0];u().createAndCommit({environment:e,userAction:"recurrenceActions.updateRecurrence",canUndo:!0,perform:t=>{const r=y({automationId:m.id,spaceId:s,collectionPointer:a.getSpaceShardedPointer(),templatePageId:o.id});let c;v?(c=v.id,l().zv({store:v,data:r,transaction:t})):(c=(0,p().Z1)({environment:e,table:i().SC,spaceId:s}),l().eC({environment:e,table:i().SC,inMemoryRecordCache:m.inMemoryRecordCache,transaction:t,value:{id:c,...r}})),l().zv({store:m,data:{alive:!0,status:"active",trigger:{id:g.id,type:"recurrence",recurrence:n},action_ids:[c]},transaction:t})}}),b(e,{type:"updated",frequency:n.frequency})}(t,s,o,d):function(e,t,o){u().createAndCommit({environment:e,userAction:"recurrenceActions.createRecurrence",canUndo:!0,perform:n=>{h(n,e,t,o)}})}(t,o,d)}function A(e){let{environment:t,blockStore:o}=e;const n=o.getAutomationStore();(0,s().O9)(n)&&(u().createAndCommit({environment:t,userAction:"recurrenceActions.deleteRecurrence",canUndo:!0,perform:e=>{v().disableAutomation({automationStore:n,environment:t,transaction:e}),v().deleteAutomation({automationStore:n,environment:t,transaction:e}),d().zA({stores:[o],update:{automation_id:void 0},transaction:e})}}),b(t,{type:"deleted"}))}function h(e,t,o,n){const{currentUserRootStore:s}=g().default.state;if(!s)return;const u=o.getParentStore();if(!u||u.table!==c().Vl)return;if(!u.getParentBlockStore())return;const m=o.getSpaceId(),f=(0,p().Z1)({environment:t,table:i().SC,spaceId:m}),v=l().eC({environment:t,table:r().yB,inMemoryRecordCache:o.inMemoryRecordCache,value:{parent_id:o.id,parent_table:o.table,alive:!0,space_id:m,status:"active",trigger:{id:a().JW(),type:"recurrence",recurrence:n},action_ids:[f]},transaction:e}).pointer.id;d().zA({stores:[o],update:{automation_id:v},transaction:e}),l().eC({environment:t,table:i().SC,inMemoryRecordCache:o.inMemoryRecordCache,transaction:e,value:{id:f,...y({automationId:v,spaceId:m,collectionPointer:u.getSpaceShardedPointer(),templatePageId:o.id})}}),b(t,{type:"created",frequency:n.frequency})}function y(e){const{automationId:t,spaceId:o,collectionPointer:n,templatePageId:a}=e;return{parent_id:t,parent_table:r().yB,type:"create_page",alive:!0,space_id:o,config:{collection:n,template_page_id:a}}}function b(e,t){m().vd(e,"recurrence_saved",t)}},898125:(e,t,o)=>{o.d(t,{HJ:()=>I,WA:()=>_,be:()=>w,bx:()=>R,kU:()=>T,lT:()=>x,lg:()=>D,nO:()=>M,vH:()=>P});o(16280),o(944114);var n=()=>o(890409),a=()=>o(735384),r=()=>o(206267),i=()=>o(912720),c=()=>o(973647),s=()=>o(534177),d=()=>o(901389),l=()=>o(246826),u=()=>o(317909),m=()=>o(324587),p=()=>o(546461),g=()=>o(301782),f=()=>o(989423),v=()=>o(909470),S=()=>o(698331),A=()=>o(594794),h=()=>o(972435),y=()=>o(508496),b=()=>o(630116);const C=(0,o(959013).YK)({automationDeleteConfirmationMessage:{id:"slackAutomations.remove.confirmation.message",defaultMessage:"Delete {automationName}?"},automationDeleteAcceptLabel:{id:"slackAutomations.remove.confirmation.acceptLabel",defaultMessage:"Delete"},confirmDiscardChangesMessage:{id:"automations.confirmDiscardChanges.message",defaultMessage:"Discard unsaved changes to this automation?"},confirmDiscardChangesAccept:{defaultMessage:"Discard",id:"automations.confirmDiscardChanges.acceptLabel"},confirmDiscardOptionalFieldChangesMessage:{id:"automations.confirmDiscardToggleFieldChangesMessage.message",defaultMessage:"{hasName, select, true {Discard {fieldName} field?} other {Discard field?}}"}});function M(e){const{automationStore:t,collectionStore:o,environment:a,intl:d,from:S,builderType:A}=e;u().createAndCommit({environment:a,userAction:"collectionSettingsAutomationsActions.createDatabaseAutomation",canUndo:!0,perform:e=>{u().applyOperation({store:o,operation:{pointer:o.pointer,path:["format","automation_ids"],command:"listAfter",args:{id:t.id}},transaction:e});const n=b().dn.createChildStore(o,t.pointer),c=t.getActionStores();for(const t of c){const o=t.getType();o&&m().addAutomationAction({actionId:t.id,actionType:o,automationStore:n,config:t.getConfig(),environment:a,intl:d,transaction:e})}let p;const g=t.getTrigger();(0,s().O9)(g)&&"event"!==g.type?"recurrence"===g.type?p={id:r().JW(),type:"recurrence",recurrence:g.recurrence}:(0,s().HB)(g):p={id:r().JW(),type:"event",event:(null==g?void 0:g.event)??{pagesAdded:!1,pagePropertiesEdited:{type:"none"},source:{pointer:o.getSpaceShardedPointer(),type:"collection"}}},l().eC({environment:a,inMemoryRecordCache:o.inMemoryRecordCache,table:i().yB,transaction:e,value:{action_ids:t.getActionIds(),alive:!0,id:t.id,parent_id:o.id,parent_table:o.table,properties:{name:t.getName()},space_id:o.getSpaceId(),status:"active",trigger:p}})}});const h=t.getModel();if((0,s().O9)(h)){const e=(0,p().To)(t);let o=[];e&&c().Q.isSuccess(e)&&(o=e.value.valueTypes),(0,g().CM)(((e,r,i)=>{const c=(0,f().ik)(a),s=n().sp({automationModel:h,builderType:A,formulaAnalyticsModule:r,formulasModule:e,formulaTypecheckContextValues:o,getRecordModel:t.getRecordModel,featureGates:(0,v().i)(),simpleFormulasModule:i}),d=S?{feature:{id:s.automation_id,from:S,type:"automation"}}:{};n().Dk(c,{...s,...d}),y().default.logEvent("automation_create")}))}}function T(e){const{automationStore:t,collectionStore:o,environment:a,builderType:r,source:i}=e;u().createAndCommit({environment:a,userAction:"collectionSettingsAutomationsActions.saveDatabaseAutomation",canUndo:!0,perform:e=>{const n=b().dn.createChildStore(o,t.pointer),a=t.getName(),r=n.getKeyStore("properties");l().zv({store:r,data:{name:a},transaction:e}),t.getStatus()!==n.getStatus()&&l().zv({store:n,data:{status:t.getStatus()},transaction:e});const i=t.getActionStores();if((0,S().$X)(n)&&(0,S().$X)(t))if(t.isTriggerType("event"))n.isTriggerType("event")||l().zv({store:n.getTriggerStore(),data:{type:"event"},transaction:e}),n.verifyTriggerType("event"),l().zv({store:n.getTriggerStore().getKeyStore("event"),data:t.getTriggerStore().getKeyStore("event").getValue(),transaction:e});else{if(!t.isTriggerType("recurrence"))throw new Error("Unexpected trigger type for automationStore");n.isTriggerType("recurrence")||l().zv({store:n.getTriggerStore(),data:{type:"recurrence"},transaction:e}),n.verifyTriggerType("recurrence"),l().zv({store:n.getTriggerStore().getKeyStore("recurrence"),data:t.getTriggerStore().getKeyStore("recurrence").getValue(),transaction:e})}const c=[];for(const t of i){const o=t.getModel();if(!o)continue;const a=b().bx.createChildStore(n,t.pointer);l().KY({store:a,value:{alive:!0,config:o.getConfig(),id:o.id,parent_id:n.id,parent_table:n.table,space_id:n.getSpaceId(),type:o.type},transaction:e}),c.push(t.id)}l().zv({store:n,data:{action_ids:c},transaction:e})}});const d=t.getModel();(0,s().O9)(d)&&(0,g().CM)(((e,o,s)=>{const l=(0,p().To)(t);let u=[];l&&c().Q.isSuccess(l)&&(u=l.value.valueTypes);const m=(0,f().ik)(a),g=n().sp({automationModel:d,builderType:r,formulaAnalyticsModule:o,formulasModule:e,formulaTypecheckContextValues:u,getRecordModel:t.getRecordModel,featureGates:(0,v().i)(),simpleFormulasModule:s,source:i});n().SF(m,g),y().default.logEvent("automation_update")}))}async function D(e){const{intl:t,environment:o,collectionStore:n,existingAutomationStore:a,onDelete:r}=e,i=a.getNameWithDefault(t);(await d().Gh({message:t.formatMessage(C.automationDeleteConfirmationMessage,{automationName:i}),acceptLabel:t.formatMessage(C.automationDeleteAcceptLabel)})).accept&&(!function(e){const{environment:t,collectionStore:o,existingAutomationStore:n}=e;u().createAndCommit({environment:t,userAction:"collectionSettingsAutomationsActions.deleteAutomation",canUndo:!0,perform:e=>{const a=o.getFormatStore().getKeyStore("automation_ids"),r=b().dn.createChildStore(o,n.pointer);u().applyOperation({store:a,operation:{pointer:a.pointer,path:a.path,command:"listRemove",args:{id:r.id}},transaction:e}),m().deleteAutomation({automationStore:r,environment:t,transaction:e})}})}({environment:o,collectionStore:n,existingAutomationStore:a}),null==r||r())}function _(e){const{automationStore:t,environment:o}=e;u().createAndCommit({environment:o,userAction:"collectionSettingsAutomationsActions.disableAutomation",canUndo:!0,perform:e=>{m().disableAutomation({automationStore:t,environment:o,transaction:e})}})}function w(e){const{automationStore:t,collectionStore:o,environment:n}=e;u().createAndCommit({canUndo:!0,environment:n,userAction:"collectionSettingsAutomationsActions.restartAutomation",perform:e=>{const n=b().dn.createChildStore(o,t.pointer);m().restartAutomation({automationStore:n,transaction:e})}})}function I(e){const{automationStore:t,environment:o}=e;u().createAndCommit({environment:o,userAction:"collectionSettingsAutomationsActions.enableAutomation",canUndo:!0,perform:e=>{m().enableAutomation({automationStore:t,environment:o,transaction:e})}})}function P(e){const{automationStore:t,collectionStore:o,environment:n}=e,a=o.getFormatStore().getKeyStore("automation_ids"),r=(0,A().Z1)({environment:n,table:i().yB,spaceId:t.getSpaceId()});u().createAndCommit({environment:n,userAction:"",canUndo:!0,perform:e=>{m().duplicateAutomation({environment:n,sourceAutomationStore:t,targetAutomationId:r,transaction:e}),u().applyOperation({store:a,operation:{pointer:a.pointer,path:a.path,command:"listAfter",args:{id:r}},transaction:e})}})}async function x(e){const{hasPendingChanges:t}=e;if(!t)return!0;return(await d().Gh({acceptLabel:h().A.formatMessage(C.confirmDiscardChangesAccept),message:h().A.formatMessage(C.confirmDiscardChangesMessage),icon:(0,a().I)({height:24,width:24})})).accept}async function R(e){const{fieldName:t}=e;return(await d().Gh({acceptLabel:h().A.formatMessage(C.confirmDiscardChangesAccept),message:h().A.formatMessage(C.confirmDiscardOptionalFieldChangesMessage,{fieldName:t,hasName:Boolean(t)}),icon:(0,a().I)({height:24,width:24})})).accept}}}]);