"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[77169],{158751:(e,t,n)=>{n.d(t,{C0:()=>u,P8:()=>p,B7:()=>f,iI:()=>v,M:()=>m,_I:()=>g});var a=()=>n(392998),r=()=>n(10123),o=()=>n(851775),i=()=>n(194188),d=()=>n(570551);function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}var s=()=>n(534177),l=()=>n(351360);const u="three_days";function v(){const e=g();return{key:e,...f(e)}}function m(){const e="one_week";return{key:e,...f(e)}}function f(e){const t=Date.now(),n=(0,a().A)(function(e,t){if((0,d().A)(2,arguments),"object"!==c(t)||null===t)throw new RangeError("values parameter must be an object");var n=(0,r().A)(e);return isNaN(n.getTime())?new Date(NaN):(null!=t.year&&n.setFullYear(t.year),null!=t.month&&(n=(0,o().A)(n,t.month)),null!=t.date&&n.setDate((0,i().A)(t.date)),null!=t.hours&&n.setHours((0,i().A)(t.hours)),null!=t.minutes&&n.setMinutes((0,i().A)(t.minutes)),null!=t.seconds&&n.setSeconds((0,i().A)(t.seconds)),null!=t.milliseconds&&n.setMilliseconds((0,i().A)(t.milliseconds)),n)}(t,{hours:23,minutes:59,seconds:59,milliseconds:999}),p(e)-1);return{timeMin:t,timeMax:n.getTime()}}function p(e){switch(e){case"one_day":return 1;case"two_days":return 2;case"three_days":return 3;case"one_week":return 7;default:(0,s().HB)(e)}}function g(){var e;const t=null===(e=l().default.state.currentSpaceViewStore)||void 0===e||null===(e=e.getHomeCalendarConfigStore())||void 0===e||null===(e=e.getKeyStore("time_range"))||void 0===e?void 0:e.getValue();switch(t){case"one_day":case"two_days":case"three_days":case"one_week":return t;case void 0:return u;default:return(0,s().ub)(t),u}}},185984:(e,t,n)=>{n.d(t,{E:()=>o,J:()=>i});var a=()=>n(351360);const r={all_day_events:!0,events_without_participants:!0,events_without_location:!0};function o(e){const{currentSpaceViewStore:t}=a().default.state;return(null==t?void 0:t.getHomeCalendarFilter(e))??r[e]}function i(e){let{event:t,eventFilters:n}=e;return(!1!==n.all_day_events||!t.isAllDay)&&(!(!1===n.events_without_participants&&!t.hasParticipants)&&!(!1===n.events_without_location&&!t.hasConferencingOrLocation))}},307750:(e,t,n)=>{n.d(t,{Om:()=>V,g2:()=>C,FC:()=>A,$z:()=>b,IC:()=>g});n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(354520),n(581454);var a=()=>n(244641),r=()=>n(465474),o=()=>n(857639),i=()=>n(496603),d=()=>n(534177),c=()=>n(569243),s=()=>n(185984),l=()=>n(812109),u=()=>n(10123),v=()=>n(570551);var m=()=>n(823115);function f(e){let{aCalendar:t,aEvent:n,aStartTimeOverride:a,bCalendar:r,bEvent:o,bStartTimeOverride:i}=e,d=a,c=i;if(!d&&n.start&&(d=p(n)),!c&&o.start&&(c=p(o)),!d)return 1;if(!c)return-1;let s=function(e,t){(0,v().A)(2,arguments);var n=(0,u().A)(e),a=(0,u().A)(t),r=n.getTime()-a.getTime();return r<0?-1:r>0?1:r}(d.toMillis(),c.toMillis());if(0===s){var l,m;const e=Boolean(null==t?void 0:t.primary),a=Boolean(null==r?void 0:r.primary),i=Boolean(null===(l=n.conferencing)||void 0===l?void 0:l.providerName),d=Boolean(n.hasParticipants),c=i&&d,u=Boolean(null===(m=o.conferencing)||void 0===m?void 0:m.providerName),v=Boolean(o.hasParticipants),f=u&&v,p="accepted"===n.responseStatus,g="accepted"===o.responseStatus,S="needsAction"===n.responseStatus,h="needsAction"===o.responseStatus,I="tentative"===n.responseStatus,b="tentative"===o.responseStatus;e&&!a?s=-1:a&&!e?s=1:c&&!f?s=-1:f&&!c?s=1:i&&!u?s=-1:u&&!i?s=1:d&&!v?s=-1:v&&!d?s=1:p&&!g?s=-1:g&&!p?s=1:!S||g||h?!h||p||S?I&&!(g||h||b)?s=-1:b&&!(p||S||I)&&(s=1):s=1:s=-1}return s}function p(e){if(e.isAllDay){const{date:t}=e.start;return(0,m().V$)(t,"UTC")}{const{dateTime:t}=e.start;return a().c9.fromISO(t,{zone:"UTC"})}}function g(e){let{botId:t,accounts:n,calendars:a,events:o,timeMin:i,timeMax:d}=e;const c=new(r().A)(a.map(S),l().N);return{botId:t,accounts:new(r().A)(n,(e=>e.id)),calendars:c,events:new(r().A)(h(o).sort(y(c)),l().z),timeMin:i,timeMax:d}}function S(e){return{...e,color:(0,c().Pf)({color:e.color,colorId:e.colorId,colorType:"calendar"}),colorId:void 0,primary:e.primary}}function h(e){return e.map((e=>function(e){var t,n,r,i,d,s;let l;const u=I(null===(t=e.start)||void 0===t?void 0:t.timeZone),v=I(null===(n=e.end)||void 0===n?void 0:n.timeZone),f=(null===(r=e.start)||void 0===r?void 0:r.date)??(null===(i=e.start)||void 0===i?void 0:i.dateTime)??void 0,p=(null===(d=e.end)||void 0===d?void 0:d.date)??(null===(s=e.end)||void 0===s?void 0:s.dateTime)??void 0;if(!f||!p)return;const g=()=>{o().log({level:"error",from:"toHydratedEvent",type:"invalidDate",data:{miscDataToConvertToString:{accountId:e.accountId,calendarId:e.calendarId,eventId:e.id,start:f,end:p}}})};if(e.isAllDay){let e,t;try{e=(0,m().J_)(f,u||"UTC"),t=(0,m().J_)(p,u||"UTC")}catch(S){return void g()}l={isAllDay:!0,start:{date:e},end:{date:t}}}else{const e=a().c9.fromISO(f,{zone:u}),t=a().c9.fromISO(p,{zone:v});if(!e.isValid||!t.isValid)return void g();l={isAllDay:!1,start:{dateTime:f,timeZone:u},end:{dateTime:p,timeZone:v}}}return{...e,...l,color:(0,c().Pf)({colorId:e.colorId,colorType:"event"})}}(e))).filter(d().O9)}function I(e){if(e)return a().R2.normalizeZone(e).isValid?e:void 0}function b(e){let{events:t,updatedCalendarAndAccountIds:n,newEvents:a,calendars:o}=e;const i=new Set(n.map(l().N)),d=function(e,t,n){const a=[];let r=0,o=0;for(;r<e.length&&o<t.length;){n(e[r],t[o])<=0?(a.push(e[r]),r++):(a.push(t[o]),o++)}r<e.length?a.push(...e.slice(r)):o<t.length&&a.push(...t.slice(o));return a}(t.getOrderedValues().filter((e=>!i.has((0,l().N)(e)))),[...a].sort(y(o)),y(o));return new(r().A)(d,l().z)}function y(e){const t=t=>e.get((0,l().N)(t));return(e,n)=>f({aEvent:e,bEvent:n,aCalendar:t(e),bCalendar:t(n)})}function _(e,t){return(0,m().V$)(e,t).minus({days:1}).toISODate()}function C(e){let{events:t,getCalendarVisibility:n,calendars:a,startDate:o,endDateInclusive:d,eventFilters:c,timeZone:s}=e;const u=o.toISODate(),v=d.toISODate(),f=new(r().A)([],(e=>{let{baseEvent:t}=e;return t.id}));for(const r of t){const e=null==a?void 0:a.get((0,l().N)(r));if(!e||!n(e)||!w({event:r,minDate:u,maxDateInclusive:v,eventFilters:c,timeZone:s}))continue;const t=f.get(r.id);if(t)t.allSquashedEvents=(0,i().hS)([...t.allSquashedEvents,r],(e=>(0,l().z)(e)));else if(r.cronSyncOriginalEventData){const e=r.cronSyncOriginalEventData.eventId,t=f.get(e);t&&(t.allSquashedEvents=(0,i().hS)([...t.allSquashedEvents,r],l().z))}else f.append(r.id,{baseEvent:r,allSquashedEvents:[r]})}const p=new(r().A)((0,m().$D)(u,v,s).map((e=>({date:e,allDayEvents:[],timedEvents:[]}))),(e=>{let{date:t}=e;return t}));for(const{baseEvent:r,allSquashedEvents:i}of f.getOrderedValues())if(r.isAllDay){const e=(0,m().RY)({eventStartDate:r.start.date,eventEndDateInclusive:_(r.end.date,s),minDate:u,maxDateInclusive:v,timeZone:s});for(const t of e){const e=p.get(t);e&&e.allDayEvents.push({baseEvent:r,allSquashedEvents:i})}}else{const e=(0,m().J_)(r.start.dateTime,s),t=p.get(e);if(!t)continue;t.timedEvents.push({baseEvent:r,allSquashedEvents:i})}return p.getOrderedValues()}function w(e){let{event:t,minDate:n,maxDateInclusive:a,eventFilters:r,timeZone:o}=e;if(function(e){switch(e.responseStatus){case"declined":return!0;case"needsAction":case"tentative":case"accepted":case void 0:return!1;default:(0,d().HB)(e.responseStatus)}}(t))return!1;if(!(0,s().J)({event:t,eventFilters:r}))return!1;const{start:i,end:c}=function(e,t){return e.isAllDay?{start:e.start.date,end:_(e.end.date,t)}:{start:(0,m().J_)(e.start.dateTime,t),end:(0,m().J_)(e.end.dateTime,t)}}(t,o);return!(i>a||c<n)&&(0,s().J)({event:t,eventFilters:r})}function V(e){return[...e.allDayEvents,...e.timedEvents]}function A(e,t,n){return function(e,t){const n=e.isAllDay?e.end.date:e.end.dateTime;return a().c9.fromISO(n,{zone:t})}(e,n)<t}},377515:(e,t,n)=>{n.d(t,{AU:()=>s,GF:()=>d,NU:()=>u,Pj:()=>c,Xg:()=>m,cL:()=>l});n(944114),n(898992),n(430670),n(737550);var a=()=>n(496603),r=()=>n(534177),o=()=>n(379560),i=()=>n(812109);function d(e){const t=function(e){let{botId:t,currentSpaceViewStore:n}=e;const a=o().A.getCurrentCalendars()??[],r={};for(const o of a)r[(0,i().N)(o)]={calendarId:o.id,accountId:o.accountId,visible:c({spaceViewStore:n,botId:t,calendar:o})};return r}(e);return Object.values(t).flatMap((e=>{let{calendarId:t,accountId:n,visible:a}=e;return a?[{calendarId:t,accountId:n}]:[]}))}function c(e){let{spaceViewStore:t,botId:n,calendar:a}=e;return function(e){var t;let{spaceViewStore:n,botId:a,calendarId:r,accountId:o}=e;const i=null==n?void 0:n.getHomeCalendarVisibilityConfig(a);if(!i||m({spaceViewStore:n,botId:a}))return;return null===(t=i.calendarVisibility)||void 0===t||null===(t=t[o])||void 0===t?void 0:t[r]}({spaceViewStore:t,botId:n,calendarId:a.id,accountId:a.accountId})??a.selected}function s(e){let{spaceViewStore:t,botId:n,specificCalendars:a}=e;const o=t.getHomeCalendarVisibilityConfig(n);if(!o||!(0,r().O9)(null==o?void 0:o.calendarVisibility)||m({spaceViewStore:t,botId:n}))return{type:"mirrorWithCron"};const i=[];for(const[d,c]of(0,r().WP)(o.calendarVisibility??{}))for(const[e,t]of(0,r().WP)(c??{}))!(0,r().O9)(t)||a&&!a.some((t=>t.accountId===d&&t.calendarId===e))||i.push({accountId:d,calendarId:e,visible:t});return{type:"calendarOverrides",calendarOverrides:i}}function l(e){const t={};for(const{id:n,accountId:a,selected:r}of e)t[a]={...t[a],[n]:r};return t}function u(e){let{currentConfig:t,calendars:n}=e;const r=(0,a().mg)(t)??{};let o=!1;for(const{id:a,accountId:d,selected:c}of n){var i;void 0===(null===(i=r[d])||void 0===i?void 0:i[a])&&(r[d]={...r[d],[a]:c},o=!0)}return o?{result:"updated",newConfig:r}:{result:"noChanges"}}const v=!0;function m(e){let{spaceViewStore:t,botId:n}=e;if(!t||!n)return v;const a=t.getHomeCalendarVisibilityConfig(n);return(null==a?void 0:a.mirrorWithNotionCalendar)??v}},379560:(e,t,n)=>{n.d(t,{A:()=>i});n(898992),n(354520),n(581454);var a=()=>n(351360);class r extends(()=>n(757695))().default{getInitialState(){return{}}getCalendarMap(){var e;return null===(e=this.getStateForCurrentSpaceView())||void 0===e?void 0:e.calendars}getEvents(){var e;const t=null===(e=this.getStateForCurrentSpaceView())||void 0===e?void 0:e.events;return t?t.getOrderedValues():[]}getCalendarAndAccountIds(){const e=this.getCalendarMap();return e?e.getOrderedValues().map((e=>{let{id:t,accountId:n}=e;return{calendarId:t,accountId:n}})):[]}getStateForCurrentSpaceView(){const{currentSpaceViewStore:e}=a().default.state;if(e)return this.state[e.id]}update(e){super.update(e)}updateStateForCurrentSpaceView(e){const{currentSpaceViewStore:t}=a().default.state;t&&this.update((n=>({...n,[t.id]:e(n[t.id])})))}clearStateForCurrentSpaceView(){const{currentSpaceViewStore:e}=a().default.state;e&&this.update((t=>Object.fromEntries(Object.entries(t).filter((t=>{let[n]=t;return n!==e.id})))))}getCurrentCalendars(){var e;return null===(e=this.getStateForCurrentSpaceView())||void 0===e||null===(e=e.calendars)||void 0===e?void 0:e.getOrderedValues()}getAccount(e){var t;return null===(t=this.getStateForCurrentSpaceView())||void 0===t||null===(t=t.accounts)||void 0===t?void 0:t.get(e)}getCalendar(e){var t;return null===(t=this.getStateForCurrentSpaceView())||void 0===t||null===(t=t.calendars)||void 0===t?void 0:t.get("string"==typeof e?e:`${e.accountId}:${e.calendarId}`)}getCalendarsForAccount(e){var t;return(null===(t=this.getStateForCurrentSpaceView())||void 0===t||null===(t=t.calendars)||void 0===t?void 0:t.getOrderedValues().filter((t=>t.accountId===e)))??[]}getCurrentAccountIds(){var e;return(null===(e=this.getStateForCurrentSpaceView())||void 0===e||null===(e=e.accounts)||void 0===e?void 0:e.getOrderedValues().map((e=>e.id)))??[]}getCalendarFetchedTime(e){var t;const n="string"==typeof e?e:`${e.accountId}:${e.calendarId}`;return null===(t=this.getStateForCurrentSpaceView())||void 0===t?void 0:t.calendarsToLastFetchedTime[n]}}const o=new r;(0,n(604341).exposeDebugValue)("HomeCalendarStore",o);const i=o},465474:(e,t,n)=>{n.d(t,{A:()=>a});n(16280),n(944114),n(898992),n(354520),n(581454);class a{get length(){return this.orderedKeys.length}constructor(e,t){if(this.orderedKeys=void 0,this.keysToValues=void 0,!e&&!t)return this.orderedKeys=[],void(this.keysToValues={});if(!e||!t)throw new Error("Missing values or keyGetter in OrderedMap constructor");this.orderedKeys=e.map(t),this.keysToValues={};for(const n of e)this.keysToValues[t(n)]=n}append(e,t){let{keepOrdering:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{keepOrdering:!1};if(e in this.keysToValues){if(this.keysToValues[e]=t,n)return;this.orderedKeys=[...this.orderedKeys.filter((t=>t!==e)),e]}else this.orderedKeys.push(e),this.keysToValues[e]=t}delete(e){this.orderedKeys=this.orderedKeys.filter((t=>t!==e)),delete this.keysToValues[e]}get(e){return this.keysToValues[e]}getOrderedValues(){return this.orderedKeys.map((e=>this.keysToValues[e]))}hasKey(e){return e in this.keysToValues}toJSON(){return this.orderedKeys.map((e=>[e,this.keysToValues[e]]))}static fromJSON(e){const t=new a;return t.orderedKeys=e.map((e=>{let[t]=e;return t})),t.keysToValues=Object.fromEntries(e),t}}},569243:(e,t,n)=>{n.d(t,{Pf:()=>s,QL:()=>d,Sk:()=>c});var a=()=>n(534177);const r={1:e=>e.calendarHomeWidget.base.orange,2:e=>e.calendarHomeWidget.base.red,3:e=>e.calendarHomeWidget.base.red,4:e=>e.calendarHomeWidget.base.orange,5:e=>e.calendarHomeWidget.base.orange,6:e=>e.calendarHomeWidget.base.orange,7:e=>e.calendarHomeWidget.base.green,8:e=>e.calendarHomeWidget.base.green,9:e=>e.calendarHomeWidget.base.green,10:e=>e.calendarHomeWidget.base.green,11:e=>e.calendarHomeWidget.base.yellow,12:e=>e.calendarHomeWidget.base.yellow,13:e=>e.calendarHomeWidget.base.green,14:e=>e.calendarHomeWidget.base.blue,15:e=>e.calendarHomeWidget.base.blue,16:e=>e.calendarHomeWidget.base.blue,17:e=>e.calendarHomeWidget.base.purple,18:e=>e.calendarHomeWidget.base.purple,19:e=>e.calendarHomeWidget.base.gray,20:e=>e.calendarHomeWidget.base.gray,21:e=>e.calendarHomeWidget.base.pink,22:e=>e.calendarHomeWidget.base.pink,23:e=>e.calendarHomeWidget.base.purple,24:e=>e.calendarHomeWidget.base.purple},o={1:e=>e.calendarHomeWidget.base.purple,2:e=>e.calendarHomeWidget.base.green,3:e=>e.calendarHomeWidget.base.pink,4:e=>e.calendarHomeWidget.base.red,5:e=>e.calendarHomeWidget.base.yellow,6:e=>e.calendarHomeWidget.base.orange,7:e=>e.calendarHomeWidget.base.blue,8:e=>e.calendarHomeWidget.base.gray,9:e=>e.calendarHomeWidget.base.blue,10:e=>e.calendarHomeWidget.base.green,11:e=>e.calendarHomeWidget.base.red};function i(e){let{theme:t,color:n}=e;if("preset"===n.type){var i,d;if("calendar"===n.colorType)return null===(i=r[n.colorId])||void 0===i?void 0:i.call(r,t);if("event"===n.colorType)return null===(d=o[n.colorId])||void 0===d?void 0:d.call(o,t);(0,a().ub)(n)}var c;if("custom"===n.type)return null===(c=n.colorHexes)||void 0===c?void 0:c[t.mode].backgroundPrimary;(0,a().ub)(n)}function d(e){let{theme:t,calendarColor:n}=e;const a=n&&i({theme:t,color:n});return a||t.calendarHomeWidget.base.blue}function c(e){let{theme:t,eventColor:n,calendarColor:a}=e;const r=n&&i({theme:t,color:n});return r||d({theme:t,calendarColor:a})}function s(e){const{colorType:t,color:n,colorId:a}=e;return a?{type:"preset",colorId:a,colorType:t}:n?{type:"custom",colorHexes:n}:void 0}},573985:(e,t,n)=>{n.d(t,{rq:()=>k,w1:()=>M,k2:()=>x,F8:()=>U,qq:()=>H,tD:()=>E,m5:()=>P,X6:()=>O,Kq:()=>F,X8:()=>N,vA:()=>W});n(898992),n(354520),n(672577);var a=()=>n(244641),r=()=>n(465474),o=()=>n(496603),i=()=>n(534177),d=()=>n(449506),c=()=>n(246826),s=()=>n(317909),l=()=>n(767525),u=()=>n(583238),v=()=>n(406792),m=()=>n(351360),f=()=>n(508496),p=()=>n(185984),g=()=>n(307750),S=(n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(823215),n(581454),()=>n(379560)),h=()=>n(812109);function I(e){return e.every((e=>{let{calendarId:t,accountId:n}=e;return S().A.getCalendarFetchedTime({calendarId:t,accountId:n})}))}function b(e){let{oldMap:t,newMap:n,keyGetter:a}=e;const o=new(r().A)(t.getOrderedValues(),a);for(const r of(null==n?void 0:n.getOrderedValues())??[]){const e=a(r);o.append(e,r,{keepOrdering:!0})}return o}var y=()=>n(158751),_=()=>n(638681);const C=_().object({required:{botId:_().uuid(),timeMin:_().number(),timeMax:_().number(),accounts:_().array(_().tuple([_().string(),_().object({required:{},optional:{}})])),calendars:_().array(_().tuple([_().string(),_().object({required:{},optional:{}})])),events:_().array(_().tuple([_().string(),_().object({required:{},optional:{}})])),calendarsToLastFetchedTime:_().record(_().string(),_().number())},optional:{}});const w=new class{constructor(){this.localStorageStore=new(n(419494).Ay)({namespace:"homeCalendarCache",important:!1,trackingType:"preference",maxValueLength:512e3})}get(e){let t;try{t=this.localStorageStore.get(e)}catch{}if(t&&null===C.validator(t))return function(e){return{...e,accounts:r().A.fromJSON(e.accounts),calendars:r().A.fromJSON(e.calendars),events:r().A.fromJSON(e.events),calendarsToLastFetchedTime:Object.fromEntries(Object.entries(e.calendarsToLastFetchedTime).map((e=>{let[t,n]=e;return[t,a().c9.fromMillis(n)]})))}}(t);this.localStorageStore.remove(e)}set(e,t){try{this.localStorageStore.set(e,(n=t,{...n,accounts:n.accounts.toJSON(),calendars:n.calendars.toJSON(),events:n.events.toJSON(),calendarsToLastFetchedTime:Object.fromEntries(Object.entries(n.calendarsToLastFetchedTime).map((e=>{let[t,n]=e;return[t,n.toMillis()]})))}))}catch{}var n}remove(e){this.localStorageStore.remove(e)}};var V=()=>n(689950),A=()=>n(377515);class T{constructor(e,t,n,a){this.pendingInvocations=new Map,this.fn=e,this.coalesce=t,this.waitMs=n,this.options=a}enqueue(e){for(const[n,a]of this.pendingInvocations){const t=this.coalesce(n,e);if(t)return this.pendingInvocations.delete(n),this.pendingInvocations.set(t,a),void a.dequeueDebounced(t)}const t=(0,o().sg)(this.dequeue.bind(this),this.waitMs,this.options);this.pendingInvocations.set(e,{dequeueDebounced:t}),t(e)}dequeue(e){this.pendingInvocations.delete(e),this.fn.apply(null,e)}}function M(e){let{environment:t,timeRange:n,panelState:a}=e;const{currentSpaceViewStore:r}=m().default.state;if(!r)return;const o=r.getHomeCalendarConfigStore().getKeyStore("time_range");s().createAndCommit({userAction:"homeCalendarActions.changeUpcomingEventsTimeRange",environment:t,canUndo:!0,perform:e=>{c().KY({transaction:e,store:o,value:n})}}),(0,V().rP)({environment:t,calendarPanelContext:(0,V().sp)(a),newValue:n})}function O(e){var t;let{environment:n,filter:a,panelState:r}=e;const{currentSpaceViewStore:o}=m().default.state;if(!o)return;const i=null===(t=o.getHomeCalendarConfigStore())||void 0===t||null===(t=t.getKeyStore("event_filters"))||void 0===t?void 0:t.getKeyStore(a),d=!(0,p().E)(a);s().createAndCommit({userAction:"homeCalendarActions.toggleCalendarEventFilter",environment:n,canUndo:!0,perform:e=>{c().KY({transaction:e,store:i,value:d})}});const l=(0,V().sp)(r);(0,V().jr)({environment:n,calendarPanelContext:l,filter:a,newValue:d})}function k(e){let{environment:t,botId:n,shouldLog:a,panelState:r}=e;const{currentSpaceViewStore:o}=m().default.state;if(!o)return;const i=o.getHomeCalendarConfigStore().getKeyStore("selected_calendar_bot_id");if(i.getValue()!==n&&(0,u().pH)().find((e=>e.id===n))&&(s().createAndCommit({userAction:"homeCalendarActions.changeSelectedCalendarBot",environment:t,canUndo:!0,perform:e=>{c().KY({transaction:e,store:i,value:n})}}),a)){const e=(0,V().sp)(r);(0,V()._w)({environment:t,botId:n,calendarPanelContext:e})}}function x(e){let{environment:t}=e;const{currentSpaceViewStore:n}=m().default.state;if(!n)return;const a=n.getHomeCalendarConfigStore().getKeyStore("selected_calendar_bot_id");a.getValue()&&s().createAndCommit({userAction:"homeCalendarActions.clearSelectedCalendarBot",environment:t,canUndo:!0,perform:e=>{c().KY({transaction:e,store:a,value:void 0})}})}async function H(e){let{environment:t,currentSpaceViewStore:n,botId:r,timeRange:u,calendarAndAccountIds:p,forceRefetch:y,updateMethod:_,reason:C}=e;if(!n||!n.isReady()||!n.canRead())return"failure";const V=f().default.checkGate({gateName:"calendar_home_tile_caching"});if(!y){var T;let e=S().A.getStateForCurrentSpaceView();if(!e&&V&&(e=function(e){let{timeMin:t,botId:n}=e;const{currentSpaceViewStore:r}=m().default.state;if(!r)return;let o=w.get(r.id);if(o){const e=o.botId===n,i=t>=o.timeMin&&a().c9.fromMillis(t).plus({days:K}).toMillis()<=o.timeMax;e&&i?(o=R({state:o}).newState,S().A.updateStateForCurrentSpaceView((()=>o))):(w.remove(r.id),o=void 0)}return o}({timeMin:u.timeMin,botId:r})),(null===(T=e)||void 0===T?void 0:T.botId)===r)if(p){if(I(p))return"skipped"}else if(I((0,A().GF)({botId:r,currentSpaceViewStore:n})))return"skipped"}const M=(0,A().AU)({spaceViewStore:n,botId:r,specificCalendars:p}),O=v().default.DO_NOT_USE_markLegacy("home.calendar.get_calendar_events_all"),k=await d().callApi({eventName:"getCalendarEvents",environment:t,data:{botId:r,timeMin:u.timeMin,timeMax:u.timeMax,orderBy:"startTime",calendars:p,calendarVisibilityOverrides:"mirrorWithCron"===M.type?void 0:M.calendarOverrides,userTimeZone:(0,l().s1)().timeZone,reason:Array.isArray(C)?(0,o().sb)(C).sort().join(","):C}});if("success"!==k.type)return"failure";p||v().default.DO_NOT_USE_measureLegacy(O,{environment:t});const{accounts:x,calendars:H,events:D}=k.data,E=function(e){let{specificCalendarsFetched:t,calendarVisibilityOverrides:n,calendarApiResponse:a}=e;const r=new Set((t??[]).map(h().N)),d="calendarOverrides"===n.type?n.calendarOverrides:[],c=(0,o().pY)(d,h().N);return a.filter((e=>{const n=(0,h().N)(e);if(void 0!==t)return r.has(n);const a=c[n];return(0,i().O9)(a)?a.visible:e.selected})).map((e=>{let{id:t,accountId:n}=e;return{calendarId:t,accountId:n}}))}({calendarApiResponse:H,specificCalendarsFetched:p,calendarVisibilityOverrides:M});return S().A.updateStateForCurrentSpaceView((e=>{let t;switch(_){case void 0:case"merge":t=e;break;case"replace":t=void 0;break;default:(0,i().ub)(_)}const o=function(e){let{oldState:t,newState:n,updatedCalendars:a,fetchTime:r}=e;const o=!t||n.botId!==t.botId,d=function(e){let{calendarsThatWereUpdated:t,oldCalendarFetchedTimes:n,fetchTime:a}=e;const r={...n};for(const o of t)(!r[o]||r[o]<a)&&(r[o]=a);return r}({calendarsThatWereUpdated:a.map(h().N),oldCalendarFetchedTimes:o||null==t?void 0:t.calendarsToLastFetchedTime,fetchTime:r});if(!t||o)return{...n,calendarsToLastFetchedTime:d};const c={...t,calendarsToLastFetchedTime:d};for(const s of(0,i().WP)(n))switch(s[0]){case"accounts":c.accounts=b({oldMap:t.accounts,newMap:n.accounts,keyGetter:e=>{let{id:t}=e;return t}});break;case"events":c.events=(0,g().$z)({events:t.events,calendars:t.calendars,updatedCalendarAndAccountIds:a,newEvents:n.events.getOrderedValues()});break;case"botId":c.botId=n.botId;break;case"timeMin":c.timeMin=Math.max(t.timeMin,n.timeMin);break;case"timeMax":c.timeMax=Math.min(t.timeMax,n.timeMax);break;case"calendars":c.calendars=b({oldMap:t.calendars,newMap:n.calendars,keyGetter:h().N});break;default:(0,i().ub)(s[0])}return c}({oldState:t,newState:(0,g().IC)({botId:r,accounts:x,calendars:H,events:D,timeMin:u.timeMin,timeMax:u.timeMax}),updatedCalendars:E,fetchTime:a().c9.now()});return V&&w.set(n.id,o),o})),function(e){let{environment:t,spaceViewStore:n,botId:a,calendarResponse:r}=e;const o=n.getHomeCalendarVisibilityConfig(a);if((0,A().Xg)({spaceViewStore:n,botId:a}))return;const i=(0,A().NU)({currentConfig:null==o?void 0:o.calendarVisibility,calendars:r});if("noChanges"===i.result)return;s().createAndCommit({userAction:"homeCalendarActions.populateCalendarConfigWithCalendarResponse",environment:t,canUndo:!0,perform:e=>{c().KY({transaction:e,store:n.getHomeCalendarConfigStore().getKeyStore("shownCalendars").getKeyStore(a).getKeyStore("calendarVisibility"),value:i.newConfig})}})}({environment:t,spaceViewStore:n,botId:r,calendarResponse:H}),"success"}const D=(0,o().sg)(H,1e3,{leading:!1,trailing:!0});const E=function(e,t,n,a){const r=new T(e,t,n,a);return function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.enqueue(t)}}(H,(function(e,t){let n,[a]=e,[r]=t;if(a.environment!==r.environment||a.currentSpaceViewStore!==r.currentSpaceViewStore||a.botId!==r.botId||a.timeRange.key!==r.timeRange.key)return!1;const i={environment:a.environment,currentSpaceViewStore:a.currentSpaceViewStore,botId:a.botId,timeRange:{key:a.timeRange.key,timeMin:Math.max(a.timeRange.timeMin,r.timeRange.timeMin),timeMax:Math.max(a.timeRange.timeMax,r.timeRange.timeMax)},reason:(0,o().Bq)([a.reason,r.reason]),forceRefetch:a.forceRefetch||r.forceRefetch};return n=a.calendarAndAccountIds&&r.calendarAndAccountIds?{...i,calendarAndAccountIds:(0,o().hS)([...a.calendarAndAccountIds,...r.calendarAndAccountIds],h().N)}:{...i,updateMethod:"replace"===a.updateMethod||"replace"===r.updateMethod?"replace":"merge"},[n]}),2e3+2e3*Math.random(),{maxWait:5e3});function F(e){let{environment:t,botId:n,mirrorWithNotionCalendar:a,panelState:r}=e;const{currentSpaceViewStore:o}=m().default.state;if(!o)return;const i=o.getHomeCalendarConfigStore().getKeyStore("shownCalendars").getKeyStore(n);s().createAndCommit({userAction:"homeCalendarActions.toggleCalendarMirroring",environment:t,canUndo:!0,perform:e=>{const t=a?void 0:(0,A().cL)(S().A.getCurrentCalendars()??[]);c().KY({transaction:e,store:i,value:{mirrorWithNotionCalendar:a,calendarVisibility:t}})}});const d=(0,V().sp)(r),l=a;(0,V().m3)({environment:t,calendarPanelContext:d,newValue:l}),D({environment:t,currentSpaceViewStore:o,botId:n,timeRange:(0,y().M)(),forceRefetch:!1,reason:"toggle_mirroring"})}function W(e){let{environment:t,botId:n,calendarId:a,accountId:r,newIsVisible:o,panelState:i}=e;const{currentSpaceViewStore:d}=m().default.state;if(!d)return;const l=d.getCalendarVisibilityStore({botId:n,calendarId:a,accountId:r});s().createAndCommit({userAction:"homeCalendarActions.toggleCalendarVisibility",environment:t,canUndo:!0,perform:e=>{c().KY({transaction:e,store:l,value:o})}}),(0,V().J3)({environment:t,calendarPanelContext:(0,V().sp)(i),calendarId:a,accountId:r,newValue:o}),D({environment:t,currentSpaceViewStore:d,botId:n,timeRange:(0,y().M)(),calendarAndAccountIds:[{calendarId:a,accountId:r}],forceRefetch:!1,reason:"toggle_calendar_visibility"})}function N(e){var t;let{environment:n,botId:a,calendarId:r,accountId:i,newIsVisible:d}=e;const{currentSpaceViewStore:c}=m().default.state;if(!c)return;const s=S().A.getCalendar({calendarId:r,accountId:i});if(!s||s.selected===d)return;S().A.updateStateForCurrentSpaceView((e=>{if(!e)return;const t=(0,o().mg)(e),n=t.calendars.get((0,h().N)({accountId:i,calendarId:r}));if(!n||n.selected===d)return e;n.selected=d;return f().default.checkGate({gateName:"calendar_home_tile_caching"})&&w.set(c.id,t),t}));((null===(t=c.getHomeCalendarVisibilityConfig(a))||void 0===t?void 0:t.mirrorWithNotionCalendar)??!1)&&d&&E({currentSpaceViewStore:c,environment:n,botId:a,timeRange:(0,y().M)(),calendarAndAccountIds:[{calendarId:r,accountId:i}],forceRefetch:!1,reason:"calendar_visibility_change"})}function R(e){let{now:t=a().c9.now(),state:n}=e;const{events:o}=n,{timeZone:i}=(0,l().s1)(),d=new(r().A)(o.getOrderedValues().filter((e=>!(0,g().FC)(e,t,i))),h().z);return d.length===o.length?{didChange:!1,newState:n}:{didChange:!0,newState:{...n,timeMin:t.toMillis(),events:d}}}function P(e){let{now:t=a().c9.now(),currentSpaceViewStore:n}=e;if(!n)return;const r=S().A.getStateForCurrentSpaceView();if(!r)return;const{didChange:o,newState:i}=R({now:t,state:r});if(o){S().A.updateStateForCurrentSpaceView((()=>i));f().default.checkGate({gateName:"calendar_home_tile_caching"})&&w.set(n.id,i)}}const K=1;function U(){const{currentSpaceViewStore:e}=m().default.state;e&&(S().A.clearStateForCurrentSpaceView(),w.remove(e.id))}},677169:(e,t,n)=>{n.d(t,{m:()=>u});n(898992),n(354520),n(672577),n(737550);var a=n(296540),r=()=>n(484714),o=()=>n(56366),i=()=>n(617871),d=()=>n(351360),c=()=>n(508496),s=()=>n(53137),l=()=>n(573985);function u(){const e=(0,r().v3)(),t=(0,a.useRef)(void 0);return(0,o().K8)((()=>{if(void 0===t.current){if(!c().default.isStatsigReady())return{loading:!0,botId:void 0,botSpaceId:void 0,botUserId:void 0};t.current=c().default.checkGate({gateName:"calendar_home_tile_caching"})}if(t.current){var n;const{currentSpaceViewStore:t}=d().default.state;if(!t||!t.isReady())return{loading:!0,botId:void 0,botSpaceId:void 0,botUserId:void 0};const a=t.getSelectedCalendarBotId(),r=!s().A.state.loaded;if(a&&r)return{loading:!1,botId:a,botSpaceId:t.getSpaceId(),botUserId:t.getUserId()};const{spaceId:o,userId:c}=s().A.state.loaded?s().A.state:{spaceId:void 0,userId:void 0},u=s().A.bots.state.filter((e=>e.integration_id===i().io)),v=null===(n=u[0])||void 0===n?void 0:n.id,m=a&&u.some((e=>e.id===a))?a:v;return m&&m!==a?(0,l().rq)({environment:e,botId:m,shouldLog:!1}):!m&&a&&(0,l().k2)({environment:e}),{loading:r,botId:m,botSpaceId:o,botUserId:c}}{var a,r,o;const e=s().A.bots.state.filter((e=>e.integration_id===i().io)),t=null===(a=d().default.state.currentSpaceViewStore)||void 0===a?void 0:a.getSelectedCalendarBotId(),n=!s().A.state.loaded||!(null!==(r=d().default.state.currentSpaceViewStore)&&void 0!==r&&r.isReady()),{spaceId:c,userId:l}=s().A.state.loaded?s().A.state:{spaceId:void 0,userId:void 0},u=null===(o=e[0])||void 0===o?void 0:o.id;if(!t)return{loading:n,botId:u,botSpaceId:c,botUserId:l};const v=e.find((e=>e.id===t));return{loading:n,botId:(null==v?void 0:v.id)??u,botSpaceId:c,botUserId:l}}}),[e])}},689950:(e,t,n)=>{n.d(t,{IU:()=>f,sp:()=>m,qL:()=>V,_w:()=>b,rP:()=>_,V0:()=>S,G7:()=>g,np:()=>p,lv:()=>h,J3:()=>C,jr:()=>I,m3:()=>y});n(898992),n(354520),n(581454);var a=()=>n(989423),r=()=>n(449506);function o(e,t){r().callApi({eventName:"calendarTrack",environment:e,data:t})}var i=()=>n(351360),d=()=>n(379560),c=()=>n(185984),s=()=>n(158751),l=()=>n(377515);function u(e){let{state:t,calendars:n,event_filters:a,mirror_calendars:r,time_range:o,bot_id:i}=e;return{state:t,calendars:n,event_filters:a&&{all_day_events:a.all_day_events,events_without_participants:a.events_without_participants,events_without_location:a.events_without_location},mirror_calendars:r,time_range:o,bot_id:i}}function v(e){let{event_id:t,calendar_id:n,account_id:a,is_all_day:r,has_participants:o,conferencing_type:i,index:d,num_days_in_future:c}=e;return{event_id:t,calendar_id:n,account_id:a,is_all_day:r,has_participants:o,conferencing_type:i,index:d,num_days_in_future:c}}function m(e){var t,n,a;const r=i().default.state.currentSpaceViewStore,o=null===(t=d().A.getStateForCurrentSpaceView())||void 0===t?void 0:t.botId;return{state:e,calendars:r&&o&&(null===(n=d().A.getCurrentCalendars())||void 0===n?void 0:n.map((e=>({type:e.provider,calendarId:e.id,accountId:e.accountId,isShown:(0,l().Pj)({spaceViewStore:r,botId:o,calendar:e})})))),mirror_calendars:(0,l().Xg)({botId:o,spaceViewStore:r}),event_filters:{all_day_events:(0,c().E)("all_day_events"),events_without_participants:(0,c().E)("events_without_participants"),events_without_location:(0,c().E)("events_without_location")},time_range:(null==r||null===(a=r.getHomeCalendarConfigStore())||void 0===a?void 0:a.getKeyStore("time_range").getValue())??s().C0,bot_id:o}}function f(e){var t;let{event:n,eventIndex:a,numDaysInFuture:r}=e;return{event_id:n.id,calendar_id:n.calendarId,account_id:n.accountId,is_all_day:n.isAllDay,has_participants:n.hasParticipants,conferencing_type:null===(t=n.conferencing)||void 0===t?void 0:t.providerName,index:a,num_days_in_future:r}}function p(e){let{environment:t,target:n,eventContext:r,calendarPanelContext:i}=e;(0,a().vd)(t,"cal_event_click",{target:n,...u(i),...v(r)}),"conferencing"===n&&i.bot_id&&o(t,{botId:i.bot_id,payload:{type:"track",payload:{event:"joinMeeting",eventId:r.event_id,calendarId:r.calendar_id,conferencingProvider:r.conferencing_type,method:"notionHomeTile"}}})}function g(e){let{environment:t,eventContext:n,calendarPanelContext:r,attachmentType:i,notionBlockId:d,attachmentIndex:c}=e;(0,a().vd)(t,"cal_event_click",{target:"attachment",attachment_type:i,attachment_index:c,notion_block_id:d,...u(r),...v(n)}),r.bot_id&&o(t,{botId:r.bot_id,payload:{type:"track",payload:{event:"eventAttachmentOpened",provider:i,location:"notionHomeTile"}}})}function S(e){const{environment:t,calendarPanelContext:n,notionAnalyticsSessionId:r}=e;(0,a().vd)(t,"cal_create_event",{...u(n)}),n.bot_id&&o(t,{botId:n.bot_id,payload:{type:"track",payload:{event:"createEventButtonClicked",notionAnalyticsSessionId:r,method:"notionHomeTile"}}})}function h(e){(0,a().vd)(e.environment,"cal_settings_menu",{action:e.action,...u(e.calendarPanelContext)})}function I(e){w({environment:e.environment,calendarPanelContext:e.calendarPanelContext,action:`toggle_${e.filter}`,value:e.newValue})}function b(e){w({environment:e.environment,calendarPanelContext:e.calendarPanelContext,action:"change_calendar_bot",value:e.botId})}function y(e){w({environment:e.environment,calendarPanelContext:e.calendarPanelContext,action:"toggle_mirroring",value:e.newValue})}function _(e){w({environment:e.environment,calendarPanelContext:e.calendarPanelContext,action:"change_time_range",value:e.newValue})}function C(e){w({environment:e.environment,calendarPanelContext:e.calendarPanelContext,action:"toggle_calendar_visibility",calendarId:e.calendarId,accountId:e.accountId,value:e.newValue})}function w(e){(0,a().vd)(e.environment,"cal_configure_view",{...u(e.calendarPanelContext),action:e.action,value:e.value,..."calendarId"in e?{calendar_id:e.calendarId}:{},..."accountId"in e?{account_id:e.accountId}:{}})}function V(e){const{environment:t,calendarPanelContext:n}=e;(0,a().vd)(t,"cal_loaded",{...u(n)}),n.bot_id&&o(t,{botId:n.bot_id,payload:{type:"page",payload:{page:"notionHomeTile"}}})}},812109:(e,t,n)=>{function a(e){return"string"==typeof e?e:"calendarId"in e?`${e.accountId}:${e.calendarId}`:`${e.accountId}:${e.id}`}function r(e){let{id:t,accountId:n,calendarId:a}=e;return`${n}:${a}:${t}`}n.d(t,{N:()=>a,z:()=>r})},823115:(e,t,n)=>{n.d(t,{$D:()=>o,J_:()=>d,RY:()=>r,V$:()=>i,cK:()=>c,qi:()=>s});n(16280),n(944114),n(581454);var a=()=>n(244641);function r(e){let{eventStartDate:t,eventEndDateInclusive:n,minDate:a,maxDateInclusive:r,timeZone:i}=e;const c=function(e){let{startAndEndDaysRange:t,minAndMaxDaysRange:n}=e;if(t.end<n.min)return;if(t.start>n.max)return;const{start:a,end:r}=t,{min:o,max:i}=n,d=a<o?o:a,c=r>i?i:r;return{start:d,end:c}}({startAndEndDaysRange:{start:d(t,i),end:d(n,i)},minAndMaxDaysRange:{min:d(a,i),max:d(r,i)}});if(!c)return[];const{start:s,end:l}=c;return o(s,l,i)}function o(e,t,n){const a=d(t,n);let r=d(e,n);const o=[];for(;r<=a;)o.push(r),r=i(r,n).plus({days:1}).toISODate();return o}function i(e,t){const[n,r,o]=d(e,t).split("-").map(Number);return a().c9.fromObject({year:n,month:r,day:o},{zone:t})}function d(e,t){const n=a().c9.fromISO(e,{zone:t});if(!n.isValid)throw new Error(`Invalid date string: ${e}`);return e.includes("T")?n.toISODate():e}function c(e,t){const n="en-US";return a().c9.fromISO(e,{zone:"UTC"}).setLocale(n).toLocaleString(a().c9.DATE_SHORT)===t.setLocale(n).toLocaleString(a().c9.DATE_SHORT)}function s(e,t,n){const a=i(e,n);return i(t,n).diff(a,"days").days}}}]);