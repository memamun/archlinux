"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[11097,64165],{120250:(t,e,n)=>{n.r(e),n.d(e,{CustomCollectionView:()=>T});n(16280),n(898992),n(354520),n(672577),n(430670),n(581454);var r=n(296540),o=()=>n(484714),i=()=>n(56366),s=()=>n(401497),a=()=>n(362750),c=()=>n(931121),d=()=>n(366295),u=()=>n(402390),l=()=>n(751735),f=()=>n(100622),p=()=>n(284371);const g={default:f().Tj.defaultText,defaultForeground:"rgb(255, 255, 255)",background:"rgb(255, 255, 255)",foreground:f().Tj.defaultText,primary:f().Tj.blue,primaryForeground:"rgb(255, 255, 255)",secondary:f().Tj.contentGrayBackground,secondaryForeground:f().Tj.defaultText,accent:f().XA.light.uiBlue[600],accentForeground:"rgb(255, 255, 255)",muted:(0,l().X4)(f().CM.light.lightgray,.5),mutedForeground:f().Tj.uiGray,border:(0,l().X4)(f().CM.light.darkgray,.16)},m={default:"rgb(255, 255, 255)",defaultForeground:"rgb(25, 25, 25)",background:"rgb(25, 25, 25)",foreground:"rgb(235, 235, 235)",primary:f().Tj.blue,primaryForeground:"rgb(255, 255, 255)",secondary:(0,l().X4)(f().CM.dark.darkgray,.8),secondaryForeground:"rgb(235, 235, 235)",accent:f().XA.light.uiBlue[600],accentForeground:"rgb(255, 255, 255)",muted:(0,l().X4)(f().CM.dark.darkgray,.8),mutedForeground:(0,l().X4)(f().CM.dark.lightgray,.6),border:(0,l().X4)("white",.13)},y=`\n:root {\n  --default: ${g.default};\n  --default-foreground: ${g.defaultForeground};\n  --primary: ${g.primary};\n  --primary-foreground: ${g.primaryForeground};\n  --secondary: ${g.secondary};\n  --secondary-foreground: ${g.secondaryForeground};\n  --accent: ${g.accent};\n  --accent-foreground: ${g.accentForeground};\n  --background: ${g.background};\n  --foreground: ${g.foreground};\n  --muted: ${g.muted};\n  --muted-foreground: ${g.mutedForeground};\n  --border: ${g.border};\n}\n\n.dark {\n  --default: ${m.default};\n  --default-foreground: ${m.defaultForeground};\n  --primary: ${m.primary};\n  --primary-foreground: ${m.primaryForeground};\n  --secondary: ${m.secondary};\n  --secondary-foreground: ${m.secondaryForeground};\n  --accent: ${m.accent};\n  --accent-foreground: ${m.accentForeground};\n  --background: ${m.background};\n  --foreground: ${m.foreground};\n  --muted: ${m.muted};\n  --muted-foreground: ${m.mutedForeground};\n  --border: ${m.border};\n}\n`;var v=()=>n(959013),w=()=>n(498212),h=()=>n(449506),k=()=>n(118078),b=()=>n(864943),_=()=>n(963589),E=()=>n(847),S=()=>n(691093),C=()=>n(46986),M=()=>n(194193),R=()=>n(424141),F=n(474848);function T(t){const{paddingLeft:e,paddingRight:n,collectionViewStore:c,collectionContextStore:d,store:u}=t,l=(0,o().v3)(),f=(0,i().K8)((()=>(0,C().s)()),[]),p=(0,_().X)("workflows_custom_view_type"),g=(0,s().IS)((t=>({container:{paddingLeft:e??0,paddingRight:n??0,display:"flex",flexDirection:"column",height:"100%"}})),[e,n]),m=(0,i().K8)((()=>d.collectionViewBlockStore()),[d]),y=(0,R().y)(m),v=(0,i().K8)((()=>null==y?void 0:y.getData()),[y]),w=(0,M().i)(v),h=(0,i().K8)((()=>{if(!v||!w||0===w.length)return{result:void 0,error:void 0};try{const t=function(t){var e;const{workflow:n,functions:r,collectionViewId:o}=t,i=null===(e=n.views)||void 0===e?void 0:e.find((t=>{var e;return(null===(e=t.pointer)||void 0===e?void 0:e.id)===o}));if(!i)return;const s=$({functionKey:i.key,functions:r}),a=s.flatMap((t=>t.callsFunctions||[])),c=r.filter((t=>a.includes(t.key)&&"server_function"===t.type));return{functionKey:i.key,code:s.map((t=>t.value||"")).join("\n\n"),serverFunctionKeys:c.map((t=>t.key))}}({workflow:v,functions:w,collectionViewId:c.id});return{result:t,error:void 0}}catch(t){return{result:void 0,error:(0,a().OG)(t)}}}),[v,w,c]),b=(0,i().K8)((()=>null==y?void 0:y.getSpaceId()),[y]),T=(0,r.useCallback)((()=>{var t;if(!y||!h.error)return;const e=y.getData();if(!e)return;const n=null===(t=e.views)||void 0===t?void 0:t.find((t=>{var e;return(null===(e=t.pointer)||void 0===e?void 0:e.id)===c.id}));if(!n)return;(0,S().openWorkflowEditor)({environment:l});const r=(0,E().startEditWorkflow)({environment:l,workflowStore:y,store:u,inputValue:`Found error when running custom view with key ${n.key}: ${h.error}`,additionalSteps:[]});if(!r)throw new Error("Failed to start chat thread");(0,k().openChatSidebar)({environment:l,chatThreadId:r})}),[l,h.error,y,u,c]);return f&&b&&y&&p&&u?h.error?(0,F.jsx)("div",{style:g.container,children:(0,F.jsx)(A,{error:h.error,workflowStore:y,store:u,collectionViewStore:c,onFixErrors:T})}):h.result?(0,F.jsx)("div",{style:g.container,children:(0,F.jsx)(I,{code:h.result.code,functionKey:h.result.functionKey,serverFunctionKeys:h.result.serverFunctionKeys,workflowId:y.id,spaceId:b,workflowStore:y,store:u,collectionViewStore:c})}):null:null}function $(t){const{functionKey:e,functions:n}=t,r=n.find((t=>t.key===e));if(!r)throw new Error(`Function ${e} not found`);return[r,...(r.callsFunctions||[]).map((t=>{const e=n.find((e=>e.key===t));if(!e)throw new Error(`Function ${t} not found`);return e})).filter((t=>"client_react_component"===t.type)).flatMap((t=>$({functionKey:t.key,functions:n})))]}function I(t){const{code:e,functionKey:n,serverFunctionKeys:s,workflowId:a,spaceId:c,workflowStore:d,store:l,collectionViewStore:f}=t,g=(0,o().v3)(),[m,b]=r.useState([]),[_,C]=r.useState([]),M=r.useRef(null),R=(0,v().tz)(),T=(0,u().H)(R),$=r.useMemo((()=>(0,w().lZ)()),[]);r.useEffect((()=>{const t=async t=>{var e;if(M.current&&t.source===M.current.contentWindow&&(null===(e=t.data)||void 0===e?void 0:e.securityToken)===$){const{type:e,functionKey:i,args:d,requestId:u,error:l,log:f}=t.data;if(l&&b((t=>[...t,l])),f&&C((t=>[...t,f])),"callServerFunction"===e&&s.includes(i))try{var n;const t=await h().callApi({eventName:"callWorkflowFunction",environment:g,data:{workflowId:a,spaceId:c,functionKey:i,functionArgs:d||{}}});null===(n=M.current.contentWindow)||void 0===n||n.postMessage({type:"serverFunctionResponse",requestId:u,securityToken:$,result:"failed"===t.type?null:t.data.returnValue,error:"failed"===t.type?t.error:null,success:"failed"!==t.type},"*")}catch(o){var r;null===(r=M.current.contentWindow)||void 0===r||r.postMessage({type:"serverFunctionResponse",requestId:u,securityToken:$,result:null,error:o instanceof Error?o.message:String(o),success:!1},"*")}}};return window.addEventListener("message",t),()=>{window.removeEventListener("message",t)}}),[s,a,c,g,$]);const I=`\n\t\t// @ts-nocheck - Disable TypeScript type checking for this script\n\t\t// Isolated scope for the workflow code\n\t\t(function() {\n\t\t\t// Override console methods to capture logs\n\t\t\tconst originalConsole = { ...console };\n\t\t\tconst consoleTypes = ['log', 'info', 'warn', 'error', 'debug'];\n\n\t\t\tconsoleTypes.forEach(type => {\n\t\t\t\tconsole[type] = (...args) => {\n\t\t\t\t\toriginalConsole[type](...args);\n\t\t\t\t\twindow.parent.postMessage({\n\t\t\t\t\t\ttype: 'consoleLog',\n\t\t\t\t\t\tlog: { type, args: JSON.parse(JSON.stringify(args)) },\n\t\t\t\t\t\tsecurityToken: "${$}"\n\t\t\t\t\t}, "*");\n\t\t\t\t};\n\t\t\t});\n\n\t\t\t// Set up global error handling\n\t\t\twindow.onerror = (message, source, lineno, colno, error) => {\n\t\t\t\twindow.parent.postMessage({\n\t\t\t\t\ttype: 'error',\n\t\t\t\t\terror: {\n\t\t\t\t\t\tmessage: message,\n\t\t\t\t\t\tstack: error?.stack,\n\t\t\t\t\t\tsource,\n\t\t\t\t\t\tlineno,\n\t\t\t\t\t\tcolno\n\t\t\t\t\t},\n\t\t\t\t\tsecurityToken: "${$}"\n\t\t\t\t}, "*");\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\twindow.addEventListener('unhandledrejection', (event) => {\n\t\t\t\twindow.parent.postMessage({\n\t\t\t\t\ttype: 'error',\n\t\t\t\t\terror: {\n\t\t\t\t\t\tmessage: event.reason?.message || 'Unhandled Promise Rejection',\n\t\t\t\t\t\tstack: event.reason?.stack\n\t\t\t\t\t},\n\t\t\t\t\tsecurityToken: "${$}"\n\t\t\t\t}, "*");\n\t\t\t});\n\n\t\t\t${e}\n\n\t\t\t// Setup bridge for server function calls\n\t\t\tconst pendingRequests = new Map();\n\t\t\tlet requestCounter = 0;\n\t\t\tconst securityToken = "${$}";\n\n\t\t\twindow.addEventListener('message', (event) => {\n\t\t\t\t// Validate the message has our security token\n\t\t\t\tif (event.source === window.parent &&\n\t\t\t\t    event.data &&\n\t\t\t\t    event.data.type === 'serverFunctionResponse' &&\n\t\t\t\t    event.data.securityToken === securityToken) {\n\n\t\t\t\t\tconst { requestId, result, error, success } = event.data;\n\t\t\t\t\tconst resolver = pendingRequests.get(requestId);\n\n\t\t\t\t\tif (resolver) {\n\t\t\t\t\t\tpendingRequests.delete(requestId);\n\t\t\t\t\t\tif (!success) {\n\t\t\t\t\t\t\tresolver.reject(new Error(error));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t// Always parse the result as JSON\n\t\t\t\t\t\t\t\tresolver.resolve(result ? JSON.parse(result) : null);\n\t\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t\t// If parsing fails, return the raw result\n\t\t\t\t\t\t\t\tresolver.resolve(result);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t${s.map((t=>`\n\t\t\t\t\tasync function ${t}(args) {\n\t\t\t\t\t\tconst requestId = requestCounter++;\n\t\t\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\t\t\tpendingRequests.set(requestId, { resolve, reject });\n\n\t\t\t\t\t\t\t// Always stringify args\n\t\t\t\t\t\t\tconst safeArgs = args ? JSON.parse(JSON.stringify(args)) : {};\n\n\t\t\t\t\t\t\t// Use security token\n\t\t\t\t\t\t\twindow.parent.postMessage({\n\t\t\t\t\t\t\t\ttype: 'callServerFunction',\n\t\t\t\t\t\t\t\tfunctionKey: '${t}',\n\t\t\t\t\t\t\t\targs: safeArgs,\n\t\t\t\t\t\t\t\trequestId,\n\t\t\t\t\t\t\t\tsecurityToken\n\t\t\t\t\t\t\t}, "*");\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t`)).join("\n")}\n\n\t\t\t// Render the component\n\t\t\ttry {\n\t\t\t\tconst rootElement = document.getElementById('root');\n\t\t\t\tconst root = ReactDOM.createRoot(rootElement);\n\t\t\t\troot.render(React.createElement(${n}, {}));\n\t\t\t} catch (error) {\n\t\t\t\t// Error rendering component\n\t\t\t\tconsole.error("[Iframe] Error rendering component:", error);\n\t\t\t}\n\t\t})();\n\t`,x=(0,i().O$)(g.ThemeModeStore),D=`\n\t\t<!DOCTYPE html>\n\t\t<html class="${"dark"===x?"dark":""}">\n\t\t<head>\n\t\t\t<meta charset="utf-8">\n\t\t\t<meta name="viewport" content="width=device-width, initial-scale=1">\n\t\t\t<meta http-equiv="Content-Security-Policy" content="default-src 'none'; script-src https://unpkg.com 'unsafe-inline'; style-src 'unsafe-inline'; connect-src 'none';">\n\t\t\t<script src="https://unpkg.com/react@18.2.0/umd/react.development.js" crossorigin defer><\/script>\n\t\t\t<script src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.development.js" crossorigin defer><\/script>\n\t\t\t<script src="https://unpkg.com/@babel/standalone@7.26.9/babel.min.js" crossorigin defer><\/script>\n\t\t\t<script src="https://unpkg.com/dayjs-with-plugins@1.0.4/dist/dayjs-with-plugins.min.js" crossorigin defer><\/script>\n\t\t\t<script src="https://unpkg.com/@tailwindcss/browser@4" crossorigin><\/script>\n\t\t\t<style>\n\t\t\t\t#code {\n\t\t\t\t\tdisplay: none;\n\t\t\t\t}\n\t\t\t\t${y}\n\t\t\t\t${function(t){return`\n/* Base styles */\nbody {\n\tbackground-color: var(--background);\n\tcolor: var(--foreground);\n\tfont-family: ${(0,p().vc)(t).sans};\n\tline-height: 1.5;\n\t-webkit-font-smoothing: antialiased;\n}\n`}(T)}\n\t\t\t</style>\n\t\t</head>\n\t\t<body>\n\t\t\t<div id="root" class="p-4"></div>\n\t\t\t<div id="code">${encodeURIComponent(I)}</div>\n\t\t\t<script>\n\t\t\t\twindow.addEventListener('DOMContentLoaded', () => {\n\t\t\t\t\tconst code = decodeURIComponent(document.getElementById('code')?.textContent || '');\n\t\t\t\t\twindow.now = new Date().toISOString();\n\t\t\t\t\twindow.timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;\n\t\t\t\t\twindow.safeJSONParse = (str) => {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\treturn JSON.parse(str);\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\tif (code) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t// Transpile TypeScript to JavaScript\n\t\t\t\t\t\t\tconst tsCode = code;\n\t\t\t\t\t\t\tconst jsCode = Babel.transform(tsCode, {\n\t\t\t\t\t\t\t\tpresets: ['typescript', 'react'],\n\t\t\t\t\t\t\t\tfilename: 'component.tsx'\n\t\t\t\t\t\t\t}).code;\n\t\t\t\t\t\t\tconst executeScript = document.createElement('script');\n\t\t\t\t\t\t\texecuteScript.textContent = jsCode;\n\t\t\t\t\t\t\tdocument.body.appendChild(executeScript);\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tconsole.error("[Iframe] Error transpiling or executing code:", error);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t<\/script>\n\t\t</body>\n\t\t</html>\n\t`;(0,r.useEffect)((()=>{const t=document.querySelector("iframe");null!=t&&t.contentWindow&&t.contentWindow.postMessage({type:"themeChange",isDark:"dark"===x},"*")}),[x]);const j=(0,r.useCallback)((()=>{var t;const e=d.getData();if(!e)return;const n=null===(t=e.views)||void 0===t?void 0:t.find((t=>{var e;return(null===(e=t.pointer)||void 0===e?void 0:e.id)===f.id}));if(!n)return;(0,S().openWorkflowEditor)({environment:g});const r=(0,E().startEditWorkflow)({environment:g,workflowStore:d,store:l,inputValue:`Found errors in custom view with key ${n.key}:\n${m.map((t=>`Error: ${t.message}${t.stack?`\nStack: ${t.stack}`:""}`)).join("\n")}\n\nConsole logs:\n${_.map((t=>`[${t.type}] ${JSON.stringify(t.args)}`)).join("\n")}`,additionalSteps:[]});if(!r)throw new Error("Failed to start chat thread");(0,k().openChatSidebar)({environment:g,chatThreadId:r})}),[g,m,_,d,l,f]);return c?(0,F.jsxs)(F.Fragment,{children:[m.length>0&&(0,F.jsx)(A,{error:m[m.length-1].message,workflowStore:d,store:l,collectionViewStore:f,onFixErrors:j}),(0,F.jsx)("iframe",{ref:M,srcDoc:D,sandbox:"allow-scripts allow-forms allow-pointer-lock",referrerPolicy:"no-referrer",style:{border:"none",width:"100%",height:"100%",minHeight:"300px"},title:"Workflow Content"})]}):null}function A(t){const{error:e,onFixErrors:n}=t,r=(0,s().IS)((t=>({container:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:12,marginBottom:12,borderRadius:4,width:"100%"},errorContent:{display:"flex",alignItems:"center",flexGrow:1,marginRight:12,color:t.accentColors.red[400],fontSize:14},errorIcon:{width:16,height:16,fill:t.accentColors.red[400],marginRight:8}})),[]);return(0,F.jsxs)("div",{style:r.container,children:[(0,F.jsxs)("div",{style:r.errorContent,children:[(0,c().J)(r.errorIcon),e]}),(0,F.jsx)(b().A,{icon:d().L,size:"sm",onClick:n,children:"Fix with AI"})]})}},173019:(t,e,n)=>{n.d(e,{r:()=>o});n(296540);var r=n(474848);const o=(0,n(340498).wt)("pencil",{viewBox:"0 0 16 16",svg:(0,r.jsx)("path",{d:"M3.926 13.307H14.11c.183 0 .34-.066.472-.199a.644.644 0 00.198-.471.652.652 0 00-.198-.479.644.644 0 00-.472-.198H5.272l-1.346 1.347zm-.704-.636l7.683-7.684-1.312-1.319-7.69 7.684-.67 1.606c-.037.1-.017.191.06.273.083.082.174.105.274.069l1.655-.63zm8.34-8.326l.738-.732c.182-.187.278-.376.287-.567.009-.192-.068-.374-.232-.547l-.267-.267c-.169-.168-.351-.246-.547-.232-.196.014-.385.11-.567.287l-.739.732 1.327 1.326z"})})},194193:(t,e,n)=>{n.d(e,{i:()=>a});n(16280),n(581454);var r=()=>n(56366),o=()=>n(351360),i=()=>n(630116),s=()=>n(94522);function a(t){return(0,r().K8)((()=>{if(!t)return[];const{currentUserStore:e}=o().default.state;if(!e)throw new Error("No current user store");if(t.functions&&t.functions.length>0)return t.functions;if(!t.functionPointers||0===t.functionPointers.length)return[];const n=t.functionPointers.map((t=>i().je.createChildStore(e,t)));return(0,s().aY)(n)}),[t])}},390527:(t,e,n)=>{n.r(e),n.d(e,{DEFAULT_MAX_RECURRENCE_DUPLICATION_PER_TASK:()=>I,MAXIMUM_DAILY_RECURRENCES_IN_PATH:()=>E,MAXIMUM_NESTED_RECURRENCE_LEVEL:()=>_,MAX_RECURRENCE_INTERVAL:()=>v,MAX_RECURRENCE_NUMBER_OF_RUNS:()=>w,RRULE_WEEKDAYS_MAP:()=>y,adjustedStartDateIfPossible:()=>C,areRecurrenceSchedulesEqual:()=>N,convertFromUnpersistedRecurrenceConfig:()=>j,convertToUnpersistedRecurrenceConfig:()=>A,getFormattedEndCondition:()=>$,getFormattedNextRecurrenceTime:()=>T,getNewEndTimestamp:()=>x,getNextDateUtc:()=>F,getRecurrenceAfter:()=>M,isRunningBetweenMidnightAnd3AM:()=>R,isValidRecurrenceInterval:()=>h,isValidRecurrenceNumberOfRuns:()=>k,rruleFromRecurrence:()=>b,templateAncestorsViolateRecurrenceNesting:()=>S});n(898992),n(354520),n(581454);var r=()=>n(244641);n(944114);function o(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];if(0===n.length)return t.map((t=>[t]));const i=[];for(const s of t)i.push(...o(n[0],...n.slice(1)).map((t=>[s,...t])));return i}var i=()=>n(496603),s=()=>n(534177),a=()=>n(720665),c=()=>n(597777),d=()=>n(869190),u=()=>n(416504),l=()=>n(402390);class f extends(()=>n(896346))().p3{constructor(t,e){super(t,e)}after(t,e){return super.after(t,e)}}var p=()=>n(912720);const g=(0,n(959013).YK)({dateAtTime:{id:"automations.recurrenceHelpers.dateAtTime",defaultMessage:"{date} at {time}"},dateBetweenMidnightAnd3AM:{id:"automations.recurrenceHelpers.dateBetweenMidnightAnd3AM",defaultMessage:"{date} between 12â€“3 AM"},numberEndConditionDescription:{id:"automations.recurrenceHelpers.numberEndConditionDescription",defaultMessage:"{number, plural, one {After {number} run} other {After {number} runs}}"},noEndCondition:{id:"automations.recurrenceHelpers.noEndCondition",defaultMessage:"Never"}}),m={day:f.DAILY,week:f.WEEKLY,month:f.MONTHLY,year:f.YEARLY},y={MO:f.MO,TU:f.TU,WE:f.WE,TH:f.TH,FR:f.FR,SA:f.SA,SU:f.SU},v=99,w=999;function h(t){return(0,a().Et)(t)&&Number.isInteger(t)&&t>0&&t<=v}function k(t){return(0,a().Et)(t)&&Number.isInteger(t)&&t>0&&t<=w}function b(t){const{start_date:e,frequency:n,interval:r,weekdays:i,timezone:a,hour:d,minute:u}=t,l="week"===n&&i?i.map((t=>y[t])):void 0,p={};return(0,s().O9)(t.end_condition)&&("date"===t.end_condition.type?p.until=(0,c().eU)(t.end_condition.end_at):"number"===t.end_condition.type?p.count=t.end_condition.number_of_occurrences:(0,s().HB)(t.end_condition)),"month"===t.frequency&&(0,s().O9)(t.monthly_restriction)&&("monthdays"===t.monthly_restriction.type?p.bymonthday=t.monthly_restriction.monthdays:"weekdays_in_month"===t.monthly_restriction.type?p.byweekday=o(t.monthly_restriction.weekdays,t.monthly_restriction.week_numbers).map((t=>{let[e,n]=t;return y[e].nth(n)})):(0,s().HB)(t.monthly_restriction)),new f({freq:m[n],dtstart:(0,c().eU)(e),interval:r,byweekday:l,tzid:a,byhour:d??0,byminute:u??0,bysecond:0,...p})}const _=1,E=1;function S(t){var e;if(0===t.length)return{violatesConstraint:!1,templateNestingExceedsMaxDepth:!1,ancestorHasDailyTemplate:!1,nestedDepthOfAutomationAncestors:void 0,immediateAncestorRecurrenceType:void 0};const n=t.filter((t=>{var e;return"day"===(null===(e=t.getRecurrence())||void 0===e?void 0:e.frequency)})),r=t.length,o=null===(e=t[0].getRecurrence())||void 0===e?void 0:e.frequency,i=r>_,s=n.length>=E;return{violatesConstraint:i||s,templateNestingExceedsMaxDepth:i,ancestorHasDailyTemplate:s,nestedDepthOfAutomationAncestors:r,immediateAncestorRecurrenceType:o}}function C(t){var e;const{recurrence:n,afterDate:o}=t;if("number"===(null===(e=n.end_condition)||void 0===e?void 0:e.type)||n.start_date>=o)return n;let i=r().c9.fromMillis(n.start_date,{zone:"utc"});const s=r().c9.fromMillis(o,{zone:"utc"});switch(n.frequency){case"year":{const t=Math.floor(s.diff(i,"years").years/n.interval);i=i.plus({years:t*n.interval});break}case"month":{const t=Math.floor(s.diff(i,"months").months/n.interval);i=i.plus({months:t*n.interval});break}case"week":{const t=Math.floor(s.diff(i,"weeks").weeks/n.interval);i=i.plus({weeks:t*n.interval});break}case"day":{const t=Math.floor(s.diff(i,"days").days/n.interval);i=i.plus({days:t*n.interval});break}}return{...n,start_date:(0,c().DH)(i.toMillis())}}function M(t){const{recurrence:e,afterDate:n}=t;if((0,p().wt)(e)){const t=(0,c().l1)(n);return e.start_date>=t?new Date(e.start_date):void 0}{const t=b(C({recurrence:e,afterDate:n})).after((0,c().eU)(n));if(!t)return;return(0,c().h1)(t)}}function R(t){return 0===t.hour||1===t.hour||2===t.hour}function F(t){return b(t).after((0,c().eU)((0,c().Rz)()))||void 0}function T(t){const{recurrence:e,intl:n}=t,o=F(j(e));if(!o)return;const i=R(e),s=r().c9.fromJSDate(o).toUTC().setZone("local",{keepLocalTime:!0}).setLocale((0,l().H)(n)).setZone(e.timezone),a=(0,d().Yq)({date:s,dateFormat:"relative",allowRelativeDates:!0,intl:n,shortenDate:!0});if(i)return n.formatMessage(g.dateBetweenMidnightAnd3AM,{date:a});{let t=s.toLocaleString(r().c9.TIME_SIMPLE);return e.timezone!==(0,u().P)()&&(t+=` ${s.toFormat("ZZZZ")}`),n.formatMessage(g.dateAtTime,{date:a,time:t})}}function $(t,e){return(0,s().O9)(t)?"number"===t.type?e.formatMessage(g.numberEndConditionDescription,{number:t.number_of_occurrences}):"date"===t.type?(0,d().Yq)({date:r().c9.fromMillis(t.end_at),dateFormat:"relative",allowRelativeDates:!0,intl:e,shortenDate:!0}):void(0,s().HB)(t):e.formatMessage(g.noEndCondition)}const I=100;function A(t){return{...t,start_date:(0,c().l1)(t.start_date),end_condition:t.end_condition?"number"===t.end_condition.type?t.end_condition:"date"===t.end_condition.type?{type:"date",end_at:(0,c().l1)(t.end_condition.end_at)}:(0,s().HB)(t.end_condition):void 0}}function x(t,e,n){return t.plus(n-e)}function D(t,e){const n=r().c9.fromMillis(e.end_at).set({hour:t.hour??0,minute:t.minute??0});return{type:"date",end_at:(0,c().Rz)(n.toJSDate())}}function j(t){return{...t,start_date:(0,c().Rz)(new Date(t.start_date)),end_condition:t.end_condition?"number"===t.end_condition.type?t.end_condition:"date"===t.end_condition.type?D(t,t.end_condition):(0,s().HB)(t.end_condition):void 0}}function N(t,e){const n=i().fN(t,(t=>void 0!==t)),r=i().fN(e,(t=>void 0!==t));return i().n4(n,r)}},424141:(t,e,n)=>{n.d(e,{y:()=>s});var r=()=>n(56366),o=()=>n(743246),i=()=>n(630116);function s(t){return(0,r().K8)((()=>{var e;if(!t)return;const n=null===(e=t.getFormat())||void 0===e?void 0:e.workflow_id;return n?i().NU.createChildStore(t,{table:o().C0,id:n,spaceId:t.getSpaceId()}):void 0}),[t])}}}]);