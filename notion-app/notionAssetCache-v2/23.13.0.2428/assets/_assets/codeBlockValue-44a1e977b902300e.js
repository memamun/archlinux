"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[69734],{141768:(e,t,n)=>{n.d(t,{YH:()=>s,bi:()=>r});n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(803949),n(581454),n(908872);var o=()=>n(919709),i=()=>n(496603),a=()=>n(713972);function r(e){let t="";const n=document.createElement("div");n.innerHTML=e;const o=a().zn(n);for(const a of o){const e=i().ih(a.data);if(null!==a.parentElement&&a.parentElement!==n){t+=`<span class="${l({parent:a.parentElement,root:n}).join(" ")}">${e}</span>`}else t+=e}return t}function l(e){const{parent:t,root:n}=e,o=new Set;let i=t;for(;i&&i!==n;)i.classList.forEach((e=>{o.add(e)})),i=i.parentElement??void 0;return Array.from(o)}function s(e,t){const n={text:c(e),syntax:c(t)},i=function(e){let t=0;return e.reduce(((e,n)=>(e.push([t,n]),t+=n,e)),[])}(function(e,t){const n=e.slice(),o=t.slice(),i=[];let a=0,r=0;for(;a<n.length&&r<o.length;){const e=n[a],t=o[r];e===t?(i.push(e),a+=1,r+=1):e<t?(i.push(e),a+=1,o[r]-=e):(i.push(t),n[a]-=t,r+=1)}return i}(n.text,n.syntax)),a={text:0,syntax:0},r={text:0,syntax:0},l=[],s=e.map(o().N8A).join("");for(const[o,c]of i){const e=o+c,i=t[a.syntax],u={value:s.substring(o,e),textTokenIndex:a.text,classNames:(d=i,d&&d[1])};l.push(u);const m=n.text[a.text],g=n.syntax[a.syntax];e>=r.text+m&&(a.text+=1,r.text+=m),e>=r.syntax+g&&(a.syntax+=1,r.syntax+=g)}var d;return l}function c(e){return e.map((e=>e[0].length))}},849332:(e,t,n)=>{n.r(t),n.d(t,{CodeBlockValueWithDeps:()=>D});n(18107),n(967357),n(581454);var o=n(296540),i=()=>n(56366),a=()=>n(979004),r=()=>n(379632),l=()=>n(919709),s=()=>n(983650),c=()=>n(496603),d=()=>n(884107),u=()=>n(606952),m=()=>n(315097),g=()=>n(317909),p=()=>n(659602),v=()=>n(354584),f=()=>n(335722),k=()=>n(921855),b=()=>n(713972),h=()=>n(231722),C=()=>n(141768),S=()=>n(645873),x=()=>n(77246),y=()=>n(735372),M=()=>n(871399),A=n(474848);const w=1e4,T=o.memo((function(e){const{disabled:t,store:p,blockStore:v,markdownLinkifyIt:f,codeWrap:b,wrapStyle:S,tinyMceMicrosoftWordPasteFilter:T,language:D,Prism:V,parentSpaceId:F,isQuickFind:H,style:R}=e,_=(0,n(959013).tz)(),U=(0,n(484714).v3)(),j=(0,n(401497).DP)(),O=(0,n(792485).S)(),$=(0,o.useRef)(null),L=(0,n(493720).RJ)(),W=(0,i().O$)(n(24157).default),q=(0,i().O$)(n(116008).A),K=(0,i().O$)(n(555776).A),z=(0,i().O$)(y().qu),J=(0,i().O$)(y().wb),Y=(0,i().K8)((()=>O&&O.publicEditModeStore.state),[O]),G=(0,i().K8)((()=>O&&O.pageStore?x().Uv.getMode(O.pageStore):"default"),[O]),Q=(0,i().K8)((()=>p.canEdit()),[p]),Z=(0,i().K8)((()=>p.canComment()),[p]),X=(0,o.useMemo)((()=>{var e;return"editing"===W.mode&&(null===(e=(0,h().H7)(W.multiSelection))||void 0===e?void 0:e.store)===p}),[p,W]),ee=(0,o.useCallback)((()=>{var e;null===(e=$.current)||void 0===e||null===(e=e.getNode())||void 0===e||e.blur()}),[$]),te=(0,o.useMemo)((()=>{var e;return q.open&&"inline"===q.type&&(null===(e=(0,h().H7)(q.multiSelection))||void 0===e?void 0:e.store)===p}),[q,p]),ne=(0,o.useCallback)((()=>{if((0,n(731320).QT)(Y))return!1;const e=null!=O&&O.pageStore?G:"default";return!(t||"suggest"!==e||!Z)||Boolean(!t&&Q)}),[t,null==O?void 0:O.pageStore,Y,G,Q,Z]),oe=(0,o.useMemo)((()=>!ne()),[ne]),ie=(0,i().K8)((()=>{if(!K.isHovered||"right_margin_button"!==K.hoverEntryPoint)return!1;const e=M().default.state.isOpen?M().default.state.currentStore:void 0;return p&&(null==e?void 0:e.id)===p.id}),[p,K]),ae=(0,o.useMemo)((()=>{const e=(0,n(792540).wc)(J)&&J.id===p.id;return{query:z,focusedResult:e?J:void 0}}),[J,z,p.id]),re=(0,o.useCallback)((e=>{var t,o;if(!ne)return;if(B("typing_enter",v,p,U),null===(t=e.preventDefault)||void 0===t||t.call(e),$&&null!==(o=$.current)&&void 0!==o&&o.isComposing())return;const i="editing"===W.mode&&(0,h().H7)(W.multiSelection);if(i){const e=null!=O&&O.pageStore?G:"default";!function(e){const{environment:t,editorMode:o,store:i,selection:a}=e;let r="";if(n(508496).default.checkGate({gateName:"code_block_preserve_indent"})){const e=l().Ffo(i.getValue(),0,a.startIndex),t=l().q4_(e).split("\n").at(-1),n=null==t?void 0:t.match(/^[ \t]+/);n&&(r=n[0])}g().createAndCommit({userAction:"CodeBlockValue.handleEnter",environment:t,canUndo:!0,perform:e=>{u().$D({environment:t,editorMode:o,store:i,string:`\n${r}`,selection:a,disableMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,transaction:e})}})}({environment:U,store:p,editorMode:e,selection:i.selection})}}),[p,U,v,O,$,ne,W,G]),le=(0,o.useCallback)((e=>{var t;k().HP({environment:U,event:e,textValue:P({store:p,blockStore:v,inPageFindDetails:ae,isNewDiscussionMenuTarget:te,isRightMarginCommentActionHovered:ie}),editorNode:(null===(t=$.current)||void 0===t?void 0:t.getNode())||void 0,store:p,canEdit:ne()})}),[p,U,v,ne,ae,$,te,ie]),se=(0,o.useCallback)((e=>{if(ne()&&(B("typing_delete",v,p,U),"editing"===W.mode&&W.multiSelection.start.store===p)){const t=null!=O&&O.pageStore?G:"default";g().createAndCommit({userAction:"CodeBlockValue.handleDelete",environment:U,canUndo:!0,perform:n=>{m().wT({environment:U,multiSelection:W.multiSelection,deleteForwards:!0,transaction:n,event:e,editorMode:t})}})}}),[U,p,v,ne,O,W,G]),ce=(0,o.useCallback)((e=>{if(ne()&&(B("typing_backspace",v,p,U),"editing"===W.mode&&W.multiSelection.start.store===p)){if(m().CZ({device:U.device,event:e,multiSelection:W.multiSelection}))return;const t=null!=O&&O.pageStore?G:"default";g().createAndCommit({userAction:"CodeBlockValue.handleBackspace",environment:U,canUndo:!0,perform:n=>{m().wT({environment:U,multiSelection:W.multiSelection,deleteForwards:!1,transaction:n,event:e,editorMode:t})}})}}),[U,p,v,ne,O,W,G]),de=(0,o.useCallback)((e=>{var t;if(ne()&&(B("typing_enter",v,p,U),null===(t=e.preventDefault)||void 0===t||t.call(e),"editing"===W.mode)){const e=null!=O&&O.pageStore?G:"default";g().createAndCommit({userAction:"CodeBlockValue.handleShiftEnter",environment:U,canUndo:!0,perform:t=>{n(261374).Ve({environment:U,editorMode:e,multiSelection:W.multiSelection,transaction:t})}}),E()}}),[U,p,v,ne,null==O?void 0:O.pageStore,W,G]),ue=(0,o.useCallback)((e=>{if(!ne())return;B("typing_tab",v,p,U),e.preventDefault();const t="editing"===W.mode&&(0,h().H7)(W.multiSelection);if(t){const e=null!=O&&O.pageStore?G:"default";g().createAndCommit({userAction:"CodeBlockValue.handleTab",environment:U,canUndo:!0,perform:n=>{u().RJ({environment:U,editorMode:e,store:p,selection:t.selection,transaction:n,shouldStripTokens:!0})}})}}),[U,p,v,ne,null==O?void 0:O.pageStore,W,G]),me=(0,o.useCallback)((e=>{if(!ne())return;B("typing_untab",v,p,U),e.preventDefault();const t="editing"===W.mode&&(0,h().H7)(W.multiSelection);if(t){const e=null!=O&&O.pageStore?G:"default";g().createAndCommit({userAction:"CodeBlockValue.handleUntab",environment:U,canUndo:!0,perform:n=>{u().Ye({environment:U,editorMode:e,store:p,selection:t.selection,transaction:n,shouldStripTokens:!0})}})}}),[U,p,v,ne,O,W,G]),ge=(0,o.useCallback)((async e=>{if(!ne())return void e.preventDefault();(await d().R.clipboardActions.load()).cutWithMaybeConfirmation({environment:U,event:e,markdownLinkifyIt:f})}),[U,f,ne]),pe=(0,o.useCallback)((async e=>{if(!ne())return void e.preventDefault();const t=await d().R.clipboardActions.load();g().createAndCommit({userAction:"CodeBlockValue.handlePaste",environment:U,canUndo:!0,perform:n=>{t.paste({environment:U,event:e,disableEmbedMenu:!0,transaction:n,onPasteFiles:t.pasteFilesForBlocks,formulasModule:void 0,markdownLinkifyIt:f,tinyMceMicrosoftWordPasteFilter:T})}})}),[U,f,T,ne]),ve=(0,o.useCallback)((e=>{var t;k().sp({environment:U,event:e,textValue:P({store:p,blockStore:v,inPageFindDetails:ae,isNewDiscussionMenuTarget:te,isRightMarginCommentActionHovered:ie}),editorNode:(null===(t=$.current)||void 0===t?void 0:t.getNode())||void 0,store:p,canEdit:ne()})}),[ne,U,ae,$,p,v,te,ie]),fe=(0,o.useCallback)((e=>{var t;k().W5({environment:U,event:e,textValue:P({store:p,blockStore:v,inPageFindDetails:ae,isNewDiscussionMenuTarget:te,isRightMarginCommentActionHovered:ie}),editorNode:(null===(t=$.current)||void 0===t?void 0:t.getNode())||void 0,store:p,canEdit:ne()})}),[ae,p,v,te,ie,$,ne,U]),ke=(0,o.useCallback)((()=>{if(X)return(0,n(792002).Do)(p)}),[X,p]),be=(0,o.useCallback)((()=>{const e=n(634201).PE(l().q4_(P({store:p,blockStore:v,inPageFindDetails:ae,isNewDiscussionMenuTarget:te,isRightMarginCommentActionHovered:ie})));return{startIndex:e.length,endIndex:e.length}}),[p,v,ae,te,ie]),he=(0,o.useRef)(),Ce=(0,o.useCallback)((()=>{const e=P({store:p,blockStore:v,inPageFindDetails:ae,isNewDiscussionMenuTarget:te,isRightMarginCommentActionHovered:ie}),t=l().q4_(e),i=V.languages[D];D!==a().PrismLanguages.html&&D!==a().PrismLanguages.markup||(V.languages.markup.tag.addInlined("style","css"),V.languages.markup.tag.addInlined("script","javascript"));const d=t.length>=w,u=he.current;if(he.current=t.length,t&&i&&!d){const n=document.createElement("div"),a=V.highlight(t,i,D);n.innerHTML=C().bi(a);const d=Array.from(n.childNodes).map(I),u=function(e){let{syntaxTokens:t,textValue:n,parentSpaceId:o,store:i,theme:a}=e;const r=s().E7(n&&{value:n,spaceId:o},i.getRecordModel),c=C().YH(r,t),d=r.map(l().uPN).map((e=>s().sT({annotations:e,theme:a,spaceId:o,getRecordModel:i.getRecordModel})));return c.map(((e,t)=>(0,A.jsx)("span",{className:[e.classNames||"",...d[e.textTokenIndex].classNames].join(" "),style:d[e.textTokenIndex].style,"data-token-index":e.textTokenIndex,children:e.value},t)))}({parentSpaceId:F,store:p,syntaxTokens:c().oE(d),textValue:e,theme:j}),m=(0,A.jsxs)(o.Fragment,{children:[u,(0,A.jsx)("span",{children:"\n"})]});return r().A.renderToStaticMarkup(m)}d&&"number"==typeof u&&u<w&&function(e){const{intl:t}=e,o=new Intl.NumberFormat(t.locale),i=o.format(w);n(812182).HK({presentationType:"transient",title:t.formatMessage({id:"codeBlock.maxChars.toast.title",defaultMessage:"Code highlighting disabled"}),message:t.formatMessage({id:"codeBlock.maxChars.toast.message",defaultMessage:"Syntax highlighting is not supported for more than {numBlocks} characters"},{numBlocks:i})})}({intl:_});const m=k().S5({environment:U,textValue:e&&{value:e,spaceId:F},parentStore:p,disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!0,disableSuggestionAnnotations:!1,disabled:!ne(),theme:j,emojiType:"raw",katex:void 0,formulaValueTypes:[]});return r().A.renderToStaticMarkup((0,A.jsx)(A.Fragment,{children:m}))}),[ae,p,v,te,ie,U,ne,F,V,D,j,_]),Se=(0,o.useCallback)((()=>{g().createAndCommit({userAction:"CodeBlockValue.handleMoveUp",environment:U,canUndo:!0,perform:e=>{u().$P({environment:U,transaction:e,direction:"up"})}})}),[U]),xe=(0,o.useCallback)((()=>{g().createAndCommit({userAction:"CodeBlockValue.handleMoveDown",environment:U,canUndo:!0,perform:e=>{u().$P({environment:U,transaction:e,direction:"down"})}})}),[U]),ye=(0,o.useCallback)(((e,t)=>{ne()&&(t.preventDefault(),n(482287).po({environment:U,annotation:e}),E())}),[ne,U]),Me=(0,o.useCallback)((e=>{const{newValue:t}=e;B("typing_lag",v,p,U);const n=null!=O&&O.pageStore?x().Uv.getMode(null==O?void 0:O.pageStore):"default";g().createAndCommit({userAction:"CodeBlockValue.handleMutation",environment:U,canUndo:!0,perform:e=>{u().dw({environment:U,editorMode:n,store:p,newValue:t,disableMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,disableFilters:!0,transaction:e})}})}),[v,U,p,null==O?void 0:O.pageStore]),Ae=(0,o.useCallback)((async e=>{(await d().R.clipboardActions.load()).copy({environment:U,event:e,markdownLinkifyIt:f})}),[U,f]),we=(0,o.useCallback)(((e,t,o)=>{let{leafRef:i,wrapperRef:a,...r}=e;if($)return(0,A.jsx)("div",{ref:a,style:{display:"flex",padding:"12px 0px",...!b&&{overflowX:"auto",WebkitOverflowScrolling:"touch"},...S},className:"line-numbers notion-code-block",...r,children:(0,A.jsx)(n(477450).A,{leafRef:L($,i),style:{...N(j,R),...H&&{paddingTop:12},...b?{whiteSpace:"break-spaces",wordBreak:"break-all",minWidth:0}:{whiteSpace:"pre"}},debugName:"CodeBlockValue",store:p,isDisabled:oe,getHtml:Ce,getSelection:ke,onMutation:e=>Me(e),spellCheck:!1,autoCorrect:"off",autoCapitalize:"off",onSelect:t,onMouseOver:ve,onMouseOut:fe,suppressNewlineEvents:!1,placeholder:" ",disableContentEditableWhenNotEditingTextOnMobile:!0,expandSelectionOnTripleClick:!1})})}),[H,b,S,j,R,oe,Ce,ke,Me,ve,fe,L,$,p]);return(0,A.jsx)(n(89793).F,{store:p,disabled:t,clearBrowserSelection:ee,onBlur:ee,getEndSelection:be,onClick:le,onDelete:se,onBackspace:ce,onEnter:re,onShiftEnter:de,onCommandEnter:c().D_,onCommandShiftEnter:c().D_,onTab:ue,onUntab:me,onToggleHighlight:e=>ye(["h",n(77272).A.getMostRecentlyUsedColor()],e),onToggleBold:e=>ye(["b"],e),onToggleItalics:e=>ye(["i"],e),onToggleUnderline:e=>ye(["_"],e),onToggleStrike:e=>ye(["s"],e),onToggleCode:c().D_,onCopy:e=>Ae(e),onCut:ge,onPaste:pe,onMoveUp:Se,onMoveDown:xe,render:we,disableMentions:!0,disableSlashCommands:!0,canSelectAllBlocks:!0,canInsertText:!0,canSelectionDrag:!0,topBottomPadding:40,pasteBehavior:"inline"})}));function D(e){const{value:t}=(0,S().fJ)(v().y),{value:n}=(0,S().fJ)(p().g),{value:o}=(0,S().fJ)(f().S);return t?(0,A.jsx)(T,{...e,Prism:t,markdownLinkifyIt:n,tinyMceMicrosoftWordPasteFilter:o}):null}function E(){n(908006).default.flush()}function B(e,t,o,i){(0,n(267856).D)({type:e,environment:i,blockStore:t,store:o,isInCollectionView:!1})}function I(e){return b().KH(e)?[e.data]:b().vq(e)?[e.textContent||"",e.className]:void 0}function N(e,t){return{flexGrow:1,flexShrink:1,textAlign:"left",fontFamily:n(284371).vc(n(662303).locale).githubMono,fontSize:"85%",tabSize:2,minHeight:"1em",color:e.regularTextColor,...t}}function P(e){const{store:t,blockStore:n,inPageFindDetails:o,isNewDiscussionMenuTarget:i,isRightMarginCommentActionHovered:a}=e;let r=t.getValue();if(o.query&&(r=k().nu({textValue:r,blockId:null==n?void 0:n.id,find:o.query,textProps:{type:"block_match"},currentFocusedResult:o.focusedResult})),a){const e=l().qAZ(r);return k().PB({store:t,temporaryAnnotation:l().Ifu.TemporarySelection,multiSelection:{start:{store:t,index:0},end:{store:t,index:e.length}}})}return i?k().Fm({store:t}):r}}}]);