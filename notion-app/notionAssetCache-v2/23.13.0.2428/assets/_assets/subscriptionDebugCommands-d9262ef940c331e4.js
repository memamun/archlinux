"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[99355],{846398:(e,t,n)=>{n.r(t),n.d(t,{SubscriptionDebugCommands:()=>E});n(16280),n(898992),n(672577),n(737550);var r=n(296540),a=()=>n(466103),i=()=>n(484714),o=()=>n(56366),s=()=>n(604341),c=()=>n(386164),u=()=>n(762433),d=()=>n(47273),l=()=>n(323063),m=()=>n(76118),p=()=>n(622963),S=()=>n(496603),f=()=>n(449506),g=()=>n(44729),b=()=>n(246826),v=()=>n(317909),y=()=>n(755199),h=()=>n(108184),_=()=>n(11978),A=()=>n(351360),I=()=>n(1346),k=()=>n(998497),U=()=>n(324561),w=()=>n(134217),C=()=>n(972418),D=()=>n(847554),B=()=>n(668721),x=()=>n(749240);function E(){const e=(0,i().v3)(),t=(0,_().O)(),n=(0,o().O$)(x().subscriptionDataStoreInstance),a=(0,D().b)(n),c=(0,U().f_)({spaceId:t}),m=(0,C().o2)(),g=(0,o().K8)((()=>A().default.state.currentSpaceStore),[]),[E,N]=(0,r.useState)(!1);return(0,s().exposeDebugValue)("subscriptions",{updateSubscription:async function(){var t;let{billingInterval:n="month",products:r=["plus"],cancelImmediately:a=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!g||!c||"admin"!==c.type)return;if(E)return;const i="subscription_debug_commands",o=r[0],s=(null===(t=(0,u().KH)(c,"sites_custom_hostnames"))||void 0===t?void 0:t.quantity)??0,f=(0,u().lQ)(c),b=(0,d().j8)(f)??"USD",v=(0,d().GB)({spaceId:g.id,logFunction:()=>{},subscriptionState:f}),y=(0,u().yB)({spaceId:g.id,logFunction:()=>{},billingData:c}),h=v??y??1;let _;if("free"===o)_=(0,l().gL)(f,"plan");else{if(!(b&&n&&h))throw new Error("Trying to update plan on a subscription with no items");{const e={product:o,currency:b,interval:n};_=(0,l().qq)((0,p().Nw)({prices:m,quantity:h,domainsQuantity:s}),f,e)}}if(!S().n4(f,_)){N(!0);try{if((0,l().V5)(f,_)&&a&&await(0,k().cancelSubscription)({environment:e,spaceStore:g,from:i,cancelImmediately:a}),"free"===o)return;await(0,k().updateSubscription)({environment:e,spaceStore:g,desiredState:_,from:i,paymentData:{type:"paymentMethodId",value:"pm_card_visa"}})}finally{N(!1)}}},getAiUsage:()=>{const e=B().A.state;if(!e)throw Error("AI usage store not found");return{spaceUsage:e.spaceUsage,spaceUsageLimit:e.spaceLimit,userUsage:e.userUsage,userUsageLimit:e.userLimit}},getBlockUsage:()=>{const n=x().subscriptionDataStoreInstance.state;if(!n||!t)throw Error("Subscription data store not found");return{blockLimitCount:(0,w().hr)(e,t,n,a)}},resetDeleteBlocksModal:()=>{const t=A().default.state.currentSpaceViewStore;t&&v().createAndCommit({userAction:"DeleteBlocksModal.showDeleteBlocksModal",environment:e,canUndo:!0,perform:e=>{v().applyOperation({store:t,operation:{pointer:t.pointer,path:["settings"],command:"update",args:{...t.getSettings(),seen_delete_blocks_modal:!1}},transaction:e})}})},resetStudentAiPopup:()=>{const t=A().default.state.currentUserSettingsStore;v().createAndCommit({userAction:"dismissedStudentAiPopup.reset",environment:e,canUndo:!0,perform:e=>{y().mJ({transaction:e,userSettingsStore:t,data:{dismissed_student_ai_popup:!1}})}})},resetReverseTrialSidebarAlert:()=>{const t=A().default.state.currentUserSettingsStore;v().createAndCommit({userAction:"ReverseTrialSidebarAlert.resetDismissal",environment:e,canUndo:!0,perform:e=>{y().mJ({transaction:e,userSettingsStore:t,data:{reverse_trial_sidebar_alert_dismissed_at:void 0}})}})},sendMemberRequestForAddOn:()=>{const t=A().default.state.currentSpaceStore;t&&I().jB({environment:e,spaceStore:t,from:"ai_qna_limit_in_app"})},recordAIUsage:async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const n=A().default.state.currentSpaceStore;n&&(await f().callApi({eventName:"recordAIUsage",environment:e,data:{spaceId:n.id,usage:t}}),await(0,h().maybeUpdateAiEligibility)(e,n.id,!0))},recordBlockUsage:e=>{x().subscriptionDataStoreInstance.update((t=>t&&"blockUsage"in t?{...t,blockUsage:e}:t))},resetReachBlockLimitTime:()=>{const t=A().default.state.currentSpaceStore;t&&v().createAndCommit({userAction:"SubscriptionDebugCommands.resetReachBlockLimitTime",environment:e,canUndo:!0,perform:e=>{b().zv({store:t,data:{settings:{...t.getSettings(),reach_block_limit_time:void 0}},transaction:e})}})}}),null}function N(e,t,r,a){v().createAndCommit({userAction:"SubscriptionDebugCommands.addBlocksToPage",environment:r,canUndo:!0,perform:i=>{S().Hn(e,(()=>{const e=b().Wv({environment:r,type:"text",inMemoryRecordCache:t.inMemoryRecordCache,transaction:i,properties:{title:[[a||"money team is the best team"]]}});g().NI({parentStore:t.getContentStore(),childStore:n(630116).Bv.createChildStore(t.getContentStore(),e.pointer),transaction:i})}))}})}function P(e,t,n){const r=t.getContentStores().slice(-e);v().createAndCommit({userAction:"SubscriptionDebugCommands.removeBlocksFromPage",environment:n,canUndo:!0,perform:e=>{for(const n of r)g().zz({parentStore:t.getContentStore(),childStore:n,transaction:e})}})}(0,a().exposeDebugEnvironmentValue)("getStripeLinks",(e=>function(){var t,r;let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const i=null===(t=A().default.state.currentSpaceStore)||void 0===t?void 0:t.id;if(!i)return"No space id found";const o=n(57605).A.getData(e,{spaceId:i});if(!o)return"No billing data found";const s=a?"https://dashboard.stripe.com/test":"https://dashboard.stripe.com";return{customer:o.externalId?`${s}/customers/${o.externalId}`:"No customer id found",subscription:null!==(r=o.subscription)&&void 0!==r&&r.externalId?`${s}/subscriptions/${o.subscription.externalId}`:"No subscription id found"}})),(0,a().exposeDebugEnvironmentValue)("addBlocksToPage",(e=>(t,n)=>{const r=A().default.state.currentSpaceStore,a=A().default.state.mainEditorCurrentBlockStore;r&&a&&(t<100?N(t,a,e,n):S().Hn(t/100,(()=>{N(100,a,e,n)})))})),(0,a().exposeDebugEnvironmentValue)("removeBlocksFromPage",(e=>t=>{const n=A().default.state.currentSpaceStore,r=A().default.state.mainEditorCurrentBlockStore;n&&r&&(t<100?P(t,r,e):S().Hn(t/100,(()=>{P(100,r,e)})))})),(0,a().exposeDebugEnvironmentValue)("testPremiumFeatureAvailability",(e=>async t=>{const n=A().default.state.currentSpaceStore;if(!n)return"No active space";const r=m().R0[t];if(!r)return`Unknown feature: ${t}`;let a;a="check"===r.type?"true":"unlimited",await(0,k().cancelSubscription)({environment:e,spaceStore:n,from:"subscription_debug_commands",cancelImmediately:!0});const i=n.id;return"success"===(await f().callApi({eventName:"overridePremiumFeatureAvailability",environment:e,data:{spaceId:i,feature:t,featureValue:a},headers:(0,c().WS)({cellId:void 0,spaceId:i})})).type?`Successfully enabled premium feature: ${t}`:"Something went wrong"})),(0,a().exposeDebugEnvironmentValue)("testPremiumFeatureUnavailability",(e=>async t=>{const r=A().default.state.currentSpaceStore;if(!r)return"No active space";const a=m().R0[t];if(!a)return`Unknown feature: ${t}`;let i;i="check"===a.type?"false":"0";const o=await(0,n(779795).p_)({environment:e,spaceId:r.id}),s=["enterprise","ai"].map((e=>({quantity:1,price:o.find((t=>t.product===e&&"month"===t.billingInterval))})));if(s.some((e=>!e.price)))return"Could not find prices for all items";await(0,k().updateSubscription)({environment:e,spaceStore:r,desiredState:{items:s,trialEnd:void 0},from:"subscription_debug_commands",paymentData:{type:"paymentMethodId",value:"pm_card_visa"}});return"success"===(await f().callApi({eventName:"overridePremiumFeatureAvailability",environment:e,data:{spaceId:r.id,feature:t,featureValue:i},headers:(0,c().WS)({cellId:void 0,spaceId:r.id})})).type?`Successfully disabled premium feature: ${t}`:"Something went wrong"}))}}]);