"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[38664],{422540:(e,t,o)=>{o.d(t,{$0:()=>_,Fx:()=>k,Ge:()=>d,I3:()=>s,Kj:()=>h,PP:()=>C,TK:()=>M,Yy:()=>p,aE:()=>S,cQ:()=>T,kH:()=>m,m7:()=>y,nq:()=>g,nv:()=>x,tj:()=>f});o(898992),o(354520),o(737550);var n=()=>o(496603),r=()=>o(534177),i=()=>o(970013),l=()=>o(651124),a=()=>o(349835),c=()=>o(390066);(0,r().u0)((e=>(0,r().O9)(e)&&(0,r().O9)(e.target)&&(0,r().O9)(e.external_bot_id)?{true:{external_bot_id:e.external_bot_id,target:e.target,custom_message:e.custom_message}}:{false:e}));const u={checkbox:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,auto_increment_id:!1,button:!1,created_by:!1,created_time:!1,file:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1,geo_point:!1},p={checkbox:[{type:"checkbox"}],date:[{type:"date"}],email:[{type:"text"}],multi_select:[{type:"text"},{of:{type:"text"},type:"array"}],number:[{type:"number"}],person:[{type:"person"},{of:{type:"person"},type:"array"}],phone_number:[{type:"text"}],relation:[{type:"block"},{of:{type:"block"},type:"array"}],select:[{type:"text"},{of:{type:"text"},type:"array"}],status:[{type:"text"},{of:{type:"text"},type:"array"}],text:void 0,title:void 0,url:[{type:"text"}]};function s(e){return Boolean(u[e.type]&&!(0,i().UU)(e)&&(!(0,i().$M)(e)||void 0===(0,i().om)(e)))}function y(e){const{collectionFormat:t,collectionSchema:o,filter:a,sort:u,sourcePropertyIds:p}=e,y=(p??(0,r().uv)(o)).filter(((t,n,r)=>{const l=o[t];return!(!l||!s(l))&&(("relation"!==l.type||!e.restrictCrossSpace||!(0,i().o2)(e.spaceId,l))&&(!a||a([t,l],n,o)))}));if(0===y.length)return[];if(!t||!1===u)return y;const d=(0,c().L)(t,o,void 0,l().jf.Page).collection_page_properties||[];return n().Ul(y,(e=>d.findIndex((t=>t.property===e))))}function d(e){const{collectionFormat:t,collectionSchema:o,sort:a}=e,u=(0,r().uv)(o).filter(((e,t,n)=>{const r=o[e];return!(!r||!(0,i().JY)(r))}));if(0===u.length)return[];if(!t||!1===a)return u;const p=(0,c().L)(t,o,void 0,l().jf.Page).collection_page_properties||[];return n().Ul(u,(e=>p.findIndex((t=>t.property===e))))}function m(e){return e.type===a().M9.InvalidCharacter?{type:e.type,character:e.character}:e.type===a().M9.TokenExpected?{type:e.type,token:e.token}:e.type===a().uW.MissingSchemaPropertyOnThisRow||e.type===a().uW.MissingSchemaPropertyOnCollection?{type:e.type,collectionId:e.collectionId,property:e.property}:e.type===a().uW.ThisRowBlockPropertyMismatchCollection?{type:e.type,thisRowCollection:e.thisRowCollection}:e.type===a().uW.MissingContextVariable?{type:e.type,valueId:e.valueId}:e.type===a().uW.FunctionCallTooFewArguments?{type:e.type,numArguments:e.numArguments}:e.type===a().uW.FunctionCallUnexpectedArgument?{type:e.type,parameterIndex:e.parameterIndex}:e.type===a().uW.FunctionCallArgumentWrongType?{type:e.type,argumentType:e.argumentType,libraryFunctionName:e.libraryFunction.name,parameterIndex:e.parameterIndex}:e.type===a().uW.MissingDataDependencyBlock?{type:e.type,blockPointer:e.blockPointer}:e.type===a().uW.MissingDataDependencyPerson?{type:e.type,personPointer:e.personPointer}:e.type===a().uW.MemberPropertyMismatchCollection?{type:e.type,blockCollection:e.blockCollection}:e.type===a().uW.DownstreamParseFailure?{type:e.type,collectionId:e.collectionId,property:e.property}:e.type===a().uW.ContextVariableWrongType?{type:e.type,valueId:e.valueId,expectedType:e.expectedType,resultType:e.resultType}:e.type===a().uW.DisallowedValueType?{type:e.type,expressionValue:e.expressionValue,allowedValueTypes:e.allowedValueTypes}:e.type===a().uW.LibraryFunctionExecutionError?{type:e.type,error:e.error,libraryFunctionName:e.libraryFunction.name}:{type:e.type}}const f={checkbox:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,button:!1,file:!1,verification:!1,auto_increment_id:!1,created_by:!1,created_time:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1,geo_point:!1};function _(e){return Boolean(f[e.type])}function x(e){const{collectionFormat:t,collectionSchema:o,filter:a,sort:u}=e,p=(0,r().uv)(o).filter(((e,t,n)=>{var r;const l=o[e];return!(!l||!f[l.type])&&((!(0,i().$M)(l)||null===(r=(0,i().om)(l))||void 0===r||!r.auto_update_on_edit)&&(!a||a([e,l],t,o)))}));if(0===p.length)return[];if(!t||!1===u)return p;const s=(0,c().L)(t,o,void 0,l().jf.Page).collection_page_properties||[];return n().Ul(p,(e=>s.findIndex((t=>t.property===e))))}const v={checkbox:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,auto_increment_id:!1,button:!1,created_by:!1,created_time:!1,date:!1,file:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1,geo_point:!1};function g(e){return v[e.type]}const b={checkbox:!0,created_by:!0,created_time:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,last_edited_by:!0,last_edited_time:!0,auto_increment_id:!1,button:!1,file:!1,formula:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1,geo_point:!1};function h(e){return b[e.type]}function T(e){return 0===e}function k(e){return function(e){return"button_block"===e||"button_property"===e}(e)}function C(e){const{property:t,collectionSchema:o}=e;return!!o&&!o[t]}function M(e){const{collectionSchema:t,property:o,type:n}=e,r=null==t?void 0:t[o];return!r||("action"===n?!s(r):!f[r.type])}function S(e){let{automationTrigger:t,collectionSchema:o}=e;if("event"===(null==t?void 0:t.type)){const{pagesAdded:e,pagePropertiesEdited:n,source:i,relativeDate:l}=t.event;if(void 0===i)return!1;const a="some"===n.type&&n.some,c="all"===n.type&&n.all;if((a||c||[]).some((e=>C({collectionSchema:o,property:e.property})||M({collectionSchema:o,property:e.property,type:"trigger"}))))return!1;const u="some"===n.type&&(!(0,r().O9)(n.some)||0===n.some.length),p="all"===n.type&&(!(0,r().O9)(n.all)||0===n.all.length);if(!e&&("none"===n.type||u||p)&&!l)return!1}else{if("recurrence"!==(null==t?void 0:t.type))return!1;if(!t.recurrence)return!1}return!0}},546461:(e,t,o)=>{o.d(t,{EC:()=>h,To:()=>b,YC:()=>T,or:()=>g,u:()=>v});o(16280);var n=o(296540),r=()=>o(484714),i=()=>o(56366),l=()=>o(496506),a=()=>o(322867),c=()=>o(959013),u=()=>o(534177),p=()=>o(813297),s=()=>o(862292),y=()=>o(698331),d=()=>o(645873),m=()=>o(190019),f=o(474848);const _=new WeakMap,x=(0,n.createContext)({automationStore:void 0,contextType:void 0,defined:!1,typecheckResult:void 0});x.displayName="AutomationContext";function v(e){const{automationStore:t,children:o,contextType:n}=e,v=(0,r().v3)(),g=(0,c().tz)(),{value:b}=(0,d().fJ)(s().T.formulas),{value:h}=(0,d().fJ)(p().QV.automationTypecheck),T=(0,i().K8)((()=>{if(!b)return{error:new(a().N9)("Missing formulas dependency")};if(!h)return{error:new(a().N9)("Missing automation dependency")};const e=function(e){const{environment:t,automationStore:o,automationTypecheckModule:n,contextType:r,formulasModule:i,intl:a}=e,c=_.get(o);if(c)return c;{const e=new(l().default)((()=>{const e=o.getTriggerType();let l=r;return(0,u().O9)(e)&&(0,y().x2)(e)&&(l=(0,y().H8)(e)),(0,m().Z)({environment:t,automationStore:o,automationTypecheckModule:n,contextType:l,formulasModule:i,intl:a})}),{debugName:"automationContextTypecheckResultCachedStore"});return _.set(o,e),e}}({environment:v,automationStore:t,automationTypecheckModule:h,contextType:n,formulasModule:b,intl:g});return e.state}),[v,t,h,n,b,g]);return(0,f.jsx)(x.Provider,{value:{automationStore:t,typecheckResult:T,contextType:n,defined:!0},children:o})}function g(e){const{automationStore:t,children:o}=e,n=(0,i().K8)((()=>{var e;return null===(e=t.getTrigger())||void 0===e?void 0:e.type}),[t]);return(0,f.jsx)(v,{automationStore:t,contextType:(0,y().H8)(n??"event"),children:o})}function b(e){var t;return null===(t=_.get(e))||void 0===t?void 0:t.state}function h(){const e=n.useContext(x);if(!1===e.defined)throw new Error("No automation context found!");return e}function T(){return n.useContext(x)}},698331:(e,t,o)=>{o.d(t,{$X:()=>i,H8:()=>l,x2:()=>r});var n=()=>o(534177);function r(e){return"event"===e||"recurrence"===e}function i(e){const t=e.getTrigger();return(0,n().O9)(t)&&r(t.type)}function l(e){return"event"===e?"event":"recurrence"===e?"recurrence":void(0,n().HB)(e)}}}]);