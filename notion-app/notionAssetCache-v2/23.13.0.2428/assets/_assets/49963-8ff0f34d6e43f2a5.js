"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[49963],{42120:(e,t,n)=>{n.d(t,{Dl:()=>ee,U2:()=>Q,Zk:()=>te,_R:()=>K,bE:()=>ne,c:()=>G,cJ:()=>$,eN:()=>X,e_:()=>H,g4:()=>q,qy:()=>Z});n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(803949),n(581454),n(737550);var o=()=>n(244641),a=()=>n(584262),r=()=>n(66689),i=()=>n(890409),s=()=>n(970013),l=()=>n(597777),c=()=>n(604995),d=()=>n(206267),p=()=>n(433847),u=()=>n(912720),m=()=>n(199378),g=()=>n(179034),f=()=>n(519831),S=()=>n(96689),y=()=>n(854150),v=()=>n(950914),C=()=>n(864779),h=()=>n(919709),b=()=>n(374562),k=()=>n(313892),_=()=>n(813297),w=()=>n(465364),A=()=>n(654062),M=()=>n(601734),P=()=>n(989423),x=()=>n(594794),T=()=>n(972435),I=()=>n(351360),V=()=>n(630116),B=()=>n(908447),j=()=>n(966759),D=()=>n(449506),R=()=>n(235191),F=()=>n(686526),L=()=>n(896628),O=()=>n(246826),J=()=>n(867201),E=()=>n(317909),z=()=>n(345913),U=()=>n(755199);const W="week";function K(e){var t;const{environment:n,transaction:o,tasksBlockStore:a,sprintsBlockStore:r}=e,i=null===(t=r.getFormat())||void 0===t?void 0:t.collection_pointer,s=a.getFormat().collection_pointer;if(!i||!s)return;const l=V().md.createChildStore(r,i),c=l.getRole()??"none";if(!(0,p().q_)(c,"editor"))return;l.getAutomationStores().some((e=>e.isCompleteSprintAutomation()))||N({environment:n,transaction:o,sprintCollectionStore:l,taskCollectionStore:V().md.createChildStore(a,s),sprintSettingsConfig:v().AL})}function N(e){const{environment:t,sprintSettingsConfig:n,transaction:o,sprintCollectionStore:a,taskCollectionStore:r}=e,i=a.getSpaceId(),s=(0,x().Z1)({environment:t,table:u().yB,spaceId:i}),l=(0,x().Z1)({environment:t,table:m().SC,spaceId:i});O().eC({environment:t,table:u().yB,inMemoryRecordCache:a.inMemoryRecordCache,value:{id:s,parent_id:a.id,parent_table:a.table,alive:!0,space_id:i,status:n.autoCompleteSprints?"active":"disabled",trigger:{id:d().JW(),type:"recurrence",recurrence:ae(n)},action_ids:[l]},transaction:o}),L().zA({stores:[a],update:{automation_ids:[...a.getFormat().automation_ids??[],s]},transaction:o}),O().eC({environment:t,table:m().SC,inMemoryRecordCache:a.inMemoryRecordCache,transaction:o,value:{id:l,parent_id:s,parent_table:u().yB,type:"complete_sprint",alive:!0,space_id:i,config:{sprint_collection:a.getSpaceShardedPointer(),task_collection:r.getSpaceShardedPointer(),complete_sprint_action:n.actionConfig.complete_sprint_action}}})}function H(e){const{environment:t,automationStore:n,transaction:o,newDuration:a,currentSprintBlockStore:r}=e;O().zv({store:n.getTriggerStore().getKeyStore("recurrence"),data:{interval:a},transaction:o}),Y({environment:t,transaction:o,automationStore:n,currentSprintBlockStore:r})}function q(e){const{environment:t,automationStore:n,transaction:o,newWeekday:a,currentSprintBlockStore:r}=e;O().zv({store:n.getTriggerStore().getKeyStore("recurrence"),data:{weekdays:[a]},transaction:o}),Y({environment:t,transaction:o,automationStore:n,currentSprintBlockStore:r})}function Q(e){const{environment:t,actionStore:n,automationStore:o,transaction:a,newAutocompleteStatus:r,currentSprintBlockStore:s}=e;O().zv({store:o,data:{status:r?"active":"disabled"},transaction:a}),Y({environment:t,transaction:a,automationStore:o,currentSprintBlockStore:s});const l=o.getParentPointer();if(!l||l.table!==f().Vl)return;const c=(0,P().ik)(t),d={automation_id:o.id,automation_actions:[{automation_action_id:n.id,type:"complete_sprint"}],automation_triggers:[{type:"recurrence"}],collection_id:l.id};r?(0,i().Ah)(c,d):(0,i().vN)(c,d)}function Y(e){const{automationStore:t,currentSprintBlockStore:n,transaction:a,environment:i}=e;if(!t.isActive())return;const s=t.getRecurrence();if(!s)return;const c=(0,C().Vv)(s);if(!c)return;const d=n.getPropertyValue(r().Hx.Dates);if(!d)return;const p=(0,h().Cok)(d)[0];if(!p||"daterange"!==p.type)return;const u=p.start_date,{start_date:m,end_date:g}=(0,C().Me)({currentSprintStartDate:u,sprintSchedule:c});O().zv({store:t.getTriggerStore().getKeyStore("recurrence"),data:{start_date:(0,l().Rz)(o().c9.fromISO(m).plus({minutes:1}).toJSDate())},transaction:a}),w().D5({store:n,propertyId:r().Hx.Dates,transaction:a,environment:i,type:"dateValue",dateValue:{type:"daterange",start_date:u,end_date:g}})}function Z(e){const{transaction:t,newRemainingTasksBehavior:n,actionStore:o}=e;O().zv({store:o.getConfigStore(),data:{complete_sprint_action:n},transaction:t})}async function G(e){var t;const{appTemplatesSetupActions:n,appTemplatesSprintBoardActions:o,appConfigs:i}=await M().Aw.load(),{environment:s,collectionContextStore:l,from:c}=e,{currentSpaceViewStore:d}=I().default.state,p=l.collectionStore(),u=null==p?void 0:p.getParentBlockStore(),m=null==u?void 0:u.getParentStore(),f=null==p||null===(t=p.getFormat())||void 0===t?void 0:t.app_config_uri,v=f&&(0,k().lS)(i(),f);if(!p||!u||!m||!d||m.table!==S().NX&&m.table!==g().ev&&m.table!==y().yK||!v)return;const C=u.getFormat().app_id,h=C?await D().callApi({eventName:"getCollectionViewBlocksByAppId",environment:s,data:{spaceId:u.getSpaceId(),appId:C}}):void 0,_="success"===(null==h?void 0:h.type)&&h.data.result.length?h.data.result.map((e=>V().Bv.createChildStore(m,{table:g().ev,id:e.blockId,spaceId:u.getSpaceId()}))):[u];await oe({environment:s,taskCollectionStore:p,executeFn:()=>{const e=E().createAndCommit({userAction:"sprintSettingsActions.handleTurnOnSprints",environment:s,canUndo:!0,perform:e=>{const t=(0,b().We)(),a=n.applyTypedFeatures({environment:s,spaceViewStore:d,appParentStore:m,appUri:v.uri,features:[{type:"simple",featureUri:t.uri}],transaction:e,createOrModify:"modify",appCollectionViewBlockStores:_}),i=o.createSprintPage({environment:s,spaceViewStore:d,appParentStore:m,transaction:e,blockStores:a,creationEntryPoint:{type:"sprint_settings"}});if(F().os({collectionSettingsStore:l.settingsStore}),!i)return;const p=c?{feature:{id:r().yx.TaskToSprintRelation,from:c,type:"notion://projects/tasks_with_sprints_feature"}}:{};return(0,B().Z)({environment:s,collectionContextStore:l,from:"view_settings",property:r().yx.TaskToSprintRelation,property_type:"relation",is_suggested_property:!0,...p}),i}});e.serverCommitResult.then((()=>{const t=e.performResult;t&&J().Y({environment:s,store:t,pageVisitSource:a().y8.Create})}))}})}async function X(e){const{environment:t,collectionContextStore:n,sprintSettingsContext:o,sprintBoardViewBlockIds:i}=e,{sprintCollectionStore:s,automationContext:l,currentCollectionViewBlockStore:c,sprintCollectionViewBlockStore:d,taskCollectionStore:p,taskCollectionViewBlockStore:u}=o;if(!s||!d||!l)return;const m=u.getSpaceId(),f=[d,...i.map((e=>new(V().Bv)(t,{id:e,table:g().ev,spaceId:m})))];c.id===u.id?F().os({collectionSettingsStore:n.settingsStore}):J().Y({environment:t,store:u,pageVisitSource:a().y8.LeaveOrRemove});const{automationActions:S}=await _().QV.automations.load(),{automationStore:y}=l;await oe({environment:t,taskCollectionStore:p,executeFn:()=>{E().createAndCommit({userAction:"sprintSettingsActions.handleTurnOffSprints",environment:t,canUndo:!0,perform:e=>{!function(e){const{transaction:t,blocksToDelete:n,environment:o,taskCollectionStore:a,sprintCollectionStore:i}=e;O().zv({store:i,transaction:t,data:{alive:!1}}),R().BJ({environment:o,collectionStore:a,schema:a.getSchema(),property:r().yx.TaskToSprintRelation,transaction:t,permanentlyDelete:!0}),z().oD({environment:o,blocks:n,transaction:t,permanentlyDelete:!0})}({environment:t,transaction:e,blocksToDelete:f,sprintCollectionStore:s,taskCollectionStore:p}),S.disableAutomation({automationStore:y,environment:t,transaction:e}),S.deleteAutomation({automationStore:y,environment:t,transaction:e})}}),(0,j().i)({environment:t,collectionContextStore:n,property_type:"relation",from:"view_settings",property:r().yx.TaskToSprintRelation})}})}function $(e){const{environment:t,userSettingsStore:n}=e;E().createAndCommit({userAction:"sprintSettingsActions.handleSeenSprintsEngagementBanner",environment:t,canUndo:!0,perform:e=>{U().mJ({userSettingsStore:n,data:{seen_sprint_settings_engagement_banner:!0},transaction:e})}})}function ee(e){e.settingsStore.setState({open:!0,stack:[{type:"main"},{type:"sprintSettings"}]})}function te(e){const{environment:t,collectionContextStore:n,currentViewBlockStore:o,taskCollectionViewBlockStore:a}=e,i=n.collectionViewStore();if(!i)return;const s=i.getFormat(),l=i.getRawQuery();E().createAndCommit({userAction:"sprintSettingsActions.handleManageSprintFromThisView",environment:t,canUndo:!0,perform:e=>{if((0,A().F)({collectionViewStore:i,transaction:e,update:{name:T().A.formatMessage(b().DZ.tasksCurrentSprintV2ViewName),query2:{...l,filter:void 0},format:{...s,collection_view_icon:"/icons/playback-play-button_gray.svg",property_filters:b().Wo,app_config_uri:r().Lu,hide_linked_collection_name:!0}}}),o.id===a.id){var t;const n=(null===(t=o.getFormat())||void 0===t?void 0:t.app_uri_map)??{},l=s.app_config_uri;l&&delete n[l],L().zA({stores:[a],update:{app_uri_map:{...n,[r().Lu]:i.id}},transaction:e})}}})}function ne(e){const{environment:t,sprintSettingsContext:n}=e;if(!n)return;const o=n.sprintCollectionStore,a=(null==o?void 0:o.getRole())??"none";o&&(0,p().q_)(a,"editor")&&n.automationContextLoaded&&!n.automationContext&&E().createAndCommit({userAction:"sprintSettingsActions.ensureCompleteSprintAutomation",environment:t,canUndo:!0,perform:e=>{N({environment:t,transaction:e,sprintCollectionStore:o,taskCollectionStore:n.taskCollectionStore,sprintSettingsConfig:v().AL})}})}async function oe(e){const{executeFn:t,environment:n,taskCollectionStore:o}=e;await async function(e){var t;const{environment:n,taskCollectionStore:o}=e,a=o.getFormat().app_uri_map,i=r().yx.TaskToSprintRelation,l=o.getSchema(),c=(null==a?void 0:a[i])??i,d=l[c];if(!d||!(0,s().nC)(d))return;const p=null===(t=(0,s().Nv)(d))||void 0===t?void 0:t.id;if(!p)return;const u=new Set([c]);Object.entries(l).forEach((e=>{var t;let[n,o]=e;o&&(0,s().nC)(o)&&(null===(t=(0,s().Nv)(o))||void 0===t?void 0:t.id)===p&&u.add(n)}));const{serverCommitResult:m}=E().createAndCommit({userAction:"sprintSettingsActions.clearSprintRelationDataFromTaskCollection",environment:n,canUndo:!0,perform:e=>{for(const t of u)R().BJ({environment:n,transaction:e,permanentlyDelete:!0,collectionStore:o,schema:l,property:t});null==a||delete a[i],a&&L().zA({stores:[o],transaction:e,update:{app_uri_map:a}})}});await m}({environment:n,taskCollectionStore:o}),t()}function ae(e){return{frequency:W,interval:e.recurrenceConfig.interval,weekdays:e.recurrenceConfig.weekdays,start_date:(0,l().Rz)(o().c9.local().set({hour:0,minute:0,second:0,millisecond:0}).toJSDate()),timezone:(0,c().dB)(),hour:0,minute:0}}},63467:(e,t,n)=>{n.d(t,{y:()=>d});var o=()=>n(637997),a=()=>n(267419);const r={ko:()=>n.e(2268).then(n.bind(n,224434)),es:()=>n.e(95264).then(n.bind(n,196425)),de:()=>n.e(35390).then(n.bind(n,653703)),fr:()=>n.e(3272).then(n.bind(n,94677)),pt:()=>n.e(27315).then(n.bind(n,766869)),zh:()=>n.e(69945).then(n.bind(n,516814)),ja:()=>n.e(77757).then(n.bind(n,824432)),da:()=>n.e(9423).then(n.bind(n,440761)),fi:()=>n.e(59337).then(n.bind(n,462135)),nb:()=>n.e(2040).then(n.bind(n,937314)),nl:()=>n.e(51106).then(n.bind(n,530897)),sv:()=>n.e(53631).then(n.bind(n,895222))};let i=!1,s=!1;async function l(e){for(const[n,a]of Object.entries(e.emojiLocaleKeywords)){var t;o().fB[n]={...o().fB[n],keywords:[...a,...(null===(t=o().fB[n])||void 0===t?void 0:t.keywords)||[]]}}await a().A.waitUntilLoaded(),a().A.update((t=>{let{emojiByName:n,...o}=t;return{...o,emojiByName:{...n,...e.emojiByName}}}))}async function c(){if(i)return;const[e]=n(662303).locale.split("-");e in r&&(await l(await r[e]()),i=!0)}const d=(0,n(279900).A)((async()=>{await async function(){s||(await l(await n.e(51872).then(n.bind(n,443716))),s=!0)}(),await c()}))},77126:(e,t,n)=>{n.d(t,{j:()=>a});class o extends(()=>n(959180))().A{}const a=new o},104636:(e,t,n)=>{n.d(t,{Is:()=>d,LS:()=>m,NH:()=>g,QA:()=>u,_b:()=>p});n(944114);var o=()=>n(244641),a=(n(296540),()=>n(390527)),r=()=>n(604995),i=()=>n(959013),s=()=>n(534177),l=()=>n(108944),c=n(474848);function d(e){const t=l().g7(e)??[],n=[];for(const o of t){if(!("block"===o.table&&!0===o.isTemplate()&&o.getFormat().automation_id&&o.id!==e.id))continue;const t=o.getAutomationStore();if(t){if(!t.isReady())return{automationStoresReady:!1};void 0!==t.getRecurrence()&&t.isDefined()&&n.push(t.getModel())}}return{automationStoresReady:!0,...(0,a().templateAncestorsViolateRecurrenceNesting)(n)}}function p(e){switch(e){case"day":return(0,c.jsx)(i().sA,{defaultMessage:"Repeat daily",id:"database.templatePickerItem.recurrenceFrequency.daily"});case"week":return(0,c.jsx)(i().sA,{defaultMessage:"Repeat weekly",id:"database.templatePickerItem.recurrenceFrequency.weekly"});case"month":return(0,c.jsx)(i().sA,{defaultMessage:"Repeat monthly",id:"database.templatePickerItem.recurrenceFrequency.monthly"});case"year":return(0,c.jsx)(i().sA,{defaultMessage:"Repeat yearly",id:"database.templatePickerItem.recurrenceFrequency.yearly"});default:(0,s().HB)(e)}}function u(){return{start_date:o().c9.local().plus({days:1}).set({hour:0,minute:0,second:0,millisecond:0}).toMillis(),timezone:(0,r().dB)(),hour:0,minute:0,frequency:"day",interval:1}}function m(e){const{recurrence:t,intl:n,leadingPhrase:o}=e;return(0,a().rruleFromRecurrence)({..."month"===t.frequency?{...t,monthly_restriction:void 0}:t,weekdays:void 0,hour:0,minute:0,end_condition:void 0}).toText((e=>{switch(e){case"every":if(void 0===o)return"";if("every"===o)return n.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.every",defaultMessage:"every"});if("repeat every"===o)return n.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.repeatEvery",defaultMessage:"repeat every"});(0,s().HB)(o);break;case"day":return n.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.day",defaultMessage:"day"});case"days":return n.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.days",defaultMessage:"days"});case"week":return n.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.week",defaultMessage:"week"});case"weeks":return n.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.weeks",defaultMessage:"weeks"});case"month":return n.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.month",defaultMessage:"month"});case"months":return n.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.months",defaultMessage:"months"});case"year":return n.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.year",defaultMessage:"year"});case"years":return n.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.years",defaultMessage:"years"});default:return e.toString()}})).trim()}function g(e){const t=e.getRecurrence();return Boolean(e.isTriggerType("recurrence")&&t&&"disabled_recurrence_ended"===e.getStatus())}},173019:(e,t,n)=>{n.d(t,{r:()=>a});n(296540);var o=n(474848);const a=(0,n(340498).wt)("pencil",{viewBox:"0 0 16 16",svg:(0,o.jsx)("path",{d:"M3.926 13.307H14.11c.183 0 .34-.066.472-.199a.644.644 0 00.198-.471.652.652 0 00-.198-.479.644.644 0 00-.472-.198H5.272l-1.346 1.347zm-.704-.636l7.683-7.684-1.312-1.319-7.69 7.684-.67 1.606c-.037.1-.017.191.06.273.083.082.174.105.274.069l1.655-.63zm8.34-8.326l.738-.732c.182-.187.278-.376.287-.567.009-.192-.068-.374-.232-.547l-.267-.267c-.169-.168-.351-.246-.547-.232-.196.014-.385.11-.567.287l-.739.732 1.327 1.326z"})})},175213:(e,t,n)=>{n.d(t,{G:()=>r});var o=()=>n(989423),a=()=>n(508496);function r(e,t){o().vd(e,"delete_property",t),a().default.logEvent("delete_property")}},279900:(e,t,n)=>{function o(e){let t,n,o;return async function(){for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return t?(o=r,n||(n=t.then((()=>(n=void 0,t=e(...o),t))),n)):(t=e(...r),t)}}n.d(t,{A:()=>o})},454531:(e,t,n)=>{n.d(t,{W:()=>u});var o=()=>n(867772),a=()=>n(681810),r=()=>n(901389),i=()=>n(896628),s=()=>n(383594),l=()=>n(317909),c=()=>n(892632);const d=1500,p=(0,n(959013).YK)({pageCover:{defaultMessage:"Page cover",id:"pageCover.title"},fileTypeCaption:{defaultMessage:"Images wider than {idealImageWidth} pixels work best.",id:"pageCover.fileType.caption"},uploadFailed:{defaultMessage:"Upload failed",id:"pageCover.errorDialogMessage.uploadFailed"},embedTitle:{defaultMessage:"Link",id:"pageCover.embedType.title"},embedPlaceholder:{defaultMessage:"Paste an image link…",id:"pageCover.embedType.placeholder"},embedCaption:{defaultMessage:"Works with any image from the web.",id:"pageCover.embedType.caption"},embedSubmit:{defaultMessage:"Submit",id:"pageCover.embedType.buttonText"}});function u(e){let{environment:t,intl:n,store:o,rect:a}=e;s().W(t,{originGap:3,originRect:a,isSmallWidth:!1,popupWidth:540,maxHeight:485,title:n.formatMessage(p.pageCover),onDelete:()=>{!function(e){let{environment:t,store:n}=e;s().I(),l().createAndCommit({userAction:"PageCover.handleDelete",environment:t,canUndo:!0,perform:e=>{i().PT({store:n,transaction:e})}})}({environment:t,store:o})},currentTab:"gallery",tabs:[{type:"gallery",onChange:e=>{let{url:n,position:a}=e;g({environment:t,store:o,url:n,position:a})}},{type:"file",fileUpload:!1,imageUpload:!0,videoUpload:!1,caption:n.formatMessage(p.fileTypeCaption,{idealImageWidth:d}),onUpload:e=>{s().I(),c().QM({environment:t,file:e[0],bucket:"secure",record:o.pointer,onStart:f,onProgress:S,onComplete:e=>{var n;n={environment:t,store:o,url:e},m({...n,position:.5})},onError:()=>{r().f1(n.formatMessage(p.uploadFailed))}})}},{type:"embed",title:n.formatMessage(p.embedTitle),inputPlaceholder:n.formatMessage(p.embedPlaceholder),caption:n.formatMessage(p.embedCaption),buttonText:n.formatMessage(p.embedSubmit),onChange:e=>{var n;n={environment:t,store:o,url:e},m({...n,position:.5}),s().I()}},{type:"unsplash",onChange:e=>{let{url:n,position:a}=e;g({environment:t,store:o,url:n,position:a})}}]})}async function m(e){const{environment:t,store:n,url:r,position:s}=e,{serverCommitResult:c}=l().createAndCommit({userAction:"PageCover.updatePageCover",environment:t,canUndo:!0,perform:e=>{i().fg({store:n,url:r,position:s||.5,transaction:e})}});await c,a().A.state.loadingMode===o().vS&&a().A.setState({loadingMode:o().Gi,dataURL:a().A.state.dataURL,uploadProgress:100})}function g(e){m(e),e.environment.device.isMobile&&s().I()}function f(e){const{file:t,name:n,size:r}=e;if(s().I(),a().A.setState({loadingMode:o().Wc,file:t,name:n,size:r}),t instanceof File&&t.type.indexOf("image")>=0){const e=new FileReader;e.onload=e=>{a().A.state.loadingMode===o().Wc&&a().A.setState({...a().A.state,uploadProgress:0,loadingMode:o().vS,dataURL:e.target.result})},e.readAsDataURL(t)}}function S(e){const{progressPercent:t}=e;a().A.state.loadingMode===o().vS&&a().A.setState({...a().A.state,uploadProgress:t})}},465364:(e,t,n)=>{n.d(t,{$N:()=>T,D5:()=>I,GB:()=>M,M9:()=>w,Pt:()=>x,eW:()=>P,jo:()=>V,v7:()=>A});n(944114),n(898992),n(803949),n(581454);var o=()=>n(244641),a=()=>n(787626),r=()=>n(713998),i=()=>n(597777),s=()=>n(604995),l=()=>n(416504),c=()=>n(519831),d=()=>n(496603),p=()=>n(534177),u=()=>n(299709),m=()=>n(317001),g=()=>n(520861),f=()=>n(878060),S=()=>n(44729),y=()=>n(246826),v=()=>n(606952),C=()=>n(519839),h=()=>n(695625),b=()=>n(397248),k=()=>n(630116),_=()=>n(747671);function w(e){const{environment:t,droppedStores:n,duplicate:r,calendarBy:d,transaction:p,collectionContextStore:f}=e,y=o().c9.fromMillis(e.startOfDay);let v=!0;for(const o of n){const t=e.collectionStore?e.collectionStore:(0,C().Dj)({store:o,collectionContextStore:f});if(o.getParentTable()===c().Vl||!t){v=!1;break}S().X$({childStore:o,parentStore:t,transaction:p})||(v=!1)}const h=(0,g().T)({environment:t,droppedStores:n,duplicate:r,transaction:p,collectionStore:e.collectionStore});for(const o of h){const n=e.collectionStore?e.collectionStore:(0,C().Dj)({store:o,collectionContextStore:f});if(!n)continue;const r=n.getMappedProperty(d),c=o.getPropertyStore(r),g=(0,a().b)(c.getValue())||s().Ec((0,l().P)()),S=s().kW(g,(0,l().P)()),h=y.toFormat(s().tr);let b;if("date"===S.type||"datetime"===S.type)b={...S,start_date:h};else{const e=s().AA(S,(0,l().P)());if(!e.end)return;const t={...S,start_date:h},n=s().AA(t,(0,l().P)()).start.diff(e.start,"days"),o=e.end.plus(n).toFormat(s().tr);b={...S,start_date:h,end_date:o}}const k=s().kW(b,i().$K(g)||(0,l().P)());(0,m().j)({environment:t,store:o,collectionStore:n,collectionContextStore:f,shouldCoerce:!0,groupsPointer:[],transaction:p,alreadyMovedToCollection:v}),I({environment:t,type:"dateValue",propertyId:r,store:o,transaction:p,dateValue:k}),(0,u().E)({environment:t,collectionContextStore:f,block_id:o.id,property:r,property_type:"date",from:"calendar"})}}function A(e){const{calendarStore:t,direction:n,targetStore:o}=e;t.setState({...t.state,isDragging:!0,targetStore:o,direction:n,temporaryValue:void 0})}function M(e){const{calendarStore:t,x:n,y:r,calendarBy:c}=e,p=t.state;if(p.isDragging){const e=(0,a().b)(p.targetStore.getPropertyStore(c).getValue());if(!e)return;const u=s().kW(e,(0,l().P)()),m=p.temporaryValue||e,g=s().kW(m,(0,l().P)()),f=[];p.dayStoreMap.forEach(((e,t)=>{f.push({store:e,timestamp:t})}));const S=f.find((e=>{let{store:t}=e;const o=h().T.getRectFromStore(t);return Boolean(o&&b().ux(o,n,r))}));let y;if(S){const e=o().c9.fromMillis(S.timestamp),t=e.endOf("day"),n=e.toFormat(s().tr);if(u){const a=s().AA(u,(0,l().P)());if(p.direction===_().Q.Left)if(o().IX.fromDateTimes(e,t).contains(a.start))y=u;else{let e;e="datetimerange"===u.type||"daterange"===u.type?{...u,start_date:n,end_date:u.end_date}:"datetime"===u.type?{type:"datetimerange",start_date:n,start_time:u.start_time,end_date:u.start_date,end_time:u.start_time,time_zone:u.time_zone,reminder:u.reminder}:{type:"daterange",start_date:n,end_date:u.start_date,reminder:u.reminder};const t=s().AA(e,(0,l().P)());y=!a.end&&t.start>a.start||a.end&&t.start>a.end?g:e}else if(a.end?o().IX.fromDateTimes(e,t).contains(a.end):o().IX.fromDateTimes(e,t).contains(a.start))y=u;else{let e;e="date"===u.type?{...u,type:"daterange",end_date:n}:"datetime"===u.type?{...u,type:"datetimerange",end_date:n,end_time:"00:00"}:{...u,end_date:n};const t=s().AA(e,(0,l().P)());y=t.end&&t.end<t.start?g:e}}}if(y&&!d().n4(g,y)){const e=s().kW(y,i().$K(m)||(0,l().P)());t.setState({...p,temporaryValue:e})}}}function P(e){const{environment:t,calendarStore:n,calendarBy:o,transaction:a}=e,r=n.state;r.isDragging&&r.temporaryValue&&(I({type:"dateValue",environment:t,dateValue:r.temporaryValue,propertyId:o,store:r.targetStore,transaction:a}),n.setState({...n.state,isDragging:!1}))}function x(e){const{calendarStore:t}=e,n=t.state;n.isDragging&&t.setState({...n,isDragging:!1})}function T(e){const{environment:t,store:n,collectionStore:a,collectionContextStore:i,startDayOfWeek:c,transaction:d}=e,p=i.dateRangeStartStore.state,u=(0,l().P)(),g=i.normalizedQueryStore.state;if(!g||!g.calendar_by)return;const f=(null==a?void 0:a.getMappedProperty(g.calendar_by))??g.calendar_by,S=s().hp(p,c,u),v=S.startOf("month"),C=S.endOf("month"),h=o().c9.now().startOf("day");let b;return b=o().IX.fromDateTimes(v,C).contains(h)?s().p6(h.valueOf(),u):s().p6(s().iB(p,c,u).valueOf(),u),y().zv({store:n.getPropertiesStore(),data:{[f]:r().m5(b)},transaction:d}),(0,m().j)({environment:t,store:n,collectionStore:a,collectionContextStore:i,shouldCoerce:!0,groupsPointer:[],transaction:d}),n}function I(e){const{environment:t,store:n,propertyId:o,transaction:a}=e;let i;"timestamp"===e.type?i=s().p6(e.timestampMs.valueOf(),(0,l().P)()):"dateValue"===e.type?i=e.dateValue:(0,p().HB)(e);const c=n.getPropertyValue(o),d=r().m5(i);y().zv({store:n.getPropertiesStore(),data:{[o]:d},transaction:a}),f().O({environment:t,store:n,dateProperty:{id:o,oldValue:c,newValue:d}})}function V(e){const{environment:t,collectionStore:n,calendarBy:o,store:a,insertStores:r,collectionContextStore:i,transaction:s}=e,l=a.getPropertyStore(o).getValue();for(const c of r)(0,m().j)({environment:t,store:c,collectionStore:n,collectionContextStore:i,shouldCoerce:!0,groupsPointer:[],transaction:s}),v().KY({environment:t,store:c.getPropertyStore(o),value:l,transaction:s});return r.map((e=>k().Bv.createChildStore(n,e.pointer)))}},520861:(e,t,n)=>{n.d(t,{T:()=>a});n(944114),n(898992),n(908872);var o=()=>n(415651);function a(e){const{environment:t,collectionStore:n,duplicate:a,droppedStores:r,transaction:i}=e,{movedStores:s,reparentedStores:l}=r.reduce(((e,t)=>(a||t.getAssociatedCollectionId()!==(null==n?void 0:n.id)?e.reparentedStores.push(t):e.movedStores.push(t),e)),{movedStores:[],reparentedStores:[]});return[...s,...o().MS({environment:t,droppedStores:l,duplicate:a,transaction:i,resolveTemplateVariables:!1})]}},527580:(e,t,n)=>{n.d(t,{TK:()=>s,YC:()=>i,ui:()=>r});var o=()=>n(645873);const a={pageVerification:new(o().O2)("pageVerification",(()=>Promise.all([n.e(23806),n.e(94891)]).then(n.bind(n,80826)))),pageVerificationBadge:new(o().O2)("pageVerificationBadge",(()=>Promise.all([n.e(23806),n.e(74562),n.e(95794),n.e(59794),n.e(75355),n.e(9034),n.e(20838),n.e(6463),n.e(11740),n.e(46413),n.e(41412)]).then(n.bind(n,161901)))),pageVerificationMenuRenderer:new(o().O2)("pageVerificationMenuRenderer",(()=>Promise.all([n.e(23806),n.e(74562),n.e(95794),n.e(59794),n.e(75355),n.e(9034),n.e(20838),n.e(6463),n.e(11740),n.e(46413),n.e(26207)]).then(n.bind(n,196770))))},r=(0,o()._h)(a.pageVerification,(e=>e.PageAddVerificationButton)),i=(0,o()._h)(a.pageVerificationBadge,(e=>e.PageVerificationBadge)),s=(0,o()._h)(a.pageVerificationMenuRenderer,(e=>e.PageVerificationMenuRenderer))},555555:(e,t,n)=>{n.d(t,{n:()=>a});n(296540);var o=n(474848);const a=(0,n(340498).wt)("import",{viewBox:"0 0 16 16",svg:(0,o.jsx)("path",{d:"M13.291 14.5723C13.291 14.1484 12.9902 13.834 12.5732 13.834H8.06836C8.24609 13.8203 8.42383 13.7314 8.56055 13.5947L13.0586 9.08301C13.2158 8.91895 13.291 8.74121 13.291 8.54297C13.291 8.12598 12.9902 7.81836 12.5801 7.81836C12.3682 7.81836 12.1836 7.90039 12.0469 8.03711L10.4951 9.56836L8.69043 11.585L8.75195 10.1084V1.61133C8.75195 1.16016 8.44434 0.852539 8 0.852539C7.5625 0.852539 7.25488 1.16016 7.25488 1.61133V10.1084L7.30957 11.5781L5.50488 9.56836L3.95312 8.03711C3.82324 7.90039 3.63184 7.81836 3.42676 7.81836C3.0166 7.81836 2.70898 8.12598 2.70898 8.54297C2.70898 8.74121 2.78418 8.91895 2.94141 9.08301L7.44629 13.5947C7.58301 13.7314 7.75391 13.8203 7.93848 13.834H3.44043C3.0166 13.834 2.70898 14.1484 2.70898 14.5723C2.70898 14.9893 3.0166 15.3037 3.44043 15.3037H12.5732C12.9902 15.3037 13.291 14.9893 13.291 14.5723Z"})})},556048:(e,t,n)=>{n.d(t,{C8:()=>u,Dz:()=>l,GC:()=>g,GL:()=>f,YY:()=>m,dM:()=>d,h9:()=>c,jX:()=>s,oF:()=>p,uj:()=>i});var o=()=>n(645873);const a={JiraSyncInfoPopup:new(o().O2)("JiraSyncInfoPopup",(async()=>await Promise.all([n.e(75134),n.e(68744)]).then(n.bind(n,408453)))),ImproveJiraSyncPopup:new(o().O2)("ImproveJiraSyncPopup",(async()=>await Promise.all([n.e(75134),n.e(2686)]).then(n.bind(n,484967)))),JiraDCAuthModal:new(o().O2)("JiraDCAuthModal",(async()=>await n.e(28763).then(n.bind(n,992567)))),ExternalImportAndSyncIndicator:new(o().O2)("ExternalImportAndSyncIndicator",(async()=>await n.e(98288).then(n.bind(n,984289)))),JiraSyncedAllProjectsTooltip:new(o().O2)("JiraSyncedAllProjectsTooltip",(async()=>await Promise.all([n.e(23806),n.e(21446)]).then(n.bind(n,470020)))),JiraSyncedAllIssuesTooltip:new(o().O2)("JiraSyncedAllIssuesTooltip",(async()=>await Promise.all([n.e(23806),n.e(21446)]).then(n.bind(n,470020)))),JiraSyncedDatabaseViewsAndFiltersTooltip:new(o().O2)("JiraSyncedDatabaseViewsAndFiltersTooltip",(async()=>await Promise.all([n.e(23806),n.e(21446)]).then(n.bind(n,470020)))),JiraSyncSourceTooltip:new(o().O2)("JiraSyncSourceTooltip",(async()=>await Promise.all([n.e(23806),n.e(21446)]).then(n.bind(n,470020)))),JiraSyncedSettingsToSetupProjectsAndIssuesTooltip:new(o().O2)("JiraSyncedSettingsToSetupProjectsAndIssuesTooltip",(async()=>await Promise.all([n.e(23806),n.e(21446)]).then(n.bind(n,470020))))},r={JiraSyncTeamSpaceModal:new(o().O2)("JiraSyncTeamSpaceModal",(async()=>Promise.all([n.e(23806),n.e(56188)]).then(n.bind(n,604698))))},i=(0,o()._h)(r.JiraSyncTeamSpaceModal,(e=>e.default)),s=(0,o()._h)(a.JiraSyncedAllProjectsTooltip,(e=>e.JiraSyncedAllProjectsTooltip)),l=(0,o()._h)(a.JiraDCAuthModal,(e=>e.default)),c=(0,o()._h)(a.JiraSyncedAllIssuesTooltip,(e=>e.JiraSyncedAllIssuesTooltip)),d=(0,o()._h)(a.JiraSyncedDatabaseViewsAndFiltersTooltip,(e=>e.JiraSyncedDatabaseViewsAndFiltersTooltip)),p=(0,o()._h)(a.JiraSyncedSettingsToSetupProjectsAndIssuesTooltip,(e=>e.JiraSyncedSettingsToSetupProjectsAndIssuesTooltip)),u=(0,o()._h)(a.JiraSyncSourceTooltip,(e=>e.JiraSyncSourceTooltip)),m=(0,o()._h)(a.JiraSyncInfoPopup,(e=>e.JiraSyncInfoPopup)),g=(0,o()._h)(a.ImproveJiraSyncPopup,(e=>e.ImproveJiraSyncPopup)),f=(0,o()._h)(a.ExternalImportAndSyncIndicator,(e=>e.ExternalImportAndSyncIndicator));(0,n(340498).xh)("jira",{default:{loader:()=>n.e(60677).then(n.bind(n,460677)),size:20},small:{loader:()=>n.e(60677).then(n.bind(n,460677)),size:16},mini:{loader:()=>n.e(60677).then(n.bind(n,460677)),size:14},large:{loader:()=>n.e(60677).then(n.bind(n,460677)),size:24}})},681810:(e,t,n)=>{n.d(t,{A:()=>o});const o=new(n(867772).Ay)},683521:(e,t,n)=>{n.d(t,{N:()=>a});n(296540);var o=n(474848);const a=(0,n(340498).wt)("addPageCover",{viewBox:"0 0 14 14",svg:(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 0a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2zm0 12h10L8.5 5.5l-2 4-2-1.5L2 12z"})})},747671:(e,t,n)=>{n.d(t,{Q:()=>o,a:()=>a});let o=function(e){return e[e.Left=0]="Left",e[e.Right=1]="Right",e}({});class a extends(()=>n(757695))().default{getInitialState(){return{dayStoreMap:new Map,isDragging:!1,startingMonth:0}}}},748539:(e,t,n)=>{n.d(t,{f:()=>o});const o=new(n(645873).O2)("pageCovers",(async()=>n.e(40198).then(n.bind(n,193645))))},835755:(e,t,n)=>{n.d(t,{p:()=>a});n(296540);var o=n(474848);const a=(0,n(340498).wt)("collectionDescriptionSmall",{viewBox:"0 0 14 14",svg:(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7 4.667C6.69049 4.667 6.39366 4.54405 6.17481 4.32519C5.95595 4.10634 5.833 3.80951 5.833 3.5C5.833 3.19049 5.95595 2.89366 6.17481 2.67481C6.39366 2.45595 6.69049 2.333 7 2.333C7.30951 2.333 7.60634 2.45595 7.82519 2.67481C8.04405 2.89366 8.167 3.19049 8.167 3.5C8.167 3.80951 8.04405 4.10634 7.82519 4.32519C7.60634 4.54405 7.30951 4.667 7 4.667V4.667ZM8 11C8 11.2652 7.89464 11.5196 7.70711 11.7071C7.51957 11.8946 7.26522 12 7 12C6.73478 12 6.48043 11.8946 6.29289 11.7071C6.10536 11.5196 6 11.2652 6 11V7C6 6.73478 6.10536 6.48043 6.29289 6.29289C6.48043 6.10536 6.73478 6 7 6C7.26522 6 7.51957 6.10536 7.70711 6.29289C7.89464 6.48043 8 6.73478 8 7V11ZM7 0C5.14348 0 3.36301 0.737498 2.05025 2.05025C0.737498 3.36301 0 5.14348 0 7C0 8.85652 0.737498 10.637 2.05025 11.9497C3.36301 13.2625 5.14348 14 7 14C8.85652 14 10.637 13.2625 11.9497 11.9497C13.2625 10.637 14 8.85652 14 7C14 5.14348 13.2625 3.36301 11.9497 2.05025C10.637 0.737498 8.85652 0 7 0V0Z"})})},848565:(e,t,n)=>{n.d(t,{FB:()=>u,Ql:()=>m,SM:()=>g,Wv:()=>r,Yz:()=>s,ds:()=>a,e4:()=>o,eQ:()=>i,im:()=>c,jw:()=>l,k2:()=>p,uG:()=>d});const o=8,a=10,r=8,i=24,s=6,l=1.5,c=(i-l)/2,d=i+s,p=`calc(100% + ${r+(o-s)-d}px)`,u=i+8,m=-16;function g(e){return"margin_comments"===e?12:"comment_unfurl"===e?14:16}},867772:(e,t,n)=>{n.d(t,{Ay:()=>l,Gi:()=>r,Wc:()=>o,pF:()=>i,vS:()=>a});const o="loadingLocalImage",a="uploading",r="downloading",i="loaded";class s extends(()=>n(757695))().default{getInitialState(){return{loadingMode:i}}}const l=s},877051:(e,t,n)=>{n.d(t,{V:()=>i});var o=()=>n(56366),a=()=>n(351360),r=()=>n(963589);function i(){const e=(0,r().X)("lazier_dependencies"),t=(0,o().K8)((()=>a().default.state.renderPhase),[]);return e&&"rendered"!==t}},966759:(e,t,n)=>{n.d(t,{i:()=>r});var o=()=>n(476492),a=()=>n(175213);function r(e){const{environment:t,collectionContextStore:n,property_type:r,from:i,property:s,...l}=e,c=(0,o().sl)(n)||{};(0,a().G)(t,{property:s,property_type:r,from:i,...l,...c})}},975318:(e,t,n)=>{n.d(t,{A:()=>U});n(898992),n(823215),n(354520),n(581454);var o=n(296540),a=()=>n(484714),r=()=>n(56366),i=()=>n(401497),s=()=>n(584262),l=()=>n(689094),c=()=>n(381138),d=()=>n(959013),p=()=>n(496603),u=()=>n(160568),m=()=>n(557281),g=()=>n(435009),f=()=>n(317909),S=()=>n(284371),y=()=>n(682146),v=n(474848);const C={...S().RC,position:"absolute",left:0,right:0,top:0,bottom:0},h={marginLeft:4,fontWeight:S().Wy.semibold};function b(e){const{prefix:t,viewName:n,viewType:o}=e;return(0,v.jsxs)("div",{style:{position:"relative",width:"100%"},children:[" ",(0,v.jsxs)("div",{style:C,children:[t,o&&y().Vw[o]({marginLeft:8,marginRight:2,width:"1em",display:"inline",verticalAlign:"bottom"}),(0,v.jsx)("span",{style:h,children:n})]})]})}var k=()=>n(175116),_=()=>n(484792),w=()=>n(518736),A=()=>n(921855),M=()=>n(476492),P=()=>n(492414),x=()=>n(722872),T=()=>n(836251),I=()=>n(351360),V=()=>n(611371),B=()=>n(274652);const j=function(e){const t=(0,a().v3)(),o=(0,i().DP)();return(0,v.jsx)(n(187485).A,{href:e.href,external:!0,onClick:()=>n(148024).FH(t,{from:e.helpButtonContext}),children:(0,v.jsx)(n(285790).A,{icon:n(133033).$,style:{height:24,width:24,marginRight:-6,fill:o.mediumIconColor}})})};var D=()=>n(763996),R=()=>n(439264),F=()=>n(419357),L=()=>n(678553),O=()=>n(939740),J=()=>n(89924),E=()=>n(286611);const z=(0,d().YK)({filterPlaceholder:{id:"collectionPicker.searchBarFilter.text",defaultMessage:"Filter…"}});const U=function(e){let{collectionStore:t,isOverlay:s,onEmptyEnter:l,onEmptyPageClick:c,onCancelClick:p,canConfigureCollection:u,locked:m,onTemplateClick:g}=e;const f=(0,i().DP)(),S=(0,a().Y0)(),[y,C]=(0,o.useState)(""),h=(0,r().uB)(void 0,n(970585).A),b=(0,r().K8)((()=>t.getTemplatePageStores().filter((e=>e.getAlive()))),[t]),k=(0,r().K8)((()=>b.every((e=>e.isReady()))),[b]),_=(0,r().K8)((()=>s&&null!=y&&y.length?(0,n(467730).Ay)(y,b,(e=>String(e.getProperties().title)??"")):b),[b,y,s]);if(!k)return null;let w=(0,v.jsx)(q,{collectionStore:t,onEmptyEnter:l,onEmptyPageClick:c,onCancelClick:p,canConfigureCollection:u,isOverlay:s,locked:m,onTemplateClick:g,menuListStore:h,templateInputValue:y,filteredTemplatePageStores:_,draggable:!0});const A=(0,v.jsx)(H,{templateInputValue:y,setTemplateInputValue:C});if(s){let e;return e=S.isMobile?{menuType:x().gu.Modal,title:(0,v.jsx)(d().sA,{defaultMessage:"Database templates",id:"database.mobileTemplatesMenu.title"}),left:(0,v.jsx)(n(45552).CancelMenuText,{}),onClickLeft:p}:{menuType:x().gu.Popup,width:360},b.length>6&&y&&(w=(0,v.jsx)(q,{collectionStore:t,onEmptyEnter:l,onEmptyPageClick:c,onCancelClick:p,canConfigureCollection:u,isOverlay:s,locked:m,onTemplateClick:g,menuListStore:h,templateInputValue:y,filteredTemplatePageStores:_,draggable:!1})),(0,v.jsxs)(n(928600).A,{...e,header:(0,v.jsx)(W,{collectionStore:t}),children:[0===b.length&&(0,v.jsx)(J().A,{children:(0,v.jsx)("div",{style:{fontSize:14,padding:S.isMobile?"12px 16px":"0 14px 3px 14px",color:f.lightTextColor,wordBreak:"keep-all",...S.isMobile&&{background:f.contentBackground,boxShadow:`0 1px 0 ${f.regularDividerColor}`,marginBottom:1}},children:(0,v.jsx)(d().sA,{defaultMessage:"Replicate page formats inside this database with templates.",id:"database.emptyTemplatesList.info"})})}),b.length>6?A:void 0,w]})}return w};function W(e){let{collectionStore:t}=e;const n=(0,a().v3)(),o=(0,r().K8)((()=>t.getNameStore().getValue()),[t]);if(n.device.isMobile)return null;const i=o?(0,v.jsx)(v.Fragment,{children:(0,A().r4)(o,t)}):(0,v.jsx)(d().sA,{defaultMessage:"Untitled",id:"database.templateList.UntitledDatabaseTitle"});return(0,v.jsx)(L().A,{style:{marginTop:6},title:(0,v.jsx)(b,{prefix:(0,v.jsx)(d().sA,{id:"database.templatesList.templatesFor",defaultMessage:"Templates for"}),viewName:i}),right:(0,v.jsx)(j,{helpButtonContext:"collection_templates_menu",href:(0,T().xS)("guides.databaseTemplates")})})}function K(e){let{props:{ref:t,...n},isOverlay:o,locked:r}=e;const s=(0,i().DP)(),c=(0,a().v3)(),p=(0,v.jsx)(d().sA,{defaultMessage:"New template",id:"database.templateView.newTemplateButton"});return o?(0,v.jsx)(B().A,{isBlue:c.device.isDesktop,title:p,...n}):(0,v.jsx)(E().A,{title:p,icon:(0,l().W)({width:18,fill:s.lightIconColor,marginLeft:1,marginRight:11}),type:"new_template",format:o?"collection-overlay":"page-menu-item",locked:r,...n})}function N(e,t,n){const{mainEditorCurrentBlockStore:o}=I().default.state;!function(e,t,n){n?n(e):g().oo({environment:t,url:e})}(o?(0,P().Ay)({store:o,peekViewBlockId:e.id,fullyQualified:!1,pageVisitSource:s().y8.Create}):(0,P().Ay)({store:e,fullyQualified:!1,pageVisitSource:s().y8.Create}),t,n)}function H(e){let{templateInputValue:t,setTemplateInputValue:n}=e;const r=(0,d().tz)(),i=(0,a().v3)(),s=(0,o.useCallback)((e=>n(e.currentTarget.value)),[n]),{device:l}=i,p=!l.isMobile||void 0;return(0,v.jsx)("div",{style:{margin:l.isMobile?0:"10px 0"},children:(0,v.jsx)(F().Ay,{value:t,focusInitial:p,placeholder:r.formatMessage(z.filterPlaceholder),showClearButton:!0,inputLeft:(0,v.jsx)(F().Zf,{icon:c().q}),onChange:s,style:{...l.isAndroid&&{borderBottom:"none"}}})})}function q(e){let{filteredTemplatePageStores:t,draggable:n,collectionStore:i,onEmptyEnter:s,onEmptyPageClick:l,onCancelClick:c,canConfigureCollection:d,isOverlay:g,locked:S,onTemplateClick:y,menuListStore:C,templateInputValue:h}=e;const b=(0,a().v3)(),A=(0,o.useContext)(k().p2),P=(0,o.useContext)(_().n),x=(0,o.useCallback)((e=>function(e,t,n,o){o.unsetFocus(),f().createAndCommit({userAction:"CollectionTemplatePicker.handleCollectionTemplatesReorder",environment:t,canUndo:!0,perform:t=>m().lU({collectionStore:n,newTemplateIds:e,transaction:t})})}(e,b,i,C)),[b,i,C]),T=(0,o.useCallback)((()=>function(e,t,n,o){var a;(0,V().EF)(e)&&(n(),u().ki(e,{template_type:"empty_page",from:"collections_template_picker",is_keyboard:!0,collection_id:t.id,collection_view_id:null==o||null===(a=o.collectionViewStore())||void 0===a?void 0:a.id}))}(b,i,s,A)),[b,i,s,A]),I=(0,o.useCallback)((e=>function(e,t,n,o){(0,V().EF)(t)&&(n(e.event),u().ki(t,{template_type:"empty_page",from:"collections_template_picker",is_keyboard:"keydown"===e.event.type,...o&&(0,M().sl)(o)}))}(e,b,l,A)),[A,b,l]),B=(0,o.useCallback)((e=>function(e,t,n,o,a,r,i){if((0,V().EF)(t)){var s;const{performResult:e}=f().createAndCommit({userAction:"CollectionTemplatePicker.newPage",environment:t,canUndo:!0,perform:e=>m().bI({environment:t,collectionStore:n,transaction:e,title:o})});e&&N(e,t,r),u().er(t,{collection_id:n.id,collection_view_id:null==i||null===(s=i.collectionViewStore())||void 0===s?void 0:s.id})}null==a||a()}(0,b,i,h,c,P,A)),[b,i,h,c,P,A]),{device:j}=b,F=(0,o.useMemo)((()=>({key:"create-template",render:(e,t)=>(0,v.jsx)(K,{isOverlay:g,locked:S,props:e}),action:B})),[B,g,S]),L=(0,r().K8)((()=>null==A?void 0:A.defaultPageTemplateStore.state),[A]),E=(0,r().K8)((()=>({key:"empty",render:(e,n)=>{if(0!==t.length&&""===h)return(0,v.jsx)(D().A,{collectionStore:i,canConfigureCollection:d,isOverlay:g,templateStore:void 0,isMobile:b.device.isMobile,locked:S||!d,draggable:!0,isDefault:void 0===(null==L?void 0:L.id),onCancelClick:c,...e})},action:I})),[d,i,null==L?void 0:L.id,b.device.isMobile,I,g,S,c,h,t.length]),z=(0,r().K8)((()=>{const e=t.map((e=>e.id));return p().oE([0!==t.length&&{key:"templates",render:t=>{const a=t.children.slice(0,t.children.length-1),r=t.children[t.children.length-1];return(0,v.jsx)(J().A,{...t,disableDesktopPadding:!g,disableMobileBorders:!0,children:(0,v.jsxs)(o.Fragment,{children:[j.isMobile||S||!d?a.map(((e,t)=>a[t])):(0,v.jsx)(R().Ay,{direction:"vertical",keys:e,disabled:!n,renderKey:(t,n)=>a[e.indexOf(t)],onDrop:x}),r]})})},items:[...t.map((e=>function(e,t,n,a,r,i,s,l,c,d){const{device:p}=e,u=null==d?void 0:d.defaultPageTemplateStore.state,m=t.getAutomationStore(),g=null!=m&&m.isActive()?m.getRecurrence():void 0,f=m&&!m.canEdit(),S="disabled_duplication"===(null==m?void 0:m.getStatus())||"disabled_inactive_space"===(null==m?void 0:m.getStatus());return{key:t.id,render:e=>(0,o.createElement)(D().A,{...e,key:t.id,isOverlay:s,collectionStore:a,canConfigureCollection:r,templateStore:t,isMobile:p.isMobile,locked:i,onCancelClick:l,draggable:n,isDefault:(null==u?void 0:u.id)===t.id,recurrence:g,recurrenceDisabled:S,recurrenceButtonDisabled:f}),action:n=>{(0,V().EF)(e)&&c({templateStore:t,isKeyboard:"keydown"===n.event.type,useCrdt:(0,w().D8)(a.getSpaceStore())})}}}(b,e,n,i,d,S,g,c,y,A))),E]},d?{key:"create-template",render:e=>(0,v.jsx)(J().A,{topBorder:g,disableDesktopPadding:!g,disableMobileBorders:!0,...e}),items:[F]}:void 0])}),[d,A,i,F,j.isMobile,n,E,b,x,g,S,c,y,t]);return(0,v.jsx)(O().Ay,{type:O().Oh.Vertical,store:C,initialFocus:void 0,disableInitialScroll:!0,disableCommandEnter:!0,onEmptyEnter:T,sections:z,resetFocusOnMouseOut:!0})}}}]);