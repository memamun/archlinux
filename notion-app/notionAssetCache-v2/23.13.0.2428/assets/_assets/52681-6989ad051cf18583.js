"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[52681],{51618:(e,t,r)=>{r.d(t,{lM:()=>M,Lh:()=>K,GC:()=>C,dR:()=>N,zD:()=>_,w2:()=>I,aD:()=>S,XO:()=>w,yX:()=>T,Nm:()=>q,vZ:()=>x,Wg:()=>E,Or:()=>A,Dk:()=>O,Km:()=>D,jT:()=>$});r(16280),r(898992),r(430670),r(581454);var n=()=>r(496603),a=()=>r(973647),o=()=>r(251582),i=()=>r(181856),s=()=>r(832443),u=()=>r(252050),c=()=>r(972261),p=()=>r(534177),l=()=>r(228803),d=()=>r(331119);function m(e,t){const r=`filter-${e}`;return o().p.mapResult((0,d().U5)(r),(n=>{var s;if(null===(s=n.attributes)||void 0===s||!s.condition)return{error:new(i().HQ)({tagName:r,attributeName:"condition"})};const c=u().RI[e],p=function(e){const{tagName:t,condition:r,allowedOperators:n}=e;if(r.includes("not ")){const e=r.replace("not ","").replace(/\s+/g," ").trim();return n.includes(e)?{value:{not:!0,operator:e}}:{error:new(i().js)({tagName:t,allowedOperators:n,inputCondition:r})}}return n.includes(r)?{value:{not:!1,operator:r}}:{error:new(i().js)({tagName:t,allowedOperators:n,inputCondition:r})}}({condition:n.attributes.condition,tagName:r,allowedOperators:Object.keys(c)});if(a().Q.isFail(p))return p;const m=c[p.value.operator],y=(0,d().ke)({inputAttributes:n.attributes,definitions:{name:{required:!0,values:!0},condition:{required:!0,values:!0},...m.attributes},tagName:r,mapCounterToKey:t.mapCounterToKey});if(a().Q.isFail(y))return y;const{name:h,condition:g,...b}=y.value,f=(0,o().$d)((0,d().nx)(r,[(0,l().Et)({inlineNodesAllowed:m.inline,textAllowed:m.text,parentTagName:r,mapCounterToKey:t.mapCounterToKey})],{allowUnmatchedText:!0}),n.children??[]);if(a().Q.isFail(f))return f.error instanceof i().RR?{error:new(i().nB)({tagName:f.error.tagName,unexpectedNode:f.error.unexpectedNode,conditionName:n.attributes.condition,cause:f.error})}:f;return{value:{propertyName:y.value.name,propertyTagName:e,children:f.value,attributes:b,operator:p.value.operator,not:p.value.not}}}))}function y(e){return o().p.choice([...(0,p().uv)(u().RI).map((t=>m(t,e))),o().p.fail((e=>new(i().yc)({nodeType:"database filter",unexpectedNode:n().$1(e)})))])}function h(e){return o().p.mapResult((0,d().U5)("filter-group"),(t=>{const r=(0,d().ke)({inputAttributes:t.attributes,definitions:{match:{required:!0,values:["any","all"]}},tagName:"filter-group",mapCounterToKey:e.mapCounterToKey});if(a().Q.isFail(r))return r;if(!t.children||0===t.children.length)return{error:new(i().Dp)({tagName:"filter-group"})};const n=(0,o().$d)((0,d().nx)("filter-group",[g(e)],{allowUnmatchedText:!0}),t.children??[]);return a().Q.isFail(n)?n:{value:{operator:r.value.match,filters:n.value}}}))}function g(e){return o().p.choice([y(e),h(e)])}const b=o().p.choice([...(0,p().uv)(u().GU).map((e=>function(e){const t=`sort-${e}`;return o().p.mapResult((0,d().U5)(t),(e=>{const r=(0,d().x3)(e);if(a().Q.isFail(r))return r;const n=(0,d().ke)({inputAttributes:e.attributes,definitions:{name:{required:!0,values:!0},direction:{required:!0,values:["ascending","descending"]}},tagName:t,mapCounterToKey:void 0});return a().Q.isFail(n)?n:{value:{propertyName:n.value.name,direction:n.value.direction}}}))}(e))),o().p.fail((e=>new(i().yc)({nodeType:"database sort",unexpectedNode:n().$1(e)})))]),f=o().p.map((0,d().RB)({tagName:"limit",attributeDefinitions:{number:{required:!0,values:!0}},mapCounterToKey:void 0}),(e=>{let{attributes:t}=e;return parseInt(t.number)})),v=o().p.map((0,d().RB)({tagName:"search",attributeDefinitions:{question:{required:!0,values:!0},keywords:{required:!0,values:!0},"question-intl":{required:!1,values:!0},channel:{required:!1,values:!0}},mapCounterToKey:void 0}),(e=>{let{attributes:t}=e;return{question:t.question,keywords:t.keywords,questionIntl:t["question-intl"]}}));const k=o().p.choice([...(0,p().uv)(u().GU).map((e=>function(e){const t=`aggregation-${e}`,r=u().RD[t];return o().p.mapResult((0,d().U5)(t),(e=>{const n=(0,d().x3)(e);if(a().Q.isFail(n))return n;const o=(0,d().ke)({inputAttributes:e.attributes,definitions:r.attributes,tagName:t,mapCounterToKey:void 0});return a().Q.isFail(o)?o:{value:{tagName:t,attributes:o.value}}}))}(e))),o().p.fail((e=>new(i().yc)({nodeType:"database sort",unexpectedNode:n().$1(e)})))]);function x(e){return o().p.mapResult((0,d().U5)("query-database"),(t=>{const{id:r,...s}=t.attributes,u=r?function(e){const{id:t,mapCounterToKey:r}=e;if(!r)return{value:{key:t,type:"collection"}};const n=(0,a().j)((()=>r(t)));if(a().Q.isFail(n))return n;return"collection"===n.value.type||"collection-view"===n.value.type?{value:n.value}:{error:new Error(`Expected block or collection ID, got ${n.value.type}`)}}({id:r,mapCounterToKey:e.mapCounterToKey}):void 0;if(u&&a().Q.isFail(u))return u;if(!u)return{error:new Error('The <query-database> tag is missing a id attribute. It should be specified as <query-database id="...">')};if(Object.keys(s).length>0)return{error:new Error("<query-database> cannot have any attributes other than 'id'")};const c=(0,o().$d)((0,d().nx)("query-database",[o().p.map(g(e),(e=>({type:"filter",value:e}))),o().p.map(b,(e=>({type:"sort",value:e}))),o().p.map(v,(e=>({type:"search",value:e}))),o().p.map(k,(e=>({type:"aggregation",value:e}))),o().p.map(f,(e=>({type:"limit",value:e})))],{allowUnmatchedText:!0}),t.children??[]);if(a().Q.isFail(c))return c;const p=c.value.flatMap((e=>"filter"===e.type?[e.value]:[])),l=c.value.flatMap((e=>"sort"===e.type?[e.value]:[])),m=c.value.flatMap((e=>"search"===e.type?[e.value]:[])),y=c.value.flatMap((e=>"aggregation"===e.type?[e.value]:[])),h=c.value.flatMap((e=>"limit"===e.type?[e.value]:[]));if(m.length>1)return{error:new(i().bV)("<search>")};if(y.length>1)return{error:new(i().bV)("aggregation")};return{value:{tagName:"query-database",type:"observation",query:{databaseId:u.value.key,search:n().$1(m),aggregation:n().$1(y),filter:{operator:"all",filters:p},sorts:l,limit:n().$1(h)}}}}))}function w(e){return o().p.map((0,d().RB)({tagName:"load-page",attributeDefinitions:{id:{required:!0,values:!0,mappingMode:"block_counter"}},mapCounterToKey:e.mapCounterToKey}),(e=>{let{attributes:t}=e;return{type:"observation",tagName:"load-page",attributes:t}}))}function T(e){return o().p.map((0,d().RB)({tagName:"load-slack",attributeDefinitions:{id:{required:!0,values:!0,mappingMode:"external_id_counter"}},mapCounterToKey:e.mapCounterToKey}),(e=>{let{attributes:t}=e;return{type:"observation",tagName:"load-slack",attributes:t}}))}function _(e){return o().p.map((0,d().RB)({tagName:"load-google-drive",attributeDefinitions:{id:{required:!0,values:!0,mappingMode:"external_id_counter"}},mapCounterToKey:e.mapCounterToKey}),(e=>{let{attributes:t}=e;return{type:"observation",tagName:"load-google-drive",attributes:t}}))}function N(e){return o().p.map((0,d().RB)({tagName:"load-github",attributeDefinitions:{id:{required:!0,values:!0,mappingMode:"external_id_counter"}},mapCounterToKey:e.mapCounterToKey}),(e=>{let{attributes:t}=e;return{type:"observation",tagName:"load-github",attributes:t}}))}function C(e){return o().p.map((0,d().RB)({tagName:"load-github-code",attributeDefinitions:{id:{required:!0,values:!0,mappingMode:"external_id_counter"}},mapCounterToKey:e.mapCounterToKey}),(e=>{let{attributes:t}=e;return{type:"observation",tagName:"load-github-code",attributes:t}}))}function I(e){return o().p.map((0,d().RB)({tagName:"load-jira",attributeDefinitions:{id:{required:!0,values:!0,mappingMode:"external_id_counter"}},mapCounterToKey:e.mapCounterToKey}),(e=>{let{attributes:t}=e;return{type:"observation",tagName:"load-jira",attributes:t}}))}function q(e){return o().p.map((0,d().RB)({tagName:"load-web-page",attributeDefinitions:{id:{required:!0,values:!0,mappingMode:"external_id_counter"}},mapCounterToKey:e.mapCounterToKey}),(e=>{let{attributes:t}=e;return{type:"observation",tagName:"load-web-page",attributes:t}}))}function M(e){return o().p.map((0,d().RB)({tagName:"load-attachment",attributeDefinitions:{id:{required:!0,values:!0,mappingMode:"attachment_id_counter"},attachmentType:{required:!0,values:["pdf"]}},mapCounterToKey:e.mapCounterToKey}),(e=>{let{attributes:t}=e;return{type:"observation",tagName:"load-attachment",attributes:t}}))}function K(e){return o().p.map((0,d().RB)({tagName:"load-database",attributeDefinitions:{id:{required:!0,values:!0,mappingMode:"collection_counter"}},mapCounterToKey:e.mapCounterToKey}),(e=>{let{attributes:t}=e;return{type:"observation",tagName:"load-database",attributes:t}}))}function S(e){return o().p.mapResult((0,d().U5)("load"),(t=>{const r=(0,d().x3)(t);if(a().Q.isFail(r))return r;const{id:n,...o}=t.attributes;if(void 0===n)return{error:new Error("<load> must have an 'id' attribute")};if(Object.keys(o).length>0)return{error:new Error("<load> cannot have any attributes other than 'id'")};const{mapCounterToKey:i}=e;if(!i)return{error:new Error("mapCounterToKey is required")};const u=s().tD.mapCounterToKeyInMode({mapCounterToKey:i},n,"block_counter","load");if(!u.error)return{value:{type:"observation",tagName:"load-page",attributes:{id:u.value}}};const p=s().tD.mapCounterToKeyInMode({mapCounterToKey:i},n,"collection_counter","load");if(!p.error)return{value:{type:"observation",tagName:"load-database",attributes:{id:p.value}}};const l=s().tD.mapCounterToKeyInMode({mapCounterToKey:i},n,"external_id_counter","load");if(!l.error){const e=(0,c().Tq)(l.value);if("web"===e)return{value:{type:"observation",tagName:"load-web-page",attributes:{id:l.value}}};if("slack"===e)return{value:{type:"observation",tagName:"load-slack",attributes:{id:l.value}}};if("googleDrive"===e)return{value:{type:"observation",tagName:"load-google-drive",attributes:{id:l.value}}};if("github"===e)return{value:{type:"observation",tagName:"load-github",attributes:{id:l.value}}};if("githubCode"===e)return{value:{type:"observation",tagName:"load-github-code",attributes:{id:l.value}}};if("jira"===e)return{value:{type:"observation",tagName:"load-jira",attributes:{id:l.value}}}}return{error:new Error(`<load> with id ${n} could must be either a block or database ID.`)}}))}const $=["notion","slack","google-drive","github","jira"],D=["document","spreadsheets","presentation","message","pull-request","code","issue","task","ticket"],A=o().p.map((0,d().RB)({tagName:"search",attributeDefinitions:{question:{required:!0,values:!0},keywords:{required:!0,values:!0},lookback:{required:!1,values:!0},"question-intl":{required:!1,values:!0},channel:{required:!1,values:!0},source:{required:!1,values:!0},sort:{required:!1,values:["latest"]},database:{required:!1,values:!0},"file-type":{required:!1,values:D},repo:{required:!1,values:!0},[u().HV]:{required:!1,values:["true"]},contributor:{required:!1,values:!0}},mapCounterToKey:void 0}),(e=>{let{attributes:t}=e;return{type:"observation",tagName:"search",attributes:t}})),O=o().p.map((0,d().RB)({tagName:"search-people",attributeDefinitions:{search:{required:!0,values:!0}},mapCounterToKey:void 0}),(e=>{let{attributes:t}=e;return{type:"observation",tagName:"search-people",attributes:t}})),E=o().p.map((0,d().RB)({tagName:"search-databases",attributeDefinitions:{search:{required:!0,values:!0}},mapCounterToKey:void 0}),(e=>{let{attributes:t}=e;return{type:"observation",tagName:"search-databases",attributes:t}}))},147427:(e,t,r)=>{function n(e){return"text"===e.type&&!e.value.trim()}r.d(t,{A:()=>n})},181856:(e,t,r)=>{r.d(t,{Dp:()=>C,GW:()=>u,HQ:()=>s,LN:()=>i,N8:()=>k,Qv:()=>T,RR:()=>c,S2:()=>K,SX:()=>h,TP:()=>q,Te:()=>a,Uc:()=>_,af:()=>$,bV:()=>I,dO:()=>g,gJ:()=>l,js:()=>N,kT:()=>S,nB:()=>p,nD:()=>w,oN:()=>f,oS:()=>v,qW:()=>m,u7:()=>M,w5:()=>b,wL:()=>o,xU:()=>y,yc:()=>d,yd:()=>x});r(16280),r(581454);var n=()=>r(534177);class a extends Error{constructor(e,t,r){super(t),this.type=e,this.cause=r}getMetadata(){}}class o extends a{}class i extends o{constructor(e){let t=1===e.attributeNames.length?`Unexpected attribute for <${e.tagName}> tag: ${e.attributeNames[0]}`:`Unexpected attributes for <${e.tagName}> tag: ${e.attributeNames.join(", ")}`;e.attributeNames.includes("key")&&(t+="\n\nThe key attribute is not needed. You should omit it."),super("unexpected_attributes",t)}}class s extends o{constructor(e){super("missing_attribute",`The <${e.tagName}> tag is missing a ${e.attributeName} attribute. It should be specified as <${e.tagName} ${e.attributeName}="...">`)}}class u extends o{constructor(e){super("bad_attribute",`Attempted to set attribute ${e.attributeName} on a <${e.tagName}> tag to a value that is not allowed: ${e.receivedValue}`)}}class c extends o{constructor(e){const{tagName:t,unexpectedNode:r}=e;let n;n=r?"text"===r.type?`Plain text, whitespace, or newlines are not allowed inside a <${t}> tag. Make sure not to include any extra whitespace or newlines in your XML.`:`A <${r.tagName}> tag is not allowed inside a <${t}> tag`:`Encountered an invalid child inside a <${t}> tag.`,"set-title"===t||"set-property"===t?n+=`\nOnly inline elements and text are allowed inside <${t}>`:"insert-before"===t||"insert-after"===t||"insert-inside"===t||"chat"===t?(n+=`\nOnly block elements are allowed inside <${t}>`,"chat"===t&&(n+="\nWhen using <chat>, remember to wrap text in <text> tags.")):"create"===t&&(n+="\nWhen using <create>, remember to wrap in a <page> tag."),super("disallowed_child",n),this.tagName=void 0,this.unexpectedNode=void 0,this.tagName=t,this.unexpectedNode=r}}class p extends o{constructor(e){const{tagName:t,unexpectedNode:r,conditionName:n,cause:a}=e;super("disallowed_child_in_condition",r?"text"===r.type?`Plain text, whitespace, or newlines are not allowed inside a <${t}> tag with "${n}" condition`:`A <${r.tagName}> tag is not allowed inside a <${t}> tag with "${n}" condition`:`Encountered an invalid child inside a <${t}> tag with "${n}" condition`),this.cause=void 0,this.cause=a}}class l extends o{constructor(e){super("expected_tag_name",`Expected a <${e}> tag`)}}class d extends o{constructor(e){let t;(0,n().O9)(e.unexpectedNode)?"text"===e.unexpectedNode.type?t=`Text is not supported as a child for a ${e.nodeType} node`:"element"===e.unexpectedNode.type?t=`Unsupported ${e.nodeType} tag name: ${e.unexpectedNode.tagName}`:(0,n().HB)(e.unexpectedNode):t=`Unexpected value for a ${e.nodeType} node`,super("unsupported_node",t)}}class m extends o{constructor(e,t){super("unmapped_id",`Expected counter ID for attribute ${e}, instead received ${t}`)}}class y extends o{constructor(e){const{expectedIdType:t,receivedIdType:r,tagNameForErrorMessage:n,idValueForErrorMessage:a}=e;super("unexpected_id_type",n?`Expected ID ${a} in <${n}> to be of type '${t}', instead received ID of type '${r}'`:`Expected ID ${a} to be of type '${t}', instead received ID of type '${r}'`)}}class h extends o{constructor(e){super("out_of_order_node",`Encountered a ${e.foundNodeType} after a ${e.incorrectlyAfterType}. You should ensure that any ${e.foundNodeType}s come before ${e.incorrectlyAfterType}s.`)}}class g extends o{constructor(){super("table_row_property_name","Inside tr, the property-text name attribute must be a string which is an integer counter, starting from 1.")}}class b extends o{constructor(){super("synced_block_invalid_children","Cannot include content when writing a <synced-block-reference> tag")}}class f extends o{constructor(){super("must_provide_id","Block node is missing an id attribute")}}class v extends o{constructor(){super("cannot_provide_id","When creating new blocks, do not provide an id attribute.")}}class k extends o{constructor(){super("must_provide_unknown_block_id","When referencing unknown blocks, you must provide an id.")}}class x extends o{constructor(){super("cannot_append_to_multiple_properties","Cannot append to multiple properties. Use multiple calls to <insert-inside> instead.")}}class w extends o{constructor(){super("cannot_remove_from_multiple_properties","Cannot remove from multiple properties. Use multiple calls to <delete> instead.")}}class T extends o{constructor(){super("move_disallowed","A <move> tag is not allowed in this context")}}class _ extends o{constructor(){super("set_attribute_without_key","<set-attribute> is missing an attribute to set")}}class N extends o{constructor(e){super("invalid_query_condition",`<${e.tagName}> condition operator must be ${e.allowedOperators.map((e=>`"${e}"`)).join(" or ")}, not "${e.inputCondition}"`)}}class C extends o{constructor(e){super("children_required",`<${e.tagName}> must have children`)}}class I extends o{constructor(e){super("only_one_child_allowed",`Only one ${e} element is allowed`)}}class q extends o{constructor(e){super("unknown_api",`Unexpected API: ${e}. Make sure to use only the supported XML APIs, and ensure you are using this API in the right context.`)}}class M extends a{constructor(e,t){super("load_page_as_xml_failed",t),this.pageId=e}getMetadata(){return{pageId:this.pageId}}}class K extends a{constructor(e,t){super("load_database_as_xml_failed",t),this.databaseId=e}getMetadata(){return{databaseId:this.databaseId}}}class S extends a{constructor(){super("illegal_replace_page",'When calling <replace> on a page, you must provide a <page> tag as the single child, like this: <replace start="..." end="..."><page>...</page></replace>.')}}class $ extends a{constructor(){super("out_of_order_replace","When calling <replace>, the start of the range must be AFTER the end of the range.")}}},228803:(e,t,r)=>{r.d(t,{Et:()=>d});r(16280),r(944114),r(898992),r(354520);var n=()=>r(973647),a=()=>r(534177),o=()=>r(251582),i=()=>r(181856),s=()=>r(252050),u=()=>r(147427),c=(r(581454),()=>r(331119));const p=o().p.map(c().W6,(e=>({type:"text",value:e.value})));function l(e){const t=(0,a().s8)(s()._S,((t,r)=>function(e,t){const r=s()._S[e],{mapCounterToKey:a}=t;return o().p.mapResult((0,c().U5)(e),(t=>{const i=(0,c().ke)({inputAttributes:t.attributes,definitions:r.attributes,tagName:e,mapCounterToKey:a});if(n().Q.isFail(i))return i;let s=t.children??[];r.text||(s=s.filter((e=>!(0,u().A)(e))));const p=(0,o().$d)(o().p.manyTill(d({inlineNodesAllowed:r.inline,textAllowed:r.text,parentTagName:e,mapCounterToKey:a}),o().p.eof()),s);if(n().Q.isFail(p))return p;const l=p.value;return{value:{type:"inline",tagName:e,attributes:i.value,children:l}}}))}(r,e)));return t}function d(e){const{inlineNodesAllowed:t,textAllowed:r,parentTagName:n,mapCounterToKey:s}=e,u=[...t],c=[];for(const[o,i]of(0,a().WP)(l({mapCounterToKey:s})))(0,a().Xk)(u,o)&&c.push(i);return o().p.choice([...c,...r?[p]:[],o().p.fail((e=>e.length>0?new(i().RR)({tagName:n,unexpectedNode:e[0]}):new Error("No inline or text node")))])}},251582:(e,t,r)=>{r.d(t,{$d:()=>i,AZ:()=>s,p:()=>c});r(16280),r(944114),r(581454);var n=()=>r(496603),a=()=>r(973647);class o extends Error{constructor(e){super(e)}}function i(e,t){const r=Array.isArray(t)?t:[t],[,n]=e(r);return n.status?{value:n.value}:{error:n.error}}function s(e,t){const r=i(e,t);if(a().Q.isFail(r))throw r.error;return r.value}const u=Symbol("ManyTillEndSentinel"),c={try:e=>t=>{const[r,n]=e(t);return n.status?[r,n]:[t,n]},any:()=>e=>e.length>0?[e.slice(1),{status:!0,value:e[0]}]:[[],{status:!1,error:new o("Reached end of input")}],eof:e=>t=>0===t.length?[[],{status:!0,value:void 0}]:[t,{status:!1,error:(null==e?void 0:e(t[0]))??new o("Expected end of input")}],map:(e,t)=>r=>{const[n,a]=e(r);return[n,a.status?{status:!0,value:t(a.value)}:a]},mapResult:(e,t)=>r=>{const[n,o]=c.map(e,t)(r);return o.status?a().Q.isFail(o.value)?[n,{status:!1,error:o.value.error}]:[n,{status:!0,value:o.value.value}]:[n,o]},andThen:(e,t)=>r=>{const[n,a]=e(r);return a.status?t(a.value)(n):[n,a]},sequence:function(e){return t=>{const r=[];for(const n of e){const[e,a]=n(t);if(!a.status)return[e,a];r.push(a.value),t=e}return[t,{status:!0,value:r}]}},satisfy:function(e){return c.try((t=>{const[r,n]=c.any()(t);return n.status&&!e(n.value)?[r,{status:!1,error:new o("Failed predicate")}]:[r,n]}))},filter:function(e,t){return c.try((r=>{const[n,a]=e(r);return[n,a.status?t(a.value)?a:{status:!1,error:new o("Failed predicate")}:a]}))},literal:e=>c.describe(c.satisfy((t=>n().n4(t,e))),(()=>new o(`Expected: ${JSON.stringify(e)}.`))),describe:(e,t)=>r=>{const[n,a]=e(r);return[n,a.status?a:{status:!1,error:t()}]},constant:e=>t=>[t,{status:!0,value:e}],choice:e=>0===e.length?c.fail((()=>new o("No parsers to choose from"))):t=>{let r=e[0](t);for(const a of e.slice(1)){const[e,o]=r;if(o.status||!n().n4(e,t))return r;r=a(t)}return r},fail:e=>t=>[t,{status:!1,error:e(t)}],many:e=>t=>{const r=[];for(;;){const[n,a]=c.try(e)(t);if(!a.status)return[n,{status:!0,value:r}];r.push(a.value),t=n}},manyTill:(e,t)=>r=>{const n=[];for(;;){const[a,o]=c.choice([c.map(t,(()=>u)),c.try(e)])(r);if(!o.status)return[a,o];if(o.value===u)return[a,{status:!0,value:n}];n.push(o.value),r=a}},many1:e=>c.map(c.sequence([e,c.many(e)]),(e=>{let[t,r]=e;return[t,...r]})),sepBy:(e,t)=>c.choice([c.sepBy1(e,t),c.constant([])]),sepBy1:(e,t)=>c.andThen(e,(r=>c.map(c.many(c.map(c.sequence([t,e]),(e=>{let[,t]=e;return t}))),(e=>[r,...e])))),lazy:e=>c.andThen(c.constant(void 0),e),lookAhead:e=>t=>[t,e(t)[1]]}},252050:(e,t,r)=>{r.d(t,{BP:()=>u,Bt:()=>c,F6:()=>p,Fu:()=>O,GU:()=>m,HV:()=>Q,L7:()=>R,MQ:()=>A,P8:()=>s,RD:()=>_,RI:()=>b,RW:()=>F,Su:()=>D,Tj:()=>E,U4:()=>h,VB:()=>S,Ve:()=>U,Y1:()=>B,_S:()=>d,aL:()=>H,ew:()=>M,g5:()=>W,gc:()=>L,h5:()=>P,qI:()=>l,sA:()=>I,sW:()=>q,sk:()=>k,w3:()=>j,wn:()=>K,z5:()=>$});r(581454);var n=r.n(r(625473)),a=()=>r(498212),o=()=>r(534177),i=()=>r(206267);(0,o().u0)((e=>"element"===e.type?{true:e}:{false:e}));const s={default:"default",gray:"gray",brown:"brown",orange:"orange",yellow:"yellow",teal:"green",blue:"blue",purple:"purple",pink:"pink",red:"red",default_background:"default-background",gray_background:"gray-background",brown_background:"brown-background",orange_background:"orange-background",yellow_background:"yellow-background",teal_background:"green-background",blue_background:"blue-background",purple_background:"purple-background",pink_background:"pink-background",red_background:"red-background"},u=Object.fromEntries(Object.entries(s).map((e=>{let[t,r]=e;return[r,t]}))),c=Object.values(s),p=["mention-page","mention-database","mention-person","mention-assistant","mention-date","mention-datetime","mention-date-range","mention-datetime-range","mention-link"],l=["b","i","code","s","u","a","h","e",...p],d={b:{attributes:{},inline:l,text:!0,isToken:!1},i:{attributes:{},inline:l,text:!0,isToken:!1},code:{attributes:{},inline:l,text:!0,isToken:!1},s:{attributes:{},inline:l,text:!0,isToken:!1},u:{attributes:{},inline:l,text:!0,isToken:!1},a:{attributes:{href:{required:!0,values:!0,description:"link URL. Do not link to any URLs that are not already in the current context.",mappingMode:"href_counter"},type:{required:!1,values:r(972261).PI,description:"universal source type"},"external-id":{required:!1,values:!0,description:"ID for loadable external resource",mappingMode:"external_id_counter"}},inline:l,text:!0,isToken:!1},h:{attributes:{color:{required:!0,values:c,description:"text color"}},inline:l,text:!0,isToken:!1},e:{attributes:{equation:{required:!0,values:!0,description:"LaTeX equation string"}},inline:[],text:!0,isToken:!0},"mention-page":{attributes:{"page-id":{required:!0,values:!0,description:"ID of page",mappingMode:"block_counter"}},inline:[],text:!0,isToken:!0},"mention-link":{attributes:{href:{required:!0,values:!0,description:"link URL. Do not link to any URLs that are not already in the current context."},title:{required:!1,values:!0,description:"Linked page title"},icon_url:{required:!1,values:!0,description:"Favicon. Do not edit this field."},description:{required:!1,values:!0,description:"Linked page description. Do not edit this field."}},inline:[],text:!0,isToken:!0},"mention-database":{attributes:{"database-id":{required:!0,values:!0,description:"ID of database",mappingMode:"collection_counter"}},inline:[],text:!0,isToken:!0},"mention-person":{attributes:{"person-id":{required:!0,values:!0,description:"ID of person",mappingMode:"person_counter"},"person-name":{required:!1,values:!0,description:"Name of person"}},inline:[],text:!0,isToken:!0},"find-person":{attributes:{name:{required:!0,values:!0,description:"Name of person"}},inline:[],text:!0,isToken:!0},"mention-assistant":{attributes:{},inline:[],text:!0,isToken:!0},"mention-date":{attributes:{date:{required:!0,values:!0,description:"Date in ISO 8601 (YYYY-MM-DD) format"}},inline:[],text:!1,isToken:!1},"mention-datetime":{attributes:{date:{required:!0,values:!0,description:"Date in ISO 8601 (YYYY-MM-DD) format"},time:{required:!0,values:!0,description:"Time in ISO 8601 (HH:MM) format"}},inline:[],text:!1,isToken:!1},"mention-date-range":{attributes:{"start-date":{required:!0,values:!0,description:"Start date in ISO 8601 (YYYY-MM-DD) format"},"end-date":{required:!0,values:!0,description:"End date in ISO 8601 (YYYY-MM-DD) format"}},inline:[],text:!1,isToken:!1},"mention-datetime-range":{attributes:{"start-date":{required:!0,values:!0,description:"Start date in ISO 8601 (YYYY-MM-DD) format"},"end-date":{required:!0,values:!0,description:"End date in ISO 8601 (YYYY-MM-DD) format"},"start-time":{required:!0,values:!0,description:"Start time in ISO 8601 (HH:MM) format"},"end-time":{required:!0,values:!0,description:"End time in ISO 8601 (HH:MM) format"}},inline:[],text:!1,isToken:!1},option:{attributes:{option:{values:!0,description:"Option name",required:!0}},inline:[],text:!1,isToken:!1},"option-category":{attributes:{category:{values:!0,description:"Status category",required:!0}},inline:[],text:!1,isToken:!1},"schema-option":{attributes:{option:{values:!0,description:"Option name",required:!0}},inline:[],text:!1,isToken:!1},"schema-option-category":{attributes:{category:{values:!0,description:"Status category",required:!0}},inline:["schema-option"],text:!1,isToken:!1}},m={"property-title":{text:!0,inline:p,attributes:{}},"property-text":{text:!0,inline:l,attributes:{}},"property-url":{text:!0,inline:[],attributes:{}},"property-email":{text:!0,inline:[],attributes:{}},"property-phone-number":{text:!0,inline:[],attributes:{}},"property-person":{text:!1,inline:["mention-person","find-person"],attributes:{}},"property-date":{text:!1,inline:["mention-date","mention-date-range","mention-datetime","mention-datetime-range"],attributes:{}},"property-created-time":{text:!1,inline:["mention-date","mention-datetime"],attributes:{}},"property-last-edited-time":{text:!1,inline:["mention-date","mention-datetime"],attributes:{}},"property-created-by":{text:!1,inline:["mention-person"],attributes:{}},"property-last-edited-by":{text:!1,inline:["mention-person"],attributes:{}},"property-checkbox":{text:!1,inline:[],attributes:{checked:{values:["true","false"],description:'checked state, either "true" or "false"',required:!0}}},"property-select":{text:!1,inline:["option"],attributes:{}},"property-multi-select":{text:!1,inline:["option"],attributes:{}},"property-relation":{text:!1,inline:["mention-page"],attributes:{"database-id":{values:!0,description:"The database ID the relation points to",required:!1,mappingMode:"collection_counter"}}},"property-status":{text:!1,inline:["option"],attributes:{}},"property-number":{text:!1,inline:[],attributes:{number:{values:!0,description:"value",required:!1}}}},y=(0,o().uv)(m),h={"schema-property-title":{propertyTagName:"property-title",inline:[],attributes:{}},"schema-property-text":{propertyTagName:"property-text",inline:[],attributes:{}},"schema-property-url":{propertyTagName:"property-url",inline:[],attributes:{}},"schema-property-email":{propertyTagName:"property-email",inline:[],attributes:{}},"schema-property-phone-number":{propertyTagName:"property-phone-number",inline:[],attributes:{}},"schema-property-person":{propertyTagName:"property-person",inline:[],attributes:{limit:{values:["1","Infinity"],description:"The number of options that can be added",required:!0}}},"schema-property-date":{propertyTagName:"property-date",inline:[],attributes:{}},"schema-property-created-time":{propertyTagName:"property-created-time",inline:[],attributes:{}},"schema-property-last-edited-time":{propertyTagName:"property-last-edited-time",inline:[],attributes:{}},"schema-property-created-by":{propertyTagName:"property-created-by",inline:[],attributes:{}},"schema-property-last-edited-by":{propertyTagName:"property-last-edited-by",inline:[],attributes:{}},"schema-property-checkbox":{propertyTagName:"property-checkbox",inline:[],attributes:{}},"schema-property-select":{propertyTagName:"property-select",inline:["schema-option"],attributes:{}},"schema-property-multi-select":{propertyTagName:"property-multi-select",inline:["schema-option"],attributes:{}},"schema-property-relation":{propertyTagName:"property-relation",inline:["mention-page"],attributes:{limit:{values:["1","Infinity"],description:"The number of options that can be added",required:!0},"database-id":{values:!0,description:"The database ID the relation points to",required:!0,mappingMode:"collection_counter"},"synced-property-name":{required:!1,values:!0,description:"The symmetric relation property name in the database this relation points to"}}},"schema-property-status":{propertyTagName:"property-status",inline:["schema-option-category"],attributes:{}},"schema-property-number":{propertyTagName:"property-number",inline:[],attributes:{format:{values:!0,description:"Number format",required:!1}}}},g={is:{text:!1,inline:["mention-date"],attributes:{}},">":{text:!1,inline:["mention-date"],attributes:{}},"<":{text:!1,inline:["mention-date"],attributes:{}},"≥":{text:!1,inline:["mention-date"],attributes:{}},"≤":{text:!1,inline:["mention-date"],attributes:{}},"is empty":{text:!1,inline:[],attributes:{}}},b={"property-title":{is:{text:!0,inline:[],attributes:{}},contains:{text:!0,inline:[],attributes:{}},"is empty":{text:!1,inline:[],attributes:{}}},"property-text":{is:{text:!0,inline:[],attributes:{}},contains:{text:!0,inline:[],attributes:{}},"is empty":{text:!1,inline:[],attributes:{}}},"property-url":{is:{text:!0,inline:[],attributes:{}},contains:{text:!0,inline:[],attributes:{}},"is empty":{text:!1,inline:[],attributes:{}}},"property-email":{is:{text:!0,inline:[],attributes:{}},contains:{text:!0,inline:[],attributes:{}},"is empty":{text:!1,inline:[],attributes:{}}},"property-phone-number":{is:{text:!0,inline:[],attributes:{}},contains:{text:!0,inline:[],attributes:{}},"is empty":{text:!1,inline:[],attributes:{}}},"property-person":{contains:{text:!1,inline:["mention-person","find-person"],attributes:{}},"is empty":{text:!1,inline:[],attributes:{}}},"property-date":g,"property-created-time":g,"property-last-edited-time":g,"property-created-by":{contains:{text:!1,inline:["mention-person"],attributes:{}},"is empty":{text:!1,inline:[],attributes:{}}},"property-last-edited-by":{contains:{text:!1,inline:["mention-person"],attributes:{}},"is empty":{text:!1,inline:[],attributes:{}}},"property-checkbox":{is:{text:!1,inline:[],attributes:{checked:{values:["true","false"],description:'checked state, either "true" or "false"',required:!0}}}},"property-select":{is:{text:!1,inline:["option"],attributes:{}},"is empty":{text:!1,inline:[],attributes:{}}},"property-multi-select":{contains:{text:!1,inline:["option"],attributes:{}},"is empty":{text:!1,inline:[],attributes:{}}},"property-relation":{contains:{text:!1,inline:["mention-page"],attributes:{}},"is empty":{text:!1,inline:[],attributes:{}}},"property-status":{is:{text:!1,inline:["option","option-category"],attributes:{}},"is empty":{text:!1,inline:[],attributes:{}}},"property-number":{is:{text:!1,inline:[],attributes:{number:{values:!0,description:"value",required:!0}}},">":{text:!1,inline:[],attributes:{number:{values:!0,description:"value",required:!0}}},"<":{text:!1,inline:[],attributes:{number:{values:!0,description:"value",required:!0}}},"≥":{text:!1,inline:[],attributes:{number:{values:!0,description:"value",required:!0}}},"≤":{text:!1,inline:[],attributes:{number:{values:!0,description:"value",required:!0}}},"is empty":{text:!1,inline:[],attributes:{}}}},f=["Count all"],v=["Count values","Count unique values","Count empty","Count not empty","Percent empty","Percent not empty","Show unique values"],k={"Count all":"count","Count values":"count_values","Count unique values":"unique","Count empty":"empty","Count not empty":"not_empty","Percent empty":"percent_empty","Percent not empty":"percent_not_empty","Show unique values":"show_unique","Count checked":"checked","Count unchecked":"unchecked","Percent checked":"percent_checked","Percent unchecked":"percent_unchecked","Count per group":"count_per_group","Percent per group":"percent_per_group",Sum:"sum",Average:"average",Median:"median",Min:"min",Max:"max",Range:"range","Earliest date":"earliest_date","Latest date":"latest_date","Date range":"date_range"},x={basic:[...f,...v],date:[...f,...v,"Earliest date","Latest date","Date range"],status:[...f,...v,"Count per group","Percent per group"],number:[...f,...v,"Sum","Average","Median","Min","Max","Range"],checkbox:[...f,"Count checked","Count unchecked","Percent checked","Percent unchecked"]};function w(e){return`the name of the ${e} property being aggregated`}function T(e){return`the method of aggregation for the ${e} property`}const _={"aggregation-property-title":{attributes:{name:{required:!0,values:!0,description:w("title")},aggregation:{values:x.basic,required:!0,description:T("title")}}},"aggregation-property-text":{attributes:{name:{required:!0,values:!0,description:w("text")},aggregation:{values:x.basic,required:!0,description:T("text")}}},"aggregation-property-url":{attributes:{name:{required:!0,values:!0,description:w("url")},aggregation:{values:x.basic,required:!0,description:T("url")}}},"aggregation-property-email":{attributes:{name:{required:!0,values:!0,description:w("email")},aggregation:{values:x.basic,required:!0,description:T("email")}}},"aggregation-property-phone-number":{attributes:{name:{required:!0,values:!0,description:w("phone_number")},aggregation:{values:x.basic,required:!0,description:T("phone_number")}}},"aggregation-property-date":{attributes:{name:{values:!0,required:!0,description:w("date")},aggregation:{values:x.date,required:!0,description:T("date")}}},"aggregation-property-created-time":{attributes:{name:{values:!0,required:!0,description:w("created-time")},aggregation:{values:x.date,required:!0,description:T("created-time")}}},"aggregation-property-last-edited-time":{attributes:{name:{values:!0,required:!0,description:w("last-edited-time")},aggregation:{values:x.date,required:!0,description:T("last-edited-time")}}},"aggregation-property-person":{attributes:{name:{values:!0,required:!0,description:w("person")},aggregation:{values:x.basic,required:!0,description:T("person")}}},"aggregation-property-created-by":{attributes:{name:{values:!0,required:!0,description:w("created-by")},aggregation:{values:x.basic,required:!0,description:T("created-by")}}},"aggregation-property-last-edited-by":{attributes:{name:{values:!0,required:!0,description:w("last-edited-by")},aggregation:{values:x.basic,required:!0,description:T("last-edited-by")}}},"aggregation-property-checkbox":{attributes:{name:{values:!0,required:!0,description:w("checkbox")},aggregation:{values:x.checkbox,required:!0,description:T("checkbox")}}},"aggregation-property-select":{attributes:{name:{values:!0,required:!0,description:w("select")},aggregation:{values:x.basic,required:!0,description:T("select")}}},"aggregation-property-multi-select":{attributes:{name:{values:!0,required:!0,description:w("multi-select")},aggregation:{values:x.basic,required:!0,description:T("multi-select")}}},"aggregation-property-relation":{attributes:{name:{values:!0,required:!0,description:w("relation")},aggregation:{values:x.basic,required:!0,description:T("relation")}}},"aggregation-property-number":{attributes:{name:{values:!0,required:!0,description:w("number")},aggregation:{values:x.number,required:!0,description:T("number")}}},"aggregation-property-status":{attributes:{name:{values:!0,required:!0,description:w("status")},aggregation:{values:x.status,required:!0,description:T("status")},group:{values:!0,required:!0,description:"then name of the status group being aggregated when aggregation is 'Count per group' or 'Percent per group'. For other aggregations, just provide any group name."}}}},N=["hr","h1","h2","h3","database","math-block","code-block","child-page","link-page","child-database","link-database","database-views","text","page","synced-block","synced-block-reference","uli","oli","toggle","quote","callout","todo","columns","table","unknown-block"],C={required:!1,values:c,description:"color for the block"},I={hr:{title:!1,content:[],attributes:{},properties:[],schemas:[]},h1:{title:!0,content:[],attributes:{color:C},properties:[],schemas:[]},h2:{title:!0,content:[],attributes:{color:C},properties:[],schemas:[]},h3:{title:!0,content:[],attributes:{color:C},properties:[],schemas:[]},database:{title:!1,content:[],attributes:{},properties:["property-title"],schemas:y},"math-block":{title:!0,content:[],attributes:{},properties:[],schemas:[]},"code-block":{title:!0,content:[],attributes:{language:{required:!1,values:r(15440).yz,description:"language of code"}},properties:[],schemas:[]},"child-page":{title:!1,content:[],attributes:{"page-id":{required:!0,values:!0,description:"ID of page, to be used in <load>",mappingMode:"block_counter"},"database-id":{required:!1,values:!0,description:"The ID of the database this page is within, if there is one",mappingMode:"collection_counter"},"has-content":{required:!1,values:["true","false"],description:'"true" if the page has content, "false" otherwise'}},properties:y,schemas:[]},"link-page":{title:!1,content:[],attributes:{"page-id":{required:!0,values:!0,description:"ID of page, to be used in <load>",mappingMode:"block_counter"},"database-id":{required:!1,values:!0,description:"The ID of the database this page is within, if there is one",mappingMode:"collection_counter"}},properties:y,schemas:[]},"child-database":{title:!1,content:[],attributes:{"database-id":{required:!0,values:!0,description:"ID of database. Make sure to use the value of this attribute as the id in query-database.",mappingMode:"block_counter"}},properties:["property-title"],schemas:y},"database-views":{title:!1,content:[],attributes:{},properties:["property-title"],schemas:y},"link-database":{title:!1,content:[],attributes:{"database-id":{required:!0,values:!0,description:"ID of database",mappingMode:"collection_counter"}},properties:["property-title"],schemas:y},text:{title:!0,content:N,attributes:{color:C},properties:[],schemas:[]},page:{title:!1,content:N,attributes:{"database-id":{required:!1,values:!0,description:"ID of the database this page belongs to. Use this to look up the schema for the page",mappingMode:"collection_counter"},"page-font":{required:!1,values:["default","serif","mono"],description:"Font used for the page"},"page-width":{required:!1,values:["default","full-width"],description:"Width of the page"},"page-font-size":{required:!1,values:["default","small"],description:"Font size for the page"}},properties:y,schemas:[]},uli:{title:!0,content:N,attributes:{color:C},properties:[],schemas:[]},oli:{title:!0,content:N,attributes:{color:C,index:{required:!1,values:!0,description:"Specify a custom index for the list item"}},properties:[],schemas:[]},toggle:{title:!0,content:N,attributes:{color:C,size:{required:!1,values:["h1","h2","h3"],description:"size of the toggle header, if the toggle is a header"}},properties:[],schemas:[]},quote:{title:!0,content:N,attributes:{color:C},properties:[],schemas:[]},todo:{title:!0,content:N,attributes:{checked:{required:!0,values:["true","false"],description:'checked state, either "true" or "false"'},color:C},properties:[],schemas:[]},callout:{title:!0,content:N,attributes:{color:C},properties:[],schemas:[]},"synced-block":{title:!1,content:N,attributes:{},properties:[],schemas:[]},"synced-block-reference":{title:!1,content:N,attributes:{"synced-block-id":{required:!0,values:!0,description:"The ID of the <synced-block> node that this references",mappingMode:"block_counter"}},properties:[],schemas:[]},columns:{title:!1,content:["column"],attributes:{},properties:[],schemas:[]},column:{title:!1,content:N,attributes:{},properties:[],schemas:[]},table:{title:!1,content:["tr"],attributes:{"header-row":{required:!1,values:["true","false"],description:'whether first <tr> is row header, either "true" or "false"'},"header-column":{required:!1,values:["true","false"],description:'whether first <td> in every <tr> is column header, either "true" or "false"'}},properties:[],schemas:["property-text"]},tr:{title:!1,content:[],attributes:{},properties:["property-text"],schemas:[]},"ai-block":{title:!0,content:N,attributes:{},properties:["property-text"],schemas:[]},transcript:{title:!0,content:N,attributes:{},properties:[],schemas:[]},"unknown-block":{title:!0,content:N,attributes:{type:{required:!1,values:Object.values(r(700500).xd),description:"the type of the unknown block"}},properties:[],schemas:[]}},q=Object.freeze((0,o().uv)({text:!0,toggle:!0,quote:!0,callout:!0,uli:!0,oli:!0,todo:!0,h1:!0,h2:!0,h3:!0}));function M(e){return e}function K(e){return e}function S(e){return e}function $(e){return e}function D(e){return e}function A(e){return e}function O(e){return e}function E(e){return e}function R(e){return e}function P(e){return e}function j(e){return e}function F(e){return e}function U(e){return e}function B(){return i().JW()}function H(e){return(0,a().gB)(n()(e))}const L=(0,o().u0)((e=>"collectionView"===e.type?{true:e}:{false:e})),Q="search-notion-help",W=(0,o().u0)((e=>"synced-block-reference"===e||"ai-block"===e||"database-views"===e||"transcript"===e?{true:e}:{false:e}))},272600:(e,t,r)=>{r.d(t,{p:()=>i});r(898992),r(672577);var n=()=>r(896628),a=()=>r(246826),o=()=>r(508496);function i(e){const{collectionViewBlockStore:t,collectionPointer:r,transaction:i}=e;a().zv({store:t,data:{collection_id:null},transaction:i});if(o().default.checkGate({gateName:"workflow_container"})){const e=t.getCollectionPointers();(null==e?void 0:e.find((e=>e.id===r.id)))||n().zA({stores:[t],update:{collection_pointers:[...e??[],r]},transaction:i})}n().zA({stores:[t],update:{collection_pointer:r},transaction:i})}},331119:(e,t,r)=>{r.d(t,{RB:()=>f,U5:()=>p,W6:()=>l,ke:()=>y,nx:()=>g,t7:()=>h,x3:()=>b});r(16280),r(18107),r(944114),r(898992),r(354520),r(672577),r(581454);var n=()=>r(496603),a=()=>r(973647),o=()=>r(534177),i=()=>r(251582),s=()=>r(181856),u=()=>r(832443);const c=i().p.satisfy((0,o().u0)((e=>"element"===e.type?{true:e}:{false:e})));function p(e){return i().p.describe(i().p.filter(c,(t=>t.tagName===e)),(()=>new(s().gJ)(e)))}const l=i().p.satisfy((0,o().u0)((e=>"text"===e.type?{true:e}:{false:e}))),d=i().p.satisfy((e=>"text"===e.type&&""===e.value.trim()));function m(e){const{prefixMappingMode:t,baseHref:r}=e;return"query_database_result_counter"===t?`query_database_result_counter:/${u().tD.blockIdToHref(r)}`:"href_counter"===t?r:void(0,o().HB)(t)}function y(e){const{inputAttributes:t={},definitions:r,tagName:i,validateRequiredAttributes:c=!0,mapCounterToKey:p}=e,l=Object.keys(t),d=Object.keys(r),y=n().R9(l,d);if(y.length>0)return{error:new(s().LN)({attributeNames:y,tagName:i})};if(c)for(const[n,a]of Object.entries(r))if(a.required&&!l.includes(n))return{error:new(s().HQ)({attributeName:n,tagName:i})};const h=n().o8(t);for(const[n,g]of Object.entries(t)){const e=r[n];if((0,o().O9)(e.mappingMode)){if("href_counter"!==e.mappingMode&&!(0,u().D4)(g))return{error:new(s().qW)(n,g)};if((0,o().O9)(p)&&"href_counter"===e.mappingMode){let e;const t=["href_counter","query_database_result_counter"];for(const r of t)if(e=u().tD.mapCounterToKeyInMode({mapCounterToKey:p},g,r,i),a().Q.isSuccess(e)){h[n]=m({prefixMappingMode:r,baseHref:e.value});break}if(a().Q.isFail(e))return{error:new(s().wL)("unmapped_id",e.error.message,e.error)}}else if((0,o().O9)(p)){const t=u().tD.mapCounterToKeyInMode({mapCounterToKey:p},g,e.mappingMode,i);if(a().Q.isFail(t))return{error:new(s().wL)("unmapped_id",t.error.message,t.error)};h[n]=t.value}}if(!0!==e.values&&!e.values.includes(g))return{error:new(s().GW)({attributeName:n,receivedValue:g,tagName:i})}}return{value:h}}function h(e,t){if(0===e.length)throw new Error("Must provide at least 1 label and type guard");const r=[...e],n=[[]];for(const o of t){const[t,i]=r[0];if(!i(o)){for(;r.length>0;){r.shift();const e=r[0];if(n.push([]),e&&e[1](o))break}if(0===r.length){var a;const r=null===(a=e.find((e=>{let[,t]=e;return t(o)})))||void 0===a?void 0:a[0];if(!r)throw new Error(`Item did not match any type guards: ${JSON.stringify(o)}`);return{error:{incorrectLabel:r,lastLabel:t}}}}n.at(-1).push(o)}for(;n.length<e.length;)n.push([]);return{value:n}}function g(e,t,r){const{allowUnmatchedText:a=!1}=r??{},o=i().p.manyTill(i().p.choice([...t,...a?[i().p.map(d,(e=>{}))]:[],i().p.fail((t=>new(s().RR)({tagName:e,unexpectedNode:n().$1(t)})))]),i().p.eof());return i().p.map(o,(e=>n().oE(e)))}function b(e){return e.children&&e.children.length>0?{error:new(s().RR)({tagName:e.tagName,unexpectedNode:e.children[0]})}:{value:void 0}}function f(e){const{tagName:t,attributeDefinitions:r,mapCounterToKey:n}=e;return i().p.mapResult(p(t),(e=>{const o=y({tagName:t,inputAttributes:e.attributes,definitions:r,mapCounterToKey:n});if(a().Q.isFail(o))return o;const i=b(e);return a().Q.isFail(i)?i:{value:{attributes:o.value}}}))}},460744:(e,t,r)=>{r.d(t,{vK:()=>s,uF:()=>c,Mt:()=>p,RM:()=>u});r(813451),r(944114),r(898992),r(354520),r(672577),r(737550);var n=()=>r(534177),a=()=>r(724639),o=()=>r(465498),i=(r(16280),()=>r(985854));const s={id:"32983546-2835-4c6b-9101-25f10781415c",name:"inference-saved-examples"};function u(e,t){const r={};for(const n of e)"registered-tool-grouping"===n.type&&(r[n.toolCallId]=n);let s=[...e];if("config"===t.type||"user"===t.type||"error"===t.type||"context"===t.type||"workflow-error"===t.type||"title"===t.type||"retry"===t.type||"autocorrect"===t.type||"search-observation"===t.type||"researcher-next-steps"===t.type||"researcher-text-observation"===t.type||"debug-inference"===t.type||"fast-researcher-plan"===t.type||"fast-researcher-search-results"===t.type||"memory-agent"===t.type||"summarize-transcript"===t.type||"summarize-transcript-error"===t.type||"summarize-transcript-response"===t.type||"summarize-transcript-thinking"===t.type||"workflow-run-investigation"===t.type||"workflow-runs"===t.type||"workflow-function-call-request"===t.type||(0,a().P0)(t)||"researcher-agent-group"===t.type)s.push({...t});else if("workflow-inference"===t.type||"search"===t.type)s=[...s.filter((e=>e.id!==t.id)),{...t}];else if("workflow-function-call-results"===t.type){const e=s.findLastIndex((e=>e.id===t.id));if(-1!==e&&"workflow-function-call-results"===s[e].type){const r=s[e];s[e]={...r,value:[...r.value,...t.value]}}else s.push({...t})}else if("markdown-chat"===t.type){const e=s.findLastIndex((e=>e.id===t.id));if(-1!==e&&"markdown-chat"===s[e].type){const r=s[e];s[e]={...r,value:`${r.value}${t.value}`}}else s.push({...t})}else if("search-chat"===t.type){const e=s.findLastIndex((e=>e.id===t.id));if(-1!==e&&"search-chat"===s[e].type){const r=s[e];s[e]={...r,value:`${r.value}${t.value}`}}else s.push({...t})}else if("fast-researcher-chat"===t.type){const e=s.findLastIndex((e=>e.id===t.id));if(-1!==e&&"fast-researcher-chat"===s[e].type){const r=s[e];s[e]={...r,value:`${r.value}${t.value}`}}else s.push({...t})}else if("workflow"===t.type){const e=s.findLastIndex((e=>e.id===t.id));-1!==e&&"workflow"===s[e].type?s[e]={...t}:s.push({...t})}else if("workflow-progress"===t.type){const e=s.findLastIndex((e=>e.id===t.id));-1!==e&&"workflow-progress"===s[e].type?s[e]=function(e,t){if("workflow-progress"!==e.type||"workflow-progress"!==t.type)throw new Error("Both steps must be of type workflow-progress");const r=[...e.items||[]];for(const n of t.items||[]){const e=(0,i().v1)(n),t=r.findIndex((t=>(0,i().v1)(t)===e&&!t.completed));if(-1!==t&&n.completed){r[t]=n;continue}const a=r.findIndex((t=>(0,i().v1)(t)===e));if(-1===a)r.push(n);else{const e=r[a];e.completed&&!n.completed?r.push(n):!e.completed&&n.completed&&(r[a]=n)}}return{...e,items:r,completed:t.completed,durationMs:t.durationMs}}(s[e],t):s.push({...t})}else if("setup"===t.type){const e=s.findLastIndex((e=>e.id===t.id));-1!==e&&"setup"===s[e].type?s[e]=t:s.push({...t})}else if("researcher-report"===t.type){const e=s.findLastIndex((e=>e.id===t.id));if(-1!==e&&"researcher-report"===s[e].type){const r=s[e];s[e]={...r,value:`${r.value}${t.value}`,citationInfo:(0,o().Mi)(r.citationInfo,t.citationInfo)}}else s.push({...t})}else if("researcher-agent"===t.type){const e=s.findIndex((e=>e.id===t.id));-1!==e&&"researcher-agent"===s[e].type?s[e]={...s[e],value:Object.assign(s[e].value,t.value)}:s.push({...t})}else if("registered-tool-call"===t.type||"registered-tool-output"===t.type||"registered-tool-error"===t.type){let e=r[t.toolCallId];e||(e={id:t.toolCallId,type:"registered-tool-grouping",toolName:t.toolName,toolCallId:t.toolCallId,steps:[]},r[t.toolCallId]=e,s.push(e));const n={...t};e.steps.push(n)}else if("registered-tool-grouping"===t.type)r[t.toolCallId]||(r[t.toolCallId]=t,s.push({...t}));else if("setup-operations"===t.type){const e=s.findLastIndex((e=>e.id===t.id)),r=s[e];(null==r?void 0:r.type)===t.type?s[e]={...r,operations:[...r.operations,...t.operations]}:s.push({...t})}else(0,n().HB)(t);return s}const c="inferenceTranscript";function p(e){return"object"==typeof e&&null!==e&&"transcript"in e}},465498:(e,t,r)=>{r.d(t,{ut:()=>l,Mi:()=>c,y5:()=>s,EK:()=>u});r(944114),r(517642),r(658004),r(733853),r(845876),r(432475),r(515024),r(731698),r(898992),r(354520),r(672577),r(581454),r(737550);var n=()=>r(754093),a=()=>r(832443),o=()=>r(252050),i=()=>r(706461);function s(e){let t=1;return e.replace(/\[(.*?),(.*?),(.*?)\]/g,((e,r,n,a)=>{const o=encodeURIComponent(r),i=encodeURIComponent(n),s=encodeURIComponent(a),u=encodeURIComponent(",");return`[**[${t++}]**](#citation:${o}${u}${i}${u}${s})`}))}function u(e){return e.replace(/(\s)?\[\*\*\[\d+\]\*\*\]\(#citation:[^)]+\)/g,"")}function c(e,t){const r={stepCitations:{...e.stepCitations}};for(const[n,a]of Object.entries(t.stepCitations)){if(!r.stepCitations[n]){r.stepCitations[n]={claims:[...a.claims],artifacts:[...a.artifacts]};continue}const e=new Set(r.stepCitations[n].claims.map((e=>e.id)));for(const o of a.claims)e.has(o.id)||r.stepCitations[n].claims.push(o);const t=new Set(r.stepCitations[n].artifacts.map((e=>e.id)));for(const o of a.artifacts)t.has(o.id)||r.stepCitations[n].artifacts.push(o)}return r}const p={"slack-result":"slack","google-drive-result":"google-drive","helpdoc-result":"helpdoc","github-result":"github","webpage-result":"webpage","jira-result":"jira","sharepoint-result":"sharepoint"};function l(e,t){const r=[],s=(0,n().BD)(e.value,!1,{parseNoneClosedTags:!0})[0];if("element"!==s.type)return r;for(const n of s.children){if("element"!==n.type)continue;let e;const s=t.mapCounterToKey((0,o().VB)(n.attributes.id));if("element"!==n.type||"page"!==n.tagName&&"block"!==n.tagName){if("element"===n.type&&("slack-result"===n.tagName||"github-result"===n.tagName||"google-drive-result"===n.tagName||"jira-result"===n.tagName||"sharepoint-result"===n.tagName||"webpage"===n.tagName||"helpdoc"===n.tagName)){var u;const t=a().tD.parseAssistantHref(s.key),r="text"===(null===(u=n.children[0])||void 0===u?void 0:u.type)?n.children[0].value:"",o="slack-result"===n.tagName?n.attributes.channel:n.attributes.title;e={citationType:"universal_search",target:p[n.tagName],href:s.key,title:o,text:r,number:Number(n.attributes.id),...t}}}else{const r=t.mapCounterToKey((0,o().VB)(null==n?void 0:n.attributes.id));e={citationType:"notion",pageId:r.key,blockId:"block"===n.tagName?s.key:r.key,number:Number(n.attributes.id)}}r.push({id:n.attributes.id,artifactType:"text",content:(0,i()._o)(n),citationInfo:e})}return r}},582524:(e,t,r)=>{r.d(t,{D7:()=>R,GS:()=>$,VG:()=>H,WE:()=>P,WF:()=>L,WM:()=>D,Wq:()=>K,bO:()=>O,cO:()=>Q,gj:()=>U,hx:()=>E,i0:()=>A,mf:()=>B,v:()=>S,zf:()=>j});r(16280),r(18107),r(944114),r(967357),r(898992),r(672577),r(430670),r(581454);var n=()=>r(244641),a=()=>r(362750),o=()=>r(460744),i=()=>r(416504),s=()=>r(386164),u=()=>r(234459),c=()=>r(155792),p=()=>r(798880),l=()=>r(441738),d=()=>r(411387),m=()=>r(919709),y=()=>r(724639),h=()=>r(532659),g=()=>r(496603),b=()=>r(498212),f=()=>r(449506),v=()=>r(884107),k=()=>r(901389),x=()=>r(246826),w=()=>r(317909),T=()=>r(108184),_=()=>r(594794),N=()=>r(351360),C=()=>r(508496),I=()=>r(991249),q=()=>r(597898),M=()=>r(255299);function K(e){var t;const{clientStore:r}=e;null===(t=r.state.abortController)||void 0===t||t.abort(),r.setState({showHistory:r.state.showHistory,showDebug:r.state.showDebug,config:r.state.config,debugOverrides:r.state.debugOverrides,inferences:[],acceptedInferenceKeys:[],inferenceKeysToAnnotations:{},inferenceKeysToMemories:{},abortController:void 0,model:r.state.model,loading:!1,stopInferencePromise:void 0,temporarySteps:[],tags:[],traceId:void 0,requestInfo:void 0,userSelectedConfig:void 0})}function S(e){const{environment:t,spaceStore:r,transcript:n,threadParentPointer:a,threadId:o,transaction:i}=e,s=t.currentUser.id;if(!s)throw new Error("No current user");const c=O({environment:t,threadId:o,spaceStore:r,userId:s,transcript:n,transaction:i});return x().eC({environment:t,table:u().To,value:{id:o,parent_id:a.id,parent_table:a.table,space_id:a.spaceId,messages:c,created_time:Date.now(),created_by_id:s,created_by_table:p().oo},transaction:i,inMemoryRecordCache:r.inMemoryRecordCache})}function $(e){var t;const{threadStore:r,transaction:n,clientStore:a}=e;null===(t=a.state.abortController)||void 0===t||t.abort(),x().zv({store:r,data:{current_inference_id:null,current_inference_lease_expiration:null},transaction:n})}function D(e){const{environment:t,userStore:r,spaceStore:a}=e;return{id:(0,_().Z1)({environment:t,table:c().mS,spaceId:a.id}),type:"context",value:{timezone:(0,i().P)(),userName:null==r?void 0:r.getName(),spaceName:a.getName(),currentDatetime:n().c9.now().toISO()}}}function A(e){const{environment:t,value:r,clientStore:n,spaceStore:a,userStore:o,config:i,additionalSteps:s,threadStore:u,threadId:p,threadParentPointer:l}=e,d=t.currentUser.id??(null==o?void 0:o.id);if(!d)throw new Error("No current user");const y=u?u.getTranscript():[],h=y.find((e=>"config"===e.type)),g=y.find((e=>"context"===e.type)),b=(0,m().bBR)(r),f=[...h?[]:[{id:(0,_().Z1)({environment:t,table:c().mS,spaceId:a.id}),type:"config",value:i}],...g?[]:[D({environment:t,userStore:o,spaceStore:a})],...s,...b&&b.length>0?[{id:(0,_().Z1)({environment:t,table:c().mS,spaceId:a.id}),type:"user",value:b,userId:d}]:[]];u?(w().createAndCommit({userAction:"FullPageAI.handleSubmit",environment:t,canUndo:!0,perform:e=>{const r=O({environment:t,threadId:p,spaceStore:a,userId:d,transcript:f,transaction:e});w().applyOperation({operation:{args:{ids:r,after:u.getMessages().at(-1)},command:"listAfterMulti",path:["messages"],pointer:u.pointer},store:u,transaction:e})}}),P({environment:t,clientStore:n,threadStore:u})):P({environment:t,clientStore:n,threadStore:void 0,createThreadArgs:{threadId:p,transcript:f,threadParentPointer:l}})}function O(e){const{environment:t,threadId:r,spaceStore:n,userId:a,transcript:o,transaction:i}=e;return o.map((e=>x().eC({environment:t,table:c().mS,value:{id:e.id.toString(),parent_id:r,parent_table:u().To,space_id:n.id,step:e,created_by_id:a,created_by_table:p().oo,created_time:Date.now()},transaction:i,inMemoryRecordCache:n.inMemoryRecordCache}).id))}function E(e){const{threadStore:t,stepIndex:r,transaction:n}=e,a=t.getMessages().slice(r+1);for(const o of a)w().applyOperation({operation:{args:{id:o},command:"listRemove",path:["messages"],pointer:t.pointer},store:t,transaction:n})}function R(e){const{threadStore:t,stepIndex:r,transaction:n,newValue:a}=e,o=t.getStepStoreAt(r);o&&x().zv({store:o,data:{value:a},transaction:n})}async function P(e){var t,r;const{clientStore:n,environment:a,threadStore:i,createThreadArgs:l,waitBeforeSending:d}=e,{model:m}=n.state,y=(null==i?void 0:i.getTranscript())??(null==l?void 0:l.transcript)??[];if(0===y.length)throw new Error("No transcript");const g=null===(t=N().default.state.currentSpaceStore)||void 0===t?void 0:t.id;if(!g)throw new Error("No space id");const v=(null==i?void 0:i.id)??(null==l?void 0:l.threadId);if(!v)throw new Error("No thread id");const{cachedInferences:T,annotationInferences:_}=(0,M().Hg)(n),I=new AbortController,q={};for(const s of T){if(!s.value.expected)throw new Error("No expected output for cached inference");if((0,o().Mt)(s.value.expected))throw new Error("Merged response not supported");q[s.key]=s.value.expected}const K={};for(const o of _)o.value.input.annotation&&(K[o.key]=o.value.input.annotation);const S=(0,b().Ay)();n.setState({...n.state,loading:!0,inferences:[],temporarySteps:(null==l?void 0:l.transcript)??[],abortController:I,traceId:S}),n.state.stopInferencePromise&&(await n.state.stopInferencePromise,n.setState({...n.state,stopInferencePromise:void 0}));const $=Boolean(null==i||null===(r=i.getData())||void 0===r?void 0:r.title),D={traceId:S,spaceId:g,transcript:y,threadId:v,threadParentPointer:null==l?void 0:l.threadParentPointer,createThread:void 0===i,debugOverrides:{...n.state.debugOverrides,cachedInferences:q,annotationInferences:K,model:m,emitInferences:n.state.showDebug,enableCustomViews:C().default.checkGate({gateName:"workflows_custom_view_type"})},generateTitle:!$};n.state.showDebug&&n.setState({...n.state,requestInfo:{request:D,response:void 0,memory:void 0}});try{d&&await d,await async function(e){const{environment:t,abortController:r,clientStore:n,request:a}=e,o=await f().callStreamApi({eventName:"runInferenceTranscript",environment:t,data:a,abortSignal:r.signal,headers:(0,s().WS)({spaceId:a.spaceId})});if("failed"===o.type)throw o.error;if(h().hS.is(o.data))for await(const i of o.data)F({request:a,clientStore:n,value:i})}({environment:a,abortController:I,clientStore:n,request:D})}catch(A){j(I,A)?function(e){const{environment:t,clientStore:r,threadId:n,spaceId:a}=e,{currentUserStore:o}=N().default.state;if(!o)throw new Error("No current user root store");w().createAndCommit({userAction:"inferenceTranscriptActions.handleAbort",environment:t,canUndo:!0,perform:e=>{for(const i of r.state.temporarySteps)x().eC({environment:t,table:c().mS,value:{id:i.id.toString(),parent_id:n,parent_table:u().To,space_id:a,step:i,created_by_id:o.id,created_by_table:p().oo,created_time:Date.now()},transaction:e,inMemoryRecordCache:o.inMemoryRecordCache})}})}({environment:a,clientStore:n,threadId:v,spaceId:g}):k().rG({message:A instanceof Error?A.message:"Unknown error"})}n.setState({...n.state,loading:!1,abortController:void 0})}function j(e,t){return t instanceof Error&&"AbortError"===t.name&&e.signal.aborted}function F(e){const{request:t,clientStore:r,value:n}=e;if("queue-handoff"!==n.type)if("inference"===n.type){const e={type:"inference",key:(0,y().$A)(n.value.input),index:n.index,value:n.value},t=g().Ul([...r.state.inferences,e],(e=>e.index));r.setState({...r.state,inferences:t})}else{const{temporarySteps:e}=r.state,a=(0,o().RM)(e,n);if(r.setState({...r.state,temporarySteps:a}),r.state.showDebug){const e={transcript:a};r.setState({...r.state,requestInfo:{request:t,response:e,memory:void 0}})}}}async function U(e){const{environment:t,onResponse:r,data:n,userId:a,tracking:o,abortSignal:i}=e,u=await f().callStreamApi({eventName:"runInferenceTranscript",environment:t,data:n,userId:a,tracking:o,abortSignal:i,headers:(0,s().WS)({spaceId:n.spaceId})});if("success"!==u.type)return k().Qg(u),{error:{message:u.error.message,code:u.status}};const c=[];if(h().hS.is(u.data))for await(const s of u.data){if("error"===s.type)return{error:{message:s.message,code:s.errorCode}};null==r||r(s),c.push(s)}return{value:c}}async function B(e){var t;const{environment:r,onResponse:n,data:a,userId:o,tracking:i,abortSignal:u,upsellFrom:c}=e,p=e=>{(0,I().K)(r,{upsell:e,from:c})},m=await(0,q().Bw)(r,{name:"ai_usage",spaceId:a.spaceId,userId:o,amount:1});if(!(0,d().e2)(m))return p(m.upsell),{error:new(l().yP)};const y=await f().callStreamApi({eventName:"runInferenceTranscript",environment:r,data:a,userId:o,tracking:i,abortSignal:u,headers:(0,s().WS)({spaceId:a.spaceId})});if("success"!==y.type)return k().Qg(y),{error:y.error};const g=[];if(h().hS.is(y.data))for await(const s of y.data){if("error"===s.type)return(0,l().Nf)(s.errorCode)?(p({type:"product",product:"ai",limit:{type:"cumulative",current:0,total:"unlimited"}}),{error:new(l().yP)}):{error:new Error(s.message)};null==n||n(s),g.push(s)}const b=null===(t=N().default.state.currentSpaceStore)||void 0===t?void 0:t.id;return b&&(0,T().maybeUpdateAiEligibility)(r,b),{value:g}}async function H(e){const{environment:t,step:r}=e;let n;if("markdown-chat"===r.type||"fast-researcher-chat"===r.type||"search-chat"===r.type)n=r.value;else{if("workflow-inference"!==r.type)throw new Error("Unsupported step type");n=(0,a().lH)(r.value).flatMap((e=>"text"===e.type?[e.content]:[])).join("")}const o=await v().R.clipboardActions.load();await o.copyString({environment:t,stringValue:n,copiedMessage:o.clipboardMessages.copiedQnAMessageToClipboard})}function L(e){const{environment:t,threadStore:r,stepIndex:n,clientStore:a}=e;w().createAndCommit({userAction:"AIChatTranscript.RunFromStepButton.handleClick",environment:t,canUndo:!0,perform:e=>{E({threadStore:r,stepIndex:n,transaction:e})}}),P({environment:t,threadStore:r,clientStore:a})}function Q(e){const{threadStore:t,config:r,environment:n}=e,{currentSpaceStore:a,currentSpaceViewStore:o}=N().default.state;if(!a||!o)throw new Error("No current space");const i=t.getTranscript(),s=t.getMessageStores(),u=i.findIndex((e=>"config"===e.type)),c=i[u],p=s[u];if(u<0||!p||!c||"config"!==c.type)throw new Error("No config step found");if(c.value.type!==r.type)throw new Error("Cannot change config type");const l={...c,value:r};w().createAndCommit({userAction:"AIChatTranscript.setConfigInThread",environment:n,canUndo:!0,perform:e=>{x().KY({store:p.getStepStore(),value:l,transaction:e})}})}},706461:(e,t,r)=>{r.d(t,{PJ:()=>m,_o:()=>d,dK:()=>s,sD:()=>l,uS:()=>i});r(16280),r(944114),r(898992),r(430670),r(803949),r(581454);var n=()=>r(496603),a=()=>r(534177),o=()=>r(252050);const i="\x3c!--<selection>--\x3e",s="\x3c!--</selection>--\x3e";function u(e){const{node:t,selection:r,path:l,onlyAllowPropertyTypes:d,namespace:m}=e;if(l.includes(t))throw new Error("Circular reference detected!");const y=[...l,t],h=[];if("text"===t.type)for(const n of t.value)h.push(n);else{let e="";e+=`<${t.tagName}`;for(const[r,n]of Object.entries(t.attributes||{}))void 0!==n&&(e+=` ${r}="${n}"`);const l=`</${t.tagName}>`;if("block"===t.type){const o="block"===t.type&&"block"===(null==r?void 0:r.type)&&r.blockIds[0]===t.attributes.id,g="block"===t.type&&"block"===(null==r?void 0:r.type)&&r.blockIds[r.blockIds.length-1]===t.attributes.id,b="block"===t.type&&"text"===(null==r?void 0:r.type)&&(r.start.blockId===t.attributes.id||r.end.blockId===t.attributes.id);o&&h.push(i);if(0===t.text.length&&0===Object.values(t.properties).length&&0===Object.values(t.schemas).length&&0===t.children.length&&!b)h.push(`${e}/>`);else{h.push(`${e}>`);const o=[];if(t.text)for(const e of t.text){const t=u({node:e,selection:r,path:y,onlyAllowPropertyTypes:d,namespace:m});for(const e of t)o.push(e)}let g,b;"text"===(null==r?void 0:r.type)&&r.start.blockId===t.attributes.id&&(g=r.start.index),"text"===(null==r?void 0:r.type)&&r.end.blockId===t.attributes.id&&(b=r.end.index);for(let e=0;e<o.length;e++){const t=o[e];let n="";(0,a().O9)(r)&&e===g&&(n+=i),(0,a().O9)(r)&&e===b&&(n+=s),n+=t,h.push(n)}if((0,a().O9)(r)&&g===o.length&&h.push(i),(0,a().O9)(r)&&b===o.length&&h.push(s),"end_to_end"!==m&&"tr"===t.tagName){n().Ul(Object.values(t.properties),(e=>Number(e.attributes.name))).forEach(((e,n)=>{const a=t.parent&&"table"===t.parent.tagName?t.parent:void 0,o=a&&a.attributes["header-row"],i=a&&"table"===a.tagName&&a.attributes["header-column"],s=a&&0===a.children.indexOf(t),c=o&&0===n||i&&s?"th":"td";h.push(`<${c}>`),h.push(...e.children.flatMap((e=>u({node:e,selection:r,path:y,onlyAllowPropertyTypes:d,namespace:m})))),h.push(`</${c}>`)}))}else{const e=function(e){const{tagName:t,properties:r}=e;if("tr"===t)return r;const n=[];for(const a of r){const e=p(a),r="page"===t;("property-title"===a.tagName||!e||r&&n.length<c)&&n.push(a)}return n}({tagName:t.tagName,properties:Object.values(t.properties)});for(const t of e)d&&!d.includes(t.tagName)||h.push(...u({node:t,selection:r,path:y,onlyAllowPropertyTypes:d,namespace:m}))}for(const e of Object.values(t.schemas))h.push(...u({node:e,selection:r,path:y,onlyAllowPropertyTypes:d,namespace:m}));if(t.children)for(const e of t.children){const t=u({node:e,selection:r,path:y,onlyAllowPropertyTypes:d,namespace:m});for(const e of t)h.push(e)}h.push(l)}(0,a().O9)(r)&&g&&h.push(s)}else if("collection"===t.type){h.push(`${e}>`);for(const e of Object.values(t.properties))d&&!d.includes(e.tagName)||h.push(...u({node:e,selection:r,path:y,onlyAllowPropertyTypes:d,namespace:m}));for(const e of Object.values(t.schemas))h.push(...u({node:e,selection:r,path:y,onlyAllowPropertyTypes:d,namespace:m}));h.push(l)}else{const n=(0,a().u0)((e=>"collection"===e.type||"collectionView"===e.type?{true:e}:{false:e}));if(n(t)||0===t.children.length)h.push(`${e}/>`);else{const i=[];if(!n(t)&&t.children)for(const e of t.children){const t=u({node:e,selection:r,path:y,onlyAllowPropertyTypes:d,namespace:m});for(const e of t)i.push(e)}if(i.length<=1||(0,a().O)(o()._S,t.tagName)&&o()._S[t.tagName].isToken)h.push(`${e}>${i.join("")}${l}`);else for(let t=0;t<i.length;t++){const r=i[t];0===t?h.push(`${e}>${r}`):t===i.length-1?h.push(r+l):h.push(r)}}}}return h}const c=20;function p(e){return"property-checkbox"!==e.tagName&&("property-number"===e.tagName?!e.attributes.number:0===e.children.length)}function l(e){const{node:t,selection:r,onlyAllowPropertyTypes:n,namespace:a}=e;return u({node:t,selection:r,path:[],onlyAllowPropertyTypes:n,namespace:a}).join("")}function d(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o="";if(t){o+="\n";for(let e=0;e<r;e++)o+="\t"}if("text"===e.type)o+=a?n().ih(e.value):e.value;else{o+=`<${e.tagName}`;for(const[t,r]of Object.entries(e.attributes||{}))o+=` ${t}="${r}"`;if(e.children&&e.children.length>0){o+=">";for(const n of e.children)o+=d(n,t,r+1,a);if(t){o+="\n";for(let e=0;e<r;e++)o+="\t"}o+=`</${e.tagName}>`}else o+="/>"}return o}function m(e){return e.map((e=>d(e))).join("")}},754093:(e,t,r)=>{r.d(t,{BD:()=>o});r(581454);var n=()=>r(736192),a=(n(),()=>r(496603));function o(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0;return(0,n().parse)(e,r).childNodes.map((e=>i(e,t)))}function i(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e.nodeType===n().NodeType.TEXT_NODE?{type:"text",value:t?a().x4(e.textContent):e.textContent}:{type:"element",tagName:e.tagName.toLowerCase(),attributes:e.attributes||{},children:e.childNodes.map((e=>i(e,t)))||[]}}},832443:(e,t,r)=>{r.d(t,{D4:()=>d,L1:()=>m,OU:()=>y,V6:()=>h,tD:()=>g});r(16280),r(944114),r(581454),r(814603),r(147566),r(198721);var n=r.n(r(625473)),a=()=>r(496603),o=()=>r(973647),i=()=>r(534177),s=()=>r(939768),u=()=>r(181856),c=()=>r(252050);function p(e){if(!(32===e.length&&/^[a-f0-9]*$/g.test(e)))return;return[e.substring(0,8),e.substring(8,12),e.substring(12,16),e.substring(16,20),e.substring(20,32)].join("-")}const l=/^\d+$/,d=(0,i().u0)((e=>l.test(e)?{true:e}:{false:e}));function m(e){try{const t=new URL(e),r=t.searchParams.get("domain")||void 0,n=t.searchParams.get("base_url")||void 0,a=t.searchParams.get("channel_id"),o=t.searchParams.get("message_id"),i=t.searchParams.get("thread_ts")||void 0;if(!r&&!n||!a||!o)return;return{domain:r,baseUrl:n,channelId:a,messageId:o,threadTs:i}}catch(t){return}}function y(e){try{const t=new URL(e).searchParams.get("url");if(!t)return;return{url:t}}catch(t){return}}class h extends Error{constructor(e){super(`Tried to use an ID that doesn't exist: ${e}`)}}class g{generateSerializedKey(e){return n()(e)}constructor(e){if(this.counter=0,this.keyToCounterMap=new Map,this.counterToKeyMap=new Map,this.mapCounterToKeyInModeOrThrow=(e,t,r)=>o().Q.unwrap(this.mapCounterToKeyInMode(e,t,r)),this.mapCounterToKeyInMode=(e,t,r)=>g.mapCounterToKeyInMode(this,e,t,r),this.utilitiesForTests={removeKey:this.removeKey.bind(this),setCounterValueForKey:this.setCounterValueForKey.bind(this)},e){const t=[];for(const{key:n,counter:a}of e.keyMap)this.keyToCounterMap.set(this.generateSerializedKey(n),a),this.counterToKeyMap.set(a,n),t.push(parseInt(a));const r=a().T9(t);this.counter="number"==typeof r?r+1:0}}serialize(){return{keyMap:Array.from(this.counterToKeyMap.entries()).map((e=>{let[t,r]=e;return{key:a().mg(r),counter:t}}))}}inheritFrom(e){for(const[t,r]of e.keyToCounterMap.entries())this.keyToCounterMap.set(t,r);for(const[t,r]of e.counterToKeyMap.entries())this.counterToKeyMap.set(t,r)}mapKeyToCounter(e){const t=this.generateSerializedKey(e);if(!this.keyToCounterMap.has(t)){const r=this.counter.toString();this.keyToCounterMap.set(t,r),this.counterToKeyMap.set(r,e),this.counter++}return this.keyToCounterMap.get(t)}mapNodeKeyToCounter(e){if("block"===e.type){const t={...e},r=this.mapNodeAttributesKeyToCounter(e.attributes);t.attributes=r;const n=e.text.map((e=>this.mapNodeKeyToCounter(e)));t.text=n;const a=e.children.map((e=>{const r=this.mapNodeKeyToCounter(e);return r.parent=t,r}));t.children=a;const o={};for(const[e,u]of Object.entries(t.properties))o[e]=this.mapNodeKeyToCounter(u);t.properties=o;const i={};for(const[e,u]of Object.entries(t.schemas))i[e]=this.mapNodeKeyToCounter(u);t.schemas=i;const s=this.mapKeyToCounter({key:e.schemaId,type:"block"});return t.schemaId=s,t}if("property"===e.type||"schema"===e.type||"inline"===e.type){const t={...e};return t.attributes=this.mapNodeAttributesKeyToCounter(t.attributes),t.children=t.children.map((e=>this.mapNodeKeyToCounter(e))),t}if("instructions"===e.type){const t={...e};return t.children=t.children.map((e=>this.mapNodeKeyToCounter(e))),t}if("text"===e.type)return{...e};if("collection"===e.type){const t={...e,schemaId:this.mapKeyToCounter({type:"block",key:e.schemaId}),attributes:{...e.attributes,id:this.mapKeyToCounter({type:"collection",key:e.attributes.id})}},r=Object.fromEntries(Object.entries(t.properties).map((e=>{let[t,r]=e;return[t,this.mapNodeKeyToCounter(r)]})));t.properties=r;const n=Object.fromEntries(Object.entries(t.schemas).map((e=>{let[t,r]=e;return[t,this.mapNodeKeyToCounter(r)]})));return t.schemas=n,t}if("collectionView"===e.type)return{...e,schemaId:this.mapKeyToCounter({type:"block",key:e.schemaId}),attributes:{...e.attributes,id:this.mapKeyToCounter({type:"collection-view",key:e.attributes.id}),"database-id":this.mapKeyToCounter({type:"collection",key:e.attributes["database-id"]})}};if("slackMessages"===e.type){return{...e,attributes:{...e.attributes,id:this.mapKeyToCounter({type:"universal",key:e.attributes.id})}}}if("attachment"===e.type){return{...e,attributes:{...e.attributes,id:this.mapKeyToCounter({type:"attachment",key:e.attributes.id,attachmentType:e.attributes.attachmentType})}}}throw new Error(`Unknown node type ${e}`)}mapNodeAttributesKeyToCounter(e){if(!e)return e;const t={...e};for(const[n,a]of Object.entries(g.attributesToMap)){if(!a)continue;const e=t[n];if(e)if("href"===n){let a;const o=s().qg(e),i=s().Jf({str:o.href,allowNoProtocol:!0});i&&(a=(0,r(777447).lX)({url:i,baseUrl:o.protocol?`${o.protocol}//${o.host}`:`https://${o.host??"www.notion.so"}`,publicDomainName:o.host??"www.notion.so"})),t[n]=a?this.mapKeyToCounter({type:"block",key:a}):e}else t[n]="person-id"===n?this.mapKeyToCounter({type:"person",key:e}):"database-id"===n?this.mapKeyToCounter({type:"collection",key:e}):this.mapKeyToCounter({type:"block",key:e})}return t}doesIdMapperContainMappedKey(e){return this.counterToKeyMap.has(e)}doesIdMapperContainKey(e){return this.keyToCounterMap.has(this.generateSerializedKey(e))}getIdForMappedKeyIfExists(e){const t=this.counterToKeyMap.get(e);return null==t?void 0:t.key}mapCounterToKey(e){const t=this.counterToKeyMap.get(e);if(!t)throw new h(e);return t}mapAssistantContextCounterToKey(e){const{"instructions-page-id":t,"current-page-id":r,"current-person-id":n,"current-background-page-id":a,...o}=e;return{...o,...e["instructions-page-id"]?{"instructions-page-id":this.mapCounterToKeyInModeOrThrow(e["instructions-page-id"],"block_counter")}:{},...e["current-page-id"]?{"current-page-id":this.mapCounterToKeyInModeOrThrow(e["current-page-id"],"block_counter")}:{},...e["current-background-page-id"]?{"current-background-page-id":this.mapCounterToKeyInModeOrThrow(e["current-background-page-id"],"block_counter")}:{},...e["current-thread-id"]?{"current-thread-id":this.mapCounterToKeyInModeOrThrow(e["current-thread-id"],"thread_counter")}:{},...e["current-person-id"]?{"current-person-id":this.mapCounterToKeyInModeOrThrow(e["current-person-id"],"person_counter")}:{}}}mapAssistantContextKeyToCounter(e){const{"instructions-page-id":t,"current-page-id":r,"current-person-id":n,"current-background-page-id":a,...o}=e;return{...o,...e["instructions-page-id"]?{"instructions-page-id":this.mapKeyToCounter({type:"block",key:e["instructions-page-id"]})}:{},...e["current-page-id"]?{"current-page-id":this.mapKeyToCounter({type:"block",key:e["current-page-id"]})}:{},...e["current-background-page-id"]?{"current-background-page-id":this.mapKeyToCounter({type:"block",key:e["current-background-page-id"]})}:{},...e["current-thread-id"]?{"current-thread-id":this.mapKeyToCounter({type:"slack-thread",key:e["current-thread-id"]})}:{},...e["current-person-id"]?{"current-person-id":this.mapKeyToCounter({type:"person",key:e["current-person-id"]})}:{}}}mapAssistantSelectionKeyToCounter(e){return"block"===e.type?{type:"block",blockIds:e.blockIds.map((e=>this.mapKeyToCounter({type:"block",key:e})))}:"text"===e.type?{type:"text",start:{...e.start,blockId:this.mapKeyToCounter({type:"block",key:e.start.blockId})},end:{...e.end,blockId:this.mapKeyToCounter({type:"block",key:e.end.blockId})}}:void(0,i().HB)(e)}static mapCounterToKeyInMode(e,t,r,n){if("block_counter"===r||"person_counter"===r||"thread_counter"===r||"collection_counter"===r||"collection_view_counter"===r||"query_database_result_counter"===r||"external_id_counter"===r||"attachment_id_counter"===r){const a=(0,o().j)((()=>e.mapCounterToKey(t)));if(o().Q.isFail(a))return a;const s=a.value;let c;return"block_counter"===r?c="block":"person_counter"===r?c="person":"thread_counter"===r?c="slack-thread":"collection_counter"===r?c="collection":"collection_view_counter"===r?c="collection-view":"query_database_result_counter"===r?c="query-database-result":"external_id_counter"===r?c="universal":"attachment_id_counter"===r?c="attachment":(0,i().HB)(r),s.type!==c?{error:new(u().xU)({receivedIdType:s.type,expectedIdType:c,tagNameForErrorMessage:n,idValueForErrorMessage:t})}:{value:s.key}}if("href_counter"===r){const r=g.getMappedTypeFromCounterIfExists(t,e);return"query-database-result"===r?{error:new(u().xU)({receivedIdType:r,expectedIdType:"href",tagNameForErrorMessage:n,idValueForErrorMessage:t})}:{value:g.mapHrefCounterToUrl(e,t)}}(0,i().HB)(r)}getTypeKeyFromCounter(e){return g.getMappedTypeFromCounterIfExists(e,this)}static getMappedTypeFromCounterIfExists(e,t){let r;try{r=t.mapCounterToKey(e)}catch(n){if(n instanceof h)return;throw n}return r.type}static blockKeyToHref(e){return`/${e.key.split("/")[0].replaceAll("-","")}`}static blockIdToHref(e){return`/${e.split("/")[0].replaceAll("-","")}`}static parseAssistantHref(e){if(e===g.EMPTY_HREF)return{type:"citation_unsupported"};if(function(e){return e.startsWith("query_database_result_counter://")}(e)){const t=g.databaseQueryHrefToDatabaseQueryResultsId(e);if(t)return{type:"database_query_results",id:t}}else if(function(e){return e.startsWith("slack://")}(e)){const t=m(e);if(t)return{type:"slack",href:(0,c().Su)(e),...t}}else if(function(e){return e.startsWith("google-drive://")}(e)){const t=y(e);if(t)return{type:"google-drive",href:(0,c().Fu)(e),...t}}else if(function(e){return e.startsWith("sharepoint://")}(e)){const t=y(e);if(t)return{type:"sharepoint",href:(0,c().L7)(e),...t}}else if(function(e){return e.startsWith("webpage://")}(e)){const t=y(e);if(t)return{type:"webpage",href:(0,c().RW)(e),...t}}else if(function(e){return e.startsWith("helpdoc://")&&!e.includes("%23")}(e)){const t=y(e);if(t)return{type:"helpdoc",href:(0,c().h5)(e),...t}}else if(function(e){return e.startsWith("helpdoc://")&&e.includes("%23")}(e)){const t=y(e);if(t){const r=(0,c().h5)(e.split("%23")[0]);return{type:"helpdoc-section",href:(0,c().w3)(e),parentPageHref:r,...t}}}else if(function(e){return e.startsWith("github://")}(e)){const t=y(e);if(t)return{type:"github",href:(0,c().Tj)(e),...t}}else if(function(e){return e.startsWith("jira://")}(e)){const t=y(e);if(t)return{type:"jira",href:(0,c().MQ)(e),...t}}else{const t=g.blockHrefToAssistantBlockId(e);if(t)return{type:"block",blockId:t}}}static databaseQueryHrefToDatabaseQueryResultsId(e){var t;const r=null===(t=e.match(/^query_database_result_counter:\/\/(.+)$/))||void 0===t?void 0:t[1];return r&&p(r)}static blockHrefToAssistantBlockId(e){var t;const r=null===(t=e.match(/\/(.+)/))||void 0===t?void 0:t[1];return r?p(r):void 0}static mapHrefCounterToUrl(e,t){let r;try{r=e.mapCounterToKey(t)}catch(n){if(n instanceof h)return t;throw n}if("block"===r.type)return g.blockKeyToHref(r);if("url"===r.type||"slack-message"===r.type||"slack-thread"===r.type||"webpage"===r.type||"helpdoc"===r.type||"helpdoc-section"===r.type||"google-drive"===r.type||"github"===r.type||"sharepoint"===r.type||"jira"===r.type)return r.key;if("collection"===r.type||"collection-view"===r.type||"person"===r.type)return g.EMPTY_HREF;if("query-database-result"===r.type||"skill"===r.type)throw new Error(`Invalid URL type: ${r.type}`);return"universal"===r.type||"attachment"===r.type?r.key:void(0,i().HB)(r)}removeKey(e){const t=this.generateSerializedKey(e),r=this.keyToCounterMap.get(t);if(r)return this.keyToCounterMap.delete(t),this.counterToKeyMap.delete(r),r}setCounterValueForKey(e,t){const r=this.generateSerializedKey(e);this.keyToCounterMap.set(r,t),this.counterToKeyMap.set(t,e)}}g.attributesToMap={id:!0,"page-id":!0,"database-id":!0,"person-id":!0,"person-name":!1,href:!0,category:!1,option:!1,format:!1,number:!1,date:!1,time:!1,"start-date":!1,"start-time":!1,"end-date":!1,"end-time":!1,"synced-property-name":!1,"synced-block-id":!0,"external-id":!0,index:!1,title:!1,icon_url:!1,description:!1,name:!1,equation:!1},g.EMPTY_HREF="#"},972261:(e,t,r)=>{r.d(t,{Fl:()=>s,PI:()=>a,S:()=>u,Tq:()=>p,_u:()=>o,e5:()=>i,z4:()=>n});r(898992),r(672577);const n=["slack","googleDrive","github","jira","microsoftTeams","sharepoint"],a=[...n,"web","githubCode"],o="7c57d10c-00cc-48bc-a552-fb3911dd7745",i="1031cb6c-4935-4cc1-9c08-c9a4ecaae323",s="65683ef9-c923-4a14-8c5b-bfcf591cf5a1",u="c1f230b1-6635-4ab0-a3f5-f7eb105a87c3",c=[{regex:/https:\/\/(?<workspace>[\w-]+)\.slack\.com\/archives\/(?<channel>[^\/]+)\/p(?<timestamp>\d+)(\?thread_ts=(?<thread_ts>\d+\.\d+)&cid=(?<cid>[^\/]+))?/,type:"slack"},{regex:/https:\/\/docs\.google\.com\/(?<fileType>document|spreadsheets|presentation)\/d\/(?<fileId>[a-zA-Z0-9_-]+)(?:\/\S*)?/,type:"googleDrive"},{regex:/https:\/\/github\.com\/(?<orgName>[^\/]+)\/(?<repoName>[^\/]+)\/(?:blob|tree|blame)\/(?<branchName>[^\/]+)\/(?<codePath>[^#]+)(#(?<lineNumber>L\d+(?:C\d+)?(?:-L\d+)?))?/,type:"githubCode"},{regex:/https:\/\/github\.com\/(?<orgName>[^\/]+)\/(?<repoName>[^\/]+)\/pull\/(?<prNumber>\d+)(\/(files|commits|checks)?)?/,type:"github"},{regex:/https:\/\/app\.graphite\.dev\/github\/pr\/(?<orgName>[^\/]+)\/(?<repoName>[^\/]+)\/(?<prNumber>\d+)(?:\/\S*)?/,type:"github"},{regex:/https:\/\/(?:[^\.]+)\.sourcegraphcloud\.com\/github\.com\/(?<orgName>[^\/]+)\/(?<repoName>[^\/@]+)(?:@(?<branchName>[a-f0-9]+))?\/-\/blob\/(?<codePath>[^?]+)\?(?<lineNumbers>L\d+|l\d+)?/,type:"githubCode"},{regex:/https:\/\/(?<site>[^/]+\.atlassian\.net).*?(?:browse\/|[?&]selectedIssue=)(?<issueKey>[A-Z0-9]+-\d+).*?/,type:"jira"}];function p(e){const t=c.find((t=>t.regex.test(e)));return(null==t?void 0:t.type)??"web"}}}]);