"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[90409],{241319:(e,o,t)=>{t.d(o,{y:()=>n});t(898992),t(672577);var a=()=>t(534177),l=()=>t(977345);function n(e){var o;const{actionModels:t,id:n}=e,i=(0,l().y5)(n),u="action"===i.source?t.find((e=>e.id===i.action_id)):void 0,r=(0,a().O9)(u)&&u.isType("create_page")?null===(o=u.getConfig())||void 0===o?void 0:o.collection:void 0;return{automationValueInfo:i,collectionPointer:r,actionModel:u}}},890409:(e,o,t)=>{t.d(o,{Ah:()=>_,Dk:()=>m,Iv:()=>y,SF:()=>f,YO:()=>M,_f:()=>T,c_:()=>d,dW:()=>g,gW:()=>p,sp:()=>O,vN:()=>v});t(16280),t(944114),t(898992),t(354520),t(803949),t(581454),t(737550);var a=()=>t(496603),l=()=>t(973647),n=()=>t(534177),i=()=>t(842599),u=()=>t(977345),r=()=>t(798880),c=()=>t(919709),s=()=>t(241319);function d(e,o){e.DO_NOT_USE_commonTrackEvent({eventName:"add_automation_step",properties:o})}function p(e,o){e.DO_NOT_USE_commonTrackEvent({eventName:"delete_automation_step",properties:o})}function m(e,o){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_create",properties:o})}function f(e,o){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_update",properties:o})}function y(e,o){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_delete",properties:o})}function _(e,o){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_enable",properties:o})}function v(e,o){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_disable",properties:o})}function g(e,o){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_action_create",properties:o})}function M(e,o){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_action_delete",properties:o})}function h(e){const{formulaAnalyticsModule:o,formulasModule:t,formulaTypecheckContextValues:a,getRecordModel:i,spaceId:r,value:c,featureGates:s}=e;if("formula"===c.type){if(!(0,n().O9)(c.value))return;const e=l().Q.unwrapOr(t.parseFormulaInputToAst(c.value),void 0);if(e){const l=t.addTypesToFormulaAST(e,{handleDataRequest:(0,u().zg)(i),spaceId:r,valueTypes:a,featureGates:s});return{...o.getFormulaAnalytics(e,{getRecordModel:i,typecheckContextValues:a}),formula_return_type:l.node.type,redacted_formula:o.getRedactedFormulaAsStringSync(e,{getRecordModel:i,typecheckContextValues:a})}}}else{if("simple"===c.type){if(!(0,n().O9)(c.value))return;return o.getSimpleFormulaAnalytics(c.value,{getRecordModel:i,typecheckContextValues:a})}(0,n().HB)(c.type)}}function T(e){const{automationActionModel:o,automationActionModels:t,formulaAnalyticsModule:l,formulasModule:d,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:f,simpleFormulasModule:y}=e;return o.isType("complete_sprint")?{automation_action_id:o.pointer.id,type:"complete_sprint"}:o.isType("create_page")?function(e){const{automationActionModel:o,formulaAnalyticsModule:t,formulasModule:a,formulaTypecheckContextValues:l,getRecordModel:i,featureGates:u}=e,r=o.getConfig();let c,s=[];const d=null==r?void 0:r.collection,p=null==r?void 0:r.properties;if((0,n().O9)(d)&&(0,n().O9)(p)&&p.length>0){const e=i(d),f=null==e?void 0:e.getNormalizedSchema();(0,n().O9)(f)&&(s=p.map((e=>{var o;return(null===(o=f[e])||void 0===o?void 0:o.type)??"unknown"})));const y=null==r?void 0:r.values;if(a&&(0,n().O9)(y)){c=[];for(const e of p){var m;const n=null===(m=y[e])||void 0===m?void 0:m.value;if(!n)continue;const r=h({formulaAnalyticsModule:t,formulasModule:a,getRecordModel:i,formulaTypecheckContextValues:l,spaceId:o.spaceId,value:n,featureGates:u});r&&c.push(r)}}}return{automation_action_id:o.pointer.id,property_formula_stats:c,property_types:s,type:"create_page"}}({automationActionModel:o,formulaAnalyticsModule:l,formulasModule:d,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:f}):o.isType("duplicate_blocks")?{automation_action_id:o.pointer.id,type:"duplicate_blocks"}:o.isType("modal_confirmation")?function(e){const{automationActionModel:o,formulaAnalyticsModule:t,formulasModule:a,formulaTypecheckContextValues:l,getRecordModel:i,featureGates:u}=e,r=o.getConfig(),c=[];if(a&&(0,n().O9)(r)&&r.text){const e=h({formulasModule:a,formulaAnalyticsModule:t,getRecordModel:i,formulaTypecheckContextValues:l,spaceId:o.spaceId,value:r.text,featureGates:u});e&&c.push(e)}return{automation_action_id:o.pointer.id,formula_stats:c,type:"modal_confirmation"}}({automationActionModel:o,formulaAnalyticsModule:l,formulasModule:d,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:f}):o.isType("open_page")?{automation_action_id:o.pointer.id,type:"open_page"}:o.isType("query_collection")?{automation_action_id:o.pointer.id,type:"query_collection"}:o.isType("send_in_app_notification")?function(e){var o;const{automationActionModel:t,formulaAnalyticsModule:a,formulasModule:l,formulaTypecheckContextValues:i,getRecordModel:u,featureGates:r,simpleFormulasModule:s}=e,d={automation_action_id:t.pointer.id,messageCharacterCount:0,type:"send_in_app_notification"},p=t.getConfig();if(!(0,n().O9)(p))return d;if((0,n().O9)(p.target))if("formula"===p.target.type&&(0,n().O9)(p.target.value)){if(d.targetData={type:"formula",numUserFormulaTargets:(0,c().Fbh)(p.target.value.value).length,numFormulaContextTargets:s.getReferencedContextValueIds(p.target.value).length},l){const e=h({formulasModule:l,formulaAnalyticsModule:a,getRecordModel:u,formulaTypecheckContextValues:i,spaceId:t.spaceId,value:p.target.value,featureGates:r});e&&(d.formula_stats??=[],d.formula_stats.push(e))}}else if("property"===p.target.type&&(0,n().O9)(p.target.propertyId)&&(0,n().O9)(p.target.collectionPointer)){const e=u(p.target.collectionPointer),o=null==e?void 0:e.getSchema();var m;(0,n().O9)(o)&&(d.targetData={type:"property",propertyType:null===(m=o[p.target.propertyId])||void 0===m?void 0:m.type})}if((0,n().O9)(null===(o=p.notification_message)||void 0===o?void 0:o.value)&&(d.messageCharacterCount=(0,c().FAw)(p.notification_message.value),l)){const e=h({formulasModule:l,formulaAnalyticsModule:a,getRecordModel:u,formulaTypecheckContextValues:i,spaceId:t.spaceId,value:p.notification_message,featureGates:r});e&&(d.formula_stats??=[],d.formula_stats.push(e))}return d}({automationActionModel:o,formulaAnalyticsModule:l,formulasModule:d,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:f,simpleFormulasModule:y}):o.isType("send_gmail_notification")?function(e){var o,t,l,u,s,d,p;const{automationActionModel:m,formulaAnalyticsModule:f,formulasModule:y,formulaTypecheckContextValues:_,getRecordModel:v,featureGates:g}=e,M=m.getConfig();if(!(0,n().O9)(M))return{automation_action_id:m.pointer.id,fields:{},recipient_domains:{},type:"send_gmail_notification"};const T=Object.fromEntries(Object.entries(M||{}).map((e=>{let[o,t]=e;var a;return"formula"===(null==t?void 0:t.type)?[o,Boolean(null==t||null===(a=t.value)||void 0===a?void 0:a.value)]:"simple"===(null==t?void 0:t.type)?[o,Boolean(null==t?void 0:t.value)]:[o,Boolean(t)]}))),{to:O,cc:A,bcc:k}=M,C=[...(null==O||null===(o=O.value)||void 0===o?void 0:o.value)||[],...(null==A||null===(t=A.value)||void 0===t?void 0:t.value)||[],...(null==k||null===(l=k.value)||void 0===l?void 0:l.value)||[]],b=[...(0,c().Fbh)(C).map((e=>v({table:r().oo,id:e}))).map((e=>null==e?void 0:e.email)).filter(n().O9),...(0,i().C3)((0,c().k4p)(C))],x=a().Tr(b.map((e=>e.split("@")[1]))),R=[null===(u=M.to)||void 0===u?void 0:u.value,null===(s=M.cc)||void 0===s?void 0:s.value,null===(d=M.bcc)||void 0===d?void 0:d.value,null===(p=M.reply_to)||void 0===p?void 0:p.value,M.from_name,M.email_subject,M.email_body].map((e=>{if(y&&(0,n().O9)(e))return h({formulaAnalyticsModule:f,formulasModule:y,getRecordModel:v,formulaTypecheckContextValues:_,spaceId:m.spaceId,value:e,featureGates:g})})).filter(n().O9);return{automation_action_id:m.pointer.id,fields:T,formula_stats:R,recipient_domains:x,type:"send_gmail_notification"}}({automationActionModel:o,formulaAnalyticsModule:l,formulasModule:d,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:f}):o.isType("slack_notification")?{automation_action_id:o.pointer.id,type:"slack_notification"}:o.isType("update_pages")?function(e){const{automationActionModel:o,automationActionModels:t,formulaAnalyticsModule:a,formulasModule:l,formulaTypecheckContextValues:i,getRecordModel:r,featureGates:c}=e,d=o.getConfig(),p=[],m=[],f=[];if((0,n().O9)(d)&&(0,n().O9)(d.target)&&(0,n().O9)(d.properties)&&d.properties.length>0){let e;if("variable"===d.target.type){const o=(0,u().y5)(d.target.id);if("action"===o.source){const o=(0,s().y)({actionModels:t,id:d.target.id}).collectionPointer;if((0,n().O9)(o)){const t=r(o);e=null==t?void 0:t.getNormalizedSchema()}}else{if("global"!==o.source||"button_page"!==o.global)throw new Error("Failed loading property schema");{const o=(0,u().IV)(i,d.target.id);if("block"===(null==o?void 0:o.type.type)&&(0,n().O9)(o.type.collection)){const t=r(o.type.collection);e=null==t?void 0:t.getNormalizedSchema()}}}}else if("collection"===d.target.type){const o=r(d.target.collection);e=null==o?void 0:o.getNormalizedSchema()}(0,n().O9)(e)&&d.properties.forEach((t=>{const u=e[t];if((0,n().O9)(u)&&(p.push(u.type),l&&(0,n().O9)(d.values))){const e=d.values[t];if((0,n().O9)(e)&&(m.push({type:u.type,operator:e.action}),e.value)){const t=h({formulasModule:l,formulaAnalyticsModule:a,getRecordModel:r,formulaTypecheckContextValues:i,spaceId:o.spaceId,value:e.value,featureGates:c});t&&f.push(t)}}}))}return{automation_action_id:o.pointer.id,property_configs:m,property_formula_stats:f,property_types:p,type:"update_pages"}}({automationActionModel:o,automationActionModels:t,formulaAnalyticsModule:l,formulasModule:d,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:f}):o.isType("define_variables")?function(e){const{automationActionModel:o,formulaAnalyticsModule:t,formulasModule:a,formulaTypecheckContextValues:l,getRecordModel:i,featureGates:u}=e,r=o.getConfig(),c=[];if(a&&(0,n().O9)(r)&&r.values)for(const n of Object.values(r.values))if(n.value){const e=h({formulasModule:a,formulaAnalyticsModule:t,getRecordModel:i,formulaTypecheckContextValues:l,spaceId:o.spaceId,value:n.value,featureGates:u});e&&c.push(e)}return{automation_action_id:o.pointer.id,formula_stats:c,type:"define_variables"}}({automationActionModel:o,formulaAnalyticsModule:l,formulasModule:d,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:f}):o.isType("http_request")?{automation_action_id:o.pointer.id,type:"http_request"}:o.isType("publish_site")?{automation_action_id:o.pointer.id,type:"publish_site"}:void(0,n().HB)(o)}function O(e){const{automationModel:o,builderType:t="sidebar",formulaAnalyticsModule:a,formulasModule:l,formulaTypecheckContextValues:i,getRecordModel:u,featureGates:r,simpleFormulasModule:c,source:s}=e,d=[],p=o.getActionPointers().map((e=>u(e))).filter(n().O9);for(const M of o.getActionPointers()){const e=u(M);(0,n().O9)(e)&&d.push(T({automationActionModel:e,automationActionModels:p,formulaAnalyticsModule:a,formulasModule:l,formulaTypecheckContextValues:i,getRecordModel:u,featureGates:r,simpleFormulasModule:c}))}const m=[];let f,y,_;if(o.isEventType()){var v;const e=o.getEventConfiguration(),t=u(o.getParentPointer());f=o.getParentId();const a=o.getEventConfiguration();if("collection_view"===(null===(v=a.source)||void 0===v?void 0:v.type)){const e=u(a.source.pointer);_=null==e?void 0:e.parent_id,y=null==a?void 0:a.source.pointer.id}const l=null==t?void 0:t.getNormalizedSchema();if((0,n().O9)(l)){const{pagesAdded:o,pagePropertiesEdited:t}=e;if(o&&m.push({type:"page"}),"any"===t.type)m.push({condition:"any",type:"property"});else if("none"===t.type)m.push({condition:"none",type:"property"});else{let e=[];"some"===t.type?e=t.some??[]:"all"===t.type&&(e=t.all??[]);const o=[],a=[];e.forEach((e=>{var t;const i=null===(t=l[e.property])||void 0===t?void 0:t.type;(0,n().O9)(i)&&(o.push({type:i,operator:e.filter.operator}),a.push(i))})),m.push({condition:t.type,property_configs:o,property_types:a,type:"property"})}}}else if(o.isButtonType())m.push({type:"button"});else if(o.isRecurrenceType()){var g;m.push({type:"recurrence",frequency:null===(g=o.getTrigger().recurrence)||void 0===g?void 0:g.frequency})}else(0,n().HB)(o);return{automation_actions:d,automation_id:o.id,automation_triggers:m,collection_id:f,collection_view_id:y,collection_view_block_id:_,builder_type:t,source:s}}}}]);