"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[90372],{29703:(e,t,n)=>{n.d(t,{t:()=>k});n(944114),n(816573),n(878100),n(177936),n(748140),n(821903),n(491134),n(128845),n(237467),n(444732),n(979577),n(898992),n(803949),n(581454),n(908872);var o=n(296540),i=()=>n(484714),r=()=>n(56366),s=()=>n(401497),a=()=>n(534177),c=()=>n(508496),l=()=>n(286236),d=()=>n(964576),u=()=>n(964345);class p extends(()=>n(757695))().default{constructor(){super()}getInitialState(){}setState(e){this.instanceState&&this.instanceState.close(),super.setState(e)}addListener(e){super.addListener(e),this.instanceState||this.setState((0,n(673903).G)(24e3))}removeListener(e){super.removeListener(e),0===this.listenerCount()&&this.setState(void 0)}}const m=new p;var f=n(474848);const g=50,v=7e3,h=50,S=14e3,y=1.5,b=1.3;function k(e){const{fillWidth:t=!1,forceRender:n=!1}=e,{isMobile:p,isIOS:k}=(0,i().Y0)(),w=(0,r().K8)((()=>{if(!p)return;const e=c().default.getConfigKey("mobile_dictation_visualizer","lowshelf_filter_gain");if(k){var t;const n=null===(t=d().A.state)||void 0===t?void 0:t.label;if((0,a().O9)(n)&&"iPhone Microphone"!==n)return;return e+6}return e}),[p,k]),A=(0,r().K8)((()=>p?h:g),[p]),x=(0,r().K8)((()=>p?S:v),[p]),C=(0,o.useMemo)((()=>function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v;const n=(e+t)/2;return{frequencyRangeMin:e,frequencyRangeMax:t,frequencyLowerQuarter:(e+n)/2,frequencyUpperQuarter:(n+t)/2}}(A,x)),[A,x]),T=(0,r().K8)((()=>u().Ay.state.audioRecorder),[]),_=(0,r().O$)(m),I=(0,o.useRef)(null),[B,D]=(0,o.useState)(8),[R,M]=(0,o.useState)([]),E=t?2*y:y,j=t?3*b:b;(0,o.useEffect)((()=>{if(!t||!T&&!n)return;const e=()=>{if(I.current){const e=I.current.clientWidth,t=E+j,n=Math.max(1,Math.floor(e/t));D(n),M(new Array(n).fill(3))}};e();const o=new ResizeObserver(e);return I.current&&o.observe(I.current),()=>o.disconnect()}),[T,t,E,j,n]),(0,o.useEffect)((()=>{if(n)M(new Array(B).fill(3));else if(T&&_){const e=new AbortController,t=e.signal,n=()=>{const{mediaStreams:e}=T;if(e&&e.length>0){const n=_.createChannelMerger(e.length),o=_.createAnalyser();o.fftSize=2048;const i=e.map((t=>{const o=[],i=_.createMediaStreamSource(t);if(o.push(i),(0,a().O9)(w)){const t=_.createGain();t.gain.setValueAtTime(w/e.length,_.currentTime),o.push(t)}const r=_.createBiquadFilter();r.type="highpass",r.frequency.setValueAtTime(C.frequencyLowerQuarter,_.currentTime),o.push(r);const s=_.createBiquadFilter();return s.type="lowpass",s.frequency.setValueAtTime(C.frequencyUpperQuarter,_.currentTime),o.push(s),o.push(n),o}));n.connect(o),i.forEach((e=>{for(let t=0;t<e.length-1;t++)e[t].connect(e[t+1])}));const r=()=>{i.forEach((e=>{e.forEach((e=>e.disconnect()))})),n.disconnect(),o.disconnect()};_.resume();const s=new Uint8Array(o.frequencyBinCount),c=()=>{if(t.aborted)return void r();o.getByteFrequencyData(s);const e=_.sampleRate/2/o.frequencyBinCount,n=Math.round(C.frequencyRangeMin/e),i=Math.round(C.frequencyRangeMax/e),a=s.slice(n,i+1),l=Math.floor(a.length/B),d=[];for(let t=0;t<B;t++){const e=a.slice(t*l,t<B-1?(t+1)*l:a.length+1),n=e.reduce(((e,t)=>e+t),0)/e.length,o=Math.max(3,Math.min(12,n/3));d.push(o)}M(d),requestAnimationFrame(c)},l=requestAnimationFrame(c);return()=>{cancelAnimationFrame(l),r()}}};let o=n();const i=()=>{"function"==typeof o&&o(),o=n()};return T.emitter.on(l().Q,i),()=>{T.emitter.off(l().Q,i),"function"==typeof o&&o(),e.abort()}}}),[T,B,_,n,w,C]);const q=(0,s().IS)((e=>({barStyle:{flexShrink:0,bottom:"0",width:`${E}px`,backgroundColor:T||n?e.icon.secondary:e.icon.redPrimary,borderRadius:t?"4px":"1px"}})),[T,n,E,t]);return(0,f.jsx)("div",{ref:I,style:{height:"20px",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",gap:j,flex:t?1:void 0},children:R.map(((e,t)=>(0,f.jsx)("div",{style:{...q.barStyle,height:`${e}px`}},t)))})}},73223:(e,t,n)=>{n.r(t),n.d(t,{dismissTutorial:()=>d,resetTutorials:()=>u,tutorialAdvanceToStep:()=>p,tutorialAdvanceToStepAfter:()=>m,tutorialGoToNextStep:()=>c,tutorialGoToPrevStep:()=>l});var o=()=>n(541235),i=()=>n(317909),r=()=>n(755199),s=()=>n(739135),a=()=>n(351360);function c(e,t){var n;const{currentUserSettingsStore:o}=a().default.state;if(!o)return;const i=null===(n=o.getSettings())||void 0===n?void 0:n.tutorials;f({userAction:"TutorialActions.nextStep",environment:e,perform:e=>{r().mJ({userSettingsStore:o,transaction:e,data:{tutorials:{...i,[t]:(0,s().i9)(o,t)}}})},userId:o.id})}function l(e,t){var n;const{currentUserSettingsStore:o}=a().default.state;if(!o)return;const i=null===(n=o.getSettings())||void 0===n?void 0:n.tutorials;f({userAction:"TutorialActions.prevStep",environment:e,perform:e=>{r().mJ({userSettingsStore:o,transaction:e,data:{tutorials:{...i,[t]:(0,s().KD)(o,t)}}})},userId:o.id})}function d(e,t){var n;const{currentUserSettingsStore:i}=a().default.state;if(!i)return;const s=null===(n=i.getSettings())||void 0===n?void 0:n.tutorials;f({userAction:"TutorialActions.dismissTutorial",environment:e,perform:e=>{r().mJ({userSettingsStore:i,transaction:e,data:{tutorials:{...s,[t]:o().YD}}})},userId:i.id})}function u(e){const{currentUserSettingsStore:t}=a().default.state;t&&f({userAction:"TutorialActions.resetTutorialsDebug",environment:e,perform:e=>{r().mJ({userSettingsStore:t,transaction:e,data:{tutorials:{}}})},userId:t.id})}function p(e,t,n){var i;const{currentUserSettingsStore:c}=a().default.state;if(!c||(0,s().x$)(c,t))return;const l=(0,s().gt)(c,t);o().c$[t].steps.findIndex((e=>e.id===l))>=o().c$[t].steps.findIndex((e=>e.id===n))||r().mJ({userSettingsStore:c,transaction:e,data:{tutorials:{...null===(i=c.getSettings())||void 0===i?void 0:i.tutorials,[t]:n}}})}function m(e,t,n){if((0,s().ll)(n))return;const o=(0,s().tb)(t,n);o&&p(e,t,o)}function f(e){return i().createAndCommit({...e,canUndo:!1})}},77279:(e,t,n)=>{n.r(t),n.d(t,{default:()=>i});class o extends(()=>n(757695))().default{getInitialState(){return{discussionIdToExpansionStartPointMap:{}}}}const i=new o},99874:(e,t,n)=>{n.r(t),n.d(t,{createClient:()=>c,generateNewClientSessionId:()=>s,getCurrentClientSessionId:()=>a});var o=()=>n(206267),i=()=>n(780054);let r=o().JW();function s(){r=o().JW()}function a(){return r}function c(e){const{maxReconnectDelayMs:t,minReconnectDelayMs:o}=e,s=`${i().A.audioProcessor.url}?sessionId=${encodeURIComponent(r)}`;return new(n(502681))(s,{reconnect:{max:t,min:o,"reconnect timeout":2500,retries:1e20},timeout:2500,credentials:!0,transport:{withCredentials:!0},transportOverrides:{transports:["websocket"]}})}},185982:(e,t,n)=>{n.r(t),n.d(t,{AudioSessionBlockWriter:()=>M,DictationManager:()=>O,Segment:()=>D,StreamingDictationManager:()=>L,smartToggleDictation:()=>F,startDictation:()=>N,stopDictation:()=>z});n(16280),n(18107),n(944114),n(816573),n(878100),n(177936),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(967357),n(748140),n(821903),n(491134),n(128845),n(237467),n(444732),n(979577),n(898992),n(823215),n(354520),n(672577),n(581454);var o,i=()=>n(700500),r=()=>n(857639),s=()=>n(919709),a=()=>n(999752),c=()=>n(229833),l=()=>n(534177),d=()=>n(44729),u=()=>n(246826),p=()=>n(725614),m=()=>n(317909),f=()=>n(595345),g=()=>n(317027),v=()=>n(87017),h=()=>n(186445),S=()=>n(667925),y=()=>n(108944),b=()=>n(148832),k=()=>n(233124),w=()=>n(909557),A=()=>n(286236),x=()=>n(497663),C=()=>n(927648),T=()=>n(964345),_=()=>n(632503),I=()=>n(376746);const B=/([\?\!\.])\s/;class D{constructor(e,t){this.id=void 0,this.text=void 0,this.isCompleteReceived=void 0,this.transcriptions=void 0,this.id=e,this.isCompleteReceived=!!t,this.transcriptions=new Map}updateText(){let e;for(const t of this.transcriptions.values()){if("pending"===t.status)break;"complete"===t.status&&(e=t.text)}this.text=e}setTranscription(e,t){this.transcriptions.set(e,t),this.updateText()}setIsCompleteReceived(e){!this.isCompleteReceived&&e&&(this.isCompleteReceived=!0)}getId(){return this.id}getText(){return this.text}isSettled(){return this.isCompleteReceived&&[...this.transcriptions.values()].every((e=>"pending"!==e.status))}}class R{constructor(e){this.blockStore=void 0,this.segments=void 0,this.isSettled=void 0;const{blockStore:t}=e;this.blockStore=t,this.segments=new Map,this.isSettled=!1}setSegment(e,t){this.segments.set(e,t)}getSegments(){return this.segments.values()}getBlockStore(){return this.blockStore}deleteSegment(e){this.segments.delete(e)}getIsSettled(){return this.isSettled}setIsSettled(e){this.isSettled=e}}class M{constructor(e){this.id=void 0,this.env=void 0,this.isCompleteReceived=void 0,this.segments=void 0,this.blockSegmentManager=void 0,this.blockSegmentManagers=void 0,this.latestSettledText=void 0;const{id:t,env:n,blockStore:o}=e,i=new R({blockStore:o});this.id=t,this.env=n,this.isCompleteReceived=!1,this.segments=new Map,this.blockSegmentManagers=new Set([i]),this.blockSegmentManager=i,this.latestSettledText=""}getEnvironment(){return this.env}getOrCreateSegment(e){const t=this.segments.get(e);if(t)return t;{const t=new D(e);return this.segments.set(e,t),this.blockSegmentManager.setSegment(e,t),t}}getBlockSegmentManager(){return this.blockSegmentManager}setIsCompleteReceived(e){!this.isCompleteReceived&&e&&(this.isCompleteReceived=!0)}getId(){return this.id}getFullText(e){return[...e.values()].map((e=>e.getText())).filter((e=>!!e)).join(" ").trim()}isSettled(){return this.isCompleteReceived&&[...this.segments.values()].every((e=>e.isSettled()))}setLatestSettledText(e){this.latestSettledText=e.trim()}getIndexOfBlockSegmentManagers(e){return Array.from(this.blockSegmentManagers).indexOf(e)}addToBlockSegmentManagers(e,t){if("number"==typeof t&&t>=0&&t<this.blockSegmentManagers.size){const n=Array.from(this.blockSegmentManagers);n.splice(t,0,e),this.blockSegmentManagers=new Set(n)}else this.blockSegmentManagers.add(e)}writeToBlock(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=this.blockSegmentManager.getBlockStore(),n=this.blockSegmentManager.getBlockStore().getParentBlockStore();if(t&&t.isDictatableBlock()&&n){const o=new Map;for(const t of[...this.blockSegmentManager.getSegments()]){if(!e&&!t.isSettled())break;o.set(t.getId(),t)}const i=this.getFullText([...o.values()]),r=function(e){const t=e.split(B);for(let r=1;r<t.length;r++)"."!==t[r]&&"?"!==t[r]&&"!"!==t[r]||(t[r-1]+=t[r],t[r]="");const n=t.filter((function(e){return void 0!==e&&""!==e})),o=[];let i="";for(const r of n)i.length>=250&&(o.push(i.trim()),i=""),i+=` ${r}`;i.length>0&&(o.push(i.trim()),i="");return o}(this.latestSettledText?[this.latestSettledText,i].join(" "):i);if(r.length>1){const e=r.pop();for(const o of r){const{performResult:e}=E({environment:this.env,parentBlockStore:n,sibling:t,actionType:"before"}),i=new R({blockStore:e});i.setIsSettled(!0);const r=this.getIndexOfBlockSegmentManagers(this.blockSegmentManager);this.addToBlockSegmentManagers(i,r),j({environment:this.env,block:e,transcriptions:[{text:o,settled:!0}]})}[...o.values()].slice(-1).pop()&&e&&this.setLatestSettledText(e??"");for(const t of[...o.keys()])this.blockSegmentManager.deleteSegment(t)}const s=[];this.latestSettledText&&s.push({text:this.latestSettledText,settled:!0});for(const t of this.blockSegmentManager.getSegments()){const n=t.getText();n&&s.push({text:n,settled:t.isSettled()||e})}j({environment:this.env,block:this.blockSegmentManager.getBlockStore(),transcriptions:s})}}}function E(e){let{environment:t,parentBlockStore:n,sibling:o,actionType:r}=e;return m().createAndCommit({userAction:"dictationActions.createDictationBlock",environment:t,canUndo:!0,perform:e=>{var s;const a=(null==o?void 0:o.getDictationRoleModel())??i().xd.text,c=null===(s=T().ei.state)||void 0===s?void 0:s.isTranscriptionBlock();if(!t.device.isMobile||c||n.isTranscriptionBlock()){var l;const i=n.isTranscriptionBlock()?null===(l=n.getContentStores().find((e=>e.id===n.getFormat().transcription_transcript_id)))||void 0===l?void 0:l.getContentStore():n.getContentStore();if(!i)throw new Error("No parent dictation content store found");const s=u().Wv({environment:t,type:a,inMemoryRecordCache:n.inMemoryRecordCache,transaction:e});return"before"===r?d().Ti({parentStore:i,childStore:b().B.createChildStore(i,s.pointer),before:null==o?void 0:o.id,transaction:e}):d().NI({parentStore:i,childStore:b().B.createChildStore(i,s.pointer),after:null==o?void 0:o.id,transaction:e}),s}{const n=("before"===r?v().insertBlockAbove:v().insertBlockBelow)({environment:t,selection:o?[o]:[],createBlockItem:S().ry[a],transaction:e,analyticsFrom:"dictation",preventSetSelection:!0});return p().setSelectionAtEnd({store:n.getBlockTitleStore()}),n}}})}function j(e){let{environment:t,block:o,transcriptions:i}=e;if(o.isDictatableBlock()){const e=[],r=i.filter((e=>!!e.text));for(const[t,o]of r.entries()){const i=t===r.length-1?o.text:`${o.text} `,a=o.settled?(0,s().Ey_)(i):(0,s().Ey_)(i,[["dut",Date.now(),n(914649).h5]]);e.push(a)}m().createAndCommit({userAction:"dictationActions.updateDictatableBlock",environment:t,canUndo:!0,perform:i=>{var r;if(!o)throw new Error("No block store provided.");n(606952).KY({environment:t,store:o.getBlockTitleStore(),value:e,transaction:i});const s=null===(r=T().ei.state)||void 0===r?void 0:r.isTranscriptionBlock();t.device.isMobile&&!s&&p().setSelectionAtEnd({store:o.getBlockTitleStore()})}})}}function q(e){return new Promise(((t,n)=>{try{const o=new Blob(e),i=new FileReader;i.readAsDataURL(o),i.onloadend=()=>{var e;const o=null===(e=i.result)||void 0===e?void 0:e.toString().split(",")[1];o?t(o):n(new Error("No base64Audio"))}}catch(o){n(o)}}))}function P(e,t,n){if((0,l().O9)(n)&&!n.pathIsDead()&&n.id!==t.id){const o=(0,y().Nq)(t),i=(0,y().Nq)(n);if((0,l().O9)(o)&&(0,l().O9)(i)&&o.id===i.id){const o=(0,y().g7)(n);if((()=>{for(const e of o)if(e instanceof b().B){if(e.id===t.id)return!0;if(e.id===i.id)return!1}return!1})()){const t=n.getParentBlockStore();if(n.isEmptyDictatableBlock()&&[...T().Ay.state.audioSessionBlockWriters.values()].every((e=>e.getBlockSegmentManager().getBlockStore().id!==n.id)))return n;if(t)return E({environment:e,parentBlockStore:t,sibling:n,actionType:"after"}).performResult}}}return E({environment:e,parentBlockStore:t}).performResult}class O{static async getAllProcessableFramesAsBase64(e){const t=16*Math.max(1,e),n=Math.floor(this.audioBuffer.length/t);if(n>0){const e=n*t,o=this.audioBuffer.slice(0,e);return this.audioBuffer=this.audioBuffer.slice(e),this.audioEncoderQueue.enqueue((()=>q([o])))}return!1}static getDictationAudioRecorder(e){const{environment:t,includeSystemAudio:n}=e,o=T().Ay.state.audioRecorder;return o?(o.stop(),o):new(A().Nr)({onDataReceived:e=>{T().gZ.state&&(this.audioBuffer=new Float32Array([...this.audioBuffer,...e]),this.getAllProcessableFramesAsBase64(96).then((e=>{if(e){const n=(0,_().$q)((0,_().FT)(t.currentUser.id));(0,f().$g)({base64Audio:e,environment:t,language:n}).catch((()=>{}));const o=T().ei.state;o&&(0,I().saveTranscribingBlockIdThrottled)(o.id,o.getSpaceId())}})).catch((()=>{})))},onStop:e=>{z({environment:t,error:e,from:"audio_recorder_stopped"})},includeSystemAudio:n})}static get dictationIsActive(){return Boolean(this.startController&&!this.startController.signal.aborted)}static async smartToggleDictation(e){var t;const n=(0,h().ao)();return this.dictationIsActive&&(null===(t=T().Ay.state.rootBlock)||void 0===t?void 0:t.id)===(null==n?void 0:n.id)?this.stopDictation(e):this.startDictation(e)}static async startDictation(e){const t=e.blockStore??(0,h().ao)(),o=null==t?void 0:t.isTranscriptionBlock();try{await this.stopDictation({environment:e.environment,from:e.from}),this.startController=new AbortController;const a=this.startController.signal;T().Ay.setState({...T().Ay.state,loading:!0,showDictationBubble:!0});const{environment:l}=e;let d;if(e.preCreateDictationBlock&&t){const e=E({environment:l,parentBlockStore:t,sibling:void 0,actionType:"after"}).performResult;d=e,await n(908006).default.afterNextFlush((()=>{p().setSelectionAtStart({store:e.getBlockTitleStore()})}))}const u=(0,f().qY)();e.from&&(0,k().uB)(e.environment,{dictation_session_id:u,from:e.from});if(!((null==t?void 0:t.isPageBlock())||(null==t?void 0:t.isCollectionViewPageWithContent())||o)||!(0,n(862835).h)())throw new Error("Target is not dictatable.");const m=this.getDictationAudioRecorder(e);$.start();try{var i;const{environment:r}=e;if(await m.start(),C().Ay.setState(C().a3),a.aborted)throw new Error("start dictation aborted");const s=o?null===(i=t.getContentStores().find((e=>e.id===t.getFormat().transcription_transcript_id)))||void 0===i?void 0:i.getContentStores().at(-1):n(502438).default.state.stores.slice(-1).pop();await(0,g().Ez)(e.environment),T().Ay.setState({...T().Ay.state,audioRecorder:m,enabled:!0,talking:!1,rootBlock:t,showDictationBubble:!0,block:d??P(r,t,s),environment:r}),(0,k().D_)(r,{dictation_session_id:u})}catch(s){if(!a.aborted)try{const t=await C().Ay.checkPermissions();(0,k().rP)(e.environment,{type:"mic_permissions",dictation_session_id:u,reason:t})}catch(s){}if(m.destroy(),o)throw r().log({level:"error",from:"dictationActions",type:"dictationFailedToStart",error:(0,c().n6)(s),data:{miscDataToConvertToString:{dictation_session_id:u,transcription_id:t.id}}}),s}}catch(s){if(this.stopDictation({environment:e.environment,from:"start_transcription_error"}),o)throw s}finally{T().Ay.setState({...T().Ay.state,loading:!1})}}static async stopDictation(e){const t=T().Ay.state.rootBlock;if(this.startController&&!this.startController.signal.aborted){this.startController.abort();const{environment:i,error:s,from:a}=e,l=(0,f().qY)();(0,k().E_)(i,{dictation_session_id:l,from:a});const d=T().Ay.state.audioRecorder,u=T().Ay.state.enabled;T().Ay.setState({...T().Ay.state,audioRecorder:void 0,enabled:!1,loading:!1,rootBlock:void 0,block:void 0,showDictationBubble:!1}),null==d||d.destroy(),s&&r().log({level:"error",from:"dictationActions",type:"dictationError",error:(0,c().n6)(s),data:{miscDataToConvertToString:{dictation_session_id:l}}});try{s instanceof w().XG?((0,k().rP)(i,{type:"throttle",dictation_session_id:l}),(0,x().e5)()):s instanceof w().eY?((0,k().rP)(i,{type:"missing_user_or_space",dictation_session_id:l,reason:s.message}),(0,x().op)()):s instanceof w().d1?(0,k().rP)(i,{type:"mic_permissions",dictation_session_id:l,reason:C().Ay.state}):s instanceof w().Rv?((0,k().rP)(i,{type:"forbidden",dictation_session_id:l}),(0,x().op)()):(s instanceof w().E6||s instanceof Error)&&(0,x().op)(),await(0,g().Ep)(i)}catch(o){}finally{$.stop();const o=T().Ay.state.audioSessionBlockWriters;let r=!1;for(const e of o.values())e.writeToBlock(!0),o.delete(e.getId()),r=!0;r&&T().Ay.emit(),u&&(0,k().Im)(i,{dictation_session_id:l}),null!=t&&t.isTranscriptionBlock()&&e.environment&&(n(197271).transcriptionBlockActions.ensureTranscriptionIsInActive({environment:e.environment,blockStore:t}),(0,I().removeTranscribingBlockId)())}}}}async function F(e){return O.smartToggleDictation(e)}async function N(e){return O.startDictation(e)}async function z(e){const{environment:t,error:n,from:o}=e;return O.stopDictation({environment:t,error:n,from:o})}O.startController=void 0,O.audioBuffer=new Float32Array,O.audioEncoderQueue=new(a().O)(1);class ${constructor(){if($.instance)return $.instance;$.instance=this}static start(){this.listening||(this.listening=!0,g().$I.on(g().Ux,$.processTranscriptionResult),g().$I.on(g().L6,$.processVadEvent),g().$I.on(g().bH,$.processRateLimitEvent),g().$I.on(g().zz,$.processForbiddenEvent),g().$I.on(g().ZQ,$.processOpenAIErrorEvent))}static stop(){this.listening&&(this.listening=!1,g().$I.off(g().Ux,$.processTranscriptionResult),g().$I.off(g().L6,$.processVadEvent),g().$I.off(g().bH,$.processRateLimitEvent),g().$I.off(g().zz,$.processForbiddenEvent),g().$I.off(g().ZQ,$.processOpenAIErrorEvent))}static processOpenAIErrorEvent(e){if(429===e.status){const{environment:t}=T().Ay.state;z({environment:t,error:new(w().E6)(e.message,e.status),from:"transcription_error"})}}static processForbiddenEvent(e){const{environment:t}=T().Ay.state;z({environment:t,error:new(w().Rv)("Not eligible for dictation"),from:"forbidden"})}static processRateLimitEvent(e){const{environment:t}=T().Ay.state;z({environment:t,error:new(w().XG)("Audio usage limit reached"),from:"rate_limit"})}static processVadEvent(e){T().Ay.setState({...T().Ay.state,talking:e.talking})}static processTranscriptionResult(e){const{audioSessionId:t,segmentId:n,isSegmentComplete:o,isAudioSessionComplete:i}=e,{enabled:r,rootBlock:s,audioSessionBlockWriters:a,environment:c,block:l}=T().Ay.state;let d=!1;if(!a.has(t)&&c&&r){const e=s?P(c,s,l):void 0;if(e){const n=new M({id:t,env:c,blockStore:e});a.set(t,n),d=!0,T().Ay.setState({...T().Ay.state,block:e})}else z({environment:c,from:"block_not_available"})}const u=a.get(t);if(u){u.setIsCompleteReceived(i);const t=u.getOrCreateSegment(n);t.setIsCompleteReceived(o),t.setTranscription(e.transcription.id,e.transcription)}for(const m of a.values())m.writeToBlock();for(const m of[...a.values()].filter((e=>e.isSettled()))){var p;a.delete(m.getId()),d=!0,r&&c&&s&&(null===(p=T().Ay.state.block)||void 0===p?void 0:p.id)===m.getBlockSegmentManager().getBlockStore().id&&T().Ay.setState({...T().Ay.state,block:P(c,s,T().Ay.state.block)})}d&&T().Ay.emit()}}$.instance=void 0,$.listening=!1;class L{static getAllProcessableFramesAsBase64(e){const t=16*Math.max(1,e),n=Math.floor(this.audioBuffer.length/t);if(n>0){const e=n*t,o=this.audioBuffer.slice(0,e);return this.audioBuffer=this.audioBuffer.slice(e),this.audioEncoderQueue.enqueue((()=>q([o])))}return Promise.resolve(!1)}static async start(e){try{await this.stop(),this.startController=new AbortController,this.env=e.environment,this.isActive=!0,this.currentTranscript="",this.segments.clear(),this.transcriptionListener=e.onTranscription,this.onErrorListener=e.onError,this.streamingSessionId=(0,f().qY)(),this.audioRecorder=new(A().Nr)({onDataReceived:t=>{this.audioBuffer=new Float32Array([...this.audioBuffer,...t]),this.getAllProcessableFramesAsBase64(96).then((t=>{if(t){const n=(0,_().$q)((0,_().FT)(e.environment.currentUser.id));(0,f().$g)({base64Audio:t,environment:e.environment,language:n}).catch((()=>{}))}})).catch((()=>{}))},onStop:e=>{L.stop()},includeSystemAudio:!1}),await this.audioRecorder.start(),g().$I.on(g().Ux,this.handleTranscriptionEvent)}catch(t){this.onErrorListener&&t instanceof Error&&this.onErrorListener(t),this.stop()}}static async stop(){if(this.isActive){var e;this.isActive=!1,this.startController&&!this.startController.signal.aborted&&this.startController.abort(),g().$I.off(g().Ux,this.handleTranscriptionEvent),null===(e=this.audioRecorder)||void 0===e||e.destroy();try{await(0,g().Ep)(this.env)}catch{}this.audioRecorder=void 0,this.streamingSessionId=void 0,this.env=void 0}}}o=L,L.startController=void 0,L.env=void 0,L.audioBuffer=new Float32Array,L.audioEncoderQueue=new(a().O)(1),L.audioRecorder=void 0,L.streamingSessionId=void 0,L.isActive=!1,L.transcriptionListener=void 0,L.onErrorListener=void 0,L.segments=new Map,L.currentTranscript="",L.handleTranscriptionEvent=e=>{const t=e.segmentId;let n=o.segments.get(t);n||(n=new D(t),o.segments.set(t,n)),n.setIsCompleteReceived(e.isSegmentComplete),n.setTranscription(e.transcription.id,e.transcription);const i=Array.from(o.segments.values()).map((e=>e.getText()||"")).join(" ").trim();o.currentTranscript=i,o.transcriptionListener&&o.transcriptionListener(o.currentTranscript)}},197271:(e,t,n)=>{n.r(t),n.d(t,{DictationAvatar:()=>I,DictationBubble:()=>O,StopDictationButton:()=>Y,StopDictationButtonMobile:()=>re,StopDictationListener:()=>ae,dictationActions:()=>i(),hooks:()=>p(),recoverTranscriptionBlockActions:()=>u(),transcriptionBlockActions:()=>r(),transcriptionNewPageActions:()=>o});var o={};n.r(o),n.d(o,{appendTranscriptionBlockToPage:()=>d});var i=()=>n(185982),r=()=>n(271380),s=()=>n(700500),a=()=>n(317909),c=()=>n(87017),l=()=>n(667925);function d(e){const{environment:t}=e;a().createAndCommit({userAction:"transcriptionNewPageActions.appendTranscriptionBlock",environment:t,canUndo:!0,perform:e=>{(0,c().insertBlockBelow)({environment:t,createBlockItem:l().ry[s().xd.transcription],analyticsFrom:"quick_templates",selection:[],transaction:e})}})}var u=()=>n(376746),p=()=>n(673657),m=n(296540),f=()=>n(56366),g=()=>n(614415),v=()=>n(645873),h=()=>n(964345),S=()=>n(484714),y=()=>n(401497),b=()=>n(959013),k=()=>n(620689),w=()=>n(783793),A=()=>n(704152),x=()=>n(859428),C=()=>n(126126),T=n(474848);const _=18;function I(e){let{enableClickToScroll:t=!1,rootStore:n,noMarginRight:o=!1,noOutline:i=!1,noTooltip:r=!1}=e;const s=(0,p().useIsDictatingToPage)(n),a=(0,S().v3)(),c=(0,m.useCallback)((e=>e.UIUserAvatarSelfBorder),[]),l=(0,C().XE)(c,!0),d=(0,y().IS)((e=>({tooltip:{color:e.text.contrastSecondary,minWidth:150,paddingTop:2,paddingBottom:2,lineHeight:1.3},avatarContainer:{width:_,height:_,borderRadius:_,backgroundColor:e.assistantCornerButtonBackground,display:"flex",alignItems:"center",justifyContent:"center"}})),[]),u=(0,f().K8)((()=>h().b.state),[]);return!s&&n?null:(0,T.jsx)(x().A,{textWrap:!0,disableTooltip:r,renderTooltip:()=>(0,T.jsxs)("div",{children:[(0,T.jsx)("div",{children:(0,T.jsx)(b().sA,{defaultMessage:"Transcribing your words",id:"topbar.presenceIndicator.dictation.tooltip.description"})}),(0,T.jsx)("div",{style:d.tooltip,children:(0,T.jsx)(b().sA,{defaultMessage:"Click to see where",id:"topbar.presenceIndicator.dictation.tooltip.action"})})]}),render:e=>{const n=(0,T.jsx)("div",{style:{...l.avatarOuterOutline,...i?{outline:"none"}:{},...o?{marginRight:0}:{},width:_,height:_},children:(0,T.jsx)("div",{style:{...l.avatarBorder,...d.avatarContainer},children:(0,T.jsx)(w().o,{variant:"avatar",wrapWithPadding:!1,shadowVariant:"none"})})});return t&&u?(0,T.jsx)(A().A,{...e,onClick:()=>k().BL([u],!0,a),style:l.button,hoveredStyle:l.buttonHovered,pressedStyle:l.buttonPressed,children:n}):(0,T.jsx)("div",{...e,style:{cursor:"default"},children:n})}})}n(944114),n(898992),n(803949);var B=()=>n(534177),D=()=>n(171333),R=()=>n(141333);function M(e){let t=[];return e.nodeType===Node.TEXT_NODE?t.push(e):e.childNodes.forEach((e=>{t=t.concat(M(e))})),t}function E(e){let{scrollerStore:t,children:n,framerMotion:o}=e;const i=(0,f().O$)(h().b),r=(0,f().K8)((()=>t.state.elementRef??{current:null}),[t]),s=(0,R().yE)(r),[a,c]=(0,m.useState)(),[l,d]=(0,m.useState)(),u=(0,D().lB)(t),p=(0,D().ht)(t),g=null==u?void 0:u.getNode(),v=null==g?void 0:g.querySelector(".notion-page-content"),S=null==v?void 0:v.querySelector(`[data-block-id="${i}"]`);(0,m.useEffect)((()=>{h().Ay.setState({...h().Ay.state,dictationBubbleScrollPosition:null==l?void 0:l.top})}),[l]),(0,m.useEffect)((()=>{if(v){let e;const t=new MutationObserver((t=>{(0,B().O9)(e)&&cancelAnimationFrame(e),e=requestAnimationFrame((()=>c(Date.now())))}));return t.observe(v,{subtree:!0,characterData:!0,childList:!0}),()=>{t.disconnect(),(0,B().O9)(e)&&cancelAnimationFrame(e)}}}),[v]),(0,m.useEffect)((()=>{if(g){let e;const t=new ResizeObserver((()=>{(0,B().O9)(e)&&cancelAnimationFrame(e),e=requestAnimationFrame((()=>c(Date.now())))}));return t.observe(g),()=>{t.disconnect(),(0,B().O9)(e)&&cancelAnimationFrame(e)}}}),[g]),(0,m.useLayoutEffect)((()=>{if(!S||!g){const e=setTimeout((()=>{d(void 0)}),200);return()=>{clearTimeout(e)}}{const e=document.createRange(),t=S.querySelector('[data-content-editable-leaf="true"]')??S,n=M(t),o=g.getBoundingClientRect();if(n.length>0){const t=n[n.length-1];e.selectNodeContents(t),e.collapse(!1);const i=e.getBoundingClientRect(),r=i.top+s-o.top,a=i.right-o.left+5;d({top:r,left:a})}else{const e=t.getBoundingClientRect(),n=window.getComputedStyle(t),i=parseInt(n.paddingTop,10),r=isNaN(i)?0:i,a=parseInt(n.paddingBottom,10),c=isNaN(a)?0:a,l=parseInt(n.paddingRight,10),u=isNaN(l)?0:l,p=e.top+r+c+s-o.top,m=e.left-o.left+u;d({top:p,left:m})}}}),[S,g,a,s]);const y=(0,B().O9)(l);(0,m.useEffect)((()=>{if(p&&y)switch(p){case"Page":return h().Ay.setState({...h().Ay.state,blockRenderedInPage:!0}),()=>{h().Ay.setState({...h().Ay.state,blockRenderedInPage:!1})};case"PeekView":return h().Ay.setState({...h().Ay.state,blockRenderedInPeekView:!0}),()=>{h().Ay.setState({...h().Ay.state,blockRenderedInPeekView:!1})}}}),[p,y]);const b=(0,m.useRef)(null);(0,m.useEffect)((()=>{if(!l||!b.current)return;const e=new IntersectionObserver((e=>{const[t]=e;let n;n=t.isIntersecting?"inScreen":t.boundingClientRect.top<0?"above":"below",h().Ay.setState({...h().Ay.state,dictationBubbleRelativeToScreen:n})}),{root:g,rootMargin:"0px",threshold:[0,1]});b.current&&e.observe(b.current);const t=b.current;return()=>{t&&e.unobserve(t)}}),[g,l]);const{motion:k}=o;return l?(0,T.jsx)(k.div,{ref:b,initial:{transform:`translate(${l.left}px, ${l.top}px)`},animate:{transform:`translate(${l.left}px, ${l.top}px)`},transition:{duration:.2},style:{display:"block",position:"absolute",top:0,left:3,width:0,height:0,zIndex:112},children:n}):null}function j(e){const{value:t}=(0,v().fJ)(g().fM);return t?(0,T.jsx)(E,{...e,framerMotion:t}):null}n(581454);function q(e){const{framerMotion:t}=e,{motion:n}=t,o=(0,g().sM)(t);(0,m.useEffect)((()=>{(async()=>{await o.start((e=>({y:[0,-7,0],transition:{duration:.6,delay:.15*e,repeat:1/0,repeatDelay:1,ease:"easeInOut"}})))})()}),[o]);const i=(0,y().IS)((e=>({dotStyle:{width:6,height:6,flexShrink:0,backgroundColor:e.icon.quaternary,borderRadius:"50%"}})),[]);return(0,T.jsx)(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},style:{display:"flex",justifyContent:"center",alignItems:"center",gap:3},children:[...Array(3)].map(((e,t)=>(0,T.jsx)(n.div,{custom:t,animate:o,style:i.dotStyle},t)))})}function P(){const{value:e}=(0,v().fJ)(g().fM);return e?(0,T.jsx)(q,{framerMotion:e}):null}function O(e){let{scrollerStore:t}=e;const n=(0,f().K8)((()=>h().Ay.state.showDictationBubble),[]),o=(0,f().O$)(h().Gq),{value:i}=(0,v().fJ)(g().fM);if(!i)return null;const{AnimatePresence:r}=i;return n?(0,T.jsx)(j,{scrollerStore:t,children:(0,T.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6},children:[(0,T.jsx)(I,{noMarginRight:!0,noOutline:!0,noTooltip:!0}),(0,T.jsx)(r,{children:o&&(0,T.jsx)(P,{})})]})}):null}var F=n(440961),N=()=>n(883234),z=()=>n(197190),$=()=>n(406699),L=()=>n(745766),U=()=>n(592678),K=()=>n(463830),W=()=>n(948914),J=()=>n(712505),Q=()=>n(29703),V=()=>n(784749);const G=document.body;function X(e){let{rootStore:t,framerMotion:n}=e;const o=(0,S().WS)(),r=(0,p().useIsDictatingToPage)(t),s=(0,S().v3)(),a=(0,f().K8)((()=>h().Ay.state.audioRecorder),[]),c=(0,f().uB)(void 0,K().A),l=(0,f().uB)(void 0,K().A),d=(0,f().K8)((()=>Boolean(W().A.state.isShowingTabBar)),[]),u=(0,m.useCallback)((()=>{(0,i().stopDictation)({environment:s,from:"button"})}),[s]),g=(0,m.useCallback)((e=>{null==e||e.stopPropagation(),e&&(0,U().Vt)(e)||(l.state.open?l.reset():c.state.open?c.reset():c.setState({...c.state,open:!0}))}),[c,l]),v=(0,f().K8)((()=>"dark"===s.ThemeStore.state.mode),[s]),[b,k]=(0,m.useState)(!1),w=(0,m.useCallback)((()=>{k(!0)}),[]),A=(0,m.useCallback)((()=>{k(!1)}),[]),[x,_]=(0,m.useState)(!1),I=(0,m.useCallback)((()=>{_(!0)}),[]),B=(0,m.useCallback)((()=>{_(!1)}),[]),D=(0,y().IS)((e=>({dictationButtonStyle:{display:"flex",alignItems:"center",justifyContent:"center",borderRadius:25,gap:2,height:24,cursor:"pointer",padding:"6px 2px 6px 2px",backgroundColor:v?"#2D2D2D":"#F1F0EF",...(0,L().g)({noDrag:s.device.isElectron&&!d})},downChevronContainer:{display:"flex",alignItems:"center",justifyContent:"center",height:20,width:20,borderRadius:20},downIcon:{fill:x?e.icon.secondary:e.icon.tertiary,width:10,height:10},redSquare:{width:10,height:10,borderRadius:2,backgroundColor:b?v?e.accentColors.red[500]:"rgba(191, 67, 64, 1)":v?e.accentColors.red[700]:e.accentColors.red[500]},redSquareContainer:{width:20,height:20,borderRadius:20,display:"flex",alignItems:"center",justifyContent:"center"}})),[v,s.device.isElectron,d,x,b]),R=(0,m.useMemo)((()=>(0,N()._)(D.downIcon)),[D.downIcon]),M=(0,f().K8)((()=>{var e;return J().default.isCenterPeekOpen()&&(null===(e=J().default.peekTargetStore.state)||void 0===e?void 0:e.id)!==(null==t?void 0:t.id)}),[null==t?void 0:t.id]),E=(0,m.useRef)(null),[j,q]=(0,m.useState)(null);(0,m.useEffect)((()=>{if(!E.current)return void q(null);const e=E.current.getBoundingClientRect();q({top:e.top+window.scrollY,left:e.left+window.scrollX})}),[M]);const P=(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(z().A,{style:D.redSquareContainer,onClick:u,onMouseEnter:w,onMouseLeave:A,children:(0,T.jsx)("div",{style:D.redSquare})}),(0,T.jsx)(Q().t,{}),(0,T.jsx)(z().A,{className:"notion-dictation-button-up-chevron",style:D.downChevronContainer,onClick:g,onMouseEnter:I,onMouseLeave:B,children:R})]}),O=(0,C().Uo)({environment:s,isShowingTabBar:d,isShowingInPostFeed:!1}),{motion:X}=n;return r&&a&&!o?(0,T.jsx)("div",{style:{marginLeft:O.marginLeft,marginTop:O.marginTop,marginRight:.5*Number(O.marginLeft)*-1},children:(0,T.jsx)($().Ay,{buttonPopupStore:c,renderOrigin:()=>(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(X.div,{ref:E,className:"notion-dictation-button",style:D.dictationButtonStyle,onClick:u,initial:{opacity:0,x:15},animate:{opacity:1,x:0},transition:{duration:.4},children:P}),M&&(0,F.createPortal)((0,T.jsx)("div",{className:"notion-dictation-button-duplicate",style:{...D.dictationButtonStyle,position:"fixed",top:(null==j?void 0:j.top)||0,left:(null==j?void 0:j.left)||0,zIndex:1e7},onClick:u,children:P}),G)]}),stopClickPropagation:!0,popupType:s.device.isMobile?$().z7.SlideUp:$().z7.Popup,popupWrapStyle:{top:6},render:()=>(0,T.jsx)(V().J,{languagePopupStore:l})})}):null}function Y(e){const{value:t}=(0,v().fJ)(g().fM);return t?(0,T.jsx)(X,{...e,framerMotion:t}):null}const H=(0,n(340498).wt)("stopDictation",{viewBox:"0 0 36 36",svg:(0,T.jsxs)("svg",{width:"36",height:"36",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,T.jsx)("rect",{width:"36",height:"36",rx:"18",fill:"#D34F43",fillOpacity:".1"}),(0,T.jsx)("path",{d:"M12.2 21.7v-8.3c0-.5.2-.9.5-1.2.3-.3.7-.4 1.2-.4h8.2c.5 0 .9.1 1.2.4.3.3.5.7.5 1.2v8.3c0 .5-.2.9-.5 1.2-.3.3-.7.4-1.2.4h-8.2c-.5 0-1-.1-1.2-.4-.3-.3-.5-.7-.5-1.2Z",fill:"#D44C47"})]})});var Z=()=>n(140862),ee=()=>n(575301),te=()=>n(607859),ne=()=>n(991699),oe=()=>n(110750),ie=()=>n(594635);function re(){const e=(0,S().v3)(),{isMobileNative:t,isPhone:n}=(0,S().Y0)(),o=(0,f().K8)((()=>{const e=te().default.state.isOnboarding,t=ne().A.state.open;return e||t}),[]),r=(0,f().K8)((()=>!o&&h().Ay.getState().enabled&&!h().Ay.getState().loading),[o]),s=(0,m.useCallback)((()=>{(0,i().stopDictation)({environment:e,from:"mobile_bar_button"})}),[e]);return(0,m.useEffect)((()=>{o&&s()}),[o,s]),function(e){const t=(0,f().O$)(ie().A);(0,m.useEffect)((()=>{t&&(e(),ie().A.reset())}),[t,e])}(s),function(e){const t=(0,S().v3)(),n=(0,f().K8)((()=>{const e=h().kj.state;if(e)return!e.isDictatableBlock()||e.pathIsDead()}),[]),o=(0,f().K8)((()=>!h().Y$.state&&h().gZ.state),[]),i=(0,f().O$)(h().ei),r=(0,m.useRef)(!0),s=(0,f().K8)((()=>(0,oe().Xz)(t.TabbedRouterStore.state)),[t]);(0,m.useEffect)((()=>{(0,B().O9)(n)&&n&&e()}),[n,e]),(0,m.useEffect)((()=>{if(o&&(0,B().O9)(i)&&!i.isTranscriptionBlock()){const t=setTimeout((()=>{e()}),250);return()=>{clearTimeout(t)}}}),[o,e,i]),(0,m.useEffect)((()=>{t.device.isMobileNative&&s&&(r.current?r.current=!1:e())}),[t,s,r,e])}(s),r&&t&&n?(0,T.jsx)(se,{handleClick:s}):null}function se(e){const{handleClick:t}=e,n=(0,S().v3)(),o=(0,Z().A)(!0);!function(){const{mobileNative:e}=(0,S().v3)();(0,m.useEffect)((()=>(null==e||e.requestKeepScreenOn(!0),()=>{null==e||e.requestKeepScreenOn(!1)})),[e])}();const i=(0,ee().o_)(),[r,s]=(0,f().K8)((()=>[n.WindowSizeStore.getSafePaddingLeftPx(16),n.WindowSizeStore.getSafePaddingRightPx(16)]),[n.WindowSizeStore]),a=(0,y().IS)((e=>({container:{position:"absolute",width:"100%",bottom:i,minHeight:50,paddingTop:"6px",paddingBottom:"6px",paddingRight:s,paddingLeft:r,border:`1px solid ${e.stroke.secondary}`,background:e.contentBackground},dictationButtonStyle:{display:"flex",justifyContent:"space-between",verticalAlign:"center",cursor:"pointer",gridAutoFlow:"column",placeItems:"center",gap:10,alignItems:"center"},icon:{color:e.redBadgeBackground},settingsContainer:{display:"flex",alignItems:"center",justifyContent:"center",height:25,width:25,borderRadius:25},settingsContainerHoveredStyle:{background:e.whiteButtonPressedBackground}})),[i,r,s]),c=(0,m.useMemo)((()=>H({width:36,height:36,...a.icon})),[a.icon]);return(0,T.jsx)("div",{style:{...a.container,zIndex:1e7},...o,children:(0,T.jsxs)("div",{className:"notion-dictation-button",style:{...a.dictationButtonStyle},children:[(0,T.jsx)("div",{style:{maxWidth:480,width:"100%",justifyContent:"center",display:"flex",verticalAlign:"middle"},children:(0,T.jsx)(Q().t,{fillWidth:!0})}),(0,T.jsx)("div",{onClick:t,children:c})]})})}function ae(){const e=(0,S().v3)(),t=(0,f().K8)((()=>{const e=h().ei.state;return(0,B().O9)(e)&&e.isTranscriptionBlock()}),[]),n=(0,f().K8)((()=>{const e=h().kj.state;if(e&&e.isDefined())return!e.isDictatableBlock()||e.pathIsDead()}),[]),o=(0,f().K8)((()=>!h().Y$.state),[]);return(0,m.useEffect)((()=>{(0,B().O9)(n)&&n&&(0,i().stopDictation)({environment:e,from:"block_not_dictatable"})}),[n,e]),(0,m.useEffect)((()=>{if(o&&!t){const t=setTimeout((()=>{o||(0,i().stopDictation)({environment:e,from:"block_not_visible"})}),350);return()=>{clearTimeout(t)}}}),[o,t,e]),null}},204552:(e,t,n)=>{n.d(t,{c:()=>i,x:()=>r});var o=()=>n(645873);const i=(0,o()._h)(new(o().O2)("UniversalQnaModals",(async()=>await Promise.all([n.e(23806),n.e(37353),n.e(55373),n.e(29151),n.e(16908),n.e(48315),n.e(847),n.e(5887),n.e(17989),n.e(56985),n.e(21627),n.e(82472),n.e(96345),n.e(75659),n.e(47858),n.e(51860),n.e(221),n.e(14358)]).then(n.bind(n,457974)))),(e=>e.UniversalQnaModals)),r=(0,o()._h)(new(o().O2)("SlackConnectionOptions",(async()=>await n.e(85873).then(n.bind(n,210230)))),(e=>e.SlackConnectionOptions))},233124:(e,t,n)=>{n.d(t,{D_:()=>s,E_:()=>r,Im:()=>a,K_:()=>l,rP:()=>c,uB:()=>i});var o=()=>n(989423);function i(e,t){e&&o().vd(e,"dictation_modal_open",t)}function r(e,t){e&&o().vd(e,"dictation_modal_close",t)}function s(e,t){e&&o().vd(e,"dictation_start",t)}function a(e,t){e&&o().vd(e,"dictation_end",t)}function c(e,t){e&&o().vd(e,"dictation_error",t)}function l(e,t){e&&o().vd(e,"update_dictation_language",t)}},271380:(e,t,n)=>{n.r(t),n.d(t,{ensureTranscriptionIsInActive:()=>E,pauseTranscription:()=>j,placeCursorInNotesTab:()=>$,runSummarization:()=>P,startTranscribingBlockOnPage:()=>F,startTranscription:()=>R,stopTranscription:()=>M,updatePreferredSummarizationFormat:()=>N});n(18107),n(967357);var o=()=>n(244641),i=()=>n(597777),r=()=>n(604995),s=()=>n(416504),a=()=>n(798880),c=()=>n(919709),l=()=>n(498212),d=()=>n(534177),u=()=>n(884107),p=()=>n(896628),m=()=>n(44729),f=()=>n(246826),g=()=>n(436572),v=()=>n(606952),h=()=>n(725614),S=()=>n(317909),y=()=>n(108184),b=()=>n(582524),k=()=>n(659602),w=()=>n(972435),A=()=>n(351360),x=()=>n(508496),C=()=>n(540144),T=()=>n(632503),_=()=>n(748197),I=()=>n(185982),B=()=>n(431895);const D=(0,n(959013).YK)({transcriptTooShort:{id:"transcriptionBlockActions.transcriptTooShort",defaultMessage:"Transcript is too short."},genericError:{id:"transcriptionBlockActions.genericError",defaultMessage:"Something went wrong while summarizing your transcript."},failedToStartDictation:{id:"transcriptionBlockActions.failedToStartDictation",defaultMessage:"Unable to start transcription. Please try again later."}});async function R(e){var t;const{environment:n,blockStore:l,transaction:d}=e,u=null===(t=A().default.state.currentUserStore)||void 0===t?void 0:t.id;if(!u)return;const p=(e,t)=>{const a=l.getBlockTitleStore(),d=o().c9.now(),u=[c().wmz(c().Ww9({type:"datetime",start_date:d.toFormat(r().tr),start_time:d.toFormat(i().GE),time_zone:(0,s().P)(),date_format:"relative"}),[[c().BQP.Bold]])];v().KY({environment:n,store:a,value:u,transaction:e}),z({environment:n,blockStore:l,state:t,transaction:e})},m=()=>{d&&!d.committed?p(d,{state:"paused"}):S().createAndCommit({userAction:"transcriptionBlockActions.failedToStartDictation",environment:n,canUndo:!1,perform:e=>p(e,{state:"paused"})}),g().D6({label:w().A.formatMessage(D.failedToStartDictation)})};if(!(await(0,B().fp)(n)))return void m();_().c.setSettingsOpenForBlockId(void 0);try{await I().DictationManager.startDictation({environment:n,blockStore:l,from:"transcription_block",includeSystemAudio:x().default.checkGate({gateName:"meeting_notes_system_audio"})})}catch{return void m()}const f={state:"transcribing",transcriber_id:u,transcriber_table:a().oo};d&&!d.committed?p(d,f):S().createAndCommit({userAction:"transcriptionBlockActions.initializeTitleAndStartTranscription",environment:n,canUndo:!1,perform:e=>p(e,f)})}async function M(e){(0,C().pg)(e.blockStore)?await q({...e,shouldStopDictation:!0}):g().D6({label:w().A.formatMessage(D.transcriptTooShort)})}async function E(e){var t;const{environment:n,blockStore:o}=e,i=null===(t=o.getFormat())||void 0===t?void 0:t.transcription_state;i&&"transcribing"!==i.state?"idle"!==(null==i?void 0:i.state)&&"paused"!==(null==i?void 0:i.state)&&"summarizing"!==i.state&&(0,d().HB)(i):await j({environment:n,blockStore:o,shouldStopDictation:!1})}async function j(e){await q({...e,disableSummarization:!0,state:{state:"paused"}})}async function q(e){const{environment:t,blockStore:n,state:o,disableSummarization:i,transaction:r,shouldStopDictation:s}=e;_().c.setSettingsOpenForBlockId(void 0),o&&z({environment:t,blockStore:n,state:o,transaction:r}),s&&I().DictationManager.stopDictation({environment:t,from:"transcription_block"}),i||await P({environment:t,blockStore:n})}async function P(e){const{environment:t,blockStore:n}=e;if(!A().default.state.mainEditorCurrentBlockStore)return;const o=n.pointer.spaceId;if(!o)return;const i=O({environment:t,blockStore:n});let r=i,s=i;_().c.setTabState(n.id,i.id),z({environment:t,blockStore:n,state:{state:"summarizing",step:"thinking"}});const a={...n.pointer,spaceId:o},c=await k().g.load(),d=await u().R.clipboardActions.load(),f=_().c.getSummarizationAbortController(n.id);null==f||f.abort();const v=_().c.createSummarizationAbortController(n.id);try{await(0,b().mf)({environment:t,onResponse:e=>{if("summarize-transcript-error"===e.type)return void g().D6({label:w().A.formatMessage(D.genericError)});if("summarize-transcript-response"!==e.type&&"summarize-transcript-thinking"!==e.type)return;"summarize-transcript-response"===e.type&&z({environment:t,blockStore:n,state:{state:"summarizing",step:"summarizing"}}),s=O({environment:t,blockStore:n}),r=s;const o=e.response;S().createAndCommit({userAction:"transcriptionBlockActions.summarizeTranscript",environment:t,canUndo:!0,perform:i=>{const a=d.markdownToBlocks({environment:t,text:o,inMemoryRecordCache:n.inMemoryRecordCache,transaction:i,markdownOptions:{},markdownLinkifyIt:c,tinyMceMicrosoftWordPasteFilter:void 0});if(a){(0,y().postProcessAICreatedStores)(t,a);for(const t of a)m().NI({childStore:t,parentStore:r,transaction:i,after:s.id}),"summarize-transcript-thinking"===e.type&&p().zA({stores:[t],update:{block_color:"gray"},transaction:i}),s=t}}})},data:{transcript:[{id:(0,l().Ay)(),type:"config",value:{type:"summarize-transcript",transcriptPointer:a,language:(0,T().FT)(t.currentUser.id)}},{id:(0,l().Ay)(),type:"summarize-transcript"}],traceId:n.id,spaceId:o,generateTitle:!1},abortSignal:v.signal,upsellFrom:"transcription_block"})}catch(h){if((0,b().zf)(v,h))return;throw h}z({environment:t,blockStore:n,state:{state:"idle"}})}function O(e){const{environment:t,blockStore:n}=e,o=(0,C().y1)(n,"summary"),{performResult:i}=S().createAndCommit({userAction:"transcriptionBlockActions.deletePreviousSummarizationBlocks",environment:t,canUndo:!0,perform:e=>{if(o){const t=o.getContentStores();for(const n of t)m().zz({childStore:n,parentStore:o,transaction:e});return o}const i=f().Wv({environment:t,type:"text",transaction:e,spaceId:n.pointer.spaceId,inMemoryRecordCache:n.inMemoryRecordCache});return m().Ti({childStore:i,parentStore:n,transaction:e}),p().zA({stores:[n],update:{transcription_summary_id:i.id},transaction:e}),i}});return i}async function F(e){const{environment:t}=e;await A().default.waitUntilRendered();const n=A().default.state.mainEditorCurrentBlockStore;if(!n)return;const o=(0,C().Ql)(n);o.sort(((e,t)=>t.getCreatedTime()-e.getCreatedTime()));const i=o[0];i&&(await R({environment:t,blockStore:i}),$({blockStore:i}))}async function N(e){var t;const{environment:n,blockStore:o,format:i}=e;if((null===(t=o.getFormat())||void 0===t?void 0:t.transcription_summarization_format_type)===i)return;S().createAndCommit({userAction:"transcriptionBlockActions.updatePreferredSummarizationFormat",environment:n,canUndo:!0,perform:e=>{p().zA({stores:[o],update:{transcription_summarization_format_type:i},transaction:e})}});(0,C().I8)({blockStore:o}).length>0&&await P({environment:n,blockStore:o})}function z(e){const{environment:t,blockStore:n,state:o,transaction:i}=e,r=e=>{p().zA({stores:[n],update:{transcription_state:o},transaction:e})};!i||i.committed?S().createAndCommit({userAction:"transcriptionBlockActions.setTranscriptionState",environment:t,canUndo:!0,perform:r}):r(i)}function $(e){const{blockStore:t}=e,n=(0,C().y1)(t,"notes");if(!n)return;const o=n.getContentStores().at(-1),i=null==o?void 0:o.getTitleStore();i&&(h().setSelectionAtStart({store:i}),_().c.setTabState(t.id,n.id))}},286236:(e,t,n)=>{n.d(t,{Nr:()=>c,Q:()=>a});n(898992),n(823215),n(672577),n(430670),n(803949),n(581454),n(814603),n(147566),n(198721),n(816573),n(878100),n(177936),n(748140),n(821903),n(491134),n(128845),n(237467),n(444732),n(979577);class o{constructor(e,t){this._inputSampleRate=void 0,this._outputSampleRate=void 0,this._inputSampleRate=e,this._outputSampleRate=t}downsample(e){return this.downSampleAudioFrame(e,this._inputSampleRate,this._outputSampleRate)}downSampleAudioFrame(e,t,n){if(n===t||n>t)return e;const o=t/n,i=Math.round(e.length/o),r=new Float32Array(i);let s=0,a=0;for(;a<i;){const t=Math.round((a+1)*o);let n=0,i=0;for(;s<t&&s<e.length;)n+=e[s++],i++;r[a++]=n/i}return r}}var i=()=>n(673903),r=()=>n(426175),s=()=>n(524007);const a="ms_change";class c{constructor(e){this._mediaStreams=void 0,this._emitter=void 0,this.recorder=void 0,this.onDataReceived=void 0,this.onStop=void 0,this.startController=void 0,this._includeSystemAudio=void 0,this.handleDeviceChange=async()=>{var e;const t=null===(e=this.mediaStreams)||void 0===e||null===(e=e.flatMap((e=>e.getAudioTracks())))||void 0===e||null===(e=e.map((e=>e.getSettings())))||void 0===e?void 0:e.find((e=>void 0!==e)),n=this.getPreferredOrDefaultDevice();if(!t||n&&(n.deviceId!==t.deviceId||n.groupId!==t.groupId)){this.stop(!1);try{await this.start()}catch{this.destroy()}}},this._emitter=(0,n(827380).A)(),this.recorder=new l,this.onDataReceived=e.onDataReceived,this.onStop=e.onStop,this._includeSystemAudio=e.includeSystemAudio}get emitter(){return this._emitter}set mediaStreams(e){if(this._mediaStreams)for(const n of this._mediaStreams)for(const e of n.getTracks())e.stop();for(const o of e??[])for(const e of o.getTracks())e.addEventListener("ended",(async()=>{if(o.getTracks().every((e=>"ended"===e.readyState))){"denied"===await n(927648).Ay.checkPermissions()&&this.stop(!0,new(n(909557).d1))}}));for(const o of e??[]){var t;const e=null==o||null===(t=o.getAudioTracks()[0])||void 0===t?void 0:t.getSettings();n(964576).A.setState(r().X8.state.find((t=>t.deviceId===(null==e?void 0:e.deviceId))))}this._mediaStreams=e,this._emitter.emit(a)}get mediaStreams(){return this._mediaStreams}getPreferredOrDefaultDevice(){var e;return(null===(e=r().X8.state)||void 0===e?void 0:e.find((e=>{var t;return e.deviceId===(null===(t=s().A.state)||void 0===t?void 0:t.deviceId)})))??r().X8.state[0]}async start(){if(void 0===this.startController||this.startController.signal.aborted){this.startController=new AbortController;const e=this.startController.signal,t=this.getPreferredOrDefaultDevice(),n=(0,i().E)(),o=await n.getUserMedia({audio:{deviceId:t?{exact:t.deviceId}:void 0,echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1,channelCount:1}});if(await r().Ay.updateMediaDevices(),this._includeSystemAudio){const e=await n.getDisplayMedia({audio:!0,systemAudio:this._includeSystemAudio?"include":void 0});this.mediaStreams=[o,e]}else this.mediaStreams=[o];if(e.aborted){for(const e of this.mediaStreams??[])for(const t of e.getTracks())t.stop();return}if(await this.recorder.record(this.mediaStreams??[],(t=>{e.aborted||this.onDataReceived(t)}),16e3),e.aborted)return this.recorder.releaseMediaResources(),void(this.mediaStreams=void 0);s().A.addListener(this.handleDeviceChange),r().X8.addListener(this.handleDeviceChange)}}stop(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;void 0===this.startController||this.startController.signal.aborted||(this.startController.abort(),this.recorder.releaseMediaResources(),this.mediaStreams=void 0,e&&this.onStop&&this.onStop(t),s().A.removeListener(this.handleDeviceChange),r().X8.removeListener(this.handleDeviceChange))}destroy(){s().A.removeListener(this.handleDeviceChange),r().X8.removeListener(this.handleDeviceChange),this.stop()}}class l{constructor(){this._audioWorkletNode=void 0,this._sourceNodes=void 0,this._audioContext=void 0}set sourceNodes(e){this._sourceNodes&&this._sourceNodes.forEach((e=>e.disconnect())),this._sourceNodes=e}set audioWorkletNode(e){this._audioWorkletNode&&this._audioWorkletNode.disconnect(),this._audioWorkletNode=e}set audioContext(e){this._audioContext&&this._audioContext.close(),this._audioContext=e}get audioContext(){return this._audioContext}async record(e,t,r){if(this.releaseMediaResources(),this.audioContext=(0,i().G)(r),Boolean(this.audioContext.audioWorklet))try{const i=new o(this.audioContext.sampleRate,r),s=this.audioContext,a=e.map((e=>s.createMediaStreamSource(e)));await this.audioContext.audioWorklet.addModule(new URL(n(986850),n.b));const c=new AudioWorkletNode(this.audioContext,"pcm-processor");c.port.onmessage=e=>{if(e.data){const n=e.data,o=i.downsample(n);t(o)}},a.forEach((e=>e.connect(c))),this._audioWorkletNode=c,this._sourceNodes=a}catch{console.info("unable to create worklet"),this.releaseMediaResources()}else this.releaseMediaResources()}releaseMediaResources(){this.sourceNodes=void 0,this.audioWorkletNode=void 0,this.audioContext=void 0}}},317027:(e,t,n)=>{n.d(t,{zz:()=>x,ZQ:()=>C,bH:()=>A,Ux:()=>k,L6:()=>w,$I:()=>T,Ep:()=>ae,Ez:()=>Z,$g:()=>oe});n(16280);var o=()=>n(805952),i=()=>n(857639),r=()=>n(206267),s=()=>n(229833),a=()=>n(763824),c=()=>n(720665),l=()=>n(671593),d=()=>n(780054),u=()=>n(185982),p=()=>n(909557),m=()=>n(165121),f=()=>n(351360);const g=!1;var v=()=>n(908006),h=()=>n(989423),S=()=>n(508496);function y(e,t){v().default.afterNextFlush((()=>{S().default.checkGate({gateName:"audio_processor_client_send_request_metric_enabled"})&&h().vd(e,"audio_processor.client.send_request",t)}))}var b=()=>n(99874);const k="transcription",w="vad",A="rate_limited",x="forbidden",C="openai_error",T=(0,n(827380).A)(),_=async()=>Promise.all([n.e(2681),n.e(36733)]).then(n.bind(n,99874)),I=!1,B=90*c().TD;function D(e){return{_id:e,charactersSent:0,requestsSent:0,requestsTimedOut:0,responsesReceivedWithoutHandlers:0,successfulResponsesReceived:0,unsuccessfulResponsesReceived:0,invalidMessagesReceived:0,notificationsReceived:0,messagesReceived:0}}const R=new(n(999752).O)(20),M=new Map,E=(Date.now(),"audioProcessorInternals"),j=new(i().BatchedLogger)({from:E,type:"BulkDebug",level:"info",maxLength:250,logToConsole:I});let q,P=0,O=0,F=0,N=0,z=D(0),$=null,L=null,U=null,K=0,W=n(882362).u,J=!1,Q="uninitialized";const V=!0;function G(e){j.log({level:"info",from:E,type:e})}function X(){q=function(e){var t;const n=null==e||null===(t=e.socket)||void 0===t||null===(t=t.transport)||void 0===t||null===(t=t.query)||void 0===t?void 0:t.transport;if("websocket"===n||"polling"===n)return n}(this),G(`ping:${q}`),$=Date.now(),le(`Incoming primus ping received from server via ${q}.`)}function Y(){return{...R.getStats()}}function H(e){switch(j.log({level:"info",from:E,type:"readyStateChange",data:{message:e}}),U=Date.now(),e){case"end":Q="closed";break;case"open":Q="open";break;case"opening":Q="opening"}}const Z=n(496603).Bj((e=>async function(e){if(g)return;P+=1;const{createClient:t}=await _(),o=t({minReconnectDelayMs:.5*c().TD,maxReconnectDelayMs:2*c().TD});return o.on("data",re),o.on("open",(()=>{m().A.setState("connected"),G("open"),z=D(z._id+1),I&&function(){const e=Date.now(),t=20;function n(){const o=Y();if(0===o.queue&&0===o.running)return le(`Queues emptied after ${Date.now()-e} ms`),void(ee=void 0);ee=window.setTimeout(n,t)}ee&&window.clearTimeout(ee),le("Starting measurement of time until send queues are empty."),n()}()})),o.on("reconnected",(e=>{var t;(t=null==e?void 0:e.duration)&&t>1e4?ne():J=!1,j.log({level:"info",from:E,type:"reconnected",data:{message:`Reconnected in ${null==e?void 0:e.duration} ms`}})})),o.on("reconnect",(()=>{G("reconnect")})),o.on("reconnect scheduled",(e=>{(void 0===(null==e?void 0:e.attempt)||void 0===(null==e?void 0:e.duration)||e.attempt>2||e.duration>5e3||void 0===m().A.state)&&m().A.setState("disconnected"),j.log({level:"info",from:E,type:"reconnect scheduled",data:{message:`Reconnecting in ${null==e?void 0:e.scheduled} ms, attempt ${null==e?void 0:e.attempt} of ${null==e?void 0:e.retries}`}})})),o.on("reconnect timeout",(()=>{G("reconnect timeout")})),o.on("reconnect failed",(()=>{G("reconnect failed")})),o.on("timeout",(()=>{G("timeout")})),o.on("destroy",(()=>{G("destroy")})),o.on("close",(()=>{G("close")})),o.on("online",(()=>{G("online")})),o.on("offline",(()=>{G("offline")})),o.on("error",(e=>{let t;t="TransportError"===e.type?{level:"info",from:E,type:"primusTransportError",error:(0,s().n6)(e)}:{level:"error",from:E,type:"unknownPrimusError",error:(0,s().n6)(e)};(0,n(745875).rQ)(1)&&i().rateLimitedLog(t),j.log(t),F+=1})),o.on("incoming::ping",X),o.on("readyStateChange",H),o.on("end",(()=>{G("end"),o.off("readyStateChange",H),O+=1,se(o,e)})),window.__primusClient_audioProcessor=o,o}(e)),(function(){return"primus_audioProcessor"}));let ee,te;function ne(){var e;J=!1,R.cancel(),function(){for(const e of M.values())window.clearTimeout(e.timeout);M.clear()}(),null===(e=te)||void 0===e||e()}async function oe(e){var t,n;const{base64Audio:o,environment:i,language:r}=e,s=null===(t=f().default.state.currentUserStore)||void 0===t?void 0:t.id,a=null===(n=f().default.state.currentSpaceStore)||void 0===n?void 0:n.id;var c;if(s&&a)return await(null===(c=ie({method:"audioData",request:{base64Audio:o,language:r,userId:s,spaceId:a},environment:i}))||void 0===c?void 0:c.response);{const e=s||a?s?"Space":"User":"Both";return await(0,u().stopDictation)({environment:i,error:new(p().eY)(e),from:"missing_user_or_space"})}}function ie(e){if(g)return;const{method:t,request:n,environment:o}=e;y(o,{status:"enqueued",endpoint:t});const i=R.enqueue((()=>{var i;const s=r().JW();!function(e,t){v().default.afterNextFlush((()=>{S().default.checkGate({gateName:"audio_processor_client_send_request_metric_enabled"})&&(h().vd(e,"audio_processor.client.send_request.queue_running_size",{value:t.running}),h().vd(e,"audio_processor.client.send_request.queue_backup_size",{value:t.queue}))}))}(o,R.getStats());const c=a().yX(),l=Date.now(),u=V?window.setTimeout((()=>{"open"===Q&&(z.requestsTimedOut+=1,j.log({level:"info",from:E,type:"requestTimeout",data:{requestId:s,time:Date.now()-l}}))}),B):void 0;M.set(s,{resolve:c.resolve,reject:c.reject,timeout:u,sendTime:l}),j.log({level:"info",from:E,type:"requestSent",data:{requestId:s,method:t}});const p={type:`${d().A.audioProcessor.api}/${t}`,requestId:s,...n};return z.requestsSent+=1,async function(e){const{message:t,environment:n}=e,o=JSON.stringify(t);z.charactersSent+=o.length,K<o.length&&(K=o.length);const i=await Z(n);null==i||i.write(t)}({message:p,environment:o}),null===(i=e.onRequestSent)||void 0===i||i.call(e),c.promise.then((e=>{y(o,{status:"success",endpoint:t})})).catch((e=>{const n=R.getStats();y(o,{status:"failure",endpoint:t,queue_running_size:n.running,queue_backup_size:n.queue})})),c.promise}));return{response:i.catch((e=>{e instanceof ce&&!J?(J=!0,N+=1,G("connectionResetDueToFailedRequest"),Z(o).then((e=>{null==e||e.end()})),le(`sendRequest() for ${t} returned server error (${e.message}), resetting connection`,n)):le(`sendRequest() cancelled or errored for ${t} (${e.message})`,n)})),asyncQueuePromise:i}}function re(e){z.messagesReceived+=1;const t=(0,l().tf)(o().hX,e);if(t)return z.invalidMessagesReceived+=1,void i().rateLimitedLog({level:"warning",from:E,type:"ValidationError",data:{miscDataToConvertToString:e},error:(0,s().n6)(t)});const n=e;switch(n.type){case"response":{var r;const{requestId:e,status:t,result:o}=n,i=M.get(e);if(M.delete(e),j.log({level:"info",from:E,type:"responseReceived",data:{requestId:e,response:t,time:i&&Date.now()-i.sendTime,internalProcessingTimeMs:null===(r=n.result)||void 0===r?void 0:r.internalProcessingTimeMs}}),!i)return void(z.responsesReceivedWithoutHandlers+=1);L=Date.now(),window.clearTimeout(i.timeout),"ok"===t?(z.successfulResponsesReceived+=1,i.resolve(o)):(z.unsuccessfulResponsesReceived+=1,i.reject(new ce(o)));break}case"transcription":T.emit(k,n);break;case"vad":T.emit(w,n);break;case"rate_limited":T.emit(A,n);break;case"forbidden":T.emit(x,n);break;case"openai_error":T.emit(C,n)}}function se(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var o,r;n&&i().log({level:"info",from:E,type:"audioProcessorEnd",error:{message:`SocketId: ${null==e||null===(o=e.socket)||void 0===o?void 0:o.id} Query:${null==e||null===(r=e.transport)||void 0===r?void 0:r.query}`}});W.setTimeout((()=>{void 0!==e&&e.destroy()}),0),Z.cache.clear(),ne(),n&&W.setTimeout((()=>{Z(t)}),2*c().TD)}async function ae(e){if(e&&Z.cache.has("primus_audioProcessor")){const t=await Z(e);if(t){const n={type:`${d().A.audioProcessor.api}/destroySession`,requestId:r().JW()};t.write(n),t.removeAllListeners("end"),se(t,e,!1),(0,b().generateNewClientSessionId)()}}}class ce extends Error{constructor(e){super(e),this.name="FailedAudioProcessorRequestError"}}function le(){if(I){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];console.info("audioProcessorInternals:",...t)}}},376746:(e,t,n)=>{n.r(t),n.d(t,{maybeResumeTranscriptionOnLoad:()=>p,removeTranscribingBlockId:()=>u,saveTranscribingBlockIdThrottled:()=>d});var o=()=>n(763884),i=()=>n(179034),r=()=>n(271380),s=()=>n(351360),a=()=>n(630116),c=()=>n(964345);function l(e,t,n){return`${e}:${t}:${n}`}const d=n(496603).nF((function(e,t){var n;const i=null===(n=s().default.state.currentUserStore)||void 0===n?void 0:n.id;if(!i)return;const r=Date.now();o().A.set({userId:i,key:"currently-transcribing-block-id",value:l(e,t,r)})}),5e3,{leading:!0});function u(){var e;const t=null===(e=s().default.state.currentUserStore)||void 0===e?void 0:e.id;t&&o().A.remove({userId:t,key:"currently-transcribing-block-id"})}async function p(e,t){const n=function(){var e;const t=null===(e=s().default.state.currentUserStore)||void 0===e?void 0:e.id;if(!t)return;const n=o().A.get({userId:t,key:"currently-transcribing-block-id"});if(u(),!n)return;const[i,r,a]=n.split(":");if(!i||!r||!a)return;if(Date.now()-parseInt(a)>6e4)return;const c={blockId:i,spaceId:r};return c}();if(!n)return;const{blockId:l,spaceId:d}=n;await s().default.waitUntil((()=>void 0!==s().default.state.currentSpaceStore));const p=new(a().Bv)(e,{id:l,table:i().ev,spaceId:d});await p.load(),p.isTranscriptionBlock()&&p.id===t.id&&p.pathIsAccessibleAndAlive()&&!c().gZ.state&&await(0,r().startTranscription)({environment:e,blockStore:p})}},378347:(e,t,n)=>{n(746518)({target:"Object",stat:!0},{hasOwn:n(39297)})},388182:(e,t,n)=>{n.d(t,{A:()=>o});const o=n(757695).default.createValue({open:!1},{name:"ConfirmOverwriteModalStore"})},426175:(e,t,n)=>{n.d(t,{Ay:()=>u,U6:()=>s,X8:()=>l,dc:()=>d,dq:()=>r});n(944114),n(898992),n(354520),n(672577),n(908872);var o=()=>n(496506),i=()=>n(673903);const r="audioinput",s="audiooutput";class a extends(()=>n(757695))().default{async updateMediaDevices(){try{const e=await async function(){const e=(0,i().E)();return(await e.enumerateDevices()).reduce(((e,t)=>{if(t.kind&&t.label&&t.deviceId&&t.groupId)switch(t.kind){case"videoinput":e.videoInput.push(t);break;case r:e.audioInput.push(t);break;case s:e.audioOutput.push(t)}return e}),{videoInput:[],audioInput:[],audioOutput:[]})}();this.setState(e)}catch{}}constructor(){super();try{(0,i().E)().addEventListener("devicechange",(()=>{this.updateMediaDevices()}))}catch{}n(927648).Ay.addListener((()=>{this.updateMediaDevices()}))}getInitialState(){return{videoInput:[],audioInput:[],audioOutput:[]}}}const c=new a,l=new(o().default)((()=>{var e,t;return(null===(e=c.state)||void 0===e||null===(e=e.audioInput)||void 0===e||null===(t=e.filter)||void 0===t?void 0:t.call(e,(e=>null==e?void 0:e.label)))??[]}),{debugName:"AudioInputDevicesStore"}),d=new(o().default)((()=>{var e;const t=n(964576).A.state,o=null===(e=n(524007).A.state)||void 0===e?void 0:e.label,i=l.state.find((e=>e.label===o));return t||(i||l.state[0])}),{debugName:"SelectedAudioInputDeviceStore"}),u=c},431895:(e,t,n)=>{n.d(t,{MZ:()=>m,Rs:()=>g,fp:()=>p});n(296540);var o=()=>n(959013),i=()=>n(449506),r=()=>n(435009),s=()=>n(812182),a=()=>n(597755),c=()=>n(112799),l=()=>n(434165),d=()=>n(673903),u=n(474848);async function p(e){const t=await(0,l().P)(e);return t.nativePlatform?!(!t.microphone||!t.systemAudio)||(s().HK({presentationType:"persistent",id:"transcription_permissions_toast",title:(0,u.jsx)(o().sA,{id:"transcriptionPermissionActions.transcriptionPermissionsRequired.title",defaultMessage:"Permissions Required"}),message:(0,u.jsx)(o().sA,{id:"transcriptionPermissionActions.transcriptionPermissionsRequired.message",defaultMessage:"To begin transcription, you must allow access to your microphone and screen."}),actions:{primary:{title:"Grant permissions",onAction:()=>{s().UW("transcription_permissions_toast")}},secondary:{title:(0,u.jsx)(o().sA,{id:"transcriptionPermissionActions.transcriptionPermissionsRequired.secondaryAction",defaultMessage:"Ignore"}),onAction:()=>{s().UW("transcription_permissions_toast")}}}}),!1):(function(e){s().HK({presentationType:"persistent",id:"transcription_browser_toast",title:(0,u.jsx)(o().sA,{id:"transcriptionPermissionActions.transcriptionAppRequired.title",defaultMessage:"Notion app required"}),message:(0,u.jsx)(o().sA,{id:"transcriptionPermissionActions.transcriptionAppRequired.message",defaultMessage:"To begin transcription, you must use the Notion app."}),actions:{primary:{title:(0,u.jsx)(o().sA,{id:"transcriptionPermissionActions.transcriptionAppRequired.primaryAction",defaultMessage:"Download app"}),onAction:async()=>{await m(e),s().UW("transcription_browser_toast")}},secondary:{title:(0,u.jsx)(o().sA,{id:"transcriptionPermissionActions.transcriptionAppRequired.secondaryAction",defaultMessage:"Ignore"}),onAction:()=>{s().UW("transcription_browser_toast")}}}})}(e),!1)}async function m(e){const t=e.device.os;if("mac"!==t&&"windows"!==t)return void(await f(e));const n=await i().callApi({eventName:"getDesktopAppRegistration",environment:e,data:{os:t}});"data"in n&&n.data.isRegistered?await r().eG({environment:e,url:(0,a().P)(window.location.href)}):await f(e)}async function f(e){const t=await(0,c().a)(e.device);t&&r().oo({environment:e,url:t,openInNew:"tab"})}async function g(e){await async function(){const e=(0,d().E)(),t=await e.getUserMedia({audio:!0});for(const n of t.getTracks())n.stop()}(),e.device.isMobile||await async function(){const e=(0,d().E)(),t=await e.getDisplayMedia({audio:!0,systemAudio:"include"});for(const n of t.getTracks())n.stop()}()}},434165:(e,t,n)=>{n.d(t,{C:()=>s,P:()=>r});n(898992),n(737550);var o=()=>n(673903),i=()=>n(426175);async function r(e){const t=(0,o().E)(),n=await t.enumerateDevices(),r=n.some((e=>e.kind===i().dq)),s=n.some((e=>e.kind===i().U6));return{nativePlatform:e.device.isElectron||e.device.isMobileNative,microphone:r,systemAudio:e.device.isMobile||s,loading:!1}}function s(e){return!!e.loading||e.nativePlatform&&e.microphone&&e.systemAudio}},497663:(e,t,n)=>{n.d(t,{e5:()=>f,op:()=>g,ul:()=>m});n(296540);var o=()=>n(959013),i=()=>n(436572),r=()=>n(972435),s=()=>n(914649),a=n(474848);const c=(0,o().YK)({dictationError:{id:"dictation.generic.snackbar.error",defaultMessage:"Dictation failed. Please try again."}});function l(){return(0,a.jsx)(o().sA,{defaultMessage:"No microphone permission. Allow access to your microphone in system settings",id:"dictation.permission.microphone.snackbar.error"})}function d(){return(0,a.jsx)(o().sA,{defaultMessage:"No microphone available. Connect your microphone in system settings",id:"dictation.unavailable.microphone.snackbar.error"})}function u(){return(0,a.jsx)(o().sA,{defaultMessage:"An unknown error occurred when trying to access the microphone.",id:"dictation.permission.unknown.snackbar.error"})}function p(){return(0,a.jsx)(o().sA,{defaultMessage:"Audio usage limit reached. Try again later.",id:"dictation.usage.snackbar.error"})}s().JS,s().rP,s().JC;function m(e){e===s().JS?i().Kp({item:{label:(0,a.jsx)(l,{})}}):e===s().rP?i().Kp({item:{label:(0,a.jsx)(d,{})}}):i().Kp({item:{label:(0,a.jsx)(u,{})}})}function f(){i().D6({label:(0,a.jsx)(p,{})})}function g(){i().D6({label:r().A.formatMessage(c.dictationError)})}},524007:(e,t,n)=>{n.d(t,{A:()=>i});class o extends(()=>n(757695))().default{constructor(){super()}getInitialState(){}}const i=new o},540144:(e,t,n)=>{n.d(t,{Fz:()=>u,I8:()=>d,Ql:()=>l,lk:()=>a,pg:()=>c,y1:()=>s});n(944114),n(898992),n(354520),n(672577);var o=()=>n(919709),i=()=>n(534177),r=()=>n(299545);function s(e,t){const n=e.getContentStores(),o=(()=>{const n=e.getFormat();switch(t){case"transcript":return null==n?void 0:n.transcription_transcript_id;case"notes":return null==n?void 0:n.transcription_notes_id;case"summary":return null==n?void 0:n.transcription_summary_id;default:return(0,i().HB)(t)}})();if(o)return n.find((e=>e.id===o))}function a(e){const t=s(e,"transcript");if(!t)return!1;const n=t.getContentStores().filter((e=>!e.isEmptyTitle()&&e.pathIsAccessibleAndAlive()));return n.length>0}function c(e){const t=s(e,"transcript");if(!t)return!1;let n="";const i=t.getContentStores().filter((e=>!e.isEmptyTitle()&&e.pathIsAccessibleAndAlive()));for(const r of i){const e=r.getTitleValue();if(n+=(0,o().k4p)(e),n.length>300)return!0}return!1}function l(e,t){const n=t??[];e.isType("transcription")&&n.push(e);const o=e.getContentStores();for(const i of o)l(i,n);return n}function d(e){const t=[];for(const n of p({blockStore:e.blockStore}))t.push(n);return t}function u(e){for(const t of p({blockStore:e.blockStore}))return!0;return!1}function*p(e){const{blockStore:t}=e,n=t.getNavigableBlockStore();if(!n)return;const o=(0,r().zo)({blockStore:n,transclusionReferences:"omit",childPages:"omit"});for(const i of o){const e=i.getFormatStore();(null==e?void 0:e.getKeyValue("created_by_transcription_block_id"))===t.id&&(yield i)}}},541235:(e,t,n)=>{n.d(t,{YD:()=>r,c$:()=>o,q_:()=>i});const o={"sprints-onboarding":{steps:[{id:"current-sprint-view-tooltip"},{id:"sprint-task-tooltip"},{id:"complete-sprint-button-tooltip"}]},"enhanced-qna-onboarding":{steps:[{id:"find-in-tooltip"},{id:"mention-tooltip"}]},"jira-sync-onboarding":{steps:[{id:"all-projects-tooltip"},{id:"all-issues-tooltip"},{id:"database-views-and-filters-tooltip"},{id:"settings-to-setup-projects-and-issues"}]},"project-management-import-onboarding":{steps:[{id:"your-teamspace-tooltip"},{id:"all-projects-tooltip"},{id:"navigate-to-project-tasks-tooltip"},{id:"project-customization-tooltip"},{id:"related-tasks-database-views-tooltip"}]},"ai-comment-onboarding":{steps:[{id:"ai-comment-onboarding-tooltip"}]}},i="completed",r="dismissed"},577579:(e,t,n)=>{n.d(t,{Z:()=>p});n(581454),n(296540);var o=()=>n(484714),i=()=>n(56366),r=()=>n(805952),s=()=>n(760217),a=()=>n(939740),c=()=>n(89924),l=()=>n(38337),d=()=>n(632503),u=n(474848);function p(e){const t=(0,o().v3)(),{parent:n}=e,p=(0,i().K8)((()=>Object.keys(r().Cu).indexOf((0,d().FT)(t.currentUser.id))),[t.currentUser.id]),m=[{key:"languages",render:e=>(0,u.jsx)(c().A,{...e,topBorder:0!==e.index}),items:(0,d().u1)().map((e=>{let[o,[i]]=e;const r={key:o,render:e=>(0,u.jsx)(s().A,{...e,title:i}),action:()=>{(0,d().Xy)(t,o),n.close()}};return r}))}];return(0,u.jsx)("div",{className:l().OLz,style:{display:"flex",flexDirection:"column",width:150},children:(0,u.jsx)(a().Ay,{type:a().Oh.Vertical,initialFocus:p,sections:m})})}},595345:(e,t,n)=>{n.d(t,{$g:()=>o().$g,qY:()=>i().getCurrentClientSessionId});var o=()=>n(317027),i=()=>n(99874)},632503:(e,t,n)=>{n.d(t,{$q:()=>d,FT:()=>v,Xy:()=>g,u1:()=>l});n(378347);var o=()=>n(805952),i=()=>n(763884),r=()=>n(209199),s=()=>n(595345),a=()=>n(351360),c=()=>n(233124);function l(){return Object.entries(o().Cu)}function d(e){return o().Cu[e][1]}function u(e){switch(e){case"en-US":default:return"English";case"de-DE":return"German";case"ko-KR":return"Korean";case"zh-CN":case"zh-TW":return"Chinese";case"ja-JP":return"Japanese";case"es-ES":case"es-LA":return"Spanish";case"pt-BR":return"Portuguese";case"fr-FR":return"French";case"da-DK":return"Danish";case"fi-FI":return"Finnish";case"nb-NO":return"Norwegian";case"nl-NL":return"Dutch";case"sv-SE":return"Swedish"}}class p extends(()=>n(757695))().default{constructor(){super(),this.lastLocalStorageRetrieval=void 0}syncLocalStorageIfNecessary(e){if(!this.lastLocalStorageRetrieval||e!==this.lastLocalStorageRetrieval[0]||Date.now()-this.lastLocalStorageRetrieval[1]>30*n(720665).TD){this.lastLocalStorageRetrieval=[e,Date.now()];const n=i().A.get({userId:e,key:f});if(Object.hasOwn(o().Cu,n))this.state!==n&&this.setState(n);else{var t;const n=u((null===(t=a().default.state.currentUserSettingsStore)||void 0===t||null===(t=t.getSettings())||void 0===t?void 0:t.preferred_locale)??r().q);n!==this.state&&this.setState(n),i().A.set({userId:e,key:f,value:this.state})}}}getInitialState(){var e;return u((null===(e=a().default.state.currentUserSettingsStore)||void 0===e||null===(e=e.getSettings())||void 0===e?void 0:e.preferred_locale)??r().q)}}const m=new p,f="DictationLanguage";function g(e,t){(0,c().K_)(e,{from_language:m.state,to_language:t,dictation_session_id:(0,s().qY)()}),m.setState(t),i().A.set({userId:e.currentUser.id,key:f,value:t})}function v(e){return m.syncLocalStorageIfNecessary(e),m.state}},673903:(e,t,n)=>{n.d(t,{E:()=>o,G:()=>i});n(16280);function o(){const e=navigator.mediaDevices;if(e instanceof MediaDevices)return e;throw new Error("Media devices unavailable in current context.")}function i(e){const t=window.AudioContext||window.webkitAudioContext||!1;var n;if(Boolean(t))return new t({...(null===(n=navigator)||void 0===n||null===(n=n.mediaDevices)||void 0===n?void 0:n.getSupportedConstraints().sampleRate)&&{sampleRate:e}});throw new Error("Browser does not support Web Audio API (AudioContext is not available).")}},739135:(e,t,n)=>{n.d(t,{KD:()=>l,gt:()=>d,i9:()=>c,ll:()=>s,tb:()=>a,x$:()=>r});var o=()=>n(541235),i=()=>n(496603);function r(e,t){return s(d(e,t))}function s(e){return void 0!==e&&(e===o().q_||e===o().YD)}function a(e,t){if(s(t))return;const n=o().c$[e],i=n.steps.findIndex((e=>e.id===t));return-1===i?n.steps[0].id:i===n.steps.length-1?o().q_:n.steps[i+1].id}function c(e,t){const n=d(e,t);if(n&&!s(n))return a(t,n)}function l(e,t){const n=d(e,t);if(n)return function(e,t){const n=o().c$[e];var r;if(s(t))return null===(r=(0,i().HV)(n.steps))||void 0===r?void 0:r.id;const a=n.steps.findIndex((e=>e.id===t));return-1!==a&&0!==a?n.steps[a-1].id:void 0}(t,n)}function d(e,t){var n;if(!e)return;const i=((null===(n=e.getSettings())||void 0===n?void 0:n.tutorials)||{})[t];return void 0===i?o().c$[t].steps[0].id:i}},784749:(e,t,n)=>{n.d(t,{J:()=>A,w:()=>x});n(581454);var o=n(296540),i=()=>n(484714),r=()=>n(56366),s=()=>n(401497),a=()=>n(742117),c=()=>n(133033),l=()=>n(413267),d=()=>n(284371),u=()=>n(493823),p=()=>n(760217),m=()=>n(406699),f=()=>n(939740),g=()=>n(89924),v=()=>n(614415),h=()=>n(645873),S=()=>n(426175),y=()=>n(524007),b=()=>n(632503),k=()=>n(577579),w=n(474848);function A(e){const{languagePopupStore:t}=e,n=(0,i().v3)(),l=(0,r().K8)((()=>(0,b().FT)(n.currentUser.id)),[n.currentUser.id]);(0,o.useEffect)((()=>{S().Ay.updateMediaDevices()}),[]);const p=(0,s().IS)((e=>({container:{padding:"8px 0px",display:"flex",flexDirection:"column",alignItems:"flex-start",width:300,gap:8},microphoneText:{marginLeft:12,fontSize:12,fontWeight:d().Wy.medium,color:e.text.secondary},microphoneSection:{display:"flex",flexDirection:"column",width:"100%"},languageText:{fontSize:14,color:e.text.primary},languageSection:{padding:"0px 14px",display:"flex",alignItems:"center",width:"100%",justifyContent:"space-between"},rightChevronStyle:{width:13,height:13,opacity:.5,color:e.icon.secondary},line:{width:"100%",height:1,backgroundColor:e.icon.tertiary,opacity:.3},languageButtonStyle:{fontSize:14,display:"flex",alignItems:"center",gap:10,color:e.text.secondary},helpSection:{padding:"5px 14px",display:"flex",alignItems:"center",justifyContent:"flex-start",gap:4,cursor:"pointer"},helpText:{fontSize:12,color:e.text.tertiary},helpIcon:{width:16,height:16,color:e.icon.tertiary}})),[]),f=(0,o.useMemo)((()=>(0,a().V)(p.rightChevronStyle)),[p.rightChevronStyle]),g=(0,o.useMemo)((()=>(0,c().$)(p.helpIcon)),[p.helpIcon]),{value:y}=(0,h().fJ)(v().fM);if(!y)return null;const{motion:A}=y;return(0,w.jsxs)("div",{style:p.container,children:[(0,w.jsxs)("div",{style:p.microphoneSection,children:[(0,w.jsx)("div",{style:p.microphoneText,children:"Microphone"}),(0,w.jsx)(x,{})]}),(0,w.jsx)("div",{style:p.line}),(0,w.jsxs)("div",{style:p.languageSection,children:[(0,w.jsx)("div",{style:p.languageText,children:"Language"}),(0,w.jsx)(m().Ay,{buttonPopupStore:t,renderOrigin:e=>(0,w.jsxs)(u().p,{style:p.languageButtonStyle,...e,children:[l," ",f]}),stopClickPropagation:!0,popupType:m().z7.Popup,render:e=>(0,w.jsx)(k().Z,{parent:e})})]}),(0,w.jsx)("div",{style:p.line}),(0,w.jsxs)(A.div,{style:p.helpSection,onClick:()=>window.open("https://www.notion.so/help/audio-dictation","_blank"),variants:{hover:{opacity:.6},tap:{opacity:1}},whileHover:"hover",whileTap:"tap",transition:{duration:.2},children:[g,(0,w.jsx)("div",{style:p.helpText,children:"Learn about Dictation"})]})]})}function x(){const e=(0,r().O$)(S().X8),t=(0,r().O$)(S().dc),n=(0,r().K8)((()=>e.findIndex((e=>e.deviceId===(null==t?void 0:t.deviceId)))),[e,t]),o=[{key:"devices",render:e=>(0,w.jsx)(g().A,{...e,topBorder:0!==e.index}),items:e.map((e=>({key:e.deviceId,render:n=>(0,w.jsx)(p().A,{...n,title:e.label,right:e.deviceId===(null==t?void 0:t.deviceId)?(0,l().b)({width:14,height:14}):void 0}),action:()=>{y().A.setState(e)}})))}];return(0,w.jsx)("div",{style:{display:"flex",flexDirection:"column",width:"100%"},children:(0,w.jsx)(f().Ay,{type:f().Oh.Vertical,initialFocus:n,sections:o})})}},805952:(e,t,n)=>{n.d(t,{Cu:()=>i,hX:()=>l});n(581454);var o=()=>n(638681);const i={English:["English","en"],Chinese:["Chinese","zh"],Spanish:["Spanish","es"],French:["French","fr"],German:["German","de"],Japanese:["Japanese","ja"],Korean:["Korean","ko"],Portuguese:["Portuguese","pt"],Russian:["Russian","ru"],Thai:["Thai","th"],Vietnamese:["Vietnamese","vi"],Danish:["Danish","da"],Finnish:["Finnish","fi"],Norwegian:["Norwegian","no"],Dutch:["Dutch","nl"],Swedish:["Swedish","sv"]},r=o().union([o().number(),o().string(),o().boolean(),o().isNull(),o().array(o().string())]),s=o().undefinable(r),a=(o().union([r,o().record(o().string(),r)]),o().union([s,o().record(o().string(),s)])),c=(o().union([a,o().record(o().string(),a)]),o().union([o().object({required:{id:o().string(),status:o().literal("pending"),audioDuration:o().number()},optional:{}}),o().object({required:{id:o().string(),status:o().literal("complete"),text:o().string(),audioDuration:o().number()},optional:{}}),o().object({required:{id:o().string(),status:o().literal("error"),reason:o().string(),audioDuration:o().number()},optional:{}}),o().object({required:{id:o().string(),status:o().literal("ignore"),audioDuration:o().number()},optional:{}})])),l=o().union([o().object({required:{type:o().literal("transcription"),audioSessionId:o().string(),segmentId:o().string(),transcription:c,isSegmentComplete:o().boolean(),isAudioSessionComplete:o().boolean()},optional:{}}),o().object({required:{type:o().literal("response"),status:o().literals("ok","error"),requestId:o().string(),result:o().any()},optional:{}}),o().object({required:{type:o().literal("vad"),talking:o().boolean()},optional:{}}),o().object({required:{type:o().literal("rate_limited"),status:o().literal(429),name:o().literal("UserRateLimitResponse"),message:o().string()},optional:{}}),o().object({required:{type:o().literal("forbidden"),status:o().literal(403),name:o().literal("ForbiddenError"),message:o().string()},optional:{}}),o().object({required:{type:o().literal("openai_error"),message:o().string()},optional:{status:o().number()}})]);o().object({required:{base64Audio:o().string(),userId:o().string(),spaceId:o().string()},optional:{language:o().literals(...Object.values(i).map((e=>{let[t,n]=e;return n})))}}),o().object({required:{},optional:{}}),o().object({required:{userId:o().string(),spaceId:o().string()},optional:{language:o().literals(...Object.values(i).map((e=>{let[t,n]=e;return n})))}}),o().object({required:{},optional:{}}),o().object({required:{},optional:{}}),o().object({required:{},optional:{}}),o().object({required:{},optional:{}}),o().object({required:{},optional:{}})},909557:(e,t,n)=>{n.d(t,{E6:()=>s,Rv:()=>r,XG:()=>i,d1:()=>o,eY:()=>a});n(16280);class o extends Error{constructor(e){super(e),this.name="DictationAudioRecorderFailedError"}}class i extends Error{constructor(e){super(e),this.name="DictationRateLimitError"}}class r extends Error{constructor(e){super(e),this.name="DictationForbiddenError"}}class s extends Error{constructor(e,t){super(e),this.status=void 0,this.status=t,this.name="DictationOpenAIError"}}class a extends Error{constructor(e){super(e),this.name="DictationMissingUserOrSpaceError"}}},927648:(e,t,n)=>{n.d(t,{Ay:()=>u,a3:()=>r});n(16280);var o=()=>n(497663);const i="initial",r="allowed",s="denied",a="no_devices",c="insecure_context",l="unknown_error";class d extends(()=>n(757695))().default{async checkPermissions(){const e=await d.checkAudioPermissionsThrottled();return this.setState(e),e}getInitialState(){return window.isSecureContext?i:c}}d.checkAudioPermissionsThrottled=(0,n(496603).nF)((async()=>{if(!window.isSecureContext)return c;try{const e=(0,n(673903).E)();return function(e){for(const t of e.getTracks())t.stop()}(await e.getUserMedia({video:!1,audio:!0})),r}catch(e){if(e instanceof Error)switch(e.name){case"NotAllowedError":return(0,o().ul)(s),s;case"NotFoundError":case"OverconstrainedError":return(0,o().ul)(a),a}return(0,o().ul)(l),l}}),1e3);const u=new d},964576:(e,t,n)=>{n.d(t,{A:()=>i});class o extends(()=>n(757695))().default{constructor(){super()}getInitialState(){}}const i=new o},986850:(e,t,n)=>{e.exports=n.p+"dbc10b469ee58d20.js"}}]);