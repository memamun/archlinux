"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[21627],{621627:(e,t,n)=>{n.d(t,{$:()=>_e});var r=n(296540),i=()=>n(852507),a=()=>n(56366),o=()=>n(390527),s=()=>n(463830),d=()=>n(104636),u=(n(944114),()=>n(244641)),c=()=>n(484714),l=()=>n(401497),m=()=>n(668725),y=()=>n(402390),h=()=>n(959013),p=()=>n(496603),f=()=>n(534177),g=()=>n(284371),x=()=>n(84817),b=()=>n(760217),k=()=>n(406699),w=()=>n(113474),j=()=>n(805751),M=()=>n(928600),v=()=>n(678553),S=()=>n(939740),A=()=>n(864943),R=()=>n(89924),T=()=>n(573351),_=()=>n(186445),C=()=>n(781697),O=n(474848);function B(e){const{onChange:t,currentValue:i,extraValidation:a,...o}=e,[s,d]=(0,r.useState)(!1),[u,c]=(0,r.useState)((null==i?void 0:i.toString())??""),l=e=>!(0,f().O9)(a)||a(e);return(0,O.jsx)(n(623580).A,{errorOutline:s,onKeyDown:e=>{if(("ArrowUp"===e.key||"ArrowDown"===e.key)&&(e.preventDefault(),e.stopPropagation(),(0,f().O9)(i))){const n="ArrowUp"===e.key?1:-1,r=i+n;l(r)&&(t(r),c(r.toString()))}},value:u,onChange:e=>{const n=e.currentTarget.value;if(c(n),""===n)t(void 0),d(!1);else{const n=Number(e.currentTarget.value);l(n)?(t(n),d(!1)):(t(void 0),d(!0))}},...o})}const E=(0,h().YK)({never:{id:"automations.RecurrenceEditor.endConditionMenu.never",defaultMessage:"Never"},numberOfRuns:{id:"automations.RecurrenceEditor.endConditionMenu.numberOfRuns",defaultMessage:"Number of runs"},specificDate:{id:"automations.RecurrenceEditor.endConditionMenu.specificDate",defaultMessage:"Specific date"}});function W(e){const{currentValue:t,onChange:n}=e,i=(0,C().e)({minWidth:230}),a="number"===(null==t?void 0:t.type)?t.number_of_occurrences:void 0,[o,s]=(0,r.useState)(a??1),d=[{key:"never",items:[{key:"never",action:()=>{n(void 0)},render:e=>(0,O.jsx)(b().A,{...e,title:(0,O.jsx)(h().sA,{...E.never}),checkState:void 0===t})}],render:e=>(0,O.jsx)(R().A,{...e})},{key:"number_of_occurrences",items:[{key:"number_of_occurrences",action:()=>{n({type:"number",number_of_occurrences:o})},render:e=>(0,O.jsx)(I,{...e,currentNumber:a??o,onNumberChange:e=>{(0,f().O9)(e)&&(s(e),n({type:"number",number_of_occurrences:e}))},selected:"number"===(null==t?void 0:t.type)})}],render:e=>(0,O.jsx)(R().A,{topBorder:!0,...e})},{key:"date",items:[{key:"date",action:()=>{},render:t=>(0,O.jsx)(z,{...t,...e})}],render:e=>(0,O.jsx)(R().A,{topBorder:!0,...e})}];return(0,O.jsx)(M().A,{...i,children:(0,O.jsx)(S().Ay,{type:S().Oh.Vertical,sections:d,initialFocus:0})})}const I=(0,r.forwardRef)((function(e,t){const{currentNumber:n,onNumberChange:r,selected:i,...a}=e,s=(0,l().IS)((e=>({input:{maxWidth:60},menuItemTitle:{overflow:"visible"}})),[]);return(0,O.jsx)(b().A,{...a,itemMarginRight:4,ref:t,titleStyle:s.menuItemTitle,title:(0,O.jsxs)(x().Y1,{gap:"auto",direction:"horizontal",align:"center",children:[(0,O.jsx)("div",{children:(0,O.jsx)(h().sA,{...E.numberOfRuns})}),i&&(0,O.jsx)(B,{disabled:!i,currentValue:n,onChange:r,extraValidation:o().isValidRecurrenceNumberOfRuns,style:s.input,maxlength:3})]}),checkState:i})})),z=(0,r.forwardRef)((function(e,t){const{currentValue:n,onChange:i,...s}=e,d=(0,r.useMemo)((()=>u().c9.now().plus({weeks:1}).toMillis()),[]),c=(0,h().tz)(),m=(0,a().K8)((()=>_().XX.state),[]),y="date"===(null==n?void 0:n.type),p=y?n.end_at:d,[f,g]=(0,r.useState)(y);(0,r.useEffect)((()=>{!y&&f&&g(!1)}),[y,f]);const x=(0,r.useMemo)((()=>"date"===(null==n?void 0:n.type)?(0,o().getFormattedEndCondition)(n,c):void 0),[n,c]),b=(0,r.useCallback)((e=>{i({type:"date",end_at:e})}),[i]),k=(0,r.useMemo)((()=>({before:new Date})),[]),j=(0,r.useCallback)((()=>{i({type:"date",end_at:d})}),[i,d]),M=(0,l().IS)((()=>({minWidth:{minWidth:"247px"},calendarContainer:{padding:"8px 0"}})),[]),v=f||y;return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(w()._,{...s,title:(0,O.jsx)(h().sA,{...E.specificDate}),chevronType:v?"down":"right",right:x,onClick:j,style:M.minWidth}),v&&(0,O.jsx)("div",{style:M.calendarContainer,children:(0,O.jsx)(T().A,{firstDayOfWeek:m,value:p,onChange:b,disabledDays:k})})]})}));n(581454);const N=(0,h().YK)({day:{id:"automations.FrequencyMenu.day",defaultMessage:"{number, plural, one {Day} other {Days}}"},week:{id:"automations.FrequencyMenu.week",defaultMessage:"{number, plural, one {Week} other {Weeks}}"},month:{id:"automations.FrequencyMenu.month",defaultMessage:"{number, plural, one {Month} other {Months}}"},year:{id:"automations.FrequencyMenu.year",defaultMessage:"{number, plural, one {Year} other {Years}}"}}),D={day:e=>({...N.day,values:{number:e?2:1}}),week:e=>({...N.week,values:{number:e?2:1}}),month:e=>({...N.month,values:{number:e?2:1}}),year:e=>({...N.year,values:{number:e?2:1}})};function F(e){const{onSelect:t,currentFrequency:n,pluralLabels:r}=e,i=(0,C().e)(),a=[{key:"default",items:(0,f().WP)(D).map((e=>{let[i,a]=e;return{key:i,action:()=>{t(i)},render:e=>(0,O.jsx)(b().A,{...e,title:(0,O.jsx)(h().sA,{...a(r)}),checkState:n===i})}})),render:e=>(0,O.jsx)(R().A,{...e})}];return(0,O.jsx)(M().A,{...i,children:(0,O.jsx)(S().Ay,{type:S().Oh.Vertical,sections:a,initialFocus:0})})}var U=()=>n(264435);const V=(0,h().YK)({monthRestrictionLabel:{id:"automations.MonthRestrictionMenuItem.monthRestrictionLabel",defaultMessage:"On the"},last:{id:"automations.MonthRestrictionMenuItem.last",defaultMessage:"Last"},day:{id:"automations.MonthRestrictionMenuItem.day",defaultMessage:"Day"}}),L=31,Y=4,q=(0,r.forwardRef)((function(e,t){const{initialValue:n,onChange:i,startDateForFallback:a,...o}=e,s=(0,c().Y0)(),d=(0,l().IS)((e=>({menuItem:{...!s.isMobile&&{paddingTop:6,paddingBottom:8}}})),[s]),[m,y]=(p=function(e,t){const n=()=>t?{type:"day",dayNumber:u().c9.fromMillis(t).day}:K;return e?"monthdays"===e.type?1!==e.monthdays.length?n():{type:"day",dayNumber:e.monthdays[0]}:"weekdays_in_month"===e.type?1!==e.week_numbers.length||1!==e.weekdays.length?n():{type:"weekday",weekday:e.weekdays[0],weekNumber:-1===e.week_numbers[0]?"last":e.week_numbers[0]}:void(0,f().HB)(e):n()}(n,a),(0,r.useReducer)(((e,t)=>{if("change_day"===t.type)if("day"===t.newDay){if("day"===e.type)return e;if("weekday"===e.type)return{type:"day",dayNumber:"last"===e.weekNumber?1:Math.min(e.weekNumber,Y)};(0,f().HB)(e)}else{if("weekday"===e.type)return{...e,weekday:t.newDay};if("day"===e.type)return{type:"weekday",weekday:t.newDay,weekNumber:e.dayNumber>Y?"last":e.dayNumber};(0,f().HB)(e)}else if("change_number"===t.type){if("day"===e.type)return{...e,dayNumber:"last"===t.newNumber?1:t.newNumber};if("weekday"===e.type)return{...e,weekNumber:t.newNumber};(0,f().HB)(e)}else(0,f().HB)(t)}),p));var p;return function(e,t){const n=(0,r.useRef)(t);(0,r.useEffect)((()=>{n.current=t}),[t]);const i=(0,r.useRef)(!0);(0,r.useEffect)((()=>{i.current?i.current=!1:n.current(function(e){if("day"===e.type)return{type:"monthdays",monthdays:[e.dayNumber]};if("weekday"===e.type)return{type:"weekdays_in_month",weekdays:[e.weekday],week_numbers:["last"===e.weekNumber?-1:e.weekNumber]};(0,f().HB)(e)}(e))}),[e])}(m,i),(0,O.jsx)(v().A,{...o,ref:t,style:d.menuItem,title:(0,O.jsxs)(x().Y1,{gap:"auto",direction:"horizontal",align:"center",children:[(0,O.jsx)("div",{children:(0,O.jsx)(h().sA,{...V.monthRestrictionLabel})}),(0,O.jsx)(P,{state:m,dispatch:y})]})})}));function P(e){const{state:t,dispatch:n}=e,r=(0,c().Y0)(),i=(0,h().tz)(),a=Q(),o=(0,l().IS)((e=>({icon:{width:10,marginLeft:4,fill:e.icon.secondary},button:{height:28,padding:"4px 8px"}})),[]),s=X(t),d=$(t),u=r.isMobile?k().z7.SlideUp:k().z7.Popup;return(0,O.jsxs)(x().Y1,{width:"hug",direction:"horizontal",gap:6,children:[(0,O.jsx)(k().Ay,{popupType:u,render:e=>(0,O.jsx)(H,{state:t,onSelect:t=>{n({type:"change_number",newNumber:t}),e.close()}}),renderOrigin:e=>(0,O.jsxs)(A().A,{size:"lg",...e,style:o.button,children:["last"===s?(0,O.jsx)(h().sA,{...V.last}):a(s),(0,m().b)(o.icon)]})}),(0,O.jsx)(k().Ay,{popupType:u,render:e=>(0,O.jsx)(J,{state:t,onSelect:t=>{n({type:"change_day",newDay:t}),e.close()}}),renderOrigin:e=>(0,O.jsxs)(A().A,{size:"lg",...e,style:o.button,children:[G(i,d),(0,m().b)(o.icon)]})})]})}function H(e){const{state:t,onSelect:n}=e,r=(0,C().e)({maxHeight:255}),i=Q(),a=X(t),o="weekday"===t.type,s=p().oE([{key:"days",items:p().y1(1,("day"===t.type?L:"weekday"===t.type?Y:(0,f().HB)(t))+1).map((e=>({key:`day_${e}`,action:()=>n(e),render:t=>(0,O.jsx)(b().A,{...t,title:i(e),checkState:a===e})}))),render:e=>(0,O.jsx)(R().A,{...e})},o?{key:"last",items:[{key:"last",action:()=>n("last"),render:e=>(0,O.jsx)(b().A,{...e,title:(0,O.jsx)(h().sA,{...V.last}),checkState:"last"===a})}],render:e=>(0,O.jsx)(R().A,{...e,topBorder:!0})}:void 0]);return(0,O.jsx)(M().A,{...r,children:(0,O.jsx)(S().Ay,{type:S().Oh.Vertical,sections:s,initialFocus:0})})}function J(e){const{state:t,onSelect:n}=e,r=(0,h().tz)(),i=(0,C().e)(),o=$(t),s=[{key:"day",items:[{key:"day",action:()=>n("day"),render:e=>(0,O.jsx)(b().A,{...e,title:G(r,"day"),checkState:"day"===o})}],render:e=>(0,O.jsx)(R().A,{...e})},{key:"weekdays",items:(0,a().K8)((()=>1===_().XX.state?["MO","TU","WE","TH","FR","SA","SU"]:["SU","MO","TU","WE","TH","FR","SA"]),[]).map((e=>({key:`weekday_${e}`,action:()=>n(e),render:t=>(0,O.jsx)(b().A,{...t,title:G(r,e),checkState:e===o})}))),render:e=>(0,O.jsx)(R().A,{...e,topBorder:!0})}];return(0,O.jsx)(M().A,{...i,children:(0,O.jsx)(S().Ay,{type:S().Oh.Vertical,sections:s,initialFocus:0})})}const K={type:"day",dayNumber:1};function X(e){return"day"===e.type?e.dayNumber:"weekday"===e.type?e.weekNumber:void(0,f().HB)(e)}function $(e){return"day"===e.type?"day":"weekday"===e.type?e.weekday:void(0,f().HB)(e)}function Q(){const e=(0,h().tz)().locale.substring(0,2);return t=>(0,U().o4)(e,t,"d")}function G(e,t){if("day"===t)return e.formatMessage(V.day);{const n=(0,f().uv)(o().RRULE_WEEKDAYS_MAP).indexOf(t)+1;return u().c9.fromObject({weekday:n}).setLocale(e.locale).toLocaleString({weekday:"long"})}}n(898992),n(354520),n(430670);const Z=(0,h().YK)({aroundMidnight:{id:"automations.RecurTimeMenu.aroundMidnight",defaultMessage:"Around midnight"},aroundMidnightCaption:{id:"automations.RecurTimeMenu.aroundMidnightCaption",defaultMessage:"12–3AM"}});function ee(e){const{currentRecurTime:t,onRecurTimeSelected:r}=e,i=(0,h().tz)(),a=(0,C().e)(),s=[{key:"default",items:[...(0,n(963589).X)("automations_dev_tools")?[te({onRecurTimeSelected:r})]:[],...[{type:"around_midnight"},...p().y1(0,24).flatMap((e=>p().y1(0,60,15).map((t=>({type:"hour_minute",hour:e,minute:t}))))).filter((e=>{let{hour:t,minute:n}=e;return 0!==t&&1!==t&&2!==t&&!(3===t&&0===n)}))].map((e=>{if("hour_minute"===e.type){const{hour:n,minute:a}=e,o=u().c9.utc().set({hour:n,minute:a,second:0,millisecond:0}).setLocale((0,y().H)(i)).toFormat("h:mm a"),s=(null==t?void 0:t.minute)===a&&(null==t?void 0:t.hour)===n;return{key:`hour_minute-${n}-${a}`,action:()=>{r({hour:n,minute:a})},render:e=>(0,O.jsx)(b().A,{...e,title:o,checkState:s})}}if("around_midnight"===e.type){const e=(0,o().isRunningBetweenMidnightAnd3AM)(t);return{key:"around_midnight",action:()=>{r({hour:0,minute:0})},render:t=>(0,O.jsx)(b().A,{...t,title:(0,O.jsx)(h().sA,{...Z.aroundMidnight}),caption:(0,O.jsx)(h().sA,{...Z.aroundMidnightCaption}),checkState:e})}}(0,f().HB)(e)}))],render:e=>(0,O.jsx)(R().A,{...e,desktopStyle:{maxHeight:250,overflow:"scroll"}})}];return(0,O.jsx)(M().A,{...a,children:(0,O.jsx)(S().Ay,{type:S().Oh.Vertical,sections:s,initialFocus:0})})}function te(e){const{onRecurTimeSelected:t}=e;return{key:"developer",action:()=>{const e=ne();t({hour:e.hour,minute:e.minute})},render:e=>(0,O.jsx)(re,{...e})}}function ne(){const e=u().c9.local();let t=e.set({second:0,millisecond:0}).plus({minute:1});return t.diff(e,"seconds").seconds<20&&(t=t.plus({minute:1})),t}const re=(0,r.forwardRef)((function(e,t){const[i,a]=(0,r.useState)((()=>ne()));return(0,n(866515).n)((()=>{a(ne())}),1e3,!0),(0,O.jsx)(b().A,{...e,ref:t,title:`[Dev] Run at ${i.toLocaleString(u().c9.TIME_SIMPLE)}`})}));function ie(e){return(0,f().O9)(e.interval)}var ae=()=>n(100622),oe=()=>n(704152);const se=(0,h().YK)({sunday:{id:"automations.WeekdaySelector.weekdayAbbreviations.sunday",defaultMessage:"Su"},monday:{id:"automations.WeekdaySelector.weekdayAbbreviations.monday",defaultMessage:"Mo"},tuesday:{id:"automations.WeekdaySelector.weekdayAbbreviations.tuesday",defaultMessage:"Tu"},wednesday:{id:"automations.WeekdaySelector.weekdayAbbreviations.wednesday",defaultMessage:"We"},thursday:{id:"automations.WeekdaySelector.weekdayAbbreviations.thursday",defaultMessage:"Th"},friday:{id:"automations.WeekdaySelector.weekdayAbbreviations.friday",defaultMessage:"Fr"},saturday:{id:"automations.WeekdaySelector.weekdayAbbreviations.saturday",defaultMessage:"Sa"}}),de={SU:se.sunday,MO:se.monday,TU:se.tuesday,WE:se.wednesday,TH:se.thursday,FR:se.friday,SA:se.saturday};function ue(e){const{weekdays:t,onChange:r,style:i,disabled:a}=e,o=(0,h().tz)();return(0,O.jsx)(x().Y1,{direction:"horizontal",gap:"auto",width:"fill",style:i,children:n(856662).U.map((e=>(0,O.jsx)(ce,{isSelected:t.includes(e),onClick:()=>{const n=t.includes(e)?t.length>1?t.filter((t=>t!==e)):t:[...t,e];r(n)},disabled:a,children:o.formatMessage(de[e])},e)))})}function ce(e){const{isSelected:t,children:n,onClick:r,disabled:i}=e,{isMobile:a}=(0,c().Y0)(),o=(0,l().IS)((e=>({button:{...a?{width:44,height:44,fontSize:32}:{width:28,height:28},color:t?ae().Ay.white:e.darkTextColor,display:"inline-flex",alignItems:"center",justifyContent:"center",borderRadius:100,flexShrink:0,fontSize:a?g().J.UISmall.mobile:g().J.UISmall.desktop,background:t?ae().Ay.blue:e.accentColors.gray[75]},pressed:{background:t?e.blueButtonPressedBackground:e.accentColors.gray[200]},hovered:{background:t?e.blueButtonHoveredBackground:e.accentColors.gray[100]}})),[a,t]);return(0,O.jsx)(oe().A,{disabled:i,onClick:r,style:o.button,hoveredStyle:o.hovered,pressedStyle:o.pressed,children:n})}const le=(0,h().YK)({frequencyLabel:{id:"automations.RecurrenceEditor.frequencyLabel",defaultMessage:"Every"},recurTimeLabel:{id:"automations.RecurrenceEditor.recurTimeLabel",defaultMessage:"At"},startTimeLabel:{id:"automations.RecurrenceEditor.startTimeLabel",defaultMessage:"Starting"},endConditionLabel:{id:"automations.RecurrenceEditor.endConditionLabel",defaultMessage:"Ending"},deleteRecurrenceLabel:{id:"automations.RecurrenceEditor.deleteRecurrenceLabel",defaultMessage:"Stop repeating"},timezone:{id:"automations.RecurrenceEditor.timezone",defaultMessage:"Timezone"}});function me(e){const{currentValue:t,onDelete:n,disabled:r,allowExpiredRecurrence:i,onSave:a,disallowEnd:s=!1}=e,d=(0,h().tz)(),u=(0,C().e)({minWidth:260}),m=[],{isMobile:y}=(0,c().Y0)(),x=(0,l().IS)((e=>({disabledMessage:{color:e.text.secondary,fontSize:y?g().J.UISmall.mobile:g().J.UISmall.desktop}})),[y]);r&&m.push({key:"disabled_message",items:[{key:"disabled_message",action:()=>{},render:e=>(0,O.jsx)(v().A,{...e,title:(0,O.jsx)("div",{style:x.disabledMessage,children:(0,O.jsx)(h().sA,{id:"automations.RecurrenceEditor.noPermissionMessage",defaultMessage:"You do not have permission to edit this automation"})})})}],render:e=>(0,O.jsx)(R().A,{...e})}),!r&&(0,f().O9)(a)&&m.push({key:"save_section",items:[{key:"save_item",action:()=>{},render:e=>(0,O.jsx)(ye,{...e,onSave:a,canSave:(0,f().O9)(t.interval)})}],render:e=>(0,O.jsx)(R().A,{...e})}),m.push({key:"main",items:(0,p().oE)([{key:"frequency",action:()=>{},render:t=>(0,O.jsx)(he,{...t,...e,hasSaveSection:(0,f().O9)(a)})},ke(e),ve(e),{key:"recur_time",action:()=>{},render:t=>(0,O.jsx)(pe,{...t,...e})}]),render:e=>(0,O.jsx)(R().A,{...e,topBorder:r})}),m.push({key:"times",items:[{key:"start_time",action:()=>{},render:t=>(0,O.jsx)(fe,{...t,...e})},...s?[]:[{key:"end_condition",action:()=>{},render:t=>(0,O.jsx)(je,{...t,...e})}],{key:"timezone",action:()=>{},render:t=>(0,O.jsx)(Me,{...t,...e})}],render:e=>(0,O.jsx)(R().A,{...e,topBorder:!0})}),n&&!r&&m.push({key:"delete",items:[{key:"delete",action:()=>{},render:t=>(0,O.jsx)(ge,{...t,...e,onClick:n})}],render:e=>(0,O.jsx)(R().A,{...e,topBorder:!0})});const b=function(e){const{recurrence:t,intl:n,allowExpiredRecurrence:r}=e;if(!ie(t))return{key:"next_recurrence",items:[{key:"invalid_recurrence_config",action:()=>{},render:e=>(0,O.jsx)(xe,{...e,children:(0,O.jsx)(h().sA,{id:"automations.RecurrenceEditor.invalidRecurrenceConfig",defaultMessage:"Missing required fields"})})}],render:e=>(0,O.jsx)(R().A,{...e,topBorder:!0})};const i=(0,o().getFormattedNextRecurrenceTime)({recurrence:t,intl:n});if(!i)return r?{key:"expired_recurrence",items:[{key:"expired_recurrence",action:()=>{},render:e=>(0,O.jsx)(xe,{mode:"info",...e,children:(0,O.jsx)(h().sA,{id:"automations.RecurrenceEditor.automationComplete",defaultMessage:"This is complete and will not run again"})})}],render:e=>(0,O.jsx)(R().A,{...e,topBorder:!0})}:{key:"next_recurrence",items:[{key:"next_recurrence",action:()=>{},render:e=>(0,O.jsx)(xe,{...e,children:(0,O.jsx)(h().sA,{id:"automations.RecurrenceEditor.automationWillNeverRun",defaultMessage:"This automation will never run"})})}],render:e=>(0,O.jsx)(R().A,{...e,topBorder:!0})};return{key:"next_recurrence",items:[{key:"next_recurrence",action:()=>{},render:e=>(0,O.jsx)(be,{...e,nextRecurrenceTime:i})}],render:e=>(0,O.jsx)(R().A,{...e,topBorder:!0})}}({recurrence:e.currentValue,intl:d,allowExpiredRecurrence:i});return b&&m.push(b),(0,O.jsx)(j().A,{debugName:"RecurrenceEditor",capture:!0,allowEsc:!0,children:(0,O.jsx)(M().A,{...u,children:(0,O.jsx)(S().Ay,{disallowBackspace:!0,type:S().Oh.Vertical,sections:m,initialFocus:0})})})}const ye=(0,r.forwardRef)((function(e,t){const{onSave:r,canSave:i,...a}=e,{isMobile:o}=(0,c().Y0)(),s=(0,l().IS)((e=>({menuItem:{paddingTop:2},message:{color:e.text.secondary,fontSize:o?g().J.UISmall.mobile:g().J.UISmall.desktop},button:{fontSize:o?g().J.UISmall.mobile:g().J.UISmall.desktop}})),[o]),d=!i||"disabled"===r;return(0,O.jsx)(v().A,{...a,ref:t,style:s.menuItem,title:(0,O.jsxs)(x().Y1,{direction:"horizontal",gap:"auto",align:"center",children:[(0,O.jsx)("div",{style:s.message,children:(0,O.jsx)(h().sA,{id:"automations.RecurrenceEditor.editCadenceTitle",defaultMessage:"Edit cadence"})}),(0,O.jsx)(n(493823).p,{isBlue:!0,size:"sm",style:s.button,disabled:d,disabledFeedback:!0,onClick:"disabled"===r?p().lQ:r,children:(0,O.jsx)(h().sA,{id:"automations.RecurrenceEditor.saveButtonLabel",defaultMessage:"Save"})})]})})})),he=(0,r.forwardRef)((function(e,t){const{currentValue:n,onChange:i,disabled:a,hasSaveSection:s,...d}=e,u=(0,c().Y0)(),y=(0,l().IS)((e=>({input:{maxWidth:34,padding:"4px 8px",opacity:a?.5:1},icon:{width:10,marginLeft:4,fill:e.icon.secondary},button:{justifyContent:"flex-end",height:28,opacity:a?.5:1,padding:"4px 8px"},menuItem:{...!u.isMobile&&{paddingTop:s?0:8,paddingBottom:2}}})),[u.isMobile,a,s]),p=(0,f().O9)(n.interval)&&1!==n.interval,g=(0,r.useCallback)((e=>{n.frequency!==e&&i({...n,frequency:e,..."week"===e&&0===(n.weekdays??[]).length?{weekdays:["MO"]}:{},..."month"===e?{monthly_restriction:{type:"monthdays",monthdays:[1]}}:{}})}),[n,i]);return(0,O.jsx)(v().A,{...d,ref:t,title:(0,O.jsx)(h().sA,{...le.frequencyLabel}),style:y.menuItem,disabled:a,right:(0,O.jsxs)(x().Y1,{direction:"horizontal",gap:6,width:"hug",align:"center",children:[(0,O.jsx)(B,{style:y.input,currentValue:n.interval,onChange:e=>{i({...n,interval:e})},extraValidation:o().isValidRecurrenceInterval,disabled:a,maxlength:2}),(0,O.jsx)(k().Ay,{popupType:u.isMobile?k().z7.SlideUp:k().z7.Popup,render:e=>(0,O.jsx)(F,{currentFrequency:n.frequency,onSelect:t=>{g(t),e.close()},pluralLabels:p}),renderOrigin:e=>(0,O.jsxs)(A().A,{...e,size:"lg",style:y.button,disabled:a,children:[(0,O.jsx)(h().sA,{...D[n.frequency](p)}),!a&&(0,m().b)(y.icon)]}),disabled:a})]})})})),pe=(0,r.forwardRef)((function(e,t){const{currentValue:n,onChange:r,disabled:i,...a}=e,s=(0,h().tz)(),d=(0,c().Y0)();let l;return(0,f().O9)(n.hour)&&(l=(0,o().isRunningBetweenMidnightAnd3AM)(n)?s.formatMessage(Z.aroundMidnight):u().c9.utc().set({hour:n.hour,minute:n.minute??0,second:0,millisecond:0}).setLocale((0,y().H)(s)).toFormat((0,f().O9)(n.minute)&&0!==n.minute?"h:mm a":"h a")),(0,O.jsx)(k().Ay,{disabled:i,popupType:d.isMobile?k().z7.SlideUp:k().z7.Popup,render:e=>(0,O.jsx)(ee,{onRecurTimeSelected:t=>{r({...n,hour:t.hour,minute:t.minute}),e.close()},currentRecurTime:{hour:n.hour,minute:n.minute}}),placementToOrigin:k().sx.Right,alignmentToOrigin:k().yP.Start,renderOrigin:e=>(0,O.jsx)(w()._,{...a,...e,right:l,title:(0,O.jsx)(h().sA,{...le.recurTimeLabel}),chevronType:"right",disabled:i})})})),fe=(0,r.forwardRef)((function(e,t){const{currentValue:r,onChange:i,disabled:a,disallowStart:o=!1,...s}=e,d=(0,h().tz)(),l=(0,c().Y0)(),m=(0,n(869190).Yq)({date:u().c9.fromMillis(r.start_date),dateFormat:"relative",allowRelativeDates:!0,intl:d,shortenDate:!0});return(0,O.jsx)(k().Ay,{disabled:a||o,popupType:l.isMobile?k().z7.SlideUp:k().z7.Popup,render:e=>(0,O.jsx)("div",{style:{padding:"18px 14px 14px"},children:(0,O.jsx)(T().A,{firstDayOfWeek:_().XX.state,value:Math.max(r.start_date,Date.now()),onChange:t=>{i({...r,start_date:t}),e.close()},disabledDays:{before:new Date}})}),placementToOrigin:k().sx.Right,alignmentToOrigin:k().yP.Start,renderOrigin:e=>(0,O.jsx)(w()._,{...s,...e,right:m,title:(0,O.jsx)(h().sA,{...le.startTimeLabel}),chevronType:"right",disabled:a||o})})})),ge=(0,r.forwardRef)((function(e,t){const{currentValue:n,...r}=e,i=(0,l().IS)((e=>({menuItem:{paddingBlock:2}})),[]);return(0,O.jsx)(b().A,{...r,ref:t,title:(0,O.jsx)(h().sA,{...le.deleteRecurrenceLabel}),style:i.menuItem,isRedOnHover:!0})}));const xe=(0,r.forwardRef)((function(e,t){const{children:n,mode:r="error",...i}=e,{isMobile:a}=(0,c().Y0)(),o=(0,l().IS)((e=>({disabledMessage:{color:"error"===r?e.errorText:e.text.secondary,fontSize:a?g().J.UISmall.mobile:g().J.UISmall.desktop}})),[r,a]);return(0,O.jsx)(v().A,{...i,ref:t,title:(0,O.jsx)("div",{style:o.disabledMessage,children:n})})})),be=(0,r.forwardRef)((function(e,t){const{nextRecurrenceTime:n,...r}=e,{isMobile:i}=(0,c().Y0)(),a=(0,l().IS)((e=>({menuItem:{paddingBlock:2},titleWrap:{display:"flex",...i?{flexDirection:"row",flexWrap:"wrap",gap:4}:{flexDirection:"column"},color:e.text.secondary,fontSize:i?g().J.UISmall.mobile:g().J.UISmall.desktop}})),[i]);return(0,O.jsx)(v().A,{...r,style:a.menuItem,title:(0,O.jsxs)("div",{style:a.titleWrap,children:[(0,O.jsx)("div",{children:(0,O.jsx)(h().sA,{defaultMessage:"Next occurrence:",id:"automations.RecurrenceEditor.NextRecurrenceMenuItem.nextOccurrence"})}),(0,O.jsx)("div",{children:n})]})})}));function ke(e){const{currentValue:t}=e;if("week"===t.frequency)return{key:"weekday_selector",action:()=>{},render:t=>(0,O.jsx)(we,{...t,...e})}}const we=(0,r.forwardRef)((function(e,t){const{currentValue:n,onChange:r,disabled:i,...a}=e,o=(0,l().IS)((e=>({menuItem:{paddingTop:8,paddingBottom:8}})),[]);return(0,O.jsx)(v().A,{...a,disabled:i,style:o.menuItem,title:(0,O.jsx)(ue,{weekdays:n.weekdays??[],onChange:e=>{r({...n,weekdays:e})},disabled:i})})})),je=(0,r.forwardRef)((function(e,t){const{currentValue:n,onChange:i,disabled:a,...s}=e,d=(0,c().Y0)(),u=(0,h().tz)(),l=(0,r.useMemo)((()=>n.end_condition),[n]),m=(0,r.useCallback)((e=>{i({...n,end_condition:e})}),[n,i]),y=(0,r.useMemo)((()=>(0,o().getFormattedEndCondition)(l,u)),[l,u]);return(0,O.jsx)(k().Ay,{disabled:a,popupType:d.isMobile?k().z7.SlideUp:k().z7.Popup,render:e=>(0,O.jsx)(W,{currentValue:l,onChange:m}),placementToOrigin:k().sx.Right,alignmentToOrigin:k().yP.Start,renderOrigin:e=>(0,O.jsx)(w()._,{...s,...e,right:y,title:(0,O.jsx)(h().sA,{...le.endConditionLabel}),chevronType:"right",disabled:a})})})),Me=(0,r.forwardRef)((function(e,t){const{currentValue:i,onChange:a,disabled:o,...s}=e,d=(0,r.useCallback)((e=>{a({...i,timezone:e})}),[i,a]);return(0,O.jsx)(n(304422).G,{enableRecents:!0,placementToOrigin:k().sx.Right,alignmentToOrigin:k().yP.Start,onSelect:d,currentValue:i.timezone,renderOrigin:e=>(0,O.jsx)(w()._,{...s,...e,title:(0,O.jsx)(h().sA,{...le.timezone}),chevronType:"right",right:(0,n(604995).GF)(i.timezone)})})}));function ve(e){const{currentValue:t,onChange:n}=e;if("month"===t.frequency)return{key:"month_restriction",action:()=>{},render:e=>(0,O.jsx)(q,{...e,initialValue:t.monthly_restriction,startDateForFallback:t.start_date,onChange:e=>{n({...t,monthly_restriction:e})}})}}const Se=(0,h().YK)({day:{id:"automations.RecurrencePresetMenu.day",defaultMessage:"Day"},weekday:{id:"automations.RecurrencePresetMenu.weekday",defaultMessage:"Weekday"},week:{id:"automations.RecurrencePresetMenu.week",defaultMessage:"Week"},twoWeeks:{id:"automations.RecurrencePresetMenu.twoWeeks",defaultMessage:"2 Weeks"},month:{id:"automations.RecurrencePresetMenu.month",defaultMessage:"Month"},threeMonths:{id:"automations.RecurrencePresetMenu.threeMonths",defaultMessage:"3 Months"},sixMonths:{id:"automations.RecurrencePresetMenu.sixMonths",defaultMessage:"6 Months"},year:{id:"automations.RecurrencePresetMenu.year",defaultMessage:"Year"}}),Ae={day:Se.day,weekday:Se.weekday,week:Se.week,twoWeeks:Se.twoWeeks,month:Se.month,threeMonths:Se.threeMonths,sixMonths:Se.sixMonths,year:Se.year};function Re(e){const{onSelect:t}=e,n=(0,C().e)(),r=[{key:"default",items:(0,f().WP)(Ae).map((e=>{let[n]=e;return{key:n,action:()=>{t(function(e){const t=(0,d().QA)();switch(e){case"day":return{...t,frequency:"day"};case"weekday":return{...t,frequency:"week",weekdays:["MO","TU","WE","TH","FR"]};case"week":return{...t,frequency:"week",weekdays:["MO"]};case"twoWeeks":return{...t,frequency:"week",interval:2,weekdays:["MO"]};case"month":return{...t,frequency:"month"};case"threeMonths":return{...t,frequency:"month",interval:3};case"sixMonths":return{...t,frequency:"month",interval:6};case"year":return{...t,frequency:"year"};default:(0,f().HB)(e)}}(n))},render:e=>(0,O.jsx)(b().A,{...e,title:(0,O.jsx)(h().sA,{...Ae[n]})})}})),render:e=>(0,O.jsx)(R().A,{...e})}];return(0,O.jsx)(M().A,{...n,children:(0,O.jsx)(S().Ay,{type:S().Oh.Vertical,sections:r,initialFocus:0})})}const Te=150;function _e(e){const{recurrence:t,onChange:n,disabled:u,autoFocusIfNew:c,requireExplicitSaveAndAllowDelete:l,buttonPopupStore:m,disallowStart:y=!1,disallowEnd:h=!1}=e,p=(0,a().uB)(m,s().A);(0,i().l)((()=>{c&&!t&&setTimeout((()=>{p.setState({open:!0})}),Te)}));const[f,g]=(0,r.useState)(),x=(0,r.useMemo)((()=>f||(t?{...(0,o().convertToUnpersistedRecurrenceConfig)(t),hour:t.hour??0,minute:t.minute??0}:(0,d().QA)())),[f,t]),[b,k]=(0,r.useState)(!1);(0,r.useEffect)((()=>{k((e=>e||Boolean(t)))}),[t]);const w=(0,r.useCallback)((e=>{if(g(e),!l){const t=Ce(e);n(t?e:void 0)}}),[n,l]),j=(0,r.useCallback)((()=>{n(void 0),k(!1),p.setState({open:!1})}),[n,p]),M=(0,r.useCallback)((e=>{g(e),l||n(e),p.setState({open:!1}),setTimeout((()=>{k(!0),p.setState({open:!0})}),Te)}),[l,p,n]),v=(0,r.useCallback)((()=>{g(void 0),k(Boolean(t))}),[t]),S=(0,r.useCallback)((()=>!Ce(x)||!t||!(0,o().areRecurrenceSchedulesEqual)(x,(0,o().convertToUnpersistedRecurrenceConfig)(t))),[x,t]),A=(0,r.useMemo)((()=>{if(l)return S()&&Ce(x)?()=>{n(x),p.setState({open:!1})}:"disabled"}),[p,x,S,n,l]);return{render:(0,r.useCallback)((()=>b||t?(0,O.jsx)(me,{currentValue:x,onChange:w,onDelete:l?j:void 0,onSave:A,disabled:u,disallowStart:y,disallowEnd:h}):(0,O.jsx)(Re,{onSelect:M})),[b,t,x,w,l,j,A,u,y,h,M]),onClose:v,buttonPopupStore:p,hasUnpersistedChanges:S}}function Ce(e){return ie(e)&&void 0!==(0,o().getNextDateUtc)((0,o().convertFromUnpersistedRecurrenceConfig)(e))}},781697:(e,t,n)=>{n.d(t,{e:()=>s,v:()=>o});var r=()=>n(484714),i=()=>n(56366),a=()=>n(722872);function o(e){return e.device.isPhone||"actionSheet"===e.tabletBehavior&&e.device.isTablet?{menuType:a().gu.ActionSheet}:{menuType:a().gu.Popup,maxHeight:e.maxHeight,maxWidth:e.maxWidth,paddingTop:e.paddingTop,paddingBottom:e.paddingBottom,width:e.width,minWidth:e.minWidth}}function s(e){const t=(0,r().Y0)();return(0,i().K8)((()=>o({device:t,maxHeight:null==e?void 0:e.maxHeight,maxWidth:null==e?void 0:e.maxWidth,paddingTop:null==e?void 0:e.paddingTop,paddingBottom:null==e?void 0:e.paddingBottom,width:null==e?void 0:e.width,minWidth:null==e?void 0:e.minWidth,tabletBehavior:null==e?void 0:e.tabletBehavior})),[t,null==e?void 0:e.maxHeight,null==e?void 0:e.maxWidth,null==e?void 0:e.paddingTop,null==e?void 0:e.paddingBottom,null==e?void 0:e.width,null==e?void 0:e.minWidth,null==e?void 0:e.tabletBehavior])}},866515:(e,t,n)=>{n.d(t,{n:()=>i});var r=n(296540);function i(e,t,n){const i=(0,r.useRef)(e),a=(0,r.useRef)(null);(0,r.useEffect)((()=>{i.current=e}),[e]),(0,r.useEffect)((()=>{const e=async()=>{a.current&&(clearTimeout(a.current),a.current=null),n&&(await i.current(),a.current=setTimeout(e,t))};return n&&e(),()=>{a.current&&(clearTimeout(a.current),a.current=null)}}),[n,t])}}}]);