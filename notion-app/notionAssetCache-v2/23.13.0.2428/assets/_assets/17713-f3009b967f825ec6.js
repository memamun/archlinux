"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[17713],{32454:(e,t,o)=>{o.r(t),o.d(t,{createCollectionTemplateFromModalState:()=>oe,createMinimalCollectionTemplateWithoutModal:()=>ee,createPlaceholderWorkflowTemplateBlock:()=>le,getSetupGeneratorForTemplate:()=>X,getTemplateOnboardingVersion:()=>j,handleSelectTemplateFromOnboardingModal:()=>Y,maybeAddAppTemplateMetadataForTasks:()=>ie,moveToNextOnboardingStep:()=>me,moveToPreviousOnboardingStep:()=>de,onNavigateToPlaceholderWorkflowTemplateBlock:()=>ce,openSelectedTemplateOnboardingModalForInAppFlows:()=>Z,openTemplateOnboardingModal:()=>H,retryAiSetup:()=>se,setFollowUpInputFocused:()=>pe,switchModalToTemplate:()=>J,toggleFeatureSelectionInPreview:()=>ae});o(16280),o(898992),o(354520),o(672577),o(581454);var n=()=>o(584262),r=()=>o(66689),i=()=>o(428045),a=()=>o(663077),l=()=>o(700500),c=()=>o(206267),s=()=>o(919709),p=()=>o(496603),d=()=>o(498212),m=()=>o(973647),u=()=>o(534177),v=()=>o(612008),f=()=>o(896628),h=()=>o(496414),g=()=>o(246826),S=()=>o(857783),y=()=>o(436572),w=()=>o(317909),I=()=>o(586481),_=()=>o(211716),T=()=>o(972435),C=()=>o(465425),b=()=>o(154152);o(18107),o(410838),o(813451),o(967357),o(737550),o(944114);function k(e){return"inference"!==e.type&&"queue-handoff"!==e.type}var P=()=>o(449412),V=()=>o(989423),M=()=>o(349379);class A{constructor(){this.root=new x}append(e){if(this.root.isEmpty())this.root.addChild(e);else{const t=this.toNodes().at(-1);if(!t)throw new Error("Last node not found");t.addChild(e)}}toNodes(){return this.root.getSelectedPath()}toValues(){return this.toNodes().map((e=>e.value))}removeLast(){const e=this.toNodes().at(-1);if(!e)return;const t=e.value;return e.remove(),t}removeLastMatching(e){const t=this.toNodes().findLastIndex((t=>e(t.value)));if(-1===t)return[];const o=[];for(;this.toNodes().length>t;){const e=this.removeLast();void 0!==e&&o.push(e)}return o}}class x{constructor(){this.children=[],this.selectedChild=void 0}addChild(e){const t=new B(e,this);return this.children.push(t),this.selectedChild=t,t}getSelectedPath(){var e;return(null===(e=this.selectedChild)||void 0===e?void 0:e.toSelectedPath())??[]}isEmpty(){return 0===this.children.length}getChildren(){return this.children}setSelectedChild(e){if(!this.children.includes(e))throw new Error("Cannot select a node that is not a child");this.selectedChild=e}removeChild(e){const t=this.children.indexOf(e);-1!==t&&(this.children.splice(t,1),this.selectedChild===e&&(this.selectedChild=void 0))}}class B{constructor(e,t){this.value=void 0,this.children=[],this.selectedChild=void 0,this.parent=void 0,this.isRemoved=!1,this.value=e,this.parent=t}addChild(e){const t=new B(e,this);return this.children.push(t),this.selectedChild=t,t}toSelectedPath(){const e=[this];return this.selectedChild&&e.push(...this.selectedChild.toSelectedPath()),e}retry(e){if(this.isRemoved)throw new Error("Cannot retry on a removed node");this.parent.addChild(e)}select(e){if(this.isRemoved)throw new Error("Cannot select on a removed node");const t=this.parent.getChildren(),o=e(t.map((e=>e.value)),this.value);if(void 0===o)return!1;const n=t.find((e=>e.value===o));return n?this.parent.setSelectedChild(n):this.parent.addChild(o),!0}selectOrRetry(e){if(!this.select(e)){const t=e([],void 0);void 0!==t&&this.retry(t)}}remove(){if(this.children.length>0)throw new Error("Cannot remove a node that has children");if(this.isRemoved)throw new Error("Node is already removed");this.parent.removeChild(this),this.isRemoved=!0}getChildren(){return this.children}setSelectedChild(e){if(!this.children.includes(e))throw new Error("Cannot select a node that is not a child");this.selectedChild=e}removeChild(e){const t=this.children.indexOf(e);-1!==t&&(this.children.splice(t,1),this.selectedChild===e&&(this.selectedChild=void 0),e.isRemoved=!0)}}class R extends(()=>o(757695))().default{getInitialState(){return{isBusy:!1,transcriptTree:new A}}setPrompt(e){this.setState({...this.state,prompt:e})}}class F{constructor(e){this.environment=void 0,this.generatedSetupCount=0,this.store=void 0,this.error=void 0,this.spaceId=void 0,this.eventBase=void 0,this.abortController=void 0,this.onSetupReady=void 0,this.setPrompt=e=>{this.store.setState({...this.store.state,prompt:e})},this.submitPrompt=async e=>{var t;const{from:n}=e,r="follow-up"===n,{isBusy:i,prompt:a}=this.store.state;if(i||!a)return!1;if(!this.spaceId)return!1;this.store.setState({...this.store.state,isBusy:!0}),null===(t=this.store.state.transcriptTree.toNodes().find((e=>"config"===e.value.type)))||void 0===t||t.selectOrRetry((e=>{const t=e.find((e=>"config"===e.type&&"setup-generator"===e.value.type));return t||{id:(0,d().Ay)(),type:"config",value:{type:"setup-generator"}}}));try{var l;const e=this.store.state.transcriptTree.toNodes().find((e=>"user"===e.value.type));if(e&&!r)e.selectOrRetry((e=>{const t=e.find((e=>"user"===e.type&&(0,s().MTk)(a,e.value)));if(t)return t;{var o;const e=null===(o=this.environment.currentUser)||void 0===o?void 0:o.id;if(!e)throw new Error("Current user not found");return{id:(0,d().Ay)(),type:"user",value:a,userId:e}}}));else{var c;const e=null===(c=this.environment.currentUser)||void 0===c?void 0:c.id;if(!e)throw new Error("Current user not found");this.store.state.transcriptTree.append({id:(0,d().Ay)(),type:"user",value:a,userId:e})}const t=this.store.state.transcriptTree.toValues();if(!t.slice(t.findLastIndex((e=>"user"===e.type))+1).some((e=>"setup"===e.type))){const e=(0,d().Ay)(),n=new AbortController;this.abortController=n;let r=!1;try{const i=await(0,o(582524).gj)({environment:this.environment,abortSignal:n.signal,data:{traceId:e,generateTitle:!1,transcript:t,spaceId:this.spaceId},onResponse:e=>{"setup-operations"===e.type&&this.store.setState({...this.store.state,progress:e.progress}),"retry"!==e.type||r||(r=!0,y().D6({label:"This is taking a little longer than usual"}))}});if(this.abortController=void 0,this.store.setState({...this.store.state,progress:void 0,feedbackArgs:this.computeFeedbackArgs()}),!m().Q.isSuccess(i))return P().O8(i.error,{from:"fullPageTranslationActions.generateAndApplyTranslationMapToPage",type:"error"}),this.onSetupReady({error:i.error}),!1;const a=function(e){const t=new Map;for(const o of e){const e="string"==typeof o.id?o.id:String(o.id),n=t.get(e);n&&"setup-operations"===n.type&&"setup-operations"===o.type?t.set(e,{...n,operations:[...n.operations,...o.operations]}):t.set(e,o)}return Array.from(t.values())}(i.value.filter(k));for(const e of a)this.store.state.transcriptTree.append(e)}finally{this.abortController=void 0}}const n=null===(l=this.store.state.transcriptTree.toValues().findLast((e=>"setup"===e.type)))||void 0===l?void 0:l.setup;if(!n)throw new Error("Missing setup step");return this.generatedSetupCount++,this.store.setState({...this.store.state,setup:n,prompt:void 0}),this.trackGeneratedSetup(n),this.onSetupReady({value:n}),!0}catch(p){return p instanceof Error&&"AbortError"===p.name||(P().O8(p,{from:"setupGenerator.submitPrompt",type:"error"}),this.onSetupReady({error:{code:500,message:"Unknown error"}})),!1}finally{this.store.setState({...this.store.state,isBusy:!1,feedbackArgs:this.computeFeedbackArgs()})}},this.stopGenerating=()=>{var e;null===(e=this.abortController)||void 0===e||e.abort()},this.discardLatestSetup=()=>{var e,t;const o=null===(e=this.store.state.transcriptTree.toValues().findLast((e=>"user"===e.type)))||void 0===e?void 0:e.value;if(!o)return;this.store.state.transcriptTree.removeLastMatching((e=>"user"===e.type));const n=null===(t=this.store.state.transcriptTree.toValues().findLast((e=>"setup"===e.type)))||void 0===t?void 0:t.setup;this.store.setState({...this.store.state,prompt:o,setup:n,feedbackArgs:this.computeFeedbackArgs()}),n&&this.onSetupReady({value:n}),(0,V().u4)({environment:this.environment,event:{eventName:"setup_generator_try_again_clicked",eventProperties:this.eventBase}})};const{environment:t,spaceId:n,onSetupReady:r,initialPrompt:i,analyticsArgs:a}=e;if(this.environment=t,this.spaceId=n,this.eventBase={flow_id:a.workflowTemplatesFlowId??(0,d().Ay)(),origin:a.origin,has_selection_modal_search_query:a.hadSelectionModalSearchEntered},this.store=new R,this.store.state.transcriptTree.append({id:(0,d().Ay)(),type:"config",value:{type:"setup-generator"}}),i){var l;this.store.setState({...this.store.state,prompt:i});const e=null===(l=this.environment.currentUser)||void 0===l?void 0:l.id;e&&this.store.state.transcriptTree.append({id:(0,d().Ay)(),type:"user",value:i,userId:e})}this.onSetupReady=r}computeFeedbackArgs(){const{setup:e}=this.store.state,t=null==e?void 0:e.metadata.setupId;if(t&&this.store.state.transcriptTree)return{spaceId:this.spaceId,traceId:t,transcript:this.store.state.transcriptTree.toValues()}}discardAllSetups(){var e;if(!this.store.state.transcriptTree)return;const t=this.store.state.transcriptTree.toNodes().findIndex((e=>"user"===e.value.type));if(-1===t)return;const o=this.store.state.transcriptTree.toValues().at(t);if(!o||"user"!==o.type)return;for(;this.store.state.transcriptTree.toNodes().length>t;)this.store.state.transcriptTree.removeLast();const n=null===(e=this.store.state.transcriptTree.toValues().findLast((e=>"setup"===e.type)))||void 0===e?void 0:e.setup;this.store.setState({...this.store.state,prompt:o.value,setup:n,feedbackArgs:this.computeFeedbackArgs()}),n&&this.onSetupReady({value:n})}trackSessionStarted(){(0,M().Vd)({environment:this.environment,eventProperties:this.eventBase})}trackSessionEnded(e){const{reason:t}=e;(0,V().u4)({environment:this.environment,event:{eventName:"setup_generator_session_ended",eventProperties:{...this.eventBase,generated_setup_count:this.generatedSetupCount,reason:t}}})}trackGeneratedSetup(e){const{metadata:t}=e,{setupId:o,promptInfo:n}=t,r=e.allTemplates.filter((e=>(0,a().Xq)(e,"collection"))).length,i=e.allTemplates.filter((e=>(0,a().Xq)(e,"collection_view"))).length,l=e.allTemplates.filter((e=>(0,a().Xq)(e,"property"))).length;(0,M().If)({environment:this.environment,eventProperties:{...this.eventBase,setup_id:o,prompt_type:"custom",collection_count:r,collection_view_count:i,property_count:l,total_duration_ms:e.metadata.timing.total,warning_count:e.metadata.warnings.length,error_count:e.metadata.errors.length,use_case:null==n?void 0:n.useCase,prompt_specificity:null==n?void 0:n.specificity,prompt_language:null==n?void 0:n.language}})}}var E=()=>o(441307),O=()=>o(630116),N=()=>o(973891),D=()=>o(227157),z=()=>o(101926),L=()=>o(913454);function $(e){let{environment:t,parentStore:o,collectionTemplate:n}=e;if(!o.getSpaceId())throw new Error(`Space ID not found for ${o}`);const r=(0,a().bQ)(n).map((e=>L().globalWorkflowTemplates.fromId(e))).filter((e=>(0,a().Sz)(e))),i=[];for(const a of r){const{relatedCollectionTemplateId:e}=a,n=(0,L().getChildCollectionStoreByTemplateId)({environment:t,parentStore:o,collectionTemplateId:e});n&&i.push({type:"target",collectionStore:n,relationPropertyTemplate:a})}return i}var G=()=>o(338907),W=()=>o(204067),q=()=>o(605315),U=()=>o(896326),Q=()=>o(458097);function H(e){let{template:t,parentStore:o,origin:n,version:r,existingCollectionInfo:i,relationInfos:a,navigateToOnFinish:l="created_collection",setupGenerator:c,flowId:s,onClose:p}=e;const d=t?(0,U().C8)({collectionTemplate:t,origin:n,flowId:s,parentStore:o}):(0,U().XM)({origin:n,flowId:s,parentStore:o});N().T_(),Q().A.setState({open:!0,isSaving:!1,currentStepIndex:0,version:r,existingCollectionInfo:i,relationInfos:a??[],navigateToOnFinish:l,setupGenerator:c,onClose:p,isPackagingM3_3Enabled:(0,G().Te)(),...d,parentStore:o})}function j(e){if(!e.template)return"select_and_customize_template";const{includeTemplateSelectionStep:t,hasSetupGenerator:o}=e;return o?t?"select_and_build_with_ai":"build_with_ai":t?"select_and_customize_template":"customize_template"}const K=(0,o(959013).YK)({setupGenerationError:{id:"setupGenerator.error.failedToGenerateSetup",defaultMessage:"Sorry, something went wrong while completing this request. Please try again."},setupGenerationRateLimitError:{id:"setupGenerator.error.rateLimited",defaultMessage:"Too many requests. Please try again later."}});function X(e){let{environment:t,parentStore:o,template:n,initialAiPrompt:r,analyticsArgs:i,isForInAppFlows:l}=e;const c=null==o?void 0:o.getSpaceId(),s=(0,a().cB)(n.templateId)?new F({environment:t,analyticsArgs:i,spaceId:c,initialPrompt:r,onSetupReady:e=>{const t=Q().A.state;if(!t.open)return;if(m().Q.isFail(e))return void(429===e.error.code?y().D6({label:T().A.formatMessage(K.setupGenerationRateLimitError)}):y().D6({label:T().A.formatMessage(K.setupGenerationError)}));const o=e.value;if(t.setupGenerator!==s)return;q().Z.append(o.allTemplates.filter((e=>e.isAiGenerated)));const n=o.allTemplates.find((e=>(0,a().Xq)(e,"collection")));if(!n)throw new Error("No collection template found");J(n)}}):void 0;return s}function Z(e){var t;let{template:o,environment:n,aiPrompt:r,autoSubmit:i=!1,version:a,...l}=e;const{parentStore:c,relationInfos:s,origin:m,flowId:u=(0,d().Ay)()}=l,v=$({environment:n,parentStore:c,collectionTemplate:o}),f=X({environment:n,template:o,parentStore:c,initialAiPrompt:r,analyticsArgs:{origin:m,hadSelectionModalSearchEntered:((null===(t=l.collectionTemplatesSearchQuery)||void 0===t?void 0:t.length)??0)>0,workflowTemplatesFlowId:u},isForInAppFlows:!0});H({...l,template:o,flowId:u,version:a??j({template:o,includeTemplateSelectionStep:!1,hasSetupGenerator:Boolean(f)}),relationInfos:p().hS([...s??[],...v],(e=>e.collectionStore.id)),setupGenerator:f}),f&&i&&(0,b().z)(f)}function Y(e){var t,o;let{template:n,environment:r,analyticsArgs:a}=e;const l=Q().A.state;if(!l.open||!l.parentStore)return;const{parentStore:c,relationInfos:d,origin:m,flowId:u}=l,v=$({environment:r,parentStore:c,collectionTemplate:n}),f=p().hS([...d??[],...v],(e=>e.collectionStore.id)),h=X({environment:r,template:n,parentStore:c,analyticsArgs:{origin:m,hadSelectionModalSearchEntered:((null===(t=l.collectionTemplatesSearchQuery)||void 0===t?void 0:t.length)??0)>0,workflowTemplatesFlowId:u},initialAiPrompt:l.collectionTemplatesSearchQuery?(0,s().x9d)(l.collectionTemplatesSearchQuery):void 0,isForInAppFlows:!0}),g=j({template:n,includeTemplateSelectionStep:!0,hasSetupGenerator:Boolean(h)}),S={...l,open:!0,isSaving:!1,currentStepIndex:(0,U().aO)(l),version:g,relationInfos:f??[],setupGenerator:l.setupGenerator??X({environment:r,template:L().globalWorkflowTemplates.fromIdOfType({templateId:i().MH,type:"collection"}),parentStore:l.parentStore,initialAiPrompt:[[""]],analyticsArgs:{origin:l.origin,workflowTemplatesFlowId:l.flowId,hadSelectionModalSearchEntered:!1},isForInAppFlows:!0}),isFollowUpInputFocused:!1,...(0,U().C8)({collectionTemplate:n,origin:m,flowId:u,parentStore:c}),parentStore:l.parentStore};null!==(o=n.value.onboarding)&&void 0!==o&&o.isMinimal?oe({environment:r,modalState:S}):("suggested_template"===a.type&&(0,M().os)({environment:r,eventProperties:{from_modal_template_picker:!0,selected_index:a.allOrderedTemplateIds.indexOf(n.templateId),collection_template_ids_shown:a.allOrderedTemplateIds,...(0,U().gM)({origin:m,parentStore:c,collectionTemplatesSearchQuery:l.collectionTemplatesSearchQuery,flowId:u,collectionTemplate:n})}}),Q().A.setState(S))}function J(e){const t=Q().A.state;if(!t.open||!t.collectionTemplate||!t.parentStore)return;let o={...t,...(0,U().C8)({collectionTemplate:e,origin:t.origin,flowId:t.flowId,parentStore:t.parentStore}),parentStore:t.parentStore,isSaving:!1};if(t.collectionTemplate.templateId===e.templateId){var n;const e=o.userCustomizations.featureTemplateSelections,r=t.userCustomizations.featureTemplateSelections,i=e.map((e=>{const t=r.find((t=>t.template.templateId===e.template.templateId));return"required"!==e.optionality&&t?{...e,selected:t.selected}:e}));o={...o,userCustomizations:{...o.userCustomizations,featureTemplateSelections:i,prevFeatureTemplateSelections:e},previewCollectionInfo:{collectionViewBlockStore:void 0,collectionContextStore:void 0,examplePageStores:void 0,focusViewTemplateId:null===(n=t.previewCollectionInfo)||void 0===n||null===(n=n.collectionContextStore)||void 0===n||null===(n=n.collectionViewStore())||void 0===n||null===(n=n.getFormat().workflow_template_instance)||void 0===n?void 0:n.template_id}}}Q().A.setState(o)}function ee(e){let{environment:t,template:o,parentStore:n,existingCollectionInfo:r,relationInfos:i}=e;w().createAndCommit({userAction:"workflowTemplates.createMinimalCollectionTemplate",environment:t,canUndo:!0,perform:e=>{(0,D().mm)({environment:t,transaction:e,template:o,parentStore:n,existingCollectionInfo:r,inMemoryRecordCache:n.inMemoryRecordCache,relationInfos:i,logger:new(L().WorkflowTemplateLogger)})}})}function te(e){var t;let{environment:o,modalState:r,collectionViewBlockStore:i,collectionStore:a,examplePageStores:l}=e;if(!a)return;(0,z().xN)({environment:o,collectionStore:a});const{existingCollectionInfo:c,userCustomizations:s,navigateToOnFinish:p}=r,d=(0,U().gM)(r);!function(e){let{environment:t,eventProperties:o,collectionViewBlockStore:r,examplePageStores:i,navigateTo:a,result:l}=e;const c=(0,G().Tl)();if("created_collection"===a)S().uK({environment:t,store:r,visitType:_().ig.Link,pageVisitSource:n().y8.WorkflowTemplateOnboarding,callback:()=>{c?N().yQ({examplePageStores:i,collectionViewBlockStore:r,eventProperties:o}):(0,C().HH)(t,"collection_add_item_button_tooltip")}});else if("skip"===a){var s;c&&null!==(s=r.getModel())&&void 0!==s&&s.isFullPageCollectionView()&&N().yQ({examplePageStores:i,collectionViewBlockStore:r,eventProperties:o})}else(0,u().HB)(a);const p=Q().A.getState();!p.open&&p.isShowingLoadingState&&h().V();Q().A.close(l)}({environment:o,eventProperties:d,collectionViewBlockStore:i,examplePageStores:l,navigateTo:p,result:{type:"accepted_template",blockId:i.id}}),(0,M().g2)({environment:o,modalState:r,eventProperties:{record_titles_is_empty:s.recordTitles.map((e=>0===e.length)),selected_feature_template_ids:s.featureTemplateSelections.filter((e=>"required"!==e.optionality&&e.selected)).map((e=>e.template.templateId)),step:(0,U().hq)(r),target_page_ids:[i.id],collection_ids:[a.id],example_page_ids:l.map((e=>e.id)),existing_block_id:null==c||null===(t=c.collectionViewBlockStore)||void 0===t?void 0:t.id,...d}})}function oe(e){let{environment:t,modalState:o}=e;if(!o.collectionTemplate||o.isSaving||!o.parentStore)return;const{collectionTemplate:n,parentStore:r,existingCollectionInfo:i,relationInfos:a,userCustomizations:l}=o;Q().A.setState({...o,isSaving:!0});const{performResult:c}=w().createAndCommit({userAction:"WorkflowTemplatesOnboardingModal.getStarted",environment:t,canUndo:!0,perform:e=>{const{collectionStore:o,collectionViewStore:c,collectionViewBlockStore:s,examplePageStores:p}=(0,D().mm)({environment:t,transaction:e,template:n,parentStore:r,existingCollectionInfo:i,inMemoryRecordCache:r.inMemoryRecordCache,selectedFeatureTemplateIds:(0,L().getSelectedFeatureTemplateIds)(l),relationInfos:a,logger:new(L().WorkflowTemplateLogger)});return function(e){let{environment:t,transaction:o,collectionStore:n,collectionViewStore:r,collectionViewBlockStore:i,recordTitles:a}=e;const l=new(E().A)(t);l.setContext({type:"collectionView",collectionViewBlockStore:i,collectionStore:n,collectionViewStore:r,pageVisitSourceOverride:void 0});const c=a.filter((e=>e.length>0));for(const s of c)ne({environment:t,transaction:o,collectionContextStore:l,title:s})}({environment:t,transaction:e,collectionStore:o,collectionViewStore:c,collectionViewBlockStore:s,recordTitles:l.recordTitles}),{collectionViewBlockStore:s,collectionStore:o,examplePageStores:p}}});return te({environment:t,modalState:o,collectionViewBlockStore:c.collectionViewBlockStore,collectionStore:c.collectionStore,examplePageStores:c.examplePageStores}),c}function ne(e){let{environment:t,transaction:o,collectionContextStore:n,title:r}=e;const{newStore:i}=(0,v().Q)({environment:t,collectionContextStore:n,groupsPointer:[],insertAtIndex:0,shouldCoerce:!0,templateStore:n.defaultPageTemplateStore.state,transaction:o,from:{createBlock:"workflow_template"},inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache}),a=[r];return(0,I().L)({environment:t,store:i,properties:{title:[a]},transaction:o}),i}const re={assigneeProperty:"notion://tasks/assign_property",statusProperty:"notion://tasks/status_property",dueDateProperty:"notion://tasks/due_date_property"};function ie(e){let{environment:t,transaction:o,collectionStore:n,collectionViewBlockStore:i}=e;const a=r().dC,l=r().d0,s=(0,W().Sl)({environment:t,collectionStore:n}),p={};for(const[r,c]of Object.entries(re)){const e=s.find((e=>e.templateId.includes(r)));if(!e)return;p[c]=e.instancePointer.id}f().zA({stores:[n],update:{app_config_uri:a,app_uri_map:p},transaction:o}),f().zA({stores:[i],update:{app_id:c().JW(),app_config_uri:l,app_uri_map:{[a]:n.id,[l]:i.id}},transaction:o})}function ae(e){let{template:t,environment:o}=e;const n=Q().A.state;n.open&&n.collectionTemplate&&Q().A.setState({...n,userCustomizations:(0,U().Ll)({userCustomizations:n.userCustomizations,templateId:t.templateId})})}function le(e){let{environment:t,transaction:o,parentStore:n,collectionTemplate:r,spaceViewStore:i}=e;const a=g().Wv({environment:t,type:l().xd.collectionViewPage,spaceId:n.getSpaceId(),format:{collection_view_sub_type:"workflow_template_placeholder",placeholder_workflow_template_id:r.templateId,page_icon:r.value.targetCollection.icon},properties:{title:(0,s().x9d)(r.value.targetCollection.name)},inMemoryRecordCache:n.inMemoryRecordCache,transaction:o});g().zv({store:a,data:{parent_id:n.id,parent_table:n.table,alive:!0},transaction:o});const c=O().Bv.createChildStore(n,a.pointer);return(0,D().Ls)({environment:t,parentStore:n,collectionViewBlockStore:c,transaction:o,appendOrPrepend:"append",spaceViewStore:i}),c}function ce(e){let{environment:t,collectionTemplate:o,collectionViewBlockStore:r}=e;const i=r.getParentStore(),a=i&&(0,L().isCollectionTemplateParentStore)(i)?i:r;if(t.device.isMobile)return ee({environment:t,template:o,parentStore:a,existingCollectionInfo:{collectionViewBlockStore:r,collectionStore:void 0,collectionViewStore:void 0},relationInfos:[]}),S().uK({environment:t,store:r,visitType:_().ig.Link,pageVisitSource:n().y8.WorkflowTemplateOnboarding}),{didOpenOnboardingModal:!1};const l="placeholder_block",c=(0,U().gM)((0,U().C8)({collectionTemplate:o,origin:l,flowId:void 0,parentStore:a}));return(0,M().os)({environment:t,eventProperties:{...c,from_modal_template_picker:!1,selected_index:0,collection_template_ids_shown:[o.templateId]}}),Z({environment:t,template:o,origin:l,parentStore:a,aiPrompt:void 0,flowId:c.flow_id,existingCollectionInfo:{collectionViewBlockStore:r,collectionStore:void 0,collectionViewStore:void 0}}),{didOpenOnboardingModal:!0}}function se(){const e=Q().A.state;if(!e.open)return;const t=e.setupGenerator;t&&(t.discardLatestSetup(),void 0===t.store.state.setup&&de())}function pe(e){const t=Q().A.state;t.open&&Q().A.setState({...t,isFollowUpInputFocused:e})}function de(){const e=Q().A.state;if(!e.open)return;const t=(0,U().Wm)(e),o=(0,U().gP)(e),n=t[o];if(o>=0){var r,a;if("setupGeneratorInput"===n||"templateSelection"===n)null==e||null===(r=e.setupGenerator)||void 0===r||r.discardAllSetups(),null==e||null===(a=e.setupGenerator)||void 0===a||a.stopGenerating();const t={...e,isFollowUpInputFocused:!1,currentStepIndex:o};"templateSelection"===n&&(t.collectionTemplate=i().XK,"new_user_onboarding"===e.origin&&(t.version="new_user_template_onboarding")),Q().A.setState(t)}}function me(){const e=Q().A.state;if(!e.open)return;const t=(0,U().aO)(e);t>=0&&Q().A.setState({...e,isFollowUpInputFocused:!1,currentStepIndex:t})}},101926:(e,t,o)=>{o.d(t,{ai:()=>te,xN:()=>ie,e_:()=>oe,Ix:()=>re,Z5:()=>ae});o(898992),o(672577);var n=()=>o(663077),r=()=>o(792071),i=()=>o(869558),a=()=>o(144081),l=()=>o(496603),c=()=>o(534177),s=()=>o(235191),p=()=>o(317909),d=()=>o(414360),m=()=>o(586481),u=()=>o(630116),v=(o(354520),()=>o(913454)),f=()=>o(204067);function h(e){var t;let{environment:o,collectionStore:r,collectionViewValue:i,dependencyMap:a,logger:l}=e;if((0,v().remapPropertyIds)({collectionStore:r,object:i,dependencyMap:a}),function(e){let{environment:t,spaceId:o,collectionViewValue:n,logger:r}=e;for(const l of(null===(i=n.format)||void 0===i?void 0:i.collection_groups)??[]){var i,a;const{value:e}=l;if(("created_by"===e.type||"last_edited_by"===e.type)&&"notion_user"===(null===(a=e.value)||void 0===a?void 0:a.table)){const n=t.currentUser.id;if(!n){r.warn("No current user ID, unable to remap collection group user to current user!");continue}r.log(`Remapping user ID ${e.value.id} to ${n} in collection view group.`),e.value.id=n,e.value.spaceId=o}}}({environment:o,spaceId:r.getSpaceId(),collectionViewValue:i,logger:l}),i.query2&&function(e){let{collectionStore:t,query2:o,dependencyMap:r}=e;for(const i of n().Nf){const e=o[i];e&&(o[i]=(0,f().CB)({collectionStore:t,sourceTemplateType:"property",dependencyMap:r,sourcePrimitiveId:e}))}}({collectionStore:r,query2:i.query2,dependencyMap:a}),"object"==typeof(null===(t=i.format)||void 0===t?void 0:t.collection_view_default_template)){const e=(0,f().fI)({collectionStore:r,sourceTemplateType:"block",dependencyMap:a,sourcePrimitiveId:i.format.collection_view_default_template.template_page_id});e?i.format.collection_view_default_template={template_page_id:e}:(l.warn("Unable to resolve collection_view default template, omitting it."),delete i.format.collection_view_default_template)}}function g(e){let{collectionViewFormat:t}=e;const o=null==t?void 0:t.table_properties;o&&(t.table_properties=o.filter((e=>!(0,f().TE)(e.property))))}var S=()=>o(731638),y=(o(581454),o.n(o(794148))),w=()=>o(192845),I=()=>o(977345),_=()=>o(206267),T=()=>o(884173),C=()=>o(696706),b=()=>o(912720),k=()=>o(199378),P=()=>o(179034),V=()=>o(519831),M=()=>o(798880),A=()=>o(324587),x=()=>o(780054),B=()=>o(594794),R=()=>o(972435);function F(e){let{collectionStore:t,environment:o,logger:n,template:i,transaction:a}=e;const l=function(e){let{environment:t,logger:o,parentStore:n,template:i,transaction:a}=e;const l=(0,B().zP)({environment:t,spaceId:n.getSpaceId(),table:b().yB}),c=t.currentUser.id,s=r().Bj6.fromAutomation({alive:!0,created_by_id:c??"",created_by_table:M().oo,created_time:Date.now(),id:l.id,parent_id:n.pointer.id,parent_table:n.pointer.table,space_id:n.getSpaceId(),trigger:{...i.value.trigger,id:_().JW()},version:0,last_edited_by_id:c??"",last_edited_by_table:M().oo,last_edited_time:Date.now(),status:"active"}),p=E({actionPlaceholderIdToActionId:new Map,collectionStore:n,dependencyMap:i.dependencyMap,logger:o}),{value:d}=(0,w().n)({automationModel:s,visitors:p}),m=d.getTrigger(),u=A().createAutomation({actionIds:[],environment:t,automationId:l.id,automationName:i.value.name,parentPointer:n.getSpaceShardedPointer(),transaction:a,trigger:m});return u}({environment:o,logger:n,parentStore:t,template:i,transaction:a}),c=new Map;return i.value.actions.map((e=>function(e){let{actionPlaceholderIdToActionId:t,actionTemplate:o,collectionStore:n,environment:r,logger:i,parentStore:a,parentTemplate:l,transaction:c}=e;const s=(0,B().zP)({environment:r,spaceId:a.getSpaceId(),table:k().SC}),{config:p,placeholderId:d,type:m}=o,{model:u}=T().RU.create({alive:!0,config:p,id:s.id,parent_id:a.pointer.id,parent_table:a.pointer.table,space_id:n.getSpaceId(),type:m,version:0}),v=E({actionPlaceholderIdToActionId:t,collectionStore:n,dependencyMap:l.dependencyMap,logger:i}),{value:f}=(0,w().G)({automationActionModel:u,baseUrl:x().A.domainBaseUrl,preventClearingConfig:!0,publicDomainName:x().A.publicDomainName,sourceSpaceId:n.getSpaceId(),visitors:v}),h=f.getConfig(),g=A().addAutomationAction({actionId:s.id,actionType:o.type,automationStore:a,config:h,createDuplicateBlocksContainer:!0,environment:r,intl:R().A.getIntl(),transaction:c});return y()(g,"Failed to create automation action"),t.set(d,g.id),g}({actionPlaceholderIdToActionId:c,actionTemplate:e,collectionStore:t,environment:o,logger:n,parentStore:l,parentTemplate:i,transaction:a}))),l.isTriggerType("event")&&p().applyOperation({store:t,operation:{pointer:t.pointer,path:["format","automation_ids"],command:"listAfter",args:{id:l.id}},transaction:a}),{id:l.id,spaceId:t.getSpaceId(),type:"automation"}}function E(e){const{actionPlaceholderIdToActionId:t,collectionStore:o,dependencyMap:n,logger:r}=e;function a(e){const o=(0,I().y5)(e);if("action"===o.source){const e=t.get(o.action_id)??o.action_id;return(0,I().$y)({...o,action_id:e})}if("global"===o.source)return e;(0,c().HB)(o)}function s(e){if(!n)return;if("title"===e)return e;const t=(0,f().fI)({collectionStore:o,sourceTemplateType:"property",sourcePrimitiveId:e,dependencyMap:n});return t||r.warn(`Failed to remap property ID ${e} in automation template`),t}return{visitCollectionProperty:e=>n?{type:"replace",value:s(e)}:{type:"keep"},visitCollectionPropertyPointer:e=>{if(!n)return{type:"keep"};const t=s(e.propertyId);if(!t)return{type:"replace",value:void 0};const i=(0,f().fI)({collectionStore:o,sourceTemplateType:"collection",sourcePrimitiveId:e.id,dependencyMap:n});return i?{type:"replace",value:{id:i,propertyId:t,spaceId:o.getSpaceId(),table:V().Vl}}:(r.warn(`Failed to remap collection ID ${e.id} in automation template`),{type:"replace",value:void 0})},visitFormulaContextValue:e=>({type:"replace",value:a(e)}),visitFormulaPageProperty:e=>{if(!n)return{type:"keep"};const t=(0,l().mg)(e),i=s(e.property);if(!i)return{type:"replace",value:void 0};if(t.property=i,"collection"in t&&t.collection){const e=(0,f().fI)({collectionStore:o,sourceTemplateType:V().Vl,sourcePrimitiveId:t.collection.id,dependencyMap:n});if(!e)return r.warn(`Failed to remap collection ID ${t.collection.id} in automation template`),{type:"replace",value:void 0};t.collection=C().L3.fromSpaceShardRecordId({id:e,spaceId:o.getSpaceId()},V().Vl)}else"contextValueId"in t&&t.contextValueId&&(t.contextValueId=a(t.contextValueId));return{type:"replace",value:t}},visitRecordPointer:e=>{if(!n)return{type:"keep"};if(e.table===P().ev||e.table===V().Vl||e.table===b().yB||e.table===i().Gy){const t=(0,f().fI)({collectionStore:o,sourceTemplateType:e.table,sourcePrimitiveId:e.id,dependencyMap:n});return t?{type:"replace",value:C().L3.fromSpaceShardRecordId({id:t,spaceId:o.getSpaceId()},e.table)}:(r.warn(`Failed to remap record pointer ${C().L3.toKey(e)} in automation template`),{type:"replace",value:void 0})}return{type:"keep"}}}}o(16280);var O=()=>o(388821),N=()=>o(722101),D=()=>o(44729),z=()=>o(71584);var L=()=>o(227157),$=(o(944114),o(803949),()=>o(246826));function G(e){let{environment:t,transaction:o,collectionStore:n,template:r,logger:a,preserveCollectionFeatureOrdering:l}=e;const c=n.getParentBlockStore();if(!c)throw new Error("Collection view block store not found");const{value:s,dependencyMap:p}=r;if(!p)throw new Error("Dependency map not defined on view template");h({environment:t,collectionStore:n,collectionViewValue:s,dependencyMap:p,logger:a}),function(e){var t;let{collectionStore:o,collectionViewValue:n}=e;const r=null===(t=n.format)||void 0===t?void 0:t.table_properties;if(!r)return;const i=r.map((e=>e.property)),a=Object.keys(o.getSchema()).filter((e=>!i.includes(e)));for(const l of a)r.push({property:l,visible:!1})}({collectionStore:n,collectionViewValue:s});const d=$().eC({environment:t,table:i().Gy,inMemoryRecordCache:c.inMemoryRecordCache,value:{...s,parent_id:c.id,parent_table:c.table,space_id:c.getSpaceId(),format:{...s.format,collection_pointer:n.pointer},alive:!0},transaction:o}),m=u().pS.createChildStore(c,d.pointer),v=c.getCollectionViewsStore();if(l){const e=function(e){let t,{collectionTemplate:o,collectionViewStores:n,collectionViewTemplate:r}=e,i=-1;const a=o.value.templateItems.findIndex((e=>e.pointer===r.templateId));return n.forEach((e=>{var n;const r=null===(n=e.getFormat().workflow_template_instance)||void 0===n?void 0:n.template_id;if(!r)return;const l=o.value.templateItems.findIndex((e=>e.pointer===r));l>a||l>i&&(i=l,t=e.id)})),t}({collectionTemplate:l,collectionViewStores:c.getCollectionViewStores(),collectionViewTemplate:r});e?N().BC({parentStore:v,appendStore:m,transaction:o,after:e}):N().Hs({parentStore:v,prependStore:m,transaction:o})}else N().BC({parentStore:v,appendStore:m,transaction:o});return{type:"collection_view",id:m.id}}var W=()=>o(498212);var q=()=>o(220719),U=()=>o(447934);var Q=()=>o(428045),H=()=>o(443881),j=()=>o(931075),K=()=>o(183558),X=()=>o(312296);function Z(e){const{environment:t,logger:o,transaction:r,collectionStore:i,template:a}=e,c=function(e){if("title"===e.value.type)return"title";if(e.templateId===Q().RE)return j()._e.Verification;if(e.templateId===Q().dr)return j()._e.Owner;return(0,K().Ay)()}(a);if((0,n().PC)(a,"formula"))Y({...e,template:a});else if((0,n().Ox)(a)){const t=v().globalWorkflowTemplates.featureFromId(a.buttonAutomationId);o.log(`Instantiating dependency "${t.templateId}" of button property template "${a.templateId}".`);const n=oe({...e,template:t});if(!n)throw new Error(`Failed to create instance of automation template "${t.templateId}"`);if("automation"!==n.type)throw new Error(`Unexpected instance pointer. Expected "automation" but got "${n.type}"`);a.value.automation_id=n.id}const s=(0,l().mg)(a.value);return s.workflow_template_instance={template_id:a.templateId},(0,X().F)({environment:t,collectionStore:i,update:{[c]:s},transaction:r}),{type:"property",id:c,collectionId:i.id}}function Y(e){let{template:t,collectionStore:o}=e;const{value:n,dependencyMap:r}=t;if(!r)return;if(!n.formula2)return;const{value:i}=(0,H().RI)({baseUrl:x().A.domainBaseUrl,formula:n.formula2.code,publicDomainName:x().A.publicDomainName,spaceId:o.getSpaceId(),visitors:{visitFormulaContextValue:void 0,visitFormulaPageProperty:e=>{const t={...e};return t.property=(0,f().CB)({dependencyMap:r,collectionStore:o,sourcePrimitiveId:e.property,sourceTemplateType:"property"}),"collection"in t&&t.collection&&(t.collection=o.pointer),{type:"replace",value:t}},visitRecordPointer:void 0}});n.formula2.code=i}var J=()=>o(290966),ee=()=>o(839754);function te(e){let{environment:t,transaction:o,collectionStore:n,template:r,logger:i,origin:a,examplePageStores:l,preserveCollectionFeatureOrdering:c}=e;const s=oe({transaction:o,environment:t,collectionStore:n,template:r,logger:i,origin:a,preserveCollectionFeatureOrdering:c}),p=(0,v().getPropertyTemplates)([r]);return(0,ee().My)({transaction:o,collectionStore:n,propertyTemplates:p}),(0,ee().Bi)({transaction:o,collectionStore:n,propertyTemplates:p}),re({environment:t,transaction:o,collectionStore:n,template:r,logger:i,examplePageStores:l}),s}function oe(e){const{collectionStore:t,template:o,transaction:r}=e;!function(e){const{template:t,logger:o}=e,r=(0,n().Z6)({template:t,logger:o}),{environment:i,collectionStore:a}=e;for(const n of r){(0,f().Zp)({environment:i,scopeStore:a,templateId:n.templateId})||(o.log(`Template "${t.templateId}" has implicit dependency "${n.templateId}" (source: ${n.debugSource}), instantiating it.`),oe({...e,template:v().globalWorkflowTemplates.featureFromId(n.templateId)}))}}(e);const i=function(e){const{logger:t}=e,o=l().mg(e.template),{type:r}=o;switch(t.log(`Instantiating ${r} template "${o.templateId}".`),r){case"property":return Z({...e,template:o});case"collection_view":return G({...e,template:o});case"layout":return function(e){let{environment:t,transaction:o,collectionStore:n,template:r}=e;if(!r.dependencyMap)throw new Error("Dependency map not defined on layout template");const i=(0,S().f)({collectionStore:n,modules:{page_layout_schema:void 0,page_info_layout_schema:void 0,form_layout_schema:void 0,...r.value},dependencyMap:r.dependencyMap}),{model:a}=(0,U().$L)({environment:t,transaction:o,collectionStore:n,userId:(0,q().o9)(t.currentUser.id),modules:i});return{type:"layout",id:a.id,spaceId:n.getSpaceId()}}({...e,template:o});case"compound":return function(e){const{environment:t,template:o,collectionStore:r,logger:i}=e,a=[],l=e=>{if(!(0,f().DM)(e)||"compound"===e.type)throw new Error(`Template in compound template generated a non-feature instance pointer of an illegal type: ${e.type}`);a.push(e)};for(const c of o.value.templateItems){const{optionality:a,pointer:s}=c;if("optionalDefaultOff"===a)continue;const p=(0,f().Zp)({environment:t,scopeStore:r,templateId:c.pointer});if(p){l(p);continue}const d=v().globalWorkflowTemplates.fromId(s);if(!(0,n().$K)(d))throw new Error(`${d.templateId} in compound template is of an illegal type: ${d.type}`);i.log(`Instantiating dependency "${d.templateId}" of compound template "${o.templateId}".`);const m=te({...e,template:d});m&&l(m)}return{type:"compound",id:(0,W().Ay)(),instancePointers:a,collectionId:r.id}}({...e,template:o});case"block":return function(e){let{environment:t,transaction:o,collectionStore:n,template:r}=e;const i=(0,B().zP)({environment:t,spaceId:n.getSpaceId(),table:P().ev});if("block"!==r.type)throw new Error(`Expected block template, got ${r.type} template: ${r.templateId}`);if(!r.dependencyMap)throw new Error(`Dependency map not defined on block template: ${r.templateId}`);const{dependencyMap:a}=r,l=O().RecordMap.create(r.value.recordMap),c=l.getModel(r.value.blockPointer);if(c){const e=c.getProperties();for(const[t,o]of Object.entries(e)){const r=(0,f().CB)({collectionStore:n,sourceTemplateType:"property",sourcePrimitiveId:t,dependencyMap:a});r&&(delete e[t],e[r]=o)}}const{targetBlockStore:s}=z().localDuplicate({environment:t,sourceBlockId:r.value.blockPointer.id,targetBlockPointer:i,sourceBlockSubtree:l,transaction:o,deepCopyTransclusionContainers:!1,targetInMemoryRecordCache:n.inMemoryRecordCache,resolveTemplateVariables:!1});return D().X$({childStore:s,parentStore:n,transaction:o}),s.isTemplate()&&N().BC({parentStore:n.getTemplatePagesStore(),appendStore:s,transaction:o}),{type:"block",id:s.id,spaceId:n.getSpaceId()}}({...e,template:o});case"automation":return F({...e,template:o});default:(0,c().HB)(r)}}(e);return i&&(0,J().ZQ)({transaction:r,collectionStore:t,templateId:o.templateId,instance:i,logger:e.logger}),i}function ne(e){let{environment:t,transaction:o,collectionStore:n,template:r,instancePointer:i,examplePageStores:a}=e;if(a&&"property"===i.type)for(const l of a){const e=(0,L().gv)({collectionStore:n,dependencyMap:r.dependencyMap??{},exampleRow:{properties:l.getProperties()}});(0,m().L)({environment:t,store:l,properties:e.properties,transaction:o})}}function re(e){let{environment:t,transaction:o,collectionStore:n,template:l,logger:c,examplePageStores:s}=e;const d=(0,f().Sl)({environment:t,collectionStore:n});for(const{instancePointer:m,templateId:f}of d){if("collection"===m.type)continue;const e=v().globalWorkflowTemplates.fromId(f),d=e.dependencyMap&&Object.values(e.dependencyMap).includes(l.templateId);if(!("dependencyMap"in e)||!e.dependencyMap||!d){ne({environment:t,transaction:o,collectionStore:n,template:l,examplePageStores:s,instancePointer:m});continue}c.log(`Remapping dependency "${l.templateId}" in "${f}".`);const g={};if("layout"===m.type){const e=u().K_.createChildStore(n,{table:a().zx,id:m.id,spaceId:m.spaceId}),t=e.getRawModules();if(t){const i=(0,S().f)({collectionStore:n,modules:t,dependencyMap:g});p().applyOperation({transaction:o,store:e,operation:r().N4X.updateModules(e.pointer,i)})}}else if("collection_view"===m.type){const e=u().pS.createChildStore(n,{table:i().Gy,id:m.id}),o=e.getType();if(!o)continue;h({environment:t,collectionStore:n,collectionViewValue:{type:o,name:e.getName(),format:e.getFormat(),query2:e.getRawQuery()},dependencyMap:g,logger:c})}else c.warn(`Don't know how to remap instance type "${m.type}"!`)}}function ie(e){let{environment:t,collectionStore:o}=e;const n=(0,f().Sl)({environment:t,collectionStore:o});for(const{instancePointer:r}of n)if("collection_view"===r.type){const e=u().pS.createChildStore(o,{table:i().Gy,id:r.id});if(!e.getType())continue;g({collectionViewFormat:e.getFormat()})}}function ae(e){let{environment:t,transaction:o,collectionViewBlockStore:n,collectionStore:r,instancePointer:i}=e;const a=i.type;switch(a){case"property":s().BJ({environment:t,collectionStore:r,schema:r.getSchema(),property:i.id,transaction:o,permanentlyDelete:!1});break;case"collection_view":if(!n)return;const e=n.getCollectionViewStores().find((e=>e.id===i.id));e&&(0,d().T)({collectionViewBlockStore:n,collectionViewStore:e,transaction:o});break;case"layout":case"block":case"automation":break;default:(0,c().HB)(a)}}},154152:(e,t,o)=>{o.d(t,{z:()=>r});var n=()=>o(32454);async function r(e){(0,n().moveToNextOnboardingStep)();await e.submitPrompt({from:"initial-input"})&&(0,n().moveToNextOnboardingStep)()}},227157:(e,t,o)=>{o.d(t,{Ls:()=>U,mm:()=>$,my:()=>G,gv:()=>W});o(16280),o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(581454);var n=()=>o(663077),r=()=>o(179034),i=()=>o(869558),a=()=>o(96689),l=()=>o(854150),c=()=>o(919709),s=()=>o(534177),p=()=>o(970330),d=()=>o(612008),m=()=>o(557281),u=()=>o(896628),v=()=>o(722101),f=()=>o(44729),h=()=>o(246826),g=()=>o(185544),S=()=>o(955930),y=()=>o(317909),w=()=>o(519831),I=()=>o(272600),_=()=>o(630116);function T(e){const{environment:t,collectionViewBlockStore:o,transaction:n,collectionValue:i}=e,a=h().eC({environment:t,table:w().Vl,value:{...i,parent_id:o.id,parent_table:r().ev,alive:!0,space_id:o.getSpaceId()},inMemoryRecordCache:o.inMemoryRecordCache,transaction:n}),l=_().md.createChildStore(o,a.pointer);return(0,I().p)({collectionViewBlockStore:o,collectionPointer:l.pointer,transaction:n}),l}var C=()=>o(414360),b=()=>o(409902),k=()=>o(586481),P=()=>o(389658),V=()=>o(972435),M=()=>o(493260),A=()=>o(351360),x=()=>o(441307),B=()=>o(32454),R=()=>o(338907),F=()=>o(913454),E=()=>o(204067),O=()=>o(101926),N=(o(898992),o(354520),()=>o(27732)),D=()=>o(290966);function z(e){const{environment:t,transaction:o,collectionStore:r,template:i,targetCollectionStore:a,logger:l}=e,{value:c}=i,s=(0,O().ai)(e);if(!s)throw new Error(`relationPropertyPointer not created for ${i.templateId}`);if("property"!==s.type)throw new Error(`Instance pointer returned is not of property type: ${s.type}`);const p=new(x().A)(t);p.setContext({type:"collectionPage",collectionStore:r});const{inverseRelationPropertyId:d}=N().cT({environment:t,transaction:o,intl:V().A.getIntl(),collectionContextStore:p,collectionStore:r,property:s.id,targetCollectionStore:a,hasInverseRelation:!0,inverseName:void 0,propertyName:c.name,autoRelate:c.autoRelate,propertyLimit:1===c.limit?"1":"no_limit"});if(d){const e=function(e){let{environment:t,sourceCollectionStore:o,targetCollectionStore:r}=e;const i=(0,E().tY)({environment:t,collectionStore:o}),a=(0,E().tY)({environment:t,collectionStore:r});if(!i||!a)return;const l=(0,n().bQ)(a).map((e=>F().globalWorkflowTemplates.fromId(e))).filter((e=>(0,n().Sz)(e)));for(const n of l)if(n.relatedCollectionTemplateId===i.templateId)return n}({environment:t,sourceCollectionStore:r,targetCollectionStore:a});e&&(l.log(`Instantiating relation property template "${e.templateId}" because it is the inverse of "${i.templateId}".`),(0,D().ZQ)({transaction:o,collectionStore:a,templateId:e.templateId,instance:{type:"property",id:d,collectionId:a.id},logger:l}))}return s}var L=()=>o(839754);function $(e){var t;let{environment:o,transaction:r,template:a,parentStore:l,existingCollectionInfo:s,inMemoryRecordCache:v,selectedFeatureTemplateIds:f,collectionViewBlockType:g="collection_view_page",relationInfos:S,logger:y}=e;y.log(`Instantiating collection template "${a.templateId}".`);const{collectionStore:w,collectionViewBlockStore:I}=function(e){var t;let o,{environment:n,transaction:r,template:i,parentStore:a,existingCollectionInfo:l,collectionViewBlockType:s="collection_view_page",inMemoryRecordCache:p,logger:d}=e;if(!(0,F().isCollectionTemplateParentStore)(a))throw new Error(`Parent store is not a valid  collection template parent store ${a.table}`);if(l){const{collectionStore:e,collectionViewStore:t}=l;o=l.collectionViewBlockStore,t&&(0,C().T)({collectionViewBlockStore:o,collectionViewStore:t,transaction:r}),e&&(0,b().h)({collectionViewBlockStore:o,collectionStore:e,transaction:r})}else o=q({environment:n,transaction:r,parentStore:a,collectionViewBlockType:s,inMemoryRecordCache:p});const{name:m,icon:u,description:v}=i.value.targetCollection,f=T({environment:n,collectionViewBlockStore:o,transaction:r,collectionValue:{name:(0,c().x9d)(m),icon:u,description:v,format:{item_name_config:i.value.targetCollection.itemName,item_name_config_v2:null===(t=i.value.targetCollection.format)||void 0===t?void 0:t.item_name_config_v2},schema:{title:{name:V().A.formatMessage(P().n4.namePropertyTitle),type:"title"}}}});if(!A().default.state.currentSpaceStore)throw new Error("No current space store");return{collectionStore:f,collectionViewBlockStore:o}}({environment:o,transaction:r,template:a,parentStore:l,existingCollectionInfo:s,collectionViewBlockType:g,inMemoryRecordCache:v,logger:y});(0,D().ZQ)({transaction:r,collectionStore:w,templateId:a.templateId,instance:{type:"collection",id:w.id},logger:y});const{allFeatureTemplates:M,nonRelationPropertyTemplates:N}=function(e){let{template:t,selectedFeatureTemplateIds:o}=e;if(o){const e=new Set((0,n().bQ)(t));for(const n of o)if(!e.has(n))throw new Error(`Feature template ID ${n} is not part of collection template ${t.templateId}`)}const{templateItems:r}=t.value,i=(0,n().b2)(r,"required"),a=(0,n().b2)(r,"optionalDefaultOn"),l=new Set([...i,...o??a]),c=Array.from(l).map(F().globalWorkflowTemplates.featureFromId),s=[],p=[];for(const d of c)(0,n().Sz)(d)?s.push(d):p.push(d);return{allFeatureTemplates:c,relationPropertyTemplates:s,nonRelationPropertyTemplates:p}}({template:a,selectedFeatureTemplateIds:f}),$=[];for(const n of N){const e=(0,O().e_)({environment:o,transaction:r,collectionStore:w,template:n,logger:y,origin:"collection_creation"});"collection_view"===(null==e?void 0:e.type)&&$.push(e),(0,O().Ix)({environment:o,transaction:r,collectionStore:w,template:n,logger:y})}if(0===$.length)throw new Error("No collection view templates to create");const G=_().pS.createChildStore(I,{table:i().Gy,id:$[0].id});S&&function(e){let{environment:t,transaction:o,currentCollectionStore:n,relationInfos:r,logger:i}=e;for(const a of r){const{sourceCollectionStore:e,targetCollectionStore:r}=Q({currentCollectionStore:n,relationInfo:a});z({environment:t,transaction:o,origin:"collection_creation",collectionStore:e,targetCollectionStore:r,template:a.relationPropertyTemplate,logger:i})}}({environment:o,transaction:r,currentCollectionStore:w,relationInfos:S,logger:y});const U=(0,F().getPropertyTemplates)(M);(0,L().My)({transaction:r,collectionStore:w,propertyTemplates:U}),(0,L().Bi)({transaction:r,collectionStore:w,propertyTemplates:U}),function(e){const{transaction:t,collectionStore:o,template:n,logger:r}=e,{format:i}=n.value.targetCollection;if("object"!=typeof(null==i?void 0:i.collection_default_template))return;const a=(0,E().fI)({collectionStore:o,sourceTemplateType:"block",dependencyMap:n.dependencyMap??{},sourcePrimitiveId:i.collection_default_template.template_page_id});a?u().zA({stores:[o],update:{collection_default_template:{template_page_id:a}},transaction:t}):r.warn("Unable to resolve collection default template, omitting it.")}({transaction:r,template:a,collectionStore:w,logger:y}),"tasks"===a.category&&(0,B().maybeAddAppTemplateMetadataForTasks)({environment:o,collectionStore:w,collectionViewBlockStore:I,transaction:r}),function(e){let{transaction:t,collectionViewBlockStore:o}=e;const n=o.getFormat();("workflow_template_placeholder"===n.collection_view_sub_type||n.placeholder_workflow_template_id)&&u().zA({stores:[o],update:{placeholder_workflow_template_id:void 0,collection_view_sub_type:void 0},transaction:t})}({transaction:r,collectionViewBlockStore:I});let H=[];return null!==(t=a.value.exampleRows)&&void 0!==t&&t.length&&(0,R().Tl)()&&(H=function(e){let{environment:t,transaction:o,collectionStore:n,collectionViewStore:r,collectionViewBlockStore:i,exampleRows:a,dependencyMap:l}=e;const c=new(x().A)(t);c.setContext({type:"collectionView",collectionViewBlockStore:i,collectionStore:n,collectionViewStore:r,pageVisitSourceOverride:void 0});const s=[],p=c.defaultPageTemplateStore.state,{inMemoryRecordCache:u}=i;for(const v of a){const{newStore:e}=(0,d().Q)({environment:t,collectionContextStore:c,groupsPointer:[],insertAtIndex:0,shouldCoerce:!0,transaction:o,from:{createBlock:"workflow_template"},inMemoryRecordCache:u});s.push(e);const r=W({collectionStore:n,dependencyMap:l,exampleRow:v});(0,k().L)({environment:t,store:e,properties:r.properties,transaction:o}),p&&m().n5({title:"template",environment:t,store:e,templateStore:p,isKeyboard:!1,isCreateIn:!1,transaction:o,from:"collection_template_actions"});const i=e.getIconStore();v.icon&&i&&h().KY({store:i,value:v.icon,transaction:o})}return s}({environment:o,transaction:r,collectionStore:w,collectionViewStore:G,collectionViewBlockStore:I,exampleRows:a.value.exampleRows,dependencyMap:a.dependencyMap??{}})),r.postSubmitCallbacks.push((e=>{e||p().v(o,{from:"workflow_template",type:I.getType()??"collection_view_page",creating_block_id:I.id,collection_view_block_id:I.id,collection_view_id:G.id,collection_id:w.id,view_type:G.getType()})})),{collectionStore:w,collectionViewStore:G,collectionViewBlockStore:I,examplePageStores:H}}async function G(e){const{environment:t,parentStore:o,title:n,onFinish:r}=e,{serverCommitResult:a,performResult:{collectionViewBlockStore:l,collectionViewStore:s,collectionStore:d}}=y().createAndCommit({userAction:"workflowTemplatesOnboardingModal.addEmptyDatabase",environment:t,canUndo:!0,perform:r=>{let a=e.collectionViewBlockStore;void 0===a&&(a=q({environment:t,transaction:r,parentStore:o,collectionViewBlockType:"collection_view_page",inMemoryRecordCache:o.inMemoryRecordCache}),p().v(t,{from:"workflow_template",type:"page",new_page_id:a.id,creating_block_id:a.id}));const l=T({environment:t,collectionViewBlockStore:a,transaction:r,collectionValue:{name:n?(0,c().x9d)(n):void 0}}),s=h().eC({environment:t,table:i().Gy,inMemoryRecordCache:a.inMemoryRecordCache,value:{type:"table",parent_id:a.id,parent_table:a.table,space_id:a.getSpaceId(),format:{collection_pointer:l.pointer},alive:!0},transaction:r}),d=_().pS.createChildStore(a,s.pointer);return(0,M().F)(d.id,{viewType:"table",isPlaceholderCollection:!0}),v().BC({parentStore:a.getCollectionViewsStore(),appendStore:d,transaction:r}),{collectionViewBlockStore:a,collectionViewStore:d,collectionStore:l}}});return await a,r&&r(l),{collectionViewBlockStore:l,collectionViewStore:s,collectionStore:d}}function W(e){let{exampleRow:t,dependencyMap:o,collectionStore:n}=e;const r={properties:{}};for(const[i,a]of Object.entries(t.properties))r.properties[(0,E().CB)({collectionStore:n,sourceTemplateType:"property",dependencyMap:o,sourcePrimitiveId:i})]=a;return r}function q(e){var t;let{environment:o,transaction:n,parentStore:r,collectionViewBlockType:i,inMemoryRecordCache:a}=e;const l=h().Wv({environment:o,type:i,inMemoryRecordCache:a,transaction:n});return h().zv({store:l,transaction:n,data:{parent_id:r.id,parent_table:r.table,alive:!0}}),U({environment:o,spaceViewStore:null===(t=A().default.state.currentSpaceViewStore)||void 0===t?void 0:t.clone(a),parentStore:r,collectionViewBlockStore:l,transaction:n,appendOrPrepend:"append"}),l}function U(e){let{environment:t,parentStore:o,collectionViewBlockStore:n,transaction:i,appendOrPrepend:c,spaceViewStore:p}=e;if(o.table===r().ev)f().NI({parentStore:o,childStore:n,transaction:i});else if(o.table===a().NX){if((null==p?void 0:p.getSpaceId())!==o.id)throw new Error(`spaceViewStore doesn't match parent with ID ${o.id}`);g().yM({environment:t,spaceStore:o,spaceViewStore:p,pageStore:n,isPrivate:!0,transaction:i})}else o.table===l().yK?S().sP({teamStore:o,store:n,transaction:i,location:{type:c}}):(0,s().HB)(o)}function Q(e){let{currentCollectionStore:t,relationInfo:o}=e;const{type:n,collectionStore:r}=o;return"source"===n?{sourceCollectionStore:r,targetCollectionStore:t}:"target"===n?{sourceCollectionStore:t,targetCollectionStore:r}:void(0,s().HB)(n)}},349379:(e,t,o)=>{o.d(t,{DF:()=>p,If:()=>s,Vd:()=>c,g2:()=>l,os:()=>a});var n=()=>o(116225),r=()=>o(989423),i=()=>o(508496);function a(e){let{environment:t,eventProperties:o}=e;const n="suggested_collection_template_clicked";(0,r().u4)({environment:t,event:{eventName:n,eventProperties:o}}),i().default.logEvent(n,o.collection_template_id,o)}function l(e){let{environment:t,eventProperties:o,modalState:a}=e;const l="workflow_template_onboarding_done";var c;((0,r().u4)({environment:t,event:{eventName:l,eventProperties:o}}),i().default.logEvent(l,o.collection_template_id,o),n().u4({name:"collection_created_from_workflow_template",args:{template_id:o.collection_template_id??"",origin:o.origin,experiment_group:"personalized"}}),a.collectionTemplate.isAiGenerated)&&(null===(c=a.setupGenerator)||void 0===c||c.trackSessionEnded({reason:"instantiated"}))}function c(e){let{environment:t,eventProperties:o}=e;const n="setup_generator_session_started";(0,r().u4)({environment:t,event:{eventName:n,eventProperties:o}}),i().default.logEvent(n,void 0,o)}function s(e){let{environment:t,eventProperties:o}=e;const n="setup_generator_generated_setup";(0,r().u4)({environment:t,event:{eventName:n,eventProperties:o}}),i().default.logEvent(n,void 0,o)}function p(e){let{environment:t,eventProperties:o}=e;const n="template_picker_opened";(0,r().u4)({environment:t,event:{eventName:n,eventProperties:o}}),i().default.logEvent(n,o.origin,o)}},370657:(e,t,o)=>{o.d(t,{Cx:()=>r,RD:()=>i,d7:()=>l,r5:()=>n,s8:()=>a});const n=[{type:"markdown-chat"},{type:"search",scopeForNextSearch:{type:"everything"}},{type:"researcher",maxIterations:4,ignoreUnverifiedClaims:!1,filterArtifacts:!1,filterToSpaceSharedResults:!1,fastMode:!0,evaluateAsync:!0,searchOriginalQueryFirst:!1,runInQueue:!1,useWebSearch:!0,thinkingTokens:1024,numSearchResultsMultiplier:1,useOutline:!1},{type:"workflow"}],r=[...n,{type:"simple-workflow"},{type:"setup-generator"},{type:"fast-researcher"},{type:"tool-markdown-chat"}],i="unifiedFind",a={originalOutput:[],feedback:"",inputSummary:"",promptFeedback:"",testInstructions:"",originalOutputPassesTest:!1,originalOutputTestResults:[],correctedOutputs:[],verified:!1},l=["Eval","Prompt"];'\n\'Chat with AI\':\n\nRouting Instructions:\n- Route to this mode when the user requests creative content, explanations without current or specialized knowledge, opinions, brainstorming, or hypothetical scenarios.\n- Do NOT route to this mode when the query requires current statistics, facts, or up-to-date information, or when the user wants to build a specific system or application in Notion.\n\nExamples:\n1. "Tell me a bedtime story about a robot who learns to dream."\n2. "What are the key ideas behind design thinking?"\n3. "Write a haiku about the first snowfall."\n4. "Can you help me come up with some fun activities for a virtual team meeting?"\n5. "Explain quantum entanglement like I\'m five years old."\n6. "Do you think AI will ever have emotions?"\n7. "Imagine a conversation between Shakespeare and a modern playwright."\n8. "How can I become more confident when speaking in public?"\n9. "List some common cognitive biases in decision making."\n10. "What does servant leadership mean in today\'s world?"\n'.trim(),'\n\'Quick search\':\n\nRouting Instructions:\n- Route to this mode when the query seeks a single, specific fact, definition, or data point, or when the user needs current or time-sensitive information.\n- Do NOT route to this mode when the request requires synthesizing multiple pieces of information or when the user wants creative content or subjective opinions.\n\nExamples:\n1. "GDP of Japan 2023"\n2. "Who\'s the CEO of Tesla?"\n3. "Tiramisu recipe"\n4. "When was the EU formed?"\n5. "Population of Toronto?"\n6. "What are the symptoms of vitamin D deficiency?"\n7. "Height of Empire State Building"\n8. "USD to Euro rate today?"\n9. "Average rainfall Seattle?"\n10. "When is the next solar eclipse in North America?"\n'.trim(),'\n\'Deep research\':\n\nRouting Instructions:\n- Route to this mode when the query explicitly requests research, analysis, or in-depth exploration, or when the request requires synthesizing information from multiple sources.\n- Do NOT route to this mode when the query can be answered with a single fact or when the user is asking for creative content.\n\nExamples:\n1. "How has AI affected job markets in different industries over the last decade?"\n2. "Can you compare the healthcare systems of Canada, the UK, Germany, and Singapore in terms of efficiency and accessibility?"\n3. "How have climate change policies evolved since the Paris Agreement?"\n4. "What are the different approaches to quantum computing and their respective uses?"\n5. "What psychological effects does social media have on teenagers?"\n6. "How has renewable energy technology evolved, and what is its economic impact?"\n7. "What are the current promising treatments for Alzheimer\'s that are in development?"\n8. "What are the trends and geopolitical implications of the global semiconductor supply chain?"\n9. "Can you compare different machine learning frameworks used for natural language processing?"\n10. "What are the ethical issues surrounding gene editing technologies?"\n'.trim(),'\n\'App builder\':\n\nRouting Instructions:\n- Route to this mode when the query explicitly mentions building, creating, or designing an app or system, or when the request involves automating processes within Notion or external tools.\n- Do NOT route to this mode when the user is seeking information rather than building a system or when the request is for creative content or general conversation.\n\nExamples:\n1. "Create a task management app with deadlines and team assignments."\n2. "Develop a CRM that tracks client interactions and schedules follow-ups."\n3. "Design an invoice system that sends payment reminders."\n4. "Build a knowledge base that categorizes notes by topic automatically."\n5. "Set up a content calendar for social media posts."\n6. "Create a recruitment pipeline for interview stages."\n7. "Dashboard for visualizing Notion database metrics?"\n8. "Process and categorize customer feedback automatically"\n9. "Habit tracker with reminders and streaks?"\n10. "Workflow to sync Slack messages to Notion and tag by priority?"\n'.trim()},458097:(e,t,o)=>{o.d(t,{A:()=>i});class n extends(()=>o(757695))().default{getInitialState(){return{open:!1,isShowingLoadingState:!1}}updateUserCustomizations(e,t){this.state.open&&this.state.collectionTemplate&&this.setState({...this.state,userCustomizations:{...this.state.userCustomizations,[e]:t}})}updateCollectionTemplate(e){this.state.open&&this.state.collectionTemplate&&this.setState({...this.state,collectionTemplate:e})}updatePreviewFocusViewTemplateId(e){this.state.open&&this.state.collectionTemplate&&this.state.previewCollectionInfo&&this.state.previewCollectionInfo.focusViewTemplateId!==e&&this.setState({...this.state,previewCollectionInfo:{...this.state.previewCollectionInfo,focusViewTemplateId:e}})}updatePreviewCollectionContextStore(e){this.state.open&&this.state.collectionTemplate&&this.state.previewCollectionInfo&&this.state.previewCollectionInfo.collectionContextStore!==e&&this.setState({...this.state,previewCollectionInfo:{...this.state.previewCollectionInfo,collectionContextStore:e}})}getPreviewCollectionContextStore(){if(this.state.open&&this.state.collectionTemplate&&this.state.previewCollectionInfo)return this.state.previewCollectionInfo.collectionContextStore}getParentStore(){return this.state.open?this.state.parentStore:void 0}getShouldShowExpandedTemplateList(){return this.state.open&&this.state.shouldShowExpandedTemplateList}setShouldShowExpandedTemplateList(e){this.state.open&&this.setState({...this.state,shouldShowExpandedTemplateList:e})}close(e){var t,o;this.state.open&&(null===(t=(o=this.state).onClose)||void 0===t||t.call(o,e),this.setState({open:!1,isShowingLoadingState:!1}))}reset(){this.setState(this.getInitialState())}}const r=new n;(0,o(604341).exposeDebugValue)("InitializeWorkflowTemplateModalStore",r);const i=r},839754:(e,t,o)=>{o.d(t,{Bi:()=>m,My:()=>d,ZM:()=>u});o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(354520),o(581454);var n=()=>o(663077),r=()=>o(919709),i=()=>o(686526),a=()=>o(896628),l=()=>o(606952),c=()=>o(317909),s=()=>o(519839),p=()=>o(204067);function d(e){var t;let{transaction:o,collectionStore:r,propertyTemplates:i}=e;const l=(null===(t=r.getParentBlockStore())||void 0===t?void 0:t.getCollectionViewStores().filter((e=>"table"===e.getType())))??[];if(0===l.length)return;const c=[];for(const a of i){const e=(0,p().S1)({collectionStore:r,templateId:a.templateId,instancePointerType:"property"});e&&c.push({property:e.id,visible:!(0,n().Sz)(a),...a.tablePropertyFormat})}if(0!==c.length)for(const n of l){var s;const e=(null===(s=n.getPropertyFormatsStore("table_properties"))||void 0===s?void 0:s.getValue())??[],t=new Set(e.map((e=>e.property))),r=c.filter((e=>!t.has(e.property)));0!==r.length&&a().zA({stores:[n],update:{table_properties:[...e,...r]},transaction:o})}}function m(e){let{transaction:t,collectionStore:o,propertyTemplates:n}=e;const r=[];for(const a of n){const e=(0,p().S1)({collectionStore:o,templateId:a.templateId,instancePointerType:"property"});e&&r.push({property:e.id,visible:!0})}const i=o.getFormat().collection_page_properties??[],l=new Set(i.map((e=>e.property))),c=r.filter((e=>!l.has(e.property)));c.length&&a().zA({stores:[o],update:{collection_page_properties:[...i,...c]},transaction:t})}function u(e){let{environment:t,userAction:o,result:n,existingCollectionViewBlockStore:a}=e;if("canceled"!==n.type){if("accepted_empty_collection"===n.type&&a){const e=a.getTitleStore(),i=(0,r().x9d)(n.newCollectionTitle);e&&c().createAndCommit({userAction:o,environment:t,canUndo:!0,perform:o=>l().KY({environment:t,store:e,transaction:o,value:i})})}if(a){var p;const e=null===(p=(0,s().UH)(a))||void 0===p?void 0:p.settingsStore;e&&i().os({collectionSettingsStore:e})}}}}}]);