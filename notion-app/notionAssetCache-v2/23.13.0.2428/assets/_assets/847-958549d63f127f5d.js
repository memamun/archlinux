"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[847,87196,93139],{847:(e,t,o)=>{o.r(t),o.d(t,{addModule:()=>X,appendStepAndRun:()=>q,createAppAndRunFromStep:()=>me,createNewWorkflowValueWithDatabases:()=>le,createWorkflowFromWorkflowStep:()=>ne,createWorkflowUpdate:()=>H,disconnectDatabase:()=>te,grantRuntimeActorSufficientAccess:()=>we,migrateWorkflowBlockToCollectionViewBlock:()=>fe,navigateToWorkflow:()=>B,overrideWorkflowData:()=>ae,removeModule:()=>oe,restoreToWorkflowStep:()=>ie,runFunctionInChat:()=>$,saveFunction:()=>Q,saveModule:()=>Y,saveTest:()=>ee,saveTrigger:()=>L,saveTriggers:()=>J,saveWorkflowStep:()=>re,startEditWorkflow:()=>pe,updateDatabasesAndViews:()=>de,useInitializationOfExternalStores:()=>ue});o(16280),o(898992),o(354520),o(430670),o(581454),o(737550);var n=o(296540),r=()=>o(584262),a=()=>o(68263),i=()=>o(179034),c=()=>o(869558),s=()=>o(234459),l=()=>o(155792),d=()=>o(798880),w=()=>o(743246),p=()=>o(758256),f=()=>o(919709),u=()=>o(725649),m=()=>o(202761),v=()=>o(724639),S=()=>o(496603),k=()=>o(498212),h=()=>o(896628),g=()=>o(722101),y=()=>o(579627),b=()=>o(246826),I=()=>o(857783),_=()=>o(185544),C=()=>o(606952),D=()=>o(317909),M=()=>o(633457),P=()=>o(582524),E=()=>o(985554),T=()=>o(118078),K=()=>o(594794),V=()=>o(351360),W=()=>o(630116),A=()=>o(94522),R=()=>o(809120),U=()=>o(235956),O=()=>o(691093);function B(e){const{environment:t,store:o}=e;I().uK({environment:t,store:o,pageVisitSource:r().y8.Workflows})}function N(e){const t=e.getMessages()??[];for(let n=t.length-1;n>=0;n--){var o;const r=null===(o=e.getStepStoreById(t[n]))||void 0===o?void 0:o.getValue();if(r&&(0,v().S7)(r))return r}}function F(e){const{environment:t,workflowStore:o,threadId:n,currentSpaceStore:r,transaction:a}=e,{currentUserStore:c}=V().default.state;if(!c)throw new Error("No current user");const s=o.getParentId();if(!s)throw new Error("No workflow parent id");const l=o.getParentId(),d=[{id:(0,k().lZ)(),type:"config",value:{type:"workflow",workflowBlockId:l}},(0,P().WM)({environment:t,userStore:c,spaceStore:r}),{id:(0,k().lZ)(),type:"workflow",workflow_block_id:o.getParentId(),value:o.getData()??{name:"Untitled"},traceId:(0,k().lZ)(),saved:!0,tag:"initial-value"}];return(0,P().v)({environment:t,threadId:n,spaceStore:r,transcript:d,threadParentPointer:{table:i().ev,id:s,spaceId:r.id},transaction:a})}function x(e){const{environment:t,threadStore:o,currentUserId:n,currentSpaceStore:r,updateSteps:a,transaction:i}=e,c=(0,P().bO)({environment:t,threadId:o.id,spaceStore:r,userId:n,transcript:a,transaction:i});return D().applyOperation({operation:{args:{ids:c},command:"listAfterMulti",path:["messages"],pointer:o.pointer},store:o,transaction:i}),a}function Z(e){const{lastUnsavedWorkflowStep:t,spaceId:o,workflowOperation:n}=e;return{id:(0,k().lZ)(),type:"workflow-operation",appliesToPointer:{table:l().mS,id:t.id,spaceId:o},workflowOperations:[n]}}function z(e){const{threadStore:t,currentWorkflowData:o,workflowBlockId:n,workflowOperation:r,spaceId:a,transaction:c,environment:s,currentSpaceStore:d}=e;if(t){const e=function(e){const t=N(e);if(t&&(0,v().Kr)(t))return t}(t);if(e)return[Z({lastUnsavedWorkflowStep:e,spaceId:a,workflowOperation:r})]}const w=function(e){const{workflowData:t,workflowBlockId:o,transaction:n,environment:r,currentSpaceStore:a}=e,c=(0,k().lZ)(),s=S().mg(t);if(o){const e=b().eC({environment:r,table:p().U6,value:{id:(0,k().lZ)(),type:"version",created_at:Date.now(),parent_id:o,parent_table:i().ev,space_id:a.id,data:{createdAt:Date.now(),threadMessagePointer:{table:l().mS,id:c,spaceId:a.id}}},inMemoryRecordCache:a.inMemoryRecordCache,transaction:n});s.versionPointer=e.pointer}return{id:c,type:"workflow",value:s,workflow_block_id:o,traceId:(0,k().lZ)(),tag:"user-edit",saved:!1,completed:!0}}({workflowData:o,workflowBlockId:n,transaction:c,environment:s,currentSpaceStore:d});return[w,Z({lastUnsavedWorkflowStep:w,spaceId:a,workflowOperation:r})]}function G(e){const{currentSpaceStore:t}=V().default.state;if(!t)throw new Error("No current space");const o=e.currentUser.id;if(!o)throw new Error("No current user");return{currentSpaceStore:t,currentUserId:o}}function j(e){const{workflowStore:t,threadStore:o,clientStore:n,environment:r}=e,a=(0,A().qS)({workflowStore:t,threadStore:o,clientStore:n,environment:r});return H({...e,currentWorkflowData:a})}function H(e){const{environment:t,workflowStore:o,threadStore:n,workflowOperation:r,currentWorkflowData:a,transaction:i}=e,{currentSpaceStore:c,currentUserId:l}=G(t),d=(null==n?void 0:n.id)??(0,K().Z1)({environment:t,table:s().To,spaceId:c.id});let w;if(o){if(w=o.getParentId(),!w)throw new Error("No workflow block parent ID")}else{if(!n)throw new Error("No workflow store or thread store - one must be defined");{const e=N(n);w=null==e?void 0:e.workflow_block_id}}const p=z({threadStore:n,currentWorkflowData:a,workflowBlockId:w,workflowOperation:r,spaceId:c.id,transaction:i,environment:t,currentSpaceStore:c});if(n)x({threadStore:n,environment:t,currentUserId:l,currentSpaceStore:c,updateSteps:p,transaction:i});else{if(!o)throw new Error("Unreachable - either threadStore or workflowStore must be defined");x({threadStore:F({threadId:d,environment:t,workflowStore:o,currentSpaceStore:c,transaction:i}),environment:t,currentUserId:l,currentSpaceStore:c,updateSteps:p,transaction:i})}return d}async function q(e){const{environment:t,workflowStore:o,threadStore:n,step:r,clientStore:a}=e,{currentSpaceStore:i,currentUserId:c}=G(t),l=(null==n?void 0:n.id)??(0,K().Z1)({environment:t,table:s().To,spaceId:i.id});let d;if(o){if(d=o.getParentId(),!d)throw new Error("No workflow block parent ID")}else{if(!n)throw new Error("No workflow store or thread store - one must be defined");{const e=N(n);d=null==e?void 0:e.workflow_block_id}}const{serverCommitResult:w,performResult:p}=D().createAndCommit({userAction:"WorkflowActions.appendWorkflowEditorStep",environment:t,canUndo:!0,perform:e=>{if(n)return x({threadStore:n,environment:t,currentUserId:c,currentSpaceStore:i,updateSteps:[r],transaction:e}),n;if(o){const n=F({threadId:l,environment:t,workflowStore:o,currentSpaceStore:i,transaction:e});return(0,T().openChatSidebar)({environment:t,chatThreadId:l}),x({threadStore:n,environment:t,currentUserId:c,currentSpaceStore:i,updateSteps:[r],transaction:e}),n}throw new Error("Unreachable - either threadStore or workflowStore must be defined")}});await w,await(0,P().WE)({environment:t,clientStore:a,threadStore:p})}function Y(e){const{module:t,...o}=e,n={workflowValueOperation:{type:"setModule",moduleKey:t.key,args:t},timestamp:Date.now()};return D().createAndCommit({userAction:"WorkflowActions.saveModule",environment:e.environment,canUndo:!0,perform:e=>j({...o,workflowOperation:n,transaction:e})}).performResult}function $(e){const{environment:t,clientStore:o,threadStore:n,workflowStore:r,workflowFunction:a,functionArgs:i,from:c}=e;if(!a)return;q({environment:t,clientStore:o,threadStore:n,workflowStore:r,step:{id:(0,k().lZ)(),type:"workflow-function-call-request",functionLabel:a.name,functionCall:{toolCallId:(0,k().lZ)(),key:a.key,args:i},from:c,traceId:(0,k().lZ)()}})}function X(e){const{module:t,...o}=e,n={workflowValueOperation:{type:"addModule",moduleKey:t.key,args:t},timestamp:Date.now()};return D().createAndCommit({userAction:"WorkflowActions.addModule",environment:e.environment,canUndo:!0,perform:e=>j({...o,workflowOperation:n,transaction:e})}).performResult}function J(e){const{triggers:t,...o}=e,n={workflowValueOperation:{type:"set",path:["triggers"],args:t},timestamp:Date.now()};return D().createAndCommit({userAction:"WorkflowActions.saveTriggers",environment:e.environment,canUndo:!0,perform:e=>j({...o,workflowOperation:n,transaction:e})}).performResult}function L(e){const{trigger:t,...o}=e,n={workflowValueOperation:{type:"setTrigger",triggerKey:t.key,args:t},timestamp:Date.now()};return D().createAndCommit({userAction:"WorkflowActions.saveTrigger",environment:e.environment,canUndo:!0,perform:e=>j({...o,workflowOperation:n,transaction:e})}).performResult}function Q(e){const{functionStore:t,fn:o,...n}=e;return D().createAndCommit({userAction:"WorkflowActions.saveFunction",environment:e.environment,canUndo:!0,perform:r=>{const a=t.getParentPointer();if(!a)throw new Error("No parent pointer");if(!a.spaceId)throw new Error("No parent space id");const i=b().eC({environment:e.environment,table:p().U6,value:{id:(0,k().lZ)(),type:"function",created_at:Date.now(),parent_id:a.id,parent_table:a.table,space_id:a.spaceId,data:o},inMemoryRecordCache:t.inMemoryRecordCache,transaction:r}),c={workflowValueOperation:{type:"setFunction",oldFunctionPointer:t.pointer,newFunctionPointer:i.pointer},timestamp:Date.now()};return j({...n,workflowOperation:c,transaction:r})}}).performResult}function ee(e){const{functionStore:t,test:o,...n}=e;return D().createAndCommit({userAction:"WorkflowActions.saveTest",environment:e.environment,canUndo:!0,perform:r=>{const a=t.getParentPointer();if(!a)throw new Error("No parent pointer");if(!a.spaceId)throw new Error("No parent space id");const i=t.getData(),c=[...((null==i?void 0:i.tests)??[]).filter((e=>e.description.name!==o.description.name)),o],s=b().eC({environment:e.environment,table:p().U6,value:{id:(0,k().lZ)(),type:"function",created_at:Date.now(),parent_id:a.id,parent_table:a.table,space_id:a.spaceId,data:{...i,tests:c}},inMemoryRecordCache:t.inMemoryRecordCache,transaction:r}),l={workflowValueOperation:{type:"setFunction",oldFunctionPointer:t.pointer,newFunctionPointer:s.pointer},timestamp:Date.now()};return j({...n,workflowOperation:l,transaction:r})}}).performResult}function te(e){const{workflowStore:t,module:o,transaction:n}=e,r=((0,A().dh)(t).modules||[]).findIndex((e=>e.key===o.key));if(-1===r)throw new Error(`Module ${o.key} not found`);const a=t.getDataStore().getKeyStore("modules").getKeyStore(r).getKeyStore("state");b().zv({store:a,data:{pointer:null},transaction:n})}function oe(e){const{workflowStore:t,module:o,transaction:n}=e,r=((0,A().dh)(t).modules||[]).filter((e=>e.key!==o.key));b().KY({store:t.getDataStore().getKeyStore("modules"),value:r,transaction:n})}function ne(e){const{environment:t,saveWorkflowStep:o,newWorkflow:n,transaction:r,workflowBlockId:a}=e,{currentSpaceStore:c,currentSpaceViewStore:s}=V().default.state;if(!c||!s)throw new Error("No current space");let l;a?l=W().Bv.createChildStore(c,{table:i().ev,id:a,spaceId:c.id}):(l=b().Wv({environment:t,type:"collection_view_page",transaction:r,inMemoryRecordCache:c.inMemoryRecordCache}),_().yM({environment:t,spaceStore:c,spaceViewStore:s,pageStore:l,isPrivate:!0,location:{type:"append"},transaction:r}));const d=b().eC({environment:t,table:w().C0,value:{data:n,parent_table:i().ev,parent_id:l.id,space_id:c.id},inMemoryRecordCache:c.inMemoryRecordCache,transaction:r});return h().zA({stores:[l],update:{workflow_id:d.id},transaction:r}),de({environment:t,store:l,previousWorkflow:void 0,workflowStore:d,newWorkflow:n,transaction:r,performPushToDatabases:!0}),se({step:o,workflowStore:d,environment:t,transaction:r}),{workflowStore:d,parentStore:l}}function re(e){const{environment:t,workflowStore:o,transaction:n,previousWorkflow:r,newWorkflow:a,saveWorkflowStep:i}=e;b().KY({store:o.getDataStore(),value:a,transaction:n});const c=o.getParentStore();if(null==c||!c.isCollectionView())throw new Error("Must be parented by a collection view");return de({environment:t,store:c,workflowStore:o,previousWorkflow:r,newWorkflow:a,transaction:n,performPushToDatabases:!0}),se({step:i,workflowStore:o,environment:t,transaction:n}),{workflowStore:o,parentStore:c}}function ae(e){const{environment:t,workflowStore:o,transaction:n,workflow:r}=e;b().KY({store:o.getDataStore(),value:r,transaction:n});const a=o.getParentStore();if(null==a||!a.isCollectionView())throw new Error("Must be parented by a collection view");de({environment:t,store:a,workflowStore:o,previousWorkflow:void 0,newWorkflow:r,transaction:n,performPushToDatabases:!1})}function ie(e){const{environment:t,workflowStore:o,transaction:n,newWorkflow:r,liveWorkflow:a,threadStore:i}=e,{currentSpaceStore:c}=V().default.state;if(!c)throw new Error("No current space");const s=o.getParentStore();if(null==s||!s.isCollectionView())throw new Error("Must be parented by a collection view");const w=(0,k().lZ)(),f=t.currentUser.id;if(!f)throw new Error("Current user id not found");const u=b().eC({environment:t,table:p().U6,value:{id:(0,k().lZ)(),type:"version",created_at:Date.now(),parent_id:s.id,parent_table:s.table,space_id:c.id,data:{createdAt:Date.now(),savedAt:Date.now(),savedByActorPointer:{table:d().oo,id:f,spaceId:c.id},threadMessagePointer:{table:l().mS,id:w,spaceId:c.id}}},inMemoryRecordCache:c.inMemoryRecordCache,transaction:n}),m=r.versionPointer,v={...r,versionPointer:u.pointer};return b().KY({store:o.getDataStore(),value:v,transaction:n}),de({environment:t,store:s,workflowStore:o,previousWorkflow:a,newWorkflow:v,transaction:n,performPushToDatabases:!0}),x({environment:t,threadStore:i,currentUserId:f,currentSpaceStore:c,transaction:n,updateSteps:[{id:w,type:"workflow",value:v,workflow_block_id:s.id,traceId:(0,k().lZ)(),saved:!0,completed:!0,restoredFromVersionPointer:m}]}),(0,T().openChatSidebar)({environment:t,chatThreadId:i.id,workflowStepId:void 0}),{workflowStore:o,parentStore:s}}function ce(e){const{environment:t,parentBlockStore:o,workflow:n,transaction:r}=e,a=o.getTitleStore();a&&(0,f().w9s)(a.getValue())&&C().KY({environment:t,store:a,value:(0,f().x9d)(n.name),transaction:r})}function se(e){const{step:t,environment:o,workflowStore:n,transaction:r}=e,a=o.currentUser.id;if(!a)throw new Error("Current user id not found");const i=n.getSpaceId();if(!i)throw new Error("Workflow space id not found");const c=W().XV.createChildStore(n,{table:l().mS,id:t.id,spaceId:i});if(!c)throw new Error("Thread message store not found");b().zv({store:c.getStepStore(),data:{workflow_block_id:n.getParentId(),value:n.getData(),saved:!0},transaction:r}),b().zv({store:c.getStepStore(),data:{workflow_block_id:n.getParentId(),value:n.getData()},transaction:r});const s=t.value.versionPointer;if(s){const e=W().je.createChildStore(n,s);b().zv({store:e.getDataStore(),data:{savedAt:Date.now(),savedByActorPointer:{table:d().oo,id:a,spaceId:i}},transaction:r})}}function le(e){var t;const{store:o}=e,n=o.getCollectionPointers()??[],{currentSpaceStore:r,currentSpaceViewStore:a}=V().default.state;if(!r||!a)throw new Error("No current space");const i=n.map((e=>{const t=W().md.createChildStore(r,e);return(0,R().PP)({collectionStore:t,databaseModules:[]})})),c=(0,A().u1)({store:o,modules:i,views:[]});return{name:(0,f().q4_)(null===(t=o.getTitleStore())||void 0===t?void 0:t.getValue())??"Untitled",modules:i,views:c}}function de(e){const{environment:t,store:o,workflowStore:n,previousWorkflow:r,newWorkflow:a,transaction:i,performPushToDatabases:c}=e;((null==a?void 0:a.modules)||[]).some((e=>{var t;return"database"===e.type&&!(null!==(t=(0,u().DK)(e.state))&&void 0!==t&&t.pointer)}))&&(0,U().qm)({environment:t,store:o,workflowStore:n,transaction:i}),c&&(0,U().Ug)({environment:t,workflowStore:n,transaction:i,previousDatabaseModules:(0,U().T0)(null==r?void 0:r.modules)}),(0,U().Z6)({environment:t,store:o,workflowStore:n,transaction:i}),ce({environment:t,parentBlockStore:o,workflow:a,transaction:i})}function we(e){const{runtimeActorStore:t,missingRoles:o,transaction:n,environment:r}=e,c=o.getPointersByTable(i().ev);for(const i of c){const e=W().Bv.createChildStore(t,i),c=o.getRole(i);if(!c)continue;let s;(0,a().p2)(c)?s={read_content:!0,insert_content:!0,update_content:!0,read_comment:!0,insert_comment:!0}:(0,a().Tt)(c)&&(s={read_content:!0,read_comment:!0});const l={type:"bot_permission",bot_id:t.id,parent_id:t.getParentId(),parent_table:t.getParentTable(),role:s??"none"};y().zP({environment:r,store:e,permissionItems:[l],transaction:n})}}function pe(e){const{environment:t,workflowStore:o,store:n,inputValue:r,additionalSteps:a=[]}=e,{currentSpaceStore:c}=V().default.state;if(!c)return;const l=(0,K().Z1)({environment:t,table:s().To,spaceId:c.id}),d={table:i().ev,id:n.id,spaceId:c.id};return(0,P().i0)({environment:t,clientStore:E().K,threadStore:void 0,threadId:l,additionalSteps:[{id:(0,k().lZ)(),type:"workflow",value:(0,A().dh)(o),workflow_block_id:n.id,traceId:(0,k().lZ)(),saved:!0},...a],config:{type:"workflow",workflowBlockId:n.id},threadParentPointer:d,userStore:void 0,spaceStore:c,value:(0,f().x9d)(r)}),l}function fe(e){const{environment:t,store:o,workflowStore:n,workflow:r,transaction:a,workflowThreads:s}=e,l=o.inMemoryRecordCache,d=o.getSpaceId();if(!d)throw new Error("Space ID not found");b().zv({store:o,data:{type:"collection_view_page"},transaction:a}),ce({environment:t,parentBlockStore:o,workflow:r,transaction:a});const w=(0,U().Bg)({modules:r.modules||[],workflowStore:n}),p=w.flatMap((e=>{let{collectionPointer:t}=e;const n=W().md.createChildStore(o,t),r=n.getParentStore();return r&&r.table===i().ev&&r.getParentId()===o.id?[{collectionStore:n,collectionParentStore:r}]:[]}));for(const{collectionStore:c}of p)b().zv({store:c,data:{parent_id:o.id,parent_table:i().ev,alive:!0},transaction:a});b().zv({store:o.getFormatStore(),data:{collection_pointers:p.map((e=>{let{collectionStore:t}=e;return t.pointer}))},transaction:a}),p.length>0&&b().zv({store:o.getFormatStore(),data:{collection_pointer:p[0].collectionStore.pointer},transaction:a});const f=r.views||[];for(let u=0;u<f.length;u++){const e=f[u];if(e.pointer)continue;const r=b().eC({environment:t,table:c().Gy,value:{type:e.type,parent_table:i().ev,parent_id:o.id,space_id:d,alive:!0},transaction:a,inMemoryRecordCache:l}),s=(0,m().jU)({workflowView:e,collectionViewFormat:void 0,collectionViewPointer:{id:r.id,table:c().Gy,spaceId:d},collectionViewBlockPointer:{id:o.id,table:i().ev,spaceId:d},databaseModules:w});for(const t of s)D().applyOperation({store:r,operation:t,transaction:a});g().BC({parentStore:o.getCollectionViewsStore(),appendStore:r,transaction:a}),b().zv({store:n.getDataStore().getKeyStore("views").getKeyStore(u),data:{pointer:{id:r.id,table:c().Gy,spaceId:d}},transaction:a})}for(const c of s)b().zv({store:c,data:{parent_table:i().ev,parent_id:o.id,space_id:o.getSpaceId()},transaction:a})}function ue(e){const{environment:t,spaceId:o}=e;(0,n.useEffect)((()=>{o&&M().bG({environment:t,spaceId:o,force:!1})}),[t,o])}function me(e){const{environment:t,threadStore:o,stepIndex:n,transaction:r}=e,{currentSpaceStore:a,currentSpaceViewStore:c}=V().default.state;if(!a||!c)throw new Error("No current space");const s=o.getTranscript(),l=o.getMessageStores(),d=s.findIndex((e=>"config"===e.type)),w=s[d],p=l[d];if(d<0||!p||!w||"config"!==w.type)throw new Error("No config step found");const f=b().Wv({environment:t,type:"collection_view_page",transaction:r,inMemoryRecordCache:a.inMemoryRecordCache});_().yM({environment:t,spaceStore:a,spaceViewStore:c,pageStore:f,isPrivate:!0,transaction:r}),b().zv({store:o,data:{parent_table:i().ev,parent_id:f.id,space_id:f.getSpaceId()},transaction:r});const u={...w,value:{type:"workflow",workflowBlockId:f.id}};b().KY({store:p.getStepStore(),value:u,transaction:r}),(0,O().openWorkflowEditorForStore)({environment:t,store:f,threadId:o.id}),(0,P().hx)({threadStore:o,stepIndex:n,transaction:r})}},118078:(e,t,o)=>{o.r(t),o.d(t,{closeChatSidebar:()=>d,openChatSidebar:()=>l});var n=()=>o(435009),r=()=>o(492414),a=()=>o(869562),i=()=>o(644914),c=()=>o(890754),s=()=>o(590027);function l(e){const{environment:t,chatThreadId:o,workflowStepId:l}=e,d=(0,i().KB)(t),w=(0,c().getIsChatSidebarOpen)(t);d&&!w&&((0,a().setExpand)({environment:t,isExpanded:!1,from:"show_chat_sidebar",saveDetailsSidebarPreference:!1}),s().MU.setState({...s().MU.state,reopenMainSidebarOnClose:!0}));const p=(0,r().Ef)({environment:t,updates:{chatThreadId:o??c().NEW_CHAT_THREAD_ID,workflowStepId:l}});n().oo({environment:t,url:p})}function d(e){const{environment:t}=e;s().MU.state.reopenMainSidebarOnClose&&((0,a().setExpand)({environment:t,isExpanded:!0,from:"close_chat_sidebar",saveDetailsSidebarPreference:!1}),s().MU.setState({...s().MU.state,reopenMainSidebarOnClose:void 0}));const o=(0,r().Ef)({environment:t,updates:{chatThreadId:void 0,workflowStepId:void 0}});n().oo({environment:t,url:o,redirect:!0})}},235956:(e,t,o)=>{o.d(t,{Bg:()=>P,T0:()=>T,T7:()=>C,Ug:()=>D,Z6:()=>E,qm:()=>_});o(16280),o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(354520),o(672577),o(581454);var n=()=>o(792071),r=()=>o(179034),a=()=>o(519831),i=()=>o(869558),c=()=>o(919709),s=()=>o(287903),l=()=>o(725649),d=()=>o(202761),w=()=>o(496603),p=()=>o(498212),f=()=>o(183558),u=()=>o(534177),m=()=>o(803074),v=()=>o(246826),S=()=>o(317909),k=()=>o(272600),h=()=>o(996926),g=()=>o(53137),y=()=>o(630116),b=()=>o(94522),I=()=>o(809120);function _(e){const{environment:t,store:o,workflowStore:n,transaction:i}=e,{inMemoryRecordCache:s}=n,d=n.getSpaceId();if(!d)throw new Error("Space ID not found");const w=(0,b().dh)(n),u=(w.modules||[]).filter((e=>"database"===e.type));if(0===u.length)return;const m={},S=[];for(const r of u){const{key:e,state:t}=r;if((0,l().j6)(t))continue;const o=(0,l().DK)(t);if(!o||!o.schema)throw new Error("Database state not found");if(o.pointer&&o.propertyKeyToIdMap)m[e]={collectionPointer:o.pointer,propertyKeyToIdMap:o.propertyKeyToIdMap};else{const t={table:a().Vl,id:(0,p().Ay)(),spaceId:d};m[e]={collectionPointer:t,propertyKeyToIdMap:{}};for(const[n,r]of Object.entries(o.schema))m[e].propertyKeyToIdMap[n]="title"===r.type?"title":(0,f().Ay)();S.push(r)}}for(const p of S){const{key:e,name:f,state:u}=p,S=(0,l().DK)(u);if(!S)throw new Error("Database state not found");const{collectionPointer:h}=m[e];if(!S||!S.schema||!h)throw new Error("Database dbState not found");v().eC({environment:t,table:a().Vl,value:{id:h.id,name:(0,c().x9d)(f),parent_table:r().ev,parent_id:o.id,space_id:d,alive:!0},transaction:i,inMemoryRecordCache:s}),(0,k().p)({collectionViewBlockStore:o,collectionPointer:h,transaction:i});const g=(w.modules||[]).findIndex((t=>t.key===e));if(-1===g)throw new Error("Module not found");v().zv({store:n.getDataStore().getKeyStore("modules").getKeyStore(g).getKeyStore("state"),data:{pointer:h},transaction:i})}}function C(e){const{workflowValue:t,workflowStore:o}=e,n=(t.modules||[]).filter((e=>"database"===e.type)),r=n.map((e=>{var t;if(null===(t=(0,l().DK)(e.state))||void 0===t||!t.pointer)throw new Error("Database module pointer not found");return(0,I().k3)({dataBaseModule:e,workflowStore:o,databaseModules:n})}));return w().Ul([...(t.modules||[]).filter((e=>"database"!==e.type)),...r],(e=>e.key))}function D(e){const{environment:t,previousDatabaseModules:o,workflowStore:n,transaction:r}=e;if(!n.getSpaceId())throw new Error("Space ID not found");const a=((0,b().dh)(n).modules||[]).filter((e=>"database"===e.type));if(0===a.length)return;const i=new Map(null==o?void 0:o.map((e=>[e.key,e]))),c=(0,I().GG)(a);for(const s of a){const{key:e,state:o}=s;if((0,l().j6)(o))continue;const d=(0,l().DK)(o);if(!d||!d.schema)throw new Error("Database state not found");const{collectionPointer:w}=c[e];if(!w)throw new Error("Database pointer not found");const p=y().md.createChildStore(n,w),f=M({databaseKey:e,databaseKeyMap:c,schema:d.schema,environment:t,transaction:r,collectionStore:p}),{mappedDiff:u,newBlockSchema:m,newDeletedBlockSchema:S,newMappedSchema:k,newPropertyKeyToIdMap:h}=(0,b().bX)({collectionStore:p,previousDatabaseModule:i.get(e),newDatabaseModule:s,databaseModules:a,databaseKeyMap:c,connectedRelationCollections:f});if(u.length>0){v().zv({store:p,data:{schema:m,deleted_schema:{...p.getDeletedSchema(),...S}},transaction:r});const t=((0,b().dh)(n).modules||[]).findIndex((t=>t.key===e));if(-1===t)throw new Error("Module not found");v().zv({store:n.getDataStore().getKeyStore("modules").getKeyStore(t).getKeyStore("state"),data:{schema:k,propertyKeyToIdMap:h,pointer:w},transaction:r})}}}function M(e){const{schema:t,environment:o,transaction:r,collectionStore:a,databaseKey:i,databaseKeyMap:c}=e,l=(0,s().Vn)({notionSchema:a.getSchema(),databaseKey:i,databaseKeyMap:c});return function(e){const{schema:t,environment:o,transaction:r,collectionPointer:a,existingConnectedRelations:i}=e,c=i||{},l=(0,s().lA)(t);if(0===Object.entries(l).length)return c;const d=(0,h().N)({getDatabaseType:()=>{}},!0);for(const[s,w]of Object.entries(l))if(!c[s])switch(w){case"slack.message":{const e=d.find((e=>"slack_message"===e.pattern.name));if(!e){if(!g().A.state.loaded)throw new Error("External integration store has not been loaded");throw new Error("Slack message relation not found")}const t=n().Bj6.fromIntegration(e.integration),i=m().qM({environment:o,pattern:e.pattern,integration:t,parentCollectionStore:{pointer:a,id:a.id},transaction:r});c[s]={collectionPointer:i.pointer,property:(0,f().Ay)(),externalRelationType:"slack.message"};break}default:(0,u().HB)(w)}return c}({schema:t,environment:o,transaction:r,collectionPointer:a.pointer,existingConnectedRelations:l})}function P(e){const{modules:t,workflowStore:o}=e;return t.filter((e=>"database"===e.type&&!(0,l().j6)(e.state))).map((e=>{var t;const n=null===(t=(0,l().DK)(e.state))||void 0===t?void 0:t.pointer;if(!n)throw new Error("Database module pointer not found");const r=y().md.createChildStore(o,n).getSchema();if(!r)throw new Error("Collection value not found");return{databaseModule:e,collectionPointer:n,schema:r}}))}function E(e){const{environment:t,store:o,workflowStore:n,transaction:a}=e,{inMemoryRecordCache:c}=n,s=(0,b().dh)(n),l=s.views||[],w=P({modules:s.modules||[],workflowStore:n}),p=n.getSpaceId();if(!p)throw new Error("Space ID not found");const f=l.map((e=>{if(e.pointer)return{view:e,collectionViewStore:y().pS.createChildStore(o,e.pointer)};return{view:e,collectionViewStore:v().eC({environment:t,table:i().Gy,value:{type:e.type,parent_table:r().ev,parent_id:o.id,space_id:p,alive:!0},transaction:a,inMemoryRecordCache:c})}}));for(const[h,{view:g,collectionViewStore:y}]of f.entries()){const e={id:y.id,table:i().Gy,spaceId:p},t=(0,d().jU)({workflowView:g,collectionViewFormat:y.getFormat(),collectionViewPointer:e,collectionViewBlockPointer:{id:o.id,table:r().ev,spaceId:p},databaseModules:w});for(const o of t)S().applyOperation({store:y,operation:o,transaction:a});v().zv({store:n.getDataStore().getKeyStore("views").getKeyStore(h),data:{pointer:e},transaction:a})}const u=o.getCollectionViewStores().map((e=>e.id)),m=new Set(u),k=f.filter((e=>!m.has(e.collectionViewStore.id))).map((e=>e.collectionViewStore.id));v().zv({store:o,data:{view_ids:[...u,...k]},transaction:a})}function T(e){return(e||[]).filter((e=>"database"===e.type))}},691093:(e,t,o)=>{o.r(t),o.d(t,{closeConfigSecondPanel:()=>w,closeWorkflowEditor:()=>u,onConfigItemClick:()=>d,openWorkflowEditor:()=>f,openWorkflowEditorForStore:()=>p,updateWorkflowNavigationState:()=>l});var n=()=>o(534177),r=()=>o(435009),a=()=>o(118078),i=()=>o(890754),c=()=>o(492414),s=()=>o(564037);function l(e){const{environment:t,navigationState:o,viewId:n,redirect:a}=e,i=(0,c().Ef)({environment:t,updates:{...m(o),collectionViewId:n}});r().oo({environment:t,url:i,redirect:a})}function d(e){let{environment:t,navigationState:o}=e;const n=m(o),r=(0,s().getWorkflowNavigationRouteArgs)(t);(null==n?void 0:n.workflowViewType)!==(null==r?void 0:r.workflowViewType)||(null==n?void 0:n.workflowViewKey)!==(null==r?void 0:r.workflowViewKey)?l({environment:t,navigationState:o}):w(t)}function w(e){l({environment:e,navigationState:{type:"configure"}})}function p(e){const{environment:t,store:o,threadId:n}=e;(0,a().openChatSidebar)({environment:t,chatThreadId:n});const i=m({type:"configure"}),s=(0,c().Ef)({environment:t,updates:{...i,store:o}});r().oo({environment:t,url:s})}function f(e){const{environment:t,navigationState:o={type:"preview"},chatThreadId:n=i().NEW_CHAT_THREAD_ID}=e;(0,a().openChatSidebar)({environment:t,chatThreadId:n});const s=(0,c().Ef)({environment:t,updates:m(o)});r().oo({environment:t,url:s,redirect:!0})}function u(e){const{environment:t}=e;(0,a().closeChatSidebar)({environment:t});const o=(0,c().Ef)({environment:t,updates:{workflowViewType:void 0,workflowViewKey:void 0}});r().oo({environment:t,url:o,redirect:!0})}function m(e){const t=e.type;switch(t){case void 0:return{};case"configure":case"debug":case"preview":case"runtime_actor":return{workflowViewType:t,workflowViewKey:void 0};case"function":case"module":case"trigger":case"view_settings":case"view":return{workflowViewType:t,workflowViewKey:e.key};case"runs":return{workflowViewType:t,workflowViewKey:e.runId};case"test":return{workflowViewType:t,workflowViewKey:`${e.functionKey},${e.name}`};default:(0,n().HB)(t)}}},985554:(e,t,o)=>{o.d(t,{K:()=>a});const n={type:"markdown-chat"};class r extends(()=>o(757695))().default{getInitialState(){return{showHistory:!1,showDebug:!1,previewingStepId:void 0,config:n,debugOverrides:{},acceptedInferenceKeys:[],inferenceKeysToAnnotations:{},inferenceKeysToMemories:{},tags:[],abortController:void 0,loading:!1,stopInferencePromise:void 0,temporarySteps:[],inferences:[],allFeaturesEnabled:!1,model:void 0,traceId:void 0,requestInfo:void 0,userSelectedConfig:void 0}}}const a=new r},996926:(e,t,o)=>{o.d(t,{N:()=>p});o(944114),o(898992),o(672577);var n=()=>o(521488),r=()=>o(66689),a=()=>o(148307),i=()=>o(617871),c=()=>o(374562),s=()=>o(508496),l=()=>o(53137),d=()=>o(252833);const w=[i().ob,i().Hd,i().e1,i().io,i().k0,i().zG];function p(e,t){if(!e)return[];const o=s().default.checkGate({gateName:"cron_connected_relation"}),p=s().default.checkGate({gateName:"connected_relation"}),f=s().default.checkGate({gateName:"slack_connected_relation"}),u=s().default.checkGate({gateName:"salesforce_connected_relation_database_actions_enabled"}),m=e.getDatabaseType()===r().dC,v=l().A.state;if(!v.loaded)return[];const S=v.integrations,k={};if(!m){const e=S.find((e=>e.id===i().ob)),t=(0,c().Jb)();var h;if(e)k[t.name]={name:t.name,pattern:n().Y,integration:e,tooltipImage:{img:a().A.images.tooltips.properties.githubSyncPullStatusPng,scale:.5},description:t.description,canOnlyAdminAuth:{disabledPropertyTooltipMessage:null===(h=t.canOnlyAdminAuth)||void 0===h?void 0:h.disabledPropertyTooltipMessage}}}const g=[];if(t&&(g.push(i().Hd,i().e1,i().k0),f&&g.push(i().zG)),o&&g.push(i().io),g.forEach((e=>{const t=S.find((t=>t.id===e));if(null!=t&&t.info.original_url_patterns)for(const n of t.info.original_url_patterns){var o;null!==(o=n.additional_types)&&void 0!==o&&o.connectedRelation&&(k[n.name]||(k[n.name]={name:(0,d().Fe)({pattern:n,integration:t}),pattern:n,integration:t}))}})),!p)return Object.values(k);for(const n of S)if(n.info.original_url_patterns&&t&&![...w,i().F6].includes(n.id))for(const e of n.info.original_url_patterns){var y;null!==(y=e.additional_types)&&void 0!==y&&y.connectedRelation&&(k[e.name]||(n.id===i().mn&&u?k[n.name]={name:n.name,pattern:e,integration:n}:k[e.name]={name:(0,d().Fe)({pattern:e,integration:n}),pattern:e,integration:n}))}return Object.values(k)}}}]);