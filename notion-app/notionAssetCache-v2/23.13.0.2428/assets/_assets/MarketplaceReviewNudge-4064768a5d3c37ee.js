"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[2501],{11385:(e,t,i)=>{i.r(t),i.d(t,{MarketplaceReviewNudge:()=>p});var a=i(296540),n=()=>i(401497),s=()=>i(959013),r=()=>i(812182),o=()=>i(755199),d=()=>i(554509),c=()=>i(989423),l=()=>i(508496),u=()=>i(332661),g=i(474848);const v="marketplace_review_modal_toast";function m(e){let{acquisitionId:t,listingId:n}=e;const d=(0,s().tz)(),u=(0,i(484714).v3)(),[m,p]=(0,a.useState)(!1),{onRatingConfirmed:w,onSubmit:I,error:f,isLoading:_}=(0,i(36338)._)({acquisitionId:t,source:"nudge"});return(0,a.useEffect)((()=>{(0,c().u4)({environment:u,event:{eventName:"marketplace_review_nudge",eventProperties:{action:"show"}}}),l().default.logEvent("marketplace_review_nudge","show")}),[u]),(0,a.useEffect)((()=>{m||r().Iz({id:v,presentationType:"persistent",title:d.formatMessage({id:"marketplace.reviews.nudge.title",defaultMessage:"Enjoying this template?"}),message:(0,g.jsx)(h,{onRatingConfirmed:w,error:f}),onUserDismiss:()=>{o().Tu(u,{listingId:n}),(0,c().u4)({environment:u,event:{eventName:"marketplace_review_nudge",eventProperties:{action:"dismiss"}}}),l().default.logEvent("marketplace_review_nudge","dismiss")},actions:{primary:{title:d.formatMessage({id:"marketplace.reviews.nudge.submit",defaultMessage:"Submit"}),onAction:async()=>{try{await I(),p(!0),o().Tu(u,{listingId:n}),r().UW(v),i(743071).A.openModal({stage:"details",acquisitionId:t,source:"nudge"}),(0,c().u4)({environment:u,event:{eventName:"marketplace_review_nudge",eventProperties:{action:"rate"}}}),l().default.logEvent("marketplace_review_nudge","rate")}catch(e){}},isLoading:_,disabled:Boolean(f)}}})}),[d,u,t,n,f,_,I,w,m]),null}const p=(0,a.memo)(m);function h(e){let{onRatingConfirmed:t,error:i}=e;const a=(0,s().tz)(),r=(0,n().IS)((()=>({container:{display:"flex",flexDirection:"column",gap:"8px",alignItems:"center"}})),[]);return(0,g.jsxs)("div",{style:r.container,children:[(0,g.jsx)(d().D,{styleName:"UISmall-12px/Medium",children:a.formatMessage({id:"marketplace.reviews.nudge.body",defaultMessage:"Leave a review for the community!"})}),(0,g.jsx)(u().v,{onRatingConfirmed:t,error:i})]})}},743071:(e,t,i)=>{i.d(t,{A:()=>s});const a={reviewIdCache:{},isOpen:!1,acquisitionId:"",stage:"rating",rating:0,source:void 0};class n extends(()=>i(757695))().default{getInitialState(){return{...a}}setReviewId(e,t){this.setState({...this.state,reviewIdCache:{...this.state.reviewIdCache,[e]:t}})}getReviewId(e){return this.state.reviewIdCache[e]}openModal(e){let{stage:t,acquisitionId:i,rating:n,source:s}=e;this.setState({...a,reviewIdCache:this.state.reviewIdCache,isOpen:!0,acquisitionId:i,stage:t,rating:n||0,source:s})}closeModal(){this.setState({...a,reviewIdCache:this.state.reviewIdCache})}updateState(e){this.setState({...this.state,...e})}}const s=new n}}]);