"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[21682],{421682:(e,o,t)=>{t.d(o,{J:()=>Q});t(16280),t(581454);var n=t(296540),a=()=>t(484714),i=()=>t(56366),d=()=>t(401497),r=()=>t(728396),l=()=>t(251822),s=()=>t(145214),u=()=>t(439264),g=()=>t(218557),m=()=>t(953418),c=()=>t(170253),p=()=>t(978846),v=()=>t(970176),y=()=>t(316397),b=()=>t(933951),h=(t(18107),t(967357),t(898992),t(354520),()=>t(72645)),M=()=>t(155185),f=()=>t(959013),_=()=>t(285790),A=()=>t(859428),T=()=>t(38337),w=()=>t(104129),I=()=>t(962730),x=()=>t(160241),B=()=>t(3197),S=()=>t(937199),L=t(474848);const C=(0,f().YK)({formLayoutAddModule:{id:"addModuleHoverMenu.formLayout.add",defaultMessage:"Add question"},pageLayoutAddModule:{id:"addModuleHoverMenu.pageLayout.add",defaultMessage:"Add"}}),D=32;function k(e){if("views_main_tab_modules"===e.area)throw new Error("[ViewsMain Not Implemented] AddModuleHoverMenu not implemented for views_main_tab_modules");const o=(0,f().tz)(),{layoutStore:t,addModuleHoverMenuStore:n,currentModuleSelection:a}=(0,S().LH)(),r=(0,i().K8)((()=>{if(n.state.isOpen)return n.state.moduleId}),[n]),l=(0,i().K8)((()=>{if(!r)return;const e=w().A.findModuleContainer({layoutStore:t,moduleId:r});return e?e.getNode():void 0}),[r,t]),u=(0,i().K8)((()=>{if(!a||"new_module"===a.type)return!1;const e=t.getModuleById(a.moduleId);return"placeholder"===(null==e?void 0:e.type)}),[a,t]),g=(0,i().K8)((()=>{var o;if("views_main_tab_modules"===e.area)throw new Error("[ViewsMain Not Implemented] AddModuleHoverMenu not implemented for views_main_tab_modules");if("form_conditional_modules"===e.area)return!1;const a=t.getModules()[e.area].filter((e=>(0,M()._)(e))),i=0===a.length||(null===(o=a.at(-1))||void 0===o?void 0:o.id)===r;return n.state.isOpen&&!u&&!i}),[n,r,u,t,e.area]),m=(0,B().t)({area:e.area,afterModuleId:r}),c=(0,x().d)(),p=(0,d().IS)((e=>({bigRoundButton:{...c.button,width:D,height:D,borderTopLeftRadius:"100%",borderTopRightRadius:"100%",borderBottomLeftRadius:"100%",transform:"rotate(-45deg)"},bigRoundButtonHovered:{...c.buttonHovered},bigRoundButtonPressed:{...c.buttonPressed}})),[c]),v="form"===(0,i().K8)((()=>{var e;return null===(e=t.getModel())||void 0===e?void 0:e.getLayoutType()}),[t])?o.formatMessage(C.formLayoutAddModule):o.formatMessage(C.pageLayoutAddModule),y=l?l.offsetLeft-40:void 0,b=l?l.offsetTop+l.offsetHeight-4:void 0;return void 0===y||void 0===b?null:(0,L.jsx)(s().A,{visible:g,animate:{opacity:1,scale:1,transformOrigin:"center right"},initial:{opacity:0,scale:.3,transformOrigin:"center right"},exit:{opacity:0,scale:.3,transformOrigin:"center right"},style:{position:"absolute",left:y,top:b},children:(0,L.jsx)(A().A,{placement:I().W.Left,renderTooltip:()=>v,render:e=>(0,L.jsx)(_().A,{...e,style:p.bigRoundButton,hoveredStyle:p.bigRoundButtonHovered,className:T().kew,pressedStyle:p.bigRoundButtonPressed,onClick:m,icon:h().b,iconStyle:{width:16,height:16,transform:"rotate(45deg)"},isBlue:!0,ariaLabel:v})})})}var P=()=>t(21140),j=()=>t(612900),R=()=>t(817942);const H=(0,f().YK)({addPageModule:{id:"pageLayout.builder.addModuleToPage.button.ariaLabel",defaultMessage:"Add page module"},addQuestionModuleTooltip:{id:"pageLayout.builder.addModuleToPage.button.addQuestionModuleTooltip",defaultMessage:"Add question"},addModuleToPanelButton:{id:"pageLayout.builder.addModuleToPanel.button.label",defaultMessage:"Add to panel"}}),O=n.forwardRef((function(e,o){const{area:n}=e,{layoutStore:a}=(0,S().LH)(),r=(0,i().K8)((()=>a.getLayoutType()),[a]),l=(0,f().tz)(),s=(0,x().d)(),u=(0,d().IS)((e=>({bigRoundButton:{...s.button,width:32,height:32,borderRadius:"100%"},bigRoundButtonHovered:{...s.buttonHovered},bigRoundButtonPressed:{...s.buttonPressed},emptyModuleAreaAddButton:{cursor:"pointer",display:"flex",justifyContent:"center",alignItems:"center",padding:"8px 16px 8px 12px",fontSize:14,lineHeight:"20px",fontWeight:500,background:"light"===e.mode?e.accentColors.uiBlue[100]:e.accentColors.uiBlue[200],color:e.accentColors.uiBlue[600],borderRadius:28,transition:"background 0.2s"},emptyModuleAreaAddButtonHover:{...s.buttonHovered},emptyModuleAreaAddButtonPressed:{...s.buttonPressed}})),[s]),g=(0,B().t)("views_main_tab_modules"===n?{area:n,viewsMainTabId:e.viewsMainTabId}:{area:n});if("form_conditional_modules"===n)throw new Error("[Forms Conditional Logic Not Implemented] AddPageLayoutModuleButton not implemented for form_conditional_modules yet.");const m=(0,i().K8)((()=>{var o;const t=a.getModules();return("views_main_tab_modules"===n?(null===(o=t[n])||void 0===o?void 0:o[e.viewsMainTabId])||[]:t[n]).length>0}),[a,n,e.viewsMainTabId]);return"page_details"!==n||m?(0,L.jsx)(A().A,{renderTooltip:()=>l.formatMessage(H.addQuestionModuleTooltip),disableTooltip:"form"!==r,placement:I().W.Bottom,render:e=>(0,L.jsx)(_().A,{style:u.bigRoundButton,hoveredStyle:u.bigRoundButtonHovered,pressedStyle:u.bigRoundButtonPressed,onClick:g,icon:h().b,iconStyle:{width:16,height:16},isBlue:!0,className:T().kew,ariaLabel:l.formatMessage(H.addPageModule),ref:o,...e})}):(0,L.jsxs)(t(197190).A,{style:u.emptyModuleAreaAddButton,onClick:g,hoveredStyle:u.emptyModuleAreaAddButtonHover,pressedStyle:u.emptyModuleAreaAddButtonPressed,ref:o,children:[(0,t(464699).b)({width:12,marginRight:4}),(0,L.jsx)(f().sA,{...H.addModuleToPanelButton})]})})),E=n.memo((function(e){var o;const{shouldShowTooltip:a}=(0,t(384130).J)(),{area:d}=e,r=a&&"page_main"===d,l=a&&"form_layout_schema"!==d,s=n.useRef(null),{currentModuleSelection:u,layoutStore:g,setModuleSelection:m,isPropertyTypeSearchInputDirtyStore:c}=(0,S().LH)(),p=(0,i().K8)((()=>"existing_module"===(null==u?void 0:u.type)?g.getModuleById(u.moduleId):void 0),[u,g]),v=(0,i().K8)((()=>{var o;if("form_conditional_modules"===d)throw new Error("[Forms Conditional Logic Not Implemented] AddPageLayoutModuleButton not implemented for form_conditional_modules yet.");const t=g.getModules();return("views_main_tab_modules"===d?(null===(o=t[d])||void 0===o?void 0:o[e.viewsMainTabId])||[]:t[d]).length>0}),[g,d,e.viewsMainTabId]),[y,b]=n.useState(!1),h=n.useCallback((()=>{c.state||m(void 0)}),[c,m]);return"new_module"===(null==u?void 0:u.type)&&u.area===e.area?(0,L.jsx)(t(545805).A,{onUndo:h,capture:!0,priority:1,debugName:"AddPageLayoutModuleButton",children:(0,L.jsx)(F,{})}):"placeholder"===(null==p?void 0:p.type)?null:r||l?(0,L.jsxs)(P().Ye,{justifyContent:"center",style:null===(M=e.styles)||void 0===M?void 0:M.buttonContainer,className:R().hg,children:[(0,L.jsx)(j().u,{shape:"page_main"===e.area?"circle":"pill",size:"page_main"===e.area||v?32:34,onDependencyLoaded:()=>b(!0),children:(0,L.jsx)(O,{isEducationCalloutVisible:r,...e,ref:s})}),r&&y&&(0,L.jsx)(t(961842).C8,{buttonRef:s})]}):(0,L.jsx)(P().Ye,{justifyContent:"center",style:null===(o=e.styles)||void 0===o?void 0:o.buttonContainer,className:R().hg,children:(0,L.jsx)(O,{isEducationCalloutVisible:!1,ref:s,...e})});var M}));function F(){const e=(0,d().IS)((e=>({ghostPageModuleContainer:{paddingBottom:12},ghostPageModule:{width:"100%",height:160,background:e.accentColors.uiBlue[75],borderRadius:12,boxShadow:`0px 0px 0px 0px ${e.stroke.uiBlueSecondary}, inset 0px 0px 0px 1px ${e.stroke.uiBlueSecondary}`}})),[]);return(0,L.jsx)("div",{style:e.ghostPageModuleContainer,className:R().hg,children:(0,L.jsx)(j().u,{shape:"square",borderRadius:e.ghostPageModule.borderRadius,width:e.ghostPageModule.width,height:e.ghostPageModule.height,children:(0,L.jsx)("div",{style:e.ghostPageModule})})})}var K=()=>t(496603);const N=12;function z(){const{addModuleHoverMenuStore:e}=(0,S().LH)(),o=(0,y().z)(),t=(0,n.useCallback)((t=>{const n=w().A.getMembersByDOMOrder({filter:e=>"cover"!==e.moduleType&&"form_conditional_modules"!==e.area});let a=null;for(const e of n){const n=e.getNode();if(!n)continue;const i=n.getBoundingClientRect();if(t.clientX>i.right||t.clientX<i.left&&i.left-t.clientX>300)continue;if(t.clientY<=i.bottom&&i.bottom-t.clientY<N||t.clientY>i.bottom&&t.clientY-i.bottom<N+o){a=e;break}}if(a)e.setState({isOpen:!0,moduleId:a.moduleId,menuIsOpen:!1});else{const o=e.getState();o.isOpen&&!o.menuIsOpen&&e.setState({isOpen:!1})}}),[e,o]),a=K().nF(t,30);return(0,n.useEffect)((()=>(window.addEventListener("mousemove",a),()=>{window.removeEventListener("mousemove",a)})),[a]),null}var Y=()=>t(47762);function Q(e){const{area:o}=e;if("form_conditional_modules"===o)throw new Error("[Forms Conditional Logic] Can't render builder layout modules for nested form_conditional_modules directly.");const t=(0,a().v3)(),{sessionId:h,layoutStore:M,currentModuleSelection:f,setModuleSelection:_,canEditLayout:A,layoutBuilderModuleSelectionStore:T}=(0,S().LH)(),w=(0,n.useRef)(null),I=(0,b().u)({layoutStore:M,pageStoreId:void 0}),x=(0,i().K8)((()=>M.isTabbedPageLayout()),[M]),B=(0,y().z)(),{nonMoveableHeaderModules:C,moveableModules:D,nonMoveableFooterModules:P}=(0,i().K8)((()=>{var t;const n="views_main_tab_modules"===o?(null===(t=I[o])||void 0===t?void 0:t[null==e?void 0:e.viewsMainTabId])||[]:I[o];return(0,l().jS)(o,n)}),[o,I,null==e?void 0:e.viewsMainTabId]),j=(0,i().K8)((()=>{const e=T.state;if(null!=e&&e.isDragging){const t=e.draggingModuleInitialArea,n=e.draggingModuleFinalArea;return{isDraggingIntoThisArea:t.area!==o&&n.area===o,isDraggingFromThisAreaToOtherArea:t.area===o&&n.area!==o,isDraggingAnyModuleList:!0,dragArea:n}}return{isDraggingIntoThisArea:!1,isDraggingFromThisAreaToOtherArea:!1,isDraggingAnyModuleList:!1,dragArea:void 0}}),[o,T]),H=D.map((e=>"form_layout_schema"===o?{key:e.id,draggable:"placeholder"!==e.type}:{key:e.id,draggable:!0})),O=(0,n.useMemo)((()=>new(c().A)),[]),F=(0,i().K8)((()=>O.state.isDragging),[O]),K=(0,i().K8)((()=>{var e;return null===(e=M.getModel())||void 0===e?void 0:e.getLayoutType()}),[M]);(0,n.useEffect)((()=>{w.current&&j.isDraggingIntoThisArea&&(0,m().$v)({element:w.current,environment:t,additionalPadding:{top:200,bottom:200}})}),[j.isDraggingIntoThisArea,t]);const N=(0,n.useCallback)((t=>{const n="views_main_tab_modules"===o?{area:"views_main_tab_modules",viewsMainTabId:e.viewsMainTabId}:{area:o};_({type:"existing_module",moduleId:t,isDragging:!0,draggingModuleInitialArea:n,draggingModuleFinalArea:n})}),[o,e.viewsMainTabId,_]),Q=(0,n.useCallback)((e=>{e&&_({type:"existing_module",moduleId:e,isDragging:!1})}),[_]),V=(0,n.useCallback)((()=>{const e=T.state,o=M.getLayoutType();o&&(0,r().H)(o)?_(void 0):null!=e&&e.isDragging&&T.setState({...e,isDragging:!1,draggingModuleInitialArea:void 0,draggingModuleFinalArea:void 0})}),[T,_,M]),q=(0,n.useCallback)((e=>{const n=T.state,a=null!=n&&n.isDragging?n.draggingModuleFinalArea:void 0;"form_conditional_modules"!==(null==a?void 0:a.area)&&(null!=e&&e.key&&a&&a.area!==o&&((0,p().E)({environment:t,position:{type:"area_relative",location:"end_moveable",..."views_main_tab_modules"===a.area?{area:a.area,viewId:a.viewsMainTabId}:{area:a.area}},moduleId:e.key,layoutStore:M,sessionId:h}),(0,v().z)({moduleId:e.key,layoutStore:M,environment:t})),V())}),[T,o,V,t,M,h]),W=(0,n.useCallback)((n=>{let{key:a,endPosition:i,startPosition:d}=n;if(j.isDraggingFromThisAreaToOtherArea)return;const r=C.length,l="views_main_tab_modules"===o?{area:"views_main_tab_modules",viewId:e.viewsMainTabId}:{area:o};(0,p().E)({environment:t,layoutStore:M,position:{type:"absolute",index:r+i,...l},moduleId:a,sessionId:h}),(0,v().z)({moduleId:a,layoutStore:M,environment:t})}),[j.isDraggingFromThisAreaToOtherArea,C.length,o,e.viewsMainTabId,t,M,h]),X=(0,d().IS)((e=>({draggableList:{display:"flex",flexDirection:"column",gap:B,marginBottom:B},addButtonContainer:{paddingTop:"page_in_collection"===K?8:0,marginBottom:"form"===K?0:12,width:"100%"},dropzoneHalo:{background:g().to,height:g().NZ,marginTop:-g().NZ},hiddenModuleStyle:{display:"none"}})),[B,K]),$=(0,n.useCallback)((e=>{const t="existing_module"===(null==f?void 0:f.type)&&f.moduleId===e,n=t&&F;return(0,L.jsx)(Y().n,{active:t,pageModuleId:e,isDragging:n,area:o,style:n&&j.isDraggingFromThisAreaToOtherArea?X.hiddenModuleStyle:void 0},e)}),[j.isDraggingFromThisAreaToOtherArea,f,F,X.hiddenModuleStyle,o]),J=(0,n.useMemo)((()=>C.length?C.map((e=>$(e.id))):null),[C,$]),Z=(0,n.useMemo)((()=>P.length?P.map((e=>$(e.id))):null),[P,$]),U=(0,n.useMemo)((()=>({enter:{opacity:0},animate:{opacity:1},exit:{opacity:0}})),[]),G=(0,n.useMemo)((()=>({buttonContainer:X.addButtonContainer})),[X.addButtonContainer]);if(!M)return null;let ee;return ee=!!A&&(!x||("views_main_tab_modules"===o||"page_details"===o)),(0,L.jsxs)(L.Fragment,{children:[J,!!H.length&&(0,L.jsx)(u().Ay,{forceDragKeyIndex:j.isDraggingFromThisAreaToOtherArea?H.length-1:void 0,className:R().hg,store:O,keys:H,direction:"vertical",onDraggingKeyChanged:N,onDrop:(e,o)=>{W(o)},onDragCancel:V,onDragEnd:q,onClick:Q,style:X.draggableList,draggingStyle:{display:void 0},draggingStyleForNonDraggedItems:{display:void 0},renderKey:$,disabled:!A,...x?{}:{hoverCursorStyleOverride:j.isDraggingAnyModuleList?"grabbing":void 0}}),(0,L.jsx)(s().A,{visible:j.isDraggingIntoThisArea,initial:U.enter,animate:U.animate,exit:U.exit,skip:!j.isDraggingAnyModuleList,className:"layout-content",ref:w,style:X.dropzoneHalo}),ee&&(0,L.jsx)(E,{...e,styles:G}),"form"===K&&A&&(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(z,{}),(0,L.jsx)(k,{area:o})]}),Z]})}},961842:(e,o,t)=>{t.d(o,{C8:()=>d,QN:()=>i});var n=()=>t(645873);const a={TopbarLayoutInfoButtonEducationTooltip:new(n().O2)("TopbarLayoutInfoButtonEducationTooltip",(()=>Promise.all([t.e(23806),t.e(86090)]).then(t.bind(t,484482)))),BuilderAddModuleButtonEducationTooltip:new(n().O2)("BuilderAddModuleButtonEducationTooltip",(()=>t.e(63538).then(t.bind(t,889989))))},i=(0,n()._h)(a.TopbarLayoutInfoButtonEducationTooltip,(e=>e.default),{renderLoading:(e,o)=>o.children}),d=(0,n()._h)(a.BuilderAddModuleButtonEducationTooltip,(e=>e.default))}}]);