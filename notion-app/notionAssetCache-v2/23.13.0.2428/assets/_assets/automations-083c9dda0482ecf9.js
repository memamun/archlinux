"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[47381,47536,79665],{3867:(e,t,o)=>{o.d(t,{cI:()=>j,mk:()=>k,w$:()=>C});o(898992),o(354520),o(581454);var n=o(296540),i=()=>o(56366),a=()=>o(401497),r=()=>o(791089),l=()=>o(974967),s=()=>o(959013),c=()=>o(496603),u=()=>o(534177),d=()=>o(284371),p=()=>o(425497),m=()=>o(399762),g=()=>o(881690),h=()=>o(496401),y=()=>o(214973),f=()=>o(741310),v=()=>o(807787),x=()=>o(529135),S=()=>o(16707),b=o(474848);function C(e){const{actionMenu:t,buttonPopupStore:o,disabled:r,onClick:c,propertySchema:u,value:p}=e,m=(0,s().tz)(),g=(0,a().IS)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"wrap",whiteSpace:"pre",lineHeight:1.6},propertyName:{...d().RC,fontWeight:d().Wy.medium}})),[]),h=(0,i().K8)((()=>k({intl:m,propertySchema:u,styles:g,value:p})),[m,u,g,p]),y=(0,i().K8)((()=>j({intl:m,propertySchema:u,value:p})),[m,u,p]),x=(0,n.useCallback)((e=>(0,b.jsx)(v().aX,{...e,actionMenu:t,buttonPopupStore:o,disabled:r,icon:l().n,onClick:c,children:(0,b.jsx)("div",{style:g.content,children:h})})),[t,o,r,c,g.content,h]);return(0,b.jsx)(f().P,{renderOrigin:x,title:y})}function A(e,t){if(!e)return[];let o=(0,r().fromSimpleFormulaArrayValue)(e).filter((e=>(0,c().Kg)(e)));return"select"===t.type&&(o=o.slice(0,1)),o}function k(e){const{intl:t,limit:o,operator:n,propertySchema:i,styles:a,tokenFormat:r,value:l}=e,c=(0,p().Ug)(r),d=(0,b.jsx)("span",{style:a.propertyName,children:i.name});if("formula"===(null==l?void 0:l.type))return(0,b.jsx)(s().sA,{...y()._M({propertyName:d,propertyValue:(0,b.jsx)(S().g,{returnType:{type:"text"}})})});const h=y().kN({limit:o,propertySchema:i,optionValues:A(null==l?void 0:l.value,i)}).map((e=>"deleted"===e.type?(0,b.jsx)(x().A,{tokenFormat:c},`missing_option_value_${e.value}`):"option"===e.type?(0,b.jsx)(m().O,{color:e.value.color,format:c,isSingle:!0,showRemoveButton:!1,value:e.value.value},e.value.id):"truncation"===e.type?(0,b.jsx)(g().A,{format:c,isRound:!0,isSingle:!0,showRemoveButton:!1,value:e.value},"More tokens"):void(0,u().HB)(e)));return"replace"===n||"append"===n||"remove"===n||"toggle"===n?(0,b.jsx)(s().sA,{...y().f4({...y().f_({elements:h,intl:t}),operator:n,propertyName:d})}):0===h.length?(0,b.jsx)(s().sA,{...y().NW({propertyName:d})}):(0,b.jsx)(s().sA,{...y()._M({propertyName:d,propertyValue:h[0]})})}function j(e){const{intl:t,limit:o,propertySchema:n,value:i,operator:a}=e,r=n.name;if("formula"===(null==i?void 0:i.type))return(0,b.jsx)(s().sA,{...y()._M({propertyName:r,propertyValue:(0,b.jsx)(S().L,{})})});const l=y().kN({limit:o,propertySchema:n,optionValues:A(null==i?void 0:i.value,n)}).map((e=>"deleted"===e.type?y().iy(t):"option"===e.type?e.value.value:"truncation"===e.type?e.value:void(0,u().HB)(e)));return"replace"===a||"append"===a||"remove"===a||"toggle"===a?(0,b.jsx)(s().sA,{...y().f4({propertyName:r,propertyValue:(0,h().d)(t.formatList(l,{style:"long",type:"conjunction"})),operator:a})}):0===l.length?(0,b.jsx)(s().sA,{...y().NW({propertyName:r})}):(0,b.jsx)(s().sA,{...y()._M({propertyName:r,propertyValue:l[0]})})}},6731:(e,t,o)=>{o.d(t,{D:()=>u});o(898992),o(803949);var n=o(296540),i=()=>o(56366),a=()=>o(364692),r=()=>o(388821),l=()=>o(317909),s=()=>o(841696),c=()=>o(351360);function u(e){let{unpersistedInMemoryRecordCache:t}=e;const o=(0,i().K8)((()=>{var e;return null===(e=c().default.state.currentUserStore)||void 0===e?void 0:e.userId}),[]);return{createAndCommit:(0,n.useCallback)((e=>{let{perform:n}=e;const i=new(s().Z)({deadlockTimeoutMs:l().DEADLOCK_WARNING_TIMEOUT_MS}),c=n(i),u=r().RecordMap.create();i.stores.forEach((e=>{const t=e.getRecordModel(e.pointer);t&&u.addModel(t)})),(0,a().NI)({operations:i.operations,recordMap:u,updateOnly:!1});for(const a of u){const{model:e,pointer:n}=a;t.setModelAndRole({pointer:n,userId:o},e,"editor")}return t.emitAll(),{performResult:c,serverCommitResult:Promise.resolve(void 0)}}),[t,o])}}},31902:(e,t,o)=>{o.d(t,{A:()=>a});o(296540);var n=()=>o(959013),i=o(474848);const a=function(e){let{collectionViewName:t,collectionViewType:a}=e;return t?(0,i.jsx)(o(288722).A,{children:t}):"page"===a?(0,i.jsx)(n().sA,{id:"database.collectionView.untitledName.untitled",defaultMessage:"Untitled"}):(0,i.jsx)(n().sA,{...o(519839).Xg[a]})}},35091:(e,t,o)=>{o.d(t,{A:()=>i});o(296540);var n=o(474848);const i=function(e){let{switcherProps:t,...i}=e;return(0,n.jsx)(o(497222).A,{right:(0,n.jsx)(o(946548).A,{onClick:i.onClick,disabled:i.disabled,...t}),...i})}},48278:(e,t,o)=>{o.r(t),o.d(t,{AutomationWorkflowEditor:()=>Ji,AutomationWorkflowEditorActionSection:()=>Yi,ButtonBlockUrlPreviewPopup:()=>sa,PlacedButtonBlockEditor:()=>ea,automationActions:()=>i(),automationErrorHelpers:()=>ae(),automationExecutionActions:()=>n});var n={};o.r(n),o.d(n,{executeClientAutomation:()=>ie});var i=()=>o(324587),a=(o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(823215),o(354520),o(581454),()=>o(329333)),r=()=>o(496603),l=()=>o(973647),s=()=>o(534177),c=()=>o(322867),u=()=>o(648651),d=()=>o(103966);const p=(0,c().kB)((async function(e){const{context:t,executeAutomationActionFn:o}=e,{actionModels:n,automationModel:i,contextType:a,runtimeStats:p}=t;let g=t.values;const h=performance.now();let y,f={value:{success:!0}};if("button_block"===a||"button_property"===a){if(!i.isButtonType())return{error:new(c().zK)({message:`Automation trigger (${i.getTriggerType()}) does not match context type (${a}).`})};const e=i.getTrigger();y=(0,d().Z)(i.getTriggerType()).execute(t,e)}else if("event"===a){if(!i.isEventType())return{error:new(c().zK)({message:`Automation trigger (${i.getTriggerType()}) does not match context type (${a}).`})};const e=i.getTrigger();y=(0,d().Z)(i.getTriggerType()).execute(t,e)}else if("recurrence"===a){if(!i.isRecurrenceType())return{error:new(c().zK)({message:`Automation trigger (${i.getTriggerType()}) does not match context type (${a}).`})};const e=i.getTrigger();y=(0,d().Z)(i.getTriggerType()).execute(t,e)}else(0,s().HB)(t);if(l().Q.isFail(y))return y;g=g.concat((0,r().o8)(y.value.values));const v=o??m;for(const r of n){var x;const e=await v({action:r,values:g,executionContext:t}),o=null==p||null===(x=p.actionStats)||void 0===x||null===(x=x[r.id])||void 0===x?void 0:x.executionDurationMs;if((0,s().O9)(o)&&o>7e3&&t.executeEffectMap.logMessage({from:"executeAutomation",level:"warning",type:"longRunningAutomationAction",data:{durationMs:o,automationId:i.id,actionId:r.id,actionType:r.getType()}}),l().Q.isFail(e)){f=e;break}if(g=g.concat(e.value.values),e.value.stopExecution)break}const S=await t.executeEffectMap.updateLastRunTimesForObservability({automationModel:t.automationModel,executeResult:f});l().Q.isFail(S)&&(f=S);const b=Math.trunc(performance.now()-h);p&&(p.executionStartTime=h,p.executionDurationMs=b,p.executionSuccess=l().Q.isSuccess(f),u().hs.aggregate(p));return f}),(e=>e.context.automationModel.id));async function m(e){const{action:t,values:o,executionContext:n}=e,i=(0,a().getActionRegistryItem)(t.getType());return i.requiresPriorTransactionsCommitted&&await n.executeEffectMap.waitForTransactionsCommitted(),await i.execute({...n,values:o},t)}var g=()=>o(247331),h=()=>o(919709),y=()=>o(352271);var f=()=>o(502856),v=()=>o(857639),x=()=>o(416504),S=()=>o(728272),b=()=>o(798880),C=()=>o(498212),A=()=>o(495262),k=()=>o(436572),j=()=>o(780054),M=()=>o(518736),T=()=>o(862292),I=()=>o(989423),w=()=>o(909470),P=()=>o(972435),B=()=>o(508496),R=()=>o(10984),_=()=>o(406792);const V={...u().hs,logNotionPerformance(e){const{automationStats:t,environment:o}=e;if((0,u().oh)(t)){var n;const e={metricName:"automation.client.execution_duration_ms",startTime:t.executionStartTime,endTime:t.executionStartTime+t.executionDurationMs};_().default.DO_NOT_USE_measureLegacy(e,{environment:o,data:{success:t.executionSuccess,has_formulas:((null===(n=t.formulaStats)||void 0===n?void 0:n.totalFormulas)??0)>0}})}for(const a of Object.values(t.actionStats))if((0,u().WV)(a)){var i;const e={metricName:"automation.client.action_execution_duration_ms",startTime:a.executionStartTime,endTime:a.executionStartTime+a.executionDurationMs};_().default.DO_NOT_USE_measureLegacy(e,{data:{automation_action_type:a.actionType,success:a.executionSuccess,has_formulas:((null===(i=a.formulaStats)||void 0===i?void 0:i.totalFormulas)??0)>0},environment:o})}}};var E=()=>o(66689),F=()=>o(959013);const D=(0,F().YK)({genericSuccessMessage:{id:"automations.buttonTrigger.genericSuccessMessage",defaultMessage:"Button automation ran successfully"},createdBlocks:{defaultMessage:"Created {numBlocksDuplicated, plural, one {1 block} other {{numBlocksDuplicated} blocks}} on page",id:"automations.buttonTrigger.createdBlocks"},createdSprintsUppercase:{defaultMessage:"Created {numPagesModified, plural, one {1 sprint} other {{numPagesModified} sprints}}",id:"automations.buttonTrigger.createdSprints"},updatedSprintsUppercase:{defaultMessage:"Edited {numPagesModified, plural, one {1 sprint} other {{numPagesModified} sprints}}",id:"automations.buttonTrigger.updatedSprints"},createdSprintsLowercase:{defaultMessage:"created {numPagesModified, plural, one {1 sprint} other {{numPagesModified} sprints}}",id:"automations.buttonTrigger.createdSprintsLowercase"},updatedSprintsLowercase:{defaultMessage:"edited {numPagesModified, plural, one {1 sprint} other {{numPagesModified} sprints}}",id:"automations.buttonTrigger.updatedSprintsLowercase"},createdTasksUppercase:{defaultMessage:"Created {numPagesModified, plural, one {1 task} other {{numPagesModified} tasks}}",id:"automations.buttonTrigger.createdTasks"},updatedTasksUppercase:{defaultMessage:"Edited {numPagesModified, plural, one {1 task} other {{numPagesModified} tasks}}",id:"automations.buttonTrigger.updatedTasks"},createdTasksLowercase:{defaultMessage:"created {numPagesModified, plural, one {1 task} other {{numPagesModified} tasks}}",id:"automations.buttonTrigger.createdTasksLowercase"},updatedTasksLowercase:{defaultMessage:"edited {numPagesModified, plural, one {1 task} other {{numPagesModified} tasks}}",id:"automations.buttonTrigger.updatedTasksLowercase"},createdProjectsUppercase:{defaultMessage:"Created {numPagesModified, plural, one {1 project} other {{numPagesModified} projects}}",id:"automations.buttonTrigger.createdProjects"},updatedProjectsUppercase:{defaultMessage:"Edited {numPagesModified, plural, one {1 project} other {{numPagesModified} projects}}",id:"automations.buttonTrigger.updatedProjects"},createdProjectsLowercase:{defaultMessage:"created {numPagesModified, plural, one {1 project} other {{numPagesModified} projects}}",id:"automations.buttonTrigger.createdProjectsLowercase"},updatedProjectsLowercase:{defaultMessage:"edited {numPagesModified, plural, one {1 project} other {{numPagesModified} projects}}",id:"automations.buttonTrigger.updatedProjectsLowercase"},createdPagesUppercase:{defaultMessage:"Created {numPagesModified, plural, one {1 page} other {{numPagesModified} pages}}",id:"automations.buttonTrigger.createdPages"},updatedPagesUppercase:{defaultMessage:"Edited {numPagesModified, plural, one {1 page} other {{numPagesModified} pages}}",id:"automations.buttonTrigger.updatedPages"},createdPagesLowercase:{defaultMessage:"created {numPagesModified, plural, one {1 page} other {{numPagesModified} pages}}",id:"automations.buttonTrigger.createdPagesLowercase"},updatedPagesLowercase:{defaultMessage:"edited {numPagesModified, plural, one {1 page} other {{numPagesModified} pages}}",id:"automations.buttonTrigger.updatedPagesLowercase"}}),L=["sprint","task","project","page"],O={[E().Tw]:"project",[E().dC]:"task",[E().yH]:"page",[E().TC]:"page",[E().av]:"sprint",[E().pW]:"page",[E().BF]:"page",[E().wZ]:"page",[E().CO]:"page",[E().SC]:"page",[E().Qk]:"page"};function K(e){const{typedAutomationExecutionSummary:t,numBlocksDuplicated:o,intl:n}=e,i=function(e){const{typedAutomationExecutionSummary:t,intl:o}=e,n=[];for(const a of L){const e=t[a];if(e){const{numPagesCreated:t,numPagesEdited:o}=e;t>0&&n.push({pageType:a,modificationType:"created",numPagesModified:t}),o>0&&n.push({pageType:a,modificationType:"updated",numPagesModified:o})}}const i=n.slice(0,N).map(((e,t)=>{let{pageType:n,modificationType:i,numPagesModified:a}=e;const r=W[n][i],l=0===t?r.start:r.append;return o.formatMessage(l,{numPagesModified:a})}));if(i.length>0)return o.formatList(i,{type:"conjunction",style:"long"})}({typedAutomationExecutionSummary:t,intl:n});return i||(o>0?n.formatMessage(D.createdBlocks,{numBlocksDuplicated:o}):n.formatMessage(D.genericSuccessMessage))}const N=3;const W={sprint:{created:{start:D.createdSprintsUppercase,append:D.createdSprintsLowercase},updated:{start:D.updatedSprintsUppercase,append:D.updatedSprintsLowercase}},task:{created:{start:D.createdTasksUppercase,append:D.createdTasksLowercase},updated:{start:D.updatedTasksUppercase,append:D.updatedTasksLowercase}},project:{created:{start:D.createdProjectsUppercase,append:D.createdProjectsLowercase},updated:{start:D.updatedProjectsUppercase,append:D.updatedProjectsLowercase}},page:{created:{start:D.createdPagesUppercase,append:D.createdPagesLowercase},updated:{start:D.updatedPagesUppercase,append:D.updatedPagesLowercase}}};var z=()=>o(179034),H=()=>o(630116);o(18107),o(967357);var U=()=>o(908006),Y=()=>o(584262),G=()=>o(134025),q=()=>o(763824),$=()=>o(449506),Z=()=>o(246826),Q=()=>o(435009),J=()=>o(778417),X=()=>o(317909),ee=()=>o(492414),te=()=>o(351360),oe=()=>o(387712);class ne{constructor(e){this.environment=void 0,this.clientContext=void 0,this.automationModel=void 0,this.numBlocksDuplicated=0,this.transactionServerCommitResults=[],this.saveTransactionInfos=[],this.undoCheckpointName=void 0,this.waitForTransactionsCommitted=async()=>{await Promise.all(this.transactionServerCommitResults),this.transactionServerCommitResults=[]},this.getCollectionSchema=async e=>{const t=await this.clientContext.parentRecordStore.loadRecordModel(e.pointer);return t?{value:{collectionSchema:t.getNormalizedSchema()}}:{error:new(c().WY)({actionId:e.actionId,pointer:e.pointer})}},this.logMessage=e=>{v().log(e)},this.incrementMetric=()=>{},this.queryCollection=async e=>{const t=await o(450859).mA(this.environment,{source:"automation",parentRecordStore:this.clientContext.parentRecordStore,collectionPointer:e.collection,filter:e.filter,sort:e.sort,limit:e.limit});return l().Q.isFail(t)?{error:new(c().rl)({actionId:e.actionId,type:t.error.type,message:t.error.message,cause:t.error})}:{value:{blockIds:t.value.blockIds}}},this.saveTransaction=e=>{const{info:t,operations:n}=e,i=[];if(this.createAndCommitForEffect({userAction:"ClientExecuteEffectMap.saveTransaction",environment:this.environment,perform:e=>{for(const t of n)if((0,o(439180).ph)(t)){const o=H().Bv.createChildStore(this.clientContext.parentRecordStore,t.pointer);X().applyCrdtTextOperation({store:o,operation:t,invertedOperation:void 0,transaction:e})}else if((0,G().$Y)(t)||(0,G().mP)(t)){const o=(0,H().Oo)(this.clientContext.parentRecordStore,t.pointer);X().applyOperation({store:o,operation:t,transaction:e})}else(0,s().HB)(t);i.push(e.id)}}),this.saveTransactionInfos.push(t),"create_page"===t.type)o(970330).v(this.environment,{type:"page",automation_id:this.automationModel.id,from:"button_automation",new_page_id:t.pageId,creating_block_id:t.pageId});else if("update_pages"===t.type){const{editedProperties:e,pageIds:n}=t;for(const t of n)for(const{id:n,type:i}of e)(0,o(810519).u)(this.environment,{block_id:t,property:n,property_type:i,from:"button_automation",automation_id:this.automationModel.id},!1)}else"publish_site"===t.type||(0,s().HB)(t);return Promise.resolve({value:{stats:{totalOperations:n.length,transactionIds:i}}})},this.navigateToPage=e=>{const t=te().default.state.mainEditorCurrentBlockStore;if(!t)return;const n=H().Bv.createChildStore(t,e.page),i="full_page"===e.openIn?(0,ee().Ay)({store:n,fullyQualified:!1,pageVisitSource:Y().y8.ButtonAutomation}):(0,ee().Ay)({store:t,peekViewBlockId:n.id,peekMode:(0,o(712505).getUrlParamFromPeekMode)(e.openIn),fullyQualified:!1,pageVisitSource:Y().y8.ButtonAutomation});Q().oo({environment:this.environment,url:i})},this.openUrl=e=>{Q().oo({environment:this.environment,url:e.url,openInNew:"tab"})},this.sendSlackNotification=async e=>{const{action:t,customMessage:o}=e;return(0,I().u4)({environment:this.environment,event:{eventName:"button_automation_slack_action",eventProperties:{type:this.clientContext.type}}}),this.executeServerSideEffect({effect:"send_slack_notification",actionPointer:t.pointer,contextType:this.clientContext.type,args:{custom_message:o}})},this.duplicateBlockChildren=async e=>{if("button_block"!==this.clientContext.type)return{error:new(c().g7)({contextType:this.clientContext.type})};const t=this.clientContext.blockStore,n=t.getRecordStoreUIParent();if(!n)return{value:{}};const i={};let a,r=t;if("before"===e.insertionPoint)a=!0;else if("after"===e.insertionPoint)a=!1;else if("topOfPage"===e.insertionPoint){let e;if(a=!0,this.clientContext.pageStore?e=this.clientContext.pageStore:n&&n.isTable(z().ev)&&n.getAncestorRecordStoreAtRootPath()&&(e=n.getAncestorRecordStoreAtRootPath()),!e)return{error:new(c()._r)("invalid_record","Missing page store in client context for top of page insertion")};r=e.getContentStores().at(0)||t}else if("bottomOfPage"===e.insertionPoint){let e;if(a=!1,this.clientContext.pageStore?e=this.clientContext.pageStore:n&&n.isTable(z().ev)&&n.getAncestorRecordStoreAtRootPath()&&(e=n.getAncestorRecordStoreAtRootPath()),!e)return{error:new(c()._r)("invalid_record","Missing page store in client context for bottom of page insertion")};r=e.getContentStores().at(-1)||t}else(0,s().HB)(e.insertionPoint);const l=H().Bv.createChildStore(n,e.blockPointer);await l.load();const u=l.getContentStores();a||u.reverse();const d=o(695625).T.findSelectableFromStore(r),p=[],m=this.createAndCommitForEffect({userAction:"ClientExecuteEffectMap.duplicateBlockChildren",environment:this.environment,perform:e=>{const t=u.map((t=>{const[n,i]=o(71584).duplicateBlock({environment:this.environment,stores:[t],transaction:e,addCopyName:!1,deepCopyTransclusionContainers:!1,resolveTemplateVariables:!0,targetSpaceId:(0,o(161479).e)(t.pointer.spaceId),baseUrl:j().A.domainBaseUrl,publicDomainName:j().A.publicDomainName,preferDuplicateLocation:"local",analyticsFrom:"button_automation"}),r=n[0];return d&&(a?d.props.onInsertAbove&&p.push(d.props.onInsertAbove({insertStores:[r],transaction:e})[0]):d.props.onInsertBelow&&p.push(d.props.onInsertBelow({insertStores:[r],transaction:e})[0])),{copy:r,onComplete:i}}));return V.aggregateActionStats(i,{transactionIds:[e.id]}),t}}).performResult;return a||p.reverse(),J().td({environment:this.environment,stores:p}),await q().lX(m,10,(e=>e.onComplete)),U().default.afterNextFlush((()=>{for(const e of p){if(o(547392).Il({environment:this.environment,isAtStartOfLine:!1,store:e}))break}})),this.numBlocksDuplicated+=p.length,V.aggregateActionStats(i,{blocksCreated:this.getNumBlocksDuplicated()}),{value:{stats:i}}},this.displayModal=async e=>{oe().A.setState({open:!0,format:e.format,recordStore:this.clientContext.parentRecordStore}),await oe().A.waitUntil((()=>!oe().A.state.open));const t=oe().A.state;let o;return t.open||(o=t.result),o=o??"continue",{value:{result:o}}},this.initializeTemplateInDatabase=async e=>{const t=this.clientContext.parentRecordStore,n={},i=H().Bv.createChildStore(t,{table:z().ev,id:e.templateId});await i.load();const a=H().md.createChildStore(t,e.collection),r=(0,o(594794).Z1)({environment:this.environment,table:z().ev,spaceId:a.pointer.spaceId}),{performResult:l}=this.createAndCommitForEffect({userAction:"ClientExecuteEffectMap.initializeTemplateInDatabase",environment:this.environment,perform:l=>{const s=Z().Wv({environment:this.environment,transaction:l,inMemoryRecordCache:t.inMemoryRecordCache,type:o(700500).xd.page,id:r});return o(44729).X$({parentStore:a,childStore:s,transaction:l}),o(557281).n5({environment:this.environment,store:s,transaction:l,templateStore:i,title:"template",isCreateIn:!1,isKeyboard:!1,from:"automation_actions"}),o(586481).L({environment:this.environment,store:s,properties:e.propertyUpdates,transaction:l}),V.aggregateActionStats(n,{transactionIds:[l.id]}),s}});return this.saveTransactionInfos.push({type:"create_page",pageId:r,collection:e.collection}),await l.load(),l.isDefined()?{value:{pageId:r,pageModel:l.getModel(),stats:n}}:{error:new(c().WY)({actionId:e.actionId,pointer:l.pointer})}},this.sendInAppNotification=async e=>{const{actionPointer:t,targets:o,message:n,pagePointer:i}=e;return this.executeServerSideEffect({effect:"send_in_app_notification",actionPointer:t,contextType:this.clientContext.type,args:{targets:o,message:n,pagePointer:i}})},this.sendGmailNotification=async e=>{var t;const{action:o,to:n,cc:i,bcc:a,replyTo:r,fromName:l,subject:s,body:c}=e,u="button_block"===this.clientContext.type||"button_property"===this.clientContext.type?null===(t=this.clientContext.pageStore)||void 0===t?void 0:t.pointer:void 0;return this.executeServerSideEffect({effect:"send_gmail_notification",actionPointer:o.pointer,contextType:this.clientContext.type,args:{bcc:a,body:c,cc:i,fromName:l,pagePointer:u,replyTo:r,subject:s,to:n}})},this.updateLastRunTimesForObservability=async e=>{const{automationModel:t,executeResult:o}=e,n=this.clientContext.parentRecordStore,i=H().dn.createChildStore(n,t.pointer);return this.createAndCommitForEffect({userAction:"ClientExecuteEffectMap.updateLastRunTimesForObservability",environment:this.environment,skipUpdatingEditedMetadata:!0,perform:e=>{const t=Date.now();Z().zv({data:{last_executed_time:t},store:i,transaction:e}),l().Q.isFail(o)&&Z().zv({data:{last_failed_time:t},store:i,transaction:e})}}),Promise.resolve({value:void 0})},this.sendHttpRequest=async e=>{const{action:t,pagePointer:o,eventId:n}=e;return this.executeServerSideEffect({effect:"send_http_request",actionPointer:t.pointer,contextType:this.clientContext.type,args:{pagePointer:o,eventId:n}})},this.executeServerSideEffect=async e=>{const t=await $().callApi({eventName:"executeAutomationActionEffect",environment:this.environment,headers:{},data:e});return"failed"===t.type?{error:new(c().PD)({actionId:e.actionPointer.id,message:"Failure in execution of the executeAutomationActionEffect endpoint",cause:t.error})}:t.data},this.sleepForJitter=async e=>{await(0,q().wR)(e)},this.environment=e.environment,this.clientContext=e.clientContext,this.automationModel=e.automationModel,this.undoCheckpointName=`execute-client-automation-${o(206267).JW()}`}getNumBlocksDuplicated(){return this.numBlocksDuplicated}createAndCommitForEffect(e){const t=X().createAndCommit({...e,undoCheckpoint:this.undoCheckpointName,canUndo:!0});return this.transactionServerCommitResults.push(t.serverCommitResult),t}}async function ie(e){var t,o;const{clientContext:n,environment:r,onUndo:c}=e,u=await T().T.formulas.load(),d=await T().T.simpleFormulas.load();await n.automationStore.load();const m=n.automationStore.getModel();if(!m||!m.isButtonType()&&!m.isRecurrenceType())return;const j=m.spaceId,_=n.automationStore.getActionStores().map((e=>e.getModel())).filter(s().O9),E=m.getTriggerType(),F="button_block"===n.type?n.blockStore.id:"button_property"===n.type?null===(t=n.pageStore)||void 0===t?void 0:t.id:"recurrence"===n.type?void 0:(0,s().HB)(n),D=(0,R().AI)();(0,I().u4)({environment:r,event:{eventName:"automation_triggered",eventProperties:{actions:_.map((e=>e.getType())),automation_id:m.id,block_id:F,context_type:n.type,space_id:j,subscription_tier:D,trigger:E}}});const L=new ne({automationModel:m,clientContext:n,environment:r}),N=(0,f().MC)({collectionFeatureGates:(0,w().i)(),experimentService:B().default,getRecordModel:n.parentRecordStore.getRecordModel,loadRecordModel:n.parentRecordStore.loadRecordModel}),W=B().default.getConfigKey("automation_settings","client_formula_timeout_ms"),U=r.currentUser.id?{id:r.currentUser.id,table:b().oo}:void 0,Y="recurrence"!==n.type?null===(o=n.pageStore)||void 0===o?void 0:o.getModel():void 0,G=[];if("recurrence"===n.type&&"completeSprint"===n.recurrence.type){const{values:e}=function(e){const{nextSprintDateRange:t,completeSprintActionType:o}=e;return{values:[{kind:g().FormulaContextValueKind.ContextValue,id:y().GF,value:{type:"date",value:t}},{kind:g().FormulaContextValueKind.ContextValue,id:y().uM,value:{type:"text",value:(0,h().x9d)(o)}}]}}({completeSprintActionType:n.recurrence.completeSprintActionType,nextSprintDateRange:n.recurrence.nextSprintDateRange});G.push(...e)}const q=V.create(m.pointer,"client"),$={author:U,automationModel:m,actionModels:_,contextType:n.type,formulaVariableResolution:{executingUserPointer:U,executingUserTimeZone:(0,x().P)(),thisPageBlockModel:Y},values:G,executeEffectMap:L,executeContextualFormula:async(e,t)=>{if(!t)return{value:{type:"undefined"}};const o=Date.now()+W;return await u.executeFormulaAsync(t,{...e,depth:0,throwOnDownstreamParseFailures:!0,handleDataRequest:N,intl:n.intl,resultCache:new Map,regExpCache:new Map,userTimeZone:(0,x().P)(),visitedProperties:new Set,formulaTimeoutTimestampMs:o,experimentService:B().default,spaceId:j})},formulasModule:u,handleDataRequest:N,loadRecordModel:n.parentRecordStore.loadRecordModel,makeGetRecordModelFn:async e=>Promise.resolve(n.parentRecordStore.getRecordModel),userTimeZone:(0,x().P)(),intl:n.intl,depth:0,throwOnDownstreamParseFailures:!0,visitedProperties:new Set,resultCache:new Map,regExpCache:new Map,eventTracker:(0,I().ik)(r),runtimeRecordPointerSet:new(S().d),runtimeStats:q,spaceIdCreator:await r.idCreator.getSpaceIdCreator(j),simpleFormulasModule:d,useCrdtDefault:(0,M().D8)(n.automationStore.getSpaceStore()),experimentService:B().default,collectionFeatureGates:(0,w().i)(),spaceId:j,eventId:(0,C().Ay)()},Z=await p({context:$});V.logNotionPerformance({automationStats:q,environment:r});const Q={automationContextType:n.type,automationId:m.id,automationRuntime:q,spaceId:j,userId:null==U?void 0:U.id};if(l().Q.isFail(Z)){const{error:e}=Z;0,v().log({actor:U,data:Q,error:e,from:"automationActions",level:"error",type:"AutomationExecutionError"}),(0,I().u4)({environment:r,event:{eventName:"automation_execution_fail",eventProperties:{automation_id:m.id,block_id:F,context_type:n.type,error_type:e.type,execution_duration_ms:q.executionDurationMs,subscription_tier:D,trigger:E}}});const t=function(e){if("query_collection_too_many_items"===e.type)return i().messages.errorQueryCollectionTooManyPages;if("record_pointer_in_trash"===e.type)return i().messages.errorRecordInTrash;return i().messages.genericErrorMessage}(e),o=P().A.formatMessage(t);k().D6({label:o})}else(0,I().u4)({environment:r,event:{eventName:"automation_execution_success",eventProperties:{automation_id:m.id,block_id:F,context_type:n.type,execution_duration_ms:q.executionDurationMs,subscription_tier:D,trigger:E}}}),v().log({actor:U,data:Q,from:"automationActions",level:"info",type:"AutomationExecutionSuccess"}),function(e){return!e.every((e=>!(0,a().getActionRegistryItem)(e.type).hasSideEffects))}(_)&&await async function(e){const{actionModels:t,environment:o,saveTransactionInfos:n,clientContext:i,undoCheckpointName:r,numBlocksDuplicated:l,onUndo:c}=e,u=function(e){const{saveTransactionInfos:t,parentRecordStore:o}=e,n={},i=new Set;for(const u of t)if("create_page"===u.type){var a,r;if(i.has(u.pageId))continue;const e=H().md.createChildStore(o,u.collection).getDatabaseType(),t=(e&&O[e])??"page",l=(null===(a=n[t])||void 0===a?void 0:a.numPagesEdited)??0,s=(null===(r=n[t])||void 0===r?void 0:r.numPagesCreated)??0;n[t]={numPagesCreated:s+1,numPagesEdited:l},i.add(u.pageId)}else if("update_pages"===u.type){var l,c;const e=H().md.createChildStore(o,u.collection).getDatabaseType(),t=(e&&O[e])??"page",i=(null===(l=n[t])||void 0===l?void 0:l.numPagesEdited)??0,a=(null===(c=n[t])||void 0===c?void 0:c.numPagesCreated)??0;n[t]={numPagesCreated:a,numPagesEdited:i+u.pageIds.length}}else"publish_site"===u.type?n.page={numPagesCreated:0,numPagesEdited:1}:(0,s().HB)(u);return n}({saveTransactionInfos:n,parentRecordStore:i.parentRecordStore}),d=K({typedAutomationExecutionSummary:u,numBlocksDuplicated:l,intl:i.intl}),p=await async function(e){const{saveTransactionInfos:t,clientContext:o}=e;let n;for(const r of t.slice().reverse()){if("create_page"===r.type){var i;n=H().Bv.createChildStore(o.parentRecordStore,{table:z().ev,id:r.pageId,spaceId:null===(i=r.collection)||void 0===i?void 0:i.spaceId});break}if("update_pages"===r.type){if(1===r.pageIds.length){var a;n=H().Bv.createChildStore(o.parentRecordStore,{table:z().ev,id:r.pageIds[0],spaceId:null===(a=r.collection)||void 0===a?void 0:a.spaceId})}else{const e=H().md.createChildStore(o.parentRecordStore,r.collection);await e.load();const t=e.getParentBlockStore();if(!t)continue;n=t}break}if("publish_site"===r.type)break;(0,s().HB)(r)}return n}({saveTransactionInfos:n,clientContext:i}),m=function(e){let t;for(const o of e){const e=(0,a().getActionRegistryItem)(o.type);if(!1===e.invertible)return!1;!0===e.invertible&&(t=!0)}return t}(t),g=!0===m&&A().xy(r)?()=>{A().JM({environment:o,namedRevisionId:r}),k().N2(),c&&c(r)}:void 0;k().AC({blockToOpenStore:p,item:{label:d},performUndo:g})}({actionModels:_,clientContext:n,environment:r,numBlocksDuplicated:L.getNumBlocksDuplicated(),onUndo:c,saveTransactionInfos:L.saveTransactionInfos,undoCheckpointName:L.undoCheckpointName})}var ae=()=>o(653417),re=o(296540),le=()=>o(484714),se=()=>o(56366),ce=()=>o(401497),ue=()=>o(284371),de=()=>o(725614),pe=()=>o(155004),me=()=>o(623580),ge=()=>o(14235),he=()=>o(204063),ye=()=>o(2143),fe=()=>o(753199),ve=()=>o(997583),xe=()=>o(756279),Se=()=>o(991249),be=()=>o(546461),Ce=()=>o(911724),Ae=()=>o(276936),ke=()=>o(559419),je=()=>o(656134),Me=()=>o(840094),Te=()=>o(633904),Ie=()=>o(774256),we=()=>o(642054),Pe=()=>o(383594),Be=()=>o(285790),Re=()=>o(614505),_e=()=>o(859428),Ve=()=>o(553965),Ee=()=>o(486666),Fe=o(474848);const De=(0,F().YK)({icon:{defaultMessage:"Icon",id:"buttonBlock.button.iconHeading"},addIconButtonAriaLabel:{defaultMessage:"Add icon",id:"buttonBlock.button.addIconButtonAriaLabel"}});function Le(e){const{disabled:t,currentIcon:o,handleIconChange:n,store:i}=e,a=(0,le().v3)(),r=(0,F().tz)(),l=(0,re.useCallback)((e=>{Pe().W(a,{originRect:e.currentTarget.getBoundingClientRect(),originGap:4,popupWidth:Ee().jv,popupHeight:Ee().GF,isSmallWidth:!1,title:r.formatMessage(De.icon),currentTab:"icon",tabs:[{type:"icon",onChange:e=>{n(e),Pe().I()}},{type:"emoji",onChange:(e,t)=>{n(e),Pe().I()}}],onDelete:o?()=>{n(void 0),Pe().I()}:void 0})}),[a,n,r,o]),s=(0,ce().IS)((e=>({iconButton:{background:"transparent",boxShadow:e.shadowXS,width:28,height:28},icon:{width:16,height:16}})),[]),c=e=>(0,Fe.jsx)(Be().A,{ariaLabel:r.formatMessage(De.addIconButtonAriaLabel),style:s.iconButton,iconStyle:s.icon,hasBackground:!0,disabled:t,showShadow:!0,icon:e=>o?(0,Fe.jsx)(Re().A,{disabled:!0,isEmptyPage:!1,size:24,icon:{icon:o,pointer:i.pointer},style:e}):(0,we().A)(e),...(0,Ve().A)(e??{},{onClick:l})});return o?c():(0,Fe.jsx)(_e().A,{renderTooltip:()=>(0,Fe.jsx)(F().sA,{defaultMessage:"Add an icon",id:"buttonBlock.button.addIcon"}),delayThreshold:300,render:c})}var Oe=()=>o(805751),Ke=()=>o(79043),Ne=()=>o(24157),We=()=>o(366360);function ze(e){const{value:t,onChange:o,wrapStyle:n,onBlur:i,...a}=e,[r,l]=(0,re.useState)(!1),s=(0,le().v3)(),c=(0,Ke().A)(!0),u=(0,re.useCallback)((()=>{l(!1),null==i||i()}),[i]),d=(0,re.useCallback)((e=>o(e.currentTarget.value)),[o]),p=(0,re.useCallback)((()=>{"empty"!==Ne().default.state.mode&&J().IU({environment:s,preventDismissMobileKeyboard:!0}),l(!0)}),[s]);return(0,Fe.jsx)(Oe().A,{debugName:"AutomationPlainTextInput",capture:r,children:(0,Fe.jsx)("div",{...c,style:n,children:(0,Fe.jsx)(me().A,{...a,onBlur:u,onChange:d,onFocus:p,value:t})})})}function He(e){const{onChange:t,store:o,...n}=e,{maybePersistedTransactionActions:i}=(0,We().b)(),a=(0,se().K8)((()=>o.getValue()??""),[o]),r=(0,re.useCallback)((e=>{i.createAndCommit({userAction:"AutomationPlainTextInput.setValue",perform:t=>{Z().KY({store:o,transaction:t,value:e})}}),null==t||t(e)}),[i,t,o]);return(0,Fe.jsx)(ze,{value:a,onChange:r,...n})}var Ue=()=>o(826352),Ye=()=>o(535511),Ge=(o(803949),()=>o(72645)),qe=()=>o(813297),$e=()=>o(760217),Ze=()=>o(406699),Qe=()=>o(439264),Je=()=>o(645873),Xe=()=>o(463830),et=()=>o(170253),tt=()=>o(383574),ot=()=>o(542339),nt=()=>o(895876),it=()=>o(963589),at=()=>o(301782);function rt(e){return!e.pathIsDead()&&e.isDefined()}function lt(e){if(!(0,s().O9)(e))return[];return e.getTemplatePageStores().filter((e=>rt(e)))}var st=()=>o(475679),ct=()=>o(310109),ut=()=>o(784892),dt=()=>o(16006),pt=()=>o(684125),mt=()=>o(133518),gt=()=>o(548526),ht=()=>o(194373);function yt(e){const{actionStore:t,currentValue:o,onChange:n,disabled:i,errorMessage:a,errorIcon:r,skipVariables:l}=e,c=(0,le().v3)(),{typecheckResult:u}=(0,be().YC)(),d=(0,it().X)("automation_updated_error_states"),p=(0,se().uB)(void 0,Xe().A),m=t.id,g=(0,mt().F)({actionId:m}),h=(0,se().K8)((()=>o&&"collection"===o.type?H().md.createChildStore(t,o.collection):void 0),[o,t]),y=(0,se().K8)((()=>{if(m&&u&&o&&"variable"===o.type)return(0,ct().getContextValueForActionById)(u,m,o.id)}),[o,u,m]),f=(0,re.useCallback)((e=>{"collection"!==e.type&&"variable"!==e.type||(n(e),p.reset(),(0,at().CM)(((o,n,i)=>{const a=(0,at().zc)({automationActionStore:t,formulaAnalyticsModule:n,formulasModule:o,simpleFormulasModule:i});(0,s().O9)(a)&&(0,I().u4)({environment:c,event:{eventName:"automation_target_pick",eventProperties:{automation_action:a,automation_id:t.getParentId(),target_type:e.type}}})})))}),[n,p,t,c]),v=(0,re.useCallback)((()=>p.reset()),[p]),x=(0,je().j)(),S=Boolean(h||y);return(0,Fe.jsx)(Ze().Ay,{buttonPopupStore:p,popupType:x,alignmentToOrigin:Ze().yP.Center,placementToOrigin:Ze().sx.Bottom,originGap:0,disabled:i,renderOrigin:e=>(0,Fe.jsx)(gt().x,{...e,disabled:i,isCompact:!0,isError:Boolean(a),hasActionRequired:!S,tooltipMessage:!d&&a,errorIcon:r,dropdownButtonType:"dropdown",children:h?(0,Fe.jsx)(dt().A,{store:h}):y?(0,Fe.jsx)(pt().F,{format:ut().NY.Medium,isSingle:!0,value:y,style:{background:"transparent",color:"unset",margin:"-1.5px 0",padding:0}}):(0,Fe.jsx)(F().sA,{id:"automations.databasePicker.buttonPlaceholder",defaultMessage:"Select database"})}),render:e=>(0,Fe.jsx)(ht()._,{formulaTypecheckContextValues:g,onChange:f,onClose:v,parentRecordStore:t,selectedTarget:o,skipPages:!0,skipVariables:l})})}var ft=()=>o(763996),vt=()=>o(928600),xt=()=>o(939740),St=()=>o(89924),bt=()=>o(781697);function Ct(e){const{collectionStore:t,currentTemplateId:o,onChange:n,disabled:i,errorMessage:a}=e,r=(0,le().v3)(),{device:l}=r,s=(0,it().X)("automation_updated_error_states"),c=(0,se().K8)((()=>{if(!t)return;if(o){const e=H().Bv.createChildStore(t,{id:o,spaceId:t.getSpaceId(),table:z().ev});if(!e.pathIsDead())return e}const e=t.getDefaultTemplatePageStore();return e&&!e.pathIsDead()?e:void 0}),[t,o]),u=(0,je().j)(),d=(0,se().K8)((()=>lt(t)),[t]),p=Boolean(o);return(0,Fe.jsx)(Ze().Ay,{popupType:u,alignmentToOrigin:Ze().yP.Center,placementToOrigin:Ze().sx.Bottom,originGap:0,disabled:i,renderOrigin:e=>(0,Fe.jsx)(gt().x,{...e,disabled:i,isCompact:!0,isError:Boolean(a),style:{minWidth:50},tooltipMessage:!s&&a,dropdownButtonType:"dropdown",children:c&&(p||rt(c))?(0,Fe.jsx)(dt().A,{store:c}):(0,Fe.jsx)(F().sA,{id:"automations.templatePicker.buttonPlaceholder",defaultMessage:"Empty"})}),render:e=>{const o=(0,bt().v)({device:l,width:280});return(0,Fe.jsx)(vt().A,{...o,children:t&&(0,Fe.jsx)(At,{collectionStore:t,templatePageStores:d,parent:e,onChange:n})})}})}function At(e){const{collectionStore:t,templatePageStores:o,parent:n,onChange:i}=e,a=(0,le().v3)(),{device:l}=a,s=(0,se().K8)((()=>t.getDefaultTemplatePageStore()),[t]),c=o.map((e=>{const o={key:e.id,render:o=>(0,re.createElement)(ft().A,{...o,key:e.id,isOverlay:!0,collectionStore:t,canConfigureCollection:!1,templateStore:e,isMobile:l.isMobile,locked:!0,isDefault:s===e,onCancelClick:r().lQ,draggable:!1}),action:t=>{i(e.id),n.close()}};return o})),u={key:"empty",render:e=>(0,re.createElement)(ft().A,{...e,key:"empty",isOverlay:!0,collectionStore:t,canConfigureCollection:!1,templateStore:void 0,isMobile:l.isMobile,locked:!0,onCancelClick:r().lQ,draggable:!1}),action:e=>{i(void 0),n.close()}};return(0,Fe.jsx)(xt().Ay,{type:xt().Oh.Vertical,initialFocus:0,sections:[{key:"results",render:e=>(0,Fe.jsx)(St().A,{...e,title:(0,Fe.jsx)(F().sA,{id:"automations.templatePicker.menuHeader",defaultMessage:"Select template"})}),items:r().oE([...c,s?void 0:u])}]})}var kt=()=>o(807787);function jt(e){const{actionStore:t,disabled:o,errorMessage:n,onChange:i,value:a,errorIcon:r}=e,l=(0,it().X)("automation_updated_error_states"),s=(0,se().K8)((()=>{let e;if("collection"===(null==a?void 0:a.type)){const o=t.getRecordModel(a.collection);e=null==o?void 0:o.getDatabaseType()}return(0,nt().$O)(e)}),[t,a]);return(0,Fe.jsx)(F().sA,{defaultMessage:"Add {itemType} to{collectionPicker}",id:"automations.CreatePageActionV2.header.title",values:{collectionPicker:(0,Fe.jsx)(yt,{actionStore:t,currentValue:a,disabled:o,errorMessage:n,errorIcon:l?r:void 0,onChange:i,skipVariables:!0}),itemType:s}})}function Mt(e){const{collectionStore:t,disabled:o,errorMessage:n,onChange:i,value:a}=e;return(0,Fe.jsx)(F().sA,{defaultMessage:"as{collectionTemplatePicker}",id:"automations.CreatePageActionV2.header.template",values:{collectionTemplatePicker:(0,Fe.jsx)(Ct,{collectionStore:t,currentTemplateId:a,disabled:o,errorMessage:n,onChange:i})}})}var Tt=()=>o(84817),It=()=>o(199378),wt=()=>o(183558),Pt=()=>o(770586);function Bt(e,t){const o=e.getConfigStore().getKeyStore("values"),n=o.getValue(),i=null==n?void 0:n[t];return(0,s().O9)(i)?{valueConfig:i,valueStore:o}:{valueConfig:void 0,valueStore:void 0}}var Rt=()=>o(493823);function _t(e){const{disabled:t,onClick:o}=e,n=(0,ce().IS)((e=>({button:{color:e.text.secondary},children:{...ue().RC,flex:"1 1 auto"}})),[]);return(0,Fe.jsx)(Rt().p,{disabled:t,disabledFeedback:t,onClick:o,shouldShrink:!0,style:n.button,children:(0,Fe.jsx)("div",{style:n.children,children:(0,Fe.jsx)(F().sA,{defaultMessage:"Define another variable…",id:"automations.DefineVariablesAction.addVariableButton.label"})})})}var Vt=()=>o(791089),Et=()=>o(521732),Ft=()=>o(419830),Dt=()=>o(858163),Lt=()=>o(938818),Ot=()=>o(546806),Kt=()=>o(962730),Nt=()=>o(852507),Wt=()=>o(708685),zt=()=>o(145076),Ht=()=>o(212439),Ut=()=>o(173019),Yt=()=>o(735384),Gt=()=>o(514503),qt=()=>o(736767),$t=()=>o(419357),Zt=()=>o(693954);function Qt(){const e=(0,ce().IS)((e=>({warningIcon:{fill:e.icon.uiRedPrimary,height:14,width:15}})),[]);return(0,Zt().Q)(e.warningIcon)}function Jt(){}function Xt(e){const{analyzedFormulaOutput:t,onClearClick:o,onDeleteClick:n,onDuplicateClick:i,onEditFormulaClick:a,onEditTextClick:r,onVariableNameChange:l,onVariableNameSubmit:c,variableName:u}=e,{parseErrors:d,type:p,typeErrors:m}=t??{},g=(0,F().tz)(),h=(0,re.useMemo)((()=>(0,Lt().L)(g,d??[],m??[])),[g,d,m]),y=(0,s().O9)(h),f=(0,it().X)("automation_updated_error_states"),v=(0,bt().e)({width:265}),x=(0,ce().IS)((e=>({duplicateIcon:{height:17,width:17},formulaErrorCaptionMenuItem:{marginBlockStart:0,paddingBlockStart:0,paddingInline:4},formulaIcon:{height:17,width:17},formulaReturnTypeDesktopIcon:{marginBlockStart:4,marginInlineStart:12},formulaReturnTypeCaptionMenuItem:{marginBlock:0,paddingInline:4},formulaErrorCaption:{...f&&y&&{color:e.text.uiRedPrimary}},nameInputMenuItem:{marginBlock:6},simpleFormulaIcon:{height:17,width:17},trashIcon:{height:17,width:17}})),[f,y]),S=(0,re.useMemo)((()=>p?(0,Wt().getHumanReadableType)(p):zt().qY.unknown),[p]),b=(0,le().v3)();(0,Nt().l)((()=>{de().clear({environment:b})}));const C=[];if((0,s().O9)(u)){const e=(0,s().O9)(l);C.push({items:[{action:()=>null,key:"variable-name-input-item",render:t=>(0,Fe.jsx)($t().Ay,{...t,disabled:!e,focus:!0,onChange:l??Jt,onSubmit:c,placeholder:g.formatMessage(It().xC),style:x.nameInputMenuItem,value:u})}],key:"variable-name-input-section",render:e=>(0,Fe.jsx)(St().A,{...e,enableActionSheetTitle:!0})})}if((0,s().O9)(r)||(0,s().O9)(a)||(0,s().O9)(i)){const e=[];(0,s().O9)(r)&&e.push({action:r,key:"variable-name-manage-edit-text",render:e=>(0,Fe.jsx)($e().A,{...e,icon:(0,Ut().r)(x.simpleFormulaIcon),title:(0,Fe.jsx)(F().sA,{defaultMessage:"Edit as text",id:"EditVariableMenu.editSimpleFormulaButtonMenuItem.label"})})}),(0,s().O9)(a)&&e.push({action:a,key:"variable-name-manage-edit-formula",render:e=>(0,Fe.jsx)($e().A,{...e,icon:(0,Gt().n)(x.formulaIcon),title:(0,Fe.jsx)(F().sA,{defaultMessage:"Edit as formula",id:"EditVariableMenu.editFormulaButtonMenuItem.label"})})}),(0,s().O9)(i)&&e.push({action:i,key:"variable-name-manage-duplicate",render:e=>(0,Fe.jsx)($e().A,{...e,icon:(0,Ht().V)(x.duplicateIcon),title:(0,Fe.jsx)(F().sA,{defaultMessage:"Duplicate",id:"EditVariableMenu.duplicateFormulaButtonMenuItem.label"})})});const t=C.length>0;C.push({items:e,key:"variable-name-manage-actions",render:e=>(0,Fe.jsx)(St().A,{...e,enableActionSheetTitle:!0,topBorder:t})})}if((0,s().O9)(n)||(0,s().O9)(o)){const e=[];(0,s().O9)(n)&&e.push({action:n,key:"variable-name-destructive-delete",render:e=>(0,Fe.jsx)($e().A,{...e,icon:(0,Yt().I)(x.trashIcon),title:(0,Fe.jsx)(F().sA,{defaultMessage:"Delete",id:"EditVariableMenu.deleteFormulaButtonMenuItem.label"})})}),(0,s().O9)(o)&&e.push({action:o,key:"variable-name-destructive-clear",render:e=>(0,Fe.jsx)($e().A,{...e,icon:(0,Yt().I)(x.trashIcon),title:(0,Fe.jsx)(F().sA,{defaultMessage:"Clear variable",id:"EditVariableMenu.clearFormulaButtonMenuItem.label"})})});const t=C.length>0;C.push({items:e,key:"variable-name-destructive-actions",render:e=>(0,Fe.jsx)(St().A,{...e,enableActionSheetTitle:!0,topBorder:t})})}const A=C.length>0,k=[{action:()=>{},key:"variable-name-typecheck-return-type",render:e=>(0,Fe.jsx)(qt().A,{...e,caption:(0,Fe.jsx)("span",{style:x.formulaErrorCaption,children:(0,Fe.jsx)(F().sA,{defaultMessage:"Type: {formulaType}",id:"EditVariableMenu.formulaReturnType.label",values:{formulaType:(0,Fe.jsx)(F().sA,{...S})}})}),desktopIconStyle:x.formulaReturnTypeDesktopIcon,dontShrinkIcon:!0,icon:y?(0,Fe.jsx)(Qt,{}):null,shouldWrapCaption:!0,style:x.formulaReturnTypeCaptionMenuItem})}];return y&&k.push({action:()=>{},key:"variable-name-typecheck-error",render:e=>(0,Fe.jsx)(qt().A,{...e,caption:(0,Fe.jsx)(F().sA,{...h}),shouldWrapCaption:!0,style:x.formulaErrorCaptionMenuItem})}),C.push({items:k,key:"variable-name-typecheck",render:e=>(0,Fe.jsx)(St().A,{...e,enableActionSheetTitle:!0,topBorder:A})}),0===C.length?null:(0,Fe.jsx)(vt().A,{...v,children:(0,Fe.jsx)(xt().Ay,{initialFocus:0,sections:C,type:xt().Oh.Vertical})})}var eo=()=>o(977345);const to={type:"unknown"};function oo(e){const{type:t}=e,o=(0,ce().IS)((e=>({icon:{fill:e.icon.secondary,width:16,height:16}})),[]);return(0,eo().Ix)(t??to)(o.icon)}function no(e){const{analyzedFormulaOutput:t,buttonPopupStore:o,children:n,disabled:i,errorMessage:a,onClearClick:r,onDeleteClick:l,onDuplicateClick:s,onEditFormulaClick:c,onEditTextClick:u,onVariableNameChange:d,variableName:p}=e,{parseErrors:m,typeErrors:g}=t,h=Boolean(a),y=Boolean(m&&m.length>0),f=Boolean(g&&g.length>0),v=h||y||f,x=(0,it().X)("automation_updated_error_states"),S=(0,ce().IS)((e=>({button:{color:e.text.secondary,padding:"0 6px",gap:2},chevronIcon:{fill:e.icon.secondary,flex:"0 0 auto",height:14,width:14},children:{...ue().RC,color:v?e.errorText:e.text.secondary,flex:"1 1 auto",...v&&x&&{fontWeight:ue().Wy.medium}},iconWrap:{marginInlineEnd:2}})),[x,v]),b=(0,je().j)(),C=(0,se().uB)(o,Xe().A),A=(0,re.useCallback)((()=>a??null),[a]),k=(0,re.useCallback)((()=>{C.reset()}),[C]);return(0,Fe.jsx)(Ze().Ay,{alignmentToOrigin:Ze().yP.Start,buttonPopupStore:C,disabled:i,originGap:0,placementToOrigin:Ze().sx.Bottom,popupType:b,renderOrigin:e=>(0,Fe.jsx)(_e().A,{delayThreshold:0,disableTooltip:!h,placement:Kt().W.Bottom,render:o=>(0,Fe.jsxs)(Rt().p,{...e,...o,disabled:i,disabledFeedback:i,shouldShrink:!0,style:S.button,children:[(0,Fe.jsx)("div",{style:S.iconWrap,children:v?(0,Fe.jsx)(Qt,{}):(0,Fe.jsx)(oo,{type:t.type})}),(0,Fe.jsx)("div",{style:S.children,children:n}),(0,Ot().e)(S.chevronIcon)]}),renderTooltip:A}),render:e=>(0,Fe.jsx)(Xt,{analyzedFormulaOutput:t,onClearClick:r,onDeleteClick:l,onDuplicateClick:s,onEditFormulaClick:c,onEditTextClick:u,onVariableNameChange:d,onVariableNameSubmit:k,variableName:p})})}function io(e){var t,o;const{actionStore:n,variableId:a}=e,r=(0,le().v3)(),{automationStore:l,contextType:c}=(0,be().EC)(),{disabled:u,maybePersistedTransactionActions:d,suppressActionErrors:p}=(0,We().b)(),m=(0,F().tz)(),{value:g}=(0,Je().fJ)(T().T.formulas),{value:h}=(0,Je().fJ)(qe().QV.automationTypecheck),y=(0,se().uB)(void 0,Xe().A),f=re.useRef(null),v=(0,se().uB)(void 0,Xe().A),x=(0,se().K8)((()=>l.getActionStores()),[l]),[S,b]=(0,se().K8)((()=>[n.id,n.getSpaceId()]),[n]),C=(0,mt().F)({actionId:S}),{onTextStoreSelect:A,onTextStoreUnselect:k}=(0,Dt().W)(n),j=(0,se().K8)((()=>n.getConfig()),[n]),M=(0,se().K8)((()=>{var e;return null==j||null===(e=j.values)||void 0===e?void 0:e[a]}),[j,a]),I="formula"===(null==M||null===(t=M.value)||void 0===t?void 0:t.type),P=(0,se().K8)((()=>{if(g&&b)return(0,Vt().analyzeSimpleFormulaOrFormulaSync)({context:{handleDataRequest:g.createFormulaDataRequestSyncHandler(n.getRecordModel),spaceId:b,valueTypes:C.slice(0),featureGates:(0,w().i)()},value:null==M?void 0:M.value})}),[b,n.getRecordModel,C,g,null==M?void 0:M.value]),B=(0,re.useMemo)((()=>!p.includes(n.id)),[p,n]),{errorMessage:R}=(0,ae().useErrorComponentForAction)({actionId:n.id,errorKey:a,shouldShow:B}),_=(0,re.useCallback)((e=>{const t=e.target.value;d.createAndCommit({perform:e=>{!function(e){const{automationActionStore:t,transaction:o,variableId:n,variableName:i}=e,{valueConfig:a,valueStore:r}=Bt(t,n);(0,s().O9)(a)&&(0,s().O9)(r)&&Z().zv({data:{[n]:{...a,name:i}},store:r,transaction:o})}({automationActionStore:n,transaction:e,variableId:a,variableName:t})},userAction:"DefineVariablesAction.editVariableName"}),(0,at().UB)(r,{automationStore:l,automationActionStore:n})}),[n,l,r,d,a]),V=(0,re.useCallback)((()=>{d.createAndCommit({perform:e=>{!function(e){const{automationActionStore:t,automationActionStores:o,transaction:n,variableId:i}=e,{valueConfig:a,valueStore:r}=Bt(t,i);if(!(0,s().O9)(a)||!(0,s().O9)(r))return;const l=(0,wt().Ay)(),c=(0,Pt().v)(o,a.name);Z().zv({data:{[l]:{...a,name:c}},store:r,transaction:n}),X().applyOperation({operation:{args:{id:l},command:"listAfter",path:["config","variableIds"],pointer:t.pointer},store:t,transaction:n})}({automationActionStore:n,automationActionStores:x,transaction:e,variableId:a})},userAction:"DefineVariables.duplicateVariable"}),y.reset(),(0,at().UB)(r,{automationStore:l,automationActionStore:n})}),[n,x,l,y,r,d,a]),E=(0,re.useCallback)((e=>{g&&h&&(d.createAndCommit({perform:t=>{!function(e){const{automationActionStore:t,transaction:o,variableId:n,variableValue:i}=e,{valueConfig:a,valueStore:r}=Bt(t,n);(0,s().O9)(a)&&(0,s().O9)(r)&&Z().zv({data:{[n]:{...a,value:i}},store:r,transaction:o})}({automationActionStore:n,transaction:t,variableValue:e,variableId:a}),(0,i().clearInvalidVariables)({environment:r,automationStore:l,automationTypecheckModule:h,contextType:c,formulasModule:g,intl:m,transaction:t})},userAction:"DefineVariables.editVariableValue"}),(0,at().UB)(r,{automationStore:l,automationActionStore:n}))}),[n,l,h,c,r,g,m,d,a]),D=(0,re.useMemo)((()=>{if(null==j||!j.variableIds||1===j.variableIds.length)return function(){y.setState({open:!1}),E({type:"simple",value:void 0})}}),[null==j?void 0:j.variableIds,y,E]),L=(0,re.useMemo)((()=>{if(!(0,s().O9)(D))return function(){d.createAndCommit({perform:e=>{!function(e){const{automationActionStore:t,transaction:o,variableId:n}=e,{valueStore:i}=Bt(t,n);(0,s().O9)(i)&&(Z().zv({data:{[n]:null},store:i,transaction:o}),X().applyOperation({operation:{args:{id:n},command:"listRemove",path:["config","variableIds"],pointer:t.pointer},store:t,transaction:o}))}({automationActionStore:n,transaction:e,variableId:a})},userAction:"DefineVariables.deleteVariable"}),y.reset(),(0,at().UB)(r,{automationStore:l,automationActionStore:n})}}),[n,l,y,r,d,D,a]),O=(0,re.useCallback)((async()=>{var e,t;if(I){if(!(await(0,Ft().Cp)()))return}null===(e=f.current)||void 0===e||e.focus(),y.setState({open:!1}),E({type:"simple",value:null==M||null===(t=M.value)||void 0===t?void 0:t.value})}),[y,I,E,null==M||null===(o=M.value)||void 0===o?void 0:o.value]),K=(0,re.useCallback)((()=>{var e;null===(e=f.current)||void 0===e||e.blur(),y.setState({open:!1}),v.setState({open:!0})}),[y,v]),N=(0,ce().IS)((()=>({textInput:{width:"100%"}})),[]),W=(0,re.useCallback)((()=>{de().clear({environment:r})}),[r]);if(!b||!M||!P)return null;const z=M.name||m.formatMessage(It().xC),{parseErrors:H=[],typeErrors:U=[]}=P,Y=H.length>0||U.length>0;return(0,Fe.jsxs)(Tt().Y1,{direction:"vertical",gap:7,children:[(0,Fe.jsx)(Tt().Y1,{direction:"horizontal",width:"hug",children:(0,Fe.jsx)(no,{analyzedFormulaOutput:P,buttonPopupStore:y,errorMessage:R,onClearClick:D,onDeleteClick:L,onDuplicateClick:V,onEditFormulaClick:K,onEditTextClick:O,onVariableNameChange:_,variableName:M.name,children:(0,Fe.jsx)("span",{style:ue().RC,children:z})})}),(0,Fe.jsx)(Et().Y,{disabled:u,formulaInputButtonPopupStore:v,formulaTypecheckContextValues:C,onChange:E,onTextStoreSelect:A,onTextStoreUnselect:k,onTextEsc:W,parentRecordStore:n,ref:f,spaceId:b,style:N.textInput,value:M.value,shouldShowErrorStyles:Y}),(0,Fe.jsx)(Lt().J,{analyzedFormulaOutput:P})]},a)}o(672577);var ao=()=>o(340498),ro=()=>o(261237),lo=()=>o(99945),so=()=>o(199896),co=()=>o(38337);const uo=(0,F().YK)({aboveMenuItemLabel:{id:"automations.DuplicateBlocksAction.aboveButtonLabel",defaultMessage:"Above button"},aboveTitle:{id:"automations.DuplicateBlocksAction.aboveTitle",defaultMessage:"above button"},belowMenuItemLabel:{id:"automations.DuplicateBlocksAction.belowButtonLabel",defaultMessage:"Below button"},belowTitle:{id:"automations.DuplicateBlocksAction.belowTitle",defaultMessage:"below button"},title:{defaultMessage:"Insert blocks {insertionPicker}",id:"automations.DuplicateBlocksAction.title"},topOfPageMenuItemLabel:{id:"automations.DuplicateBlocksAction.topOfPageButtonLabel",defaultMessage:"At top of page"},topOfPageTitle:{id:"automations.DuplicateBlocksAction.topOfPageTitle",defaultMessage:"at top of page"},bottomOfPageMenuItemLabel:{id:"automations.DuplicateBlocksAction.bottomOfPageButtonLabel",defaultMessage:"At bottom of page"},bottomOfPageTitle:{id:"automations.DuplicateBlocksAction.bottomOfPageTitle",defaultMessage:"at bottom of page"}}),po={before:{icon:(0,o(334003).F)({width:ao().Ev.default}),key:"before",menuItemLabel:uo.aboveMenuItemLabel,title:uo.aboveTitle},after:{icon:(0,o(457056).o)({width:ao().Ev.default}),key:"after",menuItemLabel:uo.belowMenuItemLabel,title:uo.belowTitle},topOfPage:{icon:(0,o(419178).Q)({width:ao().Ev.default}),key:"topOfPage",menuItemLabel:uo.topOfPageMenuItemLabel,title:uo.topOfPageTitle},bottomOfPage:{icon:(0,o(820579).f)({width:ao().Ev.default}),key:"bottomOfPage",menuItemLabel:uo.bottomOfPageMenuItemLabel,title:uo.bottomOfPageTitle}},mo=po.after;function go(e){const{currentOption:t,disabled:o,onChange:n}=e,i=(0,F().tz)(),a=(0,je().j)(),r=(0,se().uB)(void 0,Xe().A),l=(0,re.useCallback)((e=>{n&&t.key!==e&&n(e),r.setState({open:!1})}),[r,t,n]);return(0,Fe.jsx)(Ze().Ay,{alignmentToOrigin:Ze().yP.Center,buttonPopupStore:r,disabled:o,originGap:0,placementToOrigin:Ze().sx.Bottom,popupType:a,render:()=>(0,Fe.jsx)(ho,{currentOption:t,onChange:l}),renderOrigin:e=>(0,Fe.jsx)(gt().x,{...e,disabled:o,isCompact:!0,dropdownButtonType:"dropdown",children:i.formatMessage(t.title)})})}function ho(e){const{currentOption:t,onChange:o}=e,n=(0,F().tz)(),i=(0,bt().e)({maxWidth:360}),a=Object.values(po).map((e=>({key:e.key,render:o=>(0,Fe.jsx)($e().A,{...o,checkState:t.key===e.key,icon:e.icon,title:n.formatMessage(e.menuItemLabel)}),action:()=>o(e.key)})));return(0,Fe.jsx)(vt().A,{...i,children:(0,Fe.jsx)(xt().Ay,{initialFocus:0,sections:[{key:0,render:e=>(0,Fe.jsx)(St().A,{enableActionSheetTitle:!0,...e}),items:a}],type:xt().Oh.Vertical})})}function yo(e){const{actionStore:t,disabled:o,contentParentPointer:n,buttonPlacement:a}=e,r=(0,le().v3)(),l=(0,ce().IS)((e=>({listWrap:{background:e.contentBackground,borderRadius:5,boxShadow:e.inputBoxShadow,fontSize:14,minHeight:64,paddingBlock:3,paddingInline:10,cursor:"text",..."dark"===e.mode?{backgroundColor:e.inputBackground}:{}},emptyPlaceholder:{caretColor:e.mediumTextColor,color:e.lightTextColor,fontSize:14,padding:"5px 0",display:"inline-block"}})),[]),s=(0,se().K8)((()=>H().Bv.createChildStore(t,n)),[t,n]),c=(0,se().K8)((()=>s.getContentStore()),[s]),u=(0,re.useCallback)((()=>{(c.getValue()??[]).length>0||X().createAndCommit({userAction:"DuplicateBlocksAction.handleListClick",environment:r,canUndo:!0,perform:e=>{const t=i().insertEmptyTextInDuplicateBlockAction({environment:r,contentStore:c,transaction:e});J().hc({environment:r,store:t}),de().setSelectionAtStart({store:t.getBlockTitleStore()})}})}),[r,c]);if(!c)return null;const d="inline"===(null==a?void 0:a.type);return(0,Fe.jsx)(so().A,{store:s,analyticsName:"duplicate_blocks_action",isListContainer:!0,children:(0,Fe.jsx)(pe().s,{allowSelectionWithin:!0,children:(0,Fe.jsx)("div",{style:l.listWrap,onClick:u,className:co().CCX,children:(0,Fe.jsx)(ro().c,{displayName:"DuplicateBlocksActionContent",disabled:o,children:(0,Fe.jsx)(lo().A,{disabled:o,store:c,emptyPlaceholder:(0,Fe.jsx)("div",{style:l.emptyPlaceholder,children:d?(0,Fe.jsx)(F().sA,{id:"automations.DuplicateBlocksAction.emptyPlaceholder",defaultMessage:"Click to edit or drop blocks here…"}):(0,Fe.jsx)(F().sA,{id:"automations.DuplicateBlocksAction.emptyCannotDropPlaceholder",defaultMessage:"Click to edit blocks here…"})}),disableCommentMenu:!0,disableHoverMenu:!1,disableDrag:!1})})})})})}var fo=()=>o(80979),vo=()=>o(912720),xo=()=>o(616175);const So=(0,F().YK)({confirmationMessageLabel:{defaultMessage:"Confirmation message",id:"automations.BaseModalAction.confirmationMessageLabel"},continueButtonTextLabel:{defaultMessage:"Continue button text",id:"automations.BaseModalAction.continueButtonTextLabel"},cancelButtonTextLabel:{defaultMessage:"Cancel button text",id:"automations.BaseModalAction.cancelButtonTextLabel"}});var bo=()=>o(422540),Co=()=>o(265504);function Ao(e){const{actionStore:t,disabled:o,errorMessage:n,includeThisPage:i,onChange:a,target:r,urlBehavior:l}=e,c=(0,le().v3)(),{typecheckResult:u}=(0,be().YC)(),d=(0,se().uB)(void 0,Xe().A),[p,m]=(0,se().K8)((()=>[t.id,t.getSpaceId()]),[t]),g=(0,mt().F)({actionId:p}),h=(0,se().K8)((()=>{if(r)if("variable"===r.type){if(!u)return;const e=(0,ct().getContextValueForActionById)(u,p,r.id);if(e)return{type:"variable",contextValue:e}}else{if("page"===r.type||"url"===r.type)return r;(0,s().HB)(r)}}),[r,u,p]),y=(0,je().j)(),f=(0,re.useCallback)((e=>{"page"!==e.type&&"variable"!==e.type&&"url"!==e.type||(a(e),d.reset(),(0,at().CM)(((o,n,i)=>{const a=(0,at().zc)({automationActionStore:t,formulaAnalyticsModule:n,formulasModule:o,simpleFormulasModule:i});(0,s().O9)(a)&&(0,I().u4)({environment:c,event:{eventName:"automation_target_pick",eventProperties:{automation_action:a,automation_id:t.getParentId(),target_type:e.type}}})})))}),[a,d,t,c]),v=(0,re.useCallback)((()=>d.reset()),[d]);let x;return h?"page"===h.type?x=(0,Fe.jsx)(dt().A,{store:H().Bv.createChildStore(t,h.page),style:{paddingBlock:1}}):"variable"===h.type?x=(0,Fe.jsx)(pt().F,{value:h.contextValue,format:ut().NY.Medium,isSingle:!0,style:{background:"transparent",color:"unset",margin:"-1.5px 0",padding:0}}):"url"===h.type?x=(0,Fe.jsx)("div",{children:h.url}):(0,s().HB)(h):x="allow"===l?(0,Fe.jsx)(F().sA,{id:"automations.AutomationPagePicker.pagesDropdown.labelWithUrl",defaultMessage:"Select page, form, or URL"}):(0,Fe.jsx)(F().sA,{id:"automations.AutomationPagePicker.pagesDropdown.label",defaultMessage:"Select page"}),(0,Fe.jsx)(Ze().Ay,{buttonPopupStore:d,popupType:y,alignmentToOrigin:Ze().yP.Center,placementToOrigin:Ze().sx.Bottom,originGap:0,disabled:o,renderOrigin:e=>(0,Fe.jsx)(gt().x,{...e,disabled:o,isCompact:!0,isError:Boolean(n),hasActionRequired:!Boolean(r),tooltipMessage:n,dropdownButtonType:"dropdown",children:x}),render:e=>(0,Fe.jsx)(ht()._,{formulaTypecheckContextValues:g,includeThisPage:i,onChange:f,onClose:v,parentRecordStore:t,selectedTarget:r,skipCollections:!0,spaceId:m,urlBehavior:l})})}function ko(e){const{actionStore:t,disabled:o,errorMessage:n,onChange:i,value:a,urlBehavior:r}=e,l=(0,ce().IS)((()=>({picker:{display:"inline-flex",minWidth:50},span:{flex:0,display:"flex",alignItems:"center"},title:{display:"inline-flex",minWidth:50,gap:6}})),[]);return(0,Fe.jsxs)("div",{style:l.title,children:[(0,Fe.jsx)(F().sA,{defaultMessage:"<span>Open </span>{pagePicker}",id:"automations.OpenPageAction.action.title",values:{pagePicker:(0,Fe.jsx)("div",{style:l.picker,children:(0,Fe.jsx)(Ao,{urlBehavior:r,actionStore:t,disabled:o,errorMessage:n,onChange:i,target:a})}),span:e=>(0,Fe.jsx)("span",{style:l.span,children:e})}})," "]})}function jo(e){const{actionStore:t,disabled:o,onChange:n}=e,i=(0,ce().IS)((()=>({picker:{display:"inline-flex",minWidth:50},span:{flex:0,display:"flex",alignItems:"center"},title:{display:"inline-flex",minWidth:50,gap:6}})),[]),a=(0,se().K8)((()=>t.getOpenPageIn()),[t]);return(0,Fe.jsx)("div",{style:i.title,children:(0,Fe.jsx)(F().sA,{defaultMessage:"<span>in </span>{peekModePicker}",id:"automations.OpenPageAction.peekMode.title",values:{peekModePicker:(0,Fe.jsx)("div",{style:i.picker,children:(0,Fe.jsx)(Mo,{disabled:o,onChange:n,value:a})}),span:e=>(0,Fe.jsx)("span",{style:i.span,children:e})}})})}function Mo(e){const{disabled:t,onChange:o,value:n}=e,i=(0,ce().DP)(),a=(0,se().uB)(void 0,Xe().A),r=(0,se().K8)((()=>(0,Co().c)({currentViewType:void 0,theme:i}).find((e=>e.key===n))),[n,i]),l=(0,re.useCallback)((()=>a.reset()),[a]),s=(0,re.useCallback)((e=>{e!==(null==r?void 0:r.key)&&o(e),l()}),[l,null==r?void 0:r.key,o]),c=(0,je().j)();return r?(0,Fe.jsx)(Ze().Ay,{alignmentToOrigin:Ze().yP.Center,buttonPopupStore:a,disabled:t,originGap:0,placementToOrigin:Ze().sx.Bottom,popupType:c,renderOrigin:e=>(0,Fe.jsx)(gt().x,{...e,disabled:t,isCompact:!0,dropdownButtonType:"dropdown",children:r.title}),render:e=>(0,Fe.jsx)(To,{onChange:s,value:n})}):null}function To(e){const{onChange:t,value:o}=e,n=(0,ce().DP)(),i=(0,ce().IS)((()=>({menuItem:{paddingBlock:8}})),[]),a=(0,bt().e)({maxWidth:360,width:280}),r=(0,se().K8)((()=>(0,Co().c)({currentViewType:void 0,theme:n}).map(((e,n)=>({action:()=>t(e.key),key:n,render:t=>(0,Fe.jsx)($e().A,{...t,body:e.body,caption:e.caption,checkState:o===e.key,disabled:!1,icon:e.icon,style:i.menuItem,title:e.title})})))),[t,i.menuItem,n,o]),l=[{key:0,render:e=>(0,Fe.jsx)(St().A,{enableActionSheetTitle:!0,...e}),items:r}];return(0,Fe.jsx)(vt().A,{...a,children:(0,Fe.jsx)(xt().Ay,{initialFocus:0,sections:l,type:xt().Oh.Vertical})})}var Io=()=>o(742117),wo=()=>o(811979),Po=()=>o(946548),Bo=()=>o(574036),Ro=()=>o(125565),_o=()=>o(722872),Vo=()=>o(439616),Eo=()=>o(585293),Fo=()=>o(700250);function Do(e){const{actionStore:t,disabled:o,errorMessage:n,onTargetChange:i,value:a}=e;return(0,Fe.jsx)(F().sA,{defaultMessage:"Publish{pagePicker}",id:"automations.PublishSiteAction.header.title",values:{pagePicker:(0,Fe.jsx)(Ao,{actionStore:t,disabled:o,errorMessage:n,includeThisPage:!0,onChange:i,target:a})}})}function Lo(){const e=(0,le().Y0)(),t=(0,ce().IS)((e=>({outerContainer:{paddingTop:15,display:"flex",flexDirection:"column",gap:6},siteSettingsContainer:{borderRadius:10,border:`1px solid ${e.regularDividerColor}`,padding:2},sectionMenuItem:{padding:"6px 2px"},button:{marginLeft:0,marginRight:0,width:"100%",paddingTop:2,paddingBottom:2,background:"transparent"},itemInnerContainer:{marginLeft:0,paddingLeft:8,minWidth:"auto",background:"transparent"}})),[]),o={type:"public_permission",role:"reader",expiration_timestamp:void 0},n=[{key:"linkExpiration",render:e=>(0,Fe.jsx)(Vo().A,{...e,disabled:!1,permissionItem:o,onChange:e=>{},hideIcon:!0}),action:()=>{}},{key:"enableQna",render:o=>(0,Fe.jsx)(Bo().A,{...o,isMobile:e.isMobile,buttonStyle:t.button,textWrapperStyle:t.itemInnerContainer,title:(0,Fe.jsx)(F().sA,{defaultMessage:"Enable QnA",id:"automations.PublishSiteAction.action.siteSettingsEnableQna.title"}),on:!0,onClick:()=>{}}),action:()=>{}},{key:"enableSeo",render:o=>(0,Fe.jsx)(Bo().A,{...o,isMobile:e.isMobile,buttonStyle:t.button,textWrapperStyle:t.itemInnerContainer,title:(0,Fe.jsx)(F().sA,{defaultMessage:"Search engine indexing",id:"automations.PublishSiteAction.action.siteSettingsEnableSEO.title"}),on:!1,onClick:()=>{}}),action:()=>{}}],i=(0,r().oE)([{key:0,render:e=>(0,Fe.jsx)(St().A,{style:t.sectionMenuItem,...e}),items:n}]);return(0,Fe.jsxs)("div",{style:t.outerContainer,children:[(0,Fe.jsx)("label",{children:(0,Fe.jsx)(F().sA,{defaultMessage:"Settings",id:"automations.PublishSiteAction.action.siteSettingsTitle"})}),(0,Fe.jsx)(xt().Ay,{type:xt().Oh.Vertical,sections:i,initialFocus:void 0,resetFocusOnMouseOut:!0,style:t.siteSettingsContainer})]})}function Oo(){const e=(0,ce().IS)((e=>({outerContainer:{paddingTop:15,display:"flex",flexDirection:"column",gap:6},siteSettingsContainer:{borderRadius:10,border:`1px solid ${e.regularDividerColor}`,padding:2},sectionMenuItem:{padding:"6px 2px"},button:{marginLeft:0,marginRight:0,width:"100%",paddingTop:2,paddingBottom:2,background:"transparent"},itemInnerContainer:{marginLeft:0,paddingLeft:8,minWidth:"auto",background:"transparent"}})),[]),t=[{key:"theme",render:t=>(0,Fe.jsx)(Ko,{...t,style:e.sectionMenuItem}),action:()=>{}},{key:"header",render:t=>(0,Fe.jsx)(zo,{...t,style:e.sectionMenuItem}),action:()=>{}},{key:"googleAnalytics",render:t=>(0,Fe.jsx)(Uo,{...t,style:e.sectionMenuItem}),action:()=>{}}],o=(0,r().oE)([{key:0,render:t=>(0,Fe.jsx)(St().A,{style:e.sectionMenuItem,...t}),items:t}]);return(0,Fe.jsxs)("div",{style:e.outerContainer,children:[(0,Fe.jsx)("label",{children:(0,Fe.jsx)(F().sA,{defaultMessage:"Site customization",id:"automations.PublishSiteAction.action.siteCustomizationTitle"})}),(0,Fe.jsx)(xt().Ay,{type:xt().Oh.Vertical,sections:o,initialFocus:void 0,resetFocusOnMouseOut:!0,style:e.siteSettingsContainer})]})}const Ko=re.forwardRef(((e,t)=>{const o=(0,le().Y0)(),n=(0,ce().IS)((e=>({chevronIcon:{height:12,width:12,fill:e.icon.tertiary,transform:"rotate(90deg)"}})),[]),i=(0,re.useCallback)((e=>{}),[]),a="system";return(0,Fe.jsx)(wo().A,{...e,popupType:o.isMobile?Ze().z7.SlideUp:Ze().z7.Popup,renderOrigin:t=>(0,Fe.jsx)(Eo().a,{...(0,Ve().A)(e,t),title:(0,Fe.jsx)(F().sA,{defaultMessage:"Theme",id:"automations.PublishSiteAction.action.siteCustomization.themeTitle"}),right:(0,Fe.jsxs)(Fe.Fragment,{children:[(0,Fe.jsx)(No,{value:a}),(0,Io().V)(n.chevronIcon)]})}),alignmentToOrigin:Fo().MY.End,placementToOrigin:Fo().UV.Bottom,render:e=>(0,Fe.jsx)(Wo,{value:a,onChange:i,onClose:()=>{e.close()}})})}));function No(e){const{value:t}=e,o=(0,ce().IS)((e=>({container:{color:e.text.secondary}})),[]);return t?"system"===t?(0,Fe.jsx)(Ro().A,{style:o.container,children:(0,Fe.jsx)(F().sA,{defaultMessage:"System",id:"automations.PublishSiteAction.action.siteCustomization.themeOptions.system"})}):"light"===t?(0,Fe.jsx)(Ro().A,{style:o.container,children:(0,Fe.jsx)(F().sA,{defaultMessage:"Light",id:"automations.PublishSiteAction.action.siteCustomization.themeOptions.light"})}):"dark"===t?(0,Fe.jsx)(Ro().A,{style:o.container,children:(0,Fe.jsx)(F().sA,{defaultMessage:"Dark",id:"automations.PublishSiteAction.action.siteCustomization.themeOptions.dark"})}):void(0,s().HB)(t):null}function Wo(e){const{value:t,onChange:o,onClose:n}=e,i=(0,le().Y0)(),a=(0,re.useCallback)((e=>{void 0!==e&&e!==t&&o(e),n()}),[t,o,n]),r=["system","light","dark"].map((e=>({key:e,render:t=>(0,Fe.jsx)($e().A,{...t,title:(0,Fe.jsx)(No,{value:e})}),action:()=>{a(e)}}))),l=[{key:0,render:e=>(0,Fe.jsx)(St().A,{...e}),items:r}];return(0,Fe.jsx)(vt().A,{menuType:i.isMobile?_o().gu.ActionSheet:_o().gu.Popup,width:240,children:(0,Fe.jsx)(xt().Ay,{type:xt().Oh.Vertical,initialFocus:r.findIndex((e=>e.key===t)),sections:l})})}Ko.displayName="ThemeCustomizationItem";const zo=re.forwardRef(((e,t)=>{const o=(0,le().Y0)(),n=(0,ce().IS)((e=>({chevronIcon:{height:12,width:12,fill:e.icon.tertiary,transform:"rotate(90deg)"}})),[]),i=(0,re.useCallback)((e=>{}),[]),a={};return(0,Fe.jsx)(wo().A,{...e,popupType:o.isMobile?Ze().z7.SlideUp:Ze().z7.Popup,renderOrigin:t=>(0,Fe.jsx)(Eo().a,{...(0,Ve().A)(e,t),title:(0,Fe.jsx)(F().sA,{defaultMessage:"Header",id:"automations.PublishSiteAction.action.siteCustomization.headerTitle"}),right:(0,Fe.jsxs)(Fe.Fragment,{children:[(0,Fe.jsx)(F().sA,{defaultMessage:"Default",id:"automations.PublishSiteAction.action.siteCustomization.headerDefaultValue"}),(0,Io().V)(n.chevronIcon)]})}),alignmentToOrigin:Fo().MY.End,placementToOrigin:Fo().UV.Bottom,render:e=>(0,Fe.jsx)(Ho,{value:a,onChange:i,onClose:()=>{e.close()}})})}));function Ho(e){const{value:t}=e,o=(0,le().Y0)(),n=[{key:"breadcrumbs",render:e=>(0,Fe.jsx)(Eo().a,{...e,title:(0,Fe.jsx)(F().sA,{defaultMessage:"Breadcrumbs",id:"automations.PublishSiteAction.action.siteCustomization.headerOptionBreadcrumb"}),right:(0,Fe.jsx)(Po().A,{...e,on:!(null!=t&&t.hideBreadcrumbs)})}),action:()=>{}},{key:"search",render:e=>(0,Fe.jsx)(Eo().a,{...e,title:(0,Fe.jsx)(F().sA,{defaultMessage:"Search",id:"automations.PublishSiteAction.action.siteCustomization.headerOptionSearch"}),right:(0,Fe.jsx)(Po().A,{...e,on:!(null!=t&&t.hideSearch)})}),action:()=>{}},{key:"watermark",render:e=>(0,Fe.jsx)(Eo().a,{...e,disabled:!0,title:(0,Fe.jsx)(F().sA,{defaultMessage:"Watermark",id:"automations.PublishSiteAction.action.siteCustomization.headerOptionWatermark"}),right:(0,Fe.jsx)(Po().A,{...e,disabled:!0,on:!(null!=t&&t.hideWatermark)})}),action:()=>{}}],i=[{key:0,render:e=>(0,Fe.jsx)(St().A,{...e}),items:n}];return(0,Fe.jsx)(vt().A,{menuType:o.isMobile?_o().gu.ActionSheet:_o().gu.Popup,width:240,children:(0,Fe.jsx)(xt().Ay,{type:xt().Oh.Vertical,initialFocus:n.findIndex((e=>e.key===t)),sections:i})})}zo.displayName="HeaderCustomizationItem";const Uo=re.forwardRef(((e,t)=>{const o=(0,re.useRef)(null);return(0,Fe.jsx)(Eo().a,{...e,title:(0,Fe.jsx)(F().sA,{defaultMessage:"Google Analytics",id:"automations.PublishSiteAction.action.siteCustomization.googleAnalyticsTitle"}),right:(0,Fe.jsx)(Yo,{ref:o,value:undefined}),onClick:()=>{var e;return null===(e=o.current)||void 0===e?void 0:e.focus()}})}));Uo.displayName="GoogleAnalyticsCustomizationSetting";const Yo=re.forwardRef(((e,t)=>{const{value:o}=e,[n,i]=(0,re.useState)(!1),a=!1,r=(0,ce().IS)((e=>({inputContainer:{background:e.surface.page,borderRadius:4,boxShadow:n?"0px 0px 0px 1px #2383E2 inset, 0px 0px 0px 2px rgba(35, 131, 226, 0.35)":`${e.regularDividerColor} 0px 0px 0px 1px inset`,height:28,padding:8,fontWeight:ue().Wy.regular,fontSize:14,lineHeight:1.3,color:e.text.secondary},input:{marginLeft:-6,paddingLeft:0,color:e.text.primary},wrapper:{paddingTop:4,paddingBottom:4}})),[a,n]);return(0,Fe.jsx)("div",{style:r.wrapper,children:(0,Fe.jsx)(me().A,{ref:t,type:"text",style:r.inputContainer,inputStyle:r.input,value:o,onChange:e=>{},format:me().C.Transparent,onFocus:()=>i(!0),onBlur:()=>i(!1),left:"G-",disabled:a})})}));Yo.displayName="GoogleAnalyticsInput";o(430670);var Go=()=>o(79118),qo=()=>o(617871),$o=()=>o(315564),Zo=()=>o(704152),Qo=()=>o(554509),Jo=()=>o(898125),Xo=()=>o(53137),en=()=>o(5269);function tn(e){const t=(0,le().v3)();(0,se().K8)((()=>{(0,h().Fbh)(e).forEach((e=>{new(H().LU)(t,{table:b().oo,id:e},{userId:e}).isDefined()}))}),[t,e])}var on=()=>o(905209),nn=()=>o(50401),an=()=>o(999638),rn=(o(908872),()=>o(970013)),ln=()=>o(842599),sn=()=>o(467730),cn=()=>o(187174),un=()=>o(931121),dn=()=>o(453697),pn=()=>o(742971),mn=()=>o(856952),gn=()=>o(106628),hn=()=>o(361330),yn=()=>o(970585),fn=()=>o(576241),vn=()=>o(674300),xn=()=>o(644484),Sn=()=>o(848401);function bn(e){let{handleRemoveToken:t,token:o,format:n,style:i,addQuotes:a,renderAvatar:r,isDisabled:l}=e;const s=(0,ce().DP)();if(!(0,ln().DT)(o))return null;const c=a?`“${o}”`:o;return(0,Fe.jsx)(Sn().Ay,{title:c,format:n??ut().NY.Small,renderAvatar:r||(e=>(0,xn().g)({width:e,height:e,padding:2,marginRight:6})),showRemoveButton:Boolean(t)&&!l,onClickRemove:e=>{null==e||e.stopPropagation(),t&&t(o)},style:{background:s.accentColors.gray[75],...i},shouldShrink:!0,isSingle:!1})}var Cn=()=>o(436876);const An=["gmail.com","yahoo.com","outlook.com"],kn=["com","net","org"];var jn=()=>o(64e3),Mn=()=>o(45552),Tn=()=>o(320865),In=()=>o(996027),wn=()=>o(231713),Pn=()=>o(629203);function Bn(e){let{email:t,disabled:o,menuArgs:n}=e;const i=(0,Pn().U)();return(0,Fe.jsx)($e().A,{...n,title:(0,Fe.jsx)(bn,{token:t,format:ut().NY.Inline,addQuotes:!0,style:{background:void 0,padding:void 0}}),disabled:o,style:o?i.disabledMenuItem:void 0,isTokenTitle:!0})}function Rn(e){let{token:t,disabled:o,menuArgs:n,type:i}=e;const a=(0,Pn().U)(),r=(0,ce().DP)();return(0,Fe.jsx)($e().A,{...n,title:(0,Fe.jsx)(Cn().A,{token:t,type:i,format:ut().NY.Inline,style:{color:r.darkTextColor,background:void 0,padding:void 0}}),disabled:o,style:{...o?a.disabledMenuItem:void 0},isTokenTitle:!0})}var _n=()=>o(764880),Vn=()=>o(448693);function En(e){let{annotation:t,disabled:o,getRecordModel:n,menuArgs:i}=e;const a=(0,Pn().U)(),r=(0,se().K8)((()=>{if((0,Vt().isAnnotationSimpleValueToken)(t)&&(0,h().rie)(t)){const e=(0,h().NcG)(t);return e?(0,_n().xC)({pointer:{table:b().oo,id:e},getRecordModel:n,getRecordValue:void 0}):void 0}}),[t,n]);return null!=r&&r.asActor&&r.table===b().oo?(0,Fe.jsx)($e().A,{...i,title:(0,Fe.jsx)(Fn,{actor:r}),disabled:o,style:o?a.disabledMenuItem:void 0,isTokenTitle:!0}):null}function Fn(e){let{actor:t}=e;const o=(0,ce().IS)((e=>({root:{margin:"4px 0"},actor:{margin:"0 10px 0 0"},email:{color:e.actionMenuButtonTextColor,margin:"0 0 0 26px"}})),[]),n=(0,se().K8)((()=>t.getName()),[t]),i=(0,se().K8)((()=>t.getEmail()),[t]);return(0,Fe.jsxs)("div",{style:o.root,children:[(0,Fe.jsx)(Vn().Ay,{actor:t,format:ut().NY.Medium,shouldShrink:!0,isSingle:!1,style:o.actor},t.id),n&&(0,Fe.jsx)(Sn().Ay,{title:i,format:ut().NY.ExtraSmall,isSingle:!1,style:o.email})]})}function Dn(e){const{action:t,currentSimpleFormulaValueTokens:o,formulaTypecheckContextValues:n,formulaValueContext:i,getRecordModel:a,isDisabled:l,limit:s,menuProps:c,onChange:u,onClose:d,onFormulaButtonClick:p,showFormulaValueItems:m=!1,value:y,pageProperties:f,parentRecordStore:v,showInputErrorStyles:x}=e,S=(0,le().Y0)(),b=(0,ce().DP)(),{errorMessage:C,isLoading:A,menuListStore:k,noResultsMessage:j,searchInput:M,userItems:T,valueItems:I,pagePropertyItems:w,emailItems:P}=function(e){var t,o,n;const{action:i,formulaTypecheckContextValues:a,formulaValueContext:l,isDisabled:s=!1,limit:c,onChange:u,onClose:d,onFormulaButtonClick:p,unlimitedCurrentSimpleFormulaValueTokens:m,value:y,pageProperties:f,parentRecordStore:v,showInputErrorStyles:x}=e,S=(0,le().v3)(),b=(0,F().tz)(),{collectionStore:C,property:A}="collection"===l.type?l:{collectionStore:void 0,property:void 0},k=v.getRecordModel,j=(0,Ft().pg)(l),M=j(m,"first"),T=a.filter((e=>(0,eo().o5)(e.type,{type:"person"}))),I=(0,ce().IS)((e=>({personToken:{background:e.accentColors.gray[75],borderRadius:"6px"},formulaValueToken:{background:e.buttonBackground},searchInput:{maxHeight:6*parseInt(mn().sA,10),width:"100%",margin:0,minHeight:32,background:e.accentColors.gray[30],...x&&{border:`1px solid ${e.text.uiRedPrimary}`,boxShadow:"none"}},clearButton:{height:20},clearButtonIcon:{height:15,width:15,fill:e.lightIconColor},actionButtonGroup:{alignSelf:"end",cursor:"unset",justifyContent:"end"}})),[x]),[w,P]=(0,re.useState)(""),B=(0,re.useRef)(null),R=(0,re.useRef)(""),_=(0,se().uB)(void 0,yn().A),V=(0,se().K8)((()=>(null==C?void 0:C.getSchema())??{}),[C]),E=(0,se().K8)((()=>{if(V&&A){const e=V[A];if(e&&(0,rn().sO)(e))return 1===e.limit}return!1}),[V,A]),[D]=(0,cn().Yb)((async()=>{const e=w?(0,sn().Ay)(w,T,(e=>e.kind===g().FormulaContextValueKind.ContextValue?e.name:"")):T,t=w?(0,sn().Ay)(w,f,(e=>(0,h().GCe)(e).name??"")):f,o=await gn().T.searchActions.load(),n=await o.searchVisibleSpaceUsers({environment:S,query:w,membersOnly:!1}),i=(0,Vt().fromSimpleFormulaArrayValue)(null==y?void 0:y.value).reduce(((e,t)=>(t&&(0,Vt().isAnnotationSimpleValueToken)(t)&&(0,h().rie)(t)&&e.push(t[1]),e)),[]);let a=0,r=n[a];const l=[];for(;r&&l.length<20;)i.includes(r.id)||l.push(r.id),a+=1,r=n[a];return{valueResults:e,userResults:l,pagePropertyResults:t}}),[S,w,T,null==y?void 0:y.value,f],{debounce:hn().tu}),L=(0,re.useCallback)((()=>{var e;P(""),null===(e=B.current)||void 0===e||e.focus(),_.setState({..._.state,focus:{section:0,indexLocal:0,indexGlobal:0,footerFocused:!1}})}),[_]),O=(0,re.useCallback)(((e,t)=>{u(e||y,t||i)}),[i,u,y]),K=(0,re.useCallback)((e=>{const t=j(e,"last");O({type:"simple",value:(0,Vt().toSimpleFormulaArrayValue)(t)}),L()}),[j,O,L]),N=(0,re.useCallback)((()=>{K(M.slice(0,M.length-1))}),[M,K]),W=(0,re.useCallback)((e=>{null==K||K((0,Vt().simpleFormulaValueWithoutToken)(M,e))}),[M,K]),z=Boolean(c&&M.length>=c),H=r().oE(M.map(((e,t)=>{if("boolean"==typeof e)return null;if("string"==typeof e)return(0,Fe.jsx)(bn,{handleRemoveToken:W,token:e,isDisabled:s,renderAvatar:t=>(0,dn().A)({avatar:{email:e},style:{marginRight:4}}),style:I.personToken},t);if((0,h().rie)(e))return(0,Fe.jsx)(fn().A,{handleRemoveToken:W,token:e,isDisabled:s,style:I.personToken,preventOnClickPropagation:!0},t);if((0,h().s1Y)(e))return(0,Fe.jsx)(vn().A,{formulaTypecheckContextValues:a,handleRemoveToken:W,isDisabled:s,style:I.formulaValueToken,token:e,preventOnClickPropagation:!0},t);if((0,h().iz3)(e)){var o;const n=(0,h().GCe)(e);return(0,Fe.jsx)(Cn().A,{type:null===(o=V[n.property])||void 0===o?void 0:o.type,isDisabled:s,handleRemoveToken:W,token:e},t)}return null}))),Y=new Set(r().oE(M.map((e=>(0,Vt().isAnnotationSimpleValueToken)(e)&&(0,h().s1Y)(e)&&(0,h().iVq)(e).id)))),G=new Set(r().oE(M.map((e=>(0,Vt().isAnnotationSimpleValueToken)(e)&&(0,h().rie)(e)&&(0,h().NcG)(e))))),q=r().oE(((null===(t=D.value)||void 0===t?void 0:t.valueResults)||[]).map((e=>{const t=e.kind===g().FormulaContextValueKind.ContextValue&&e.id||"";if(!t||!Y.has(t))return{action:"append",currentSimpleFormulaValueTokens:M,isDisabled:s||z,id:t,getRecordModel:k,setCurrentTokens:K,value:e}}))),$=r().oE(((null===(o=D.value)||void 0===o?void 0:o.userResults)||[]).map((e=>{const t=G.has(e);if(t)return;const o=(0,h().P4h)(e);return{action:()=>{t?W(o):K([...M,o]),E&&U().default.afterNextFlush((()=>{d()}))},annotation:o,getRecordModel:k,id:e,isDisabled:s||z,userId:e,isSelected:t}}))),Z=new Set(M.filter((e=>(0,Vt().isAnnotationSimpleValueToken)(e)&&(0,h().iz3)(e))).map((e=>(0,h().GCe)(e).property))),Q=r().oE(null===(n=D.value)||void 0===n?void 0:n.pagePropertyResults.map((e=>{var t;const o=(0,h().GCe)(e);if(!Z.has(o.property))return{id:o.property,type:null===(t=V[o.property])||void 0===t?void 0:t.type,isDisabled:s||z,action:()=>{K([...M,e])},propertyAnnotation:e}}))),J=(0,re.useCallback)((e=>{(0,ln().DT)(e)&&K([...M,e])}),[M,K]),X=(0,re.useCallback)((()=>{J(R.current)}),[J]);(0,re.useEffect)((()=>{R.current=w}),[w]),(0,re.useEffect)((()=>{const e=B.current;return e&&e.addEventListener("blur",X),()=>{e&&e.removeEventListener("blur",X)}}),[X]);const ee=(0,ln().DT)(w)?[w]:[];if(0===ee.length){const[e,t]=w.split("@");if(t){const[o,n]=t.split(".");(!n||n.length<=1)&&ee.push(...kn.map((t=>`${e}@${o}.${t}`)).filter(ln().DT))}else ee.push(...An.map((t=>`${e}@${t}`)).filter(ln().DT))}const te=ee.map((e=>({action:()=>J(e),isDisabled:s||z,email:e}))),oe=[...q,...$,...Q,...te],ne=(0,it().X)("gmail_action_formula_recipients");return{errorMessage:D.error&&b.formatMessage(pn().D.somethingWentWrong),header:b.formatMessage(pn().D.genericMenuHeader),isLoading:!D.value&&!D.error,menuListStore:_,noResultsMessage:0===oe.length&&D.value&&b.formatMessage(pn().D.noResults),searchInput:e=>(0,Fe.jsx)(mn().Ay,{ref:B,style:I.searchInput,right:(0,Fe.jsxs)(Tt().Y1,{direction:"horizontal",style:I.actionButtonGroup,children:[ne&&p&&(0,Fe.jsx)(nn().F,{disabled:s,onClick:e=>{e.stopPropagation(),p(e)},value:y}),(0,Fe.jsx)(Be().A,{ariaLabel:b.formatMessage({id:"automations.emailRecipients.clear",defaultMessage:"Clear"}),disabled:s,disabledFeedback:s,onClick:e=>{e.stopPropagation(),K([])},style:I.clearButton,icon:un().J,iconStyle:I.clearButtonIcon})]}),disabled:s||z,format:mn().le.FilterValue,onChange:e=>P(e.target.value),onRemoveLastToken:N,placeholder:"",onClick:e,tokens:H,value:w}),userItems:$,valueItems:q,pagePropertyItems:Q,emailItems:te}}({action:t,formulaTypecheckContextValues:n,formulaValueContext:i,isDisabled:l,limit:s,onChange:u,onClose:d,onFormulaButtonClick:p,unlimitedCurrentSimpleFormulaValueTokens:o,value:y,pageProperties:f,parentRecordStore:v,showInputErrorStyles:x})||{},B=(0,re.useMemo)((()=>I&&m?I.map((e=>{const{annotation:t,itemAction:o}=(0,wn().E)({action:e.action,currentSimpleFormulaValueTokens:e.currentSimpleFormulaValueTokens,setCurrentTokens:e.setCurrentTokens,value:e.value});return{key:e.id,render:o=>(0,Fe.jsx)(In().A,{annotation:t,disabled:e.isDisabled,formulaTypecheckContextValues:n,menuArgs:o,style:{background:void 0,color:b.darkTextColor,padding:void 0},parentRecordStore:v}),action:o}})):[]),[I,m,n,b,v]),R=(0,re.useMemo)((()=>T?T.map((e=>({key:e.userId,render:t=>(0,Fe.jsx)(En,{annotation:e.annotation,disabled:e.isDisabled,menuArgs:t,getRecordModel:a||e.getRecordModel}),action:e.action}))):[]),[a,T]),_=[...B,...(0,re.useMemo)((()=>w?w.map((e=>({key:e.id,render:t=>(0,Fe.jsx)(Rn,{disabled:e.isDisabled,menuArgs:t,type:e.type,token:e.propertyAnnotation}),action:e.action}))):[]),[w])],V=[];_.length>0&&V.push({key:"properties",render:e=>(0,Fe.jsx)(St().A,{...e,title:"Property",topBorder:!1}),items:_}),R.length>0&&V.push({key:"users",render:e=>(0,Fe.jsx)(St().A,{...e,title:"Person",topBorder:_.length>0}),items:R});const E=(0,re.useMemo)((()=>P?P.map((e=>({key:e.email,action:e.action,render:t=>(0,Fe.jsx)(Bn,{email:e.email,disabled:e.isDisabled,menuArgs:t})}))):[]),[P]);let D;E.length>0&&V.push({key:"emails",render:e=>(0,Fe.jsx)(St().A,{...e,title:"Email",topBorder:_.length>0||R.length>0}),items:E}),D=S.isMobile?{menuType:_o().gu.Modal,right:(0,Fe.jsx)(Mn().DoneMenuText,{}),minWidth:"100%"}:{menuType:_o().gu.Popup,maxHeight:"50vh",minWidth:"100%",disableHeaderBorder:!0};const L={width:"260px"},O=(0,Fe.jsxs)(Fe.Fragment,{children:[C&&(0,Fe.jsx)(St().A,{style:L,children:(0,Fe.jsx)(jn().A,{title:C})}),j&&(0,Fe.jsx)(St().A,{style:L,children:(0,Fe.jsx)(jn().A,{title:j})}),A&&(0,Fe.jsx)(St().A,{style:L,children:(0,Fe.jsx)(Tn().A,{})}),V.length>0&&(0,Fe.jsx)(xt().Ay,{type:xt().Oh.Vertical,initialFocus:0,sections:V,store:k,style:L})]});return{searchInput:M,innerComponents:O,emailRecipientsMenu:(0,Fe.jsx)(vt().A,{...D,...c,children:O})}}function Ln(e){const{currentValue:t,onChange:o,parentRecordStore:n,spaceId:i,formulaTypecheckContextValues:a,disabled:r}=e;return"formula"===(null==t?void 0:t.type)?(0,Fe.jsx)(Nn,{parentRecordStore:n,spaceId:i,value:t,formulaTypecheckContextValues:a,isDisabled:r,onChange:o}):(0,Fe.jsx)(On,{...e})}function On(e){const{currentValue:t,collectionStore:o,onChange:n,formulaTypecheckContextValues:i,limit:a,pageProperties:r,disabled:l,parentRecordStore:c,errorMessage:u}=e,d=o?{type:"collection",collectionStore:o,property:"person"}:{type:"empty"},p={menuType:_o().gu.Popup},m=(0,se().K8)((()=>(0,Vt().fromSimpleFormulaArrayValue)(null==t?void 0:t.value)),[t]),{searchInput:g,emailRecipientsMenu:h}=Dn({currentSimpleFormulaValueTokens:m,formulaTypecheckContextValues:i,formulaValueContext:d,limit:a,menuProps:p,onChange:n,onClose:window.parent.close,onFormulaButtonClick:e=>{e.stopPropagation(),n({type:"formula",value:null==t?void 0:t.value})},showFormulaValueItems:!0,showGenericHeader:!0,value:t,pageProperties:r,isDisabled:l,parentRecordStore:c,showInputErrorStyles:(0,s().O9)(u)});return(0,Fe.jsx)(Ze().Ay,{renderOrigin:e=>{let{onClick:t}=e;return null==g?void 0:g(t)},popupType:Ze().z7.Popup,render:()=>h})}const Kn=[{type:"person"},{type:"text"},{type:"array",of:{type:"person"}},{type:"array",of:{type:"text"}}];function Nn(e){const{formulaTypecheckContextValues:t,parentRecordStore:o,spaceId:n,value:i,onChange:a,isDisabled:r}=e,l=(0,ce().IS)((e=>({containerWrap:{width:"100%"},formulaText:{whiteSpace:"pre-wrap",cursor:"pointer"},scroller:{flexGrow:1,width:"100%"},textWrap:{cursor:"text",display:"flex",flexWrap:"wrap",justifyContent:"end",width:"100%"},wrap:{background:e.inputBackground,boxShadow:e.inputBoxShadow,boxSizing:"border-box",cursor:"text",padding:"4px 8px"},actionButtonGroup:{alignSelf:"end",cursor:"unset",justifyContent:"end"}})),[]),s=async e=>{e.stopPropagation();await(0,Ft().Cp)()&&(null==a||a({type:"simple",value:null==i?void 0:i.value}))},c=(0,se().uB)(void 0,Xe().A),u=(0,re.useCallback)((()=>c.setState({open:!1})),[c]);return(0,Fe.jsx)(Ze().Ay,{buttonPopupStore:c,renderOrigin:e=>(0,Fe.jsx)("div",{...e,style:l.containerWrap,children:(0,Fe.jsx)(Tt().Y1,{align:"center",className:co().CCX,direction:"vertical",gap:4,style:l.wrap,children:(0,Fe.jsxs)("div",{style:l.textWrap,children:[(0,Fe.jsx)(ye().H,{style:l.scroller,type:xe().A.Y,children:(0,Fe.jsx)("div",{style:l.formulaText,children:(0,Fe.jsx)(on().$,{formulaTypecheckContextValues:t,parentRecordStore:o,spaceId:n,value:i})})}),(0,Fe.jsx)("div",{children:(0,Fe.jsx)(Tt().Y1,{direction:"horizontal",gap:2,style:l.actionButtonGroup,children:(0,Fe.jsx)(nn().F,{disabled:r,onClick:s,value:i})})})]})})}),popupType:Ze().z7.Popup,render:()=>(0,Fe.jsx)(an().A,{allowedReturnTypes:Kn,disabled:r,formulaTypecheckContextValues:t??[],onChange:a,onClose:u,parentRecordStore:o,value:i,spaceId:n})})}var Wn=()=>o(148307),zn=()=>o(701545),Hn=()=>o(654777),Un=()=>o(510683),Yn=()=>o(633457),Gn=()=>o(678553),qn=()=>o(47373);const $n=(0,F().YK)({gmailAccountMenuPickerHeader:{defaultMessage:"Select Account",id:"automations.gmailAccountPicker.menuHeader"},gmailAccountMenuPickerHeaderInvalidAccount:{defaultMessage:"Invalid Account",id:"automations.gmailAccountPicker.menuHeaderInvalidAccount"},gmailAccountMenuPickerHeaderInvalidAccountTooltip:{defaultMessage:"Connect a valid account or delete this step",id:"automations.gmailAccountPicker.menuHeaderInvalidAccountTooltip"},addGmailAccountLabel:{id:"automations.gmailAccountPicker.setupAnotherGmailAccount.label",defaultMessage:"Add Gmail Account"},manageAccountInfoCaption:{id:"automations.gmailAccountPicker.manageAccountInfo.caption",defaultMessage:"Manage connected accounts in the “My Connections” tab of Settings"},connectGmailAccountMobileLabel:{id:"automations.gmailAccountPicker.connectGmailAccountMobile.label",defaultMessage:"Connect Gmail Account"},connectGmailAccountMobileCaption:{id:"automations.gmailAccountPicker.connectGmailAccountMobile.caption",defaultMessage:"Open desktop or web app to connect"},connectGmailAccountLabel:{id:"automations.gmailAccountPicker.connectGmailAccount.label",defaultMessage:"Connect Gmail Account"},connectGmailAccountCaption:{id:"automations.gmailAccountPicker.connectGmailAccount.caption",defaultMessage:"Allow Notion to send email on your behalf"}});function Zn(e){const{currentGmailAuthentication:t,gmailAuthentications:o,disabled:n,errorMessage:i,onAccountChange:a}=e,r=(0,le().v3)(),l=(0,le().Y0)(),s=(0,se().K8)((()=>{var e;return null===(e=te().default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),c="collection_view_settings",u=(0,se().K8)((()=>Xo().A.integrations.state.find((e=>e.id===qo().eg))),[]),d=Boolean(i),p=(0,se().uB)(void 0,Xe().A),m=(0,re.useCallback)((e=>{a(e),(0,I().u4)({environment:r,event:{eventName:"gmail_action_account_click",eventProperties:{}}}),p.reset()}),[a,p,r]),g=(0,je().j)(),h=(0,bt().e)(),y=(0,ce().IS)((e=>({infoItem:{color:e.text.secondary,cursor:"default"},connectAccount:{paddingRight:"32px"},externalLinkIcon:{color:e.icon.tertiary,width:18,height:"auto"},plusMediumIcon:{width:16,height:"auto",marginRight:8,marginLeft:1},manageAccountCaption:{color:e.text.tertiary},errorText:{color:e.errorText}})),[]);if(!u)return null;const f=[{items:o.map(((e,o)=>({action:()=>null,key:e.id,render:()=>{const o=(null==t?void 0:t.id)===e.id;return(0,Fe.jsx)($e().A,{focused:(null==t?void 0:t.id)===e.id,onClick:async()=>{if(s)if(o&&d){const e=await Qn(r,u,s,c);if("success"!==e.status)return void p.reset();m(e.externalAuthentication.id)}else m(e.id)},title:e.account_name,left:(0,Fe.jsx)(dn().A,{avatar:{email:e.account_name},style:{marginRight:8}}),right:d?(0,Zt().Q)({width:12,height:"auto",marginLeft:12}):(0,zn().p)({width:18,height:"auto",marginLeft:12}),rightStyle:{visibility:o?"visible":"hidden"},style:{...o&&d&&y.errorText},bodyStyle:{minWidth:"280px"}},e.id)}}))),key:"gmailAccounts",render:e=>(0,Fe.jsx)(St().A,{topBorder:!0,...e,enableActionSheetTitle:!0})}];f.push({key:"add-another-gmail-account-section",items:[{key:"add-another-gmail-account-item",action:async()=>{if(!s)return;const e=await Qn(r,u,s,c);"success"===e.status&&(a(e.externalAuthentication.id),p.reset())},render:e=>(0,Fe.jsx)($e().A,{...e,left:(0,Ge().b)(y.plusMediumIcon),right:(0,Hn().X)(y.externalLinkIcon),title:(0,Fe.jsx)(F().sA,{...$n.addGmailAccountLabel}),bodyStyle:{marginLeft:1}})}],render:e=>(0,Fe.jsx)(St().A,{...e,topBorder:!0})}),f.push({key:"manage-account-info-section",items:[{key:"manage-account-info-item",action:()=>null,render:e=>(0,Fe.jsx)($e().A,{...e,style:y.infoItem,focused:!1,caption:(0,Fe.jsx)(Gn().C,{caption:(0,Fe.jsx)(F().sA,{...$n.manageAccountInfoCaption}),shouldWrapCaption:!0,captionStyle:y.manageAccountCaption})})}],render:e=>(0,Fe.jsx)(St().A,{...e,topBorder:!0})});const v={key:"connect-gmail-account-mobile-item",action:()=>null,render:e=>(0,Fe.jsx)($e().A,{...e,icon:(0,Fe.jsx)("img",{src:Wn().A.images.externalIntegrations.gmailIconPng,style:{width:18,height:"auto"}}),focused:!1,disabled:!0,buttonStyle:y.connectAccount,title:(0,Fe.jsx)(F().sA,{...$n.connectGmailAccountMobileLabel}),caption:(0,Fe.jsx)(Gn().C,{caption:(0,Fe.jsx)(F().sA,{...$n.connectGmailAccountMobileCaption}),shouldWrapCaption:!0})})},x={key:"connect-gmail-account-item",action:async()=>{if(p.reset(),!s)return;const e=await Qn(r,u,s,c);"success"===e.status&&a(e.externalAuthentication.id)},render:e=>(0,Fe.jsx)($e().A,{...e,icon:(0,Fe.jsx)("img",{src:Wn().A.images.externalIntegrations.gmailIconPng,style:{width:18,height:"auto"}}),focused:!1,buttonStyle:y.connectAccount,title:(0,Fe.jsx)(F().sA,{...$n.connectGmailAccountLabel}),caption:(0,Fe.jsx)(Gn().C,{caption:(0,Fe.jsx)(F().sA,{...$n.connectGmailAccountCaption}),shouldWrapCaption:!0})})},S=[{key:"connectGmailAccount",items:[l.isMobile?v:x],render:e=>(0,Fe.jsx)(St().A,{topBorder:!0,...e,enableActionSheetTitle:!0})}];return(0,Fe.jsx)(Ze().Ay,{buttonPopupStore:p,popupType:g,alignmentToOrigin:Ze().yP.End,placementToOrigin:Ze().sx.Bottom,originGap:0,disabled:n,renderOrigin:e=>(0,Fe.jsx)(gt().x,{...e,disabled:n,isCompact:!0,isError:d,hasActionRequired:!Boolean(t),dropdownButtonType:"dropdown",children:t?(0,Fe.jsx)(_e().A,{renderTooltip:()=>i,disableTooltip:!d,render:e=>(0,Fe.jsx)("span",{...e,children:null==t?void 0:t.account_name})}):(0,Fe.jsx)(_e().A,{renderTooltip:()=>(0,Fe.jsx)(F().sA,{...$n.gmailAccountMenuPickerHeaderInvalidAccountTooltip}),disableTooltip:!d,render:e=>(0,Fe.jsx)("span",{...e,children:(0,Fe.jsx)(F().sA,{...d?$n.gmailAccountMenuPickerHeaderInvalidAccount:$n.gmailAccountMenuPickerHeader})})})}),render:e=>(0,Fe.jsx)(vt().A,{...h,children:(0,Fe.jsx)(xt().Ay,{type:xt().Oh.Vertical,sections:0===o.length?S:f,initialFocus:0})})})}async function Qn(e,t,o,n){const i=await Un().Jq({environment:e,integration:t,spaceId:o,from:n,preventRedirectToLastVisitedPage:(0,qn().dC)()});return l().Q.isFail(i)?{status:"failure"}:i.value.externalAuthentication?{externalAuthentication:i.value.externalAuthentication,status:"success"}:(await Yn().oX({environment:e}),{status:"re-auth"})}const Jn=(0,F().YK)({toLabel:{defaultMessage:"To",id:"automations.SendGmailNotificationAction.toLabel"},ccLabel:{defaultMessage:"CC",id:"automations.SendGmailNotificationAction.ccLabel"},bccLabel:{defaultMessage:"BCC",id:"automations.SendGmailNotificationAction.bccLabel"},replyToLabel:{defaultMessage:"Send replies to",id:"automations.SendGmailNotificationAction.replyToLabel"},fromNameLabel:{defaultMessage:"Send with display name",id:"automations.SendGmailNotificationAction.fromNameLabel"},subjectLabel:{defaultMessage:"Subject",id:"automations.SendGmailNotificationAction.subjectLabel"},bodyLabel:{defaultMessage:"Message",id:"automations.SendGmailNotificationAction.bodyLabel"},gmailAccountPickerHidden:{defaultMessage:"Hidden",id:"automations.SendGmailNotificationAction.gmailAccountPickerHidden"}}),Xn=["subject","body","fromName"],ei={cc:!1,bcc:!1,replyTo:!1,displayName:!1},ti={displayName:!1,replyTo:!1},oi={cc:Jn.ccLabel.defaultMessage,bcc:Jn.bccLabel.defaultMessage,replyTo:Jn.replyToLabel.defaultMessage,displayName:Jn.fromNameLabel.defaultMessage};function ni(e){var t,o,n,i,l,c,u,d,p,m,y,f,v,x,S;const C=(0,F().tz)(),{actionStore:A,currentGmailAuthentication:k,gmailAuthentications:j}=e,{automationStore:M,contextType:I}=(0,be().EC)(),{disabled:P,maybePersistedTransactionActions:B,suppressActionErrors:R}=(0,We().b)(),_=(0,en().y)(M,I),V=(0,se().K8)((()=>Boolean(P)),[P]),E=(0,a().getActionRegistryItem)("send_gmail_notification"),D=(0,se().K8)((()=>A.getSpaceId()),[A]),L=(0,se().K8)((()=>{var e,t,o,n;return{to:null==A||null===(e=A.getConfig())||void 0===e?void 0:e.to,cc:null==A||null===(t=A.getConfig())||void 0===t?void 0:t.cc,bcc:null==A||null===(o=A.getConfig())||void 0===o?void 0:o.bcc,reply_to:null==A||null===(n=A.getConfig())||void 0===n?void 0:n.reply_to}}),[A]),[O,K]=(0,re.useState)(ei),[N,W]=(0,re.useState)(ti),z=(0,le().v3)();tn(Object.values(L).flatMap((e=>{var t;return(null==e||null===(t=e.value)||void 0===t?void 0:t.value)||[]})));const{actionId:U,currentFromName:Y,currentSubject:G,currentBody:q,externalBotId:$}=(0,se().K8)((()=>{var e,t,o;return{currentFromName:null===(e=A.getConfig())||void 0===e?void 0:e.from_name,currentSubject:null===(t=A.getConfig())||void 0===t?void 0:t.email_subject,currentBody:null===(o=A.getConfig())||void 0===o?void 0:o.email_body,actionId:A.id,externalBotId:A.getConfigStore().getKeyStore("external_bot_id").getValue()}}),[A]);(0,Nt().l)((()=>{K((e=>{var t,o,n;return{...e,cc:Boolean(null==L||null===(t=L.cc)||void 0===t||null===(t=t.value)||void 0===t?void 0:t.value),bcc:Boolean(null==L||null===(o=L.bcc)||void 0===o||null===(o=o.value)||void 0===o?void 0:o.value),replyTo:Boolean(null==L||null===(n=L.reply_to)||void 0===n||null===(n=n.value)||void 0===n?void 0:n.value),displayName:Boolean(null==Y?void 0:Y.value)}}))}));const Q=(0,mt().F)({actionId:U}),{value:J}=(0,Je().fJ)(T().T.formulas),X=function(e,t){return(0,se().K8)((()=>t&&e?r().oE(Object.entries(e.getSchema()).map((e=>{let[t,o]=e;const n=new Set(["person","email"]),i=null==o?void 0:o.type;if(!i)return;return n.has(i)||"rollup"===i&&o.target_property_type&&n.has(o.target_property_type)?(0,h().ESw)({contextValueId:(0,Go().KI)(),name:o.name,property:t,valueSnapshot:"current"}):void 0}))):[]),[e,t])}(_,(0,re.useMemo)((()=>{if(J)return Q.filter((e=>(null==e?void 0:e.kind)===g().FormulaContextValueKind.ContextValue)).find((e=>(null==e?void 0:e.id)===(0,Go().KI)()))}),[Q,J])),ee=(0,se().uB)(void 0,Xe().A),te=(0,re.useCallback)((()=>ee.reset()),[ee]),oe=(0,re.useMemo)((()=>(0,Fe.jsx)(st().z,{actionStore:A,closeMenu:te})),[A,te]),ne=(0,re.useMemo)((()=>!R.includes(A.id)),[R,A]),ie=function(e){const{actionId:t,shouldShowError:o}=e,n={};return n.external_bot_id=(0,ae().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"external_bot_id"}),n.to=(0,ae().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"to"}),n.cc=(0,ae().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"cc"}),n.bcc=(0,ae().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"bcc"}),n.reply_to=(0,ae().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"reply_to"}),n.email_body=(0,ae().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"email_body"}),n.email_subject=(0,ae().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"email_subject"}),n}({actionId:A.id,shouldShowError:ne}),pe=(0,ae().useRequiresSubscriptionUpgradeError)({actionId:A.id,shouldShow:ne}),me=Boolean(pe),ge=(0,it().X)("automation_updated_error_states"),he=(0,re.useMemo)((()=>{if(ge)return Object.values(ie).filter((e=>(0,s().O9)(e.errorMessage)))[0]}),[ie,ge]),ye=(0,re.useCallback)((e=>{const t=Xo().A.externalAuthentications.state.find((t=>t.integration_id===qo().eg&&t.id===e)),o=$!==(null==t?void 0:t.id);t&&o&&B.createAndCommit({perform:e=>{Z().zv({data:{external_bot_id:t.id},store:A.getConfigStore(),transaction:e})},userAction:"SendGmailNotificationAction.setExternalBotId"})}),[A,$,B]);(0,se().K8)((()=>{$||1===j.length&&ye(j[0].id)}),[j,ye,$]);const fe=(0,re.useCallback)((e=>t=>{if(!t)return;if("formula"===t.type)return void B.createAndCommit({perform:o=>{Z().zv({data:{[e]:{type:"formula",value:t}},store:A.getConfigStore(),transaction:o})},userAction:"SendGmailNotificationAction.setRecipient.formula"});const o=(0,h().RQ)(t.value).filter((e=>{const t=(0,h().Fbh)([e]);if(0===t.length)return!0;return!new(H().LU)(z,{table:b().oo,id:t[0]},{userId:t[0]}).getIsDeleted()}));B.createAndCommit({perform:t=>{Z().zv({data:{[e]:{type:"formula",value:{type:"simple",value:o}}},store:A.getConfigStore(),transaction:t})},userAction:"SendGmailNotificationAction.setRecipient.simple"}),(0,at().UB)(z,{automationStore:M,automationActionStore:A})}),[A,B,z,M]),ve=(0,re.useCallback)((e=>{B.createAndCommit({perform:t=>{Z().zv({data:{from_name:e},store:A.getConfigStore(),transaction:t})},userAction:"SendGmailNotificationAction.setFromName"}),(0,at().UB)(z,{automationStore:M,automationActionStore:A})}),[A,B,z,M]),xe=(0,re.useCallback)((e=>{B.createAndCommit({perform:t=>{Z().zv({data:{email_subject:e},store:A.getConfigStore(),transaction:t})},userAction:"SendGmailNotificationAction.setSubject"}),(0,at().UB)(z,{automationStore:M,automationActionStore:A})}),[A,B,z,M]),Se=(0,re.useCallback)((e=>{B.createAndCommit({perform:t=>{Z().zv({data:{email_body:e},store:A.getConfigStore(),transaction:t})},userAction:"SendGmailNotificationAction.setBody"}),(0,at().UB)(z,{automationStore:M,automationActionStore:A})}),[A,B,z,M]),{onTextStoreSelect:Ce,onTextStoreUnselect:Ae}=(0,Dt().W)(A),ke=(0,se().K8)((()=>{if(!J||!D)return{};const{createFormulaDataRequestSyncHandler:e}=J,t={subject:G,body:q,fromName:Y};return Object.fromEntries(Xn.map((o=>{const n=t[o];return n?[o,(0,Vt().analyzeSimpleFormulaOrFormulaSync)({context:{handleDataRequest:e(A.getRecordModel),spaceId:D,valueTypes:Q.slice(0),featureGates:(0,w().i)()},value:n})]:[o,""]})))}),[A.getRecordModel,G,q,Y,Q,J,D]),je=(0,re.useCallback)(((e,t)=>{e.stopPropagation(),e.preventDefault(),K((e=>({...e,[t]:!0}))),"displayName"===t&&W((e=>({...e,displayName:!1})))}),[]),Me=(0,re.useCallback)((e=>{W((t=>({...t,[e]:!t[e]})))}),[]),Te=(0,re.useCallback)((e=>{var t,o,n;return!("displayName"!==e||null==Y||!Y.value)||(!("cc"!==e||null==L||null===(t=L.cc)||void 0===t||null===(t=t.value)||void 0===t||!t.value)||(!("bcc"!==e||null==L||null===(o=L.bcc)||void 0===o||null===(o=o.value)||void 0===o||!o.value)||!("replyTo"!==e||null==L||null===(n=L.reply_to)||void 0===n||null===(n=n.value)||void 0===n||!n.value)))}),[Y,L]),Ie=(0,re.useCallback)((async(e,t)=>{e.stopPropagation(),e.preventDefault();if(Te(t)){if(!(await(0,Jo().bx)({fieldName:`"${oi[t]}"`})))return}"displayName"===t&&ve(void 0),"cc"!==t&&"bcc"!==t||fe(t)({type:"simple",value:void 0}),"replyTo"===t&&fe("reply_to")({type:"simple",value:void 0}),K((e=>({...e,[t]:!1})))}),[ve,Te,fe]),we=(0,re.useCallback)((()=>{de().clear({environment:z})}),[z]),{isMobile:Pe}=(0,le().Y0)(),Re=(0,ce().IS)((e=>{var t;const o={color:e.text.secondary,fontSize:Pe?ue().J.UIRegular.mobile:ue().J.UIRegular.desktop,lineHeight:Pe?ue().K_.UIRegular.mobile:ue().K_.UIRegular.desktop,fontWeight:ue().Wy.regular};return{inputLabel:{...o},toInputLabel:{...o,...ge&&(0,s().O9)(null===(t=ie.to)||void 0===t?void 0:t.errorMessage)&&{color:e.text.uiRedPrimary,fontWeight:ue().Wy.medium}},toErrorLabel:{color:e.text.uiRedPrimary},toggleableInputLabel:{...o,cursor:"pointer",padding:2,transform:"translateX(-2px)",display:"flex",width:"fit-content"},toggleableInputLabelHovered:{...o,cursor:"pointer",backgroundColor:e.buttonHoveredBackground,transform:"translateX(-2px)",display:"flex",width:"fit-content",borderRadius:"4px",padding:2},messageInput:{width:"100%"},replyToInputContainer:{display:"flex",justifyContent:"space-between"},replyToInputField:{width:"100%",fontSize:Pe?ue().J.UIRegular.mobile:ue().J.UIRegular.desktop},ccBccToggle:{padding:"6px 12px",color:e.lightTextColor,borderRadius:"6px",marginLeft:8,alignSelf:"flex-start"},container:{overflow:"visible"},toggleFieldGridContainer:{display:"grid",gridTemplateRows:"auto auto",gridTemplateColumns:"1fr auto",alignItems:"center",columnGap:8,rowGap:6},toggleFieldGridLabel:{gridRow:"1",gridColumn:"1"},toggleFieldGridInput:{gridRow:"2",gridColumn:"1"},toggleFieldGridTrashIconButton:{gridRow:"2",gridColumn:"2",alignSelf:"flex-start",height:32,width:32},toggleFieldTrashIconButtonForTextInput:{gridRow:"1",gridColumn:"2",alignSelf:"flex-start",marginTop:26,height:32,width:32},trashIcon:{width:16,height:16}}}),[ie,ge,Pe]);function _e(e,t){return e||t?!e&&t?Re.toggleableInputLabelHovered:Re.inputLabel:Re.toggleableInputLabel}if(!D)return null;const Ve={collectionStore:_,limit:ri,disabled:V,formulaTypecheckContextValues:Q,spaceId:D,pageProperties:X};return(0,Fe.jsxs)(kt().OT,{actionMenu:oe,buttonPopupStore:ee,disabled:V,actionId:A.id,canCollapse:!me,hideDragHandle:me,children:[(0,Fe.jsx)(kt().h3,{actionId:A.id,actionRegistryItem:E,disabled:V,errorMessage:pe||(null==he?void 0:he.errorMessage),styles:{headerWrap:{paddingRight:32},titleWrap:{display:"flex",flexWrap:"wrap",gap:4}},children:(0,Fe.jsx)(ii,{currentGmailAuthentication:k,gmailAuthentications:j,disabled:V,isError:me,onGmailAccountChange:ye,accountPickerErrorMessage:null===(t=ie.external_bot_id)||void 0===t?void 0:t.errorMessage})}),k&&(0,Fe.jsx)(kt().qt,{children:(0,Fe.jsxs)(Tt().Y1,{direction:"vertical",gap:16,children:[(0,Fe.jsxs)(Tt().Y1,{direction:"vertical",gap:6,children:[(0,Fe.jsx)("label",{style:Re.toInputLabel,children:(0,Fe.jsx)(F().sA,{...Jn.toLabel})}),(0,Fe.jsxs)("div",{className:"to-input-and-ccBcc-container",style:Re.replyToInputContainer,children:[(0,Fe.jsx)(ai,{...Ve,recipients:null==L||null===(o=L.to)||void 0===o?void 0:o.value,onChange:fe("to"),errorMessage:null===(n=ie.to)||void 0===n?void 0:n.errorMessage,style:Re.replyToInputField}),(!O.cc||!O.bcc)&&(0,Fe.jsx)(Zo().A,{onClick:e=>{O.cc||je(e,"cc"),O.bcc||je(e,"bcc")},style:Re.ccBccToggle,children:O.cc||O.bcc?(0,Fe.jsx)(F().sA,{id:"automations.SendGmailNotificationAction.ccOrBccToggleLabel",defaultMessage:"{showCCLabel, select, true {CC} other {BCC}}",values:{showCCLabel:!O.cc&&O.bcc}}):(0,Fe.jsx)(F().sA,{id:"automations.SendGmailNotificationAction.ccAndBccToggleLabel",defaultMessage:"CC/BCC"})})]}),ge&&(0,s().O9)(null===(i=ie.to)||void 0===i?void 0:i.errorMessage)&&(0,Fe.jsx)(Qo().D,{colorName:"secondary",styleName:"UISmall-12px/Regular",style:Re.toErrorLabel,children:(0,Fe.jsx)(F().sA,{...null===(l=ie.to)||void 0===l?void 0:l.errorMessageDescriptor})})]}),O.cc&&(0,Fe.jsx)(Tt().Y1,{direction:"vertical",gap:16,children:(0,Fe.jsxs)("div",{style:Re.toggleFieldGridContainer,children:[(0,Fe.jsxs)("label",{style:Re.inputLabel,children:[(0,Fe.jsx)(F().sA,{...Jn.ccLabel}),(0,Fe.jsx)(xo().z,{})]}),(0,Fe.jsx)(ai,{...Ve,recipients:null==L||null===(c=L.cc)||void 0===c?void 0:c.value,onChange:fe("cc"),errorMessage:null===(u=ie.cc)||void 0===u?void 0:u.errorMessage,style:Re.toggleFieldGridInput}),(0,Fe.jsx)(Be().A,{icon:Yt().I,ariaLabel:C.formatMessage({id:"automations.SendGmailNotificationAction.removeField",defaultMessage:"Remove Field"}),onClick:e=>Ie(e,"cc"),style:Re.toggleFieldGridTrashIconButton,iconStyle:Re.trashIcon})]})}),O.bcc&&(0,Fe.jsx)(Tt().Y1,{direction:"vertical",gap:16,children:(0,Fe.jsxs)("div",{style:Re.toggleFieldGridContainer,children:[(0,Fe.jsxs)("label",{style:{...Re.inputLabel},children:[(0,Fe.jsx)(F().sA,{...Jn.bccLabel}),(0,Fe.jsx)(xo().z,{})]}),(0,Fe.jsx)(ai,{...Ve,recipients:null==L||null===(d=L.bcc)||void 0===d?void 0:d.value,onChange:fe("bcc"),errorMessage:null===(p=ie.bcc)||void 0===p?void 0:p.errorMessage,style:Re.toggleFieldGridInput}),(0,Fe.jsx)(Be().A,{icon:Yt().I,ariaLabel:C.formatMessage({id:"automations.SendGmailNotificationAction.removeField",defaultMessage:"Remove Field"}),onClick:e=>Ie(e,"bcc"),style:Re.toggleFieldGridTrashIconButton,iconStyle:Re.trashIcon})]})}),(0,Fe.jsx)(xo().M,{disabled:V,disableMobileActionBar:!1,disableNewLines:!0,disableStyleAnnotations:!0,disableTemplateVariableMentions:!1,formulaTypecheckContextValues:Q,onChange:xe,onTextStoreSelect:Ce,onTextStoreUnselect:Ae,onTextEsc:we,parentRecordStore:A,spaceId:D,style:Re.messageInput,value:G,analyzedFormulaOutput:ke.subject,labelMessageDescriptor:Jn.subjectLabel,errorMessageDescriptor:null===(m=ie.email_subject)||void 0===m?void 0:m.errorMessageDescriptor,shouldShowErrorStyles:ge&&(0,s().O9)(null===(y=ie.email_subject)||void 0===y?void 0:y.errorMessage)}),(0,Fe.jsx)(xo().M,{disabled:V,disableMobileActionBar:!1,disableTemplateVariableMentions:!1,formulaTypecheckContextValues:Q,onChange:Se,onTextStoreSelect:Ce,onTextStoreUnselect:Ae,onTextEsc:we,parentRecordStore:A,rows:4,spaceId:D,style:Re.messageInput,value:q,analyzedFormulaOutput:ke.body,labelMessageDescriptor:Jn.bodyLabel,errorMessageDescriptor:null===(f=ie.email_body)||void 0===f?void 0:f.errorMessageDescriptor,shouldShowErrorStyles:ge&&(0,s().O9)(null===(v=ie.email_body)||void 0===v?void 0:v.errorMessage)}),!O.displayName&&(0,Fe.jsx)("label",{children:(0,Fe.jsxs)("span",{onClick:e=>je(e,"displayName"),onMouseEnter:()=>Me("displayName"),onMouseLeave:()=>Me("displayName"),style:_e(O.displayName,N.displayName),children:[(0,Fe.jsx)(F().sA,{...Jn.fromNameLabel}),"..."]})}),O.displayName&&(0,Fe.jsxs)("div",{style:{...Re.toggleFieldGridContainer,rowGap:0},children:[(0,Fe.jsx)("div",{style:Re.toggleFieldGridLabel,children:(0,Fe.jsx)(xo().M,{disabled:V,disableMobileActionBar:!1,disableTemplateVariableMentions:!1,formulaTypecheckContextValues:Q,disableNewLines:!0,disableStyleAnnotations:!0,onChange:ve,onTextStoreSelect:Ce,onTextStoreUnselect:Ae,onTextEsc:we,parentRecordStore:A,rows:1,spaceId:D,value:Y,analyzedFormulaOutput:ke.fromName,labelMessageDescriptor:Jn.fromNameLabel,isOptional:!0})}),(0,Fe.jsx)(Be().A,{icon:Yt().I,ariaLabel:C.formatMessage({id:"automations.SendGmailNotificationAction.removeField",defaultMessage:"Remove Field"}),onClick:e=>Ie(e,"displayName"),style:Re.toggleFieldTrashIconButtonForTextInput,iconStyle:Re.trashIcon})]}),(0,Fe.jsxs)("div",{style:Re.toggleFieldGridContainer,children:[(0,Fe.jsx)("label",{style:Re.toggleFieldGridLabel,children:(0,Fe.jsxs)("span",{onClick:e=>je(e,"replyTo"),onMouseEnter:()=>Me("replyTo"),onMouseLeave:()=>Me("replyTo"),style:_e(O.replyTo,N.replyTo),children:[(0,Fe.jsx)(F().sA,{...Jn.replyToLabel}),!O.replyTo&&"...",O.replyTo&&(0,Fe.jsx)(xo().z,{})]})}),O.replyTo&&(0,Fe.jsxs)(Fe.Fragment,{children:[(0,Fe.jsx)(ai,{...Ve,recipients:null==L||null===(x=L.reply_to)||void 0===x?void 0:x.value,onChange:fe("reply_to"),errorMessage:null===(S=ie.reply_to)||void 0===S?void 0:S.errorMessage,limit:1,style:Re.toggleFieldGridInput}),(0,Fe.jsx)(Be().A,{icon:Yt().I,ariaLabel:C.formatMessage({id:"automations.SendGmailNotificationAction.removeField",defaultMessage:"Remove Field"}),onClick:e=>Ie(e,"replyTo"),style:Re.toggleFieldGridTrashIconButton,iconStyle:Re.trashIcon})]})]})]})})]})}function ii(e){const{currentGmailAuthentication:t,gmailAuthentications:o,disabled:n,isError:i,onGmailAccountChange:a,accountPickerErrorMessage:r}=e,l=(0,ce().IS)((()=>({b:{fontWeight:ue().Wy.medium},picker:{display:"inline-flex",minWidth:50,marginLeft:4},span:{flex:0,display:"flex",alignItems:"center"},title:{display:"inline-flex",minWidth:50,flexWrap:"wrap",gap:6}})),[]),s=function(){const{isMobile:e}=(0,le().Y0)(),t=e?ue().J.UISmall.mobile:ue().J.UISmall.desktop;return(0,ce().IS)((()=>({container:{alignItems:"baseline",display:"inline-flex",gap:2,minWidth:50,width:"100%"},lockIcon:{alignSelf:"center",height:"auto",width:t}})),[t])}();return i?(0,Fe.jsx)("div",{style:l.title,children:(0,Fe.jsx)(F().sA,{defaultMessage:"Send mail",id:"automations.SendGmailNotificationAction.header.titleError"})}):(0,Fe.jsx)("div",{style:l.title,children:(0,Fe.jsx)(F().sA,{defaultMessage:"Send mail from{gmailAccountPicker}",id:"automations.SendGmailNotificationAction.header.title",values:{gmailAccountPicker:n?(0,Fe.jsxs)("div",{style:s.container,children:[(0,$o().S)(s.lockIcon),(0,Fe.jsx)("span",{style:ue().RC,children:(0,Fe.jsx)(F().sA,{...Jn.gmailAccountPickerHidden})})]}):(0,Fe.jsx)(Zn,{currentGmailAuthentication:t,gmailAuthentications:o,disabled:n,onAccountChange:a,errorMessage:r})}})})}function ai(e){const{recipients:t,style:o,collectionStore:n,...i}=e,{automationStore:a}=(0,be().EC)();return(0,Fe.jsx)("div",{style:o,children:(0,Fe.jsx)(Ln,{currentValue:t,collectionStore:n,parentRecordStore:a,...i})})}const ri=20;var li=()=>o(678350);const si=(0,F().YK)({defaultMenuHeader:{defaultMessage:"Select people",id:"automationPersonPicker.defaultMenuHeaderMessage"},personValuePickerPlaceholder:{defaultMessage:"Select up to {maxSelected} people...",id:"automations.personPicker.buttonPlaceholder"}});function ci(e){const{currentValue:t,collectionStore:o,disabled:n,onChange:i,formulaTypecheckContextValues:a,menuHeader:r,limit:l,errorMessage:s,parentRecordStore:c,spaceId:u,style:d}=e,p={type:"person_array"},m=(0,F().tz)(),g=o?{type:"collection",collectionStore:o,property:"person"}:{type:"empty"},h={menuType:_o().gu.Popup,header:(0,Fe.jsx)(St().A,{title:r?m.formatMessage(r):m.formatMessage(si.defaultMenuHeader)})};return(0,Fe.jsx)(li().U,{allowedReturnTypes:bo().Yy.person,formulaTypecheckContextValues:a,disabled:n,simpleFormulaContext:g,onChange:i,type:p,value:t,menuProps:h,placeholder:l?m.formatMessage(si.personValuePickerPlaceholder,{maxSelected:l}):void 0,limit:l,errorMessage:s,parentRecordStore:c,spaceId:u,style:d})}var ui=()=>o(464004);const di=(0,F().YK)({property:{id:"automationAction.sendInAppNotification.targetType.property",defaultMessage:"Person property"},formula:{id:"automationAction.sendInAppNotification.targetType.formula",defaultMessage:"Specific people"},default:{id:"automations.targetPicker.targetTypePlaceholder",defaultMessage:"Select recipients"}});function pi(e){const{disabled:t,errorMessage:o,selectedTargetType:n,onSelectedTargetTypeChange:i}=e,a=(0,se().uB)(void 0,Xe().A),r=(0,je().j)(),l=(0,it().X)("automation_updated_error_states"),s=(0,re.useCallback)((e=>{e!==n&&(i(e),a.reset())}),[i,a,n]);return(0,Fe.jsx)(Ze().Ay,{buttonPopupStore:a,popupType:r,alignmentToOrigin:Ze().yP.End,placementToOrigin:Ze().sx.Bottom,originGap:0,disabled:t,renderOrigin:e=>(0,Fe.jsx)(gt().x,{...e,disabled:t,isCompact:!0,isError:Boolean(o),hasActionRequired:!Boolean(n),tooltipMessage:!l&&o,dropdownButtonType:"dropdown",children:n?(0,Fe.jsx)(F().sA,{...di[n]}):(0,Fe.jsx)(F().sA,{...di.default})}),render:e=>(0,Fe.jsx)(mi,{handleChange:s,selectedTargetType:n})})}function mi(e){const{handleChange:t}=e,o=(0,bt().e)(),n=[(0,re.useMemo)((()=>({action:()=>null,key:"selectUsers",render:e=>(0,Fe.jsx)($e().A,{...e,onClick:()=>t("formula"),title:(0,Fe.jsx)(F().sA,{...di.formula})})})),[t]),(0,re.useMemo)((()=>({action:()=>null,key:"selectPersonProperty",render:e=>(0,Fe.jsx)($e().A,{...e,onClick:()=>t("property"),title:(0,Fe.jsx)(F().sA,{...di.property})})})),[t])].filter(s().O9);if(0===n.length)return null;const i={items:n,key:"targetType",render:e=>(0,Fe.jsx)(St().A,{topBorder:!0,...e,enableActionSheetTitle:!0})};return(0,Fe.jsx)(vt().A,{...o,children:(0,Fe.jsx)(xt().Ay,{type:xt().Oh.Vertical,sections:[i],initialFocus:0})})}const gi=(0,F().YK)({notificationMessageLabel:{defaultMessage:"Message",id:"automations.BaseModalAction.notificationMessageLabel"},personPropertyTargetTypeLabel:{defaultMessage:"Property",id:"automations.SendInAppNotificationAction.personPropertyTargetTypeLabel"},usersTargetTypeLabel:{defaultMessage:"People",id:"automations.SendInAppNotificationAction.usersTargetTypeLabel"},propertyPickerPlaceholder:{defaultMessage:"Select a property",id:"automations.SendInAppNotificationAction.propertyPickerPlaceholder"},personValuePickerMenuHeader:{defaultMessage:"Send notification to",id:"automations.personPicker.menuHeader"}});function hi(e){const{noCollection:t,targetsErrorMessage:o,selectedTargetType:n,disabled:i,onTargetTypeChange:a}=e;return t?(0,Fe.jsx)(F().sA,{defaultMessage:"Send notification to specific people",id:"automations.SendInAppNotificationAction.header.titleButtonBlock",values:{placeholder:"specific people"}}):(0,Fe.jsx)(F().sA,{defaultMessage:"Send notification to{targetTypePicker}",id:"automations.SendInAppNotificationAction.header.title",values:{targetTypePicker:(0,Fe.jsx)(pi,{onSelectedTargetTypeChange:a,disabled:i,errorMessage:o,selectedTargetType:n})}})}function yi(e){const{isError:t,isMobile:o,selectedTargetType:n}=e,i=(0,ce().IS)((e=>({inputLabel:{color:t?e.text.uiRedPrimary:e.text.secondary,fontSize:o?ue().J.UIRegular.mobile:ue().J.UIRegular.desktop,lineHeight:o?ue().K_.UIRegular.mobile:ue().K_.UIRegular.desktop,fontWeight:ue().Wy.regular}})),[t,o]),a=(0,se().K8)((()=>{switch(n){case"property":return gi.personPropertyTargetTypeLabel;case"formula":return gi.usersTargetTypeLabel;default:(0,s().HB)(n)}}),[n]);return(0,Fe.jsx)("label",{style:i.inputLabel,children:(0,Fe.jsx)(F().sA,{...a})})}const fi=20;function vi(e){const{collectionStore:t,currentProperties:o,currentTargetValue:n,disabled:i,errorMessage:a,formulaTypecheckContextValues:r,onTargetValueChange:l,parentRecordStore:c,spaceId:u}=e,d=n.type;switch(d){case"formula":return(0,Fe.jsx)(ci,{collectionStore:t,currentValue:n.value,disabled:Boolean(i),onChange:e=>l({type:"formula",value:e}),parentRecordStore:c,formulaTypecheckContextValues:r,menuHeader:gi.personValuePickerMenuHeader,limit:fi,errorMessage:a,spaceId:u,style:{width:"100%"}});case"property":return t?(0,Fe.jsx)(ui().l,{availablePropertyIds:o,currentValue:n.propertyId,collectionStore:t,onChange:e=>l({type:"property",propertyId:e}),disabled:Boolean(i),alreadyHaveProperties:Boolean(n.propertyId),placeholderMessage:gi.propertyPickerPlaceholder,errorMessage:a}):null;default:(0,s().HB)(d)}}function xi(e,t){if("formula"===t.type||!(0,s().O9)(t.value))return{type:"simple",value:void 0};const o=t.value.filter((t=>{if(!(0,h().qXl)(t))return!1;const o=(0,h().uPN)(t),n=(0,h().snh)(o);if(n){const t=(0,h().NcG)(n);return!new(H().LU)(e,{id:t,table:b().oo},{userId:t}).getIsDeleted()}return(0,h().tVx)(o)}));return{type:"simple",value:(0,Vt().toSimpleFormulaArrayValue)((0,Vt().filterTextValueToSimpleFormulaValueTokens)(o))}}o(737550);var Si=()=>o(841369),bi=()=>o(21140),Ci=()=>o(795727);const Ai=(0,F().YK)({addCustomHeader:{defaultMessage:"Add custom header",id:"automations.BaseModalAction.addCustomHeader"},customHeaderKeyLabel:{defaultMessage:"Key",id:"automations.BaseModalAction.customHeaderKeyLabel"},customHeaderValueLabel:{defaultMessage:"Value",id:"automations.BaseModalAction.customHeaderValueLabel"},removeCustomHeaderAriaLabel:{defaultMessage:"Remove custom header",id:"automations.BaseModalAction.removeCustomHeaderAriaLabel"}});function ki(e){const{actionStore:t}=e,o=(0,F().tz)(),n=Ni(),{suppressActionErrors:i}=(0,We().b)(),{typecheckResult:a}=(0,be().EC)(),[r,s]=(0,re.useState)(new Set),[c,u]=(0,re.useState)((()=>new(Ci().A))),d=(0,se().K8)((()=>{if(!l().Q.isSuccess(a))return new(Ci().A);const e=i.includes(t.id),o=a.value.actionValidationFailures[t.id]||[],n=new(Ci().A);return o.forEach((t=>{if("empty_custom_header_field"===t.type){const[o,i,a]=t.key;n.set({id:i,field:a},!e&&!r.has(i)||(c.get({id:i,field:a})||!1))}})),n}),[a,i,t.id,c,r]),{maybePersistedTransactionActions:p}=(0,We().b)(),m=(0,ce().IS)((()=>({customHeadersContainer:{display:"flex",flexDirection:"column",gap:12,marginTop:12},customHeaderInputsContainer:{display:"grid",gridTemplateRows:"auto auto",gridTemplateColumns:"1fr 1fr auto",alignItems:"center",columnGap:8,rowGap:4},customHeaderKeyLabel:{...n.inputLabel,gridRow:1,gridColumn:1},customHeaderValueLabel:{...n.inputLabel,gridRow:1,gridColumn:2},customHeaderKeyInput:{...n.input,gridRow:2,gridColumn:1},customHeaderValueInput:{...n.input,gridRow:2,gridColumn:2},customHeaderRemoveButton:{gridRow:2,gridColumn:3,width:32,height:32},customHeaderRemoveButtonIcon:{width:18,height:18},addCustomHeaderButton:{marginLeft:-8,marginTop:8}})),[n]),g=(0,se().K8)((()=>t.getConfigStore().getKeyStore("customHeaders")),[t]),h=(0,se().K8)((()=>(g.getValue()||[]).map((e=>({...e,id:e.id||(0,wt().Ay)()})))),[g]),y=(0,re.useCallback)(((e,t)=>()=>{const o=new(Ci().A)({from:c.entries()});o.set({id:e,field:t},!0),u(o)}),[c]),f=(0,re.useCallback)(((e,t)=>o=>{const n=(g.getValue()||[]).map((n=>n.id===e?{...n,[t]:o}:n));p.createAndCommit({userAction:"AutomationPlainTextInput.setValue",perform:e=>{Z().KY({store:g,transaction:e,value:n})}})}),[g,p]),v=(0,re.useCallback)((()=>{p.createAndCommit({userAction:"AutomationPlainTextInput.setValue",perform:e=>{const t={id:(0,wt().Ay)(),key:"",value:""};Z().KY({store:g,transaction:e,value:[...h,t]}),s((e=>{const o=new Set(e);return o.add(t.id),o}))}})}),[h,g,p]),x=(0,re.useCallback)((e=>()=>{const t=h.filter((t=>t.id!==e));p.createAndCommit({userAction:"AutomationPlainTextInput.setValue",perform:e=>{Z().KY({store:g,transaction:e,value:t})}})}),[h,g,p]),S=h.length>0&&(0,Fe.jsx)("div",{style:m.customHeadersContainer,children:h.map((e=>(0,Fe.jsxs)("div",{style:m.customHeaderInputsContainer,children:[(0,Fe.jsx)("label",{style:m.customHeaderKeyLabel,children:(0,Fe.jsx)(F().sA,{...Ai.customHeaderKeyLabel})}),(0,Fe.jsx)("label",{style:m.customHeaderValueLabel,children:(0,Fe.jsx)(F().sA,{...Ai.customHeaderValueLabel})}),(0,Fe.jsx)("div",{}),(0,Fe.jsx)(ze,{style:m.customHeaderKeyInput,value:e.key,onChange:f(e.id,"key"),errorOutline:d.get({id:e.id,field:"key"}),onBlur:y(e.id,"key"),autoFocus:!e.key,maxlength:Si().Sx}),(0,Fe.jsx)(ze,{style:m.customHeaderValueInput,value:e.value,onChange:f(e.id,"value"),errorOutline:d.get({id:e.id,field:"value"}),onBlur:y(e.id,"value"),maxlength:Si().Sx}),(0,Fe.jsx)(Be().A,{icon:Yt().I,ariaLabel:o.formatMessage(Ai.removeCustomHeaderAriaLabel),style:m.customHeaderRemoveButton,iconStyle:m.customHeaderRemoveButtonIcon,onClick:x(e.id)})]},e.id)))});return(0,Fe.jsxs)(Fe.Fragment,{children:[S,h.length<Si().qu&&(0,Fe.jsx)(bi().Ye,{children:(0,Fe.jsx)(Rt().p,{isGray:!0,onClick:v,style:m.addCustomHeaderButton,children:(0,Fe.jsx)(F().sA,{...Ai.addCustomHeader})})})]})}var ji=()=>o(133033),Mi=()=>o(148024),Ti=()=>o(187485),Ii=()=>o(836251);function wi(e){const t=(0,le().v3)(),o=(0,F().tz)();return(0,Fe.jsx)(_e().A,{renderTooltip:()=>(0,Fe.jsx)(F().sA,{defaultMessage:"Learn more",id:"webhookAction.helpButton.tooltip"}),render:e=>(0,Fe.jsx)(Ti().A,{...e,href:(0,Ii().xS)("guides.webhookAction"),onClick:()=>Mi().FH(t,{from:"webhookAction"}),external:!0,children:(0,Fe.jsx)(Be().A,{...e,ariaLabel:o.formatMessage({id:"webhookAction.helpButton.ariaLabel",defaultMessage:"Learn about webhook actions"}),icon:ji().$})})})}wi.displayName="SendWebhookActionHelpLink";var Pi=()=>o(713998),Bi=()=>o(743176),Ri=()=>o(488887);const _i=new Set(["title","text","relation","checkbox","number","person","file","url","email","phone_number","created_time","created_by","last_edited_time","last_edited_by","last_visited_time","formula","rollup","select","multi_select","date","status","auto_increment_id","location","verification","geo_point"]);const Vi=(0,F().YK)({selectAllPropertiesDescription:{defaultMessage:"New properties will not be included automatically",id:"automations.BaseModalAction.selectAllPropertiesDescription"},selectAllProperties:{defaultMessage:"Select all existing properties",id:"automations.BaseModalAction.selectAllProperties"},propertyPickerLabel:{defaultMessage:"Content",id:"automations.BaseModalAction.propertyPickerLabel"},propertyDisabledMissingPermissionTooltip:{defaultMessage:"This property references a database you don't have access to",id:"automations.SendWebhookActionPropertyPicker.propertyDisabledMissingPermissionTooltip"},propertyDisabledUnsupportedTypeTooltip:{defaultMessage:"This property type is not supported",id:"automations.SendWebhookActionPropertyPicker.propertyDisabledUnsupportedTypeTooltip"}});function Ei(){return(0,ce().IS)((e=>({buttonMenuItemContent:{height:34,gap:6},buttonMenuItem:{borderRadius:4}})),[])}function Fi(e){let{collectionStore:t,value:o,onChange:n}=e;const i=Ei(),a=Ni(),l=(0,se().K8)((()=>t.getSchema()),[t]),s=(0,re.useMemo)((()=>new Set("some"===o.type?o.some||[]:Object.keys(l))),[l,o]),c=function(e){const{value:t}=(0,Je().fJ)(T().T.formulas),{value:o}=(0,Je().fJ)(T().T.formulaPermissions),n=(0,it().X)("collections_xws"),i=(0,se().K8)((()=>{if(!t)return;const o=(0,w().i)();return{allowedReturnTypes:[{type:"unknown"}],handleDataRequest:(0,f().MC)({collectionFeatureGates:o,experimentService:B().default,getRecordModel:e.getRecordModel,loadRecordModel:e.loadRecordModel}),restrictUnaccessibleProperties:n?"cross_space_and_read_permissions":"read_permissions_only",spaceId:e.getSpaceId(),valueTypes:[],featureGates:o}}),[t,e,n]),[a]=(0,cn().Yb)((async()=>{if(!t||!i||!o)return;const n=e.getSchema(),a=Object.keys(n),r=await(0,q().lX)(a,3,(async t=>{const a=(0,Pi()._g)({schema:n,property:t});if(a)return _i.has(a.type)?await o.hasAccessToProperty({collectionPointer:e.pointer,collectionSchema:n,context:i,propertyId:t,hasAccessFn:o.hasAccessDefaultFn})?void 0:"missing_permission":"unsupported_property_type"})),l=new Map;return r.forEach(((e,t)=>{l.set(a[t],e)})),l.size>0?l:void 0}),[e,i,t,o]);return a}(t),u=(0,re.useMemo)((()=>c.value||new Map),[c]),d=(0,re.useMemo)((()=>new Set(Array.from(u.entries()).filter((e=>{let[t,o]=e;return void 0===o})).map((e=>{let[t]=e;return t})))),[u]),p=(0,re.useMemo)((()=>"some"===o.type&&(0,Ri()._)(s,d)),[o.type,s,d]),m=(0,re.useRef)(null),g=(0,re.useCallback)((e=>{s.has(e)?s.delete(e):s.add(e),n({type:"some",some:Array.from(s)})}),[s,n]),h=(0,ce().IS)((e=>({sectionMenuItem:{padding:8},propertyPickerContainer:{display:"flex",flexDirection:"column",border:`1px solid ${e.regularDividerColor}`,borderRadius:8,maxHeight:212,overflowY:"auto",marginBottom:2},selectAllPropertiesButton:{height:34},selectAllPropertiesButtonTitle:{display:"flex",alignItems:"center",gap:4},selectAllPropertiesCheckboxContainer:{height:34,width:30,display:"flex",alignItems:"center",justifyContent:"center",paddingLeft:4},selectAllPropertiesCheckbox:{cursor:"pointer"}})),[]),y=(0,re.useCallback)((()=>{n(p?{type:"some",some:[]}:{type:"some",some:Array.from(d.values())})}),[p,n,d]);(0,re.useEffect)((()=>{m.current&&(m.current.indeterminate=s.size>0&&!p)}),[p,s,o.type]);const v=Object.keys(l),x=(0,re.useMemo)((()=>v.sort(((e,t)=>{const o=(0,Pi()._g)({schema:l,property:e}),n=(0,Pi()._g)({schema:l,property:t});if("title"===(null==o?void 0:o.type))return-1;if("title"===(null==n?void 0:n.type))return 1;const i=(null==o?void 0:o.name)||"",a=(null==n?void 0:n.name)||"";return i.localeCompare(a)}))),[v,l]);if(!u)return null;const S=(0,r().oE)(x.map((e=>{const t=(0,Pi()._g)({schema:l,property:e});if(!t)return null;return{key:e,render:o=>(0,Fe.jsx)(Di,{...o,propertySchema:t,selected:s.has(e),noAccessReason:u.get(e),buttonStyle:i.buttonMenuItem,style:i.buttonMenuItemContent}),action:()=>{g(e)}}}))),b=(0,r().oE)([{key:0,render:e=>(0,Fe.jsx)(St().A,{...e,style:h.sectionMenuItem}),items:[{key:0,render:e=>(0,Fe.jsx)($e().A,{...e,style:i.buttonMenuItemContent,buttonStyle:i.buttonMenuItem,title:(0,Fe.jsxs)("div",{style:h.selectAllPropertiesButtonTitle,children:[(0,Fe.jsx)(F().sA,{...Vi.selectAllProperties}),(0,Fe.jsx)(Li,{})]}),leftStyle:h.selectAllPropertiesCheckboxContainer,left:(0,Fe.jsx)("input",{type:"checkbox",readOnly:!0,checked:p,ref:m,style:h.selectAllPropertiesCheckbox})}),action:y}]},{key:1,render:e=>(0,Fe.jsx)(St().A,{topBorder:!0,style:h.sectionMenuItem,...e}),items:S}]);return(0,Fe.jsxs)(Fe.Fragment,{children:[(0,Fe.jsx)("label",{style:a.inputLabel,children:(0,Fe.jsx)(F().sA,{...Vi.propertyPickerLabel})}),(0,Fe.jsx)("div",{style:h.propertyPickerContainer,children:(0,Fe.jsx)(xt().Ay,{type:xt().Oh.Vertical,sections:b,initialFocus:void 0,resetFocusOnMouseOut:!0})})]})}function Di(e){const{propertySchema:t,noAccessReason:o}=e,n=(0,ce().DP)(),i=(0,le().v3)(),{name:a,type:r,icon:l}=t,s=Ei(),c=(0,ce().IS)((e=>({buttonMenuItemTitle:{color:o?e.text.tertiary:e.text.secondary},propertyIcon:{fill:o?e.icon.tertiary:e.icon.secondary,height:ao().Ev.sm,width:ao().Ev.sm,display:"flex",alignItems:"center",justifyContent:"center"},checkBoxInput:{cursor:o?void 0:"pointer"},checkboxContainer:{height:34,width:30,display:"flex",alignItems:"center",justifyContent:"center",paddingLeft:4}})),[o]),u=(0,Fe.jsx)($e().A,{title:a,disabled:Boolean(o),style:s.buttonMenuItemContent,titleStyle:c.buttonMenuItemTitle,icon:(0,Fe.jsx)(Bi().Ay,{icon:l,type:r,size:i.device.isMobile?18:16,theme:n,style:c.propertyIcon}),left:(0,Fe.jsx)("div",{style:c.checkboxContainer,children:(0,Fe.jsx)("input",{type:"checkbox",readOnly:!0,checked:e.selected,disabled:Boolean(o),style:c.checkBoxInput})}),...e});return o?(0,Fe.jsx)(Oi,{noAccessReason:o,children:u}):u}function Li(){const e=(0,ce().IS)((e=>({helpIcon:{width:ao().Ev.sm,height:ao().Ev.sm,fill:e.icon.secondary}})),[]),t=(0,se().K8)((()=>(0,ji().$)(e.helpIcon)),[e.helpIcon]);return(0,Fe.jsx)(_e().A,{renderTooltip:()=>(0,Fe.jsx)(F().sA,{...Vi.selectAllPropertiesDescription}),render:e=>(0,Fe.jsx)("div",{...e,children:t}),placement:Kt().W.Top})}function Oi(e){const{children:t,noAccessReason:o}=e;return(0,Fe.jsx)(_e().A,{renderTooltip:()=>"missing_permission"===o?(0,Fe.jsx)(F().sA,{...Vi.propertyDisabledMissingPermissionTooltip}):"unsupported_property_type"===o?(0,Fe.jsx)(F().sA,{...Vi.propertyDisabledUnsupportedTypeTooltip}):void(0,s().HB)(o),originGap:0,render:e=>(0,Fe.jsx)("div",{...e,children:t}),placement:Kt().W.Left})}const Ki=(0,F().YK)({urlInputLabel:{defaultMessage:"URL",id:"automations.BaseModalAction.urlInputLabel"}});function Ni(){const{isMobile:e}=(0,le().Y0)();return(0,ce().IS)((t=>({inputLabel:{color:t.mediumTextColor,fontSize:e?ue().J.UIRegular.mobile:ue().J.UIRegular.desktop},input:{backgroundColor:t.contentBackground,paddingTop:6,paddingBottom:6},helpText:{color:t.mediumTextColor,fontSize:e?ue().J.UISmall.mobile:ue().J.UISmall.desktop}})),[e])}const Wi={create_page:function(e){const{actionStore:t}=e,n=(0,le().v3)(),{automationStore:i}=(0,be().EC)(),{disabled:r,maybePersistedTransactionActions:l,suppressActionErrors:c}=(0,We().b)(),u=(0,a().getActionRegistryItem)("create_page"),[d,p]=(0,se().K8)((()=>{const e=t.getConfig();return[null==e?void 0:e.properties,null==e?void 0:e.values]}),[t]),[m,g]=(0,se().K8)((()=>{const e=t.getCollectionStore();return null!=e&&e.isDefined()?[e,{collection:e.getSpaceShardedPointer(),type:"collection"}]:[void 0,void 0]}),[t]),h=(0,se().K8)((()=>lt(m).length>0),[m]),y=(0,se().K8)((()=>{var e;return null===(e=t.getConfig())||void 0===e?void 0:e.template_page_id}),[t]),f=(0,re.useMemo)((()=>({values:p??{},properties:d??[]})),[p,d]),v=(0,se().uB)(void 0,Xe().A),x=(0,re.useCallback)((()=>v.reset()),[v]),S=(0,re.useMemo)((()=>(0,Fe.jsx)(st().z,{actionStore:t,closeMenu:x})),[t,x]),b=(0,se().K8)((()=>(0,s().O9)(t.getConfigStore().getKeyStore("collection").getValue())),[t]),C=(0,re.useCallback)((e=>{"collection"===e.type&&(l.createAndCommit({perform:o=>{Z().zv({data:{collection:e.collection,properties:["title"],template_page_id:null,values:null},store:t.getConfigStore(),transaction:o})},userAction:"CreatePageAction.setCollection"}),(0,at().UB)(n,{automationStore:i,automationActionStore:t}))}),[l,n,i,t]),A=(0,re.useCallback)((e=>{const{properties:o,values:a}=f;let r=!1;if(e&&o&&1===o.length&&o.includes("title")){var s;const e=null==a?void 0:a.title;e&&null!==(s=e.value)&&void 0!==s&&s.value||(r=!0)}l.createAndCommit({perform:o=>{Z().zv({store:t.getConfigStore(),data:{template_page_id:e??null,...r&&{properties:[]}},transaction:o})},userAction:"CreatePageAction.onTemplateChange"}),(0,at().UB)(n,{automationStore:i,automationActionStore:t})}),[f,l,n,i,t]),k=(0,re.useMemo)((()=>!c.includes(t.id)),[c,t]),{errorMessage:j,errorIcon:M}=(0,ae().useErrorComponentForAction)({actionId:t.id,errorKeys:["collection","config",t.id],shouldShow:k}),{errorMessage:T}=(0,ae().useErrorComponentForAction)({actionId:t.id,errorKey:"template",shouldShow:k}),I=Boolean(r),w=(0,it().X)("automation_updated_error_states");return(0,Fe.jsxs)(kt().OT,{actionId:t.id,actionMenu:S,buttonPopupStore:v,canCollapse:b,disabled:I,children:[(0,Fe.jsxs)(kt().h3,{actionId:t.id,actionRegistryItem:u,disabled:I,errorMessage:w?j||T:void 0,styles:{headerWrap:{paddingRight:32},titleWrap:{display:"flex",flexWrap:"wrap",gap:4}},children:[(0,Fe.jsx)(jt,{actionStore:t,disabled:I,errorMessage:j,errorIcon:M,onChange:C,value:g}),(0,s().O9)(m)&&h&&(0,Fe.jsx)(Mt,{collectionStore:m,disabled:I,errorMessage:T,onChange:A,value:y})]}),m&&(0,Fe.jsx)(kt().qt,{disabled:I,styles:{bodyWrap:{display:"grid",gap:8,gridTemplateColumns:"1fr",minWidth:0}},children:(0,Fe.jsx)(o(95199).Ud,{actionStore:t,collectionStore:m,disabled:I,showSetPropertyActions:!1})})]})},update_pages:o(686169).w,query_collection:function(){return null},open_page:function(e){const{actionStore:t}=e,{disabled:o,maybePersistedTransactionActions:n,suppressActionErrors:i}=(0,We().b)(),r=(0,se().uB)(void 0,Xe().A),l=(0,a().getActionRegistryItem)("open_page"),s=(0,se().K8)((()=>{var e;return null===(e=t.getConfig())||void 0===e?void 0:e.target}),[t]),{contextType:c}=(0,be().EC)(),u=(0,se().K8)((()=>{if(!(0,bo().Fx)(c))return;const e=t.getIndex();return(0,bo().cQ)(e)?"allow":"disallow_with_message"}),[t,c]),d=(0,se().K8)((()=>s&&"url"!==s.type),[s]),p=(0,re.useMemo)((()=>({headerWrap:{paddingInlineEnd:32},titleWrap:{display:"inline-flex",flexWrap:"wrap",gap:"6px 0"}})),[]),m=(0,re.useCallback)((e=>{n.createAndCommit({perform:o=>{Z().zv({store:t.getConfigStore(),data:{target:e},transaction:o})},userAction:"OpenPageAction.setTarget"})}),[n,t]),g=(0,re.useCallback)((e=>{n.createAndCommit({perform:o=>{Z().zv({store:t.getConfigStore(),data:{open_in:e},transaction:o})},userAction:"OpenPageAction.setPeekMode"})}),[n,t]),h=(0,re.useCallback)((()=>r.reset()),[r]),y=(0,re.useMemo)((()=>!i.includes(t.id)),[i,t]),{errorMessage:f}=(0,ae().useErrorComponentForAction)({actionId:t.id,shouldShow:y}),v=(0,re.useMemo)((()=>(0,Fe.jsx)(st().z,{actionStore:t,closeMenu:h})),[t,h]),x=Boolean(o);return(0,Fe.jsx)(kt().OT,{actionMenu:v,buttonPopupStore:r,actionId:t.id,canCollapse:!1,children:(0,Fe.jsxs)(kt().h3,{actionId:t.id,actionRegistryItem:l,disabled:x,styles:p,children:[(0,Fe.jsx)(ko,{actionStore:t,disabled:x,errorMessage:f,onChange:m,value:s,urlBehavior:u}),d?(0,Fe.jsx)(jo,{actionStore:t,disabled:x,onChange:g}):null]})})},duplicate_blocks:function(e){const{actionStore:t}=e,{disabled:o,editorPlacement:n}=(0,We().b)(),i=(0,le().v3)(),l=(0,ce().IS)((()=>({title:{display:"inline-flex",flexWrap:"wrap",gap:6,whiteSpace:"pre-wrap"}})),[]),s=(0,se().K8)((()=>(0,r().$1)(t.getBlockPointers())),[t],{useDeepEqual:!0}),c=(0,se().K8)((()=>function(e){const t=Object.values(po).find((t=>t.key===e));return t??mo}(t.getInsertionPoint())),[t]),u=(0,re.useCallback)((e=>function(e,t,o){X().createAndCommit({userAction:"DuplicateBlocksAction.setInsertionPoint",environment:e,canUndo:!0,perform:e=>{Z().zv({store:t.getConfigStore(),data:{insertion_point:o},transaction:e})}})}(i,t,e)),[t,i]),d=(0,se().uB)(void 0,Xe().A),p=(0,re.useCallback)((()=>d.reset()),[d]),m=(0,re.useMemo)((()=>(0,Fe.jsx)(st().z,{actionStore:t,closeMenu:p})),[t,p]),g=(0,a().getActionRegistryItem)("duplicate_blocks"),h=Boolean(o);return(0,Fe.jsxs)(kt().OT,{actionMenu:m,buttonPopupStore:d,disabled:h,actionId:t.id,canCollapse:!0,children:[(0,Fe.jsx)(kt().h3,{actionId:t.id,actionRegistryItem:g,disabled:h,children:(0,Fe.jsx)("div",{style:l.title,children:(0,Fe.jsx)(F().sA,{...uo.title,values:{insertionPicker:(0,Fe.jsx)(go,{currentOption:c,disabled:h,onChange:u})}})})}),(0,Fe.jsx)(kt().qt,{disabled:h,children:s?(0,Fe.jsx)(yo,{actionStore:t,buttonPlacement:n,contentParentPointer:s,disabled:h}):null})]})},modal_confirmation:function(e){const{actionStore:t}=e,o=(0,le().v3)(),{isMobile:n}=(0,le().Y0)(),{automationStore:i}=(0,be().EC)(),r=(0,F().tz)(),{disabled:l,maybePersistedTransactionActions:s}=(0,We().b)(),c=Boolean(l),u=(0,a().getActionRegistryItem)("modal_confirmation"),[d,p]=(0,se().K8)((()=>[t.id,t.getSpaceId()]),[t]),m=(0,mt().F)({actionId:d}),g=(0,ce().IS)((e=>({wrap:{display:"flex",flexDirection:"column",gap:10},input:{backgroundColor:e.contentBackground,paddingTop:6,paddingBottom:6},inputLabel:{color:e.lightTextColor,fontSize:n?14:12,lineHeight:1.3,fontWeight:ue().Wy.medium,display:"flex",alignItems:"center"}})),[n]),h=(0,se().uB)(void 0,Xe().A),y=(0,re.useCallback)((()=>h.reset()),[h]),f=(0,re.useMemo)((()=>(0,Fe.jsx)(st().z,{actionStore:t,closeMenu:y})),[t,y]),v=(0,se().K8)((()=>t.getConfigStore().getKeyStore("text")),[t]),x=(0,se().K8)((()=>v.getValue()),[v]),S=(0,se().K8)((()=>{if(p)return(0,Vt().analyzeSimpleFormulaOrFormulaSync)({context:{handleDataRequest:(0,fo().createFormulaDataRequestSyncHandler)(t.getRecordModel),spaceId:p,valueTypes:m.slice(0),featureGates:(0,w().i)()},value:x})}),[p,t.getRecordModel,m,x]),b=(0,se().K8)((()=>t.getConfigStore().getKeyStore("continue_button").getKeyStore("text")),[t]),C=(0,se().K8)((()=>t.getConfigStore().getKeyStore("cancel_button").getKeyStore("text")),[t]),A=(0,re.useCallback)((e=>{s.createAndCommit({userAction:"BaseModalAction.handleTextChange",perform:t=>{Z().KY({store:v,value:e,transaction:t})}}),(0,at().UB)(o,{automationStore:i,automationActionStore:t})}),[t,i,o,s,v]),k=(0,re.useCallback)((()=>{(0,at().UB)(o,{automationStore:i,automationActionStore:t})}),[t,i,o]),{onTextStoreSelect:j,onTextStoreUnselect:M}=(0,Dt().W)(t);return p&&S?(0,Fe.jsxs)(kt().OT,{actionMenu:f,buttonPopupStore:h,disabled:c,actionId:t.id,canCollapse:!0,children:[(0,Fe.jsx)(kt().h3,{actionId:t.id,actionRegistryItem:u,disabled:c,styles:{headerWrap:{paddingRight:32},titleWrap:{display:"inline-flex",flexWrap:"wrap",gap:"6px 0"}},children:(0,Fe.jsx)(F().sA,{...u.display.name})}),(0,Fe.jsx)(kt().qt,{disabled:c,styles:{bodyWrap:{display:"grid",gap:8,gridTemplateColumns:"1fr",minWidth:0}},children:(0,Fe.jsxs)(Tt().Y1,{direction:"vertical",gap:16,children:[(0,Fe.jsx)(xo().M,{disabled:c,disableMobileActionBar:!0,formulaTypecheckContextValues:m,onChange:A,onTextStoreSelect:j,onTextStoreUnselect:M,parentRecordStore:t,placeholder:r.formatMessage(So.confirmationMessageLabel),rows:4,spaceId:p,value:x,analyzedFormulaOutput:S,labelMessageDescriptor:So.confirmationMessageLabel}),(0,Fe.jsxs)(Tt().Y1,{direction:"vertical",gap:6,children:[(0,Fe.jsx)("label",{style:g.inputLabel,children:(0,Fe.jsx)(F().sA,{...So.continueButtonTextLabel})}),(0,Fe.jsx)(He,{disabled:c,maxlength:vo().Vx,onChange:k,style:g.input,store:b})]}),(0,Fe.jsxs)(Tt().Y1,{direction:"vertical",gap:6,children:[(0,Fe.jsx)("label",{style:g.inputLabel,children:(0,Fe.jsx)(F().sA,{...So.cancelButtonTextLabel})}),(0,Fe.jsx)(He,{disabled:c,maxlength:vo().Vx,onChange:k,style:g.input,store:C})]})]})})]}):null},slack_notification:o(500071).y9,send_in_app_notification:function(e){var t;const{actionStore:o}=e,{isMobile:n}=(0,le().Y0)(),{automationStore:i,contextType:r}=(0,be().EC)(),{disabled:l,maybePersistedTransactionActions:c,suppressActionErrors:u}=(0,We().b)(),d=(0,en().y)(i,r),p=!(0,s().O9)(d),m=Boolean(l),g=(0,a().getActionRegistryItem)("send_in_app_notification"),h=(0,se().K8)((()=>o.getSpaceId()),[o]),y=(0,se().K8)((()=>null==d?void 0:d.getSpaceShardedPointer()),[d]),f=(0,se().K8)((()=>{if(!d)return[];return(0,bo().Ge)({collectionFormat:d.getFormat(),collectionSchema:d.getSchema(),spaceId:d.getSpaceId(),restrictCrossSpace:B().default.checkGate({gateName:"collections_xws"})})}),[d]),v=(0,se().K8)((()=>{var e;return null==o||null===(e=o.getConfig())||void 0===e?void 0:e.target}),[o]),x=(0,mt().F)({actionId:o.id}),S=(0,le().v3)();tn("formula"===(null==v?void 0:v.type)?null==v||null===(t=v.value)||void 0===t?void 0:t.value:void 0);const b=(0,se().K8)((()=>{var e;return null===(e=o.getConfig())||void 0===e?void 0:e.notification_message}),[o]),C=(0,se().K8)((()=>{if(h)return(0,Vt().analyzeSimpleFormulaOrFormulaSync)({context:{handleDataRequest:(0,fo().createFormulaDataRequestSyncHandler)(o.getRecordModel),spaceId:h,valueTypes:x.slice(0),featureGates:(0,w().i)()},value:b})}),[o.getRecordModel,b,x,h]),A=(0,se().uB)(void 0,Xe().A),k=(0,re.useCallback)((()=>A.reset()),[A]),j=(0,re.useMemo)((()=>(0,Fe.jsx)(st().z,{actionStore:o,closeMenu:k})),[o,k]),M=(0,re.useMemo)((()=>!u.includes(o.id)),[u,o]),T=(0,it().X)("automation_updated_error_states"),{errorMessages:I,errorMessageDescriptors:P}=function(e){const{actionId:t,shouldShowError:o}=e,n={},i={};n.target=(0,ae().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"target"}).errorMessage;const a=(0,ae().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"notification_message"});return n.notification_message=a.errorMessage,i.notification_message=a.errorMessageDescriptor,n.collectionPointer=(0,ae().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"collectionPointer"}).errorMessage,n.propertyId=(0,ae().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"propertyId"}).errorMessage,n.formulaValue=(0,ae().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"formulaValue"}).errorMessage,{errorMessages:n,errorMessageDescriptors:i}}({actionId:o.id,shouldShowError:M}),R=(0,se().K8)((()=>(0,s().O9)(o.getConfigStore().getKeyStore("target").getValue())),[o]),_=(0,re.useCallback)((e=>{c.createAndCommit({perform:t=>{Z().zv({data:{target:{type:e}},store:o.getConfigStore(),transaction:t})},userAction:"SendInAppNotificationAction.setTargetType"})}),[o,c]);(0,re.useEffect)((()=>{!v&&p&&_("formula")}),[v,p,_]);const V=(0,re.useCallback)((e=>{const t=e.value;if(!t)return;let n;"formula"===t.type?n={type:"formula",value:t}:"simple"===t.type?n={type:"formula",value:xi(S,t)}:(0,s().HB)(t.type),c.createAndCommit({perform:e=>{Z().zv({data:{target:{type:"formula",value:n.value}},store:o.getConfigStore(),transaction:e})},userAction:"SendInAppNotificationAction.setTarget"}),(0,at().UB)(S,{automationStore:i,automationActionStore:o})}),[i,o,S,c]),E=(0,re.useCallback)((e=>{c.createAndCommit({perform:t=>{Z().zv({data:{target:{...e,collectionPointer:y}},store:o.getConfigStore(),transaction:t})},userAction:"SendInAppNotificationAction.setTarget"}),(0,at().UB)(S,{automationStore:i,automationActionStore:o})}),[o,i,y,S,c]),F=(0,re.useCallback)((e=>{switch(e.type){case"formula":return V(e);case"property":return E(e);default:(0,s().HB)(e)}}),[V,E]),D=(0,re.useCallback)((e=>{c.createAndCommit({perform:t=>{Z().zv({data:{notification_message:e},store:o.getConfigStore(),transaction:t})},userAction:"SendInAppNotificationAction.setNotificationMessage"}),(0,at().UB)(S,{automationStore:i,automationActionStore:o})}),[o,i,S,c]),{onTextStoreSelect:L,onTextStoreUnselect:O}=(0,Dt().W)(o),K=(0,re.useCallback)((()=>{de().clear({environment:S})}),[S]);return h&&C?(0,Fe.jsxs)(kt().OT,{actionMenu:j,buttonPopupStore:A,disabled:m,actionId:o.id,canCollapse:R,children:[(0,Fe.jsx)(kt().h3,{actionId:o.id,actionRegistryItem:g,disabled:l,styles:{headerWrap:{paddingRight:32},titleWrap:{display:"flex",flexWrap:"wrap",gap:4}},children:(0,Fe.jsx)(hi,{noCollection:p,targetsErrorMessage:I.target,selectedTargetType:null==v?void 0:v.type,onTargetTypeChange:_,disabled:Boolean(l)})}),v&&(0,Fe.jsx)(kt().qt,{children:(0,Fe.jsxs)(Tt().Y1,{direction:"vertical",gap:16,children:[(0,Fe.jsxs)(Tt().Y1,{direction:"vertical",gap:6,children:[(0,Fe.jsx)(yi,{isMobile:n,selectedTargetType:v.type,isError:T&&Boolean("property"===v.type?I.propertyId:I.formulaValue)}),(0,Fe.jsx)("div",{children:(0,Fe.jsx)(vi,{collectionStore:d,disabled:Boolean(l),formulaTypecheckContextValues:x,currentTargetValue:v,currentProperties:f,onTargetValueChange:F,errorMessage:"property"===v.type?I.propertyId:I.formulaValue,parentRecordStore:o,spaceId:h})})]}),(0,Fe.jsx)(xo().M,{analyzedFormulaOutput:C,labelMessageDescriptor:gi.notificationMessageLabel,disabled:m,disableMobileActionBar:!0,disableTemplateVariableMentions:!0,errorMessageDescriptor:P.notification_message,formulaTypecheckContextValues:x,onChange:D,onTextStoreSelect:L,onTextStoreUnselect:O,onTextEsc:K,parentRecordStore:o,rows:3,spaceId:h,value:b})]})})]}):null},send_gmail_notification:function(e){const{actionStore:t}=e,o=function(e){return(0,se().K8)((()=>{const t=e.getConfigStore().getKeyStore("external_bot_id").getValue();if(!t)return;return Xo().A.externalAuthentications.state.find((e=>e.integration_id===qo().eg&&t===e.id))}),[e])}(t),n=(0,se().K8)((()=>Xo().A.externalAuthentications.state.filter((e=>e.integration_id===qo().eg))),[]);return(0,Fe.jsx)(ni,{actionStore:t,gmailAuthentications:n,currentGmailAuthentication:o,allGmailAuthentications:n})},define_variables:function(e){const{actionStore:t}=e,o=(0,le().v3)(),n=(0,F().tz)(),{automationStore:i}=(0,be().EC)(),{disabled:r,maybePersistedTransactionActions:l}=(0,We().b)(),s=Boolean(r),c=(0,a().getActionRegistryItem)("define_variables"),u=(0,se().K8)((()=>i.getActionStores()),[i]),d=(0,se().K8)((()=>{const e=t.getConfigStore().getValue();return{values:(null==e?void 0:e.values)??{},variableIds:(null==e?void 0:e.variableIds)??[]}}),[t]),p=(0,se().uB)(void 0,Xe().A),m=(0,re.useCallback)((()=>p.reset()),[p]),g=(0,re.useMemo)((()=>(0,Fe.jsx)(st().z,{actionStore:t,closeMenu:m})),[t,m]),h=(0,re.useCallback)((()=>{l.createAndCommit({perform:e=>{!function(e){const{automationActionStore:t,automationActionStores:o,intl:n,transaction:i}=e,a=(0,wt().Ay)(),r={name:(0,Pt().v)(o,n.formatMessage(It().xC)),value:{type:"simple",value:[[""]]}};Z().zv({data:{[a]:r},store:t.getConfigStore().getKeyStore("values"),transaction:i}),X().applyOperation({operation:{args:{id:a},command:"listAfter",path:["config","variableIds"],pointer:t.pointer},store:t,transaction:i})}({automationActionStore:t,automationActionStores:u,intl:n,transaction:e})},userAction:"DefineVariablesAction.addVariable"}),(0,at().UB)(o,{automationStore:i,automationActionStore:t})}),[t,u,i,o,n,l]),y=(0,ce().IS)((()=>({headerWrap:{paddingRight:32},titleWrap:{whiteSpace:"pre-wrap"},footer:{display:"flex",overflow:"hidden"}})),[]);return(0,Fe.jsxs)(kt().OT,{actionMenu:g,buttonPopupStore:p,disabled:s,actionId:t.id,canCollapse:!0,children:[(0,Fe.jsx)(kt().h3,{actionId:t.id,actionRegistryItem:c,disabled:s,styles:{headerWrap:y.headerWrap,titleWrap:y.titleWrap},children:(0,Fe.jsx)(F().sA,{...c.display.name})}),(0,Fe.jsx)(kt().qt,{disabled:s,children:(0,Fe.jsxs)(Tt().Y1,{direction:"vertical",gap:16,children:[d.variableIds.length>0&&(0,Fe.jsx)(Tt().Y1,{direction:"vertical",gap:14,children:d.variableIds.map((e=>d.values[e]?(0,Fe.jsx)(io,{actionStore:t,variableId:e},e):null))}),(0,Fe.jsx)("footer",{style:y.footer,children:(0,Fe.jsx)(_t,{disabled:s,onClick:h})})]})})]})},http_request:function(e){const{actionStore:t}=e,{disabled:n,maybePersistedTransactionActions:i,suppressActionErrors:r}=(0,We().b)(),{automationStore:s,contextType:c,typecheckResult:u}=(0,be().EC)(),d=(0,en().y)(s,c),p=Boolean(n),m=(0,a().getActionRegistryItem)("http_request"),g=Ni(),h=(0,se().uB)(void 0,Xe().A),y=(0,re.useCallback)((()=>h.reset()),[h]),f=(0,re.useMemo)((()=>(0,Fe.jsx)(st().z,{actionStore:t,closeMenu:y})),[t,y]),v=(0,se().K8)((()=>t.getConfigStore().getKeyStore("url")),[t]),x=(0,se().K8)((()=>t.getConfigStore().getKeyStore("selectedProperties")),[t]),S=(0,se().K8)((()=>x.getValue()||{type:"some",some:[]}),[x]),b=(0,re.useCallback)((e=>{i.createAndCommit({userAction:"AutomationPlainTextInput.setValue",perform:t=>{Z().KY({store:x,transaction:t,value:e})}})}),[x,i]),C=(0,ce().IS)((e=>({divider:{marginBottom:8,marginTop:8},dividerColor:{color:e.stroke.secondary},errorMessage:{color:e.text.redTertiary}})),[]),[A,k]=(0,re.useState)(!1),j=(0,re.useMemo)((()=>!r.includes(t.id)||A),[r,t.id,A]),M=(0,se().K8)((()=>{if(!l().Q.isSuccess(u)||!j)return!1;return(u.value.actionValidationFailures[t.id]||[]).some((e=>"invalid_url"===e.type))}),[u,t,j]),T=(0,ae().useRequiresSubscriptionUpgradeError)({actionId:t.id,shouldShow:j}),I=Boolean(T),w=(0,re.useCallback)((()=>{k(!0)}),[]);return(0,Fe.jsxs)(kt().OT,{actionMenu:f,buttonPopupStore:h,disabled:p,actionId:t.id,canCollapse:!I,hideDragHandle:I,children:[(0,Fe.jsx)(kt().h3,{actionId:t.id,actionRegistryItem:m,disabled:p,errorMessage:T,styles:{headerWrap:{paddingRight:32},titleWrap:{display:"inline-flex",flexWrap:"wrap",gap:"6px 0"}},children:(0,Fe.jsx)(F().sA,{...m.display.name})}),(0,Fe.jsxs)(kt().qt,{disabled:p,styles:{bodyWrap:{display:"grid",gap:4,gridTemplateColumns:"1fr",minWidth:0}},children:[(0,Fe.jsx)("label",{style:g.inputLabel,children:(0,Fe.jsxs)(bi().Ye,{alignItems:"center",gap:4,children:[(0,Fe.jsx)(F().sA,{...Ki.urlInputLabel}),(0,Fe.jsx)(wi,{})]})}),(0,Fe.jsx)(He,{disabled:p,style:g.input,store:v,errorOutline:M,onBlur:w,maxlength:Si().i8}),M&&(0,Fe.jsx)("div",{style:C.errorMessage,children:(0,Fe.jsx)(F().sA,{id:"SendWebhookAction.invalidUrl",defaultMessage:"Invalid URL"})}),(0,Fe.jsx)(ki,{actionStore:t}),d&&(0,Fe.jsxs)(Fe.Fragment,{children:[(0,Fe.jsx)(o(802790).A,{size:1,style:C.divider,dividerColor:C.dividerColor.color}),(0,Fe.jsx)(Fi,{collectionStore:d,value:S,onChange:b})]})]})]})},publish_site:function(e){const{actionStore:t}=e,{disabled:o,maybePersistedTransactionActions:n,suppressActionErrors:i}=(0,We().b)(),r=(0,se().K8)((()=>{var e;return null===(e=t.getConfig())||void 0===e?void 0:e.target}),[t]),l=Boolean(o),s=(0,a().getActionRegistryItem)("publish_site"),c=(0,se().uB)(void 0,Xe().A),u=(0,re.useCallback)((e=>{"url"!==e.type&&n.createAndCommit({perform:o=>{Z().zv({store:t.getConfigStore(),data:{target:e},transaction:o})},userAction:"PublishSiteAction.setTarget"})}),[n,t]),d=(0,re.useCallback)((()=>c.reset()),[c]),p=(0,re.useMemo)((()=>!i.includes(t.id)),[i,t]),{errorMessage:m}=(0,ae().useErrorComponentForAction)({actionId:t.id,shouldShow:p}),g=(0,re.useMemo)((()=>(0,Fe.jsx)(st().z,{actionStore:t,closeMenu:d})),[t,d]);return(0,Fe.jsxs)(kt().OT,{actionMenu:g,buttonPopupStore:c,disabled:l,actionId:t.id,canCollapse:!0,children:[(0,Fe.jsx)(kt().h3,{actionId:t.id,actionRegistryItem:s,disabled:l,styles:{headerWrap:{paddingRight:32},titleWrap:{display:"flex",flexWrap:"wrap",gap:4}},children:(0,Fe.jsx)(Do,{actionStore:t,disabled:l,errorMessage:m,onTargetChange:u,value:r})}),(0,Fe.jsxs)(kt().qt,{disabled:l,styles:{sectionBodyWrap:{display:"grid",gap:4,gridTemplateColumns:"1fr",minWidth:0}},children:[(0,Fe.jsx)(Lo,{}),(0,Fe.jsx)(Oo,{})]})]})}};var zi=()=>o(142755);function Hi(e){const{children:t}=e,{isMobile:o}=(0,le().Y0)(),n=(0,ce().IS)((e=>({wrap:{color:e.lightTextColor,fontSize:o?14:12,lineHeight:1.3,fontWeight:ue().Wy.medium}})),[o]);return(0,Fe.jsx)("div",{style:n.wrap,children:t})}const Ui=(0,F().YK)({newActionLabel:{defaultMessage:"New action",id:"AutomationActionSelectButton.actionSection.newAction"},addActionLabel:{defaultMessage:"Add action",id:"AutomationActionSelectButton.actionSection.addAction"},addActionAriaLabel:{id:"collectionSettings.editAutomationView.addAction.iconButton",defaultMessage:"Add action"},builderModalActionTitle:{defaultMessage:"Do",id:"builderModal.editAutomationView.actionSection.title"}});function Yi(e){let{isEditable:t}=e;const{automationStore:o}=(0,be().EC)(),{disabled:n}=(0,We().b)(),i=(0,tt().V)(),{contextType:a}=(0,be().EC)(),r="button_block"===a||"button_property"===a,l=(0,se().K8)((()=>o.getActionStores().map((e=>e.isDefined()&&e.hasConcern("display")?e:null)).filter(s().Pe)),[o]),c=l.length>0,u=(0,ce().IS)((e=>({section:{display:"flex",flexDirection:"column",gap:4,width:"100%",...r&&{marginTop:20}},header:{alignItems:"center",display:"flex",flexDirection:"row",height:24},headerAdd:{marginLeft:"auto",flexGrow:0,flexShrink:0},list:{display:"flex",flexDirection:"column"}})),[r]),d=!n&&t&&i.length>0;return(0,Fe.jsxs)("section",{style:u.section,children:[(0,Fe.jsx)("header",{style:u.header,children:(0,Fe.jsx)(Hi,{children:(0,Fe.jsx)(F().sA,{...Ui.builderModalActionTitle})})}),(0,Fe.jsxs)("div",{style:u.list,children:[t?(0,Fe.jsx)(qi,{actionStores:l}):(0,Fe.jsx)(Gi,{actionStores:l}),d&&(0,Fe.jsx)("footer",{children:(0,Fe.jsx)(Qi,{disabled:n,hasAnyActions:c,variant:"button"})})]})]})}function Gi(e){let{actionStores:t}=e;const o=(0,Ye().vV)();return(0,Fe.jsx)("div",{style:o.wrap,children:(0,Fe.jsx)("div",{style:o.list,children:t.map((e=>(0,Fe.jsx)("div",{className:Ye().xB,children:(0,Fe.jsx)($i,{actionStore:e})},e.id)))})})}function qi(e){let{actionStores:t}=e;const o=(0,le().v3)(),{automationStore:n,contextType:a}=(0,be().EC)(),{disabled:r,onActionDragStart:l,onActionDragEnd:c,maybePersistedTransactionActions:u}=(0,We().b)(),d=(0,F().tz)(),{value:p}=(0,Je().fJ)(T().T.formulas),{value:m}=(0,Je().fJ)(qe().QV.automationTypecheck),{automationActionMap:g,actionStoreIds:h}=(0,se().K8)((()=>{const e=[],t=new Map;return n.getActionStores().forEach((o=>{o.isDefined()&&o.hasConcern("display")&&(e.push(o.id),t.set(o.id,o))})),{automationActionMap:t,actionStoreIds:e}}),[n]),y=(0,se().uB)(void 0,et().A),f=(0,re.useCallback)((e=>{const t=e.state;if(t.willDrag){const e=g.get(t.draggingKey);(0,s().O9)(e)&&(0,s().O9)(l)&&l(e)}else t.willDrag||t.isDragging||null==c||c()}),[g,c,l]);(0,re.useEffect)((()=>(y.addListener(f),()=>y.removeListener(f))),[g,y,f]);const v=(0,re.useCallback)(((e,t)=>{p&&m&&u.createAndCommit({userAction:"AutomationButtonAction.moveAction",perform:r=>{i().reorderAutomationActions({environment:o,automationStore:n,automationTypecheckModule:m,contextType:a,formulasModule:p,intl:d,newActionIds:e,transaction:r,from:"drag_and_drop",movedActionId:t.key})}})}),[n,a,m,p,d,u,o]),x=(0,re.useMemo)((()=>!r&&t.length>1),[r,t]),S=(0,re.useCallback)(((e,t)=>{const o=g.get(e);return(0,s().O9)(o)?(0,Fe.jsx)($i,{actionStore:o},o.id):null}),[g]);return t.length>0?(0,Fe.jsx)(Zi,{draggableListStore:y,hasDragging:x,keys:h,onDrop:v,renderKey:S}):null}function $i(e){const{actionStore:t}=e,o=(0,se().K8)((()=>t.getType()),[t]);if(!o)return null;const n=Wi[o];return(0,Fe.jsx)(n,{actionStore:t})}function Zi(e){const{draggableListStore:t,hasDragging:o,keys:n,onDrop:i,renderKey:a}=e,{isMobile:r}=(0,le().Y0)(),l=(0,Ye().vV)();return(0,Fe.jsx)("div",{style:l.wrap,children:(0,Fe.jsx)(Qe().Ay,{childClassName:Ye().xB,direction:"vertical",disabled:!o||r,keys:n,onDrop:i,renderKey:a,store:t,style:l.list})})}function Qi(e){const{disabled:t,hasAnyActions:o,variant:n}=e,{isMobile:i}=(0,le().Y0)(),a=(0,je().j)(),r=(0,F().tz)(),l=(0,re.useMemo)((()=>({availableActions:[],hasUpdateThisPagePropertyActions:!0,hasSearch:!0,type:"eventActions"})),[]),s=(0,se().uB)(void 0,Xe().A),c=(0,re.useCallback)((()=>s.reset()),[s]),u=(0,ce().IS)((e=>({buttonWrap:{boxShadow:"initial",background:"transparent"},button:{color:e.mediumTextColor,fill:e.mediumIconColor,margin:0,width:"100%"},buttonIcon:{height:i?18:16,width:24}})),[i]),d=Boolean(t);return(0,Fe.jsx)(Ze().Ay,{alignmentToOrigin:Ze().yP.Start,buttonPopupStore:s,disabled:d,placementToOrigin:Ze().sx.Bottom,popupType:a,render:()=>(0,Fe.jsx)(ot().A,{initialState:l,onClose:c}),renderOrigin:e=>"icon"===n?(0,Fe.jsx)(Be().A,{...e,ariaLabel:r.formatMessage(Ui.addActionAriaLabel),disabled:d,disabledFeedback:d,icon:Ge().b}):"button"===n?(0,Fe.jsx)(zi().F,{...e,ariaLabel:r.formatMessage(Ui.addActionAriaLabel),disabled:d,icon:(0,Ge().b)({height:16,width:16}),title:(0,Fe.jsx)(F().sA,{...o?Ui.addActionLabel:Ui.newActionLabel})}):(0,Fe.jsx)($e().A,{...e,buttonStyle:u.button,disabled:d,disabledFeedback:d,focused:!1,icon:(0,Ge().b)(u.buttonIcon),style:u.buttonWrap,title:o?(0,Fe.jsx)(F().sA,{id:"automations.addActionButton.nonEmpty.label",defaultMessage:"Add another step"}):(0,Fe.jsx)(F().sA,{id:"automations.addActionButton.empty.label",defaultMessage:"Add a step"})})})}function Ji(e){const{areActionsEditable:t,areTriggersEditable:o,footer:n}=e,{isMobile:i}=(0,le().Y0)(),a=(0,ce().IS)((e=>({verticalRule:{background:e.stroke.primary,borderRadius:2,height:56,marginBottom:5,marginLeft:0,marginTop:16,width:2},container:{alignItems:"center",display:"flex",flexDirection:"column",justifyContent:"center",padding:i?"0 16px":void 0}})),[i]);return(0,Fe.jsxs)("div",{style:a.container,children:[(0,Fe.jsx)(Ye().Kn,{isEditable:o}),(0,Fe.jsx)("div",{style:a.verticalRule}),(0,Fe.jsx)(Yi,{isEditable:t}),n]})}const Xi=(0,F().YK)({editButtonAriaLabel:{defaultMessage:"Edit button",id:"buttonBlock.button.editButtonAriaLabel"},buttonPlaceholder:{defaultMessage:"New button",id:"buttonBlock.button.placeholder"},buttonInsufficientPermissions:{defaultMessage:"You don’t have permission to run this button",id:"buttonBlock.button.insufficientPermissions"},clickToEdit:{defaultMessage:"Click to edit button",id:"buttonBlock.button.clickToEdit"},done:{defaultMessage:"Done",id:"buttonBlock.button.done"},noEditError:{defaultMessage:"You don't have full access to edit this button",id:"buttonBlock.button.noEditError"}});function ea(e){var t,o,n;const{buttonBlockStore:i}=e,a=(0,se().K8)((()=>i.state.editing?i.state:void 0),[i]),r=(0,ce().IS)((e=>{var t;return{popup:{width:400},editor:{background:e.contentBackground,..."inline"===(null==a||null===(t=a.placement)||void 0===t?void 0:t.type)?{marginTop:6,borderRadius:6,border:`1px solid ${e.regularDividerColor}`,maxWidth:600}:{}}}}),[null==a||null===(t=a.placement)||void 0===t?void 0:t.type]),l=(0,je().j)({tabletBehavior:"slideUp"});return a&&a.placement?"popup"===(null===(o=a.placement)||void 0===o?void 0:o.type)?(0,Fe.jsx)(ge().Ay,{open:!0,popupType:l,render:()=>(0,Fe.jsx)(ta,{...e,style:r.editor}),originRect:a.placement.originRect,style:r.popup,originGap:4,onDismiss:()=>{i.stopEditing()}}):"inline"===(null===(n=a.placement)||void 0===n?void 0:n.type)?(0,Fe.jsx)(ta,{...e,style:r.editor}):void(0,s().HB)(a.placement):null}function ta(e){const{disabled:t,store:o,buttonBlockStore:n}=e,i=(0,le().v3)(),[a,r]=(0,ve().z)(),l=(0,ce().IS)((e=>({scroller:{maxHeight:"75vh"},factoryButtonDeprecationBanner:{margin:"12px 12px 6px 12px"},container:{fontFamily:ue().Tf.sans},footerButton:{height:32,width:"100%"},upgradeMessageWrap:{margin:8},footerButtonWrap:{width:"100%",display:"flex",flexDirection:"column",paddingTop:24}})),[]),s=(0,se().K8)((()=>o.getAutomationStore()),[o]),c=(0,se().K8)((()=>null==s?void 0:s.getSpaceId()),[s]),{maybePersistedAutomationStore:u,maybePersistedTransactionActions:d}=(0,Te().t)({automationId:null==s?void 0:s.id,spaceId:c,defaultValue:void 0,persist:!0}),p=(0,Me().OW)({store:o,automationStore:u}),m=(0,se().K8)((()=>{var e;return o.canEdit()&&"sufficient"===(null==p||null===(e=p.state)||void 0===e?void 0:e.editPermissionStatus)}),[o,p]),g=(0,se().K8)((()=>n.state.editing?n.state.placement:void 0),[n]),h=(0,re.useCallback)((e=>{(0,fe().SQ)({event:e,context:fe().y$.EditorClick,callback:()=>{de().clear({environment:i}),J().IU({environment:i})}})}),[i]),y=(0,re.useCallback)((()=>{n.stopEditing(),(0,I().u4)({environment:i,event:{eventName:"click_configure_button_done",eventProperties:{block_id:o.id,automation_id:null==u?void 0:u.id}}}),B().default.logEvent("click_configure_button_done")}),[n,i,o,u]),f=(0,se().K8)((()=>n.state.suppressErrorsForActionIds),[n]),v=(0,re.useCallback)((e=>n.suppressErrorsForAction(e.id)),[n]),x=(0,re.useCallback)((()=>{Se().K(i,{from:"button_block_automation_header_message",upsell:{type:"product",product:"plus",limit:{type:"none"}}})}),[i]),S=(0,ke().c)(),b=t||!m,C=(0,se().K8)((()=>{var e;return!(null==p||null===(e=p.state)||void 0===e||!e.typecheckResult)&&(0,Ae().h)({environment:i,typecheckResult:p.state.typecheckResult,automationStore:u})}),[p,i,u]);return u?(0,Fe.jsx)("div",{ref:a,style:{...l.container,...e.style},onClick:h,children:(0,Fe.jsx)(be().u,{automationStore:u,contextType:"button_block",children:(0,Fe.jsxs)(Ce().v,{value:{disabled:b,editorPlacement:g,editorWidth:r,maybePersistedTransactionActions:d,onActionAdded:v,suppressActionErrors:f,hideDragHandle:C,...S},defaultCollapseActions:C,children:[(0,Fe.jsx)(oa,{blockStore:o,disabled:b}),(0,Fe.jsxs)(ye().H,{style:l.scroller,type:xe().A.Y,children:[C&&(0,Fe.jsx)("div",{style:l.upgradeMessageWrap,children:(0,Fe.jsx)(Ue().j,{onUpsellClick:x})}),!m&&(0,Fe.jsx)("div",{style:l.upgradeMessageWrap,children:(0,Fe.jsx)(Ie().z,{children:(0,Fe.jsx)(F().sA,{...Xi.noEditError})})}),(0,Fe.jsx)("section",{style:{paddingBlock:8,paddingInline:8},children:(0,Fe.jsx)(Ji,{areActionsEditable:!C,areTriggersEditable:!1,footer:(0,Fe.jsx)("div",{style:l.footerButtonWrap,children:(0,Fe.jsx)(he().A,{onClick:y,style:l.footerButton,children:(0,Fe.jsx)(F().sA,{...Xi.done})})})})})]})]})})}):null}function oa(e){const{blockStore:t,disabled:o}=e,{automationStore:n}=(0,be().EC)(),i=(0,le().v3)(),a=(0,ce().IS)((e=>({wrap:{display:"flex",flexDirection:"column",padding:12,gap:6},inputs:{display:"flex",alignItems:"center",gap:6,borderBottom:`1px solid ${e.stroke.secondary}`,paddingBottom:12},nameInputWrap:{flexGrow:"1"},nameInput:{background:"transparent",boxShadow:"none",padding:4}})),[]),r=(0,se().K8)((()=>n.getNameStore()),[n]),l=(0,se().K8)((()=>n.getIconStore()),[n]),s=(0,se().K8)((()=>(null==r?void 0:r.getValue())??""),[r]),c=(0,se().K8)((()=>null==l?void 0:l.getValue()),[l]),u=(0,re.useCallback)(((e,t)=>{X().createAndCommit({userAction:"ButtonBlock.updateProperty",environment:i,canUndo:!0,perform:o=>{Z().zv({store:n.getPropertiesStore(),transaction:o,data:{[e]:t??null}})}})}),[n,i]),d=(0,re.useCallback)((e=>u("icon",e)),[u]),p=(0,re.useCallback)((e=>u("name",e)),[u]);return(0,Fe.jsx)(pe().s,{allowSelectionWithin:!0,style:a.wrap,children:(0,Fe.jsxs)("div",{style:a.inputs,children:[(0,Fe.jsx)(Le,{disabled:o,currentIcon:c,handleIconChange:d,store:t}),(0,Fe.jsx)(ze,{onChange:p,value:s,disabled:o,placeholder:P().A.formatMessage(Xi.buttonPlaceholder),wrapStyle:a.nameInputWrap,style:a.nameInput,format:me().C.ExtraLarge,autoFocus:!s})]})})}var na=()=>o(591779),ia=()=>o(728611),aa=(o(16280),()=>o(495408)),ra=()=>o(881254);function la(e){var t;const{url:o,parentStore:n,onMouseEnter:i,onMouseLeave:a}=e,r=(0,le().v3)(),[l]=(0,cn().Yb)((async()=>{var e,t;const n=await $().callApi({eventName:"getDataForLinkMention",environment:r,data:{url:o,spaceId:(null===(e=te().default.state.currentSpaceStore)||void 0===e?void 0:e.id)??(null===(t=te().default.state.mainEditorCurrentBlockStore)||void 0===t?void 0:t.getSpaceId()),source:"button_hover"}});if("success"===n.type){if("error"in n.data)throw new Error(`Error in iframely response: ${n.data.status} ${n.data.error}`);return n.data}throw n.error}),[r,o]);let s;return s=null!==(t=l.value)&&void 0!==t&&t.iframe?(0,Fe.jsx)(aa().p,{hoverData:l.value,iframe_url:l.value.iframe,height:l.value.height,padding:l.value.padding,padding_top:l.value.padding_top,store:n,href:o,showEditButton:!1}):(0,Fe.jsx)(ra().R,{hoverData:l.value,href:o,showEditButton:!1,store:n,loading:"pending"===l.status}),(0,Fe.jsx)("div",{onMouseEnter:i,onMouseLeave:a,children:s})}function sa(e){const{renderOrigin:t}=e;return(0,le().Y0)().isMobile?(0,Fe.jsx)(Fe.Fragment,{children:t()}):(0,Fe.jsx)(ca,{...e})}function ca(e){const{renderOrigin:t,urlToPreview:o,parentStore:n}=e,[i,a]=(0,re.useState)(!1),l=(0,re.useMemo)((()=>({onMouseEnter:()=>{a(!0)},onMouseLeave:()=>{a(!1)}})),[]),s=function(e){const{targetHovered:t}=e,[o,n]=(0,re.useState)(!1),i=(0,na().lW)(t,400,Object.is),[a,l]=(0,re.useState)(!1),s=a||!o&&i,c=(0,re.useCallback)((()=>l(s)),[s]),u=(0,re.useCallback)((()=>{l(!1)}),[]),d=(0,re.useCallback)((()=>{u(),n(!0)}),[u]);return(0,re.useEffect)((()=>{n(!1)}),[i]),(0,re.useEffect)((()=>{const e=r().nF((()=>{d()}),200,{leading:!0});return ia().P4(window,"scroll",e,!0),()=>ia().Ol(window,"scroll",e,!0)}),[d]),{state:s,pinPopup:c,unpinPopup:u}}({targetHovered:i});return(0,Fe.jsx)(ge().Ay,{disableMouseCapture:!0,preventCaptureEsc:!0,preventScaleTransition:!0,originGap:6,preventOpacityTransition:!0,open:s.state,popupType:ge().nl.Popup,alignmentToOrigin:Kt().C.Start,placementToOrigin:Kt().W.Bottom,render:()=>(0,Fe.jsx)(la,{url:o,parentStore:n,onMouseEnter:s.pinPopup,onMouseLeave:s.unpinPopup}),origin:t(l)})}},80524:(e,t,o)=>{o.r(t),o.d(t,{AutomationBuilderModal:()=>at,ButtonBuilderModal:()=>ft});o(944114),o(898992),o(354520),o(737550);var n=o(296540),i=()=>o(484714),a=()=>o(56366),r=()=>o(401497),l=()=>o(422540),s=()=>o(278132),c=()=>o(66913),u=()=>o(912720),d=()=>o(959013),p=()=>o(496603),m=()=>o(973647),g=()=>o(534177),h=()=>o(284371),y=()=>o(686526),f=()=>o(436572),v=()=>o(813297),x=()=>o(735695),S=()=>o(704152),b=()=>o(939740),C=()=>o(864943),A=()=>o(204063),k=()=>o(89924),j=()=>o(898125),M=()=>o(584262),T=()=>o(101209),I=()=>o(735384),w=()=>o(693954),P=()=>o(792071),B=()=>o(142748),R=()=>o(179034),_=()=>o(824862),V=()=>o(519831),E=()=>o(96689),F=()=>o(867201),D=()=>o(837570),L=()=>o(774256),O=()=>o(826352),K=()=>o(546461),N=()=>o(493823),W=()=>o(719147),z=()=>o(862292),H=()=>o(989423),U=()=>o(157857),Y=()=>o(731320),G=()=>o(645873),q=()=>o(630116),$=()=>o(991249),Z=o(474848);const Q=(0,d().YK)({automationIncompatibleViewFilterAndOwner:{defaultMessage:"This automation may not work because the view has a non-supported filter",id:"AutomationHeaderView.incompatibleCollectionViewFilter.owner"},automationPublicAccess:{defaultMessage:"This automation is part of a public page",id:"AutomationHeaderView.automationPublicAccess"},automationUpgrade:{defaultMessage:"<anchor-upsell>Upgrade</anchor-upsell> to edit this automation or create your own",id:"AutomationHeaderView.automationUpgrade"},automationEditOnSite:{defaultMessage:"This automation can only be edited on notion.com",id:"AutomationHeaderView.automationEditOnSite"},automationExternalBotNoPermissions:{defaultMessage:"Ask {user} to edit this automation",id:"AutomationHeaderView.automationExternalBotNoPermissions"},automationExternalBotWithPermissions:{defaultMessage:"Ask {user} to edit this automation or <anchor-delete>delete</anchor-delete> it when necessary",id:"AutomationHeaderView.automationExternalBotWithPermissions"},automationMissingPermissionsNoPermissionsForDatabase:{defaultMessage:"You must have full access to target databases in this automation to edit it",id:"AutomationHeaderView.automationMissingPermissionsNoPermissionsForDatabase"},automationGenericFullAccess:{defaultMessage:"You must have full access to this database to edit automations",id:"AutomationHeaderView.automationGenericFullAccess"},automationCollectionInTrashedPage:{defaultMessage:"This database is in the trash and cannot be edited.",id:"AutomationHeaderView.automationCollectionInTrash"},automationCollectionInTrashedPageViewDeletedPageButton:{defaultMessage:"View deleted page",id:"AutomationHeaderView.automationCollectionInTrashedPageViewDeletedPageButton"},automationMissingActionFeature:{defaultMessage:"The {actionName} action is not available in your workspace",id:"AutomationHeaderView.automationMissingActionFeature"},mustBeWorkspaceMember:{defaultMessage:"You must be a workspace member to edit automations",id:"AutomationHeaderView.mustBeWorkspaceMember"}});function J(e){const{automationPermissionScope:t,collectionStore:o,collectionSettingsStore:r,onDelete:l,referencesIncompatibleCollectionViewFilter:s,requiresSubscriptionUpgrade:c}=e,u=(0,i().v3)(),{automationStore:p,contextType:m}=(0,K().EC)(),h=(0,d().tz)(),{value:y}=(0,G().fJ)(z().T.formulas),{value:f}=(0,G().fJ)(v().QV.automationActionRegistry),{value:x}=(0,G().fJ)(v().QV.automationTypecheck),S=(0,a().K8)((()=>Boolean((0,Y().qb)(u,p))),[p,u]),b=(0,a().K8)((()=>(0,U().sl)({environment:u,automationStore:p,automationActionRegistryModule:f,automationTypecheckModule:x,contextType:m,formulasModule:y,intl:h})),[u,p,f,x,m,y,h]),C=(0,a().K8)((()=>{const e=(0,B().O)({recordPointer:o.pointer,getRecordModel:o.getRecordModel});if(!e||e.table!==R().ev)return;const t=e.pointer;return q().Bv.createChildStore(o,t)}),[o]),A=(0,n.useCallback)((()=>{$().K(u,{from:"database_automation_settings_header_message",upsell:{type:"product",product:"plus",limit:{type:"none"}}})}),[u]),k=oe();if(c)return(0,Z.jsx)(O().j,{onUpsellClick:A});if(C)return(0,Z.jsx)(te,{icon:(0,Z.jsx)("div",{style:k.lockedIconWrap,children:(0,I().I)(k.lockedIcon)}),children:(0,Z.jsxs)("div",{children:[(0,Z.jsx)("p",{style:k.paragraph,children:(0,Z.jsx)(d().sA,{...Q.automationCollectionInTrashedPage})}),(0,Z.jsx)(N().p,{onClick:()=>{!function(e,t){(function(e){(0,H().vd)(e,"view_deleted_page_from_automation_edit_menu")})(t),F().Y({environment:t,store:e,pageVisitSource:M().y8.LinkInPage})}(C,u),D().V({environment:u,collectionSettingsStore:r})},style:k.restoreButton,isLightGray:!0,children:(0,Z.jsx)(d().sA,{...Q.automationCollectionInTrashedPageViewDeletedPageButton})})]})});if(S)return(0,Z.jsx)(L().z,{children:(0,Z.jsx)(d().sA,{...Q.automationPublicAccess})});if("insufficient"===b.editPermissionStatus){if("free_workspace"===b.reason)return(0,U().ip)({contextType:m,environment:u})?(0,Z.jsx)(ee,{icon:(0,Z.jsx)("div",{style:k.boltIconWrap,children:(0,T().v)(k.boltIcon)}),children:(0,Z.jsx)("p",{style:k.paragraph,children:(0,Z.jsx)(d().sA,{...Q.automationUpgrade,values:{"anchor-upsell":e=>(0,Z.jsx)(W().A,{onClick:A,style:k.link,children:e})}})})}):(0,Z.jsx)(L().z,{children:(0,Z.jsx)(d().sA,{...Q.automationEditOnSite})});if("feature_not_enabled"===b.reason)return(0,Z.jsx)(L().z,{children:(0,Z.jsx)(d().sA,{...Q.automationMissingActionFeature,values:{actionName:b.actionName.toLocaleLowerCase()}})});var j,P,J;if("missing_permissions"===b.reason)return(null===(j=b.relatedPointer)||void 0===j?void 0:j.table)===_().GP?(0,Z.jsx)(X,{botId:b.relatedPointer.id,automationPermissionScope:t,onDelete:l,automationStore:p}):(null===(P=b.relatedPointer)||void 0===P?void 0:P.table)===V().Vl&&b.relatedPointer.id!==o.id?(0,Z.jsx)(L().z,{children:(0,Z.jsx)(d().sA,{...Q.automationMissingPermissionsNoPermissionsForDatabase})}):(null===(J=b.relatedPointer)||void 0===J?void 0:J.table)===E().NX?(0,Z.jsx)(L().z,{children:(0,Z.jsx)(d().sA,{...Q.mustBeWorkspaceMember})}):(0,Z.jsx)(L().z,{children:(0,Z.jsx)(d().sA,{...Q.automationGenericFullAccess})});(0,g().HB)(b)}else{if("unknown"===b.editPermissionStatus)return(0,Z.jsx)(L().z,{children:(0,Z.jsx)(d().sA,{...Q.automationGenericFullAccess})});if("sufficient"===b.editPermissionStatus)return s?(0,Z.jsx)(L().z,{icon:(0,w().Q)(k.warningIcon),children:(0,Z.jsx)(d().sA,{...Q.automationIncompatibleViewFilterAndOwner})}):null;(0,g().HB)(b)}}function X(e){const{botId:t,automationPermissionScope:o,onDelete:n,automationStore:i}=e,r=(0,d().tz)(),l=oe(),s=(0,a().K8)((()=>{const e=q().vK.createChildStore(i,{id:t,spaceId:i.getSpaceId(),table:_().GP}).getCreatedByStore();return e?e.getDisplayName(r):r.formatMessage(P().Fvx.messages.anonymousPlaceholder)}),[i,t,r]);return(0,Z.jsx)(L().z,{children:(0,Z.jsx)(d().sA,{..."readonly"===o?Q.automationExternalBotNoPermissions:Q.automationExternalBotWithPermissions,values:{"anchor-delete":e=>(0,Z.jsx)(W().A,{onClick:n,style:l.link,children:e}),user:s}})})}function ee(e){const{children:t,icon:o}=e,n=oe();return(0,Z.jsx)("div",{style:n.wrapWrap,children:(0,Z.jsxs)("div",{style:n.upsellWrap,children:[o&&(0,Z.jsx)("div",{style:n.iconWrap,children:o}),(0,Z.jsx)("div",{style:n.messageWrap,children:t})]})})}function te(e){const{children:t,icon:o}=e,n=oe();return(0,Z.jsx)("div",{style:n.wrapWrap,children:(0,Z.jsxs)("div",{style:n.trashPageWrap,children:[o&&(0,Z.jsx)("div",{style:n.iconWrap,children:o}),(0,Z.jsx)("div",{style:n.messageWrap,children:t})]})})}function oe(){const{isMobile:e}=(0,i().Y0)();return(0,r().IS)((t=>({boltIcon:{fill:t.icon.yellowPrimary,height:"100%",width:"100%"},boltIconWrap:{height:20,padding:2,width:20},icon:{},iconWrap:{flexGrow:0,flexShrink:0},lockedIcon:{fill:t.icon.secondary,height:"100%",width:"100%"},lockedIconWrap:{background:t.fill.lightGraySecondary,borderRadius:4,height:20,padding:2,width:20},link:{color:t.text.uiBluePrimary},messageWrap:{flexGrow:1},paragraph:{color:t.text.secondary,fontSize:e?14:12,margin:0},restoreButton:{fontSize:e?14:12,fontWeight:h().Wy.medium,marginLeft:-8},warningIcon:{color:t.accentColors.orange[400],height:"100%",width:"100%"},warningIconWrap:{height:20,padding:2,width:20},wrap:{alignItems:"start",display:"flex",flexDirection:"row",gap:10},wrapWrap:{padding:e?"0 12px 12px":"0 0 6px 0"},upsellWrap:{alignItems:"center",background:t.accentColors.yellow[50],border:`1px solid ${t.accentColors.yellow[100]}`,borderRadius:6,display:"flex",flexDirection:"row",gap:10,padding:8},trashPageWrap:{alignItems:"start",display:"flex",flexDirection:"row",gap:10,background:t.accentColors.gray[30],padding:8,borderRadius:6},personBadgeQuestionMark:{fill:t.mediumIconColor,width:16,height:"auto"},personBadgeQuestionMarkWrap:{height:20,padding:2,width:20}})),[e])}var ne=()=>o(366360),ie=()=>o(946548),ae=()=>o(859428),re=()=>o(115512);const le=(0,d().YK)({automationEnabledLabel:{defaultMessage:"Active",id:"collectionSettings.editAutomationView.automationEnabledLabel"},automationEnabledHiddenAriaLabel:{defaultMessage:"Automation is active.",id:"collectionSettings.editAutomationView.automationEnabledHiddenAriaLabel"},automationPausedHiddenAriaLabel:{defaultMessage:"Automation is paused.",id:"collectionSettings.editAutomationView.automationPausedHiddenAriaLabel"},automationDisabledTooltip:{defaultMessage:"Ask {user} to resume this automation.",id:"collectionSettings.editAutomationView.automationDisabledTooltip"},automationErrorsDisabledTooltip:{defaultMessage:"Fix any errors or remove failing steps to enable this automation",id:"collectionSettings.editAutomationView.automationErrorsDisabledTooltip"}});function se(e){const{automationId:t,automationOwner:o,disabled:a,isAutomationPaused:l,onPause:s,onResume:c}=e,{cantSaveDueToError:u}=(0,ne().b)(),{isMobile:p}=(0,i().Y0)(),m=`toggle-${t}`,g=(0,n.useCallback)((()=>{l?null==c||c():null==s||s()}),[l,c,s]),y=(0,r().IS)((e=>({labelWrap:{color:a?e.text.tertiary:e.text.secondary,flex:"1 1 auto",fontSize:p?h().J.UIRegular.mobile:h().J.UIRegular.desktop},sectionWrap:{alignItems:"start",display:"flex",flexDirection:"row",gap:6,marginBlockEnd:0},toggleWrap:{flex:"0 0 auto",paddingBlockStart:p?5:2}})),[a,p]),f=le.automationEnabledLabel,v=l?le.automationPausedHiddenAriaLabel:le.automationEnabledHiddenAriaLabel;return(0,Z.jsxs)("section",{style:y.sectionWrap,children:[(0,Z.jsx)("div",{style:y.toggleWrap,children:(0,Z.jsx)(ae().A,{disableTooltip:!a||!l,renderTooltip:()=>u?(0,Z.jsx)(d().sA,{...le.automationErrorsDisabledTooltip}):(0,Z.jsx)(d().sA,{...le.automationDisabledTooltip,values:{user:o}}),render:e=>(0,Z.jsx)("div",{...e,children:(0,Z.jsx)(ie().A,{disabled:a,inputId:m,on:!l,onClick:g})})})}),(0,Z.jsx)("div",{style:y.labelWrap,children:(0,Z.jsxs)("label",{htmlFor:m,children:[(0,Z.jsx)("span",{"aria-hidden":!0,children:(0,Z.jsx)(d().sA,{...f})}),(0,Z.jsx)("span",{style:re().Qg,children:(0,Z.jsx)(d().sA,{...v})})]})})]})}var ce=()=>o(508496);var ue=()=>o(253579);function de(e){const{shouldInvokeHandler:t,isMobile:o,onClick:i}=e;(0,n.useEffect)((()=>{async function e(e){const o=e.target instanceof Element&&((0,ue().pM)(e.target)||(0,ue().m5)(e.target));e.eventPhase===Event.CAPTURING_PHASE&&t&&o&&(e.stopPropagation(),e.preventDefault(),await i())}if(!o)return window.addEventListener("click",e,{capture:!0}),()=>{window.removeEventListener("click",e,{capture:!0})}}),[t,o,i])}var pe=()=>o(726483),me=()=>o(698331),ge=()=>o(594794),he=()=>o(963589),ye=()=>o(246125),fe=()=>o(351360),ve=()=>o(940371),xe=()=>o(911724),Se=()=>o(276936),be=()=>o(104636),Ce=()=>o(190019),Ae=()=>o(559419);var ke=()=>o(633904);function je(){const{automationStore:e}=(0,ne().k)();return(0,a().K8)((()=>function(e){var t;const o=(null===(t=e.getTrigger())||void 0===t?void 0:t.type)??"event";return"event"===o||"recurrence"!==o&&void(0,g().HB)(o)}(e)),[e])}var Me=()=>o(317909),Te=()=>o(623580),Ie=()=>o(419357);const we=(0,d().YK)({placeholder:{defaultMessage:"Automation name",id:"AutomationNameInput.placeholder"}});const Pe=(0,n.forwardRef)((function(e,t){const{disabled:l,autoSelectAllOnDesktop:s,placeholder:c,...u}=e,{automationStore:p}=(0,K().EC)(),{maybePersistedTransactionActions:m}=(0,ne().b)(),g=function(e){const{isMobile:t}=(0,i().Y0)(),{disabled:o}=e;return(0,r().IS)((e=>({automationNameInput:{marginBlockEnd:0,paddingInline:0},automationNameText:{color:o?e.text.tertiary:e.text.primary,marginInlineStart:t?12:0,marginInlineEnd:t?12:18,fontWeight:h().Wy.medium,padding:0},input:{background:"transparent",boxShadow:"unset",fontWeight:h().Wy.medium,padding:0}})),[t,o])}({showDeleteEnableDisableOptions:!1,disabled:l}),{isMobile:y}=(0,i().Y0)(),f=(0,d().tz)(),v=(0,a().K8)((()=>(null==p?void 0:p.getName())??""),[p]),x=(0,n.useRef)(null),S=(0,o(93583).A)(x,t),b=c||f.formatMessage(we.placeholder),C=(0,n.useCallback)((e=>{m.createAndCommit({userAction:"Automation.updateName",perform:t=>{Me().applyOperation({store:p,operation:{path:["properties"],pointer:p.pointer,command:"update",args:{name:e}},transaction:t})}})}),[p,m]),A=(0,n.useCallback)((e=>{const t=e.currentTarget.value;C(t)}),[C]),k=(0,n.useCallback)((e=>{e.currentTarget.value||C(b)}),[C,b]);return(0,n.useEffect)((()=>{var e;s&&!y&&(null===(e=x.current)||void 0===e||null===(e=e.querySelector("input"))||void 0===e||e.select())}),[s,y]),(0,o(852507).l)((()=>{y&&!v&&C(b)})),(0,Z.jsx)(Ie().Ay,{style:g.automationNameInput,...u,value:v??"Loading...",onChange:A,disabled:l,onBlur:k,ref:S,inputOuterStyle:g.input,format:Te().C.ExtraLarge,textWrapperStyle:g.automationNameText,placeholder:b,inputStyle:{paddingLeft:0,paddingRight:0},autoFocus:!v})}));var Be=()=>o(401634),Re=()=>o(668725),_e=()=>o(869558),Ve=()=>o(406699),Ee=()=>o(656134),Fe=(o(581454),o(908872),()=>o(289915)),De=()=>o(701545),Le=()=>o(745266),Oe=()=>o(31902),Ke=()=>o(519839),Ne=()=>o(736767),We=()=>o(760217),ze=()=>o(928600),He=()=>o(45552),Ue=()=>o(614505),Ye=()=>o(682146),Ge=()=>o(722872),qe=()=>o(71304),$e=()=>o(962730);const Ze=(0,d().YK)({forPagesIn:{id:"collectionSettings.editAutomationView.notifyForOption.title",defaultMessage:"For pages in"}});function Qe(e){const{selectedSourcePointer:t,collectionContextStore:o,onSelect:r,onClose:l}=e,{isMobile:s}=(0,i().Y0)(),c=(0,d().tz)(),u=(0,i().v3)(),[m,h]=n.useState(""),y=(0,a().K8)((()=>o.collectionStore()),[o]),f=(0,a().K8)((()=>o.collectionViewBlockStore()),[o]),v=(0,a().K8)((()=>f&&y?f.getCollectionViewStores().filter((e=>{var t;const o=null===(t=e.getCollectionStore())||void 0===t?void 0:t.pointer;return(null==o?void 0:o.id)===y.id})):[]),[f,y]),x=(0,a().K8)((()=>{if(!y)return[];let e;t&&"collection_view"===t.table&&(e=q().pS.createChildStore(y,t));return p().hS([...v,e].filter(g().O9),(e=>{let{id:t}=e;return t})).filter((e=>(0,Ke().As)(e,m)))}),[y,v,m,t]),S=(0,a().K8)((()=>{if(y&&(0,Ye().zY)({collectionStore:y,environment:u,intl:c,queryForFilter:m}))return function(e){const{collectionStore:t,environment:o,selectedSourcePointer:n,onSelect:i,isMobile:a,intl:r}=e,l=t.getIcon(),s=(0,qe().tS)({environment:o,intl:r,store:t}),c=n&&"collection"===n.table&&n.id===t.id,u=t.getSpaceShardedPointer(),p={key:t.id,action:()=>{u&&i(u)},render:e=>(0,Z.jsx)(We().A,{...e,icon:l&&(0,Z.jsx)(Ue().A,{isEmptyPage:!1,size:a?18:16,disabled:!0,icon:l}),title:s,caption:(0,Z.jsx)(d().sA,{id:"AutomationCollectionSelectMenu.collection.caption",defaultMessage:"Entire database",values:{collectionName:s}}),right:c&&(0,De().p)({width:16,height:"auto"})})};return{key:"collection",items:[p],render:e=>(0,Z.jsx)(k().A,{...e})}}({collectionStore:y,environment:u,selectedSourcePointer:t,onSelect:r,isMobile:s,intl:c})}),[y,u,c,s,r,m,t]),C=(0,a().K8)((()=>y&&f&&v?function(e){const{blockStore:t,filteredCollectionViewStores:o,collectionStore:n,selectedSourcePointer:i,onSelect:a,intl:r}=e,l=n.getSchema(),s=o.map((e=>{if("form_editor"===e.getType()||"chart"===e.getType())return;const o=e.getSpaceShardedPointer();if(e.isDefined()&&o){const s=i&&"collection_view"===i.table&&i.id===o.id,c=(0,pe().RN)({collectionViewStore:e,collectionSchema:l}),u=(0,pe().EN)({collectionViewStore:e,collectionSchema:l}),p=(0,g().O9)(c)||(0,g().O9)(u),m=e.getType(),h=e.getFormat().collection_view_icon,y=e.getName(),f=(o,n)=>(0,Z.jsx)(We().A,{...o,...n,icon:(0,Z.jsx)(Le().h,{color:"lightGray",viewType:m,viewIcon:h}),title:(0,Z.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",padding:0,gap:4},children:[(0,Z.jsx)(Oe().A,{collectionViewType:m,collectionViewName:y}),p&&s&&(0,w().Q)({width:16,height:"auto"})]}),caption:(0,Z.jsx)(Je,{blockStore:t,collectionViewStore:e,intl:r,collectionSchema:l,referencesIncompatibleProperties:p}),right:s&&(0,De().p)({width:16,height:"auto"}),disabled:p,disabledFeedback:p});let v;if(p&&c){var n;const e=null===(n=l[c])||void 0===n?void 0:n.type,t=e?Ye().dC[e]:void 0,o=t?(0,Z.jsx)(d().sA,{id:"AutomationCollectionSelectMenu.tooltip.incompatibleFiltersWarning.specific",defaultMessage:"{propertyTypeName} properties are not supported",values:{propertyTypeName:t}}):(0,Z.jsx)(d().sA,{id:"AutomationCollectionSelectMenu.tooltip.incompatibleFiltersWarning.default",defaultMessage:"Some properties are not supported"});v=e=>(0,Z.jsx)(ae().A,{placement:$e().W.Right,renderTooltip:()=>o,render:t=>f(e,t)})}else if((0,g().O9)(u)){const e=(0,Z.jsx)(d().sA,{id:"AutomationCollectionSelectMenu.tooltip.incompatibleFiltersWarning.crossSpace",defaultMessage:"Cross work-space properties are not supported"});v=t=>(0,Z.jsx)(ae().A,{placement:$e().W.Right,renderTooltip:()=>e,render:e=>f(t,e)})}else v=f;return{key:e.id,action:()=>{a(o)},render:v}}}));return[...s].filter(g().O9)}({blockStore:f,collectionStore:y,filteredCollectionViewStores:x,selectedSourcePointer:t,onSelect:r,intl:c}):[]),[f,y,v,x,c,r,t]),A=function(e){const{menuListItems:t}=e;if(0===t.length)return;return{key:"collection-views",items:t,render:e=>(0,Z.jsx)(k().A,{...e,topBorder:!0})}}({menuListItems:C}),j={key:"search",items:[{key:"search_item",action:()=>{},render:()=>(0,Z.jsx)(Ie().Ay,{value:m,focus:!0,onChange:e=>h(e.target.value),placeholder:c.formatMessage({defaultMessage:"Search views...",id:"collectionViewSelect.viewSearch.placeholder"})})}],render:e=>(0,Z.jsx)(k().A,{isInput:!0,...e})};let M;(0,g().O9)(S)||(0,g().O9)(A)||(M={key:"no-results-section",items:[{key:"no-results-item",action:p().lQ,render:()=>(0,Z.jsx)(Ne().A,{caption:(0,Z.jsx)(d().sA,{defaultMessage:"No results",id:"collectionViewSelect.noResults.title"})})}],render:e=>(0,Z.jsx)(k().A,{...e,topBorder:!0})});const T=[j,S,A,M].filter(g().O9);if(!y)return null;let I;return I=s?{menuType:Ge().gu.Modal,title:(0,Z.jsx)("div",{style:{display:"flex"},children:(0,Z.jsx)(d().sA,{...Ze.forPagesIn})}),right:(0,Z.jsx)(He().DoneMenuText,{}),onClickRight:()=>{l()}}:{menuType:Ge().gu.Popup,width:230,maxHeight:"50vh"},(0,Z.jsx)(ze().A,{...I,children:(0,Z.jsx)(b().Ay,{type:b().Oh.Vertical,sections:T,initialFocus:0,onAccept:()=>{l()}})})}function Je(e){const{blockStore:t,collectionViewStore:o,intl:n,collectionSchema:r,referencesIncompatibleProperties:l}=e,s=(0,i().v3)(),c=(0,a().K8)((()=>!o.getAlive()),[o]),u=(0,a().K8)((()=>{const e=o.getParentBlockStore();if(e)return t.id!==e.id?(0,qe().tS)({environment:s,intl:n,store:e}):void 0}),[t.id,o,n,s]),p=(0,a().K8)((()=>{const e=o.getQuery(r);return(0,Fe().rg)({propertyFilters:o.getPropertyFiltersStore().getValue()??[],combinatorFilter:null==e?void 0:e.filter,schema:r}).reduce(((e,t)=>{if((0,Fe().yX)(t))return e+1;return e+(t.filters??[]).length}),0)}),[r,o]);return l?(0,Z.jsx)(d().sA,{id:"AutomationCollectionSelectMenu.collectionView.unsupportedView",defaultMessage:"Not supported"}):c?(0,Z.jsx)(d().sA,{id:"AutomationCollectionSelectMenu.collectionView.deletedView",defaultMessage:"<emphasis>View not found.</emphasis>",values:{emphasis:e=>(0,Z.jsx)("em",{children:e})}}):u?(0,Z.jsx)(d().sA,{id:"AutomationCollectionSelectMenu.collectionView.captionDifferentParent",defaultMessage:"<emphasis>View configured in {externalParentBlockName}</emphasis>",values:{emphasis:e=>(0,Z.jsx)("em",{children:e}),externalParentBlockName:u}}):0===p?(0,Z.jsx)(d().sA,{id:"AutomationCollectionSelectMenu.collectionView.captionWithNoFilters",defaultMessage:"Any page in this view"}):(0,Z.jsx)(d().sA,{id:"AutomationCollectionSelectMenu.collectionView.captionWithFilters",defaultMessage:"{ruleCount, plural, one {{ruleCount} filter} other {{ruleCount} filters}}",values:{ruleCount:p}})}function Xe(e){const{pointer:t,collectionStore:o,intl:n}=e,l=(0,i().v3)(),s=(0,r().IS)((e=>({warningIcon:{width:16,height:"auto",color:e.accentColors.orange[400]},titleContainer:{display:"flex",flexDirection:"row",alignItems:"center",padding:0,gap:4,flex:"1 1 auto",minWidth:0},title:{...h().RC},errorText:{color:e.errorText,fontWeight:h().Wy.medium}})),[]),c=(0,a().K8)((()=>t?q().sk.createChildStore(o,t):void 0),[o,t]),u=(0,a().K8)((()=>c?(0,qe().tS)({environment:l,intl:n,store:c}):(0,Z.jsx)("span",{style:s.errorText,children:(0,Z.jsx)(d().sA,{id:"AutomationCollectionSelectMenu.source.missing",defaultMessage:"Select database"})})),[l,n,s.errorText,c]),p=(0,a().K8)((()=>{if(!c||c.table===V().Vl)return!1;const e=o.getSchema();return(0,g().O9)((0,pe().RN)({collectionViewStore:c,collectionSchema:e}))}),[o,c]);return(0,Z.jsxs)("div",{style:s.titleContainer,children:[p&&(0,w().Q)(s.warningIcon),(0,Z.jsx)("span",{style:s.title,children:u})]})}function et(e){const{collectionContextStore:t,disabled:o}=e,{isMobile:l}=(0,i().Y0)(),s=(0,d().tz)(),c=(0,r().IS)((e=>{const t=o?e.text.tertiary:e.text.secondary,n=l?h().J.UIRegular.mobile:h().J.UIRegular.desktop;return{wrap:{alignItems:"center",color:t,cursor:"default",display:"grid",fontSize:n,gridTemplateColumns:"auto auto"},button:{color:t,fontWeight:h().Wy.medium,fontSize:n,width:"100%",height:24,paddingLeft:6,paddingRight:6,marginLeft:1},icon:{width:10,marginLeft:4,fill:t}}}),[l,o]),{automationStore:u}=(0,K().EC)(),{maybePersistedTransactionActions:p}=(0,ne().b)(),m=(0,a().K8)((()=>t.collectionStore()),[t]),g=(0,a().K8)((()=>{const e=null==u?void 0:u.getTrigger();if("event"===(null==e?void 0:e.type)){const t=e.event.source;if(t&&"filter"!==t.type)return t.pointer}}),[u]),y=(0,n.useCallback)((e=>{const t=e.table===V().Vl?{pointer:e,type:V().Vl}:{pointer:e,type:_e().Gy};p.createAndCommit({userAction:"Automation.updateSource",perform:e=>{Me().applyOperation({store:u,operation:{path:["trigger","event"],pointer:u.pointer,command:"update",args:{source:t}},transaction:e})}})}),[u,p]),f=(0,Ee().j)(),v=m?(0,Z.jsx)(Xe,{pointer:g,collectionStore:m,intl:s}):(0,Z.jsx)(n.Fragment,{}),x=(0,Z.jsx)(Ve().Ay,{alignmentToOrigin:Ve().yP.Start,placementToOrigin:Ve().sx.Bottom,popupType:f,render:e=>(0,Z.jsx)(Qe,{selectedSourcePointer:g,onSelect:y,onClose:()=>{e.close()},collectionContextStore:t}),renderOrigin:e=>(0,Z.jsxs)(N().p,{...e,style:c.button,disabled:o,children:[v,(0,Re().b)(c.icon)]})});return(0,Z.jsx)("div",{style:c.wrap,children:(0,Z.jsx)(d().sA,{id:"automationBuilderModal.SourceInput.appliesTo",defaultMessage:"For all pages in {button}",values:{button:x}})})}function tt(){const e=(0,i().v3)(),t=(0,d().tz)(),{isMobile:o}=(0,i().Y0)(),n=(0,r().IS)((e=>{const t=o?h().J.UIRegular.mobile:h().J.UIRegular.desktop;return{wrap:{color:e.text.secondary,fontSize:t},title:{color:e.text.secondary,fontWeight:h().Wy.medium,fontSize:t}}}),[o]),{collectionStore:l}=(0,ne().k)(),s=(0,a().K8)((()=>(0,qe().tS)({environment:e,intl:t,store:l})),[l,e,t]),c=(0,Z.jsx)("span",{style:n.title,children:s});return(0,Z.jsx)("div",{style:n.wrap,children:(0,Z.jsx)(d().sA,{id:"automationBuilderModal.SourceLabel.appliesTo",defaultMessage:"For {source}",values:{source:c}})})}let ot;(0,o(604341).exposeDebugGetter)("currentAutomation",(()=>ot));const nt=(0,d().YK)({deleteButton:{id:"automationBuilderModal.editAutomationView.deleteButton",defaultMessage:"Delete"},createButton:{id:"automationBuilderModal.editAutomationView.createButton.label",defaultMessage:"Create"},saveButton:{id:"automationBuilderModal.editAutomationView.saveButton.label",defaultMessage:"Save"},cancelButton:{id:"automationBuilderModal.editAutomationView.cancelButton.label",defaultMessage:"Cancel"},doneButton:{id:"automationBuilderModal.editAutomationView.doneButton.label",defaultMessage:"Done"},enableButton:{id:"automationBuilderModal.editAutomationView.enableButton.label",defaultMessage:"Enable"},errorsFooterCaption:{id:"automationBuilderModal.editAutomationView.errorCaption",defaultMessage:"Fix errors to enable"}});function it(){}function at(e){const{collectionSettingsStore:t,collectionContextStore:o,source:M,...T}=e,I=(0,he().X)("automation_updated_error_states"),[w]=(0,n.useState)((()=>T)),{mode:P}=w,B=(0,d().tz)(),R=(0,i().v3)(),{isMobile:_}=(0,i().Y0)(),{value:V}=(0,G().fJ)(z().T.formulas),{value:E}=(0,G().fJ)(v().QV.automationTypecheck),[F,L]=(0,n.useState)([]),O="create"===P,N=(0,ye().l)("BuilderModal",{cacheFallback:R.defaultRecordCache.inMemoryRecordCache,isTemporaryData:!0}),W=(0,a().K8)((()=>fe().default.state.currentUserStore),[]),U=(0,a().K8)((()=>null==W?void 0:W.userId),[W]),Y=(0,a().K8)((()=>null==W?void 0:W.getDisplayName(B)),[W,B]),$=(0,a().K8)((()=>o.collectionStore()),[o]),Q=(0,a().K8)((()=>null==$?void 0:$.getSpaceId()),[$]),X=(0,a().K8)((()=>null==$?void 0:$.id),[$]),ee=(0,n.useMemo)((()=>"update"===w.mode?w.automationId:(0,ge().Z1)({environment:R,table:u().yB,spaceId:Q})),[w,R,Q]),te=(0,a().O$)(o.aliveAutomationCountStore),oe=(0,a().K8)((()=>{if(Q&&$&&U)return new(q().dn)(R,{id:ee,table:u().yB,spaceId:Q})}),[ee,$,U,R,Q]);!function(e){(0,n.useEffect)((()=>(ot=e,()=>{ot=void 0})),[e])}(oe);const ne=(0,a().K8)((()=>(0,s().PK)(B,Y)),[Y,B]),ie=(0,a().K8)((()=>{if(!Q||!$||!U)return;const e={id:ee,table:u().yB,spaceId:Q},t=N.getEntry({pointer:e,userId:U});return t?t.value.value:pe().EZ({automationId:ee,automationName:"",collectionStore:$,userId:U})}),[ee,$,U,Q,N]),{maybePersistedAutomationStore:ae,maybePersistedTransactionActions:re,hasUnpersistedChanges:le}=(0,ke().t)({automationId:ee,spaceId:Q,defaultValue:O?ie:void 0,persist:!1}),se=(0,a().K8)((()=>{if(ae&&(0,me().$X)(ae))return ae}),[ae]),ue=(0,a().K8)((()=>((null==se?void 0:se.getActionStores())??[]).filter((e=>e.isDefined()))),[se]),be=(0,a().K8)((()=>(0,me().H8)((null==se?void 0:se.getTriggerType())??"event")),[se]),je=(0,a().K8)((()=>{const e=null==$?void 0:$.getParentBlockStore();return!!e&&e.pathIsDead()}),[$]),Me=function(e){const{actionStores:t,automationStore:o,collectionStore:n,loadingStatus:i,mode:r}=e;return(0,a().K8)((()=>"create"===r?"edit":"resolved"===i&&o&&t&&n?(0,pe().TT)({automationStore:o,actionStores:t,collectionStore:n})?"edit":(0,pe().Gz)({automationStore:o,collectionStore:n})?"readonly_with_delete":"readonly":"readonly"),[r,i,o,t,n])}({automationStore:se,actionStores:ue,collectionStore:$,loadingStatus:"resolved",mode:w.mode}),Te=("readonly_with_delete"===Me||"edit"===Me&&!O)&&!je,Ie=(0,a().K8)((()=>!(!se||!$)&&pe().l({automationStore:se,collectionStore:$})),[se,$]),we=(0,a().K8)((()=>se&&V&&E?(0,Ce().Z)({environment:R,automationStore:se,automationTypecheckModule:E,contextType:be,formulasModule:V,intl:B}):void 0),[R,se,be,V,E,B]),Re=(0,a().K8)((()=>!!($&&se&&we)&&pe().Qn({automationStore:se,collectionStore:$,typecheckResult:we})),[se,$,we]),_e=(0,a().K8)((()=>!!we&&(0,Se().h)({environment:R,typecheckResult:we,automationStore:se})),[se,R,we]),Ve=(0,a().K8)((()=>oe&&V&&E?(0,Ce().Z)({environment:R,automationStore:oe,automationTypecheckModule:E,contextType:be,formulasModule:V,intl:B}):void 0),[R,oe,be,V,E,B]),Ee=(0,a().K8)((()=>!!($&&oe&&Ve)&&pe().Qn({automationStore:oe,collectionStore:$,typecheckResult:Ve})),[$,oe,Ve]),Fe=(0,a().K8)((()=>{if(!se)return!0;let e;var t;se.isTriggerType("event")&&(e=null===(t=se.getEventConfiguration())||void 0===t?void 0:t.pagePropertiesEdited.type);const o=(0,g().O9)(e)&&"none"!==e,n=se.getActionStores().length>0;if(!n&&!o)return!1;const i=!(0,l().aE)({automationTrigger:se.getTrigger(),collectionSchema:null==$?void 0:$.getSchema()});if(o&&i)return!0;if(n&&(0,g().O9)(we)&&m().Q.isSuccess(we)){if(Object.keys(we.value.actionValidationFailures).some((e=>!F.includes(e))))return!0}return!1}),[se,$,F,we]);!function(e){const{automationStore:t,collectionStoreId:o,source:r}=e,l=(0,i().v3)(),[s,c]=(0,n.useState)(!1),u=(0,a().K8)((()=>(null==t?void 0:t.getActionIds().length)??0),[t]),d=(0,a().K8)((()=>{if(!t||!t.isTriggerType("event"))return 0;const e=t.getTriggerStore().getKeyStore("event");let o=0;e.getKeyStore("pagesAdded").getValue()&&o++;const n=e.getKeyStore("pagePropertiesEdited").getValue();if("any"===(null==n?void 0:n.type))o++;else if("some"===(null==n?void 0:n.type)){var i;o+=(null===(i=n.some)||void 0===i?void 0:i.length)??0}else if("all"===(null==n?void 0:n.type)){var a;o+=(null===(a=n.all)||void 0===a?void 0:a.length)??0}return o}),[t]);(0,n.useEffect)((()=>{o&&!s&&t&&((0,H().u4)({environment:l,event:{eventName:"automation_configure_view",eventProperties:{automation_id:t.id,automation_total_actions:u,automation_total_triggers:d,collection_id:o,source:r}}}),ce().default.logEvent("automation_configure_view","true"),c(!0))}),[l,o,s,u,d,null==t?void 0:t.id,t,r])}({automationStore:se,collectionStoreId:X,source:e.source});const De="edit"===Me&&!je&&!_e,Le=(0,n.useCallback)((()=>{I&&L([])}),[I]),Oe=(0,n.useCallback)((()=>{$&&se&&le&&("create"===P?function(e){const{automationStore:t,collectionSettingsStore:o,collectionStore:n,environment:i,intl:a,from:r}=e;j().nO({automationStore:t,collectionStore:n,environment:i,intl:a,from:r,builderType:"modal"}),f().D6({label:(0,Z.jsx)(d().sA,{id:"automations.editAutomationView.createdConfirmation",defaultMessage:"{automationName} created",values:{automationName:t.getName()}})}),D().V({environment:i,collectionSettingsStore:o});const l=(0,ve().S)(o);l&&"automationSettings"!==l.type&&y().a2({collectionSettingsStore:o,item:{type:"automationSettings",source:"first_automation_created"}})}({automationStore:se,collectionSettingsStore:t,collectionStore:$,environment:R,intl:B,from:w.from}):"update"===P?function(e){const{automationStore:t,collectionSettingsStore:o,collectionStore:n,environment:i,source:a}=e;j().kU({automationStore:t,collectionStore:n,environment:i,builderType:"modal",source:a}),f().D6({label:(0,Z.jsx)(d().sA,{id:"automations.editAutomationView.updatedConfirmation",defaultMessage:"{automationName} updated",values:{automationName:t.getName()}})}),D().V({environment:i,collectionSettingsStore:o})}({automationStore:se,collectionSettingsStore:t,collectionStore:$,environment:R,source:M}):(0,g().HB)(P))}),[se,t,$,R,le,B,P,w,M]),Ke=(0,n.useCallback)((async()=>{se&&$&&!O&&await j().lg({intl:B,environment:R,existingAutomationStore:se,collectionStore:$,onDelete:()=>{var e;D().V({environment:R,collectionSettingsStore:t}),1===te&&"automationSettings"===(null===(e=(0,ve().S)(t))||void 0===e?void 0:e.type)&&y().R8({collectionSettingsStore:t,item:{type:"main"}})}})}),[te,se,t,$,R,B,O]),Ne=(0,n.useCallback)((async()=>{if(le){await j().lT({hasPendingChanges:le})&&D().V({environment:R,collectionSettingsStore:t})}else D().V({environment:R,collectionSettingsStore:t})}),[t,R,le]);de({shouldInvokeHandler:!0,onClick:Ne,isMobile:_});const We=(0,n.useCallback)((e=>{L([e.id])}),[]),ze=(0,Ae().c)(),He=function(){const{isMobile:e}=(0,i().Y0)(),t=ct();return(0,r().IS)((o=>({header:{backgroundColor:o.surface.elevated,zIndex:100,width:"100%",...e?{paddingBottom:0,paddingTop:0}:{paddingBottom:8,borderBottom:`1px solid ${o.stroke.secondary}`}},nameInput:{...e&&{paddingTop:8}},buttons:{backgroundColor:o.surface.elevated,display:"flex",flexDirection:"row",paddingBottom:e?16:4,paddingTop:12,justifyContent:"space-between",gap:e?"10px":0,width:"100%",zIndex:100,...e&&{paddingLeft:rt,paddingRight:rt,flexDirection:"column-reverse"}},footerButton:{height:32,width:e?"100%":"auto"},footerErrorCaption:{color:o.text.tertiary,fontSize:h().J.UISmall.desktop},footerRight:{alignItems:"center",display:"flex",gap:14,justifyContent:"space-between"},automationOptionIconDesktop:{marginInlineStart:12},wrap:{marginTop:e?16:17,marginBottom:e?20:0,paddingBottom:16,width:"100%",flexGrow:1,overflowY:"auto"},closeButtonContainer:{position:"absolute",top:10,right:10,zIndex:101},closeButton:{display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"100%",background:o.tint.regular,width:24,height:24},closeButtonHover:{background:o.buttonPressedBackground},closeButtonIcon:{width:14,fill:o.icon.secondary},...t})),[e,t])}(),Ue=[],Ye=le&&Re;De&&!_&&Ue.push((0,Z.jsxs)(k().A,{style:He.buttons,mobileStyle:He.buttons,children:[(0,Z.jsx)(C().A,{size:"lg",onClick:Ne,style:He.footerButton,children:(0,Z.jsx)(d().sA,{...nt.cancelButton})}),(0,Z.jsxs)("div",{style:He.footerRight,children:[I&&!Ye&&Fe&&(0,Z.jsx)("div",{style:He.footerErrorCaption,children:(0,Z.jsx)(d().sA,{...nt.errorsFooterCaption})}),(0,Z.jsx)(A().A,{onClick:Oe,onMouseEnter:Le,disabled:!Ye,style:He.footerButton,children:O?(0,Z.jsx)(d().sA,{...I?nt.enableButton:nt.createButton}):(0,Z.jsx)(d().sA,{...I?nt.doneButton:nt.saveButton})})]})]},"save"));const Ge=(0,a().K8)((()=>$&&se?(0,Z.jsx)(K().or,{automationStore:se,children:(0,Z.jsxs)(xe().v,{value:{collectionStore:$,disabled:!De,editorPlacement:{type:"inline"},editorWidth:x().vE,maybePersistedTransactionActions:re,onActionAdded:We,suppressActionErrors:F,hideDragHandle:_e,cantSaveDueToError:Fe,...ze},defaultCollapseActions:_e,children:[!_&&(0,Z.jsx)("div",{style:He.closeButtonContainer,children:(0,Z.jsx)(S().A,{onClick:Ne,style:He.closeButton,hoveredStyle:He.closeButtonHover,children:(0,c().V)(He.closeButtonIcon)})}),(0,Z.jsx)("div",{style:He.header,children:(0,Z.jsx)(b().Ay,{type:b().Oh.Vertical,initialFocus:void 0,sections:[{key:"automation_top_input",items:(0,p().oE)([{key:"automation_name",action:()=>{},render:e=>(0,Z.jsx)("div",{...e,style:He.nameInput,children:(0,Z.jsx)(Pe,{...e,disabled:!De,autoSelectAllOnDesktop:De&&"create"===P,placeholder:ne})})},lt({showActiveAutomationToggle:Te,isPersistedStateComplete:Ee,collectionContextStore:o,canEdit:De,automationStore:se})]),render:e=>(0,Z.jsx)(k().A,{...e,disableMobilePadding:!0,desktopStyle:{paddingTop:0,paddingBottom:0}})}]})}),(0,Z.jsxs)("div",{style:He.wrap,children:[(0,Z.jsx)(J,{collectionStore:$,collectionSettingsStore:t,automationPermissionScope:Me,referencesIncompatibleCollectionViewFilter:Ie,requiresSubscriptionUpgrade:_e,onDelete:Ke}),(0,Z.jsx)(v().U3,{areActionsEditable:De,areTriggersEditable:De})]})]})}):null),[$,se,De,re,We,F,_e,ze,_,He,Ne,Te,Ee,o,Fe,t,Me,Ie,Ke,P,ne]);return(0,Z.jsxs)(Be().i,{handleOnDismiss:Ne,handleOnSave:Oe,canSave:Ye,mode:P,children:[Ge,Ue]})}const rt=16;function lt(e){const{showActiveAutomationToggle:t,isPersistedStateComplete:o,collectionContextStore:n,canEdit:i}=e;return{key:"automation_toggle_and_source",action:it,render:e=>(0,Z.jsx)(st,{menuListItemProps:e,showActiveAutomationToggle:t,isPersistedStateComplete:o,collectionContextStore:n,canEdit:i})}}function st(e){const{menuListItemProps:t,showActiveAutomationToggle:o,isPersistedStateComplete:l,collectionContextStore:s,canEdit:c}=e,u=(0,d().tz)(),{isMobile:p}=(0,i().Y0)(),m=(0,i().v3)(),g=(0,he().X)("automation_updated_error_states"),h=ct(),y=(0,r().IS)((e=>({wrap:{display:"flex",...p?{flexDirection:"column",justifyContent:"center",alignItems:"flex-start",paddingInline:12,borderBottom:`1px solid ${e.stroke.primary}`,paddingBlock:12,gap:12}:{gap:8,minHeight:24,alignItems:"center"}},toggle:{display:"flex",alignItems:"center",marginLeft:1},...h})),[p,h]),{automationStore:f}=(0,K().EC)(),v=(0,a().K8)((()=>{var e;return(null==f||null===(e=f.getOwnerStore())||void 0===e?void 0:e.getDisplayName(u))??""}),[u,f]),x="active"===(0,a().K8)((()=>(null==f?void 0:f.getStatus())??"disabled"),[f]),S=je(),b=(0,n.useCallback)((()=>{f&&j().WA({automationStore:f,environment:m})}),[m,f]),C=(0,n.useCallback)((()=>{f&&j().HJ({automationStore:f,environment:m})}),[m,f]),A=(0,a().K8)((()=>!l||(0,be().NH)(f)),[f,l]);return(0,Z.jsxs)("div",{...t,style:y.wrap,children:[(l||g&&!x)&&o&&(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)("div",{style:y.toggle,children:(0,Z.jsx)(se,{automationId:f.id,automationOwner:v,isAutomationPaused:!x,onPause:b,onResume:C,disabled:A})}),(0,Z.jsx)("div",{style:y.verticalDivider})]}),S?(0,Z.jsx)(et,{disabled:!c,collectionContextStore:s}):(0,Z.jsx)(tt,{})]})}function ct(){const{isMobile:e}=(0,i().Y0)();return(0,r().IS)((t=>({verticalDivider:{background:t.stroke.secondary,height:16,width:1,borderRadius:1,display:e?"none":"block"}})),[e])}var ut=()=>o(246826),dt=()=>o(840094),pt=()=>o(845715);const mt=(0,d().YK)({placeholder:{id:"automations.builderModal.buttonBuilderLabelInput.placeholder",defaultMessage:"Enter a name"},loading:{id:"automations.builderModal.buttonBuilderLabelInput.loading",defaultMessage:"Loading..."}}),gt=(0,n.forwardRef)((function(e,t){let{disabled:o,buttonName:a,handleNameChange:l,handleBlur:s,handleSubmit:c,...u}=e;const p=(0,d().tz)(),{isMobile:m}=(0,i().Y0)(),g=(0,r().IS)((e=>({buttonNamePropertyInput:{marginBlockEnd:0,boxShadow:"none"},buttonNameText:{marginInlineStart:m?12:0,marginInlineEnd:m?12:18},inputOuterStyle:{background:"transparent",boxShadow:"unset"}})),[m]),h=(0,n.useCallback)((e=>{l(e)}),[l]),y=(0,n.useCallback)((e=>{s(e.target.value)}),[s]),f=(0,n.useCallback)((()=>{c(a)}),[c,a]);return(0,Z.jsx)(Ie().Ay,{style:g.buttonNamePropertyInput,...u,value:a??p.formatMessage(mt.loading),onChange:h,disabled:o,ref:t,inputOuterStyle:g.inputOuterStyle,format:Te().C.ExtraLarge,textWrapperStyle:g.buttonNameText,placeholder:p.formatMessage(mt.placeholder),onBlur:y,onSubmit:f,autoFocus:!a})}));var ht=()=>o(390518);const yt=(0,d().YK)({saveButton:{defaultMessage:"Save",id:"database.buttonProperty.saveButtonLabel"},noEditError:{defaultMessage:"You don't have full access to edit this button",id:"database.buttonProperty.noEditError"}});function ft(e){const{collectionContextStore:t,propertySchema:o}=e,i=(0,a().K8)((()=>t.collectionStore()),[t]),r=(0,a().K8)((()=>null==i?void 0:i.getSpaceId()),[i]),l=(0,n.useMemo)((()=>{const e=o.automation_id;if(e&&r)return{id:e,spaceId:r,table:u().yB}}),[o.automation_id,r]);return(0,pt().K)(i,l)?(0,Z.jsx)(vt,{...e}):(0,Z.jsx)(ht().A,{})}function vt(e){const{collectionContextStore:t,collectionSettingsStore:o,propertyId:l,propertySchema:s}=e,{isMobile:u}=(0,i().Y0)(),p=(0,i().v3)(),[m,g]=(0,n.useState)([]),h=(0,a().K8)((()=>t.collectionStore()),[t]),y=(0,a().K8)((()=>null==h?void 0:h.getSpaceId()),[h]),{maybePersistedAutomationStore:f,maybePersistedTransactionActions:C}=(0,ke().t)({automationId:s.automation_id,spaceId:y,defaultValue:void 0,persist:!0}),j=(0,a().K8)((()=>null==f?void 0:f.getTrigger()),[f]),M=(0,dt().Qj)({automationStore:f,propertyId:l,propertySchema:s,collectionContextStore:t}),T=(0,a().K8)((()=>{var e;return"sufficient"===(null==M||null===(e=M.state)||void 0===e?void 0:e.editPermissionStatus)}),[M]),I=(0,a().K8)((()=>{var e;return!(null==M||null===(e=M.state)||void 0===e||!e.typecheckResult)&&(0,Se().h)({environment:p,typecheckResult:M.state.typecheckResult,automationStore:f})}),[M,p,f]),w=(0,a().K8)((()=>(null==f?void 0:f.getNameStore().getValue())??s.name),[f,s.name]),P=(0,a().K8)((()=>"collectionTypedView"===t.contextType),[t]),B=(0,n.useCallback)((e=>{if(!f)return;const t=e.currentTarget.value;C.createAndCommit({userAction:"ButtonBuilderModal.setName",perform:e=>{ut().KY({store:f.getNameStore(),transaction:e,value:t})}})}),[f,C]),R=(0,n.useCallback)((e=>{g((t=>[...t,e.id]))}),[]),_=(0,Ae().c)(),V=function(){const{isMobile:e}=(0,i().Y0)();return(0,r().IS)((t=>({header:{backgroundColor:"transparent",borderBottom:`1px solid ${t.stroke.secondary}`,paddingBottom:8,paddingTop:kt,position:"absolute",top:0,width:`calc(100% - ${2*At}px)`,zIndex:100,...e&&{paddingBottom:0,paddingTop:0,width:"100%"}},buttons:{backgroundColor:"dark"===t.mode?t.accentColors.gray[100]:t.white,display:"flex",gap:4,paddingBlock:`${kt}px ${At}px`,position:"absolute",bottom:0,width:`calc(100% - ${2*At}px)`,zIndex:100,...e&&{paddingLeft:At,paddingRight:At,flexDirection:"column-reverse",width:"100%"}},label:{paddingTop:e?"10px":0},closeButtonContainer:{position:"absolute",top:10,right:10,zIndex:101},closeButton:{display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"100%",background:t.buttonHoveredBackground,width:20,height:20,padding:4},closeButtonHover:{background:t.buttonPressedBackground},closeButtonIcon:{width:16,fill:t.mediumTextColor},wrap:{overflowY:"auto",overflowX:"hidden",marginTop:e?bt:xt,marginBottom:e?Ct:St,paddingInline:e?0:2,width:"100%"},desktopButtonLabelNameContainer:{paddingLeft:0,paddingRight:0,color:t.lightTextColor},mobileButtonLabelNameContainer:{paddingTop:kt,paddingBottom:4,paddingLeft:At,paddingRight:At,color:t.lightTextColor},buttonLabelNameTextWrapperStyle:{marginLeft:e?At:0,marginRight:e?At:0},footerButton:{height:32,width:"100%"},inputStyle:{background:"transparent"},inputOuterStyle:{background:"transparent"}})),[e])}(),E=(0,n.useCallback)((()=>{D().V({environment:p,collectionSettingsStore:o})}),[p,o]),F=(0,n.useCallback)((()=>{$().K(p,{from:"button_property_automation_header_message",upsell:{type:"product",product:"plus",limit:{type:"none"}}})}),[p]);de({shouldInvokeHandler:!0,onClick:E,isMobile:u});const N=(0,n.useCallback)((e=>{f&&C.createAndCommit({userAction:"ButtonBuilderModal.setName",perform:t=>{ut().KY({store:f.getNameStore(),transaction:t,value:e})}})}),[f,C]),W=(0,n.useMemo)((()=>h&&f&&j&&"button"===j.type?(0,Z.jsx)(K().u,{automationStore:f,contextType:"button_property",children:(0,Z.jsxs)(xe().v,{value:{collectionStore:h,disabled:!T,editorPlacement:{type:"inline"},editorWidth:x().vE,maybePersistedTransactionActions:C,onActionAdded:R,suppressActionErrors:m,hideDragHandle:I,..._},defaultCollapseActions:I,children:[!u&&(0,Z.jsx)("div",{style:V.closeButtonContainer,children:(0,Z.jsx)(S().A,{onClick:E,style:V.closeButton,hoveredStyle:V.closeButtonHover,children:(0,c().V)(V.closeButtonIcon)})}),(0,Z.jsx)("div",{style:V.header,children:(0,Z.jsx)(b().Ay,{type:b().Oh.Vertical,initialFocus:void 0,sections:[{key:"automation_top_input",items:[{key:"automation_name",action:()=>{},render:e=>(0,Z.jsx)(gt,{...e,disabled:P,buttonName:w,handleNameChange:B,handleBlur:N,handleSubmit:N})}],render:e=>(0,Z.jsx)(k().A,{...e,disableMobilePadding:!0,shouldShowBottomDivider:!0,desktopStyle:{paddingTop:0}})}]})}),(0,Z.jsxs)("div",{style:V.wrap,children:[I&&(0,Z.jsx)(O().j,{onUpsellClick:F}),!T&&(0,Z.jsx)(L().z,{children:(0,Z.jsx)(d().sA,{...yt.noEditError})}),(0,Z.jsx)(v().U3,{areActionsEditable:!I,areTriggersEditable:!1})]})]})}):null),[f,w,h,P,B,E,N,T,u,C,R,V,m,j,_,I,F]),z=u?(0,Z.jsx)(n.Fragment,{}):(0,Z.jsx)(k().A,{mobileStyle:V.buttons,style:V.buttons,children:(0,Z.jsx)(A().A,{onClick:E,disabled:!T,style:V.footerButton,children:(0,Z.jsx)(d().sA,{...yt.saveButton})})});return h&&f&&j&&"button"===j.type?(0,Z.jsxs)(Be().i,{handleOnDismiss:E,canSave:!0,mode:"button_property",handleOnSave:E,children:[W,z]}):null}const xt=60,St=60,bt=60,Ct=60,At=16,kt=12},89849:(e,t,o)=>{o.d(t,{h:()=>a});o(296540);var n=o(474848);const i={viewBox:"0 0 20 20",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M10 13.504a3.5 3.5 0 1 0-.001-7.002A3.5 3.5 0 0 0 10 13.504m1.167-3.502a1.168 1.168 0 1 1-2.335.002 1.168 1.168 0 0 1 2.335-.002"}),(0,n.jsx)("path",{d:"M10 3.895c-4.093 0-7.662 2.189-9.351 5.408-.231.44-.231.964 0 1.404 1.689 3.22 5.258 5.408 9.351 5.408s7.662-2.189 9.351-5.408c.231-.44.231-.964 0-1.404-1.689-3.22-5.258-5.408-9.351-5.408m-8.245 5.99C3.218 7.096 6.347 5.144 10 5.144s6.782 1.952 8.245 4.74a.26.26 0 0 1 0 .24c-1.463 2.788-4.592 4.74-8.245 4.74s-6.782-1.952-8.245-4.74a.26.26 0 0 1 0-.24"})]})},a=(0,o(340498).wt)("eye",i)},95199:(e,t,o)=>{o.d(t,{Ud:()=>W});o(898992),o(354520),o(581454);var n=o(296540),i=()=>o(484714),a=()=>o(56366),r=()=>o(401497),l=()=>o(422540),s=()=>o(462618),c=()=>o(352271),u=()=>o(80979),d=()=>o(791089),p=()=>o(519831),m=()=>o(959013),g=()=>o(496603),h=()=>o(534177),y=()=>o(246826),f=()=>o(725614),v=()=>o(84817),x=()=>o(760217),S=()=>o(406699),b=()=>o(623580),C=()=>o(928600),A=()=>o(939740),k=()=>o(89924),j=()=>o(521732),M=()=>o(678350),T=()=>o(909470),I=()=>o(508496),w=()=>o(546461),P=()=>o(653417),B=()=>o(301782),R=()=>o(366360),_=()=>o(858163),V=()=>o(133518),E=()=>o(781697),F=()=>o(656134),D=()=>o(548526),L=()=>o(464004),O=()=>o(938818),K=o(474848);const N=(0,m().YK)({replaceActionLabel:{id:"automations.AutomationActionSetPropertiesSection.replaceAction.label",defaultMessage:"Replace with"},appendActionLabel:{id:"automations.AutomationActionSetPropertiesSection.appendAction.label",defaultMessage:"Add"},removeActionLabel:{id:"automations.AutomationActionSetPropertiesSection.removeAction.label",defaultMessage:"Remove"},toggleActionLabel:{id:"automations.AutomationActionSetPropertiesSection.toggleAction.label",defaultMessage:"Toggle"},titlePlaceholder:{id:"automations.AutomationActionSetPropertiesSection.titlePlaceholder",defaultMessage:"Untitled"},automationActionPropertyDeleted:{id:"automations.AutomationActionSetPropertiesSection.automationActionPropertyDeleted",defaultMessage:"This property was deleted"},automationActionPropertyUnsupported:{id:"automations.AutomationActionSetPropertiesSection.automationActionPropertyUnsupported",defaultMessage:"This property is unsupported"}});function W(e){const{actionStore:t,collectionStore:o,disabled:r,showSetPropertyActions:l}=e,s=(0,i().v3)(),{automationStore:c}=(0,w().EC)(),{maybePersistedTransactionActions:u}=(0,R().b)(),d=(0,a().K8)((()=>{var e;return(null===(e=t.getConfig())||void 0===e?void 0:e.values)??{}}),[t]),p=(0,a().K8)((()=>{var e;return(null===(e=t.getConfig())||void 0===e?void 0:e.properties)??[]}),[t]),m=(0,n.useCallback)((e=>{const o=p.concat([e]),n={...d,[e]:void 0};u.createAndCommit({userAction:"AutomationActionSetPropertiesSection.propertiesChange",perform:e=>{z({configStore:t.getConfigStore(),properties:o,transaction:e,values:n})}}),(0,B().UB)(s,{automationActionStore:t,automationStore:c})}),[p,d,u,s,c,t]),g=(0,n.useCallback)(((e,o)=>{const n=p.indexOf(e);if(-1===n)return;const i=p.slice(0);i[n]=o;const a={...d,[o]:void 0};u.createAndCommit({userAction:"AutomationActionSetPropertiesSection.setProperties",perform:e=>{z({configStore:t.getConfigStore(),properties:i,transaction:e,values:a})}}),(0,B().UB)(s,{automationActionStore:t,automationStore:c})}),[p,d,u,s,c,t]),h=(0,n.useCallback)((e=>{const o=p.filter((t=>t!==e)),n={...d,[e]:void 0};u.createAndCommit({userAction:"AutomationActionSetPropertiesSection.removeProperty",perform:e=>{z({configStore:t.getConfigStore(),properties:o,transaction:e,values:n})}}),(0,B().UB)(s,{automationActionStore:t,automationStore:c})}),[p,d,u,s,c,t]),y=(0,n.useCallback)(((e,o)=>{const n={...d,[e]:o};u.createAndCommit({userAction:"AutomationActionSetPropertiesSection.handleValueChange",perform:e=>{z({configStore:t.getConfigStore(),properties:p,transaction:e,values:n})}}),(0,B().UB)(s,{automationActionStore:t,automationStore:c})}),[d,u,s,t,c,p]);return(0,K.jsx)(H,{actionStore:t,collectionStore:o,disabled:r,onPropertyAdd:m,onPropertyChange:g,onPropertyRemove:h,onPropertyValueChange:y,showSetPropertyActions:l})}function z(e){const{configStore:t,properties:o,transaction:n,values:i}=e;y().zv({store:t,data:{properties:o,values:i},transaction:n})}function H(e){const{actionStore:t,collectionStore:o,onPropertyAdd:n,onPropertyChange:i,onPropertyRemove:s,onPropertyValueChange:c,disabled:u,showSetPropertyActions:d}=e,p=(0,r().IS)((e=>({addPropertyValuePlaceholder:{color:e.mediumTextColor,flexGrow:1,textAlign:"right"},addPropertyRow:{display:"flex",alignItems:"center"}})),[]),m=(0,a().K8)((()=>t.getConfigStore().getKeyStore("properties").getValue()??[]),[t]),g=(0,a().K8)((()=>(0,l().m7)({collectionFormat:o.getFormat(),collectionSchema:o.getSchema(),filter:e=>{let[t]=e;return!m.includes(t)},spaceId:o.getSpaceId(),restrictCrossSpace:I().default.checkGate({gateName:"collections_xws"})})),[o,m]),h=0===g.length;return(0,K.jsxs)(K.Fragment,{children:[m.length>0&&(0,K.jsx)(U,{actionStore:t,availablePropertyIds:g,collectionStore:o,disabled:u,onPropertyChange:i,onPropertyRemove:s,onPropertyValueChange:c,showSetPropertyActions:d}),!u&&!h&&(0,K.jsx)("div",{style:p.addPropertyRow,children:(0,K.jsx)(L().l,{availablePropertyIds:g,currentValue:void 0,collectionStore:o,onChange:n,disabled:u,alreadyHaveProperties:m.length>0})})]})}function U(e){const{actionStore:t,availablePropertyIds:o,collectionStore:n,onPropertyChange:l,onPropertyRemove:s,onPropertyValueChange:c,showSetPropertyActions:u,disabled:d}=e,{isMobile:p}=(0,i().Y0)(),m=p,g=(0,r().IS)((()=>({wrap:{alignItems:"start",columnGap:4,display:"grid",gridTemplateColumns:m?"100%":"160px 1fr",minWidth:0,rowGap:m?4:8},propertyValue:{...m?{fontSize:14,marginBlockEnd:16}:{}},lastPropertyValue:{...m?{fontSize:14,marginBlockEnd:0}:{}}})),[m]),[h,y]=(0,a().K8)((()=>{const e=t.getConfig();return[(null==e?void 0:e.properties)??[],(null==e?void 0:e.values)??{}]}),[t]);return(0,K.jsx)("div",{style:g.wrap,children:h.map(((e,i)=>{const a=i===h.length-1;return(0,K.jsx)(Y,{actionStore:t,availablePropertyIds:o,collectionStore:n,disabled:d,onPropertyChange:l,onPropertyRemove:s,onPropertyValueChange:c,property:e,showSetPropertyActions:u,value:y[e],valueStyle:a?g.lastPropertyValue:g.propertyValue},e)}))})}function Y(e){const{actionStore:t,availablePropertyIds:o,collectionStore:i,disabled:g,onPropertyChange:h,onPropertyRemove:y,onPropertyValueChange:f,property:x,showSetPropertyActions:S,value:C,valueStyle:A}=e,k={type:"collection",collectionStore:i,property:x},j=(0,m().tz)(),M=(0,r().IS)((e=>({propertyName:{display:"flex"},propertyValue:{display:"flex",gap:4,minWidth:50,...A},propertyValueInput:{minWidth:50}})),[A]),I=(0,n.useMemo)((()=>{if("title"===x)return j.formatMessage(N.titlePlaceholder)}),[j,x]),B=(0,a().K8)((()=>i.getSchema()[x]||i.getDeletedSchema()[x]),[i,x]),_=(0,a().K8)((()=>Boolean(!i.getSchema()[x])),[i,x]),E=(0,a().K8)((()=>{if(B)return(0,d().setPropertyValueToSimpleFormulaReturnType)({table:p().Vl,id:i.id,spaceId:i.getSpaceId()},x,B)}),[i,B,x]),F=(0,n.useMemo)((()=>{if(B&&(0,l().I3)(B))return B.type}),[B]),D=(0,n.useMemo)((()=>B&&!(0,l().I3)(B)),[B]),W=null==C?void 0:C.value,z=(0,a().K8)((()=>(0,c().tz)(C)),[C]),{automationStore:H}=(0,w().EC)(),U=(0,a().K8)((()=>H.getSpaceId()),[H]),Y=(0,V().F)({actionId:t.id}),q=(0,a().K8)((()=>{if(F&&U)return(0,d().analyzeSimpleFormulaOrFormulaSync)({context:{allowedReturnTypes:l().Yy[F],handleDataRequest:(0,u().createFormulaDataRequestSyncHandler)(t.getRecordModel),spaceId:U,valueTypes:Y.slice(0),featureGates:(0,T().i)()},value:null==C?void 0:C.value})}),[t.getRecordModel,Y,U,F,null==C?void 0:C.value]),{suppressActionErrors:$}=(0,R().b)(),Q=(0,n.useMemo)((()=>!$.includes(t.id)),[$,t]),{errorMessage:J}=(0,P().useErrorComponentForAction)({actionId:t.id,errorKey:x,shouldShow:Q}),X=(0,n.useCallback)((e=>{h(x,e)}),[h,x]),ee=(0,n.useCallback)((()=>y(x)),[y,x]),te=(0,n.useCallback)((e=>{f(x,e)}),[f,x]),oe=(0,n.useCallback)((e=>{te({action:e,value:W})}),[W,te]),ne=(0,n.useCallback)((e=>{te({action:z,value:e})}),[z,te]);if(!U)return null;const ie=function(e){if("email"===e||"phone_number"===e||"url"===e)return{disableEmojiCommands:!0,disableFormattingAndMentions:!0};return{}}(F);let ae;return _?ae=(0,K.jsx)(m().sA,{...N.automationActionPropertyDeleted}):D?ae=(0,K.jsx)(m().sA,{...N.automationActionPropertyUnsupported}):J&&(ae=J),(0,K.jsxs)(K.Fragment,{children:[(0,K.jsx)("div",{style:M.propertyName,children:(0,K.jsx)(L().l,{availablePropertyIds:o,currentValue:x,collectionStore:i,onChange:X,disabled:g,onRemove:ee,errorMessage:ae})}),(0,K.jsxs)("div",{style:M.propertyValue,children:[!_&&S&&B&&s().M[B.type]&&(0,K.jsx)(G,{disabled:g,onChange:oe,value:z}),_?(0,K.jsx)(b().A,{disabled:!0,placeholder:j.formatMessage(N.automationActionPropertyDeleted)}):D?(0,K.jsx)(b().A,{disabled:!0,placeholder:j.formatMessage(N.automationActionPropertyUnsupported)}):F&&E?(0,K.jsxs)(v().Y1,{direction:"vertical",gap:7,style:M.propertyValueInput,children:[(0,K.jsx)(Z,{...ie,analyzedFormulaOutput:q,automationActionStore:t,disabled:g,disableMobileActionBar:!0,disableTemplateVariableMentions:!0,simpleFormulaContext:k,formulaTypecheckContextValues:Y,onChange:ne,parentRecordStore:t,placeholder:I,propertyType:F,spaceId:U,type:E,value:null==C?void 0:C.value}),q&&(0,K.jsx)(O().J,{analyzedFormulaOutput:q})]}):null]})]})}function G(e){const{disabled:t,onChange:o,value:n}=e,i=(0,r().IS)((e=>({button:{boxShadow:e.inputBoxShadow,minWidth:120}})),[]),a=(0,F().j)();return(0,K.jsx)(S().Ay,{popupType:a,alignmentToOrigin:S().yP.End,placementToOrigin:S().sx.Bottom,originGap:0,disabled:t,renderOrigin:e=>(0,K.jsx)(D().x,{...e,disabled:t,style:i.button,dropdownButtonType:"button",children:(0,K.jsx)($,{action:n})}),render:e=>(0,K.jsx)(q,{onChange:o,parent:e,value:n})})}function q(e){const{value:t,onChange:o,parent:n}=e,i=(0,E().e)({width:250}),a=g().oE(c().Au.map(((e,i)=>({key:i,render:o=>(0,K.jsx)(x().A,{...o,disabled:!1,title:(0,K.jsx)($,{action:e}),checkState:t===e}),action:()=>{e!==t&&o(e),n.close()}}))));return(0,K.jsx)(C().A,{...i,children:(0,K.jsx)(A().Ay,{type:A().Oh.Vertical,sections:[{key:0,render:e=>(0,K.jsx)(k().A,{enableActionSheetTitle:!0,...e}),items:a}],initialFocus:0})})}function $(e){const{action:t}=e;return"replace"===t?(0,K.jsx)(m().sA,{...N.replaceActionLabel}):"append"===t?(0,K.jsx)(m().sA,{...N.appendActionLabel}):"remove"===t?(0,K.jsx)(m().sA,{...N.removeActionLabel}):"toggle"===t?(0,K.jsx)(m().sA,{...N.toggleActionLabel}):void(0,h().HB)(t)}function Z(e){const{analyzedFormulaOutput:t={},automationActionStore:o,disabled:a,disableEmojiCommands:s,disableFormattingAndMentions:c,disableMobileActionBar:u,disableTemplateVariableMentions:d,formulaTypecheckContextValues:p,onChange:m,parentRecordStore:g,placeholder:h,propertyType:y,simpleFormulaContext:v,spaceId:x,type:S,value:b}=e,{parseErrors:C=[],typeErrors:A=[]}=t,k=C.length>0||A.length>0,{onTextStoreSelect:T,onTextStoreUnselect:I}=(0,_().W)(o),w=(0,r().IS)((e=>({input:{width:"100%"}})),[]),P=(0,i().v3)(),B=(0,n.useCallback)((()=>{f().clear({environment:P})}),[P]);return"text"===S.type?(0,K.jsx)(j().Y,{allowedReturnTypes:l().Yy[y],disabled:a,disableEmojiCommands:s,disableMobileActionBar:u,disableTemplateVariableMentions:d,formulaTypecheckContextValues:p,onChange:m,onTextStoreSelect:T,onTextStoreUnselect:I,onTextEsc:B,parentRecordStore:g,spaceId:x,placeholder:h,style:w.input,shouldShowErrorStyles:k,value:b}):"number"===S.type?(0,K.jsx)(j().Y,{allowedReturnTypes:l().Yy[y],disabled:a,disableEmojiCommands:!0,disableInsertedDeletedAnnotations:!0,disableMentions:!0,disableMobileActionBar:!0,disableStyleAnnotations:!0,formulaTypecheckContextValues:p,onChange:m,onTextStoreSelect:T,onTextStoreUnselect:I,onTextEsc:B,parentRecordStore:g,spaceId:x,style:w.input,shouldShowErrorStyles:k,value:b}):(0,K.jsx)(M().U,{allowedReturnTypes:l().Yy[y],disabled:a,disableEmojiCommands:s,disableFormattingAndMentions:c,disableMobileActionBar:u,disableTemplateVariableMentions:d,formulaTypecheckContextValues:p,onChange:m,parentRecordStore:g,placeholder:h,simpleFormulaContext:v,spaceId:x,type:S,value:b})}},95441:(e,t,o)=>{o.d(t,{A:()=>i});o(296540);var n=o(474848);const i=function(e){const{title:t,href:i,analyticsFrom:a}=e,r=(0,o(484714).v3)();return(0,n.jsx)(o(187485).A,{href:i,onClick:()=>o(148024).FH(r,{from:a}),external:!0,children:(0,n.jsx)(o(497222).A,{icon:o(406533).T,title:t,isGray:!0})})}},101209:(e,t,o)=>{o.d(t,{v:()=>i});o(296540);var n=o(474848);const i=(0,o(340498).wt)("boltFilled",{svg:(0,n.jsx)("path",{d:"M0 12.117c0 .38.293.664.703.664h5.518l-2.91 7.91c-.381 1.006.664 1.543 1.318.723l8.877-11.094c.166-.205.254-.4.254-.625 0-.371-.293-.664-.703-.664H7.539l2.91-7.91C10.83.115 9.785-.422 9.131.408L.254 11.492c-.166.215-.254.41-.254.625z"}),viewBox:"0 0 14 22"})},102777:(e,t,o)=>{o.d(t,{b:()=>i});o(296540);var n=o(474848);const i=(0,o(340498).wt)("sendArrow",{viewBox:"0 0 20 20",svg:(0,n.jsx)("path",{d:"M9.79883 18.5894C14.6216 18.5894 18.5894 14.6216 18.5894 9.79883C18.5894 4.96777 14.6216 1 9.79053 1C4.95947 1 1 4.96777 1 9.79883C1 14.6216 4.96777 18.5894 9.79883 18.5894ZM9.79883 14.3062C9.20947 14.3062 8.76953 13.9077 8.76953 13.3433V9.69922L8.86914 8.00586L8.25488 8.84424L7.3916 9.81543C7.23389 10.0063 6.98486 10.1143 6.72754 10.1143C6.21289 10.1143 5.84766 9.75732 5.84766 9.25928C5.84766 8.99365 5.92236 8.79443 6.12158 8.58691L8.96045 5.61523C9.19287 5.35791 9.4585 5.2417 9.79883 5.2417C10.1309 5.2417 10.4048 5.36621 10.6372 5.61523L13.4761 8.58691C13.667 8.79443 13.75 8.99365 13.75 9.25928C13.75 9.75732 13.3848 10.1143 12.8618 10.1143C12.6128 10.1143 12.3638 10.0063 12.2061 9.81543L11.3428 8.86914L10.7202 7.99756L10.8281 9.69922V13.3433C10.8281 13.9077 10.3799 14.3062 9.79883 14.3062Z"})})},112698:(e,t,o)=>{o.d(t,{B:()=>y});o(296540);var n=()=>o(484714),i=()=>o(56366),a=()=>o(401497),r=()=>o(959013),l=()=>o(100622),s=()=>o(534177),c=()=>o(284371),u=()=>o(824160),d=()=>o(859428),p=()=>o(962730),m=()=>o(351360),g=()=>o(991249),h=o(474848);function y(e){let{upsell:t,mobileStyle:o,desktopStyle:y,analyticsName:f,onClick:v,disableTooltip:x}=e;const S=(0,a().DP)(),b=(0,n().v3)(),{device:C}=b,A=(0,i().K8)((()=>{const{currentSpaceStore:e}=m().default.state;return null==e?void 0:e.canAdmin()}),[]),k=(0,i().K8)((()=>function(e,t){if("product"!==e.type)return{};switch(e.product){case"plus":case"business":case"enterprise":return{color:t.blueColor,background:"light"===t.mode?l().Ay.diffBackground:"rgba(35, 131, 226, 0.2)",fontWeight:c().Wy.medium};default:return{}}}(t,S)),[t,S]);if("product"!==t.type)return null;if(C.isMobileNative)return null;const j=(()=>{switch(t.product){case"personal":return(0,h.jsx)(r().sA,{defaultMessage:"Personal Pro",id:"upgradeButton.personal.text"});case"plus":return(0,h.jsx)(r().sA,{defaultMessage:"Plus ↗",id:"upgradeButton.plus.textWithArrow"});case"business":return(0,h.jsx)(r().sA,{defaultMessage:"Business ↗",id:"upgradeButton.business.textWithArrow"});case"enterprise":return(0,h.jsx)(r().sA,{defaultMessage:"Enterprise ↗",id:"upgradeButton.enterprise.textWithArrow"});case"ai":return(0,h.jsx)(r().sA,{defaultMessage:"AI ↗",id:"upgradeButton.ai.textWithArrow"});case"sites_custom_hostnames":return(0,h.jsx)(r().sA,{defaultMessage:"Custom Hostnames ↗",id:"upgradeButton.sites_custom_hostnames.textWithArrow"});default:(0,s().HB)(t.product)}})();return C.isMobile||!A?(0,h.jsx)(u().A,{mobileStyle:o,children:j}):(0,h.jsx)(d().A,{delayThreshold:120,disableTooltip:x,placement:p().W.Bottom,renderTooltip:()=>(0,h.jsx)("div",{style:{maxWidth:500},children:(0,h.jsx)(r().sA,{defaultMessage:"Upgrade to use this feature.",id:"premiumFeatureUpgradeButton.upgrade.tooltip"})}),originGap:6,render:e=>(0,h.jsx)(u().A,{desktopStyle:y,innerStyle:k,onClick:e=>function(e,t,o,n,i){g().K(n,{from:t,upsell:o}),i&&i(e)}(e,f,t,b,v),...e,children:j})})}},118849:(e,t,o)=>{o.d(t,{A:()=>d});o(296540);var n=()=>o(56366),i=()=>o(979340),a=()=>o(959013),r=()=>o(100622),l=()=>o(284371),s=()=>o(824160),c=()=>o(991249),u=o(474848);const d=function(e){let{subscriptionTier:t,mobileStyle:d,desktopStyle:p,analyticsName:m,onClick:g,disableTooltip:h}=e;const y=(0,o(401497).DP)(),f=(0,o(484714).v3)(),{device:v}=f,x=(0,n().K8)((()=>{const{currentSpaceStore:e}=o(351360).default.state;return null==e?void 0:e.canAdmin()}),[]),S=(0,n().K8)((()=>function(e,t){switch(e){case"plus":case"business":case"enterprise":return{color:t.blueColor,background:"light"===t.mode?r().Ay.diffBackground:"rgba(35, 131, 226, 0.2)",fontWeight:l().Wy.medium};default:return{}}}(t,y)),[t,y]);if(v.isMobileNative)return null;let b;return"personal"===t?b=(0,u.jsx)(a().sA,{defaultMessage:"Personal Pro",id:"upgradeButton.personal.text"}):(0,i().$P)(t)?b=(0,u.jsx)(a().sA,{defaultMessage:"Plus ↗",id:"upgradeButton.plus.textWithArrow"}):(0,i().tL)(t)?b=(0,u.jsx)(a().sA,{defaultMessage:"Business ↗",id:"upgradeButton.business.textWithArrow"}):(0,i().OX)(t)?b=(0,u.jsx)(a().sA,{defaultMessage:"Enterprise ↗",id:"upgradeButton.enterprise.textWithArrow"}):(0,o(534177).HB)(t),v.isMobile||!x?(0,u.jsx)(s().A,{mobileStyle:d,children:b}):(0,u.jsx)(o(859428).A,{delayThreshold:120,disableTooltip:h,placement:o(962730).W.Bottom,renderTooltip:()=>(0,u.jsx)("div",{style:{maxWidth:500},children:(0,u.jsx)(a().sA,{defaultMessage:"Upgrade to use this feature.",id:"upgradeButton.upgrade.tooltip"})}),originGap:6,render:e=>(0,u.jsx)(s().A,{desktopStyle:p,innerStyle:S,onClick:e=>function(e,t,o,n,i){c().K(n,{from:t,upsell:{type:"product",product:o,limit:{type:"none"}}}),i&&i(e)}(e,m,t,f,g),...e,children:b})})}},150987:(e,t,o)=>{o.d(t,{A:()=>g});o(898992),o(354520),o(581454),o(737550);var n=o.n(o(844751)),i=o(296540),a=()=>o(970013),r=()=>o(713998),l=()=>o(959013),s=()=>o(496603),c=()=>o(722872),u=()=>o(939740),d=()=>o(89924),p=()=>o(250202),m=o(474848);const g=function(e){let{selectedProperty:t,onAccept:g,schema:h,onClose:y,allowProperty:f,isRelationProperty:v}=e;const x=(0,o(484714).v3)(),S=(0,l().tz)(),[b,C]=(0,i.useState)("");let A=Object.keys(h);const k=A.some(o(443239).u);A=s().Ul(A,(e=>{const t=(0,r()._g)({schema:h,property:e});return t?t.name:""}));const j=k?a().Ho:a().rn;if(A=s().FF(A,j),A.unshift(j),f&&(A=A.filter((e=>{const t=(0,r()._g)({schema:h,property:e});return t&&f(t)}))),b){let e=A.map((e=>{const t=(0,r()._g)({schema:h,property:e});return t&&t.name}));e=n().filter(b,e).map((e=>{let{original:t}=e;return t})),A=A.filter((t=>{const o=(0,r()._g)({schema:h,property:t});return o&&o.name&&e.includes(o.name)}))}const M=b||A.length>o(525432).R8,T=s().oE(A.map((e=>{const o=(0,r()._g)({schema:h,property:e});if(!o)return null;return{key:e,render:n=>(0,m.jsx)(p().G,{...n,propertySchema:o,format:p().e.Name,checkState:e===t}),action:()=>g(e)}}))),I=[{key:0,render:e=>(0,m.jsx)(d().A,{...e}),items:T}],{device:w}=x,P=M?(0,m.jsx)(d().A,{isInput:!0,children:(0,m.jsx)(o(419357).Ay,{focus:!w.isMobile||void 0,focusAfterAnimation:!0,value:b,onChange:e=>C(e.target.value),placeholder:v?S.formatMessage({defaultMessage:"Search for a relation property…",id:"propertySelectMenu.searchForProperty.relation.placeholder"}):S.formatMessage({defaultMessage:"Search for a property…",id:"propertySelectMenu.searchForProperty.default.placeholder"})})}):null;let B;return B=w.isMobile?{menuType:c().gu.Modal,title:v?S.formatMessage({defaultMessage:"Relation property",id:"propertySelectMenu.mobileMenu.relationProperty.header"}):S.formatMessage({defaultMessage:"Property",id:"propertySelectMenu.mobileMenu.property.header"}),right:(0,m.jsx)(o(45552).CancelMenuText,{}),onClickRight:y,header:P}:{menuType:c().gu.Popup,width:280,maxHeight:480,header:P},(0,m.jsx)(o(928600).A,{...B,children:0===T.length?(0,m.jsx)(d().A,{children:(0,m.jsx)(o(64e3).A,{title:(0,m.jsx)(l().sA,{defaultMessage:"No results",id:"propertySelectMenu.search.noResults.title"})})}):(0,m.jsx)(u().Ay,{type:u().Oh.Vertical,sections:I,onAccept:y,initialFocus:b.length>0?0:void 0})})}},164891:(e,t,o)=>{o.d(t,{y:()=>a});var n=()=>o(56366),i=()=>o(508496);function a(e){const{experimentId:t,groups:o,disableExposureLogging:a}=e,r=function(e){const{experimentId:t,disableExposureLogging:o,defaultGroup:a}=e;return(0,n().K8)((()=>i().default.getEligibleGroup({experimentId:t,defaultGroup:a??"control",disableExposureLogging:o})),[t,o,a])}({experimentId:t,disableExposureLogging:a});return o[r]}},170356:(e,t,o)=>{o.d(t,{NS:()=>d,Pq:()=>g,Z3:()=>u,sw:()=>p});o(296540);var n=()=>o(484714),i=()=>o(297872),a=()=>o(928600),r=()=>o(678553),l=()=>o(45552),s=()=>o(722872),c=o(474848);const u=8,d=8,p=32,m={height:p+u-2,paddingTop:u-2};function g(e){let{title:t,helpButton:o,onCancel:r,desktopMinWidth:u,desktopMaxWidth:d,desktopWidth:p,children:m}=e;const{device:g}=(0,n().v3)();return(0,c.jsx)(i().A,{capture:!0,allowEsc:!0,allowUndo:!0,render:e=>{let n;return n=g.isMobile?{menuType:s().gu.Modal,title:t,right:(0,c.jsx)(l().DoneMenuText,{}),onClickRight:r,...e}:{menuType:s().gu.Popup,...u&&{minWidth:u},...d&&{maxWidth:d},...p&&{width:p},...e},(0,c.jsx)(a().A,{...n,header:t&&(0,c.jsx)(h,{title:t,helpButton:o}),children:m})}})}function h(e){let{title:t,helpButton:o}=e;return(0,n().v3)().device.isMobile?null:(0,c.jsx)(r().A,{style:m,title:t,right:o})}},199734:(e,t,o)=>{o.d(t,{U:()=>i});o(296540);var n=o(474848);const i=(0,o(340498).wt)("collectionSearch",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M0 6.35938C0 9.86719 2.85156 12.7188 6.35938 12.7188C7.66406 12.7188 8.85938 12.3203 9.85938 11.6406L13.4531 15.2344C13.6719 15.4609 13.9766 15.5625 14.2812 15.5625C14.9453 15.5625 15.4219 15.0625 15.4219 14.4141C15.4219 14.1016 15.3125 13.8125 15.1016 13.5938L11.5312 10.0156C12.2734 8.99219 12.7188 7.72656 12.7188 6.35938C12.7188 2.85156 9.86719 0 6.35938 0C2.85156 0 0 2.85156 0 6.35938ZM1.65625 6.35938C1.65625 3.76562 3.75781 1.65625 6.35938 1.65625C8.95312 1.65625 11.0625 3.76562 11.0625 6.35938C11.0625 8.95312 8.95312 11.0625 6.35938 11.0625C3.75781 11.0625 1.65625 8.95312 1.65625 6.35938Z"})})},200582:(e,t,o)=>{o.d(t,{m:()=>i});o(296540);const n={viewBox:"0 0 20 20",svg:(0,o(474848).jsx)("path",{d:"M11.633 1.812c.263.096.43.354.41.632l-.392 5.51h3.099a.625.625 0 0 1 .506.992l-6.18 8.54a.625.625 0 0 1-1.13-.412l.402-5.5H5.25a.625.625 0 0 1-.507-.99l6.17-8.55a.625.625 0 0 1 .72-.222m-5.161 8.513H9.02a.625.625 0 0 1 .623.67l-.29 3.976 4.173-5.766H10.98a.625.625 0 0 1-.623-.67l.284-3.987z"})},i=(0,o(340498).wt)("lightning",n)},217827:(e,t,o)=>{o.d(t,{A:()=>a});var n=()=>o(821062);class i extends(()=>o(757695))().default{getInitialState(){return{automationActionStore:void 0,automationStore:void 0,contextType:void 0,typecheckResult:void 0}}blur(e){void 0!==this.state.automationStore&&(void 0===e||(0,n().A)(this.state,e))&&this.setState({automationActionStore:void 0,automationStore:void 0,contextType:void 0,typecheckResult:void 0})}focus(e){(0,n().A)(this.instanceState,e)||this.setState(e)}}const a=new i;(0,o(604341).exposeDebugValue)("AutomationFocusStore",i)},237985:(e,t,o)=>{o.d(t,{II:()=>y,qC:()=>f});var n=o(296540),i=()=>o(56366),a=()=>o(401497),r=()=>o(791089),l=()=>o(164153),s=()=>o(959013),c=()=>o(284371),u=()=>o(214973),d=()=>o(741310),p=()=>o(807787),m=()=>o(27511),g=()=>o(16707),h=o(474848);function y(e){const{actionMenu:t,buttonPopupStore:o,disabled:y,onClick:v,propertySchema:x,value:S}=e,b=(0,s().tz)(),C=(0,a().IS)((()=>({content:{alignItems:"baseline"},propertyName:{...c().RC,fontWeight:c().Wy.medium}})),[]),A=(0,i().K8)((()=>function(e){const{intl:t,propertySchema:o,styles:n,value:i}=e;if(!i)return;const a=(0,h.jsx)("span",{style:n.propertyName,children:o.name});if("formula"===i.type)return(0,h.jsx)(s().sA,{...(0,u().qx)({propertyName:a,propertyValue:(0,h.jsx)(g().g,{returnType:{type:"text"}})})});const l=(0,r().fromSimpleFormulaArrayValue)(null==i?void 0:i.value)[0];if("string"!=typeof l)return;const c=(0,m().a)({intl:t,groupValues:[],optionValues:[l],propertySchema:o});if(0===c.length)return;return(0,h.jsx)(s().sA,{...(0,u().qx)({propertyName:a,propertyValue:c})})}({intl:b,propertySchema:x,styles:C,value:S})),[b,x,C,S]),k=(0,i().K8)((()=>f({intl:b,propertySchema:x,value:S})),[b,x,S]),j=(0,n.useCallback)((e=>(0,h.jsx)(p().aX,{...e,actionMenu:t,buttonPopupStore:o,disabled:y,icon:l().T,onClick:v,children:(0,h.jsx)("div",{style:C.content,children:A})})),[t,o,y,v,C.content,A]);return A&&k?(0,h.jsx)(d().P,{renderOrigin:j,title:k}):null}function f(e){const{intl:t,propertySchema:o,value:n}=e;if(!n)return;const i=o.name;if("formula"===n.type)return(0,h.jsx)(s().sA,{...(0,u().qx)({propertyName:i,propertyValue:(0,h.jsx)(g().L,{})})});const a=(0,r().fromSimpleFormulaArrayValue)(null==n?void 0:n.value)[0];if("string"!=typeof a)return;const l=(0,m().a)({intl:t,isText:!0,groupValues:[],optionValues:[a],propertySchema:o});return 0!==l.length?(0,h.jsx)(s().sA,{...(0,u().qx)({propertyName:i,propertyValue:l})}):void 0}},247345:(e,t,o)=>{o.d(t,{J:()=>m});o(296540);var n=()=>o(484714),i=()=>o(56366),a=()=>o(102777),r=()=>o(959013),l=()=>o(285790),s=()=>o(35392),c=()=>o(859428),u=()=>o(962730),d=()=>o(286088),p=o(474848);function m(e){const t=(0,r().tz)(),{onSubmit:o,canSend:m}=e,g=(0,d().q2)(),h=(0,n().v3)(),y=(0,i().K8)((()=>h.device.isPhone),[h]),f=t.formatMessage({id:"completions.CompletionMenuActionBar.sendTooltip",defaultMessage:"Send to AI"});return(0,p.jsx)(c().A,{renderTooltip:()=>(0,p.jsxs)("div",{children:[f,(0,p.jsx)(s().A,{style:g.keyboardShortcutInverted,name:"enter"})]}),placement:u().W.Bottom,render:e=>(0,p.jsx)(l().A,{icon:a().b,onClick:o,isPurple:m,disabled:!m,iconStyle:{height:y?24:20,width:y?24:20},ariaLabel:f,style:{pointerEvents:"auto",height:y?24:20,width:y?24:20},...e})})}},250202:(e,t,o)=>{o.d(t,{G:()=>l,e:()=>r});var n=o(296540),i=()=>o(401497),a=o(474848);let r=function(e){return e[e.Name=0]="Name",e[e.Type=1]="Type",e}({});const l=n.forwardRef((function(e,t){const{propertySchema:n,format:l,locked:s}=e,{name:c,type:u,icon:d}=n,{isMobile:p}=(0,o(484714).Y0)(),m=(0,i().IS)((e=>({propertyIcon:{fill:e.regularIconColor,marginLeft:6,marginRight:2}})),[]),g=(0,i().DP)(),h=l===r.Name?c:o(682146).dC[u];return(0,a.jsx)(o(760217).A,{title:h,icon:(0,a.jsx)(o(743176).Ay,{icon:d,type:u,size:p?18:16,theme:g,style:m.propertyIcon}),disabled:s,...e})}))},270483:(e,t,o)=>{o.d(t,{g:()=>l});o(296540);var n=()=>o(654601),i=()=>o(278589),a=o(474848);const r=16/(0,i().N)("small");function l(e){const{variant:t}=e,o=function(e){return(0,i().N)(e)*r}(t);return(0,a.jsx)(a.Fragment,{children:(0,n().X)({width:o,pointerEvents:"none"})})}},276936:(e,t,o)=>{o.d(t,{h:()=>r});o(898992),o(737550);var n=()=>o(973647),i=()=>o(534177),a=()=>o(527871);function r(e){const{environment:t,typecheckResult:o,automationStore:r}=e,l=null==r?void 0:r.getTriggerType();if((0,i().O9)(l)){if(!(0,a().V)({triggerType:l,environment:t,automationStore:r}))return!0}return!n().Q.isFail(o)&&Object.values(o.value.actionValidationFailures).some((e=>null==e?void 0:e.some((e=>"requires_subscription_upgrade"===e.type))))}},288739:(e,t,o)=>{o.d(t,{M:()=>i});o(296540);const n={viewBox:"0 0 16 16",svg:(0,o(474848).jsx)("path",{d:"m4.148 2.661-.23-.269a.55.55 0 1 0-.836.716L4.1 4.294C2.727 5.017 1.61 6.113.914 7.44a1.21 1.21 0 0 0 0 1.128c1.282 2.443 3.987 4.1 7.086 4.1a8.4 8.4 0 0 0 2.854-.493l1.228 1.433a.55.55 0 0 0 .84-.71L4.152 2.666zm1.227 5.34c0-.598.2-1.15.537-1.591l.963 1.123q-.092.218-.094.469a1.22 1.22 0 0 0 1.511 1.184l.963 1.123a2.626 2.626 0 0 1-3.88-2.307m7.475 3.122a7.4 7.4 0 0 0 2.236-2.556 1.21 1.21 0 0 0 0-1.128C13.804 4.997 11.099 3.34 8 3.34a8.5 8.5 0 0 0-1.68.166l1.605 1.87H8a2.626 2.626 0 0 1 2.582 3.101z"})},i=(0,o(340498).wt)("eyeSlashFillSmall",n)},299960:(e,t,o)=>{o.d(t,{U:()=>i});o(296540);var n=o(474848);const i=(0,o(340498).wt)("pause",{viewBox:"0 0 6 8",svg:(0,n.jsx)("path",{d:"M1.008 7.473q-.294 0-.442-.149t-.144-.441V1.477q0-.29.148-.438.15-.148.438-.148h.937q.29.003.438.148.148.144.148.438v5.406q0 .292-.148.441-.15.15-.438.149zm3.047 0q-.297 0-.446-.149-.144-.149-.144-.441V1.477q0-.29.148-.438.149-.148.442-.148h.933q.293 0 .438.148.148.144.148.438v5.406q0 .292-.148.441-.145.15-.438.149z"})})},307159:(e,t,o)=>{o.d(t,{A:()=>T,m:()=>M});var n=o(296540),i=()=>o(56366),a=()=>o(401497),r=()=>o(784892),l=()=>o(869190),s=()=>o(977345),c=()=>o(791089),u=()=>o(416504),d=()=>o(758219),p=()=>o(919709),m=()=>o(959013),g=()=>o(534177),h=()=>o(284371),y=()=>o(684125),f=()=>o(419830),v=()=>o(881690),x=()=>o(214973),S=()=>o(133518),b=()=>o(741310),C=()=>o(807787),A=()=>o(436876),k=()=>o(16707),j=o(474848);function M(e){const{actionMenu:t,automationActionStore:o,buttonPopupStore:M,disabled:w,onClick:P,propertySchema:B,value:R,valueContext:_}=e,V=(0,m().tz)(),E=(0,a().IS)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"wrap",whiteSpace:"pre"},propertyName:{...h().RC,fontWeight:h().Wy.medium}})),[]),F=(0,S().F)({actionId:o.id}),D=(0,i().K8)((()=>function(e){const{intl:t,propertySchema:o,styles:n,typecheckContextValues:i,value:a,valueContext:d}=e,S=(0,j.jsx)("span",{style:n.propertyName,children:o.name});if(void 0===(null==a?void 0:a.value))return(0,j.jsx)(m().sA,{...x().NW({propertyName:S})});let b;const C="formula"===a.type,M=(0,c().fromSimpleFormulaArrayValue)(null==a?void 0:a.value)[0];if(C)b=(0,j.jsx)(k().g,{returnType:{type:"date"}});else if(!(0,g().O9)(M)||"string"==typeof M||"boolean"==typeof M||(0,p().rie)(M)||(0,p().jIt)(M))b=(0,j.jsx)(v().A,{format:r().NY.Medium,isRound:!0,isSingle:!0,shouldShrink:!0,showRemoveButton:!1,value:(0,j.jsx)("span",{style:h().RC,children:(0,j.jsx)(m().sA,{...x().CV.unknownValue})})});else if((0,p().s1Y)(M)){const e=(0,p().iVq)(M).id,t=(0,s().IV)(i,e);b=t?(0,j.jsx)(y().F,{value:t,format:r().NY.Medium,isSingle:!1,shouldShrink:!0}):(0,j.jsx)(v().A,{format:r().NY.Medium,isRound:!0,isSingle:!0,shouldShrink:!0,showRemoveButton:!1,value:(0,j.jsx)("span",{style:h().RC,children:(0,j.jsx)(m().sA,{...x().CV.unknownValue})})})}else if((0,p().qsB)(M)){const e=(0,f().aS)(d),o=(0,p().K7D)(M);b=o?(0,l().zV)({value:o,date_format:e.dateFormat,time_format:e.timeFormat,userTimeZone:(0,u().P)(),allowRelativeDates:!0,intl:t,shortenDateAndRange:!0,displayInUserTimezone:!0,formatValuesFn:e=>{let{endDate:t,endTime:o,startDate:n}=e;return(0,g().O9)(o)?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(I,{value:n})," → ",(0,j.jsx)(I,{value:o})]}):(0,g().O9)(t)?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(I,{value:n})," → ",(0,j.jsx)(I,{value:t})]}):(0,j.jsx)(I,{value:n})}}):null}else{if((0,p().iz3)(M))return(0,j.jsx)(A().A,{token:M});(0,g().HB)(M)}return void 0===b?void 0:(0,j.jsx)(m().sA,{...x().Oo({propertyName:S,propertyValue:b})})}({intl:V,propertySchema:B,styles:E,typecheckContextValues:F,value:R,valueContext:_})),[V,B,E,F,R,_]),L=(0,i().K8)((()=>T({intl:V,propertySchema:B,typecheckContextValues:F,value:R,valueContext:_})),[V,B,F,R,_]),O=(0,n.useCallback)((e=>(0,j.jsx)(C().aX,{...e,actionMenu:t,buttonPopupStore:M,disabled:w,icon:d().Z,onClick:P,children:(0,j.jsx)("div",{style:E.content,children:D})})),[t,M,w,P,E.content,D]);return D&&L?(0,j.jsx)(b().P,{disable:w,renderOrigin:O,title:L}):null}function T(e){const{intl:t,propertySchema:o,typecheckContextValues:n,value:i,valueContext:a}=e,r=o.name;if(void 0===(null==i?void 0:i.value))return(0,j.jsx)(m().sA,{...x().NW({propertyName:r})});let d;const h="formula"===i.type,y=(0,c().fromSimpleFormulaArrayValue)(i.value)[0];if(h)d=(0,j.jsx)(k().L,{});else if(!(0,g().O9)(y)||"string"==typeof y||"boolean"==typeof y||(0,p().rie)(y)||(0,p().jIt)(y)||(0,p().iz3)(y))d=(0,j.jsx)(m().sA,{...x().CV.unknownValue});else if((0,p().s1Y)(y)){const e=(0,p().iVq)(y).id,t=(0,s().IV)(n,e);d=t?(0,s().sM)(t):(0,j.jsx)(m().sA,{...x().CV.unknownValue})}else if((0,p().qsB)(y)){const e=(0,f().aS)(a),o=(0,p().K7D)(y);d=o?(0,l().ZF)({value:o,date_format:e.dateFormat,time_format:e.timeFormat,userTimeZone:(0,u().P)(),allowRelativeDates:!0,intl:t,shortenDateAndRange:!0,displayInUserTimezone:!0}):null}else(0,g().HB)(y);return void 0===d?void 0:(0,j.jsx)(m().sA,{...x().Oo({propertyName:r,propertyValue:d})})}function I(e){const{value:t}=e,o=(0,a().IS)((e=>({token:{marginBlockEnd:4},tokenBackgroundColor:{backgroundColor:e.accentColors.gray[75]}})),[]);return(0,j.jsx)(v().A,{backgroundColor:o.tokenBackgroundColor.backgroundColor,format:r().NY.Medium,isRound:!0,isSingle:!0,showRemoveButton:!1,style:o.token,value:t})}},311004:(e,t,o)=>{e.exports=o.p+"edfba4a6d1ff7acd.png"},328347:(e,t,o)=>{o.d(t,{h:()=>i});o(296540);var n=o(474848);const i=(0,o(340498).wt)("globe2",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M8 15.126C11.8623 15.126 15.0615 11.9336 15.0615 8.06445C15.0615 4.20215 11.8623 1.00293 7.99316 1.00293C4.13086 1.00293 0.938477 4.20215 0.938477 8.06445C0.938477 11.9336 4.1377 15.126 8 15.126ZM3.88477 3.76465C4.56836 3.11523 5.39551 2.61621 6.31836 2.34277C5.83301 2.82812 5.42285 3.51172 5.11523 4.3457C4.63672 4.19531 4.22656 3.99707 3.88477 3.76465ZM9.68848 2.34961C10.6045 2.62305 11.4316 3.11523 12.1084 3.76465C11.7734 4.00391 11.3633 4.19531 10.8848 4.35254C10.5771 3.51172 10.167 2.82812 9.68848 2.34961ZM8.47852 2.56836C9.0459 2.8418 9.56543 3.58008 9.93457 4.58496C9.4834 4.66699 8.99805 4.71484 8.47852 4.73535V2.56836ZM6.06543 4.58496C6.44141 3.58008 6.9541 2.8418 7.52148 2.56836V4.73535C7.00195 4.71484 6.5166 4.66699 6.06543 4.58496ZM2.05273 7.58594C2.14844 6.42383 2.58594 5.35059 3.25586 4.46875C3.67285 4.77637 4.21289 5.04297 4.8418 5.24121C4.66406 5.95215 4.54785 6.74512 4.51367 7.58594H2.05273ZM11.4863 7.58594C11.4521 6.74512 11.3359 5.95215 11.1582 5.24121C11.7871 5.04297 12.3271 4.7832 12.7373 4.46875C13.4141 5.35059 13.8516 6.42383 13.9473 7.58594H11.4863ZM5.49121 7.58594C5.52539 6.84082 5.62793 6.12988 5.78516 5.4873C6.33203 5.59668 6.91309 5.66504 7.52148 5.69238V7.58594H5.49121ZM8.47852 7.58594V5.69238C9.08691 5.66504 9.66797 5.59668 10.2148 5.4873C10.3721 6.12988 10.4746 6.84082 10.5088 7.58594H8.47852ZM2.05273 8.54297H4.51367C4.54785 9.39746 4.66406 10.1973 4.8418 10.915C4.21973 11.1133 3.68652 11.373 3.27637 11.6807C2.59277 10.792 2.14844 9.71191 2.05273 8.54297ZM5.49121 8.54297H7.52148V10.4707C6.91992 10.498 6.33203 10.5664 5.79199 10.6689C5.62793 10.0195 5.51855 9.29492 5.49121 8.54297ZM8.47852 10.4707V8.54297H10.5088C10.4814 9.29492 10.3721 10.0195 10.208 10.6689C9.66797 10.5664 9.08691 10.498 8.47852 10.4707ZM11.1582 10.915C11.3428 10.1973 11.4521 9.39746 11.4863 8.54297H13.9473C13.8516 9.71191 13.4072 10.792 12.7236 11.6807C12.3135 11.373 11.7803 11.1133 11.1582 10.915ZM8.47852 11.4277C8.99121 11.4482 9.47656 11.4961 9.9209 11.5781C9.55176 12.5625 9.03906 13.2939 8.47852 13.5605V11.4277ZM6.0791 11.5781C6.52344 11.4961 7.00879 11.4482 7.52148 11.4277V13.5605C6.96094 13.2939 6.44824 12.5625 6.0791 11.5781ZM3.90527 12.3848C4.24023 12.1523 4.65039 11.9609 5.12207 11.8105C5.42969 12.6309 5.83301 13.3008 6.30469 13.7793C5.40234 13.5059 4.58203 13.0205 3.90527 12.3848ZM10.8779 11.8105C11.3496 11.9609 11.7598 12.1523 12.0947 12.3848C11.418 13.0205 10.5977 13.5059 9.69531 13.7793C10.167 13.3008 10.5703 12.6309 10.8779 11.8105Z"})})},347114:(e,t,o)=>{o.d(t,{S:()=>m,j:()=>g});var n=o(296540),i=()=>o(56366),a=()=>o(401497),r=()=>o(281067),l=()=>o(959013),s=()=>o(284371),c=()=>o(741310),u=()=>o(807787),d=()=>o(3867),p=o(474848);const m=5;function g(e){const{action:t,actionMenu:o,buttonPopupStore:g,disabled:h,limit:y=m,onClick:f,propertySchema:v,value:x}=e,S=(0,l().tz)(),b=(0,a().IS)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"wrap",whiteSpace:"pre",lineHeight:1.6},propertyName:{...s().RC,fontWeight:s().Wy.medium}})),[]),C=(0,i().K8)((()=>(0,d().mk)({intl:S,limit:y,propertySchema:v,styles:b,operator:t,value:x})),[S,y,v,b,t,x]),A=(0,i().K8)((()=>(0,d().cI)({intl:S,limit:y,propertySchema:v,operator:t,value:x})),[t,S,y,v,x]),k=(0,n.useCallback)((e=>(0,p.jsx)(u().aX,{...e,actionMenu:o,buttonPopupStore:g,disabled:h,icon:r().v,onClick:f,children:(0,p.jsx)("div",{style:b.content,children:C})})),[o,g,h,f,b.content,C]);return(0,p.jsx)(c().P,{renderOrigin:k,title:A})}},353147:(e,t,o)=>{o.d(t,{b:()=>i});o(296540);var n=o(474848);const i=(0,o(340498).wt)("at",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M.911 8.034c0 4.505 3.049 7.24 7.246 7.24 1.135 0 2.215-.158 2.885-.376.472-.15.622-.397.622-.65a.44.44 0 00-.451-.444 1.3 1.3 0 00-.321.048c-.834.205-1.552.341-2.516.341-3.74 0-6.29-2.255-6.29-6.118 0-3.698 2.407-6.275 6.03-6.275 3.206 0 5.886 1.975 5.886 5.523 0 2.072-.697 3.466-1.825 3.466-.752 0-1.176-.437-1.176-1.183V4.972c0-.37-.205-.595-.554-.595-.341 0-.553.226-.553.595v.779h-.062c-.349-.84-1.203-1.374-2.222-1.374-1.77 0-3.014 1.51-3.014 3.678 0 2.187 1.237 3.712 3.042 3.712 1.06 0 1.88-.575 2.276-1.545h.062c.13.963.943 1.551 2.023 1.551 1.907 0 3.09-1.873 3.09-4.498 0-3.971-2.92-6.548-6.96-6.548C3.886.727.912 3.632.912 8.034zm6.911 2.652c-1.223 0-2.003-1.018-2.003-2.638 0-1.593.786-2.611 2.01-2.611 1.258 0 2.05.998 2.05 2.584 0 1.62-.813 2.665-2.057 2.665z"})})},359186:(e,t,o)=>{o.d(t,{EJ:()=>T,Jx:()=>R,T7:()=>B,Vj:()=>P,Zd:()=>I,ef:()=>w,hF:()=>M});var n=o(296540),i=()=>o(484714),a=()=>o(56366),r=()=>o(401497),l=()=>o(617073),s=()=>o(966098),c=()=>o(818256),u=()=>o(523872),d=()=>o(263931),p=()=>o(352064),m=()=>o(161479),g=()=>o(959013),h=()=>o(284371),y=()=>o(712030),f=()=>o(921855),v=()=>o(546461),x=()=>o(214973),S=()=>o(133518),b=()=>o(741310),C=()=>o(807787),A=()=>o(16707),k=o(474848);function j(e){const{actionMenu:t,automationActionStore:o,buttonPopupStore:l,disabled:s,icon:c,onClick:u,propertySchema:d,value:p}=e,{automationStore:j}=(0,v().EC)(),T=(0,i().v3)(),I=(0,r().DP)(),w=(0,r().IS)((()=>({propertyName:{...h().RC,fontWeight:h().Wy.medium,flexShrink:0}})),[]),P=(0,S().F)({actionId:o.id}),B=(0,a().K8)((()=>function(e){const{automationStore:t,environment:o,propertySchema:n,styles:i,theme:a,typecheckContextValues:r,value:l}=e,s=(0,k.jsx)("span",{style:i.propertyName,children:n.name}),c=void 0===(null==l?void 0:l.value);if(c)return(0,k.jsx)(g().sA,{...x().NW({propertyName:s})});let u;const d="formula"===l.type;if(d)u=(0,k.jsx)(A().g,{returnType:{type:"text"}});else{const e=(0,f().S5)({disabled:!0,disableDateStyleAnnotations:!0,disableHover:!0,disableLinks:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableSuggestionAnnotations:!0,emojiType:(0,y().FN)(o),environment:o,formulaValueTypes:r,katex:o.KatexStore.getKatex(),parentStore:t,stopLinkPropagation:!0,textValue:{value:l.value??[],spaceId:(0,m().e)(t.pointer.spaceId)},theme:a});u=(0,k.jsxs)(k.Fragment,{children:['"',(0,k.jsx)("span",{style:h().RC,children:e}),'"']})}return(0,k.jsx)(g().sA,{...x().LK({propertyName:s,propertyValue:u})})}({automationStore:j,environment:T,propertySchema:d,styles:w,theme:I,typecheckContextValues:P,value:p})),[j,T,d,w,I,P,p]),R=(0,a().K8)((()=>M({automationStore:j,environment:T,propertySchema:d,theme:I,typecheckContextValues:P,value:p})),[j,T,d,I,P,p]),_=(0,n.useCallback)((e=>(0,k.jsx)(C().aX,{...e,actionMenu:t,buttonPopupStore:l,disabled:s,icon:c,onClick:u,children:B})),[t,l,s,c,u,B]);return B&&R?(0,k.jsx)(b().P,{renderOrigin:_,title:R}):null}function M(e){const{automationStore:t,environment:o,propertySchema:n,theme:i,typecheckContextValues:a,value:r}=e,l=n.name;if(void 0===(null==r?void 0:r.value))return(0,k.jsx)(g().sA,{...x().NW({propertyName:l})});let s;return s="formula"===r.type?(0,k.jsx)(A().L,{}):(0,f().S5)({disabled:!0,disableDateStyleAnnotations:!0,disableFormulaVariableStyles:!0,disableHover:!0,disableInsertedDeletedAnnotations:!0,disableLinks:!0,disableStyleAnnotations:!0,disableSuggestionAnnotations:!0,emojiType:(0,y().FN)(o),environment:o,formulaValueTypes:a,katex:o.KatexStore.getKatex(),parentStore:t,stopLinkPropagation:!0,textValue:{value:r.value??[],spaceId:(0,m().e)(t.pointer.spaceId)},theme:i}),(0,k.jsx)(g().sA,{...x().LK({propertyName:l,propertyValue:s})})}function T(e){return(0,k.jsx)(j,{...e,icon:d().D})}function I(e){return(0,k.jsx)(j,{...e,icon:u().U})}function w(e){return(0,k.jsx)(j,{...e,icon:l().J})}function P(e){return(0,k.jsx)(j,{...e,icon:p().I})}function B(e){return(0,k.jsx)(j,{...e,icon:s().E})}function R(e){return(0,k.jsx)(j,{...e,icon:c().C})}},380468:(e,t,o)=>{o.d(t,{A:()=>h});o(944114),o(898992),o(354520),o(581454);var n=o.n(o(844751)),i=o(296540),a=()=>o(959013),r=()=>o(496603),l=()=>o(760217),s=()=>o(939740),c=()=>o(89924),u=()=>o(250202),d=()=>o(972435),p=o(474848);const m=(0,a().YK)({inputPlaceholder:{defaultMessage:"Search for a property…",id:"database.viewSettings.propertySelect.inputPlaceholder"},none:{defaultMessage:"None",id:"database.viewSettings.propertySelect.noneMessage"},remove:{defaultMessage:"Remove",id:"database.viewSettings.propertySelect.removeMessage"}});function g(e){let{currentProperty:t,showNoneOption:g,showRemoveOption:h,getProperties:y,onAccept:f,inputPlaceholder:v,defaultShowPropertyCount:x,schema:S,format:b,renderProperty:C}=e;const A=(0,o(484714).Y0)(),[k,j]=(0,i.useState)(""),[M,T]=(0,i.useState)(!1),I=(0,o(56366).uB)(void 0,o(970585).A),w=(0,o(401497).IS)((e=>({icon:{width:16,fill:e.mediumTextColor,marginLeft:4,marginRight:2},menuItem:{color:e.mediumTextColor}})),[]),[P,B]=(0,o(857437).$)(),R=(0,o(390066).L)(b,S,void 0,o(651124).jf.Page).collection_page_properties||[],_=!x||M,V=d().A.formatMessage(m.none),E=g?{key:"none",render:e=>(0,p.jsx)(l().A,{...e,checkState:!t,title:V}),action:()=>{f(void 0)}}:void 0,F=h?{key:"remove",render:e=>(0,p.jsx)(l().A,{...e,icon:(0,o(735384).I)(w.icon),title:d().A.formatMessage(m.remove)}),action:()=>{f(void 0)}}:void 0,D=y();let L=r().Ul(D,(e=>R.findIndex((t=>t.property===e))));if(k){const e=new Map;let t=L.map((t=>{const n=S[t],i=n?`${n.name} ${o(682146).dC[n.type]}`:"";return e.set(t,i),i}));t=n().filter(k,t).map((e=>{let{original:t}=e;return t})),L=L.filter((o=>t.includes(e.get(o)||"")))}else!_&&x&&(L=L.slice(0,x));const O=r().oE([!k||n().test(k,V)?E:void 0,...L.map((e=>function(e,t,o,n,i){const a=t[e];if(!a)return;const r={key:e,render:t=>{const o=e===n;return i?i(t,e,o,a):(0,p.jsx)(u().G,{...t,propertySchema:a,format:u().e.Name,checkState:o})},action:()=>{o(e)}};return r}(e,S,f,t,C)))]);if(!_&&D.length>L.length&&!k){const e={key:"show_more",render:e=>(0,p.jsx)(l().A,{...e,icon:(0,o(30626)._)(w.icon),style:w.menuItem,title:(0,p.jsx)(a().sA,{defaultMessage:"{moreCount} more",id:"database.viewSettings.propertySelect.showMoreTitle",values:{moreCount:D.length-L.length}})}),action:()=>{T(!0)}};O.push(e)}const K=O.length>0,N=Boolean(k),W=!F||K||N;W&&!K&&O.push({action:r().lQ,key:"noResults",render:e=>(0,p.jsx)(o(736767).A,{...e,caption:(0,p.jsx)(a().sA,{defaultMessage:"No results",id:"database.viewSettings.propertySelect.noResultsTitle"})})});const z=[];return W&&z.push({key:"input",comp:(0,p.jsx)(c().A,{isInput:!0,children:(0,p.jsx)(o(419357).Ay,{focusInitial:!A.isMobile||void 0,focus:!A.isMobile||void 0,value:k,onChange:e=>{j(e.target.value),I.setState({...I.state,focus:{section:0,indexLocal:0,indexGlobal:0,footerFocused:!1}}),T(!1)},placeholder:v||d().A.formatMessage(m.inputPlaceholder),...P})})}),(O.length>0||F)&&z.push({key:"properties",comp:(0,p.jsx)(s().Ay,{type:s().Oh.Vertical,initialFocus:0,comboboxProps:W?B:void 0,sections:[...O.length>0?[{key:"results",render:e=>(0,p.jsx)(c().A,{...e}),items:O}]:[],...F?[{key:"remove",render:e=>(0,p.jsx)(c().A,{topBorder:O.length>0,...e}),items:[F]}]:[]],store:I})}),(0,p.jsx)(p.Fragment,{children:z.map((e=>{let{key:t,comp:o}=e;return(0,p.jsx)(i.Fragment,{children:o},t)}))})}const h=i.memo(g,o(821062).A)},383574:(e,t,o)=>{o.d(t,{V:()=>s});o(898992),o(354520);var n=()=>o(56366),i=()=>o(329333),a=()=>o(352271),r=()=>o(157857),l=()=>o(546461);function s(){const{automationStore:e,contextType:t}=(0,l().EC)(),o=(0,n().K8)((()=>(0,r().Z6)(e,t)),[e,t]);return(0,n().K8)((()=>{if(!o)return[];const{automation:e,automationActions:t}=o,n=e.getTriggerType(),r=(0,a().ad)({isGenericRecurrenceAllowed:!0})[n],l="default_bound"===r.max?a().x3:r.max;if(t.length>=l)return[];return function(e){const t=e=>e?1:-1;return e.slice().sort(((e,o)=>t(o.hasSideEffects)-t(e.hasSideEffects)))}((0,i().getActionRegistryItemsWithConcern)("display").filter((e=>e.isAvailableForContext({...o,isSubscribed:!0}))))}),[o])}},387712:(e,t,o)=>{o.d(t,{A:()=>a});class n extends(()=>o(757695))().default{getInitialState(){return{open:!1}}}const i=new n;(0,o(604341).exposeDebugValue)("AutomationModalStore",i);const a=i},390518:(e,t,o)=>{o.d(t,{A:()=>a});o(296540);var n=()=>o(331542),i=o(474848);function a(){return(0,i.jsx)("div",{style:{alignItems:"center",display:"flex",justifyContent:"center",minHeight:200,overflow:"hidden"},children:(0,i.jsx)(n().A,{})})}},401332:(e,t,o)=>{o.d(t,{A:()=>i});class n extends(()=>o(757695))().default{getInitialState(){return{}}}const i=n},406533:(e,t,o)=>{o.d(t,{T:()=>a});o(296540);var n=o(474848);const i={viewBox:"0 0 20 20",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M9.978 7.154c-.804 0-1.333.456-1.438.874a.625.625 0 0 1-1.213-.303c.28-1.121 1.44-1.82 2.65-1.82 1.365 0 2.714.905 2.714 2.298 0 .812-.49 1.477-1.13 1.872l-.755.516a.84.84 0 0 0-.381.677.625.625 0 1 1-1.25 0c0-.688.36-1.318.921-1.706l.003-.002.784-.535.014-.008c.374-.228.544-.537.544-.814 0-.459-.517-1.049-1.463-1.049m.662 6.336a.8.8 0 1 1-1.6 0 .8.8 0 0 1 1.6 0"}),(0,n.jsx)("path",{d:"M2.375 10a7.625 7.625 0 1 1 15.25 0 7.625 7.625 0 0 1-15.25 0M10 3.625a6.375 6.375 0 1 0 0 12.75 6.375 6.375 0 0 0 0-12.75"})]})},a=(0,o(340498).wt)("questionMarkCircle",i)},413194:(e,t,o)=>{o.d(t,{L:()=>we,g:()=>j});o(898992),o(672577);var n=o(296540),i=()=>o(484714),a=()=>o(56366),r=()=>o(970013),l=()=>o(713998),s=()=>o(784892),c=()=>o(977345),u=()=>o(791089),d=()=>o(919709),p=()=>o(973647),m=()=>o(534177),g=()=>o(529135),h=()=>o(436876),y=()=>o(576241),f=()=>o(546461),v=()=>o(625830),x=()=>o(654734),S=()=>o(512052),b=()=>o(399762),C=()=>o(684125),A=()=>o(419830),k=o(474848);function j(e){const{token:t,disabled:o,setCurrentTokens:n,currentSimpleFormulaValueTokens:j,context:M,parentRecordStore:T}=e,I=(0,i().Y0)(),{typecheckResult:w}=(0,f().YC)(),P=(0,a().K8)((()=>{if("collection"===M.type)return(0,A().aS)(M)}),[M]),B=(0,a().K8)((()=>{if("collection"===M.type)return M.collectionStore.getSchema()[M.property]}),[M]);if("string"==typeof t){if(!B||!(0,r().DQ)(B))return null;const e=(0,l().jy)((null==B?void 0:B.options)??[],t);if(!e)return(0,k.jsx)(g().A,{isSingle:!1,showRemoveButton:!o,onClickRemove:()=>{null==n||n((0,u().simpleFormulaValueWithoutToken)(j,t))}},`deleted_option_value_${t}`);const i={value:e.value,color:e.color,isSingle:!1,showRemoveButton:!o,format:I.isMobile?s().NY.Medium:s().NY.Small,onClickRemove:()=>{null==n||n((0,u().simpleFormulaValueWithoutToken)(j,t))}};if((0,r().DD)(B)){var R;const t=null===(R=B.groups)||void 0===R||null===(R=R.find((t=>{var o;return null===(o=t.optionIds)||void 0===o?void 0:o.includes(e.id)})))||void 0===R?void 0:R.color;return(0,k.jsx)(b().q,{...i,groupColor:t})}return(0,k.jsx)(b().O,{...i})}if("boolean"==typeof t)return(0,k.jsx)(v().A,{checked:t,disabled:!0,size:16,checkSize:12,style:{marginBottom:6}},t.toString());if((0,d().rie)(t))return(0,k.jsx)(y().A,{handleRemoveToken:o?void 0:()=>{null==n||n((0,u().simpleFormulaValueWithoutToken)(j,t))},token:t});if((0,d().s1Y)(t)){const e=(0,d().iVq)(t).id,i=w&&p().Q.isSuccess(w)?(0,c().IV)(w.value.valueTypes,e):void 0;return i?(0,k.jsx)(C().F,{value:i,format:s().NY.Small,isSingle:!1,shouldShrink:!0,showRemoveButton:!o,onClickRemove:()=>{null==n||n((0,u().simpleFormulaValueWithoutToken)(j,t))},style:{margin:"0 6px 6px 0"}}):null}if((0,d().qsB)(t)){const e=j[0],t=e&&(0,u().isAnnotationSimpleValueToken)(e)&&(0,d().qsB)(e)?(0,d().K7D)(e):void 0;return t&&P?(0,k.jsx)(x().A,{value:t,dateFormat:P.dateFormat,timeFormat:P.timeFormat,style:{marginBottom:6}}):null}if((0,d().jIt)(t)){const e=(0,d().v55)(t);return e?(0,k.jsx)(S().A,{format:I.isMobile?s().NY.Medium:s().NY.Small,blockId:e,shouldWrap:!1,shouldShrink:!0,isSingle:!1,parentStore:T,showRemoveButton:!o,relationPropertySchema:void 0,onClickRemove:()=>{null==n||n((0,u().simpleFormulaValueWithoutToken)(j,t))}},e):null}if((0,d().iz3)(t))return(0,k.jsx)(h().A,{token:t});(0,m().HB)(t)}o(18107),o(967357);var M=()=>o(217827),T=()=>o(542339);function I(){const e=(0,f().YC)(),{menuStore:t}=(0,n.useContext)(T().S),{automationActionId:o,insertionPoint:i}=(0,a().K8)((()=>{const e=null==t?void 0:t.getCurrentTab();return{automationActionId:"eventActionProperty"===(null==e?void 0:e.type)?e.actionId:void 0,insertionPoint:null==t?void 0:t.getInsertionPoint()}}),[t]),r=(0,a().K8)((()=>{var t;return o?null===(t=e.automationStore)||void 0===t?void 0:t.findActionStoreById(o):function(e,t){if(!e)return;const o=e.getActionIds(),n=e.getActionStores();if(!t)return;if("beforeActionId"in t){const e=o.indexOf(t.beforeActionId)-1;return e<=0?n.at(0):n.at(e)}if("afterActionId"in t){const e=o.indexOf(t.afterActionId);if(-1===e)return;return n.at(e+1)}(0,m().HB)(t)}(e.automationStore,i)}),[o,i,e.automationStore]);(0,n.useEffect)((()=>{if(e.defined&&p().Q.isSuccess(e.typecheckResult)){const{automationStore:t,contextType:o,typecheckResult:n}=e;return M().A.focus({automationStore:t,contextType:o,typecheckResult:n.value,automationActionStore:r}),function(){M().A.blur({automationStore:t,contextType:o,typecheckResult:n.value,automationActionStore:r})}}}),[r,e])}var w=()=>o(963589),P=()=>o(351360),B=()=>o(999638),R=()=>o(7868),_=()=>o(294852),V=()=>o(621314),E=(o(944114),o(581454),()=>o(401497)),F=(o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(354520),o(908872),()=>o(908006)),D=()=>o(247331),L=()=>o(467730),O=()=>o(959013),K=()=>o(496603),N=()=>o(742971),W=()=>o(258804),z=()=>o(856952),H=()=>o(970585),U=()=>o(120423);function Y(e){let{disabled:t,handleRemoveToken:o,propertySchema:a,token:c}=e;const u=(0,i().Y0)(),d=(0,n.useCallback)((()=>{o&&o(c)}),[o,c]);if("string"!=typeof c||!a||!(0,r().DQ)(a))return null;const p=(0,l().jy)((null==a?void 0:a.options)??[],c);if(!p)return(0,k.jsx)(g().A,{isSingle:!1,showRemoveButton:!t,onClickRemove:d},`deleted_option_value_${c}`);if((0,r().DD)(a)){var m;const e=null===(m=a.groups)||void 0===m||null===(m=m.find((e=>{var t;return null===(t=e.optionIds)||void 0===t?void 0:t.includes(p.id)})))||void 0===m?void 0:m.color;return(0,k.jsx)(b().q,{color:p.color,format:u.isMobile?s().NY.Medium:s().NY.Small,groupColor:e,isSingle:!1,onClickRemove:d,showRemoveButton:!t,value:p.value})}return(0,k.jsx)(b().O,{color:p.color,format:u.isMobile?s().NY.Medium:s().NY.Small,isSingle:!1,onClickRemove:d,showRemoveButton:!t,value:p.value})}var G=()=>o(722872),q=()=>o(928600),$=()=>o(939740),Z=()=>o(64e3),Q=()=>o(45552),J=()=>o(89924),X=()=>o(996027),ee=()=>o(231713),te=()=>o(760217);function oe(e){let{checkState:t,checkType:o,menuArgs:n,onCheckboxClick:a,option:r}=e;const l=(0,i().Y0)();return(0,k.jsx)(te().A,{...n,..."single"===o?{checkState:t}:{},..."multi"===o?{icon:(0,k.jsx)(v().A,{checked:t,size:14,onClick:a})}:{},title:(0,k.jsx)(b().O,{value:r.value,color:r.color,showRemoveButton:!1,isSingle:!0,shouldShrink:!0,format:l.isMobile?s().NY.Large:s().NY.Small}),isTokenTitle:!0})}function ne(e){let{checkState:t,checkType:o,menuArgs:n,onCheckboxClick:a,option:r,group:l}=e;const c=(0,i().Y0)();return(0,k.jsx)(te().A,{...n,..."single"===o?{checkState:t}:{},..."multi"===o?{icon:(0,k.jsx)(v().A,{checked:t,size:14,onClick:a})}:{},title:(0,k.jsx)(b().q,{color:r.color,format:c.isMobile?s().NY.Large:s().NY.Small,groupColor:null==l?void 0:l.color,isSingle:!0,shouldShrink:!0,showRemoveButton:!1,value:r.value},r.value),isTokenTitle:!0})}function ie(e){const{action:t,currentSimpleFormulaValueTokens:o,formulaTypecheckContextValues:l,formulaValueContext:s,isSingle:p,menuProps:g,onChange:h,onClose:y,showClearButton:f=!1,showInputMenuItem:v=!1,showReplaceAddRemoveToggle:x=!1,type:S,value:b,parentRecordStore:C}=e,A=(0,i().Y0)(),j=(0,E().IS)((e=>({replaceAddRemoveToggleButton:{marginLeft:"8px",marginRight:"8px",marginTop:"8px"}})),[]),{footer:M,groupedItems:T,menuListStore:I,noResultsMessage:w,replaceAddRemoveToggleButton:P,searchInput:B,selectItems:R,valueItems:_}=function(e){const{action:t,currentSimpleFormulaValueTokens:o,formulaTypecheckContextValues:l,formulaValueContext:s,isSingle:p,onChange:g,onClose:h,showClearButton:y,showReplaceAddRemoveToggle:f,type:v,value:x}=e,[S,b]=(0,n.useState)(""),C=(0,a().uB)(void 0,H().A),A=(0,i().Y0)(),j=(0,O().tz)(),{collectionStore:M,property:T}=s,I=(0,a().K8)((()=>M.getSchema()[T]),[M,T]),w=I&&(0,r().DD)(I),P=(0,a().K8)((()=>w?I.groups??[]:[]),[w,I]),B=(0,a().K8)((()=>I&&(0,r().DQ)(I)&&I.options||[]),[I]),R=(0,n.useMemo)((()=>l.filter((e=>(0,c().o5)(e.type,{type:"select",collection:v.collection,property:v.property})))),[l,v.collection,v.property]),_=(0,a().K8)((()=>({valueResults:S?(0,L().Ay)(S,R,(e=>e.kind===D().FormulaContextValueKind.ContextValue?e.name:"")):R,selectResults:S?(0,L().Ay)(S,B,(e=>e.value)):B})),[S,R,B]),V=(0,n.useCallback)((()=>{b(""),C.setState({...C.state,focus:{section:0,indexLocal:0,indexGlobal:0,footerFocused:!1}})}),[C]),E=(0,n.useCallback)(((e,o)=>{g(e||x,o||t)}),[t,g,x]),G=(0,n.useCallback)((()=>{p&&F().default.afterNextFlush((()=>{h()}))}),[p,h]),q=(0,n.useCallback)((e=>{E({type:"simple",value:p?(0,u().toSimpleFormulaSingleValue)(e[0]):(0,u().toSimpleFormulaArrayValue)(e)}),G(),V()}),[E,p,G,V]),$=(0,n.useCallback)((()=>{q(o.slice(0,o.length-1))}),[o,q]),Z=(0,n.useCallback)((e=>{q((0,u().simpleFormulaValueWithoutToken)(o,e))}),[o,q]),Q=(0,n.useMemo)((()=>K().oE(o.map(((e,t)=>(0,k.jsx)(Y,{disabled:!1,handleRemoveToken:Z,propertySchema:I,token:e},`select_option_token_${t}`))))),[o,Z,I]),J=(0,n.useMemo)((()=>new Set(K().oE(o.map((e=>(0,u().isAnnotationSimpleValueToken)(e)&&(0,d().s1Y)(e)&&(0,d().iVq)(e).id))))),[o]),X=(0,n.useMemo)((()=>K().oE((_.valueResults??[]).map((e=>{const t=e.kind===D().FormulaContextValueKind.ContextValue&&e.id||"";if(!t||!J.has(t))return{action:p?"replace":"append",currentSimpleFormulaValueTokens:o,onCheckboxClick:G,id:t,isStatusProperty:Boolean(w),setCurrentTokens:q,value:e}})))),[J,o,G,p,w,_.valueResults,q]),ee=p?"single":"multi",te=(0,n.useMemo)((()=>K().oE(_.selectResults??[]).reduce(((e,t)=>{const n=Boolean(o.find((e=>"string"==typeof e&&e===t.value)));return e[t.id]={checkState:n,checkType:ee,group:void 0,id:t.id,isStatusProperty:Boolean(w),onCheckboxClick:()=>{q(p?n?[]:[t.value]:n?(0,u().simpleFormulaValueWithoutToken)(o,t.value):[...o,t.value]),p&&F().default.afterNextFlush((()=>{h()}))},option:t},e}),{})),[ee,o,p,w,h,_.selectResults,q]),oe=(0,n.useMemo)((()=>Object.values(te)),[te]),ne=(0,n.useMemo)((()=>P.map((e=>({items:(e.optionIds??[]).map((e=>te[e])).filter(m().O9),group:e})))),[te,P]),ie=P.length>0&&0===ne.length||0===P.length&&0===oe.length,ae=(0,k.jsx)("div",{style:{...!A.isMobile&&{padding:"0 8px 4px 8px"}},children:(0,k.jsx)(z().Ay,{dontShowBorderBottom:A.isAndroid,focus:!A.isMobile||void 0,focusAfterAnimation:!0,format:z().le.FilterValue,onChange:e=>b(e.target.value),onClearButtonClick:()=>q([]),onRemoveLastToken:$,placeholder:j.formatMessage(N().D.searchPlaceHolder),showClearButton:y,tokens:Q,value:S})}),re=(0,k.jsx)(W().A,{value:x,onChange:E}),le=(0,k.jsx)(U().A,{action:t,handleOnChange:E});return{footer:re,groupedItems:ne,menuListStore:C,noResultsMessage:ie&&j.formatMessage(N().D.noResults),replaceAddRemoveToggleButton:!!f&&le,searchInput:ae,selectItems:oe,valueItems:X}}({action:t,currentSimpleFormulaValueTokens:o,formulaTypecheckContextValues:l,formulaValueContext:s,isSingle:p,onChange:h,onClose:y,showClearButton:f,showReplaceAddRemoveToggle:x,type:S,value:b})||{},V=(0,n.useMemo)((()=>_.map((e=>{const{annotation:t,itemAction:o}=(0,ee().E)({action:e.action,currentSimpleFormulaValueTokens:e.currentSimpleFormulaValueTokens,setCurrentTokens:e.setCurrentTokens,value:e.value});return{key:e.id,render:e=>(0,k.jsx)(X().A,{annotation:t,disabled:!1,formulaTypecheckContextValues:l,menuArgs:e,parentRecordStore:C}),action:o}}))),[l,_,C]),{groupedMenuItems:te,selectMenuItems:ie}=(0,n.useMemo)((()=>{let e=[],t=[];return T.length>0?e=T.map((e=>{let{group:t,items:o}=e;return{key:t.name,render:e=>(0,k.jsx)(J().A,{...e,title:t.name,topBorder:!0}),items:o.map((e=>({key:e.id,render:t=>(0,k.jsx)(ne,{...t,checkState:e.checkState,checkType:e.checkType,group:e.group,menuArgs:t,onCheckboxClick:e.onCheckboxClick,option:e.option}),action:e.onCheckboxClick})))}})):t=R.map((e=>({key:e.id,render:t=>(0,k.jsx)(oe,{...t,checkState:e.checkState,checkType:e.checkType,menuArgs:t,onCheckboxClick:e.onCheckboxClick,option:e.option}),action:e.onCheckboxClick}))),{groupedMenuItems:e,selectMenuItems:t}}),[T,R]),ae=[...V,...ie];let re,le=[];ae.length>0&&le.push({key:"options",render:e=>(0,k.jsx)(J().A,{...e}),items:ae}),te.length>0&&(le=[...le,...te]),re=A.isMobile?{menuType:G().gu.Modal,right:(0,k.jsx)(Q().DoneMenuText,{}),onClickRight:y,footer:M&&(0,k.jsx)(J().A,{topBorder:!0,children:M})}:{menuType:G().gu.Popup,maxHeight:"50vh",width:260,footer:M&&(0,k.jsx)(J().A,{topBorder:!0,children:M}),disableHeaderBorder:!0};const se=(0,k.jsxs)(k.Fragment,{children:[!A.isMobile&&(null==g?void 0:g.header),v&&(0,k.jsx)(J().A,{children:B})]});return(0,k.jsxs)(q().A,{...re,header:se,children:[P&&(0,k.jsx)("div",{style:j.replaceAddRemoveToggleButton,children:P}),w&&(0,k.jsx)(J().A,{children:(0,k.jsx)(Z().A,{title:w})}),le.length>0&&(0,k.jsx)($().Ay,{type:$().Oh.Vertical,initialFocus:0,sections:le,store:I})]})}var ae=()=>o(277871),re=(o(737550),o(16280),()=>o(764880)),le=()=>o(179034),se=()=>o(798880),ce=()=>o(962730),ue=()=>o(630116),de=()=>o(305390),pe=()=>o(859428),me=()=>o(448693);const ge=(0,O().YK)({maximumPeopleSelectedTooltip:{defaultMessage:"Maximum people selected",id:"valuePickerItem.maximumSelectedReached"}});function he(e){const{args:t,checkState:o,checkType:n,context:g,disabled:y,onCheckboxClick:x,parentRecordStore:S,token:C}=e,A=(0,i().Y0)(),j=(0,a().K8)((()=>{if((0,u().isAnnotationSimpleValueToken)(C)&&(0,d().rie)(C)){const e=(0,d().NcG)(C);if(e)return(0,re().xC)({pointer:{table:se().oo,id:e},getRecordValue:S.getRecordModel})}}),[S.getRecordModel,C]),M=(0,a().K8)((()=>g.collectionStore.getSchema()[g.property]),[g]),T=(0,a().K8)((()=>M&&(0,r().DQ)(M)?M.options??[]:[]),[M]),I=(0,a().K8)((()=>M&&(0,r().DD)(M)?M.groups??[]:[]),[M]),{typecheckResult:w}=(0,f().YC)(),P=(0,E().IS)((e=>({disabledMenuItem:{cursor:"not-allowed",opacity:.4}})),[]),B=Boolean(M&&(0,r().DD)(M)),R="single"===n?{checkState:o}:"multi"===n?{icon:(0,k.jsx)(v().A,{style:y?P.disabledMenuItem:void 0,checked:o,size:14,onClick:x,disabled:y})}:{};if("string"==typeof C){if(B){const e=(0,l().jy)(T,C),o=I.find((t=>{var o;return e&&(null===(o=t.optionIds)||void 0===o?void 0:o.includes(e.id))}));return e?(0,k.jsx)(te().A,{...t,...R,title:(0,k.jsx)(b().q,{format:A.isMobile?s().NY.Large:s().NY.Small,isSingle:!0,value:e.value,color:e.color,groupColor:null==o?void 0:o.color,shouldShrink:!0,showRemoveButton:!1},C),isTokenTitle:!0,disabled:y,style:y?P.disabledMenuItem:void 0,...t}):null}{const e=(0,l().jy)(T,C);return e?(0,k.jsx)(te().A,{...t,...R,title:(0,k.jsx)(b().O,{value:e.value,color:e.color,showRemoveButton:!1,isSingle:!0,shouldShrink:!0,format:A.isMobile?s().NY.Large:s().NY.Small}),isTokenTitle:!0,disabled:y,style:y?P.disabledMenuItem:void 0,...t}):null}}if("boolean"==typeof C)return null;if((0,d().rie)(C))return null!=j&&j.asActor&&j.table===se().oo?(0,k.jsx)(te().A,{...t,...R,title:y?(0,k.jsx)(pe().A,{renderTooltip:()=>(0,k.jsx)(O().sA,{...ge.maximumPeopleSelectedTooltip}),placement:ce().W.Right,render:e=>(0,k.jsx)("div",{style:{width:"100%"},...e,children:(0,k.jsx)(me().t_,{isSingle:!0,shouldShrink:!0,format:A.isMobile?me().t_.Format.Large:me().t_.Format.Medium,userValue:j.asActor})})}):(0,k.jsx)(me().t_,{isSingle:!0,shouldShrink:!0,format:A.isMobile?me().t_.Format.Large:me().t_.Format.Medium,userValue:j.asActor}),disabled:y,style:y?P.disabledMenuItem:void 0,isTokenTitle:!0}):null;if((0,d().s1Y)(C)){const e=(0,d().iVq)(C).id,n=w&&p().Q.isSuccess(w)?(0,c().IV)(w.value.valueTypes,e):void 0;return n?(0,k.jsx)(X().A,{checkState:o,contextValue:n,disabled:Boolean(y),menuArgs:t,parentRecordStore:S}):null}if((0,d().qsB)(C))return null;if((0,d().jIt)(C)){const e=(0,d().v55)(C);if(!e)return null;const n=ue().Bv.createChildStore(S,{id:e,table:le().ev});return(0,k.jsx)(de().A,{store:n,checkState:o,hidePath:!0,...t})}if((0,d().iz3)(C))return(0,k.jsx)(h().A,{token:C});(0,m().HB)(C)}function ye(e){const{currentSimpleFormulaValueTokens:t,value:o,setCurrentTokens:n,action:i,context:a,checkType:r,onCheckboxClick:l,isDisabled:s,parentRecordStore:c}=e;if(o.kind!==D().FormulaContextValueKind.ContextValue)throw new Error("Not implemented yet.");const p=Boolean(t.find((e=>(0,u().isAnnotationSimpleValueToken)(e)&&(0,d().s1Y)(e)&&(0,d().iVq)(e).id===o.id))),m=(0,d().CA$)({id:o.id}),g=()=>{n("append"===i?p?(0,u().simpleFormulaValueWithoutToken)(t,m):[...t,m]:[m]),null==l||l()};return{key:o.id,render:e=>(0,k.jsx)(he,{disabled:s,token:m,args:e,checkState:p,checkType:r,context:a,onCheckboxClick:g,parentRecordStore:c}),action:g}}function fe(e){const{context:t,currentSimpleFormulaValueTokens:o,formulaTypecheckContextValues:a,menuProps:r,onChange:l,onClose:s,parentRecordStore:c,value:d}=e,p=(0,O().tz)(),m=(0,i().Y0)(),g=a.filter((e=>"checkbox"===e.type.type)),h=(0,n.useCallback)((e=>{l({type:"simple",value:void 0!==e[0]?(0,u().toSimpleFormulaSingleValue)(e[0]):void 0})}),[l]),y=(0,n.useCallback)((e=>{h(e),s()}),[h,s]),f=K().oE(g.map((e=>ye({currentSimpleFormulaValueTokens:o,value:e,setCurrentTokens:y,action:"replace",context:t,checkType:"single",parentRecordStore:c})))),v=[],x=o.some((e=>!0===e)),S=[...f,...[{key:0,render:e=>(0,k.jsx)(te().A,{title:(0,k.jsx)(O().sA,{...N().D.unchecked}),checkState:!x,...e}),action:()=>{y([!1])}},{key:1,render:e=>(0,k.jsx)(te().A,{title:(0,k.jsx)(O().sA,{...N().D.checked}),checkState:x,...e}),action:()=>{y([!0])}}]],b=void 0!==(null==r?void 0:r.header)?r.header:(0,k.jsx)(J().A,{style:{paddingBottom:0},title:p.formatMessage(N().D.genericMenuHeader)}),C=Boolean(b);v.push({key:"checkbox",render:e=>(0,k.jsx)(J().A,{...e,topBorder:C}),items:S});const A=(0,k.jsx)(J().A,{topBorder:!0,children:(0,k.jsx)(W().A,{onChange:l,value:d})});let j;j=m.isMobile?{menuType:G().gu.Modal,right:(0,k.jsx)(Q().DoneMenuText,{}),onClickRight:s,footer:A}:{menuType:G().gu.Popup,maxHeight:"50vh",width:260,disableHeaderBorder:!0,header:b,footer:A};const M={...j,...r,header:m.isMobile?null:b};return(0,k.jsx)(q().A,{...M,children:(0,k.jsx)($().Ay,{type:$().Oh.Vertical,initialFocus:0,sections:v})})}var ve=()=>o(758219),xe=()=>o(318249),Se=()=>o(597777),be=()=>o(274609),Ce=()=>o(695490),Ae=()=>o(186445),ke=()=>o(645873),je=()=>o(493823),Me=()=>o(285790);function Te(e){const{context:t,currentSimpleFormulaValueTokens:o,disabled:i,onClose:r,setCurrentTokens:l,setInDatePicker:s}=e,c=o[0],p=c&&(0,u().isAnnotationSimpleValueToken)(c)&&d().qsB(c)?d().K7D(c):void 0,m=(0,O().tz)(),g=(0,a().O$)(Ae().XX),h=(0,n.useCallback)((()=>{s(!1)}),[s]),y=(0,n.useCallback)((e=>{e&&(0,Se().kC)(e)?l([d().Ww9(e)]):l([])}),[l]),f=(0,E().IS)((e=>({header:{display:"flex",alignItems:"center",fontSize:12,paddingInline:14,color:e.mediumTextColor,marginTop:8,fontWeight:500},iconWrap:{width:18,height:18,marginRight:4},icon:{width:12,height:12},title:{flex:"1 1 auto"}})),[]),v=(0,a().K8)((()=>(0,A().aS)(t)),[t]);return(0,k.jsx)(ke().u2,{dependency:Ce().cm,children:e=>{let{DatePropertyMenu:t}=e;return(0,k.jsx)(t,{firstDayOfWeek:g,value:p,canConfigureCollection:!1,onChangeValue:y,dateFormat:v.dateFormat,timeFormat:v.timeFormat,onDismiss:r,disabled:i,shouldShowReminder:!1,header:(0,k.jsxs)("div",{style:f.header,children:[(0,k.jsx)(Me().A,{ariaLabel:m.formatMessage(N().D.back),icon:be().L,onClick:h,style:f.iconWrap,iconStyle:f.icon}),(0,k.jsx)("span",{style:f.title,children:(0,k.jsx)(O().sA,{...N().D.pickADate})}),(0,k.jsx)(je().p,{onClick:r,isBlue:!0,children:(0,k.jsx)(Q().DoneMenuText,{})})]}),isTemplatePage:!1})}})}function Ie(e){const{context:t,currentSimpleFormulaValueTokens:o,formulaTypecheckContextValues:a,menuProps:r,onChange:l,onClose:s,parentRecordStore:c,value:d}=e,p=(0,O().tz)(),m=(0,i().Y0)(),[g,h]=(0,n.useState)(!1),y=a.filter((e=>"date"===e.type.type)),f=(0,n.useCallback)((e=>{l({type:"simple",value:void 0!==e[0]?(0,u().toSimpleFormulaSingleValue)(e[0]):void 0})}),[l]),v=(0,n.useCallback)((e=>{f(e),s()}),[f,s]),x=(0,n.useCallback)((()=>{h(!0)}),[]),S=(0,n.useCallback)((()=>{f([]),s()}),[f,s]);if(g)return(0,k.jsx)(Te,{context:t,currentSimpleFormulaValueTokens:o,disabled:!1,onClose:s,setCurrentTokens:f,setInDatePicker:h});const b=void 0!==(null==r?void 0:r.header)?r.header:(0,k.jsx)(J().A,{style:{paddingBottom:0},title:p.formatMessage(N().D.genericMenuHeader)}),C=K().oE(y.map((e=>ye({currentSimpleFormulaValueTokens:o,value:e,setCurrentTokens:v,parentRecordStore:c,action:"replace",context:t,checkType:"single"})))),A=[];if(C.length>0){const e=Boolean(b);A.push({key:"values",render:t=>(0,k.jsx)(J().A,{topBorder:e,...t}),items:C})}const j=(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)(J().A,{topBorder:!0,children:[(0,k.jsx)(xe().A,{icon:ve().Z,title:(0,k.jsx)(O().sA,{...N().D.pickADate}),onClick:x}),(0,k.jsx)(W().A,{onChange:l,value:d})]}),o.length>0&&(0,k.jsx)(J().A,{topBorder:!0,children:(0,k.jsx)(te().A,{title:(0,k.jsx)(O().sA,{...N().D.clear}),focused:!1,onClick:S})})]});let M;M=m.isMobile?{menuType:G().gu.Modal,right:(0,k.jsx)(Q().DoneMenuText,{}),onClickRight:s,footer:j}:{menuType:G().gu.Popup,maxHeight:"50vh",width:260,footer:j,disableHeaderBorder:!0};const T={...M,...r,header:m.isMobile?null:b};return(0,k.jsx)(q().A,{...T,children:(0,k.jsx)($().Ay,{type:$().Oh.Vertical,initialFocus:0,sections:A})})}function we(e){const{action:t,allowedFormulaReturnTypes:o,currentSimpleFormulaValueTokens:i,disableEmojiCommands:r,disableFormattingAndMentions:l,disableMobileActionBar:s,disableTemplateVariableMentions:c,formulaTypecheckContextValues:u,formulaValueContext:d,limit:p,menuProps:g,onChange:h,onClose:y,parentRecordStore:f,showClearButton:v,showInputMenuItem:x,showReplaceAddRemoveToggle:S,type:b,value:C}=e;I();const A="formula"===(null==C?void 0:C.type),j=(0,a().K8)((()=>{var e;return null===(e=P().default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),M=n.useCallback((()=>{h({type:"simple",value:null==C?void 0:C.value})}),[h,null==C?void 0:C.value]),T=(0,w().X)("collections_xws")?"cross_space_and_read_permissions":"read_permissions_only";return A&&j?(0,k.jsx)(B().A,{allowedReturnTypes:o,disabled:!1,formulaTypecheckContextValues:u,onBack:M,onChange:h,onClose:y,parentRecordStore:f,restrictUnaccessibleProperties:T,spaceId:j,value:C}):"person_array"===b.type?(0,k.jsx)(Re,{action:t,currentSimpleFormulaValueTokens:i,formulaTypecheckContextValues:u,formulaValueContext:d,limit:p,menuProps:g,onChange:h,onClose:y,showClearButton:v??!0,showInputMenuItem:x??!0,showFormulaValueItems:!0,showGenericHeader:!0,showReplaceAddRemoveToggle:S,showPersonCheckbox:S,getRecordModel:f.getRecordModel,value:C,parentRecordStore:f}):"collection"!==d.type?null:"text"===b.type?(0,k.jsx)(Be,{currentSimpleFormulaValueTokens:i,disableEmojiCommands:r,disableFormattingAndMentions:l,disableMobileActionBar:s,disableTemplateVariableMentions:c,formulaTypecheckContextValues:u,menuProps:g,onChange:h,onClose:y,parentRecordStore:f,showGenericHeader:!0,value:C}):"number"===b.type?(0,k.jsx)(Pe,{currentSimpleFormulaValueTokens:i,formulaTypecheckContextValues:u,menuProps:g,onChange:h,onClose:y,showGenericHeader:!0,value:C,parentRecordStore:f}):"checkbox"===b.type?(0,k.jsx)(fe,{context:d,currentSimpleFormulaValueTokens:i,formulaTypecheckContextValues:u,menuProps:g,onChange:h,onClose:y,parentRecordStore:f,value:C}):"date"===b.type?(0,k.jsx)(Ie,{context:d,currentSimpleFormulaValueTokens:i,formulaTypecheckContextValues:u,menuProps:g,onChange:h,onClose:y,parentRecordStore:f,value:C}):"block_array"===b.type?(0,k.jsx)(_e,{action:t,collection:"block_array"===b.type?b.collection:void 0,currentSimpleFormulaValueTokens:i,formulaTypecheckContextValues:u,formulaValueContext:d,menuProps:g,onChange:h,onClose:y,showClearButton:v??!0,showFormulaValueItems:!0,showGenericHeader:!0,showInputMenuItem:x??!0,showReplaceAddRemoveToggle:S,value:C,parentRecordStore:f}):"select"===b.type?(0,k.jsx)(ie,{currentSimpleFormulaValueTokens:i,formulaTypecheckContextValues:u,formulaValueContext:d,isSingle:!0,menuProps:g,onChange:h,onClose:y,showClearButton:v??!0,showInputMenuItem:x??!0,type:b,value:C,parentRecordStore:f}):"select_array"===b.type?(0,k.jsx)(ie,{action:t,currentSimpleFormulaValueTokens:i,formulaTypecheckContextValues:u,formulaValueContext:d,isSingle:!1,menuProps:g,onChange:h,onClose:y,showClearButton:v??!0,showInputMenuItem:x??!0,showReplaceAddRemoveToggle:S,type:b,value:C,parentRecordStore:f}):void(0,m().HB)(b)}function Pe(e){let{currentSimpleFormulaValueTokens:t,formulaTypecheckContextValues:o,menuProps:n,onChange:i,onClose:a,showGenericHeader:r,value:l,parentRecordStore:s}=e;const{numberMenu:c}=(0,R().A)({currentSimpleFormulaValueTokens:t,formulaTypecheckContextValues:o,menuProps:n,onChange:i,onClose:a,showGenericHeader:r,value:l,parentRecordStore:s});return c}function Be(e){let{currentSimpleFormulaValueTokens:t,formulaTypecheckContextValues:o,menuProps:n,onChange:i,onClose:a,parentRecordStore:r,showGenericHeader:l,value:s}=e;const{textMenu:c}=(0,ae().A)({currentSimpleFormulaValueTokens:t,formulaTypecheckContextValues:o,menuProps:n,onChange:i,onClose:a,parentRecordStore:r,showGenericHeader:l,value:s});return c}function Re(e){let{action:t,currentSimpleFormulaValueTokens:o,formulaTypecheckContextValues:n,formulaValueContext:i,limit:a,menuProps:r,onChange:l,onClose:s,showClearButton:c,showInputMenuItem:u,showFormulaValueItems:d,showGenericHeader:p,showReplaceAddRemoveToggle:m,showPersonCheckbox:g,getRecordModel:h,value:y,parentRecordStore:f}=e;const{personArrayMenu:v}=(0,_().A)({action:t,currentSimpleFormulaValueTokens:o,formulaTypecheckContextValues:n,formulaValueContext:i,limit:a,menuProps:r,onChange:l,onClose:s,showClearButton:c,showInputMenuItem:u,showFormulaValueItems:d,showGenericHeader:p,showReplaceAddRemoveToggle:m,showPersonCheckbox:g,getRecordModel:h,value:y,parentRecordStore:f});return v}function _e(e){let{action:t,collection:o,currentSimpleFormulaValueTokens:n,formulaTypecheckContextValues:i,formulaValueContext:a,menuProps:r,onChange:l,onClose:s,showClearButton:c,showFormulaValueItems:u,showGenericHeader:d,showInputMenuItem:p,showReplaceAddRemoveToggle:m,value:g,parentRecordStore:h}=e;const{relationMenu:y}=(0,V().A)({action:t,collection:o,currentSimpleFormulaValueTokens:n,formulaTypecheckContextValues:i,formulaValueContext:a,menuProps:r,onChange:l,onClose:s,showClearButton:c,showFormulaValueItems:u,showGenericHeader:d,showInputMenuItem:p,showReplaceAddRemoveToggle:m,value:g,parentRecordStore:h});return y}},436876:(e,t,o)=>{o.d(t,{A:()=>d});o(296540);var n=()=>o(401497),i=()=>o(784892),a=()=>o(576250),r=()=>o(617073),l=()=>o(234194),s=()=>o(919709),c=()=>o(848401),u=o(474848);function d(e){let{handleRemoveToken:t,token:o,type:d,format:p,style:m,isDisabled:g}=e;const h=(0,s().GCe)(o).name,y=(0,n().DP)();if(!h)return null;let f;switch(d){case"person":f=l().M;break;case"email":f=r().J;break;default:f=a().y}return(0,u.jsx)(c().Ay,{title:h,renderAvatar:e=>f({width:e,height:e,padding:2,marginRight:6}),style:{background:y.accentColors.gray[75],padding:"2px 4px",...m},showRemoveButton:Boolean(t)&&!g,onClickRemove:e=>{null==e||e.stopPropagation(),t&&t(o)},format:p??i().NY.Small,shouldShrink:!0,isSingle:!1})}},439616:(e,t,o)=>{o.d(t,{A:()=>B});o(944114),o(581454);var n=o(296540),i=()=>o(662303),a=()=>o(484714),r=()=>o(56366),l=()=>o(401497),s=()=>o(869190),c=()=>o(68263),u=()=>o(959013),d=()=>o(720665),p=()=>o(760217),m=()=>o(406699),g=()=>o(928600),h=()=>o(939740),y=()=>o(89924),f=()=>o(125565),v=()=>o(573351),x=()=>o(662971),S=()=>o(186445),b=()=>o(722872),C=()=>o(700250),A=()=>o(991249),k=()=>o(118849),j=()=>o(134217),M=o(474848);function T(e,t){const{permissionItem:n,hideIcon:i,onChange:r,buttonStyle:s}=e,c=(0,a().Y0)(),d=(0,l().IS)((e=>({icon:{margin:0,height:16,width:16,fill:e.icon.secondary},chevronIcon:{height:12,width:12,fill:e.icon.tertiary,transform:"rotate(90deg)"}})),[]);return(0,M.jsx)(o(811979).A,{...e,popupType:c.isMobile?m().z7.SlideUp:m().z7.Popup,renderOrigin:a=>(0,M.jsx)(o(585293).a,{...(0,o(553965).A)(e,a),ref:t,title:(0,M.jsx)(u().sA,{defaultMessage:"Link expires",id:"publishSiteSettings.linkExpiration.settingTitle"}),icon:!i&&(0,o(589982).u)(d.icon),right:(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(I,{permissionItem:n}),(0,o(742117).V)(d.chevronIcon)]}),buttonStyle:s}),alignmentToOrigin:C().MY.Center,placementToOrigin:C().UV.Bottom,render:e=>(0,M.jsx)(w,{value:n.expiration_timestamp,onChange:r,onClose:()=>{e.close()}})})}function I(e){const{permissionItem:t}=e,o=(0,u().tz)(),n=(0,l().IS)((e=>({container:{color:e.text.secondary}})),[]);if(!t.expiration_timestamp||(0,c().OA)(t))return(0,M.jsx)(f().A,{style:n.container,children:(0,M.jsx)(u().sA,{defaultMessage:"Never",id:"publishSiteSettings.linkExpiration.never"})});const a=s().jE(t.expiration_timestamp,i().locale,o);return(0,M.jsx)(f().A,{style:n.container,children:a})}function w(e){const{value:t,onChange:o,onClose:s}=e,c=(0,a().v3)(),m=c.device,f=(0,r().K8)((()=>!j().qC()),[]),v=(0,r().K8)((()=>j().Si(c)),[c]),x=(0,n.useCallback)((e=>{void 0!==e&&e<=(new Date).getTime()||(o(e),s())}),[o,s]),S=(0,l().IS)((e=>({disabledContainer:{display:"flex",gap:6},disabledText:{color:e.text.tertiary}})),[]),C=function(){const e=Date.now(),t=e+d().pT,o=e+d().nD,n=e+7*d().nD;return[{key:"none",time:void 0,title:(0,M.jsx)(u().sA,{defaultMessage:"Never",id:"publishSiteSettings.linkExpiration.never"})},{key:"hour",time:t,title:(0,M.jsx)(u().sA,{defaultMessage:"In an hour",id:"publishSiteSettings.linkExpiration.oneHour"}),caption:new Intl.DateTimeFormat(i().locale,{hour:"numeric",minute:"numeric"}).format(t)},{key:"day",time:o,title:(0,M.jsx)(u().sA,{defaultMessage:"In a day",id:"publishSiteSettings.linkExpiration.oneDay"}),caption:new Intl.DateTimeFormat(i().locale,{day:"numeric",month:"long",hour:"numeric",minute:"numeric"}).format(o)},{key:"week",time:n,title:(0,M.jsx)(u().sA,{defaultMessage:"In a week",id:"publishSiteSettings.linkExpiration.oneWeek"}),caption:new Intl.DateTimeFormat(i().locale,{day:"numeric",month:"long",hour:"numeric",minute:"numeric"}).format(n)}]}().map((e=>({key:e.key,action:()=>{x(e.time)},render:t=>(0,M.jsx)(p().A,{...t,title:e.title,titleStyle:f?S.disabledText:{},caption:e.caption,captionStyle:f?S.disabledText:{},disabled:f})}))),T=[{key:"predefined-expiration",render:e=>(0,M.jsx)(y().A,{...e}),items:C},{key:"custom-expiration",render:e=>(0,M.jsx)(y().A,{...e,topBorder:!0}),items:[P(x,t,f,S.disabledText)]}];return v&&f&&T.push({key:"upgrade-for-expiration",render:e=>(0,M.jsx)(y().A,{...e,topBorder:!0}),items:[{key:"upsell",action:()=>{A().K(c,{from:"public_permission_item_expiration",upsell:{type:"product",product:v,limit:{type:"none"}}})},render:e=>(0,M.jsx)(p().A,{...e,focused:e.focused,title:(0,M.jsxs)("div",{style:S.disabledContainer,children:[(0,M.jsx)(u().sA,{defaultMessage:"Unlock link expiration",id:"publishSiteSettings.linkExpiration.upgrade"}),(0,M.jsx)(k().A,{subscriptionTier:v,analyticsName:"public_permission_item_expiration"})]})})}]}),(0,M.jsx)(g().A,{menuType:m.isMobile?b().gu.ActionSheet:b().gu.Popup,width:271,children:(0,M.jsx)(h().Ay,{type:h().Oh.Vertical,initialFocus:void 0,sections:T})})}function P(e,t,o){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return{key:"custom",action:()=>{window.parent.close()},render:(i,a)=>(0,M.jsx)(x().A,{...i,renderOrigin:e=>(0,M.jsx)(p().A,{...e,disabled:o,title:(0,M.jsx)(u().sA,{id:"publicPermissionItem.expiration.chooseDate",defaultMessage:"Choose date"}),titleStyle:o?n:{}}),onFocus:a.onFocus,disableDefaultClick:!0,renderExtension:(n,i)=>(0,M.jsx)("div",{style:{padding:"18px 14px 14px"},children:(0,M.jsx)(v().A,{...n,firstDayOfWeek:S().XX.state,value:t||Date.now(),onChange:t=>{e(t),i.close()},disabledDays:o||{before:new Date}})})})}}const B=n.forwardRef(T)},442277:(e,t,o)=>{o.d(t,{B:()=>i});o(296540);var n=o(474848);const i=(0,o(340498).wt)("arrowRightSmaller",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M15.383 8.352a.877.877 0 01-.274.64l-5.156 5.14a.864.864 0 01-.617.266.831.831 0 01-.602-.234.795.795 0 01-.234-.586c0-.12.02-.232.063-.336a.912.912 0 01.187-.273l1.75-1.766 2.914-2.656.274.5-2.711.156H1.484c-.26 0-.471-.078-.632-.234a.851.851 0 01-.235-.617c0-.256.078-.461.235-.618a.856.856 0 01.632-.242h9.493l2.71.164-.273.508L10.5 5.5 8.75 3.727a.946.946 0 01-.188-.266.917.917 0 01-.062-.344c0-.234.078-.43.234-.586a.831.831 0 01.602-.234.79.79 0 01.328.07c.104.047.203.117.297.211l5.148 5.133a.877.877 0 01.274.64z"})})},450859:(e,t,o)=>{o.d(t,{mA:()=>C});o(16280),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(354520);var n=()=>o(329199),i=()=>o(416504),a=()=>o(696706),r=()=>o(179034),l=()=>o(973647),s=()=>o(534177),c=()=>o(862292),u=()=>o(186445),d=()=>o(909470),p=()=>o(972435),m=()=>o(508496),g=()=>o(38789),h=()=>o(630116),y=()=>o(449506);const f=1e3;class v extends Error{constructor(e,t){super(t),this.type=e}}class x extends v{constructor(){super("query_collection_limit_outside_range",`Query collection limit must be between 0 and ${f}`)}}class S extends v{constructor(e){super("query_collection_failed",`Query collection failed: ${e.reason}`),this.data=e}}class b extends v{constructor(){super("query_collection_too_many_items","Query collection updating too many items")}}async function C(e,t){const{source:o,parentRecordStore:v,collectionPointer:C,filter:A,sort:k,limit:j}=t,M=j??f;if(M<0||M>f)return{error:new x};const T=h().md.createChildStore(v,C);await T.load();const I=T.getModel();if(!I)return{error:new S({reason:"no collection value"})};const w=T.getParentBlockStore();if(!w)return{error:new S({reason:"no collection parent"})};await w.load();const P=w.getCollectionViewStores()[0],B=P.getSpaceId();if(!P||!B)return{error:new S({reason:"no first collection view"})};const R="results",_={[R]:{type:"results",limit:M}},V=Object.keys(t.aggregations??{});for(const n of V){var E;if(n===R)return{error:new S({reason:`${R} is a reserved reducer keyword.`})};const e=null===(E=t.aggregations)||void 0===E?void 0:E[n];if(!e)return{error:new S({reason:`no aggregation provided for ${n}.`})};e&&(_[n]={type:"aggregation",aggregation:e})}const F=T.getSchema(),D={filter:A&&n().SK(A,F),sort:k&&n().g4(k,F),userId:e.currentUser.id,userTimeZone:(0,i().P)(),searchQuery:void 0,reducers:_},L=await y().callApi({eventName:"queryCollection",environment:e,data:{source:{type:"collection",id:C.id,spaceId:C.spaceId},collectionView:{id:P.id,spaceId:B},loader:D},tracking:{src:o}});if("failed"===L.type)return{error:new S({reason:"server query failed",cause:L.error})};const O=L.data.result.reducerResults[R];if(!O||"results"!==O.type)return{error:new S({reason:"unexpected server result"})};if(O.blockIds.length===f&&O.hasMore)return{error:new b};const{groupsReducerIds:K,reducerIdsWithNoGroupDependencies:N}=n().M(D.reducers,D.reducerDependencies),W=m().default.getConfigKey("collection_request_settings","clientFormulaTimeoutMs"),z=Date.now(),H=await c().T.formulas.load(),U={pageSort:[],schema:F,loader:D,userId:e.currentUser.id,userStartOfWeek:u().XX.state,currentTime:z,getRecordModel:v.getRecordModel,getRecordRole:v.getRecordRole,intl:p().A.getIntl(),isSorted:!1,visibleProperties:void 0,relativeVariableResult:null==L?void 0:L.data.relativeVariableResult,currentPageInRelatedCollection:void 0,isSprintPlanningView:!1,collectionSourceType:"collection",groupsReducerIds:K,reducerIdsWithNoGroupDependencies:N,formulaTimeoutMs:W,resultCache:new Map,regExpCache:new Map,experimentService:m().default,collectionFeatureGates:(0,d().i)(),formulasModule:H},Y=n().zl(U);for(const i of O.blockIds){var G;const e=h().Bv.createChildStore(v,{table:r().ev,id:i}),t=null===(G=e.getAssociatedCollectionStore())||void 0===G?void 0:G.pointer;if(!(t&&a().L3.isEqualIdTable(t,T.pointer)))continue;const o=v.getRecordModel(e);o&&n().UC(o,I,U,Y)}const q=g().A.getEditedBlocksForCollection(I.id),$=new Set(O.blockIds);for(const i of q){if($.has(i))continue;const e=v.getRecordModel({table:r().ev,id:i});e&&n().UC(e,I,U,Y)}const{result:Z}=n().Mo(U,Y),Q=n().uX({result:Z}),J={};for(const i of V){var X;const e=n().VI({expectedAggregator:null===(X=t.aggregations)||void 0===X||null===(X=X[i])||void 0===X?void 0:X.aggregator,aggregationReducerResult:L.data.result.reducerResults[i]});if(l().Q.isFail(e)){const t="no aggregation provided"===e.error?`no aggregation provided for ${i}`:"unexpected response returned for aggregation"===e.error?`unexpected response returned for aggregation ${i}`:(0,s().HB)(e.error);return{error:new S({reason:t})}}J[i]=e.value}return{value:{blockIds:Q,...J}}}},464004:(e,t,o)=>{o.d(t,{l:()=>f});var n=o(296540),i=()=>o(484714),a=()=>o(56366),r=()=>o(401497),l=()=>o(743176),s=()=>o(959013),c=()=>o(284371),u=()=>o(380468),d=()=>o(406699),p=()=>o(928600),m=()=>o(781697),g=()=>o(656134),h=()=>o(548526),y=o(474848);function f(e){const{alreadyHaveProperties:t,availablePropertyIds:o,collectionStore:f,currentValue:v,disabled:x,onChange:S,onRemove:b,placeholderMessage:C,errorMessage:A,hideErrorMessageTooltip:k}=e,j=(0,i().v3)(),M=(0,r().DP)(),{device:T}=j,I=(0,a().K8)((()=>f.getSchema()??{}),[f]),w=(0,a().K8)((()=>f.getFormat()??{}),[f]),P=(0,a().K8)((()=>v?f.getSchema()[v]:void 0),[v,f]),B=(0,a().K8)((()=>v?f.getDeletedSchema()[v]:void 0),[v,f]),R=(0,r().IS)((e=>{const t={fill:e.lightTextColor,height:"auto",marginRight:4,width:16};return{propertyIcon:t,deletedPropertyIcon:{...t,fill:e.text.uiRedPrimary},propertyTitle:{fontWeight:c().Wy.regular,...c().RC},deletedPropertyTitle:{color:e.text.uiRedPrimary,fontWeight:c().Wy.regular,...c().RC}}}),[]),_=(0,n.useCallback)((()=>o),[o]),V=(0,g().j)(),E=(0,a().K8)((()=>P?function(e){return(0,y.jsx)(l().Ay,{icon:void 0,size:16,style:{...e,...R.propertyIcon},theme:M,type:P.type})}:B?function(e){return(0,y.jsx)(l().Ay,{icon:void 0,type:B.type,size:16,theme:M,style:{...e,...R.deletedPropertyIcon}})}:void 0),[B,P,R.deletedPropertyIcon,R.propertyIcon,M]),F=Boolean(A),D=!Boolean(P)&&!Boolean(t),L=!Boolean(t);return(0,y.jsx)(d().Ay,{popupType:V,alignmentToOrigin:d().yP.Center,placementToOrigin:d().sx.Bottom,originGap:0,disabled:x,renderOrigin:e=>(0,y.jsx)(h().x,{...e,disabled:x,icon:E,isError:F,hasActionRequired:D,isSecondary:L,tooltipMessage:!k&&A,dropdownButtonType:"button",children:P?(0,y.jsx)("div",{style:R.propertyTitle,children:P.name}):B?(0,y.jsx)("div",{style:R.deletedPropertyTitle,children:B.name}):C?(0,y.jsx)(s().sA,{...C}):t?(0,y.jsx)(s().sA,{id:"automations.propertyPicker.buttonPlaceholderAlreadyHaveProperties",defaultMessage:"Edit property"}):(0,y.jsx)(s().sA,{id:"automations.propertyPicker.buttonPlaceholder",defaultMessage:"Edit a property"})}),render:e=>{const t=(0,m().v)({device:T,width:280,paddingTop:4});return(0,y.jsx)(p().A,{...t,children:(0,y.jsx)(u().A,{schema:I,format:w,showRemoveOption:Boolean(b),currentProperty:v,getProperties:_,onAccept:t=>{t&&t!==v?S(t):void 0===t&&(null==b||b(v)),e.close()}})})}})}},470365:(e,t,o)=>{o.r(t),o.d(t,{CollectionSettingsAutomationsView:()=>Ot});o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(354520),o(672577),o(803949),o(581454),o(737550);var n=o.n(o(844751)),i=o(296540),a=()=>o(484714),r=()=>o(56366),l=()=>o(401497),s=()=>o(764880),c=()=>o(422540),u=()=>o(329333),d=()=>o(352271),p=()=>o(289915),m=()=>o(970013),g=()=>o(713998),h=()=>o(791089),y=()=>o(709687),f=()=>o(101209),v=()=>o(563884),x=()=>o(920713),S=()=>o(813572),b=()=>o(133033),C=()=>o(173019),A=()=>o(689094),k=()=>o(751109),j=()=>o(292643),M=()=>o(46472),T=o(474848);const I=(0,o(340498).wt)("typesLocation",{viewBox:"0 0 25 25",svg:(0,T.jsxs)("g",{children:[(0,T.jsx)("path",{d:"M12.105 24.21C18.7369 24.21 24.2121 18.7273 24.2121 12.105C24.2121 5.47312 18.7273 0 12.0954 0C5.47523 0 0 5.47312 0 12.105C0 18.7273 5.48484 24.21 12.105 24.21ZM12.105 21.8255C6.71085 21.8255 2.39412 17.4991 2.39412 12.105C2.39412 6.71085 6.70124 2.38452 12.0954 2.38452C17.4895 2.38452 21.8276 6.71085 21.8276 12.105C21.8276 17.4991 17.4991 21.8255 12.105 21.8255Z"}),(0,T.jsx)("path",{d:"M6.75703 16.5939C6.75703 17.4355 7.28742 17.9479 8.17266 17.9479H16.0416C16.9247 17.9479 17.4476 17.4355 17.4476 16.5939V12.0109L12.4683 7.82758C12.236 7.63047 11.9686 7.64008 11.7363 7.82758L6.75703 12.0013V16.5939ZM13.6692 16.7148H10.5429V12.9969C10.5429 12.7178 10.7283 12.5366 11.0128 12.5366H13.2014C13.4977 12.5366 13.6692 12.7178 13.6692 12.9969V16.7148ZM4.81055 11.2199C4.81055 11.5316 5.04469 11.8138 5.43211 11.8138C5.62593 11.8138 5.78554 11.7083 5.9271 11.5806L11.8111 6.65687C12.0145 6.47477 12.2093 6.49609 12.4052 6.65687L18.2775 11.5806C18.4383 11.7083 18.5883 11.8138 18.7725 11.8138C19.1194 11.8138 19.3941 11.5818 19.3941 11.2391C19.3941 11.0315 19.3228 10.873 19.1653 10.7336L13.0078 5.5661C12.4605 5.10508 11.7558 5.10508 11.2181 5.5661L5.03929 10.7357C4.89141 10.8751 4.81055 11.0507 4.81055 11.2199ZM15.8079 8.35282L17.4623 9.75391V6.88399C17.4623 6.62618 17.3004 6.44501 17.033 6.44501H16.249C15.9912 6.44501 15.8079 6.62618 15.8079 6.88399V8.35282Z"})]})});var w=()=>o(281067),P=()=>o(164153),B=()=>o(523872),R=()=>o(166883),_=()=>o(696706),V=()=>o(959013),E=()=>o(534177),F=()=>o(284371),D=()=>o(686526),L=()=>o(436572),O=()=>o(837570),K=()=>o(741310),N=()=>o(546461),W=()=>o(104636),z=()=>o(735695),H=()=>o(493823),U=()=>o(419357),Y=()=>o(187485),G=()=>o(204063),q=()=>o(89924),$=()=>o(859428),Z=()=>o(989423),Q=()=>o(682146),J=()=>o(726483),X=()=>o(731320),ee=()=>o(963589),te=()=>o(962730),oe=()=>o(351360),ne=()=>o(508496),ie=()=>o(597898),ae=()=>o(898125),re=()=>o(819121),le=()=>o(588316),se=()=>o(442277),ce=()=>o(299960),ue=()=>o(693954),de=()=>o(558842),pe=()=>o(519143),me=()=>o(30626),ge=()=>o(764781),he=()=>o(200582),ye=()=>o(105819),fe=()=>o(236262),ve=()=>o(760217),xe=()=>o(406699),Se=()=>o(285790),be=()=>o(928600),Ce=()=>o(939740),Ae=()=>o(8980),ke=()=>o(574036),je=()=>o(463830),Me=()=>o(781697),Te=()=>o(656134);const Ie=(0,V().YK)({automationSummaryCardMoreButtonAriaLabel:{defaultMessage:"More",id:"automations.AutomationSummaryCard.MoreActionsButton.ariaLabel"},automationSummaryCardMoreMenuEditTitle:{defaultMessage:"Edit",id:"automations.AutomationSummaryCard.MoreActionsMenu.Edit.title"},automationSummaryCardMoreMenuDuplicateTitle:{defaultMessage:"Duplicate",id:"automations.AutomationSummaryCard.MoreActionsMenu.Duplicate.title"},automationSummaryCardMoreMenuDeleteTitle:{defaultMessage:"Delete",id:"automations.AutomationSummaryCard.MoreActionsMenu.Delete.title"},automationSummaryCardMoreMenuActiveTitle:{defaultMessage:"Active",id:"automations.AutomationSummaryCard.MoreActionsMenu.Active.title"},automationSummaryCardMoreMenuRestartTitle:{defaultMessage:"Restart",id:"automations.AutomationSummaryCard.MoreActionsMenu.Restart.title"}});function we(e){const{focused:t,style:o,onEdit:n,onDelete:a,onDuplicate:s,onDisable:c,onEnable:u,onRestart:d}=e,p=(0,V().tz)(),m=(0,r().uB)(void 0,je().A),g=(0,Te().j)();(0,i.useEffect)((()=>{t||m.setState({open:!1})}),[t,m]);const h=(0,l().IS)((e=>({iconButton:{border:`1px solid ${e.regularDividerColor}`,height:26,width:26,...o},iconButtonIcon:{width:16}})),[o]);return(0,T.jsx)(xe().Ay,{stopClickPropagation:!0,popupType:g,alignmentToOrigin:xe().yP.Center,placementToOrigin:xe().sx.Bottom,originGap:0,renderOrigin:e=>(0,T.jsx)(Se().A,{ariaLabel:p.formatMessage(Ie.automationSummaryCardMoreButtonAriaLabel),icon:me()._,iconStyle:h.iconButtonIcon,style:h.iconButton,hasBackground:!0,...e}),render:e=>(0,T.jsx)(Pe,{onClose:()=>e.close(),onEdit:n,onDelete:a,onDuplicate:s,onDisable:c,onEnable:u,onRestart:d}),buttonPopupStore:m})}function Pe(e){const{onClose:t,onEdit:o,onDelete:n,onDuplicate:i,onDisable:a,onEnable:r,onRestart:l}=e,s=(0,V().tz)(),c=(0,Me().e)(),u=o?{action:()=>{t(),o()},key:"edit",render:e=>(0,T.jsx)(ve().A,{...e,icon:(0,T.jsx)(Ae().I,{icon:ye().x}),title:s.formatMessage(Ie.automationSummaryCardMoreMenuEditTitle)})}:void 0,d=l?{action:()=>{t(),l()},key:"restart",render:e=>(0,T.jsx)(ve().A,{...e,icon:(0,T.jsx)(Ae().I,{icon:pe().D}),title:s.formatMessage(Ie.automationSummaryCardMoreMenuRestartTitle)})}:void 0,p=i?{action:()=>{t(),i()},key:"duplicate",render:e=>(0,T.jsx)(ve().A,{...e,icon:(0,T.jsx)(Ae().I,{icon:ge().V}),title:s.formatMessage(Ie.automationSummaryCardMoreMenuDuplicateTitle)})}:void 0,m=r||a?{action:()=>{t(),r?r():a&&a()},key:"active",render:e=>(0,T.jsx)(ke().A,{...e,icon:(0,T.jsx)(Ae().I,{icon:he().m}),title:s.formatMessage(Ie.automationSummaryCardMoreMenuActiveTitle),on:(0,E().O9)(a)})}:void 0,g=n?{action:()=>{t(),n()},key:"delete",render:e=>(0,T.jsx)(ve().A,{...e,icon:(0,T.jsx)(Ae().I,{icon:fe().I}),title:s.formatMessage(Ie.automationSummaryCardMoreMenuDeleteTitle),isRedOnHover:!0})}:void 0,h=[];return(0,E().O9)(m)&&h.push({items:[m],key:"active-inactive",render:e=>(0,T.jsx)(q().A,{enableActionSheetTitle:!0,...e})}),h.push({items:[d,u,p,g].filter(E().O9),key:"items",render:e=>(0,T.jsx)(q().A,{enableActionSheetTitle:!0,topBorder:(0,E().O9)(m),...e})}),(0,T.jsx)(be().A,{...c,children:(0,T.jsx)(Ce().Ay,{type:Ce().Oh.Vertical,sections:h,initialFocus:0})})}var Be=()=>o(464708),Re=()=>o(704152),_e=()=>o(448693),Ve=()=>o(115512);const Ee=6;function Fe(e){const{actions:t,caption:o,focused:n,status:r,maxIcons:s,onBlur:c,onClick:u,onDelete:d,onDisable:p,onDuplicate:m,onEdit:g,onRestart:h,onEnable:y,onFocus:f,onMouseDown:v,onMouseEnter:x,onMouseLeave:S,title:b,triggers:C}=e,{isMobile:A}=(0,a().Y0)(),k=(0,i.useRef)(null),[j,M]=(0,re().A)(),[I,w]=(0,le().A)(),[P,B]=(0,i.useState)(!1),R=A||P||M||w,_=(0,ee().X)("automation_updated_error_states"),D=(0,l().IS)((e=>({wrap:{background:e.surface.elevated,border:`1px solid ${e.regularDividerColor}`,borderRadius:10,display:"flex",flexDirection:"column",gap:11,paddingTop:16,paddingLeft:16,paddingRight:16,paddingBottom:13,position:"relative"},moreButtonWrap:{display:R?"block":"none",position:"absolute",right:8,top:8},iconList:{display:"flex",flexWrap:"wrap",gap:6,listStyle:"none",margin:"0 30px 0 0",padding:0},body:{display:"flex",flexDirection:"column",gap:A?4:0},titleWrap:{..."success"!==r?{alignItems:"center",display:"inline-flex",gap:4}:(0,Ve().pA)(2),fontSize:A?16:14,fontWeight:F().Wy.medium,lineHeight:"20px"},title:{..."success"!==r?F().RC:{}},warning:{color:"error"===r?e.errorText:e.accentColors.orange[400],height:"auto",width:A?16:14},caption:{...(0,Ve().pA)(2),color:e.text.secondary,fontSize:A?14:12,fontWeight:F().Wy.regular,lineHeight:"16px",margin:0},invalidBadge:{backgroundColor:e.tint.uiRed,color:e.icon.uiRedPrimary},failingBadge:{backgroundColor:e.accentColors.yellow[50],color:e.accentColors.yellow[400]},pausedBadge:{backgroundColor:e.tint.regular,color:e.text.secondary},badgeContainer:{alignItems:"center",display:"flex",fontSize:10},icon:{width:10,height:10,marginRight:"4px"}})),[r,R,A]),L=(0,i.useCallback)((e=>{B(!0),x&&x(e)}),[x]),O=(0,i.useCallback)((e=>{B(!1),S&&S(e)}),[S]);(0,i.useEffect)((()=>{n&&null!==k.current&&k.current.focus()}),[n]);const K=(0,de().Px)(k,j,I),N=function(e){const{actionIcons:t,maxIcons:o,triggerIcons:n}=e,i=n.length,a=t.length,r=i>0&&a>0,l=Math.max(o,3),s=r?l-1:l;let c=Math.max(Math.floor(s/2),1),u=Math.max(Math.ceil(s/2),1);if(i<c&&a>u){u+=c-i,c=i}else if(a<u&&i>c){c+=u-a,u=a}const d=[];if(i>0)if(i>c)if(1===c)d.push({color:"gray",type:"truncate",value:i});else{const e=i-(c-1);d.push(...n.slice(0,c-1)),d.push({color:"gray",type:"truncate",value:e})}else d.push(...n);r&&d.push({type:"arrow"});if(a>0)if(a>u)if(1===u)d.push({color:"gray",type:"truncate",value:a});else{const e=a-(u-1);d.push(...t.slice(0,u-1)),d.push({color:"gray",type:"truncate",value:e})}else d.push(...t);return d}({actionIcons:t,maxIcons:ze(s),triggerIcons:C}),W=Boolean(d||p||y||m||g||h),z=(0,i.useMemo)((()=>{if(_){if("invalid"===r)return(0,T.jsx)(Be().A,{style:D.invalidBadge,content:(0,T.jsxs)("div",{style:D.badgeContainer,children:[(0,ue().Q)(D.icon),(0,T.jsx)(V().sA,{defaultMessage:"Invalid",id:"automationSummaryCard.invalidToken"})]})});if("paused"===r)return(0,T.jsx)(Be().A,{style:D.pausedBadge,content:(0,T.jsxs)("div",{style:D.badgeContainer,children:[(0,ce().U)(D.icon),(0,T.jsx)(V().sA,{defaultMessage:"Paused",id:"automationSummaryCard.pausedToken"})]})});if("failing"===r)return(0,T.jsx)(Be().A,{style:D.failingBadge,content:(0,T.jsx)("div",{style:D.badgeContainer,children:(0,T.jsx)(V().sA,{defaultMessage:"Failing",id:"automationSummaryCard.failingToken"})})});if("expired"===r)return(0,T.jsx)(Be().A,{style:D.pausedBadge,content:(0,T.jsx)("div",{style:D.badgeContainer,children:(0,T.jsx)(V().sA,{defaultMessage:"Completed",id:"automationSummaryCard.completedToken"})})});if("error"===r||"warning"===r||"success"===r)return;(0,E().HB)(r)}return"success"!==r?(0,ue().Q)(D.warning):void 0}),[_,r,D]);return(0,T.jsxs)(Re().A,{onBlur:c,onClick:u,onFocus:f,onMouseDown:v,onMouseEnter:L,onMouseLeave:O,ref:K,style:D.wrap,children:[(0,T.jsxs)("header",{children:[W&&(0,T.jsx)("div",{style:D.moreButtonWrap,children:(0,T.jsx)(we,{focused:R,onDelete:d,onDisable:p,onEnable:y,onDuplicate:m,onEdit:g,onRestart:h})}),(0,T.jsx)("ul",{"aria-hidden":"true",style:D.iconList,children:N.map(((e,t)=>(0,T.jsx)("li",{children:(0,T.jsx)(De,{icon:e})},t)))})]}),(0,T.jsxs)("div",{style:D.body,children:[(0,T.jsxs)("div",{style:D.titleWrap,children:[(0,T.jsx)("span",{style:D.title,children:b}),z]}),o&&(0,T.jsx)("p",{style:D.caption,children:o})]})]})}function De(e){const{icon:t}=e;return"property"===t.type||"page"===t.type||"misc"===t.type?(0,T.jsx)(Le,{color:t.color,icon:t.icon}):"person"===t.type?(0,T.jsx)(We,{actor:t.actor}):"app"===t.type?(0,T.jsx)(Ke,{color:"default",icon:t.icon}):"arrow"===t.type?(0,T.jsx)(Oe,{}):"truncate"===t.type?(0,T.jsx)(Ne,{color:t.color,value:t.value}):void(0,E().HB)(t.type)}function Le(e){const{color:t,icon:o}=e,n=He(t);return(0,T.jsx)("div",{"aria-hidden":"true",style:n.iconWrap,children:o(n.icon)})}function Oe(){const e=He("default");return(0,T.jsx)("div",{style:{...e.iconWrap,...e.iconArrowWrap},children:(0,se().B)({...e.icon,...e.iconArrow})})}function Ke(e){const{icon:t}=e,o=He("default");return(0,T.jsx)("div",{"aria-hidden":"true",style:o.iconAppWrap,children:t(o.iconApp)})}function Ne(e){const{color:t,value:o}=e,n=He(t);return(0,T.jsxs)("div",{style:{...n.iconWrap,...n.truncateWrap},children:["+",o]})}function We(e){const{actor:t}=e,o=He("default");return(0,T.jsx)("div",{"aria-hidden":"true",style:o.iconPersonWrap,children:(0,T.jsx)(_e().Ay,{actor:t,avatarSize:26,format:_e().Ay.Format.Inline,isSingle:!1,showRemoveButton:!1,style:{margin:0}})})}function ze(e){return void 0===e||e<0?Ee:e}function He(e){const t="default"===e?"gray":e;return(0,l().IS)((e=>{const o="light"===e.mode?400:800,n="light"===e.mode?100:400;return{icon:{fill:e.accentColors[t][o],width:16},iconWrap:{background:e.accentColors[t][n],borderRadius:6,padding:6},iconApp:{width:14,height:14},iconAppWrap:{borderRadius:6,borderWidth:1,borderStyle:"solid",borderColor:e.accentColors.gray[n],padding:6},iconPerson:{display:"block",width:"100%"},iconPersonWrap:{alignItems:"center",display:"flex",height:28,justifyContent:"center",width:28},iconArrow:{fill:e.icon.secondary,width:14,height:14},iconArrowWrap:{background:void 0},truncateWrap:{alignItems:"center",background:e.accentColors.gray[n],color:e.accentColors[t][o],display:"inline-flex",fontSize:12,fontWeight:F().Wy.semibold,height:28,justifyContent:"center",padding:3,width:28}}}),[t])}var Ue=()=>o(310109),Ye=()=>o(784892),Ge=()=>o(842599),qe=()=>o(798880),$e=()=>o(919709),Ze=()=>o(500071),Qe=()=>o(656476),Je=()=>o(307159),Xe=()=>o(347114),et=()=>o(3867),tt=()=>o(237985),ot=()=>o(359186),nt=()=>o(217028),it=()=>o(383688),at=()=>o(880264),rt=()=>o(112588),lt=()=>o(477329),st=()=>o(27511),ct=()=>o(214973),ut=()=>o(38440),dt=()=>o(133518),pt=()=>o(798941),mt=()=>o(397785),gt=()=>o(457050),ht=()=>o(967823),yt=()=>o(71304),ft=()=>o(630116);const vt=(0,V().YK)({automationSingleTargetDefault:{defaultMessage:"1 person",id:"database.viewSettings.automationTab.automationSingleTargetDefault"},recurrenceAutomationSummary:{defaultMessage:"Every {frequency}, {actions}",id:"automation.summaryCard.recurrenceCaption"}});function xt(e){const{intl:t,triggerConfig:o}=e;if(o){if("event"===o.type){const n=function(e){const{hasAutomationUpdatedErrorStatesEnabled:t,collectionStore:o,environment:n,getRecordModel:i,intl:a,schema:r,typecheckResult:l,triggerConfig:s}=e,{event:u}=s,d=o.getSpaceId(),g=[];u.pagesAdded&&g.push(ct().CH(a));if("none"===u.pagePropertiesEdited.type);else if("any"===u.pagePropertiesEdited.type)g.push(ct().HG(a));else if("some"===u.pagePropertiesEdited.type||"all"===u.pagePropertiesEdited.type){let e=[];"all"===u.pagePropertiesEdited.type?e=u.pagePropertiesEdited.all??[]:"some"===u.pagePropertiesEdited.type&&(e=u.pagePropertiesEdited.some??[]);for(const s of e){const e=r[s.property];if(!e){g.push(ct().Pg(a));continue}if(!c().tj[e.type]){g.push((0,nt().cn)({propertySchema:e,hasAutomationUpdatedErrorStatesEnabled:t}));continue}const{filter:u}=s;if("changes_to_any"===u.operator)g.push(ct().Od(a,{propertyName:e.name}));else if(p().fZ(u))g.push(ct().yR(a,{propertyName:e.name}));else if(c().nq(e))if("status"===e.type){if(!p().H$(u)||!p().gc(u)){g.push((0,ut().zQ)(e));continue}const t=p().V6(u),o=(0,st().a)({intl:a,groupValues:t.map((e=>"is_group"===e.type?e.value:void 0)).filter(E().O9),isText:!0,optionValues:t.map((e=>"is_option"===e.type?e.value:void 0)).filter(E().O9),propertySchema:e,tokenFormat:Ye().NY.Small}),n=a.formatList(o,{style:"long",type:"disjunction"});g.push(ct().Yx(a,{propertyName:e.name,propertyValues:n}))}else if("select"===e.type||"multi_select"===e.type){if(p().fZ(u)||!p().v0(u)&&!p().as(u)||"select"===e.type&&p().as(u)||"multi_select"===e.type&&p().v0(u)){g.push((0,ut().zQ)(e));continue}const t=Array.isArray(u.value)?u.value:[u.value],o=(0,lt().$5)({intl:a,isText:!0,optionValues:t.map((e=>e.value)).filter(E().O9),propertySchema:e,tokenFormat:Ye().NY.Small}),n=a.formatList(o,{style:"long",type:"disjunction"}),i=(0,lt().l5)({filter:u,propertySchema:e});if(i){const t=(0,lt().JI)(i);g.push(t(a,{propertyName:e.name,propertyValues:n}))}}else if("checkbox"===e.type){if(!p().Ui(u)){g.push((0,ut().zQ)(e));continue}g.push((0,it().Hk)({filter:u,propertySchema:e,intl:a}))}else if("person"===e.type){if(!p().I_(u)){g.push((0,ut().zQ)(e));continue}g.push((0,mt().H)({actorModels:(0,rt().Y)(u,i),operator:u.operator,propertySchema:e,intl:a}))}else if("number"===e.type){if(!p().My(u)){g.push((0,ut().zQ)(e));continue}g.push((0,pt().VW)({messageType:"trigger",numberValue:u.value.value,operator:u.operator,propertySchema:e,intl:a}))}else if("email"===e.type||"url"===e.type||"text"===e.type||"phone_number"===e.type||"title"===e.type){if(!p().YH(u)){g.push((0,ut().zQ)(e));continue}"string_is"!==u.operator&&"string_is_not"!==u.operator&&"string_contains"!==u.operator&&"string_does_not_contain"!==u.operator&&"string_starts_with"!==u.operator&&"string_ends_with"!==u.operator||g.push((0,ht().zl)({messageType:"trigger",textValue:u.value.value,operator:u.operator,propertySchema:e,intl:a}))}else if("relation"===e.type){if(!p().Pq(u)){g.push((0,ut().zQ)(e));continue}if(m().o2(d,e)){g.push((0,at().Mh)({propertySchema:e}));continue}const t=(0,gt().WE)({collectionStore:o,filter:u}),i=(0,Ue().getAllContextValues)(l),r=(0,gt().eg)({collectionStore:o,filter:u,propertySchema:e});g.push((0,gt().oE)({availableTokens:r,collectionStore:o,environment:n,operator:u.operator,propertySchema:e,intl:a,relationPages:(0,gt().Iq)({value:t.value,automationContextValues:i})}))}else(0,E().HB)(e)}}return a.formatList(g,{style:"long",type:"all"===u.pagePropertiesEdited.type?"conjunction":"disjunction"})}({...e,triggerConfig:o}),i=St(e);return t.formatMessage({defaultMessage:"When {triggers}, {actions}",id:"automation.summaryCard.caption"},{actions:i,triggers:n})}if("recurrence"===o.type){if(!o.recurrence)return;const n=(0,W().LS)({intl:t,recurrence:o.recurrence}),i=St(e);return t.formatMessage(vt.recurrenceAutomationSummary,{frequency:n,actions:i})}"button"!==o.type&&(0,E().HB)(o)}}function St(e){var t,o;const{actionStores:n,collectionStore:i,environment:a,intl:r,schema:l,typecheckResult:u,hasAutomationUpdatedErrorStatesEnabled:d}=e,p=[];for(const j of n)if(j.isType("slack_notification"))p.push((0,T.jsx)(V().sA,{defaultMessage:"notify {channel}",id:"CollectionSettingsAutomationsView.summaryCard.slackAction",values:{channel:(0,T.jsx)(Ze().D,{actionStore:j})}}));else if(j.isType("update_pages")){const e=j.getConfig(),t=null==e?void 0:e.properties,o=null==e?void 0:e.values,n=null==e?void 0:e.target;if(!t||0===t.length||!n)continue;if("collection"===n.type)if((0,_().Z2)(n.collection,i.pointer))p.push((0,T.jsx)(V().sA,{defaultMessage:"edit pages in this collection",id:"automation.summaryCard.updatePages.sameCollection"}));else{const e=ft().md.createChildStore(i,n.collection),t=(0,yt().tS)({environment:a,intl:r,store:e});p.push((0,T.jsx)(V().sA,{defaultMessage:"edit pages in {collectionTitle}",id:"automation.summaryCard.updatePages.differentCollection",values:{collectionTitle:t}}))}else if("variable"===n.type){const e=t[0],n=l[e],a=null==o?void 0:o[e];if(!n){p.push(ct().cC(r));continue}if(!a)continue;if(c().I3(n))if("person"===n.type)p.push((0,T.jsx)(Tt,{collectionStore:i,contextValues:(0,Ue().getAllContextValues)(u),propertyActionValue:a,propertySchema:n}));else if("status"===n.type){const e=(0,T.jsx)(bt,{propertyActionValue:a,propertySchema:n});e&&p.push(e)}else if("select"===n.type||"multi_select"===n.type)p.push((0,T.jsx)(Ct,{propertyActionValue:a,propertySchema:n}));else if("checkbox"===n.type)p.push((0,T.jsx)(At,{propertyActionValue:a,propertySchema:n}));else if("relation"===n.type)p.push((0,T.jsx)(kt,{collectionStore:i,propertyActionValue:a,propertySchema:n}));else if("date"===n.type){const t=(0,T.jsx)(jt,{automationActionId:j.id,collectionStore:i,propertyActionValue:a,propertyId:e,propertySchema:n});t&&p.push(t)}else"number"===n.type||"phone_number"===n.type||"text"===n.type||"title"===n.type||"email"===n.type||"url"===n.type?p.push((0,T.jsx)(Mt,{automationActionId:j.id,propertyActionValue:a,propertySchema:n})):(0,E().HB)(n);else p.push((0,nt().cn)({propertySchema:n,hasAutomationUpdatedErrorStatesEnabled:d}))}}else if(j.isType("create_page")){var m;const e=null===(m=j.getConfig())||void 0===m?void 0:m.collection;if(!e)continue;e.id===i.pointer.id?p.push((0,T.jsx)(V().sA,{defaultMessage:"create a page in this database",id:"automation.summaryCard.createPageThisDatabase"})):p.push((0,T.jsx)(V().sA,{defaultMessage:"create a page in another database",id:"automation.summaryCard.createPageAnotherDatabase"}))}else if(j.isType("define_variables")){var g;p.push((0,T.jsx)(V().sA,{defaultMessage:"define {numVariables} custom {numVariables, plural, one {variable} other {variables}}",values:{numVariables:(null===(g=j.getConfig())||void 0===g||null===(g=g.variableIds)||void 0===g?void 0:g.length)??0},id:"automation.summaryCard.defineVariables"}))}else if(j.isType("send_in_app_notification")){var h;const e=null===(h=j.getConfig())||void 0===h?void 0:h.target;if(!e)continue;const n=e.type;switch(n){case"formula":const a=(0,$e().Fbh)(null===(t=e.value)||void 0===t?void 0:t.value),l=(0,$e().kNd)(null===(o=e.value)||void 0===o?void 0:o.value),c=e=>{const t=j.getSpaceId()??"";return{table:qe().oo,id:e,spaceId:t}},u=a.map((e=>c(e))),d=u.map((e=>(0,s().xC)({getRecordModel:i.getRecordModel,pointer:e}))).filter(E().O9).map((e=>(0,s().lR)(r,e)));p.push((0,T.jsx)(V().sA,{defaultMessage:"{numTargets, plural, one {send a notification to {singleTarget}} other {send a notification to {numTargets} people}}",values:{numTargets:u.length+l.length,singleTarget:u.length>0?d[0]:Q().dC.created_by},id:"automation.summaryCard.sendNotificationUserTarget"}));break;case"property":if(!e.propertyId)break;let m;const g=i.getSchema()[e.propertyId];m=g?g.name??Q().dC[g.type]:ct().CV.unknownPropertyTitle.defaultMessage,p.push((0,T.jsx)(V().sA,{defaultMessage:"send a notification to {propertyDisplayName}",values:{propertyDisplayName:m},id:"automation.summaryCard.sendNotificationPropertyTarget"}));break;default:(0,E().HB)(n)}}else if(j.isType("send_gmail_notification")){var y,f,v,x;const e=j.getConfig()??{},{to:t,cc:o,bcc:n}=e;if(null==t||null===(y=t.value)||void 0===y||!y.value)continue;if("formula"===(null==t||null===(f=t.value)||void 0===f?void 0:f.type)||"formula"===(null==o||null===(v=o.value)||void 0===v?void 0:v.type)||"formula"===(null==n||null===(x=n.value)||void 0===x?void 0:x.type))p.push((0,T.jsx)(V().sA,{defaultMessage:"send an email to recipients based on a formula",id:"automation.summaryCard.sendGmailNotificationUserFormulaTarget"}));else{var S,b,C,A,k;const e=[...null===(S=t.value)||void 0===S?void 0:S.value,...(null==o||null===(b=o.value)||void 0===b?void 0:b.value)||[],...(null==n||null===(C=n.value)||void 0===C?void 0:C.value)||[]],a=(0,$e().Fbh)(e),l=(0,$e().kNd)(null===(A=t.value)||void 0===A?void 0:A.value),c=(0,$e().IQD)(e),u=e=>{const t=j.getSpaceId()??"";return{table:qe().oo,id:e,spaceId:t}},d=a.map((e=>(0,s().xC)({getRecordModel:i.getRecordModel,pointer:u(e)}))).filter(E().O9).map((e=>(0,s().lR)(r,e))),m=(0,Ge().C3)((0,$e().k4p)(e));d.push(...m);const g=d[0]||(null===(k=c[0])||void 0===k?void 0:k.name)||r.formatMessage(vt.automationSingleTargetDefault);p.push((0,T.jsx)(V().sA,{defaultMessage:"{numTargets, plural, one {send an email to {singleTarget}} other {send an email to {numTargets} people}}",values:{numTargets:new Set(d).size+l.length+c.length,singleTarget:g},id:"automation.summaryCard.sendGmailNotificationUserTarget"}))}}else j.isType("http_request")&&p.push((0,T.jsx)(V().sA,{defaultMessage:"send a webhook",id:"automation.summaryCard.sendWebRequest"}));return r.formatList(p,{style:"long",type:"conjunction"})}function bt(e){const{propertyActionValue:t,propertySchema:o}=e,n=(0,V().tz)(),i=(0,tt().qC)({intl:n,propertySchema:o,value:t.value});return i||null}function Ct(e){const{propertyActionValue:t,propertySchema:o}=e,n=(0,V().tz)();return(0,r().K8)((()=>(0,et().cI)({intl:n,limit:Xe().S,propertySchema:o,operator:null==t?void 0:t.action,value:t.value})),[n,null==t?void 0:t.action,t.value,o])}function At(e){const{propertyActionValue:t,propertySchema:o}=e;return(0,Qe().rD)({propertySchema:o,value:t.value})}function kt(e){const{collectionStore:t,propertyActionValue:o,propertySchema:n}=e,i=(0,V().tz)(),l=(0,a().v3)(),{typecheckResult:s}=(0,N().EC)(),c=o.value,u=(0,Ue().getAllContextValues)(s),d=(0,gt().Iq)({automationContextValues:u,limit:n.limit,value:c});return(0,r().K8)((()=>(0,gt().UW)({collectionStore:t,environment:l,intl:i,operator:null==o?void 0:o.action,propertySchema:n,relationPages:d,value:c})),[t,l,i,null==o?void 0:o.action,n,d,c])}function jt(e){const{automationActionId:t,collectionStore:o,propertyActionValue:n,propertyId:a,propertySchema:l}=e,s=(0,V().tz)(),c=n.value,u=(0,dt().F)({actionId:t}),d=(0,i.useMemo)((()=>({type:"collection",collectionStore:o,property:a})),[o,a]),p=(0,r().K8)((()=>(0,Je().A)({intl:s,propertySchema:l,typecheckContextValues:u,value:c,valueContext:d})),[s,l,u,c,d]);return p||null}function Mt(e){const{automationActionId:t,propertyActionValue:o,propertySchema:n}=e,i=(0,a().v3)(),s=(0,l().DP)(),{automationStore:c}=(0,N().EC)(),u=(0,dt().F)({actionId:t}),d=(0,r().K8)((()=>(0,ot().hF)({automationStore:c,environment:i,propertySchema:n,theme:s,typecheckContextValues:u,value:o.value})),[c,i,o.value,n,s,u]);return d||null}function Tt(e){const{collectionStore:t,propertyActionValue:o,propertySchema:n,contextValues:i}=e,a=(0,V().tz)(),l=(0,r().K8)((()=>(0,mt().hs)({getRecordModel:t.getRecordModel,contextValues:i,intl:a,operator:o.action,propertySchema:n,value:o.value})),[t.getRecordModel,a,o.action,o.value,n,i]);return l||null}var It=()=>o(244641),wt=()=>o(556927),Pt=()=>o(66913),Bt=()=>o(317909),Rt=()=>o(755199),_t=()=>o(460292),Vt=()=>o(554283);const Et=(0,V().YK)({whatsNewTitle:{defaultMessage:"See what’s new",id:"database.viewSettings.automationTab.automationWhatsNewTitle"},whatsNewUrl:{defaultMessage:"URL to show what’s new",id:"database.viewSettings.automationTab.automationWhatsNewUrl"},tryRepeatingTriggersTitle:{defaultMessage:"Try repeating triggers",id:"database.viewSettings.automationTab.automationWhatsNew.tryRepeatingTriggersTitle"},tryRepeatingTriggersBody:{defaultMessage:"Automatically create and edit items on a schedule",id:"database.viewSettings.automationTab.automationWhatsNew.tryRepeatingTriggersBody"},dismissButtonAriaLabel:{defaultMessage:"Close",id:"database.viewSettings.automationTab.automationWhatsNew.dismissButtonAriaLabel"}}),Ft={try_repeating_triggers:{title:Et.tryRepeatingTriggersTitle,body:Et.tryRepeatingTriggersBody,url:"https://www.notion.com/help/database-automations#database-automation-triggers"}};function Dt(e){let{collectionStoreId:t,surface:o,type:n}=e;const[s,c]=(0,i.useState)(!0),[u,d]=(0,Vt().B)(),p=(0,a().v3)(),m=(0,V().tz)(),g=(0,r().K8)((()=>{const{currentUserSettingsStore:e}=oe().default.state;if(!e||!e.isReady())return!1;const t=e.getSettingsStore().getKeyStore(`has_clicked_${n}_prompt`).getValue(),o=e.getSettingsStore().getKeyStore(`has_clicked_close_${n}_prompt`).getValue();if(t||o)return!1;const i=e.getSettingsStore().getKeyStore(`seen_${n}_prompt_at`).getValue();if((0,E().O9)(i)){const e=It().c9.fromMillis(i),t=It().c9.fromMillis(It().c9.now().toMillis()).diff(e,["weeks"]),o=t.toObject().weeks??0;return(0,E().O9)(t.toObject().weeks)&&o<=5}return Bt().createAndCommit({userAction:"AutomationsView.markPromptFirstSeen",environment:p,canUndo:!0,perform:t=>{Rt().mJ({userSettingsStore:e,transaction:t,data:{[`seen_${n}_prompt_at`]:It().c9.now().toMillis()}})}}),!0}),[p,n]),h=(0,l().IS)((e=>({button:{borderRadius:10,display:"flex",flexDirection:"column",position:"relative",background:e.tint.regular,padding:"9px 12px"},hoveredButton:{background:e.tint.primaryHover},pressedButton:{backgroundColor:e.tint.primaryPressed},title:{fontWeight:F().Wy.medium,fontSize:F().J.UIRegular.desktop,alignItems:"center",display:"flex",color:e.regularTextColor,lineHeight:"20px",flexDirection:"row",gap:"2px",marginBottom:6},description:{fontWeight:F().Wy.regular,color:e.text.secondary,fontSize:"14px",lineHeight:"20px"},dismissButton:{position:"absolute",right:6,top:6,borderRadius:4,display:"flex",height:20,justifyContent:"center",alignItems:"center",width:20,visibility:d?"visible":"hidden"},dismissIcon:{width:14,height:14,color:e.icon.secondary}})),[d]),y=(0,i.useCallback)((()=>{if(!t)return;(0,Z().u4)({environment:p,event:{eventName:"automation_learn_click",eventProperties:{collection_id:t,specific_feature:n,surface:o}}});const{currentUserSettingsStore:e}=oe().default.state;e&&e.isReady()&&Bt().createAndCommit({userAction:"AutomationsView.markPromptLinkClicked",environment:p,canUndo:!0,perform:t=>{Rt().mJ({userSettingsStore:e,transaction:t,data:{[`has_clicked_${n}_prompt`]:!0}})}})}),[t,n,o,p]),f=(0,i.useCallback)((e=>{if(e.preventDefault(),e.stopPropagation(),c(!1),!t)return;(0,Z().u4)({environment:p,event:{eventName:"automation_close_learn_prompt",eventProperties:{collection_id:t,specific_feature:n,surface:o}}});const{currentUserSettingsStore:i}=oe().default.state;i&&i.isReady()&&Bt().createAndCommit({userAction:"AutomationsView.markPromptDismissed",environment:p,canUndo:!0,perform:e=>{Rt().mJ({userSettingsStore:i,transaction:e,data:{[`has_clicked_close_${n}_prompt`]:!0}})}})}),[t,p,o,n]);return s&&g?(0,T.jsxs)(Re().A,{style:h.button,hoveredStyle:h.hoveredButton,pressedStyle:h.pressedButton,ref:u,href:Ft[n].url,external:!0,onClick:y,children:[(0,T.jsxs)("div",{style:h.title,children:[(0,T.jsx)(V().sA,{...Ft[n].title}),(0,T.jsx)(_t().Q,{iconGroup:wt().j,variantName:"mini",colorName:"secondary"})]}),(0,T.jsx)("div",{style:h.description,children:(0,T.jsx)(V().sA,{...Ft[n].body})}),(0,T.jsx)(H().p,{size:"sm",style:h.dismissButton,onClick:f,"aria-label":m.formatMessage(Et.dismissButtonAriaLabel),children:(0,Pt().V)(h.dismissIcon)})]}):null}const Lt=(0,V().YK)({automationTabTitle:{defaultMessage:"Automations",id:"database.viewSettings.automationTab.title"},automationTabFilterButton:{defaultMessage:"Filter",id:"database.viewSettings.automationTab.filterButton"},automationTabAddFilterButton:{defaultMessage:"Add filter",id:"database.viewSettings.automationTab.addFilterButton"},automationTabFilterMenuSearchInputPlaceholder:{defaultMessage:"Filter by…",id:"database.viewSettings.automationTab.filterMenuSearchInputPlaceholder"},automationTabFilterMenuNoResults:{defaultMessage:"No results",id:"database.viewSettings.automationTab.filterMenuNoResults"},automationNewAutomationTitle:{defaultMessage:"New automation",id:"database.viewSettings.automationTab.newAutomationTitle"},automationLearnAutomationTitle:{defaultMessage:"Learn about automations",id:"database.viewSettings.automationTab.learnAutomationTitle"},automationDisabledCaption:{defaultMessage:"Paused",id:"database.viewSettings.automationTab.disabledCaption"},automationEmptyViewEditorPublic:{defaultMessage:"Automatically edit properties, create pages, send updates, and more",id:"database.viewSettings.automationTab.automationEmptyViewEditorPublic"},automationEmptyViewReadOnly:{defaultMessage:"You're a content viewer. Content viewers cannot create automations.",id:"database.viewSettings.automationTab.automationEmptyViewReadOnly"},automationEmptyViewContentOnly:{defaultMessage:"You're a content editor. Content editors can edit pages, but cannot create automations.",id:"database.viewSettings.automationTab.automationEmptyViewContentOnly"},automationSearchPlaceholder:{defaultMessage:"Search automations…",id:"database.viewSettings.automationTab.automationSearchPlaceholder"},automationInvalidPausedCaption:{defaultMessage:"Fix any errors or remove failing steps to enable this automation",id:"database.viewSettings.automationTab.automationInvalidPausedCaption"},automationInvalidActiveCaption:{defaultMessage:"Fix any errors or remove failing steps to prevent this automation from pausing on failure",id:"database.viewSettings.automationTab.automationInvalidActiveCaption"},automationRestartSuccessMessage:{defaultMessage:"Restarted automation successfully",id:"automations.buttonTrigger.restartSuccessMessage"}});function Ot(e){const{collectionContextStore:t,collectionSettingsStore:o,fullHeight:s,tabSettings:c}=e,u=(0,a().v3)(),d=(0,V().tz)(),{isMobile:p}=(0,a().Y0)(),[m,g]=(0,i.useState)(""),h=(0,r().K8)((()=>t.collectionStore()),[t]),y=(0,r().K8)((()=>t.collectionViewBlockStore()),[t]),f=(0,r().K8)((()=>h&&h.id),[h]),v=(0,r().K8)((()=>null==h?void 0:h.getSchema()),[h]),x=(0,r().K8)((()=>null==h?void 0:h.getFormat()),[h]),S=(0,r().K8)((()=>function(e){const{collectionStore:t,collectionViewBlockStore:o}=e;if(!t||!o)return[];const n=t.getAutomationStores(),i=[];for(const a of n){const e=a.getModel();null!=e&&e.getAlive()&&(a.isDisplayableInCollectionSettings()&&i.push(a))}return i}({collectionStore:h,collectionViewBlockStore:y})),[h,y]),C=(0,r().K8)((()=>function(e){const{automationStores:t,collectionSchema:o,intl:i}=e,a=new Map,r=[];for(const n of t){var l;if(!n.isDefined())continue;const e=[],t=n.getName();void 0!==t&&e.push(t);const s=null===(l=n.getOwnerStore())||void 0===l?void 0:l.getDisplayName(i);if(void 0!==s&&e.push(s),n.isTriggerType("event")){const t=n.getEventConfiguration(),a=null==t?void 0:t.pagePropertiesEdited;let r;if("some"===(null==a?void 0:a.type)?r=a.some:"all"===(null==a?void 0:a.type)&&(r=a.all),r)for(const n of r){const t=null==o?void 0:o[n.property];t&&e.push(`${t.name} ${Q().dC[t.type]}`)}const l=Ht(n.getActionStores(),o,i);e.push(...l)}else if(n.isTriggerType("recurrence")){const t=n.getRecurrence();t&&e.push((0,W().LS)({recurrence:t,intl:i,leadingPhrase:"every"}));const a=Ht(n.getActionStores(),o,i);e.push(...a)}const c=e.join(" ");a.set(n.id,c),r.push(c)}return function(e){const o=new Set(n().filter(e,r).map((e=>{let{original:t}=e;return t})));return t.filter((0,E().u0)((e=>{if(!e.isTriggerType("event")&&!e.isTriggerType("recurrence"))return{false:e};const t=a.get(e.id);return t&&o.has(t)?{true:e}:{false:e}})))}}({automationStores:S,collectionSchema:v,intl:d})),[S,v,d]),k=(0,r().K8)((()=>C(m)),[C,m]),j=(0,r().K8)((()=>J().rc({collectionStore:h})),[h]),M=(0,i.useCallback)((()=>{D().js({environment:u,collectionSettingsStore:o,collectionContextStore:t})}),[u,o,t]),I=(0,i.useCallback)((e=>g(e.target.value)),[]),w=(0,i.useCallback)((()=>{f&&(0,Z().u4)({environment:u,event:{eventName:"automation_learn_click",eventProperties:{collection_id:f}}})}),[u,f]);(0,i.useEffect)((()=>{f&&((0,Z().u4)({environment:u,event:{eventName:"automation_list_view",eventProperties:{source:c.source,collection_id:f}}}),ne().default.logEvent("automation_list_view","true"))}),[u,f,c]);const[P,B]=i.useState(!1),R=(0,r().K8)((()=>function(e){var t;const o=null===(t=oe().default.state.currentUserStore)||void 0===t?void 0:t.pointer,n=[],i=[];for(const a of e){const e=a.getCreatedByPointer();o&&e&&_().L3.isEqual(o,e)?n.push(a):i.push(a)}return n.sort(((e,t)=>t.getLastEditedTime()-e.getLastEditedTime())),i.sort(((e,t)=>t.getLastEditedTime()-e.getLastEditedTime())),{currentUserAutomations:n,otherUserAutomations:i}}(k)),[k]),F=(0,i.useMemo)((()=>{const{currentUserAutomations:e,otherUserAutomations:t}=R;return P?[...e,...t]:e.length>0?e:t}),[R,P]),L=k.length-F.length,O=!P&&L>0,K=F.length>0,X=!K&&!(""!==m),{currentSpaceStoreId:ee,currentUserStoreId:ae}=(0,r().K8)((()=>{var e,t;return{currentSpaceStoreId:null===(e=oe().default.state.currentSpaceStore)||void 0===e?void 0:e.id,currentUserStoreId:null===(t=oe().default.state.currentUserStore)||void 0===t?void 0:t.id}}),[]),re=(0,ie().P9)({name:"premium_automations",spaceId:ee,userId:ae}),le=(0,r().K8)((()=>J().rc({collectionStore:h})),[h]),se=re&&le,ce=(0,l().IS)((e=>({buttonList:{display:"flex",flexDirection:"column",flexShrink:1,gap:12,overflow:"hidden auto",paddingBlockEnd:p?0:12,paddingBlockStart:p?12:0,paddingInline:12},emptyViewWrap:{paddingBlockEnd:12,paddingInline:12},menuScrollerStyle:{marginBlockStart:p?12:8},wrap:{display:"flex",flexDirection:"column"},showMoreButtonContainer:{marginLeft:12,marginBottom:12,marginRight:"auto"},showMoreButtonContent:{fontSize:12},noResultsTitle:{color:e.text.secondary,fontSize:12,margin:0},createSection:{paddingBlock:20},createButtonWrapper:{paddingInline:12},createButton:{width:"100%",display:"flex",gap:6},headerContainer:{alignItems:"center",display:"flex",gap:4},headerInfoIcon:{fill:e.mediumIconColor,height:14,width:14}})),[p]);return h&&v&&x&&y?(0,T.jsx)(z().Ay,{...e,fullHeight:s,header:!X&&(0,T.jsx)(q().A,{children:(0,T.jsx)(U().Ay,{focusInitial:!p,onChange:I,placeholder:d.formatMessage(Lt.automationSearchPlaceholder),showClearButton:!0,value:m})}),footer:(0,T.jsx)(q().A,{style:ce.createSection,topBorder:!1,children:j&&(0,T.jsx)("div",{style:ce.createButtonWrapper,children:(0,T.jsxs)(G().A,{style:ce.createButton,onClick:M,children:[(0,A().W)({width:14,height:14}),(0,T.jsx)(V().sA,{...Lt.automationNewAutomationTitle})]})})}),menuScrollerStyle:ce.menuScrollerStyle,title:K||m?(0,T.jsxs)("div",{style:ce.headerContainer,children:[(0,T.jsx)(V().sA,{...Lt.automationTabTitle}),(0,T.jsx)($().A,{placement:te().W.Right,renderTooltip:()=>(0,T.jsx)(V().sA,{...Lt.automationLearnAutomationTitle}),render:e=>(0,T.jsx)(Y().A,{...e,href:"https://www.notion.so/help/database-automations",external:!0,onClick:w,children:(0,b().$)(ce.headerInfoIcon)})})]}):null,children:(0,T.jsx)("div",{style:ce.wrap,children:X?(0,T.jsxs)("div",{style:ce.emptyViewWrap,children:[(0,T.jsx)(Kt,{collectionStore:h}),se&&(0,T.jsx)(Dt,{surface:"empty_automations_view",type:"try_repeating_triggers",collectionStoreId:f})]}):(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)("div",{style:ce.buttonList,children:[se&&(0,T.jsx)(Dt,{surface:"list_automations_view",type:"try_repeating_triggers",collectionStoreId:f}),F.length>0?F.map(((e,n)=>(0,T.jsx)(N().or,{automationStore:e,children:(0,T.jsx)(Wt,{collectionContextStore:t,collectionStore:h,collectionSettingsStore:o,focused:!1,schema:v})},e.id))):(0,T.jsx)("p",{style:ce.noResultsTitle,children:(0,T.jsx)(V().sA,{defaultMessage:"No results",id:"collectionSettings.automationsView.noResults"})})]}),O&&(0,T.jsx)(H().p,{isGray:!0,size:"xs",style:ce.showMoreButtonContainer,onClick:e=>{e.stopPropagation(),B(!0)},children:(0,T.jsx)("div",{style:ce.showMoreButtonContent,children:(0,T.jsx)(V().sA,{id:"collectionSettings.automationsView.showMore",defaultMessage:"Show {number} more",values:{number:L}})})})]})})}):null}function Kt(e){const{collectionStore:t}=e,o=(0,a().v3)(),n=(0,l().IS)((e=>({wrap:{alignItems:"center",display:"flex",flexDirection:"column",gap:7.5,justifyContent:"center",minHeight:250,textAlign:"center"},icon:{fill:e.icon.yellowPrimary,height:24,width:24},title:{fontSize:17,fontWeight:F().Wy.medium,margin:0},copy:{color:e.text.secondary,fontSize:14,margin:0,lineHeight:1.5}})),[]),i=(0,r().K8)((()=>t.getRole()),[t]);let s;return s=(0,r().K8)((()=>Boolean((0,X().qb)(o,t))),[t,o])||!i||"editor"===i?Lt.automationEmptyViewEditorPublic:"reader"===i||"comment_only"===i?Lt.automationEmptyViewReadOnly:"content_only_editor"===i||"read_and_write"===i?Lt.automationEmptyViewContentOnly:Lt.automationEmptyViewEditorPublic,(0,T.jsxs)("div",{style:n.wrap,children:[(0,T.jsx)("div",{"aria-hidden":!0,children:(0,f().v)(n.icon)}),(0,T.jsx)("p",{style:n.title,children:(0,T.jsx)(V().sA,{...Lt.automationTabTitle})}),(0,T.jsx)("p",{style:n.copy,children:(0,T.jsx)(V().sA,{...s})})]})}const Nt={text:B().U,number:o(966098).E,url:o(352064).I,file:o(504709).J,date:o(758219).Z,person:o(234194).M,email:o(617073).J,phone_number:o(818256).C,checkbox:o(263178).S,select:o(974967).n,multi_select:w().v,status:P().T,relation:o(365683).H,rollup:o(735925).h,formula:o(514503).n,created_time:j().w,created_by:M().E,title:o(263931).D,last_edited_time:j().w,last_edited_by:M().E,last_visited_time:j().w,button:P().T,auto_increment_id:o(786386).A,location:I,verification:o(372160).E,geo_point:I,ai_summary:o(727706).G,ai_custom_prompt:o(806411).x,ai_extract:w().v,ai_translate:o(318890).K,ai_keywords:o(981714).u};function Wt(e){const{collectionContextStore:t,collectionStore:o,collectionSettingsStore:n,focused:l,schema:u}=e,d=(0,V().tz)(),f=(0,a().v3)(),{automationStore:b,typecheckResult:j}=(0,N().EC)(),M=(0,r().K8)((()=>J().Qn({automationStore:b,collectionStore:o,typecheckResult:j})),[b,o,j]),I=(0,r().K8)((()=>b.getActionStores()),[b]),w=(0,r().K8)((()=>b.getTriggerStore().getValue()),[b]),P=(0,r().K8)((()=>b.getNameWithDefault(d)),[d,b]),R=(0,r().K8)((()=>b.isActive()),[b]),_=(0,r().O$)(t.aliveAutomationCountStore),F=(0,r().K8)((()=>J().TT({actionStores:I,automationStore:b,collectionStore:o})),[I,b,o]),z=(0,r().K8)((()=>J().Gz({automationStore:b,collectionStore:o})),[b,o]),H=(0,i.useCallback)((async()=>{await ae().lg({collectionStore:o,environment:f,existingAutomationStore:b,intl:d,onDelete:()=>{1===_&&D().R8({collectionSettingsStore:n,item:{type:"main"}})}})}),[d,f,o,n,b,_]),U=(0,i.useCallback)((()=>{ae().WA({automationStore:b,environment:f})}),[f,b]),Y=(0,i.useCallback)((()=>{O().h({environment:f,mode:"edit_automation",collectionSettingsStore:n,collectionContextStore:t,automationId:b.id,source:"collection_settings_automation_view"})}),[f,n,t,b]),G=(0,i.useCallback)((()=>{ae().HJ({automationStore:b,environment:f})}),[f,b]),q=(0,i.useCallback)((()=>{ae().vH({automationStore:b,collectionStore:o,environment:f})}),[b,o,f]),$=(0,i.useCallback)((()=>{if(!b.isTriggerType("recurrence"))return;ae().be({automationStore:b,collectionStore:o,environment:f});const e=d.formatMessage(Lt.automationRestartSuccessMessage);L().D6({label:e})}),[b,o,f,d]),Z=(0,r().K8)((()=>w?function(e){const{schema:t,triggerConfig:o,collectionStore:n}=e,i=[];if("event"===o.type){o.event.pagesAdded&&i.push({color:"blue",icon:A().W,type:"page"});const e=o.event.pagePropertiesEdited;if("any"===e.type)i.push({color:"blue",icon:C().r,type:"misc"});else if("some"===e.type||"all"===e.type){let o=[];"some"===e.type?o=e.some??[]:"all"===e.type&&(o=e.all??[]);for(const e of o){const o=t[e.property],a=e.filter;if(!o)continue;if(!c().tj[o.type]){i.push({color:"gray",icon:zt(o.type),type:"property"});continue}const r=m().DD(o),l=m().lx(o),u=m().E(o),d=m().AM(o),h=(0,g().DY)(o.type),y=m().nC(o);if("changes_to_any"===a.operator)i.push({color:r||l?"gray":"blue",icon:zt(o.type),type:"property"});else if(r&&!p().fZ(a)&&p().H$(a)){const e=p().V6(a);if(e.length>1)i.push({color:"gray",icon:zt(o.type),type:"property"});else if(1===e.length){const t=e[0];if("is_group"===t.type){const e=(o.groups??[]).find((e=>e.name===t.value));e&&i.push({color:e.color??"gray",icon:zt(o.type),type:"property"})}else{const e=(o.options??[]).find((e=>e.value===t.value));e&&i.push({color:e.color??"gray",icon:zt(o.type),type:"property"})}}}else if(l&&(p().v0(a)||p().as(a))){const e=p().fZ(a)?[]:p().v0(a)?p().Zl(a):p().SM(a);if(1===e.length){const t=e[0],n=(o.options??[]).find((e=>e.value===t.value));n&&i.push({color:n.color??"gray",icon:zt(o.type),type:"property"})}else(e.length>1||0===e.length)&&i.push({color:"gray",icon:zt(o.type),type:"property"})}else if(u&&p().I_(a)){const e=p().fZ(a)?[]:p().Wf(a);if(1===e.length){if(!p().fZ(a)){const e=p().Wf(a)[0];if("exact"===e.type&&e.value){const t=(0,s().xC)({pointer:e.value,getRecordValue:n.getRecordValue});i.push({actor:t,type:"person"})}}}else(e.length>1||0===e.length)&&i.push({color:"gray",icon:zt(o.type),type:"property"})}else(d&&p().My(a)||h&&p().YH(a)||y&&p().Pq(a))&&i.push({color:"is_empty"===a.operator?"gray":"blue",icon:zt(o.type),type:"property"})}}}else"recurrence"===o.type?i.push({color:"blue",icon:v().k,type:"misc"}):"button"===o.type||(0,E().HB)(o);return i}({schema:u,triggerConfig:w,collectionStore:o}):[]),[u,w,o]),Q=(0,r().K8)((()=>function(e){const{actionStores:t,collectionStore:o,schema:n}=e,i=[];for(const d of t)if(d.isType("slack_notification"))i.push({icon:k().z,type:"app"});else if(d.isType("update_pages")){const e=d.getConfig(),t=(null==e?void 0:e.properties)??[];if(1===t.length){var a,r;const u=t[0],d=n[u],p=null==e||null===(a=e.values)||void 0===a?void 0:a[u];if(!d||!p)continue;if(!c().I3(d)){i.push({color:"gray",icon:zt(d.type),type:"property"});continue}const y=(0,h().fromSimpleFormulaArrayValue)(null===(r=p.value)||void 0===r?void 0:r.value);if(m().DD(d)){const e=(d.options||[]).find((e=>e.value===y[0]));e&&i.push({color:e.color??"gray",icon:zt(d.type),type:"property"})}else if(m().lx(d))if(1===y.length){const e=(d.options||[]).find((e=>e.value===y[0]));e&&i.push({color:e.color??"gray",icon:zt(d.type),type:"property"})}else y.length>1&&i.push({color:"gray",icon:zt(d.type),type:"property"});else if(m().E(d)){var l;const e=(0,g().e5)({textValue:null===(l=p.value)||void 0===l?void 0:l.value,propertySchema:d,blockCreatorPointer:void 0}).map((e=>(0,s().xC)({pointer:e,getRecordValue:o.getRecordValue})));1===e.length?i.push({actor:e[0],type:"person"}):i.push({color:"gray",icon:zt(d.type),type:"property"})}else i.push({color:"gray",icon:zt(d.type),type:"property"})}else t.length>1&&i.push({color:"gray",icon:C().r,type:"misc"})}else if(d.isType("create_page")){var u;(null===(u=d.getConfig())||void 0===u?void 0:u.collection)&&i.push({color:"blue",icon:A().W,type:"page"})}else d.isType("send_in_app_notification")?i.push({color:"blue",icon:y().r,type:"misc"}):d.isType("define_variables")?i.push({color:"gray",icon:B().U,type:"misc"}):d.isType("send_gmail_notification")?i.push({icon:S().Y,type:"app"}):d.isType("http_request")&&i.push({color:"gray",icon:e=>(0,x().B)({transform:"scale(1.35)",...e}),type:"misc"});return i}({actionStores:I,collectionStore:o,schema:u})),[u,o,I]),X=(0,r().K8)((()=>{if(b.isTriggerType("event")){return!b.getTrigger()||J().l({automationStore:b,collectionStore:o})}return!1}),[b,o]),oe=(0,i.useMemo)((()=>{if(j.error)return!0;const e=j.value.actionValidationFailures;return Object.values(e).flat().length>0}),[j]),ne=(0,ee().X)("automation_updated_error_states"),ie=(0,r().K8)((()=>{var e,t;const o=null===(e=b.getModel())||void 0===e?void 0:e.getLastFailedTime(),n=null===(t=b.getModel())||void 0===t?void 0:t.getLastExecutedTime();if(ne){if(oe||X||!M)return"invalid";if(o&&n&&o>=n&&!R)return"failing";if(!R)return(0,W().NH)(b)?"expired":"paused"}else{if(oe||X)return"error";if(!R)return"warning"}return"success"}),[b,ne,oe,X,M,R]),{caption:re,tooltipCaption:le}=(0,r().K8)((()=>{const e=R||ne?xt({actionStores:I,collectionStore:o,environment:f,getRecordModel:b.getRecordModel,intl:d,schema:u,triggerConfig:w,typecheckResult:j,hasAutomationUpdatedErrorStatesEnabled:ne}):d.formatMessage(Lt.automationDisabledCaption);return{caption:e,tooltipCaption:ne&&"invalid"===ie?(0,T.jsx)(V().sA,{...R?Lt.automationInvalidActiveCaption:Lt.automationInvalidPausedCaption}):e}}),[R,ne,d,I,o,f,b.getRecordModel,u,w,j,ie]),se=(0,i.useCallback)((e=>(0,i.createElement)(Fe,{...e,key:b.id,actions:Q,caption:re,focused:l,status:ie,onClick:Y,onDelete:z?H:void 0,onDisable:R&&z&&M?U:void 0,onRestart:"expired"===ie?$:void 0,onDuplicate:F?q:void 0,onEdit:F?Y:void 0,onEnable:!R&&z&&M?G:void 0,title:P,triggers:Z})),[Q,b.id,F,z,re,l,ie,R,M,H,U,q,Y,G,$,P,Z]);return(0,T.jsx)(K().P,{caption:le,renderOrigin:se,title:P,tooltipAlignment:te().C.Start,tooltipPlacement:te().W.Left})}function zt(e){return(0,E().O9)(e)?Nt[e]??R().x:R().x}function Ht(e,t,o){const n=[];for(const a of e){const e=a.getType();if(e){const t=(0,u().getActionRegistryItem)(e);(0,d().qe)(t)&&n.push(o.formatMessage(t.display.name))}if(a.isType("create_page")||a.isType("update_pages")){var i;const e=a.getConfig();null==e||null===(i=e.properties)||void 0===i||i.forEach((e=>{const o=null==t?void 0:t[e];o&&n.push(`${o.name} ${Q().dC[o.type]}`)}))}}return n}},475679:(e,t,o)=>{o.d(t,{z:()=>F});o(898992),o(354520),o(737550);var n=o(296540),i=()=>o(484714),a=()=>o(56366),r=()=>o(401497),l=()=>o(655923),s=()=>o(112282),c=()=>o(457056),u=()=>o(334003),d=()=>o(764781),p=()=>o(105819),m=()=>o(406533),g=()=>o(236262),h=()=>o(340498),y=()=>o(959013),f=()=>o(534177),v=()=>o(813297),x=()=>o(760217),S=()=>o(187485),b=()=>o(135221),C=()=>o(928600),A=()=>o(939740),k=()=>o(89924),j=()=>o(862292),M=()=>o(645873),T=()=>o(324587),I=()=>o(546461),w=()=>o(366360),P=()=>o(781697),B=()=>o(383574),R=()=>o(686169),_=()=>o(542339),V=o(474848);const E=(0,y().YK)({learnAboutVariablesMenuItemLabel:{defaultMessage:"Learn about variables",id:"automations.actionContextMenu.learnAboutVariablesMenuItemLabel"},learnAboutWebhooksMenuItemLabel:{defaultMessage:"Learn about webhooks",id:"automations.actionContextMenu.learnAboutWebhooksMenuItemLabel"},addStepAboveMenuItemLabel:{defaultMessage:"Add action above",id:"automations.actionContextMenu.addStepAboveMenuItemLabel"},addStepBelowMenuItemLabel:{defaultMessage:"Add action below",id:"automations.actionContextMenu.addStepBelowMenuItemLabel"},deleteMenuItemLabel:{defaultMessage:"Delete",id:"automations.actionContextMenu.deleteMenuItemLabel"},duplicateMenuItemLabel:{defaultMessage:"Duplicate",id:"automations.actionContextMenu.duplicateMenuItemLabel"},duplicatingMenuItemLabel:{defaultMessage:"Duplicating…",id:"automations.actionContextMenu.duplicatingMenuItemLabel"},editMenuItemLabel:{defaultMessage:"Edit",id:"automations.actionContextMenu.editMenuItemLabel"},moveDownMenuItemLabel:{defaultMessage:"Move down",id:"automations.actionContextMenu.moveDownMenuItemLabel"},moveUpMenuItemLabel:{defaultMessage:"Move up",id:"automations.actionContextMenu.moveUpMenuItemLabel"}});function F(e){const{actionStore:t,closeMenu:o}=e,{maybePersistedTransactionActions:r}=(0,w().b)(),{automationStore:l,contextType:s}=(0,I().EC)(),c=(0,y().tz)(),u=(0,i().v3)(),{value:d}=(0,M().fJ)(j().T.formulas),{value:p}=(0,M().fJ)(v().QV.automationTypecheck),[m,g]=(0,n.useState)(),h=(0,a().K8)((()=>l.getActionIds()),[l]),f=(0,a().K8)((()=>h.indexOf(t.id)),[t.id,h]),x=(0,a().K8)((()=>(0,R().J)(s,t)),[t,s]),S=(0,a().K8)((()=>{if(!x||!t.isType("update_pages"))return;const e=t.getConfigStore().getKeyStore("properties").getValue();return null==e?void 0:e[0]}),[t,x]),b=0===f,C=f===h.length-1,A=(0,n.useCallback)((()=>{g(void 0),null==o||o()}),[o]),k=(0,B().V)(),P=(0,a().K8)((()=>k.some((e=>e.type===t.getType()))),[t,k]),F=(0,n.useMemo)((()=>{if(l&&P)return async()=>{const e=r.createAndCommit({perform:e=>T().duplicateAutomationAction({sourceActionStore:t,environment:u,includeParenting:!0,insertionPoint:{afterActionId:t.id},transaction:e}),userAction:"ActionContextMenu.duplicateAction"});await e.performResult.onComplete,A()}}),[t,l,u,A,r,P]),L=(0,n.useCallback)((()=>{if(d&&p)return r.createAndCommit({perform:e=>{T().removeAutomationAction({actionStore:t,automationStore:l,automationTypecheckModule:p,contextType:s,environment:u,formulasModule:d,intl:c,transaction:e})},userAction:"ActionContextMenu.removeAction"}),A(),Promise.resolve()}),[t,l,p,s,u,d,A,c,r]),K=(0,n.useMemo)((()=>{if(!b&&d&&p)return()=>{r.createAndCommit({perform:e=>{const o=O(h,f-1,f);T().reorderAutomationActions({environment:u,automationStore:l,automationTypecheckModule:p,contextType:s,formulasModule:d,intl:c,newActionIds:o,transaction:e,from:"action_menu",movedActionId:t.id})},userAction:"ActionContextMenu.moveAction"}),A()}}),[b,r,A,h,d,f,l,s,c,u,t,p]),N=(0,n.useMemo)((()=>{if(!C&&d&&p)return()=>{r.createAndCommit({perform:e=>{const o=O(h,f+1,f);T().reorderAutomationActions({environment:u,automationStore:l,automationTypecheckModule:p,contextType:s,formulasModule:d,intl:c,newActionIds:o,transaction:e,from:"action_menu",movedActionId:t.id})},userAction:"ActionContextMenu.moveAction"}),A()}}),[C,r,A,h,f,l,s,c,d,u,t,p]),W=(0,n.useMemo)((()=>{if(x&&S)return function(){g({initialState:{actionId:t.id,propertyId:S,type:"eventActionProperty"},insertionPoint:void 0})}}),[t.id,x,S]),z=(0,n.useMemo)((()=>{if(0!==k.length)return()=>{g({initialState:{availableActions:[],hasUpdateThisPagePropertyActions:!0,hasSearch:!0,type:"eventActions"},insertionPoint:{beforeActionId:t.id}})}}),[k.length,t.id]),H=(0,n.useMemo)((()=>{if(0!==k.length)return()=>{g({initialState:{availableActions:[],hasUpdateThisPagePropertyActions:!0,hasSearch:!0,type:"eventActions"},insertionPoint:{afterActionId:t.id}})}}),[k.length,t.id]),U=(0,a().K8)((()=>"define_variables"===t.getType()?{link:"https://www.notion.so/help/database-automations#database-automation-actions",label:E.learnAboutVariablesMenuItemLabel}:"http_request"===t.getType()?{link:"https://www.notion.so/help/webhook-actions",label:E.learnAboutWebhooksMenuItemLabel}:void 0),[t]);return(0,V.jsxs)(V.Fragment,{children:[!m&&(0,V.jsx)(D,{onAddStepAbove:z,onAddStepBelow:H,onDelete:L,onDuplicate:F,onEdit:W,onMoveDown:N,onMoveUp:K,learnAbout:U}),m&&(0,V.jsx)(_().A,{initialState:m.initialState,insertionPoint:m.insertionPoint,onClose:A})]})}function D(e){const{onAddStepAbove:t,onAddStepBelow:o,onDelete:i,onDuplicate:a,onEdit:v,onMoveDown:x,onMoveUp:b,learnAbout:j}=e,M=(0,P().e)();let T=!1;const I=function(e){const{hasSeparator:t,onEdit:o}=e,i=(0,n.useMemo)((()=>{if(o)return{action:o,key:"edit",render:e=>(0,V.jsx)(L,{...e,icon:(0,p().x)({width:h().Ev.default}),children:(0,V.jsx)(y().sA,{...E.editMenuItemLabel})})}}),[o]),a=[i].filter(f().O9);if(0===a.length)return;return{items:a,key:"editActions",render:e=>(0,V.jsx)(k().A,{enableActionSheetTitle:!0,topBorder:t,...e})}}({hasSeparator:T,onEdit:v});T||=Boolean(I);const w=function(e){const{hasSeparator:t,onMoveDown:o,onMoveUp:i}=e,a=(0,n.useMemo)((()=>{if(i)return{action:i,key:"moveUp",render:e=>(0,V.jsx)(L,{...e,icon:(0,s().s)({width:h().Ev.default}),children:(0,V.jsx)(y().sA,{...E.moveUpMenuItemLabel})})}}),[i]),r=(0,n.useMemo)((()=>{if(o)return{action:o,key:"moveDown",render:e=>(0,V.jsx)(L,{...e,icon:(0,l().v)({width:h().Ev.default}),children:(0,V.jsx)(y().sA,{...E.moveDownMenuItemLabel})})}}),[o]),c=[a,r].filter(f().O9);if(0===c.length)return;return{items:c,key:"moveSteps",render:e=>(0,V.jsx)(k().A,{enableActionSheetTitle:!0,topBorder:t,...e})}}({hasSeparator:T,onMoveDown:x,onMoveUp:b});T||=Boolean(w);const B=function(e){const{hasSeparator:t,onAddStepAbove:o,onAddStepBelow:i}=e,a=(0,n.useMemo)((()=>{if(o)return{action:o,key:"addStepAbove",render:e=>(0,V.jsx)(L,{...e,icon:(0,u().F)({width:h().Ev.default}),children:(0,V.jsx)(y().sA,{...E.addStepAboveMenuItemLabel})})}}),[o]),r=(0,n.useMemo)((()=>{if(i)return{action:i,key:"addStepBelow",render:e=>(0,V.jsx)(L,{...e,icon:(0,c().o)({width:h().Ev.default}),children:(0,V.jsx)(y().sA,{...E.addStepBelowMenuItemLabel})})}}),[i]),l=[a,r].filter(f().O9);if(0===l.length)return;return{items:l,key:"addSteps",render:e=>(0,V.jsx)(k().A,{enableActionSheetTitle:!0,topBorder:t,...e})}}({hasSeparator:T,onAddStepAbove:t,onAddStepBelow:o});T||=Boolean(B);const R=function(e){const{hasSeparator:t,onDuplicate:o,onDelete:i}=e,[a,r]=(0,n.useState)(!1),l=(0,n.useMemo)((()=>{if(o)return{action:async()=>{r(!0);try{await o()}finally{r(!1)}},key:"duplicate",render:e=>(0,V.jsx)(L,{...e,icon:(0,d().V)({width:h().Ev.default}),isLoading:a,children:a?(0,V.jsx)(y().sA,{...E.duplicatingMenuItemLabel}):(0,V.jsx)(y().sA,{...E.duplicateMenuItemLabel})})}}),[a,o]),s=(0,n.useMemo)((()=>{if(i)return{action:i,key:"delete",render:e=>(0,V.jsx)(L,{...e,icon:(0,g().I)({width:h().Ev.default}),isRedOnHover:!0,children:(0,V.jsx)(y().sA,{...E.deleteMenuItemLabel})})}}),[i]),c=[l,s].filter(f().O9);if(0===c.length)return;return{items:c,key:"otherActions",render:e=>(0,V.jsx)(k().A,{enableActionSheetTitle:!0,topBorder:t,...e})}}({hasSeparator:T,onDuplicate:a,onDelete:i});T||=Boolean(R);const _=function(e){const{hasSeparator:t,learnAbout:o}=e,n=(0,r().IS)((e=>({icon:{height:16,width:16,fill:e.mediumTextColor},textWrapper:{color:e.mediumTextColor}})),[]);if(!o)return;return{items:[{action:()=>{},key:"learnAbout",render:e=>(0,V.jsx)(L,{...e,icon:(0,m().T)(n.icon),textWrapperStyle:n.textWrapper,children:(0,V.jsx)(S().A,{href:o.link,external:!0,children:(0,V.jsx)(y().sA,{...o.label})})})}],key:"learnSteps",render:e=>(0,V.jsx)(k().A,{topBorder:t,...e})}}({hasSeparator:T,learnAbout:j});return T||=Boolean(_),(0,V.jsx)(C().A,{...M,children:(0,V.jsx)(A().Ay,{type:A().Oh.Vertical,sections:[I,w,B,R,_].filter(f().O9),initialFocus:0})})}function L(e){const{children:t,icon:o,isLoading:n,...i}=e,a=n?(0,V.jsx)(b().A,{}):o;return(0,V.jsx)(x().A,{...i,disabled:n,disabledFeedback:n,icon:a,title:t})}function O(e,t,o){if(t<0||t>=e.length||o<0||o>=e.length)return e;const n=[...e];return n[t]=e[o],n[o]=e[t],n}},488887:(e,t,o)=>{function n(e,t){if(e.size!==t.size)return!1;for(const o of e)if(!t.has(o))return!1;return!0}o.d(t,{_:()=>n})},495408:(e,t,o)=>{o.d(t,{p:()=>b});var n=o(296540),i=()=>o(484714),a=()=>o(401497),r=()=>o(30626),l=()=>o(173019),s=()=>o(959013),c=()=>o(100622),u=()=>o(522945),d=()=>o(962730),p=()=>o(397248),m=()=>o(630116),g=()=>o(704152),h=()=>o(406699),y=()=>o(285790),f=()=>o(839010),v=()=>o(904694),x=()=>o(24611),S=o(474848);function b(e){const{height:t,padding:o,padding_top:b,iframe_url:C,hoverData:A,store:k,token:j,href:M,onDismiss:T}=e,I=(0,s().YK)({editLink:{defaultMessage:"Edit link",id:"hoverPreviewOverlay.editLink"}}),w=(0,i().v3)(),P=(0,s().tz)(),B=(0,n.useRef)(null),R=(0,a().IS)((e=>({content:{width:340,height:"100%",aspectRatio:"auto",position:"relative"},container:{width:340,maxHeight:420,flexDirection:"column",alignItems:"flex-start"},buttonStyle:{display:"flex",alignItems:"center",justifyContent:"center",width:24,height:24,borderRadius:4,fill:e.lightIconColor,background:(0,x().FF)(w)}})),[w]),_=k&&k.recordStoreUIParentStore&&k.recordStoreUIParentStore instanceof m().Bv?k.recordStoreUIParentStore:k instanceof m().Bv?k:void 0;return(0,S.jsxs)("div",{style:R.container,children:[e.showEditButton&&(0,S.jsx)(y().A,{onClick:e.handleEditClick,icon:l().r,isDarkIconColor:!0,ariaLabel:P.formatMessage(I.editLink),hasBackground:!0,style:{position:"absolute",top:8,right:8,zIndex:1}}),j&&_&&A&&(0,S.jsx)("div",{style:{position:"absolute",top:8,right:8,zIndex:2},children:(0,S.jsx)(h().Ay,{popupType:h().z7.Popup,placementToOrigin:d().W.Right,alignmentToOrigin:d().C.Start,originGap:4,onClose:()=>{let e=!1;const t=B.current;t&&(e=(0,p().ux)(t.getBoundingClientRect(),u().$C.x,u().$C.y)),e||null==T||T()},renderOrigin:e=>(0,S.jsx)(g().A,{style:R.buttonStyle,...e,children:(0,r()._)({width:14,fill:c().Ay.white})}),render:e=>(0,S.jsx)(v().A,{parentBlockStore:_,store:k,token:j,href:M,hoverData:A,onAccept:()=>e.close()})})}),(0,S.jsx)(f().A,{source:C,style:R.content,preserveScale:!!(t&&t<1||o),background:!1,height:t&&t>0?t:void 0,aspectRatio:o?o/100:.75,paddingTop:b||void 0})]})}},500071:(e,t,o)=>{o.d(t,{D:()=>Y,y9:()=>z});o(898992),o(672577);var n=o(296540),i=()=>o(484714),a=()=>o(56366),r=()=>o(401497),l=()=>o(329333);const s=2e3;var c=()=>o(977345),u=()=>o(791089),d=()=>o(315564),p=()=>o(919709),m=()=>o(959013),g=()=>o(496603),h=()=>o(534177),y=()=>o(284371),f=()=>o(246826),v=()=>o(725614),x=()=>o(84817),S=()=>o(406699),b=()=>o(628864),C=()=>o(186445),A=()=>o(909470),k=()=>o(731320),j=()=>o(963589),M=()=>o(463830),T=()=>o(53137),I=()=>o(829e3),w=()=>o(546461),P=()=>o(653417),B=()=>o(301782),R=()=>o(366360),_=()=>o(858163),V=()=>o(133518),E=()=>o(656134),F=()=>o(475679),D=()=>o(542339),L=()=>o(548526),O=()=>o(807787),K=()=>o(616175),N=o(474848);const W=(0,m().YK)({notificationMessageLabel:{defaultMessage:"Message",id:"automations.BaseModalAction.notificationMessageLabel"},slackCustomMessageLabel:{defaultMessage:"Custom message",id:"automations.SlackNotificationAction.customMessageLabel"},invalidChannelLabel:{defaultMessage:"Invalid channel",id:"slackNotificationAction.slackTargetChannel.invalidChannel"},hiddenChannelLabel:{defaultMessage:"Hidden channel",id:"slackNotificationAction.slackTargetChannel.hiddenName"},noTargetChannelLabel:{id:"slackNotificationAction.targetPicker.noTarget",defaultMessage:"Select Slack channel"}});function z(e){const{actionStore:t}=e,o=te(t),{automationStore:r}=(0,w().EC)(),{disabled:d,maybePersistedTransactionActions:g,suppressActionErrors:y}=(0,R().b)(),S=(0,l().getActionRegistryItem)("slack_notification"),b=Boolean(d),C=X(r)?(0,N.jsx)(P().TooltipWithSubtitle,{content:(0,N.jsx)(m().sA,{...P().automationErrorMessages.slackNotificationAuthenticationError})}):null,k=(0,a().uB)(void 0,M().A),T=(0,n.useCallback)((()=>k.reset()),[k]),I=(0,n.useMemo)((()=>(0,N.jsx)(F().z,{actionStore:t,closeMenu:T})),[t,T]),E=(0,n.useMemo)((()=>!y.includes(t.id)),[y,t]),{errorMessage:D}=(0,P().useErrorComponentForAction)({actionId:t.id,errorKey:"external_bot_id",shouldShow:E}),{errorMessage:L}=(0,P().useErrorComponentForAction)({actionId:t.id,errorKey:"target",shouldShow:E}),z=(0,a().K8)((()=>t.getSpaceId()),[t]),U=(0,a().K8)((()=>{var e;return null===(e=t.getConfig())||void 0===e?void 0:e.custom_message}),[t]),Y=(0,V().F)({actionId:t.id}),G=(0,a().K8)((()=>{if(z)return(0,u().analyzeSimpleFormulaOrFormulaSync)({context:{handleDataRequest:(0,c().zg)(t.getRecordModel),spaceId:z,valueTypes:Y.slice(0),featureGates:(0,A().i)()},value:U})}),[t.getRecordModel,U,Y,z]),q=(0,j().X)("automation_slack_fast_processor"),{onTextStoreSelect:$,onTextStoreUnselect:Z}=(0,_().W)(t),Q=(0,i().v3)(),J=(0,n.useCallback)((()=>{v().clear({environment:Q})}),[Q]),ee=(0,n.useCallback)((e=>{const o=null==e?void 0:e.value;(!(0,h().O9)(o)||(0,p().AhH)(o)<=s)&&(g.createAndCommit({perform:o=>{f().zv({data:{custom_message:e},store:t.getConfigStore(),transaction:o})},userAction:"SlackNotificationAction.setCustomMessage"}),(0,B().UB)(Q,{automationStore:r,automationActionStore:t}))}),[t,r,Q,g]);return z&&G?(0,N.jsxs)(O().OT,{actionMenu:I,buttonPopupStore:k,disabled:b,actionId:t.id,canCollapse:!1,children:[(0,N.jsx)(O().h3,{actionId:t.id,actionRegistryItem:S,disabled:b,styles:{headerWrap:{paddingRight:32},titleWrap:{display:"flex",flexWrap:"wrap",gap:4}},children:(0,N.jsx)(H,{actionStore:t,automationStore:r,disabled:b,errorMessage:C??D??L})}),q&&(0,h().O9)(o)&&(0,N.jsx)(O().qt,{children:(0,N.jsx)(x().Y1,{direction:"vertical",gap:16,children:(0,N.jsx)(K().M,{analyzedFormulaOutput:G,labelMessageDescriptor:W.slackCustomMessageLabel,disabled:b,disableMobileActionBar:!0,disableStyleAnnotations:!0,disableFormulas:!0,disableMentions:!0,isOptional:!0,formulaTypecheckContextValues:Y,parentRecordStore:t,rows:3,spaceId:z,value:U,onChange:ee,onTextStoreSelect:$,onTextStoreUnselect:Z,onTextEsc:J})})})]}):null}function H(e){const{actionStore:t,automationStore:o,disabled:n,errorMessage:i}=e;return(0,N.jsx)(m().sA,{defaultMessage:"Notify{slackTargetPicker}",id:"automations.slackNotificationAction.action.title",values:{slackTargetPicker:(0,N.jsx)(U,{actionStore:t,automationStore:o,disabled:n,errorMessage:i})}})}function U(e){const{actionStore:t,automationStore:o,disabled:i,errorMessage:r}=e,l=(0,a().K8)((()=>{const e=t.getConfigStore(),o=e.getKeyStore("external_bot_id").getValue();if((0,g().Im)(o))return!1;const n=e.getKeyStore("target").getValue();return!(0,g().Im)(null==n?void 0:n.id)}),[t]),s=(0,a().uB)(void 0,M().A),c=(0,n.useCallback)((()=>s.reset()),[s]),u=function(e){const{actionStore:t,automationStore:o}=e,[n,i]=(0,a().K8)((()=>{const e=t.getConfigStore();return[e.getKeyStore("target").getValue(),e.getKeyStore("external_bot_id").getValue()]}),[t]),r=X(o),{currentExternalAuthentication:l}=J(t),s=(0,a().K8)((()=>T().A.completeSlackAuthentications.state.length??0),[]);if((0,h().O9)(n)&&(0,h().O9)(i))return r?{actionStore:t,externalBotId:i,notificationActionConfigStore:t,type:"connectToSlackReconnect"}:(0,h().O9)(l)?{actionStore:t,currentExternalAuthentication:l,currentNotificationChannel:n,type:"selectChannelUpdate"}:{actionStore:t,type:"connectToSlackDefault"};return 0===s?{actionStore:t,type:"connectToSlackDefault"}:s>1?{actionStore:t,type:"selectWorkspace"}:{actionStore:t,type:"selectChannelNew"}}({actionStore:t,automationStore:o}),d=(0,E().j)();return(0,N.jsx)(S().Ay,{alignmentToOrigin:S().yP.End,buttonPopupStore:s,disabled:i,originGap:0,placementToOrigin:S().sx.Bottom,popupType:d,renderOrigin:e=>(0,N.jsx)(L().x,{...e,disabled:i,isCompact:!0,isError:Boolean(r),hasActionRequired:!l,dropdownButtonType:"dropdown",children:l?(0,N.jsx)(Y,{actionStore:t}):(0,N.jsx)(m().sA,{...W.noTargetChannelLabel})}),render:()=>(0,N.jsx)(D().A,{initialState:u,onClose:c})})}function Y(e){const{actionStore:t}=e,o=(0,i().v3)(),n=(0,a().K8)((()=>{const e=(0,C().ZO)();return!(0,h().O9)(e)||Boolean((0,k().qb)(o,e))}),[o]),r=te(t),{authenticationState:l}=J(t);return"invalid_channel"===l?(0,N.jsx)(Q,{}):n||!(0,h().O9)(r)?(0,N.jsx)(Z,{}):"me"===r.type?(0,N.jsx)($,{channelName:r.name}):"private"===r.type?(0,N.jsx)(q,{channelName:r.name}):"public"===r.type?(0,N.jsx)(G,{channelName:r.name}):void(0,h().HB)(r.type)}function G(e){return(0,N.jsx)("span",{style:y().RC,children:`#${e.channelName}`})}function q(e){const{channelName:t}=e,o=ee();return(0,N.jsxs)("div",{style:o.container,children:[(0,d().S)(o.lockIcon),(0,N.jsx)("span",{style:y().RC,children:t})]})}function $(e){const{channelName:t}=e;return(0,N.jsx)("span",{style:y().RC,children:`@${t}`})}function Z(){const e=ee();return(0,N.jsxs)("div",{style:e.container,children:[(0,d().S)(e.lockIcon),(0,N.jsx)("span",{style:y().RC,children:(0,N.jsx)(m().sA,{...W.hiddenChannelLabel})})]})}function Q(){const e=ee();return(0,N.jsx)("div",{style:e.container,children:(0,N.jsx)("span",{style:y().RC,children:(0,N.jsx)(m().sA,{...W.invalidChannelLabel})})})}function J(e){return(0,a().K8)((()=>{const t=e.getConfigStore().getKeyStore("external_bot_id").getValue();if(!t)return{authenticationState:"invalid_channel",currentExternalAuthentication:void 0};const o=T().A.completeSlackAuthentications.state.find((e=>t===e.id));return(0,h().O9)(o)?{authenticationState:"selected_channel",currentExternalAuthentication:o}:{authenticationState:"hidden_channel",currentExternalAuthentication:void 0}}),[e])}function X(e){return(0,a().K8)((()=>"disabled_auth"===e.getStatus()),[e])}function ee(){const{isMobile:e}=(0,i().Y0)(),t=e?y().J.UISmall.mobile:y().J.UISmall.desktop;return(0,r().IS)((()=>({container:{alignItems:"baseline",display:"inline-flex",gap:2,minWidth:50,width:"100%"},lockIcon:{alignSelf:"center",height:"auto",width:t}})),[t])}function te(e){const t=(0,i().v3)(),o=(0,a().K8)((()=>{var t;return null===(t=e.getConfig())||void 0===t||null===(t=t.target)||void 0===t?void 0:t.id}),[e]),{currentExternalAuthentication:r}=J(e);return n.useEffect((()=>{r&&(0,b().Hn)({environment:t,spaceId:r.space_id,externalAuthConfig:{type:"external",botId:r.id}})}),[t,r]),(0,a().K8)((()=>{if(r&&o){const e=I().c.getStateForBot({type:"external",botId:r.id}).channels[o];if(e)return e}}),[o,r])}},514608:(e,t,o)=>{o.d(t,{J:()=>a});o(296540);var n=o(474848);const i={viewBox:"0 0 16 16",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M9.219 8.002a1.22 1.22 0 1 1-2.439 0 1.22 1.22 0 0 1 2.439 0"}),(0,n.jsx)("path",{d:"M.914 7.44a1.21 1.21 0 0 0 0 1.128c1.282 2.442 3.987 4.1 7.086 4.1s5.804-1.658 7.086-4.1a1.21 1.21 0 0 0 0-1.128C13.804 4.997 11.099 3.34 8 3.34S2.196 4.997.914 7.44M8 10.628a2.626 2.626 0 1 1 .001-5.251A2.626 2.626 0 0 1 8 10.627"})]})},a=(0,o(340498).wt)("eyeFillSmall",i)},519143:(e,t,o)=>{o.d(t,{D:()=>i});o(296540);const n={viewBox:"0 0 20 20",svg:(0,o(474848).jsx)("path",{d:"m3.625 11.151 1.187-1.187a.625.625 0 1 1 .884.884l-2.254 2.254a.625.625 0 0 1-.884 0L.304 10.848a.625.625 0 0 1 .884-.884l1.187 1.187V10a7.625 7.625 0 0 1 12.814-5.587.625.625 0 1 1-.851.915A6.375 6.375 0 0 0 3.625 10zm14-2.302 1.187 1.187a.625.625 0 1 0 .884-.884l-2.254-2.254a.625.625 0 0 0-.884 0l-2.254 2.254a.625.625 0 1 0 .884.884l1.187-1.187V10a6.375 6.375 0 0 1-10.713 4.672.625.625 0 0 0-.85.915A7.625 7.625 0 0 0 17.625 10z"})},i=(0,o(340498).wt)("arrowCircleLoop",n)},542339:(e,t,o)=>{o.d(t,{S:()=>Ye,A:()=>Ge});var n=o(296540),i=()=>o(56366),a=()=>o(534177),r=()=>o(404412),l=(o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(354520),o(581454),o(908872),o.n(o(844751))),s=()=>o(484714),c=()=>o(401497),u=()=>o(890409),d=()=>o(556927),p=()=>o(742117),m=()=>o(199378),g=()=>o(411387),h=()=>o(959013),y=()=>o(496603),f=()=>o(813297),v=()=>o(760217),x=()=>o(928600),S=()=>o(939740),b=()=>o(460292),C=()=>o(147294),A=()=>o(89924),k=()=>o(859428),j=()=>o(989423),M=()=>o(594794),T=()=>o(972435),I=()=>o(645873);function w(){const e=(0,s().v3)();return(0,n.useMemo)((()=>(0,j().ik)(e)),[e])}var P=()=>o(11978),B=()=>o(962730),R=()=>o(351360),_=()=>o(991249),V=()=>o(597898),E=()=>o(324587),F=()=>o(546461),D=()=>o(5269),L=()=>o(366360),O=()=>o(781697),K=()=>o(383574),N=(o(430670),()=>o(422540)),W=()=>o(419357),z=()=>o(682146),H=()=>o(508496),U=o(474848);function Y(){return(0,c().IS)((e=>({chevronIcon:{marginInlineStart:6,width:12,height:"auto"}})),[])}function G(e){const{automationStore:t,collectionStore:o,searchInput:n}=e,i=new Set(t.getActionStores().flatMap((e=>e.isType("update_pages")?e.getConfigStore().getKeyStore("properties").getValue()??[]:[]))),r=o.getFormat(),s=o.getSchema(),c=(0,N().m7)({collectionFormat:r,collectionSchema:s,filter:e=>{let[t]=e;return!i.has(t)},spaceId:o.getSpaceId(),restrictCrossSpace:H().default.checkGate({gateName:"collections_xws"})}),u=new Map,d=c.map((e=>{const t=s[e];if(t){const o=`${t.name} ${z().dC[t.type]}`;return u.set(e,o),o}})).filter(a().O9),p=new Set(l().filter(n,d).map((e=>{let{original:t}=e;return t})));return c.filter((e=>{const t=u.get(e);return t&&p.has(t)}))}function q(e){const{onChange:t,value:o,placeholder:n,isInput:i}=e;return{items:[{action:()=>{},key:"search-input",render:e=>(0,U.jsx)($,{...e,onChange:t,value:o,placeholder:n})}],key:"search",render:e=>(0,U.jsx)(A().A,{...e,isInput:i})}}const $=(0,n.forwardRef)((function(e,t){const{onChange:o,value:n,placeholder:i,...a}=e,r=(0,h().tz)(),{isMobile:l}=(0,s().Y0)();return(0,U.jsx)(W().Ay,{...a,focus:!l,inputOuterStyle:{margin:0},onChange:o,placeholder:r.formatMessage(i),ref:t,value:n})}));var Z=()=>o(253809);const Q=(0,h().YK)({searchInputPlaceholder:{id:"UpdateThisPagePropertiesActionMenu.searchInputPlaceholder ",defaultMessage:"Search for a property…"},editProperty:{id:"automationEventActionMenu.pagePropertiesEditedSection.title",defaultMessage:"Edit property"},backButtonAriaLabel:{id:"UpdateThisPagePropertiesActionMenu.backButtonAriaLabel",defaultMessage:"Back to previous step"}});function J(e){const{automationActionMenuStore:t,onClose:o}=e,{automationStore:a,contextType:r}=(0,F().EC)(),l=(0,D().y)(a,r),[s,c]=(0,n.useState)(""),u=(0,i().K8)((()=>l&&a?G({automationStore:a,collectionStore:l,searchInput:s}):[]),[a,l,s]),d=(0,i().K8)((()=>null==l?void 0:l.getSchema()),[l]),p=(0,n.useMemo)((()=>{const e=[];e.push(q({onChange:e=>c(e.target.value),value:s,placeholder:Q.searchInputPlaceholder}));const o=d&&X({automationActionMenuStore:t,propertyIds:u,normalizedBlockSchema:d,includeTitle:!1});return o&&e.push(o),e}),[t,u,d,s]),m=(0,Z().r)({automationTriggerActionMenuStore:t,customMenuProps:{leftOuterStyle:{flexGrow:0},rightOuterStyle:{flexGrow:0},titleOuterStyle:{minWidth:0}},onClose:o,title:(0,U.jsx)("div",{style:{display:"inline-flex",minWidth:0,whiteSpace:"pre"},children:(0,U.jsx)(h().sA,{...Q.editProperty})})});return(0,U.jsx)(x().A,{...m,children:(0,U.jsx)(S().Ay,{initialFocus:0,sections:p,type:S().Oh.Vertical})})}function X(e){const{automationActionMenuStore:t,hasTopBorder:o,normalizedBlockSchema:n,propertyIds:i,includeTitle:r}=e,l=i.map((e=>{const o=n[e];if(o)return function(e){const{automationActionMenuStore:t,propertyId:o,propertySchema:n}=e;return{action:()=>{t.pushSettingsItem({actionId:void 0,propertyId:o,type:"eventActionProperty"})},key:`update_this_page_property_${o}_action`,render:e=>(0,U.jsx)(ee,{...e,propertySchema:n})}}({automationActionMenuStore:t,propertyId:e,propertySchema:o})})).filter(a().O9);if(0!==l.length)return{key:"automation_update_this_page_section",items:l,render:e=>(0,U.jsx)(A().A,{...e,title:r?(0,U.jsx)(h().sA,{...Q.editProperty}):void 0,topBorder:o})}}const ee=(0,n.forwardRef)((function(e,t){const{propertySchema:o,...n}=e,i=Y();return(0,U.jsx)(v().A,{...n,icon:(0,U.jsx)(te,{propertySchema:o}),ref:t,right:(0,p().V)(i.chevronIcon),title:o.name})}));function te(e){const{propertySchema:t}=e,n=(0,c().DP)(),i=(0,c().IS)((e=>({icon:{fill:e.icon.secondary,width:o(340498).Ev.sm},iconWrap:{alignItems:"center",borderRadius:4,display:"flex",height:20,justifyContent:"center",width:20}})),[]);return(0,U.jsx)("div",{style:i.iconWrap,children:(0,U.jsx)(o(743176).Ay,{icon:t.icon,size:16,style:i.icon,theme:n,type:t.type})})}const oe=(0,h().YK)({searchInputPlaceholder:{id:"automationEventActionMenu.searchInputPlaceholder.label",defaultMessage:"Search actions…"},updateThisPagePropertiesMenuItemCaption:{defaultMessage:"Edit property…",id:"automationEventActionMenu.updateThisPagePropertiesMenuItem.caption"},upgrade:{defaultMessage:"Upgrade to Plus",id:"automationEventActionMenu.upsellFeatures.title"},disabledActionTooltipHeader:{defaultMessage:"Disabled in your workspace",id:"automationEventActionMenu.disabledActionTooltipHeader"},disabledActionTooltipBody:{defaultMessage:"Contact a workspace admin to modify this setting.",id:"automationEventActionMenu.disabledActionTooltipBody"}}),ne=["automation_actions","update_this_page_actions"],ie=["update_this_page_actions","automation_actions"];function ae(e){const{automationActionMenuStore:t,hasSearch:o,hasUpdateThisPagePropertyActions:r,onClose:p}=e,{isMobile:C}=(0,s().Y0)(),k=(0,s().v3)(),B=(0,h().tz)(),N=w(),{value:W}=(0,I().fJ)(f().QV.automationActionRegistry),{automationStore:z,contextType:H}=(0,F().EC)(),{maybePersistedTransactionActions:Y,onActionAdded:$}=(0,L().b)(),Z=(0,D().y)(z,H),Q=(0,K().V)(),J="event"===H,ee=(0,n.useMemo)((()=>J?ie:ne),[J]),te=(0,i().K8)((()=>t.getInsertionPoint()),[t]),[ae,le]=n.useState(""),se=(0,i().K8)((()=>o?function(e){const{automationActionRegistryModule:t,availableActions:o,searchInput:n}=e;if(!t||0===o.length)return[];const i=new Map,a=o.map((e=>{const t=T().A.formatMessage(e.display.name);return i.set(e.type,t),t})),r=new Set(l().filter(n,a).map((e=>{let{original:t}=e;return t})));return o.filter((e=>{const t=i.get(e.type);return t&&r.has(t)}))}({automationActionRegistryModule:W,availableActions:Q,searchInput:ae}):Q),[Q,o,ae,W]),ce=(0,i().K8)((()=>z.getActionStores().map((e=>e.getType())).filter(a().O9)),[z]),ue=(0,n.useCallback)((e=>{if(!z)return;const t=z.getSpaceId(),{performResult:o}=Y.createAndCommit({userAction:"AutomationActionList.addAction",perform:o=>E().addAutomationAction({actionId:(0,M().Z1)({environment:k,table:m().SC,spaceId:t}),actionType:e,automationStore:z,environment:k,insertionPoint:te,intl:B,transaction:o,builderType:"modal"})});o&&((0,u().c_)(N,{automation_id:z.id,automation_action_id:o.id,automation_action_type:e,builder_type:"modal"}),null==$||$(o)),p()}),[z,Y,p,k,te,B,N,$]),pe=(0,i().K8)((()=>r&&Z&&z?G({automationStore:z,collectionStore:Z,searchInput:ae}):[]),[z,Z,r,ae]),me=(0,i().K8)((()=>Boolean(r&&Z&&z&&G({automationStore:z,collectionStore:Z,searchInput:""}).length>0)),[z,Z,r]),ge=(0,i().K8)((()=>null==Z?void 0:Z.getSchema()),[Z]),he=(0,P().O)(),ye=(0,i().K8)((()=>{var e;return null===(e=R().default.state.currentUserStore)||void 0===e?void 0:e.getModel()}),[]),fe=(0,V()._X)({name:"premium_automations",spaceId:he,userId:null==ye?void 0:ye.id}),ve=function(e){let{onClose:t,upsell:o}=e;const i=(0,s().v3)();return(0,n.useCallback)((()=>{t(),o&&_().K(i,{from:"database_automation_modal_action_item",upsell:o})}),[i,t,o])}({onClose:p,upsell:null==fe?void 0:fe.upsell}),xe=(0,g().e2)(fe),Se=(0,c().IS)((e=>({unavailableHeader:{display:"inline-flex",minWidth:0,whiteSpace:"pre",cursor:"pointer",color:e.text.secondary},unavailableLinkIcon:{fill:e.icon.secondary}})),[]),be=(0,i().K8)((()=>{const e=[],n="button_block"===H||"button_property"===H,i=!n&&!xe,r=n&&!xe;o&&!i&&e.push(q({onChange:e=>le(e.target.value),value:ae,placeholder:oe.searchInputPlaceholder,isInput:!0}));const l=ee.reduce(((e,o)=>{if("automation_actions"===o)if(i||r){const[o,n]=y().jB(se,(e=>i?"slack_notification"===e.type:r?"send_gmail_notification"!==e.type&&"http_request"!==e.type:void 0)),l=re({key:"automation_actions_available_section",actionRegistryItems:o,hasTopBorder:e.length>0,onMenuItemClick:ue,automationActionMenuStore:t,shouldShowUpdateThisPageProperties:"button_property"===H}),s=re({key:"automation_actions_unavailable_section",actionRegistryItems:n,hasTopBorder:(0,a().O9)(l),hideChevron:!0,onMenuItemClick:ve,onClick:ve,automationActionMenuStore:t,shouldShowUpdateThisPageProperties:"event"===H,title:(0,U.jsxs)("div",{style:Se.unavailableHeader,onClick:ve,children:[(0,U.jsx)(h().sA,{...oe.upgrade}),(0,U.jsx)(b().Q,{iconGroup:d().j,variantName:"small",style:Se.unavailableLinkIcon})]})});l&&e.push(l),s&&e.push(s)}else{const o=re({actionRegistryItems:se,hasTopBorder:e.length>0,onMenuItemClick:ue,automationActionMenuStore:t,shouldShowUpdateThisPageProperties:me&&"button_block"!==H&&(!ae||de(ae))});o&&e.push(o)}else if("update_this_page_actions"===o){const o=ge&&(xe||!J)&&ae.length>0&&X({automationActionMenuStore:t,hasTopBorder:e.length>0,normalizedBlockSchema:ge,propertyIds:pe,includeTitle:!0});o&&e.push(o)}else(0,a().HB)(o);return e}),[]);return 0===l.length?e.push({key:"no_results_section",items:[{key:"no_results_item",action:()=>{},render:e=>(0,U.jsx)(v().A,{...e,disabled:!0,disabledFeedback:!0,title:(0,U.jsx)(h().sA,{defaultMessage:"No results",id:"automations.automationEventActionMenu.noResultsItem"})})}],render:e=>(0,U.jsx)(A().A,{...e})}):e.push(...l),e}),[t,xe,pe,se,ge,H,o,me,J,ue,ve,ae,ee,Se.unavailableHeader,Se.unavailableLinkIcon]);(0,n.useEffect)((()=>{(0,j().u4)({environment:k,event:{eventName:"automation_action_menu_opened",eventProperties:{automation_id:z.id,automation_context_type:H,existing_action_types:ce,available_action_types:Q.map((e=>e.type))}}})}),[Q,H,ce,z,k]);let Ce=(0,O().e)({width:266});return C||(Ce={...Ce,maxHeight:"50vh"}),(0,U.jsx)(x().A,{...Ce,children:(0,U.jsx)(S().Ay,{initialFocus:0,sections:be,type:S().Oh.Vertical})})}function re(e){const{actionRegistryItems:t,hasTopBorder:o,onMenuItemClick:n,onClick:i,automationActionMenuStore:r,shouldShowUpdateThisPageProperties:l,key:s,title:c,hideChevron:u}=e,d=y().oE([l?ce({hideChevron:u,onClick:()=>{(0,a().O9)(i)?i():r.pushSettingsItem({type:"updateThisPageProperties"})}}):void 0,...t.map((e=>function(e){const{actionRegistryItem:t,onClick:o}=e;return{action:()=>o(t.type),key:`${t.type}_action`,render:e=>(0,U.jsx)(le,{...e,actionRegistryItem:t})}}({actionRegistryItem:e,onClick:n})))]);if(0!==d.length)return{key:s||"automation_actions_section",items:d,render:e=>(0,U.jsx)(A().A,{...e,topBorder:o,title:c})}}const le=(0,n.forwardRef)((function(e,t){const{actionRegistryItem:r,...l}=e,s=r.display,{automationStore:u,contextType:d}=(0,F().EC)(),p=(0,i().K8)((()=>(0,o(157857).Z6)(u,d)),[u,d]),m=(0,P().O)(),g=(0,i().K8)((()=>{var e;return null===(e=R().default.state.currentUserStore)||void 0===e?void 0:e.getModel()}),[]),y=(0,V().P9)({name:"premium_automations",spaceId:m,userId:null==g?void 0:g.id}),f=(0,n.useMemo)((()=>{if(y)return!1;return"button_block"===d||"button_property"===d?"send_gmail_notification"===r.type||"http_request"===r.type:"slack_notification"!==r.type}),[r.type,d,y]),x=(0,i().K8)((()=>!!((0,a().O9)(r)&&(0,a().O9)(p)&&(0,a().O9)(r.isDisabledForContext))&&r.isDisabledForContext(p)),[r,p]),S=(0,c().IS)((e=>({row:{display:"grid",gridTemplateColumns:"auto auto auto",justifyContent:"flex-start",...(f||x)&&{color:e.text.tertiary,cursor:"default"}},badge:{...(f||x)&&{color:e.text.tertiary,backgroundColor:e.accentColors.translucentGray[75]}},tooltipHeader:{width:200},tooltipBody:{color:e.text.secondary}})),[x,f]),b=(0,n.useMemo)((()=>{switch(r.type){case"send_gmail_notification":return(0,U.jsx)(o(515918).A,{style:S.badge});case"http_request":return(0,U.jsx)(C().E,{newBadgeKey:"http_request_automation_action",didUserEngage:!1,style:S.badge});case"define_variables":return(0,U.jsx)(C().E,{newBadgeKey:"define_variables_automation_action",didUserEngage:!1,style:S.badge});default:return}}),[r.type,S.badge]);return s?(0,U.jsx)(k().A,{textWrap:!0,placement:B().W.Right,alignment:B().C.End,disableTooltip:!x,renderTooltip:()=>(0,U.jsxs)("div",{style:S.tooltipHeader,children:[(0,U.jsx)("div",{children:(0,U.jsx)(h().sA,{...oe.disabledActionTooltipHeader})}),(0,U.jsx)("div",{style:S.tooltipBody,children:(0,U.jsx)(h().sA,{...oe.disabledActionTooltipBody})})]}),render:e=>(0,U.jsx)(v().A,{...l,...e,disabled:x,icon:(0,U.jsx)(se,{type:"actionRegistry",actionRegistryItem:r,disabled:x||f}),ref:t,right:b,title:(0,U.jsx)(h().sA,{...s.name}),style:S.row})}):null}));function se(e){const t="actionRegistry"===e.type&&"send_gmail_notification"===e.actionRegistryItem.type,o=(0,c().IS)((o=>({icon:{fill:e.disabled?o.text.tertiary:o.icon.secondary,height:"auto",width:16,opacity:t&&e.disabled?.4:1},iconWrap:{alignItems:"center",borderRadius:4,display:"flex",height:20,justifyContent:"center",width:20}})),[t,e.disabled]);return(0,U.jsx)("div",{style:o.iconWrap,children:"actionRegistry"===e.type?e.actionRegistryItem.display.icon(o.icon):"icon"===e.type?e.icon(o.icon):(0,a().HB)(e)})}function ce(e){const{onClick:t,hideChevron:o}=e;return{action:()=>t(),key:"update_this_page_properties",render:e=>(0,U.jsx)(ue,{...e,hideChevron:o})}}const ue=(0,n.forwardRef)((function(e,t){const{hideChevron:n}=e,a=Y(),{contextType:r}=(0,F().EC)(),l=(0,P().O)(),s=(0,i().K8)((()=>{var e;return null===(e=R().default.state.currentUserStore)||void 0===e?void 0:e.getModel()}),[]),u=(0,V().P9)({name:"premium_automations",spaceId:l,userId:null==s?void 0:s.id}),d=(0,c().IS)((e=>({row:{...!u&&"event"===r&&{color:e.text.tertiary}}})),[r,u]);return(0,U.jsx)(v().A,{...e,icon:(0,U.jsx)(se,{type:"icon",icon:o(645395).j}),ref:t,right:!n&&(0,p().V)(a.chevronIcon),title:(0,U.jsx)(h().sA,{...oe.updateThisPagePropertiesMenuItemCaption}),style:d.row})}));function de(e){const t=T().A.formatMessage(oe.updateThisPagePropertiesMenuItemCaption);return l().test(e,t)}o(672577);var pe=()=>o(352271),me=()=>o(79118),ge=()=>o(410486),he=()=>o(970013),ye=()=>o(791089),fe=()=>o(919709),ve=()=>o(284371),xe=()=>o(246826),Se=()=>o(413194),be=()=>o(133518);const Ce=(0,h().YK)({menuHeaderTitle:{defaultMessage:"Set {propertyName} to",id:"automations.eventActionProperty.menuHeaderTitle"},menuHeaderEditTitle:{defaultMessage:"Edit {propertyName}",id:"automations.eventActionProperty.menuHeaderEditTitle"}});function Ae(e){var t;const{actionId:o,automationActionMenuStore:r,onClose:l,propertyId:c}=e,{automationStore:d,contextType:p}=(0,F().EC)(),g=(0,D().y)(d,p),{maybePersistedTransactionActions:y,onActionAdded:f}=(0,L().b)(),v=(0,h().tz)(),x=(0,s().v3)(),S=w(),b=(0,i().K8)((()=>r.getInsertionPoint()),[r]),C=(0,n.useMemo)((()=>g?{collectionStore:g,property:c,type:"collection"}:void 0),[g,c]),A=(0,i().K8)((()=>d.getSpaceId()),[d]),j=o??(0,M().Z1)({environment:x,table:m().SC,spaceId:A}),T=(0,i().K8)((()=>{const e=((null==d?void 0:d.getActionStores())??[]).find((e=>e.id===j));if(e&&e.isType("update_pages"))return e}),[d,j]),I=(0,i().K8)((()=>null==g?void 0:g.getSchema()[c]),[g,c]),P=(0,n.useMemo)((()=>{if(I&&(0,N().I3)(I))return N().Yy[I.type]}),[I]),R=(0,n.useMemo)((()=>!!I&&("multi_select"===I.type||(0,he().sO)(I)&&1!==I.limit)),[I]),_=Boolean(I&&"button"!==I.type&&"rollup"!==I.type&&"formula"!==I.type&&"text"===(0,ge().IS)(I.type)),V=Boolean(I&&"button"!==I.type&&"rollup"!==I.type&&"formula"!==I.type&&"number"===(0,ge().IS)(I.type)),O=Boolean(I&&"date"===I.type),K=Boolean(I&&"status"===I.type),W=(0,i().K8)((()=>{if(g&&I)return(0,ye().setPropertyValueToSimpleFormulaReturnType)(g.getSpaceShardedPointer(),c,I)}),[g,I,c]),z=(0,i().K8)((()=>{if(T)return T.getConfigStore().getKeyStore("values").getKeyStore(c).getValue()}),[T,c]),[H,Y]=(0,n.useState)(z),G=(0,n.useRef)({action:(null==z?void 0:z.action)||pe().yP,value:null==z?void 0:z.value}),q=(0,n.useMemo)((()=>{var e;return(0,ye().fromSimpleFormulaArrayValue)(null==H||null===(e=H.value)||void 0===e?void 0:e.value)}),[null==H||null===(t=H.value)||void 0===t?void 0:t.value]),$=(0,be().F)({actionId:null==T?void 0:T.id}),Q=(0,n.useCallback)((e=>{let{action:t,value:o}=e;if(!d)return;const{performResult:n}=y.createAndCommit({perform:e=>{if(!T)return E().addAutomationAction({actionId:j,actionType:"update_pages",automationStore:d,config:{properties:[c],target:{id:(0,me().KI)(),type:"variable"},values:{[c]:{action:t,value:o}}},environment:x,intl:v,insertionPoint:b,transaction:e,builderType:"modal"});xe().zv({data:{[c]:{action:t,value:o}},store:T.getConfigStore().getKeyStore("values"),transaction:e})},userAction:"UpdateThisPagePropertyActionMenu.saveChanges"});n&&((0,u().c_)(S,{automation_id:d.id,automation_action_id:n.id,automation_action_type:"update_pages"}),null==f||f(n))}),[T,d,x,S,j,b,v,y,f,c]),J=(0,n.useCallback)((()=>{Q(G.current),l()}),[Q,l]),X=(0,n.useCallback)(((e,t)=>{const o=t||pe().yP,n=G.current.value;G.current={value:e,action:o};if("formula"===(null==e?void 0:e.type))return void Y({action:o,value:e});if("formula"===(null==n?void 0:n.type))Y({action:o,value:e});else if(_||V||R||(0,a().O9)(t))Y({action:o,value:e});else if(O){const t=(0,ye().fromSimpleFormulaArrayValue)(null==e?void 0:e.value)[0];if((0,a().O9)(t)&&(0,ye().isAnnotationSimpleValueToken)(t)&&(0,fe().qsB)(t))return void Y({action:o,value:e});J()}}),[O,_,V,R,J]),ee="person"===(null==I?void 0:I.type)||"relation"===(null==I?void 0:I.type)||"multi_select"===(null==I?void 0:I.type),te=ee?Ce.menuHeaderEditTitle:Ce.menuHeaderTitle,oe=(0,Z().r)({automationTriggerActionMenuStore:r,customMenuProps:{leftOuterStyle:{flexGrow:0},rightOuterStyle:{flexGrow:0},titleOuterStyle:{minWidth:0}},onClose:J,onDone:R||_||V||ee?J:void 0,title:(0,U.jsx)("div",{style:{display:"inline-flex",minWidth:0,whiteSpace:"pre"},children:v.formatMessage(te,{propertyName:(0,U.jsx)(k().A,{placement:B().W.Bottom,render:e=>(0,U.jsx)("div",{...e,style:{...ve().RC},children:(null==I?void 0:I.name)??""}),renderTooltip:()=>(null==I?void 0:I.name)??""})})})});return I&&W&&C?(0,U.jsx)(Se().L,{allowedFormulaReturnTypes:P,formulaValueContext:C,currentSimpleFormulaValueTokens:q,formulaTypecheckContextValues:$,menuProps:oe,onChange:X,onClose:J,parentRecordStore:d,showClearButton:!K,type:W,value:null==H?void 0:H.value,action:(0,pe().tz)(H),showReplaceAddRemoveToggle:ee}):null}var ke=()=>o(148307),je=()=>o(617871),Me=()=>o(402904),Te=()=>o(973647),Ie=()=>o(510683),we=()=>o(493823),Pe=()=>o(204063),Be=()=>o(881707),Re=()=>o(53137),_e=()=>o(630116);function Ve(e){const{type:t,automationActionMenuStore:o,onClose:n}=e,a=Oe(),r=(0,i().K8)((()=>{var e;return null===(e=R().default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),l=(0,i().K8)((()=>R().default.state.currentUserStore),[]),s="connectToSlackReconnect"===t?e.externalBotId:void 0,c=(0,i().K8)((()=>{if(void 0!==s&&l)return(0,_e().Oo)(l,{table:Me().As,id:s,spaceId:r}).getValue()}),[s,l,r]);let u,d=Le({viewType:"connectToSlackDefault"});if("connectToSlackReconnect"===t){if(!c)return null;const{accountName:e,organizationName:t}=(0,Be().qO)(c);u=(0,Be().Dy)(c),d=Le({viewType:"connectToSlackReconnect",accountName:e,organizationName:t})}return(0,U.jsx)(Z().A,{type:"custom",automationTriggerActionMenuStore:o,onClose:n,children:(0,U.jsx)(A().A,{children:(0,U.jsxs)("div",{style:a.container,children:[(0,U.jsx)(Fe,{}),(0,U.jsxs)("div",{style:a.connectToSlackBody,children:[(0,U.jsx)("div",{style:a.connectToSlackTitleText,children:De(t)}),(0,U.jsx)("div",{style:a.connectToSlackDescriptionText,children:d})]}),(0,U.jsx)(Ee,{...e,slackWorkspaceId:u})]})})})}function Ee(e){const{automationActionMenuStore:t,slackWorkspaceId:o}=e,n=(0,s().v3)(),r=Oe(),l=(0,i().K8)((()=>{var e;return null===(e=R().default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),c=(0,i().K8)((()=>Re().A.integrations.state.find((e=>e.id===je().zG))),[]);return c&&l?(0,U.jsxs)("div",{style:r.buttonGroup,children:[(0,U.jsx)(Pe().A,{style:r.connectToSlackButton,size:"lg",onClick:async()=>{const i=await Ie().Jq({environment:n,integration:c,spaceId:l,from:"collection_view_settings",options:{slackWorkspaceId:o}});Te().Q.isFail(i)?t.replaceSettingsItem({actionStore:e.actionStore,type:"selectWorkspace"}):"connectToSlackReconnect"===e.type||("connectToSlackDefault"===e.type?i.value.externalAuthentication?t.replaceSettingsItem({type:"selectChannelNew",currentExternalAuthentication:i.value.externalAuthentication,actionStore:e.actionStore}):t.replaceSettingsItem({actionStore:e.actionStore,type:"selectWorkspace"}):(0,a().HB)(e))},children:(0,U.jsx)(h().sA,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.connectButton.label",defaultMessage:"Connect"})}),(0,U.jsx)(we().p,{style:r.cancelButton,size:"lg",onClick:()=>{t.popSettingsItem()},children:(0,U.jsx)(h().sA,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.cancelButton.label",defaultMessage:"Cancel"})})]}):null}function Fe(){const e=Oe();return(0,U.jsx)("div",{children:(0,U.jsx)("img",{src:ke().A.images.externalIntegrations.slackIconPng,style:e.slackIcon})})}function De(e){return"connectToSlackDefault"===e?(0,U.jsx)(h().sA,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.title",defaultMessage:"Connect to Slack"}):"connectToSlackReconnect"===e?(0,U.jsx)(h().sA,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.reconnect.title",defaultMessage:"Reconnect to Slack"}):void(0,a().HB)(e)}function Le(e){const{viewType:t}=e;return"connectToSlackDefault"===t?(0,U.jsx)(h().sA,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.description",defaultMessage:"Get notified in channels, see rich previews, and more."}):"connectToSlackReconnect"===t?(0,U.jsx)(h().sA,{id:"AutomationSlackConnectToSlackView.reconnect.description",defaultMessage:'Reconnect your Slack account ({accountName}) on {hasOrganizationName, select, true {"{organizationName}"} other {your Slack workspace}} to resume your notifications.',values:{accountName:e.accountName,hasOrganizationName:(0,a().O9)(e.organizationName),organizationName:e.organizationName}}):void(0,a().HB)(t)}function Oe(){return(0,c().IS)((e=>({container:{display:"flex",flexDirection:"column",margin:"10px 15px",justifyContent:"center",textAlign:"center"},connectToSlackBody:{margin:"0px 25px"},connectToSlackTitleText:{marginBottom:2,fontWeight:ve().Wy.semibold},connectToSlackDescriptionText:{fontSize:13,color:e.mediumTextColor},slackIcon:{width:23,height:"auto"},buttonGroup:{margin:"10px 10px 0px 10px"},connectToSlackButton:{width:"100%"},cancelButton:{color:e.mediumTextColor,width:"100%",justifyContent:"center",fontWeight:ve().Wy.medium,fontSize:13,marginTop:8}})),[])}var Ke=()=>o(628864);function Ne(e){const{actionStore:t,automationActionMenuStore:o,onClose:i}=e,{maybePersistedTransactionActions:r}=(0,L().b)(),l=n.useCallback(((e,o)=>{t&&r.createAndCommit({perform:n=>{xe().zv({data:{config:{external_bot_id:o,target:{id:e.id,name:"",type:e.type}}},store:t,transaction:n})},userAction:"SlackSelectChannelMenu.handleChannelSelect"}),i()}),[t,r,i]),s=(0,n.useCallback)((()=>{const e=o.getState().stack;e.length<2||("selectWorkspace"===e[e.length-2].type?o.popSettingsItem():o.replaceSettingsItem({actionStore:t,type:"selectWorkspace"}))}),[t,o]),c="selectChannelNew"===e.type?void 0:"selectChannelUpdate"===e.type?e.currentNotificationChannel:(0,a().HB)(e),u=(0,n.useMemo)((()=>c?[c]:void 0),[c]);return(0,U.jsx)(Ke().pj,{currentExternalAuthentication:e.currentExternalAuthentication,currentNotificationChannels:u,onClose:i,onNotificationChannelSelect:l,onNewSlackAccountAdded:s,renderMenu:e=>(0,U.jsx)(Z().A,{type:"default",automationTriggerActionMenuStore:o,headerTitle:(0,U.jsx)(h().sA,{id:"notificationRuleSettings.selectChannelView.title",defaultMessage:"Select Slack channel"}),sections:e,onClose:i})})}var We=()=>o(381138);const ze=(0,h().YK)({workspaceSearchPlaceholder:{id:"notificationRuleSettings.selectWorkspaceView.searchInput.placeholder",defaultMessage:"Search…"}});function He(e){const{onWorkspaceSelect:t,renderMenu:o,workspaceFilter:a,onNewSlackAccountAdded:r}=e,l=(0,s().v3)(),{isMobile:u}=(0,s().Y0)(),d=(0,i().K8)((()=>{var e;return null===(e=R().default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),m=(0,i().K8)((()=>(0,Be().l$)(Re().A.completeSlackAuthentications.state,a)),[a]),g=(0,i().K8)((()=>Re().A.integrations.state.find((e=>e.id===je().zG))),[]),[y,f]=n.useState(""),x=(0,c().IS)((e=>({chevronRight:{width:12,height:"auto",color:e.lightIconColor}})),[]);if(!g)return null;const S=Object.entries((0,Be().Os)(m,y)).map(((e,o)=>{let[n,i]=e;return{key:n,items:i.map((e=>{let{workspaceName:o,externalAuthentication:n}=e;return{key:n.id,action:()=>{t(n)},render:e=>(0,U.jsx)(v().A,{...e,title:o??(0,U.jsx)(h().sA,{id:"notificationRuleSettings.selectWorkspace.untitledWorkspace",defaultMessage:"Slack workspace"}),right:(0,p().V)(x.chevronRight)})}})),render:e=>(0,U.jsx)(A().A,{...e,title:n,topBorder:0!==o})}}));return S.unshift({key:"search-input-section",items:[{key:"search-input-item",action:()=>{},render:e=>(0,U.jsx)("div",{children:(0,U.jsx)(W().Ay,{...e,inputLeft:(0,U.jsx)(W().Zf,{icon:We().q}),showClearButton:!0,placeholder:T().A.formatMessage(ze.workspaceSearchPlaceholder),focus:!u||void 0,value:y,onChange:e=>{f(e.target.value)}})})}],render:e=>(0,U.jsx)(A().A,{...e})}),S.push({key:"add-another-slack-account-section",items:[{key:"add-another-slack-account-item",action:async()=>{if(!d)return;const e=await Ie().Jq({environment:l,integration:g,spaceId:d,from:"collection_view_settings"});Te().Q.isFail(e)||e.value.externalAuthentication&&(t(e.value.externalAuthentication),null==r||r())},render:e=>(0,U.jsx)(v().A,{...e,icon:(0,U.jsx)("img",{src:ke().A.images.externalIntegrations.slackIconPng,style:{width:18,height:"auto"}}),title:(0,U.jsx)(h().sA,{id:"notificationRuleSettings.selectWorkspaceView.setupAnotherSlackAccount.label",defaultMessage:"Add another Slack account"})})}],render:e=>(0,U.jsx)(A().A,{...e,topBorder:!0})}),(0,U.jsx)(U.Fragment,{children:o(S)})}function Ue(e){const{automationActionMenuStore:t,onClose:o}=e,i=n.useCallback((o=>{t.pushSettingsItem({actionStore:e.actionStore,type:"selectChannelNew",currentExternalAuthentication:o})}),[t,e.actionStore]);return(0,U.jsx)(He,{onWorkspaceSelect:i,renderMenu:e=>(0,U.jsx)(Z().A,{type:"default",automationTriggerActionMenuStore:t,headerTitle:(0,U.jsx)(h().sA,{id:"notificationRuleSettings.selectSlackWorkspace.title",defaultMessage:"Select Slack workspace"}),sections:e,onClose:o})})}const Ye=(0,n.createContext)({menuStore:void 0});function Ge(e){const{initialState:t,insertionPoint:o,onClose:l}=e,s=(0,i().K8)((()=>{const e=new(r().ew);return e.setState({insertionPoint:o,stack:[t]}),e}),[t,o]),c=(0,i().K8)((()=>s.getCurrentTab()),[s]),u=(0,n.useCallback)((()=>null==l?void 0:l()),[l]);if(!c)return null;let d;if("connectToSlackDefault"===c.type)d=(0,U.jsx)(Ve,{actionStore:c.actionStore,automationActionMenuStore:s,onClose:u,type:"connectToSlackDefault"});else if("connectToSlackReconnect"===c.type)d=(0,U.jsx)(Ve,{actionStore:c.actionStore,automationActionMenuStore:s,externalBotId:c.externalBotId,notificationActionConfigStore:c.notificationActionConfigStore,onClose:u,type:"connectToSlackReconnect"});else if("selectWorkspace"===c.type)d=(0,U.jsx)(Ye.Provider,{value:{menuStore:s},children:(0,U.jsx)(Ue,{actionStore:c.actionStore,automationActionMenuStore:s,onClose:u})});else if("selectChannelNew"===c.type)d=(0,U.jsx)(Ne,{actionStore:c.actionStore,automationActionMenuStore:s,currentExternalAuthentication:c.currentExternalAuthentication,onClose:u,type:"selectChannelNew"});else if("selectChannelUpdate"===c.type)d=(0,U.jsx)(Ne,{actionStore:c.actionStore,automationActionMenuStore:s,currentExternalAuthentication:c.currentExternalAuthentication,currentNotificationChannel:c.currentNotificationChannel,onClose:u,type:"selectChannelUpdate"});else if("eventActions"===c.type)d=(0,U.jsx)(ae,{automationActionMenuStore:s,hasUpdateThisPagePropertyActions:c.hasUpdateThisPagePropertyActions,hasSearch:c.hasSearch,onClose:u});else if("eventActionProperty"===c.type){const{propertyId:e,actionId:t}=c;d=(0,U.jsx)(Ae,{actionId:t,automationActionMenuStore:s,onClose:u,propertyId:e})}else"updateThisPageProperties"===c.type?d=(0,U.jsx)(J,{automationActionMenuStore:s,onClose:u}):(0,a().HB)(c);return(0,U.jsx)(Ye.Provider,{value:{menuStore:s},children:d})}Ye.displayName="AutomationActionMenuContext"},546806:(e,t,o)=>{o.d(t,{e:()=>i});o(296540);var n=o(474848);const i=(0,o(340498).wt)("chevronDownThin",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M8 11.4795C7.77214 11.4795 7.56478 11.3883 7.37793 11.2061L2.17578 5.88086C2.09831 5.80794 2.03906 5.72591 1.99805 5.63477C1.96159 5.53906 1.94336 5.43652 1.94336 5.32715C1.94336 5.17676 1.97754 5.04004 2.0459 4.91699C2.11882 4.79395 2.21452 4.69824 2.33301 4.62988C2.4515 4.55697 2.58594 4.52051 2.73633 4.52051C2.95508 4.52051 3.14648 4.60254 3.31055 4.7666L8.33496 9.91406H7.67188L12.6895 4.7666C12.8535 4.60254 13.0449 4.52051 13.2637 4.52051C13.4141 4.52051 13.5485 4.55697 13.667 4.62988C13.7855 4.69824 13.8789 4.79395 13.9473 4.91699C14.0202 5.04004 14.0566 5.17676 14.0566 5.32715C14.0566 5.54134 13.9792 5.72591 13.8242 5.88086L8.62207 11.2061C8.53548 11.2972 8.43978 11.3656 8.33496 11.4111C8.23014 11.4567 8.11849 11.4795 8 11.4795Z"})})},556927:(e,t,o)=>{o.d(t,{j:()=>n});const n=(0,o(340498).xh)("arrowUpRight",{default:{loader:()=>o.e(43274).then(o.bind(o,443274))},small:{loader:()=>o.e(30720).then(o.bind(o,230720))},mini:{loader:()=>o.e(37972).then(o.bind(o,537972))},large:{loader:()=>o.e(49172).then(o.bind(o,749172))}})},559419:(e,t,o)=>{o.d(t,{c:()=>i});var n=o(296540);function i(){const[e,t]=(0,n.useState)(void 0),o=(0,n.useCallback)((e=>t(e.id)),[]),i=(0,n.useCallback)((()=>t(void 0)),[]);return(0,n.useMemo)((()=>({currentDraggingActionId:e,onActionDragStart:o,onActionDragEnd:i})),[e,i,o])}},585293:(e,t,o)=>{o.d(t,{a:()=>a});var n=o(296540),i=o(474848);const a=n.forwardRef(((e,t)=>{const n=(0,o(401497).IS)((t=>({buttonStyle:{paddingLeft:8,paddingRight:8,paddingTop:2,paddingBottom:2,width:"100%",marginLeft:0,background:"transparent",...e.buttonStyle},menuItemStyle:{gap:6,background:"transparent"},innerContainer:{marginLeft:0,paddingLeft:0,minWidth:"auto",color:e.disabled?t.text.secondary:void 0,background:"transparent"},desktopIconStyle:{margin:0},rightStyle:{display:"flex",alignItems:"center",gap:6,color:t.text.secondary,margin:0,...e.rightStyle}})),[e.disabled,e.rightStyle,e.buttonStyle]);return(0,i.jsx)(o(760217).A,{role:"button",...e,ref:t,style:n.menuItemStyle,buttonStyle:n.buttonStyle,textWrapperStyle:n.innerContainer,desktopIconStyle:n.desktopIconStyle,rightStyle:n.rightStyle})}));a.displayName="SiteSettingButtonMenuItem"},589982:(e,t,o)=>{o.d(t,{u:()=>i});o(296540);var n=o(474848);const i=(0,o(340498).wt)("basicClock",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M4.541 7.919a.53.53 0 01-.39-.157.53.53 0 01-.157-.39c0-.155.053-.282.157-.383a.53.53 0 01.39-.157h2.905V2.895c0-.15.053-.278.158-.383a.521.521 0 01.382-.158.53.53 0 01.39.158.521.521 0 01.157.383v4.477a.53.53 0 01-.157.39.53.53 0 01-.39.157H4.541zm3.452 6.207a6.789 6.789 0 01-2.727-.554 7.124 7.124 0 01-2.256-1.524 7.277 7.277 0 01-1.525-2.256 6.788 6.788 0 01-.553-2.728c0-.966.184-1.875.553-2.727A7.241 7.241 0 015.258.557 6.788 6.788 0 017.987.003c.971 0 1.882.184 2.735.554.852.369 1.604.88 2.256 1.53a7.136 7.136 0 011.53 2.25c.37.852.555 1.761.555 2.727 0 .967-.185 1.876-.554 2.728a7.218 7.218 0 01-3.787 3.78 6.789 6.789 0 01-2.728.554zm0-1.395c.789 0 1.525-.145 2.208-.437a5.678 5.678 0 001.805-1.217 5.68 5.68 0 001.217-1.805c.291-.683.437-1.42.437-2.208a5.55 5.55 0 00-.437-2.2 5.66 5.66 0 00-3.029-3.029 5.567 5.567 0 00-2.208-.438c-.784 0-1.52.146-2.208.438A5.6 5.6 0 003.98 3.052a5.715 5.715 0 00-1.21 1.811 5.55 5.55 0 00-.437 2.201c0 .789.146 1.525.438 2.208a5.735 5.735 0 001.21 1.805 5.598 5.598 0 004.013 1.654z"})})},614415:(e,t,o)=>{o.d(t,{Wx:()=>r,fM:()=>n,l9:()=>i,sM:()=>a});const n=new(o(645873).O2)("framer-motion",(async()=>await Promise.all([o.e(44711),o.e(53321),o.e(37043)]).then(o.bind(o,399791))));function i(e){return e.useAnimate()}function a(e){return e.useAnimation()}function r(e){for(var t=arguments.length,o=new Array(t>1?t-1:0),n=1;n<t;n++)o[n-1]=arguments[n];return e.useInView(...o)}},616175:(e,t,o)=>{o.d(t,{M:()=>h,z:()=>y});o(296540);var n=()=>o(484714),i=()=>o(56366),a=()=>o(401497),r=()=>o(693954),l=()=>o(959013),s=()=>o(284371),c=()=>o(84817),u=()=>o(554509),d=()=>o(521732),p=()=>o(963589),m=()=>o(938818),g=o(474848);function h(e){const{analyzedFormulaOutput:t,labelMessageDescriptor:o,isOptional:h,errorMessageDescriptor:f}=e,v=(0,l().tz)(),x=(0,p().X)("automation_updated_error_states"),S=(0,i().K8)((()=>(0,m().L)(v,null==t?void 0:t.parseErrors,null==t?void 0:t.typeErrors)),[t,v]),{isMobile:b}=(0,n().Y0)(),C=(0,a().IS)((e=>({inputLabel:{display:"flex",alignItems:"center",color:e.text.secondary,fontSize:b?s().J.UIRegular.mobile:s().J.UIRegular.desktop,lineHeight:b?s().K_.UIRegular.mobile:s().K_.UIRegular.desktop,fontWeight:s().Wy.regular},messageInput:{width:"100%"},warningIcon:{color:e.errorText,fill:e.errorText,height:12,flex:"0 0 auto",width:12,display:"flex",marginRight:4},inputLabelInner:{flex:"1 1 auto",...x&&(f||S)&&{color:e.text.uiRedPrimary,fontWeight:s().Wy.medium}},warningError:{color:e.text.uiRedPrimary}})),[f,S,x,b]);return(0,g.jsxs)(c().Y1,{direction:"vertical",gap:6,children:[(0,g.jsxs)("label",{style:C.inputLabel,children:[S&&(0,r().Q)(C.warningIcon),(0,g.jsxs)("div",{style:C.inputLabelInner,children:[(0,g.jsx)(l().sA,{...o}),h&&(0,g.jsx)(y,{})]})]}),(0,g.jsxs)(c().Y1,{direction:"vertical",gap:6,children:[(0,g.jsx)(d().Y,{...e,style:C.messageInput,shouldShowErrorStyles:!!S||e.shouldShowErrorStyles}),S&&(0,g.jsx)(m().J,{analyzedFormulaOutput:t}),!S&&f&&x&&(0,g.jsx)(u().D,{colorName:"secondary",styleName:"UISmall-12px/Regular",style:C.warningError,children:(0,g.jsx)(l().sA,{...f})})]})]})}function y(){const e=(0,a().IS)((e=>({optionalLabel:{color:e.text.tertiary,marginLeft:4}})),[]);return(0,g.jsx)("span",{style:e.optionalLabel,children:(0,g.jsx)(l().sA,{defaultMessage:"{openParenthesis}Optional{closeParenthesis}",id:"automations.SimpleFormulaTextInputWithError.optionalLabel",values:{openParenthesis:"(",closeParenthesis:")"}})})}},617668:(e,t,o)=>{o.r(t),o.d(t,{iconDefinition:()=>n,plusIcon:()=>i});o(296540);const n={viewBox:"0 0 20 20",svg:(0,o(474848).jsx)("path",{d:"M10.625 3.75a.625.625 0 1 0-1.25 0v5.625H3.75a.625.625 0 1 0 0 1.25h5.625v5.625a.625.625 0 1 0 1.25 0v-5.625h5.625a.625.625 0 1 0 0-1.25h-5.625z"})},i=(0,o(340498).wt)("plus",n)},636740:(e,t,o)=>{function n(e){const{dateRangeStart:t,dateRangeEnd:o,collectionContextStore:n}=e;n.dateRangeStartStore.setState(t),n.dateRangeEndStore.setState(o)}o.d(t,{r:()=>n})},642054:(e,t,o)=>{o.d(t,{A:()=>i});o(296540);var n=o(474848);const i=(0,o(340498).wt)("addPage",{viewBox:"0 0 14 14",svg:(0,n.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7 0c3.861 0 7 3.139 7 7s-3.139 7-7 7-7-3.139-7-7 3.139-7 7-7zM3.561 5.295a1.027 1.027 0 1 0 2.054 0 1.027 1.027 0 0 0-2.054 0zm5.557 1.027a1.027 1.027 0 1 1 0-2.054 1.027 1.027 0 0 1 0 2.054zm1.211 2.816a.77.77 0 0 0-.124-1.087.786.786 0 0 0-1.098.107c-.273.407-1.16.958-2.254.958-1.093 0-1.981-.55-2.244-.945a.788.788 0 0 0-1.107-.135.786.786 0 0 0-.126 1.101c.55.734 1.81 1.542 3.477 1.542 1.668 0 2.848-.755 3.476-1.541z"})})},644484:(e,t,o)=>{o.d(t,{g:()=>i});o(296540);var n=o(474848);const i=(0,o(340498).wt)("addPerson",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M9.48242 7.91211C10.8076 7.91211 11.8352 6.77783 11.8352 5.35718C11.8352 4.00391 10.7908 2.84717 9.48242 2.84717C8.17407 2.84717 7.12964 4.00952 7.13525 5.36279C7.14087 6.77783 8.16284 7.91211 9.48242 7.91211ZM9.48242 8.87231C8.7356 8.87231 8.04492 8.99585 7.44409 9.22046C8.23022 9.95044 8.72437 10.9836 8.72437 12.1235C8.72437 12.511 8.66821 12.8872 8.55591 13.2466H12.8684C13.969 13.2466 14.3171 12.8479 14.3171 12.2302C14.3171 10.804 12.3967 8.87231 9.48242 8.87231ZM4.74316 15.1895C6.42212 15.1895 7.80347 13.7969 7.80347 12.1235C7.80347 10.4558 6.42212 9.06885 4.74316 9.06885C3.06982 9.06885 1.68286 10.4558 1.68286 12.1235C1.68286 13.7969 3.06982 15.1895 4.74316 15.1895ZM4.74316 14.1675C4.41187 14.1675 4.18726 13.9429 4.18726 13.6172V12.6907H3.27197C2.94629 12.6907 2.72168 12.4661 2.71606 12.1292C2.71045 11.7979 2.93506 11.5732 3.27197 11.5732H4.18726V10.6636C4.18726 10.3379 4.41187 10.1133 4.74316 10.1077C5.08008 10.1021 5.30469 10.3267 5.30469 10.6636V11.5732H6.22559C6.55127 11.5732 6.77588 11.7979 6.77588 12.1292C6.77588 12.4661 6.55127 12.6907 6.22559 12.6907H5.30469V13.6172C5.30469 13.9429 5.08008 14.1675 4.74316 14.1675Z"})})},654777:(e,t,o)=>{o.d(t,{X:()=>i});o(296540);var n=o(474848);const i=(0,o(340498).wt)("externalLink",{viewBox:"0 0 17 16",svg:(0,n.jsx)("path",{d:"M4.94922 13.498C4.31641 13.498 3.83789 13.3359 3.51367 13.0117C3.18945 12.6914 3.02734 12.2188 3.02734 11.5938V4.46289C3.02734 3.83398 3.18945 3.35938 3.51367 3.03906C3.83789 2.71875 4.31641 2.55859 4.94922 2.55859H12.0449C12.6777 2.55859 13.1562 2.71875 13.4805 3.03906C13.8047 3.35938 13.9668 3.83398 13.9668 4.46289V11.5938C13.9668 12.2188 13.8047 12.6914 13.4805 13.0117C13.1562 13.3359 12.6777 13.498 12.0449 13.498H4.94922ZM5.01953 12.3438H11.9746C12.2441 12.3438 12.4512 12.2734 12.5957 12.1328C12.7402 11.9922 12.8125 11.7793 12.8125 11.4941V4.55664C12.8125 4.27539 12.7402 4.06445 12.5957 3.92383C12.4512 3.7832 12.2441 3.71289 11.9746 3.71289H5.01953C4.74609 3.71289 4.53711 3.7832 4.39258 3.92383C4.25195 4.06445 4.18164 4.27539 4.18164 4.55664V11.4941C4.18164 11.7793 4.25195 11.9922 4.39258 12.1328C4.53711 12.2734 4.74609 12.3438 5.01953 12.3438ZM10.334 9.54297C10.1855 9.54297 10.0664 9.49609 9.97656 9.40234C9.89062 9.30859 9.84766 9.17969 9.84766 9.01562V8.08398L9.93555 7.24609L9.15039 8.10156L7.09961 10.1465C6.99023 10.2559 6.85742 10.3105 6.70117 10.3105C6.55273 10.3105 6.42969 10.2637 6.33203 10.1699C6.23828 10.0762 6.19141 9.95117 6.19141 9.79492C6.19141 9.6582 6.24609 9.53516 6.35547 9.42578L8.41211 7.36914L9.2793 6.57227L8.47656 6.66602H7.48633C7.32617 6.66602 7.19727 6.62305 7.09961 6.53711C7.00586 6.45117 6.95898 6.33203 6.95898 6.17969C6.95898 6.03516 7.00586 5.91992 7.09961 5.83398C7.19727 5.74414 7.32422 5.69922 7.48047 5.69922H10.2227C10.4062 5.69922 10.5508 5.74609 10.6562 5.83984C10.7617 5.93359 10.8145 6.08398 10.8145 6.29102V9.00977C10.8145 9.16602 10.7695 9.29492 10.6797 9.39648C10.5938 9.49414 10.4785 9.54297 10.334 9.54297Z"})})},655923:(e,t,o)=>{o.d(t,{v:()=>i});o(296540);const n={viewBox:"0 0 20 20",svg:(0,o(474848).jsx)("path",{d:"M10.625 3a.625.625 0 1 0-1.25 0v12.491l-4.333-4.333a.625.625 0 1 0-.884.884l5.4 5.4a.62.62 0 0 0 .884 0l5.4-5.4a.625.625 0 0 0-.884-.884l-4.333 4.333z"})},i=(0,o(340498).wt)("arrowStraightDown",n)},656476:(e,t,o)=>{o.d(t,{rD:()=>v,zH:()=>f});var n=o(296540),i=()=>o(401497),a=()=>o(791089),r=()=>o(834368),l=()=>o(486521),s=()=>o(263178),c=()=>o(959013),u=()=>o(284371),d=()=>o(340743),p=()=>o(214973),m=()=>o(741310),g=()=>o(807787),h=()=>o(16707),y=o(474848);function f(e){const{actionMenu:t,buttonPopupStore:o,disabled:f,onClick:x,propertySchema:S,value:b}=e,C=(0,i().IS)((()=>({content:{alignItems:"center",display:"flex"},propertyName:{...u().RC,fontWeight:u().Wy.medium}})),[]),A=function(e){const{propertySchema:t,styles:o,value:n}=e,i=(0,y.jsx)("span",{style:o.propertyName,children:t.name});let s;const u="formula"===(null==n?void 0:n.type);if(u)s=(0,y.jsx)(h().g,{returnType:{type:"checkbox"}});else{const e=(0,a().fromSimpleFormulaArrayValue)(null==n?void 0:n.value)[0],t=!0===e?(0,l().v)({width:12}):(0,r().K)({width:10});s=(0,y.jsx)(d().G,{icon:t,shouldTruncateChildren:!0,children:!0===e?(0,y.jsx)(c().sA,{...p().CV.actionCheckboxPropertyChecked}):(0,y.jsx)(c().sA,{...p().CV.actionCheckboxPropertyUnchecked})})}return(0,y.jsx)(c().sA,{...p().Xr({propertyName:i,propertyValue:s})})}({propertySchema:S,styles:C,value:b}),k=v({propertySchema:S,value:b}),j=(0,n.useCallback)((e=>(0,y.jsx)(g().aX,{...e,actionMenu:t,buttonPopupStore:o,disabled:f,icon:s().S,onClick:x,children:(0,y.jsx)("div",{style:C.content,children:A})})),[t,o,f,x,C.content,A]);return(0,y.jsx)(m().P,{renderOrigin:j,title:k})}function v(e){const{propertySchema:t,value:o}=e;let n;if("formula"===(null==o?void 0:o.type))n=(0,y.jsx)(h().L,{});else{n=!0===(0,a().fromSimpleFormulaArrayValue)(null==o?void 0:o.value)[0]?(0,y.jsx)(c().sA,{...p().CV.actionCheckboxPropertyChecked}):(0,y.jsx)(c().sA,{...p().CV.actionCheckboxPropertyUnchecked})}return(0,y.jsx)(c().sA,{...p().Xr({propertyName:t.name,propertyValue:n})})}},678350:(e,t,o)=>{o.d(t,{U:()=>A});o(296540);var n=()=>o(484714),i=()=>o(56366),a=()=>o(401497),r=()=>o(791089),l=()=>o(284371),s=()=>o(548526),c=()=>o(963589),u=()=>o(463830),d=()=>o(406699),p=()=>o(14235),m=()=>o(999638),g=()=>o(413194),h=(o(581454),()=>o(959013)),y=()=>o(534177),f=()=>o(905209),v=()=>o(419830),x=()=>o(742971),S=o(474848);function b(e){const{context:t,currentSimpleFormulaValueTokens:o,disabled:n,formulaTypecheckContextValues:i,parentRecordStore:r,placeholder:l,spaceId:s,type:c,value:u}=e,d=(0,a().IS)((()=>({tokenWrap:{display:"flex",alignItems:"center",flexGrow:1,overflow:"hidden",marginTop:6}})),[]),p=(0,v().pg)(t);if("formula"===(null==u?void 0:u.type)&&u.value)return(0,S.jsx)(f().$,{formulaTypecheckContextValues:i??[],parentRecordStore:r,spaceId:s,value:u});if("text"===c.type||"number"===c.type)return null;if("date"===c.type||"select"===c.type||"checkbox"===c.type){const e=o[0];return void 0===e?(0,S.jsx)(C,{placeholder:l}):(0,S.jsx)("div",{style:d.tokenWrap,children:(0,S.jsx)(g().g,{token:e,parentRecordStore:r,disabled:n,currentSimpleFormulaValueTokens:o,context:t})})}return"person_array"===c.type||"block_array"===c.type||"select_array"===c.type?0===o.length?(0,S.jsx)(C,{placeholder:l}):(0,S.jsx)("div",{style:d.tokenWrap,children:p(o,"first").map(((e,i)=>(0,S.jsx)(g().g,{token:e,parentRecordStore:r,disabled:n,currentSimpleFormulaValueTokens:o,context:t},i)))}):void(0,y().HB)(c)}function C(e){const{placeholder:t}=e,o=(0,a().IS)((e=>({placeholderText:{color:e.lightTextColor}})),[]);return(0,S.jsx)("div",{style:o.placeholderText,children:t?(0,S.jsx)(h().sA,{defaultMessage:"{placeholder}",values:{placeholder:t},id:"formulas.SimpleFormulaValuePicker.people.customPlaceholder"}):(0,S.jsx)(h().sA,{...x().D.personSelect})})}function A(e){const{allowedReturnTypes:t,disabled:o,disableEmojiCommands:h,disableFormattingAndMentions:y,disableMobileActionBar:f,disableTemplateVariableMentions:v,errorMessage:x,formulaTypecheckContextValues:C,limit:A,menuProps:k,onChange:j,parentRecordStore:M,placeholder:T,showClearButton:I,showInputMenuItem:w,simpleFormulaContext:P,spaceId:B,style:R,type:_,value:V}=e,E=(0,n().Y0)(),F=!V||"simple"===V.type,D=(0,i().K8)((()=>(0,r().fromSimpleFormulaArrayValue)(null==V?void 0:V.value)),[V]),L=(0,c().X)("collections_xws"),O=(0,a().IS)((e=>({button:{boxShadow:e.inputBoxShadow,flexGrow:1,flexShrink:1,fontSize:"inherit",fontWeight:l().Wy.regular,...R}})),[R]),K=(0,i().uB)(void 0,u().A),N=L?"cross_space_and_read_permissions":"read_permissions_only";return(0,S.jsx)(d().Ay,{alignmentToOrigin:d().yP.End,buttonPopupStore:K,disabled:o,originGap:0,placementToOrigin:d().sx.Bottom,popupType:E.isMobile?p().nl.SlideUp:p().nl.Popup,renderOrigin:e=>(0,S.jsx)(s().x,{...e,disabled:o,hasActionRequired:!Boolean(D.length>0),isError:Boolean(x),style:O.button,tooltipMessage:x,dropdownButtonType:"button",children:(0,S.jsx)(b,{currentSimpleFormulaValueTokens:D,context:P,disabled:!0,formulaTypecheckContextValues:C,parentRecordStore:M,placeholder:T,spaceId:B,type:_,value:V})}),render:e=>F?(0,S.jsx)(g().L,{currentSimpleFormulaValueTokens:D,disableEmojiCommands:h,disableFormattingAndMentions:y,disableMobileActionBar:f,disableTemplateVariableMentions:v,formulaTypecheckContextValues:C,formulaValueContext:P,limit:A,menuProps:k,onChange:j,onClose:e.close,parentRecordStore:M,showClearButton:I,showInputMenuItem:w,type:_,value:V}):(0,S.jsx)(m().A,{allowedReturnTypes:t,disabled:o,formulaTypecheckContextValues:C,onChange:j,onClose:e.close,parentRecordStore:M,restrictUnaccessibleProperties:N,spaceId:B,value:V})})}},686169:(e,t,o)=>{o.d(t,{w:()=>ke,J:()=>je});var n=o(296540),i=()=>o(56366),a=()=>o(977345),r=()=>o(546461),l=(o(16280),o(898992),o(354520),()=>o(484714)),s=()=>o(401497),c=()=>o(329333),u=()=>o(310109),d=()=>o(289915),p=()=>o(329199),m=()=>o(784892),g=()=>o(959013),h=()=>o(534177),y=()=>o(284371),f=()=>o(246826),v=()=>o(317909),x=()=>o(895876),S=()=>o(406699),b=()=>o(16006),C=()=>o(684125),A=()=>o(989423),k=()=>o(726483),j=()=>o(963589),M=()=>o(463830),T=()=>o(630116),I=()=>o(653417),w=()=>o(301782),P=()=>o(366360),B=()=>o(133518),R=()=>o(656134),_=()=>o(475679),V=()=>o(95199),E=()=>o(548526),F=()=>o(194373),D=()=>o(807787),L=()=>o(497222),O=()=>o(870988),K=()=>o(44935),N=()=>o(928600),W=()=>o(89924),z=()=>o(175116),H=()=>o(781697),U=o(474848);function Y(e){const{filter:t,onChange:o,onClose:a,collectionStore:r}=e,l=(0,z().Ks)(),s=(0,i().K8)((()=>r.getSchema()),[r]),c=(0,H().e)({minWidth:300,tabletBehavior:"actionSheet"}),u=(0,n.useCallback)(((e,t)=>o(t)),[o]),p=(0,n.useCallback)((()=>{o(void 0),a()}),[o,a]);return(0,U.jsxs)(N().A,{...c,children:[(0,U.jsx)(K().i,{children:(0,U.jsx)(O().tY,{collectionViewId:"Automation.FilterMenu",collectionContextStore:l,collectionViewType:"table",combinatorFilter:t||d().AY,index:0,level:0,onChange:u,parentStore:r,schema:s})}),(0,U.jsx)(W().A,{topBorder:!0,children:(0,U.jsx)(L().A,{title:(0,U.jsx)(g().sA,{defaultMessage:"Delete filter",id:"automations.AutomationCombinatorFilterPopup.deleteFilter.label"}),onClick:p})})]})}const G=(0,g().YK)({multipleTargetsFilter:{defaultMessage:"<span>Edit </span>{filterPicker}",id:"automations.UpdatePagesAction.multipleTargetsFilter"},multipleTargetsPicker:{defaultMessage:"<span>in </span>{targetPicker}",id:"automations.UpdatePagesAction.multipleTargetsPicker"},singleTarget:{defaultMessage:"<span>Edit </span>{targetPicker}",id:"automations.UpdatePagesAction.singleTarget"}});function q(e){const{actionStore:t}=e,o=(0,l().v3)(),{automationStore:a,typecheckResult:s}=(0,r().EC)(),{disabled:d,suppressActionErrors:m}=(0,P().b)(),y=(0,j().X)("automation_updated_error_states"),x=(0,i().K8)((()=>t.getTargetStore()),[t]),S=(0,i().K8)((()=>X(t,(0,u().getAllContextValues)(s))),[t,s]),b=(0,i().K8)((()=>{var e;const o=t.getCollectionTargetStore(),n=null==o||null===(e=o.getKeyStore("filter"))||void 0===e?void 0:e.getValue();if(n)return(0,p().SK)(n,(null==S?void 0:S.getSchema())||{})}),[t,S]),C=(0,i().K8)((()=>{const e=t.getVariableTargetStore();if(e)return e.getValue();const o=t.getCollectionTargetStore();if(o){const e=o.getKeyStore("collection").getValue();if(e)return{collection:e,type:"collection"}}}),[t]),A=(0,i().K8)((()=>{if(!C||"variable"!==C.type)return!1;const e=(0,u().getContextValueForActionById)(s,t.id,C.id),o=null==e?void 0:e.type;return!!o&&("block"===o.type||"array"===o.type&&"block"===o.of.type)}),[t.id,C,s]),T=(0,i().uB)(void 0,M().A),B=(0,n.useCallback)((()=>T.reset()),[T]),R=(0,n.useMemo)((()=>(0,U.jsx)(_().z,{actionStore:t,closeMenu:B})),[t,B]),E=(0,n.useMemo)((()=>!m.includes(t.id)),[m,t]),F=(0,i().K8)((()=>{if(S&&y)return E&&!(0,k().bI)({actionStore:t,collectionStore:S,typecheckResult:s})?(0,U.jsx)(g().sA,{...I().automationErrorMessages.actionIncompleteErrorMessage}):void 0}),[t,S,y,E,s]),{errorMessage:L,errorIcon:O}=(0,I().useErrorComponentForAction)({actionId:t.id,shouldShow:E,errorKeys:["target","collection","block"]}),{errorMessage:K,errorIcon:N}=(0,I().useErrorComponentForAction)({actionId:t.id,errorKey:"filter",shouldShow:E}),W=(0,i().K8)((()=>(0,h().O9)(t.getConfigStore().getKeyStore("target").getValue())),[t]),z=(0,n.useCallback)((e=>{v().createAndCommit({userAction:"UpdatePagesAction.filterChange",environment:o,canUndo:!0,perform:t=>{f().zv({data:{filter:e},store:x,transaction:t})}}),(0,w().UB)(o,{automationStore:a,automationActionStore:t})}),[t,a,o,x]),H=(0,n.useCallback)((e=>{let n;if("collection"===e.type)n="UpdatePageAction.updateCollection";else if("variable"===e.type)n="UpdatePageAction.updateVariable";else{if("page"===e.type||"property"===e.type||"formula"===e.type||"url"===e.type)throw new Error("Not implemented yet.");(0,h().HB)(e)}v().createAndCommit({userAction:n,environment:o,canUndo:!0,perform:o=>{f().zv({data:{properties:null,target:e,values:null},store:t.getConfigStore(),transaction:o})}}),(0,w().UB)(o,{automationStore:a,automationActionStore:t})}),[o,a,t]),Y=Boolean(d),G=(0,c().getActionRegistryItem)("update_pages");return(0,U.jsxs)(D().OT,{actionMenu:R,buttonPopupStore:T,disabled:Y,actionId:t.id,canCollapse:W,children:[(0,U.jsx)(D().h3,{actionId:t.id,actionRegistryItem:G,disabled:Y,styles:{headerWrap:{paddingRight:32},titleWrap:{display:"grid",gridTemplateColumns:"auto 1fr"}},errorMessage:y?L||K||F:void 0,children:A||!S?(0,U.jsx)($,{actionStore:t,disabled:Y,errorMessage:L,errorIcon:O,onTargetChange:H,value:C}):(0,U.jsx)(Z,{actionStore:t,collectionStore:S,disabled:Y,errorMessage:L,errorIcon:O,filterErrorIcon:N,filterErrorMessage:K,filter:b,onFilterChange:z,onTargetChange:H,value:C})}),S&&(0,U.jsx)(D().qt,{disabled:Y,styles:{bodyWrap:{display:"grid",gap:8,gridTemplateColumns:"1fr",minWidth:0}},children:(0,U.jsx)(V().Ud,{actionStore:t,collectionStore:S,disabled:Y,showSetPropertyActions:!0})})]})}function $(e){const{actionStore:t,disabled:o,errorMessage:n,onTargetChange:i,value:a,errorIcon:r}=e,l=(0,j().X)("automation_updated_error_states"),c=(0,s().IS)((()=>({b:{fontWeight:y().Wy.medium},picker:{display:"inline-flex",minWidth:50},span:{flex:0,display:"flex",alignItems:"center"},title:{display:"inline-flex",minWidth:50,gap:6}})),[]);return(0,U.jsx)("div",{style:c.title,children:(0,U.jsx)(g().sA,{...G.singleTarget,values:{b:e=>(0,U.jsx)("b",{style:c.b,children:e}),targetPicker:(0,U.jsx)(J,{actionStore:t,disabled:o,errorMessage:n,errorIcon:l?r:void 0,onChange:i,value:a}),span:e=>(0,U.jsx)("span",{style:c.span,children:e})}})})}function Z(e){const{actionStore:t,collectionStore:o,disabled:n,errorMessage:i,errorIcon:a,filterErrorMessage:r,filterErrorIcon:l,filter:c,onFilterChange:u,onTargetChange:d,value:p}=e,m=(0,s().IS)((()=>({b:{fontWeight:y().Wy.medium},picker:{display:"inline-flex",minWidth:50},span:{flex:0,display:"flex",alignItems:"center"},title:{display:"inline-flex",minWidth:50,gap:6}})),[]);return(0,U.jsxs)(U.Fragment,{children:[(0,U.jsxs)("div",{style:m.title,children:[(0,U.jsx)(g().sA,{...G.multipleTargetsFilter,values:{filterPicker:(0,U.jsx)(Q,{collectionStore:o,disabled:n,errorMessage:r,errorIcon:l,filter:c,onChange:u}),span:e=>(0,U.jsx)("span",{style:m.span,children:e})}})," "]}),(0,U.jsx)("div",{style:m.title,children:(0,U.jsx)(g().sA,{...G.multipleTargetsPicker,values:{targetPicker:(0,U.jsx)(J,{actionStore:t,disabled:n,errorMessage:i,errorIcon:a,onChange:d,value:p}),span:e=>(0,U.jsx)("span",{style:m.span,children:e})}})})]})}function Q(e){var t;const{collectionStore:o,disabled:a,errorMessage:r,filter:l,onChange:s,errorIcon:c}=e,u=(0,i().uB)(void 0,M().A),p=(0,R().j)({tabletBehavior:"slideUp"}),m=(0,n.useCallback)((()=>u.reset()),[u]),h=(0,i().K8)((()=>{const e=o.getModel(),t=null==e?void 0:e.getDatabaseType();return(0,x().oj)(t)}),[o]),y=(null==l||null===(t=l.filters)||void 0===t?void 0:t.length)||0;return(0,U.jsx)(S().Ay,{alignmentToOrigin:S().yP.Center,disabled:a,originGap:0,placementToOrigin:S().sx.Bottom,popupType:p,renderOrigin:e=>(0,U.jsx)(E().x,{...e,disabled:a,isCompact:!0,errorIcon:c,onClick:t=>{e.onClick(t),0===y&&s(d().Lx)},dropdownButtonType:"dropdown",isError:Boolean(r),tooltipMessage:r,children:y>0?(0,U.jsx)(g().sA,{defaultMessage:"{itemType} that match {ruleCount, plural, one {{ruleCount} filter} other {{ruleCount} filters}}",id:"automations.UpdatePagesAction.FilterPicker.withRules",values:{itemType:h,ruleCount:y}}):(0,U.jsx)(g().sA,{defaultMessage:"all {itemType}",id:"automations.UpdatePagesAction.FilterPicker.noRules",values:{itemType:h}})}),render:()=>(0,U.jsx)(Y,{collectionStore:o,disabled:a,filter:l,onChange:s,onClose:m})})}function J(e){const{actionStore:t,disabled:o,errorMessage:a,onChange:s,value:c,errorIcon:d}=e,p=(0,l().v3)(),{automationStore:y,typecheckResult:f}=(0,r().EC)(),v=(0,B().F)({actionId:t.id}),x=(0,i().K8)((()=>{if("collection"===(null==c?void 0:c.type))return T().md.createChildStore(t,c.collection)}),[t,c]),k=(0,i().K8)((()=>{if(f&&c&&"variable"===c.type)return(0,u().getContextValueForActionById)(f,t.id,c.id)}),[f,c,t.id]),I=(0,i().uB)(void 0,M().A),P=(0,R().j)(),_=(0,n.useCallback)((()=>I.reset()),[I]),V=(0,n.useCallback)((e=>{s(e),_(),(0,w().CM)(((o,n,i)=>{const a=(0,w().zc)({automationActionStore:t,formulasModule:o,formulaAnalyticsModule:n,simpleFormulasModule:i});(0,h().O9)(a)&&(0,A().u4)({environment:p,event:{eventName:"automation_target_pick",eventProperties:{automation_action:a,automation_id:t.getParentId(),target_type:e.type}}})}))}),[s,_,t,p]),D=(0,j().X)("automation_updated_error_states");return(0,U.jsx)(S().Ay,{buttonPopupStore:I,popupType:P,alignmentToOrigin:S().yP.Center,placementToOrigin:S().sx.Bottom,originGap:0,disabled:o,renderOrigin:e=>(0,U.jsx)(E().x,{...e,disabled:o,isCompact:!0,isError:Boolean(a),tooltipMessage:!D&&a,errorIcon:d,hasActionRequired:!Boolean(c||k),dropdownButtonType:"dropdown",children:(0,h().O9)(x)?(0,U.jsx)(b().A,{store:x,style:{paddingBlock:1}}):k?(0,U.jsx)(C().F,{format:m().NY.Medium,isSingle:!0,value:k,style:{background:"transparent",color:"unset",margin:"-1.5px 0",padding:0}}):(0,U.jsx)(g().sA,{id:"automations.UpdatePagesAction.pagesDropdown.label",defaultMessage:"Select database"})}),render:e=>(0,U.jsx)(F()._,{formulaTypecheckContextValues:v,onChange:V,onClose:_,parentRecordStore:y,selectedTarget:c,skipPages:!0})})}function X(e,t){const o=e.getTargetStore().getValue();if(o){if("collection"===o.type)return T().md.createChildStore(e,o.collection);if("variable"===o.type){if(!t)return;const n=(0,a().IV)(t,o.id);if(n)return(0,k().A8)(n,e)}else{if("page"===o.type)return;(0,h().HB)(o)}}}var ee=()=>o(422540),te=()=>o(352271),oe=()=>o(970013),ne=()=>o(542339),ie=()=>o(656476),ae=()=>o(541172),re=()=>o(217028);function le(e){const{actionMenu:t,buttonPopupStore:o,disabled:n,onClick:i,propertySchema:a}=e,r=(0,s().IS)((e=>({icon:{fill:e.text.uiRedPrimary},propertyType:{color:e.accentColors.red[700]}})),[]),l=function(e){const{propertySchema:t,styles:o}=e,n=t.name;return(0,U.jsx)(g().sA,{defaultMessage:"{propertyName} is a cross-workspace relation",id:"updateThisPageCrossSpaceRelationAction.crossSpaceRelation.title",values:{propertyName:(0,U.jsx)("span",{style:o.propertyType,children:n})}})}({propertySchema:a,styles:r}),c=function(e){const{propertySchema:t}=e,o=t.name;return(0,U.jsx)(g().sA,{defaultMessage:"{propertyName} is a cross-workspace relation. Cross-workspace features are restricted in automations and will not work.",id:"updateThisPageCrossSpaceRelationAction.crossSpaceRelation.text",values:{propertyName:o}})}({propertySchema:a});return(0,U.jsx)(re().z$,{actionMenu:t,buttonPopupStore:o,disabled:n,onClick:i,propertyType:a.type,styles:r,tooltip:c,children:l})}function se(e){const{actionId:t,renderOrigin:o}=e,a=(0,R().j)(),r=(0,i().uB)(void 0,M().A),l=(0,n.useCallback)((()=>r.reset()),[r]);return(0,U.jsx)(S().Ay,{buttonPopupStore:r,popupType:a,render:()=>(0,U.jsx)(ae().qM,{actionId:t,closeMenu:l}),renderOrigin:o})}var ce=()=>o(307159),ue=()=>o(984714),de=()=>o(347114),pe=(o(581454),()=>o(234194)),me=()=>o(397785),ge=()=>o(741310);function he(e){const{action:t,actionMenu:o,buttonPopupStore:i,disabled:a,onClick:l,propertySchema:s,value:c}=e,{automationStore:d,typecheckResult:p}=(0,r().EC)(),m=(0,n.useMemo)((()=>(0,u().getAllContextValues)(p)),[p]),{title:g,tooltipTitle:h,styles:y}=(0,me().oG)({getRecordModel:d.getRecordModel,contextValues:m,messageType:"action",operator:t,propertySchema:s,value:c}),f=(0,n.useCallback)((e=>(0,U.jsx)(D().aX,{...e,actionMenu:o,buttonPopupStore:i,disabled:a,icon:pe().M,onClick:l,children:(0,U.jsx)("div",{style:y.content,children:g})})),[o,i,a,l,y.content,g]);return(0,U.jsx)(ge().P,{renderOrigin:f,title:h})}var ye=()=>o(365683),fe=()=>o(457050);function ve(e){const{action:t,actionMenu:o,automationActionStore:i,buttonPopupStore:a,collectionStore:r,disabled:l,onClick:s,propertySchema:c,value:u}=e,d=(0,B().F)({actionId:i.id}),{tooltipTitle:p,title:m}=(0,fe().xL)({automationContextValues:d,collectionStore:r,messageType:"action",operator:t,propertySchema:c,value:u}),g=(0,n.useCallback)((e=>(0,U.jsx)(D().aX,{...e,actionMenu:o,buttonPopupStore:a,disabled:l,icon:ye().H,onClick:s,children:m})),[o,a,l,s,m]);return(0,U.jsx)(ge().P,{renderOrigin:g,title:p})}var xe=()=>o(3867),Se=()=>o(237985),be=()=>o(359186);function Ce(e){var t;const{actionStore:o}=e,{disabled:a}=(0,P().b)(),[r,l]=(0,i().K8)((()=>[o.id,o.getConfig()]),[o]),s=(0,B().F)({actionId:r}),c=(0,i().K8)((()=>X(o,s)),[o,s]),u=(0,i().K8)((()=>null==c?void 0:c.getSchema()),[c]),d=(0,i().K8)((()=>null==c?void 0:c.getDeletedSchema()),[c]),p=(0,i().uB)(void 0,M().A),m=(0,n.useCallback)((()=>p.reset()),[p]),g=(0,n.useMemo)((()=>(0,U.jsx)(_().z,{actionStore:o,closeMenu:m})),[o,m]),h=(0,j().X)("collections_xws"),y=((null==l?void 0:l.properties)??[])[0],f=null==u?void 0:u[y],v=null==d?void 0:d[y],x=null==l||null===(t=l.values)||void 0===t?void 0:t[y],S=Boolean(a),b={automationActionStore:o,actionMenu:g,buttonPopupStore:p,disabled:S,value:null==x?void 0:x.value};return!f&&v?(0,U.jsx)(ue().sF,{actionId:o.id,propertyId:y,renderOrigin:e=>(0,U.jsx)(ue().vu,{...e,...b,propertySchema:v})}):f||v?f&&c?(0,ee().I3)(f)?"person"===f.type?(0,U.jsx)(Ae,{actionId:o.id,propertyId:y,renderOrigin:e=>(0,U.jsx)(he,{...e,...b,propertySchema:f,action:(0,te().tz)(x)})}):"status"===f.type?(0,U.jsx)(Ae,{actionId:o.id,propertyId:y,renderOrigin:e=>(0,U.jsx)(Se().II,{...e,...b,propertySchema:f})}):"select"===f.type?(0,U.jsx)(Ae,{actionId:o.id,propertyId:y,renderOrigin:e=>(0,U.jsx)(xe().w$,{...e,...b,propertySchema:f})}):"multi_select"===f.type?(0,U.jsx)(Ae,{actionId:o.id,propertyId:y,renderOrigin:e=>(0,U.jsx)(de().j,{...e,...b,propertySchema:f,action:(0,te().tz)(x)})}):"date"===f.type?(0,U.jsx)(Ae,{actionId:o.id,propertyId:y,renderOrigin:e=>(0,U.jsx)(ce().m,{...e,...b,propertySchema:f,valueContext:{collectionStore:c,property:y,type:"collection"}})}):"relation"===f.type&&h&&(0,oe().o2)(c.pointer.spaceId,f)?(0,U.jsx)(se,{actionId:o.id,propertyId:y,renderOrigin:e=>(0,U.jsx)(le,{...e,...b,propertySchema:f})}):"relation"===f.type?(0,U.jsx)(Ae,{actionId:o.id,propertyId:y,renderOrigin:e=>(0,U.jsx)(ve,{...e,...b,collectionStore:c,propertySchema:f,action:(0,te().tz)(x)})}):"checkbox"===f.type?(0,U.jsx)(Ae,{actionId:o.id,propertyId:y,renderOrigin:e=>(0,U.jsx)(ie().zH,{...e,...b,propertySchema:f})}):"title"===f.type?(0,U.jsx)(Ae,{actionId:o.id,propertyId:y,renderOrigin:e=>(0,U.jsx)(be().EJ,{...e,...b,propertySchema:f})}):"text"===f.type?(0,U.jsx)(Ae,{actionId:o.id,propertyId:y,renderOrigin:e=>(0,U.jsx)(be().Zd,{...e,...b,propertySchema:f})}):"email"===f.type?(0,U.jsx)(Ae,{actionId:o.id,propertyId:y,renderOrigin:e=>(0,U.jsx)(be().ef,{...e,...b,propertySchema:f})}):"url"===f.type?(0,U.jsx)(Ae,{actionId:o.id,propertyId:y,renderOrigin:e=>(0,U.jsx)(be().Vj,{...e,...b,propertySchema:f})}):"number"===f.type?(0,U.jsx)(Ae,{actionId:o.id,propertyId:y,renderOrigin:e=>(0,U.jsx)(be().T7,{...e,...b,propertySchema:f})}):"phone_number"===f.type?(0,U.jsx)(Ae,{actionId:o.id,propertyId:y,renderOrigin:e=>(0,U.jsx)(be().Jx,{...e,...b,propertySchema:f})}):null:(0,U.jsx)(re().gI,{actionId:o.id,propertyId:y,renderOrigin:e=>(0,U.jsx)(re().RY,{...e,...b,propertySchema:f})}):null:(0,U.jsx)(ue().sF,{actionId:o.id,renderOrigin:e=>(0,U.jsx)(ue().qR,{...e,...b})})}function Ae(e){const{actionId:t,propertyId:o,renderOrigin:a}=e,r=(0,R().j)(),l=(0,i().uB)(void 0,M().A),s=(0,n.useCallback)((()=>l.reset()),[l]),c=(0,n.useMemo)((()=>({actionId:t,propertyId:o,type:"eventActionProperty"})),[t,o]);return(0,U.jsx)(S().Ay,{buttonPopupStore:l,popupType:r,render:()=>(0,U.jsx)(ne().A,{initialState:c,onClose:s}),renderOrigin:a})}function ke(e){const{actionStore:t}=e,{contextType:o}=(0,r().YC)();return(0,i().K8)((()=>je(o,t)),[t,o])?(0,U.jsx)(Ce,{...e}):(0,U.jsx)(q,{...e})}function je(e,t){var o;if(!t.isType("update_pages"))return!1;const n=t.getConfig(),i="variable"===(null==n||null===(o=n.target)||void 0===o?void 0:o.type)?(0,a().y5)(n.target.id):void 0;return"event"===e&&i&&"global"===i.source&&"button_page"===i.global}},695490:(e,t,o)=>{o.d(t,{L:()=>p,LX:()=>f,Li:()=>g,Sh:()=>y,V6:()=>a,VT:()=>l,Yk:()=>h,_n:()=>c,cm:()=>i,fA:()=>u,fs:()=>S,iD:()=>m,kb:()=>r,l:()=>v,rD:()=>d,w_:()=>b,xX:()=>s,yA:()=>x});var n=()=>o(645873);const i=new(n().O2)("menus",(async()=>{const[{default:e},{TopbarPageAnalyticsOptOutMenu:t},{default:n},{default:i},{default:a},{default:r},{default:l},{default:s},{default:c},{default:u},{default:d},{SidebarTeamModal:p},{SidebarCreateTeamModal:m},{CreateTeamFromPageConfirmModal:g},{CollectionTypedDatabaseMigrationModal:h},{default:y},{default:f},{default:v}]=await Promise.all([Promise.all([o.e(23806),o.e(75134),o.e(43380),o.e(9304),o.e(96346),o.e(36192),o.e(44711),o.e(53321),o.e(16471),o.e(90825),o.e(37353),o.e(49889),o.e(97727),o.e(55373),o.e(29151),o.e(16908),o.e(62475),o.e(3151),o.e(98629),o.e(58550),o.e(22900),o.e(85128),o.e(95555),o.e(90409),o.e(63077),o.e(74562),o.e(95794),o.e(46414),o.e(8184),o.e(99353),o.e(52681),o.e(14518),o.e(17713),o.e(28271),o.e(17254),o.e(4422),o.e(59794),o.e(67435),o.e(75355),o.e(48315),o.e(47123),o.e(847),o.e(5887),o.e(70769),o.e(97965),o.e(17989),o.e(3965),o.e(38911),o.e(9034),o.e(52012),o.e(56985),o.e(50142),o.e(20838),o.e(21627),o.e(88860),o.e(83210),o.e(26090),o.e(82472),o.e(96345),o.e(10596),o.e(73285),o.e(75659),o.e(78846),o.e(47858),o.e(13324),o.e(51860),o.e(15724),o.e(81141),o.e(27274),o.e(99346),o.e(92448),o.e(65638),o.e(72915),o.e(28721),o.e(69689),o.e(23463),o.e(25426),o.e(6463),o.e(91056),o.e(26483),o.e(29333),o.e(5396),o.e(1440),o.e(34576),o.e(95810),o.e(89109),o.e(3560),o.e(77169),o.e(24071),o.e(68610),o.e(67064),o.e(49978),o.e(3720),o.e(47762),o.e(85475),o.e(11740),o.e(97996),o.e(5066),o.e(35299),o.e(68117),o.e(14267),o.e(33731),o.e(30016),o.e(14410),o.e(49471),o.e(31185),o.e(75681)]).then(o.bind(o,977802)),Promise.all([o.e(23806),o.e(75134),o.e(43380),o.e(9304),o.e(96346),o.e(36192),o.e(44711),o.e(53321),o.e(16471),o.e(90825),o.e(37353),o.e(49889),o.e(97727),o.e(55373),o.e(29151),o.e(16908),o.e(62475),o.e(3151),o.e(98629),o.e(58550),o.e(22900),o.e(85128),o.e(95555),o.e(90409),o.e(63077),o.e(74562),o.e(95794),o.e(46414),o.e(8184),o.e(99353),o.e(52681),o.e(14518),o.e(17713),o.e(28271),o.e(17254),o.e(4422),o.e(59794),o.e(67435),o.e(75355),o.e(48315),o.e(47123),o.e(847),o.e(5887),o.e(70769),o.e(97965),o.e(17989),o.e(3965),o.e(38911),o.e(9034),o.e(52012),o.e(56985),o.e(50142),o.e(20838),o.e(21627),o.e(88860),o.e(83210),o.e(26090),o.e(82472),o.e(96345),o.e(10596),o.e(73285),o.e(75659),o.e(78846),o.e(47858),o.e(13324),o.e(51860),o.e(15724),o.e(81141),o.e(27274),o.e(99346),o.e(92448),o.e(65638),o.e(72915),o.e(28721),o.e(69689),o.e(23463),o.e(25426),o.e(6463),o.e(91056),o.e(26483),o.e(29333),o.e(5396),o.e(1440),o.e(34576),o.e(95810),o.e(89109),o.e(3560),o.e(77169),o.e(24071),o.e(68610),o.e(67064),o.e(49978),o.e(3720),o.e(47762),o.e(85475),o.e(11740),o.e(97996),o.e(5066),o.e(35299),o.e(68117),o.e(14267),o.e(33731),o.e(30016),o.e(14410),o.e(49471),o.e(31185),o.e(75681)]).then(o.bind(o,687110)),Promise.all([o.e(23806),o.e(75134),o.e(43380),o.e(9304),o.e(96346),o.e(36192),o.e(44711),o.e(53321),o.e(16471),o.e(90825),o.e(37353),o.e(49889),o.e(97727),o.e(55373),o.e(29151),o.e(16908),o.e(62475),o.e(3151),o.e(98629),o.e(58550),o.e(22900),o.e(85128),o.e(95555),o.e(90409),o.e(63077),o.e(74562),o.e(95794),o.e(46414),o.e(8184),o.e(99353),o.e(52681),o.e(14518),o.e(17713),o.e(28271),o.e(17254),o.e(4422),o.e(59794),o.e(67435),o.e(75355),o.e(48315),o.e(47123),o.e(847),o.e(5887),o.e(70769),o.e(97965),o.e(17989),o.e(3965),o.e(38911),o.e(9034),o.e(52012),o.e(56985),o.e(50142),o.e(20838),o.e(21627),o.e(88860),o.e(83210),o.e(26090),o.e(82472),o.e(96345),o.e(10596),o.e(73285),o.e(75659),o.e(78846),o.e(47858),o.e(13324),o.e(51860),o.e(15724),o.e(81141),o.e(27274),o.e(99346),o.e(92448),o.e(65638),o.e(72915),o.e(28721),o.e(69689),o.e(23463),o.e(25426),o.e(6463),o.e(91056),o.e(26483),o.e(29333),o.e(5396),o.e(1440),o.e(34576),o.e(95810),o.e(89109),o.e(3560),o.e(77169),o.e(24071),o.e(68610),o.e(67064),o.e(49978),o.e(3720),o.e(47762),o.e(85475),o.e(11740),o.e(97996),o.e(5066),o.e(35299),o.e(68117),o.e(14267),o.e(33731),o.e(30016),o.e(14410),o.e(49471),o.e(31185),o.e(75681)]).then(o.bind(o,467935)),Promise.all([o.e(23806),o.e(75134),o.e(43380),o.e(9304),o.e(96346),o.e(36192),o.e(44711),o.e(53321),o.e(16471),o.e(90825),o.e(37353),o.e(49889),o.e(97727),o.e(55373),o.e(29151),o.e(16908),o.e(62475),o.e(3151),o.e(98629),o.e(58550),o.e(22900),o.e(85128),o.e(95555),o.e(90409),o.e(63077),o.e(74562),o.e(95794),o.e(46414),o.e(8184),o.e(99353),o.e(52681),o.e(14518),o.e(17713),o.e(28271),o.e(17254),o.e(4422),o.e(59794),o.e(67435),o.e(75355),o.e(48315),o.e(47123),o.e(847),o.e(5887),o.e(70769),o.e(97965),o.e(17989),o.e(3965),o.e(38911),o.e(9034),o.e(52012),o.e(56985),o.e(50142),o.e(20838),o.e(21627),o.e(88860),o.e(83210),o.e(26090),o.e(82472),o.e(96345),o.e(10596),o.e(73285),o.e(75659),o.e(78846),o.e(47858),o.e(13324),o.e(51860),o.e(15724),o.e(81141),o.e(27274),o.e(99346),o.e(92448),o.e(65638),o.e(72915),o.e(28721),o.e(69689),o.e(23463),o.e(25426),o.e(6463),o.e(91056),o.e(26483),o.e(29333),o.e(5396),o.e(1440),o.e(34576),o.e(95810),o.e(89109),o.e(3560),o.e(77169),o.e(24071),o.e(68610),o.e(67064),o.e(49978),o.e(3720),o.e(47762),o.e(85475),o.e(11740),o.e(97996),o.e(5066),o.e(35299),o.e(68117),o.e(14267),o.e(33731),o.e(30016),o.e(14410),o.e(49471),o.e(31185),o.e(75681)]).then(o.bind(o,742784)),Promise.all([o.e(23806),o.e(75134),o.e(43380),o.e(9304),o.e(96346),o.e(36192),o.e(44711),o.e(53321),o.e(16471),o.e(90825),o.e(37353),o.e(49889),o.e(97727),o.e(55373),o.e(29151),o.e(16908),o.e(62475),o.e(3151),o.e(98629),o.e(58550),o.e(22900),o.e(85128),o.e(95555),o.e(90409),o.e(63077),o.e(74562),o.e(95794),o.e(46414),o.e(8184),o.e(99353),o.e(52681),o.e(14518),o.e(17713),o.e(28271),o.e(17254),o.e(4422),o.e(59794),o.e(67435),o.e(75355),o.e(48315),o.e(47123),o.e(847),o.e(5887),o.e(70769),o.e(97965),o.e(17989),o.e(3965),o.e(38911),o.e(9034),o.e(52012),o.e(56985),o.e(50142),o.e(20838),o.e(21627),o.e(88860),o.e(83210),o.e(26090),o.e(82472),o.e(96345),o.e(10596),o.e(73285),o.e(75659),o.e(78846),o.e(47858),o.e(13324),o.e(51860),o.e(15724),o.e(81141),o.e(27274),o.e(99346),o.e(92448),o.e(65638),o.e(72915),o.e(28721),o.e(69689),o.e(23463),o.e(25426),o.e(6463),o.e(91056),o.e(26483),o.e(29333),o.e(5396),o.e(1440),o.e(34576),o.e(95810),o.e(89109),o.e(3560),o.e(77169),o.e(24071),o.e(68610),o.e(67064),o.e(49978),o.e(3720),o.e(47762),o.e(85475),o.e(11740),o.e(97996),o.e(5066),o.e(35299),o.e(68117),o.e(14267),o.e(33731),o.e(30016),o.e(14410),o.e(49471),o.e(31185),o.e(75681)]).then(o.bind(o,381495)),Promise.all([o.e(23806),o.e(75134),o.e(43380),o.e(9304),o.e(96346),o.e(36192),o.e(44711),o.e(53321),o.e(16471),o.e(90825),o.e(37353),o.e(49889),o.e(97727),o.e(55373),o.e(29151),o.e(16908),o.e(62475),o.e(3151),o.e(98629),o.e(58550),o.e(22900),o.e(85128),o.e(95555),o.e(90409),o.e(63077),o.e(74562),o.e(95794),o.e(46414),o.e(8184),o.e(99353),o.e(52681),o.e(14518),o.e(17713),o.e(28271),o.e(17254),o.e(4422),o.e(59794),o.e(67435),o.e(75355),o.e(48315),o.e(47123),o.e(847),o.e(5887),o.e(70769),o.e(97965),o.e(17989),o.e(3965),o.e(38911),o.e(9034),o.e(52012),o.e(56985),o.e(50142),o.e(20838),o.e(21627),o.e(88860),o.e(83210),o.e(26090),o.e(82472),o.e(96345),o.e(10596),o.e(73285),o.e(75659),o.e(78846),o.e(47858),o.e(13324),o.e(51860),o.e(15724),o.e(81141),o.e(27274),o.e(99346),o.e(92448),o.e(65638),o.e(72915),o.e(28721),o.e(69689),o.e(23463),o.e(25426),o.e(6463),o.e(91056),o.e(26483),o.e(29333),o.e(5396),o.e(1440),o.e(34576),o.e(95810),o.e(89109),o.e(3560),o.e(77169),o.e(24071),o.e(68610),o.e(67064),o.e(49978),o.e(3720),o.e(47762),o.e(85475),o.e(11740),o.e(97996),o.e(5066),o.e(35299),o.e(68117),o.e(14267),o.e(33731),o.e(30016),o.e(14410),o.e(49471),o.e(31185),o.e(75681)]).then(o.bind(o,952305)),Promise.all([o.e(23806),o.e(75134),o.e(43380),o.e(9304),o.e(96346),o.e(36192),o.e(44711),o.e(53321),o.e(16471),o.e(90825),o.e(37353),o.e(49889),o.e(97727),o.e(55373),o.e(29151),o.e(16908),o.e(62475),o.e(3151),o.e(98629),o.e(58550),o.e(22900),o.e(85128),o.e(95555),o.e(90409),o.e(63077),o.e(74562),o.e(95794),o.e(46414),o.e(8184),o.e(99353),o.e(52681),o.e(14518),o.e(17713),o.e(28271),o.e(17254),o.e(4422),o.e(59794),o.e(67435),o.e(75355),o.e(48315),o.e(47123),o.e(847),o.e(5887),o.e(70769),o.e(97965),o.e(17989),o.e(3965),o.e(38911),o.e(9034),o.e(52012),o.e(56985),o.e(50142),o.e(20838),o.e(21627),o.e(88860),o.e(83210),o.e(26090),o.e(82472),o.e(96345),o.e(10596),o.e(73285),o.e(75659),o.e(78846),o.e(47858),o.e(13324),o.e(51860),o.e(15724),o.e(81141),o.e(27274),o.e(99346),o.e(92448),o.e(65638),o.e(72915),o.e(28721),o.e(69689),o.e(23463),o.e(25426),o.e(6463),o.e(91056),o.e(26483),o.e(29333),o.e(5396),o.e(1440),o.e(34576),o.e(95810),o.e(89109),o.e(3560),o.e(77169),o.e(24071),o.e(68610),o.e(67064),o.e(49978),o.e(3720),o.e(47762),o.e(85475),o.e(11740),o.e(97996),o.e(5066),o.e(35299),o.e(68117),o.e(14267),o.e(33731),o.e(30016),o.e(14410),o.e(49471),o.e(31185),o.e(75681)]).then(o.bind(o,70463)),Promise.all([o.e(23806),o.e(75134),o.e(43380),o.e(9304),o.e(96346),o.e(36192),o.e(44711),o.e(53321),o.e(16471),o.e(90825),o.e(37353),o.e(49889),o.e(97727),o.e(55373),o.e(29151),o.e(16908),o.e(62475),o.e(3151),o.e(98629),o.e(58550),o.e(22900),o.e(85128),o.e(95555),o.e(90409),o.e(63077),o.e(74562),o.e(95794),o.e(46414),o.e(8184),o.e(99353),o.e(52681),o.e(14518),o.e(17713),o.e(28271),o.e(17254),o.e(4422),o.e(59794),o.e(67435),o.e(75355),o.e(48315),o.e(47123),o.e(847),o.e(5887),o.e(70769),o.e(97965),o.e(17989),o.e(3965),o.e(38911),o.e(9034),o.e(52012),o.e(56985),o.e(50142),o.e(20838),o.e(21627),o.e(88860),o.e(83210),o.e(26090),o.e(82472),o.e(96345),o.e(10596),o.e(73285),o.e(75659),o.e(78846),o.e(47858),o.e(13324),o.e(51860),o.e(15724),o.e(81141),o.e(27274),o.e(99346),o.e(92448),o.e(65638),o.e(72915),o.e(28721),o.e(69689),o.e(23463),o.e(25426),o.e(6463),o.e(91056),o.e(26483),o.e(29333),o.e(5396),o.e(1440),o.e(34576),o.e(95810),o.e(89109),o.e(3560),o.e(77169),o.e(24071),o.e(68610),o.e(67064),o.e(49978),o.e(3720),o.e(47762),o.e(85475),o.e(11740),o.e(97996),o.e(5066),o.e(35299),o.e(68117),o.e(14267),o.e(33731),o.e(30016),o.e(14410),o.e(49471),o.e(31185),o.e(75681)]).then(o.bind(o,946576)),Promise.all([o.e(23806),o.e(75134),o.e(43380),o.e(9304),o.e(96346),o.e(36192),o.e(44711),o.e(53321),o.e(16471),o.e(90825),o.e(37353),o.e(49889),o.e(97727),o.e(55373),o.e(29151),o.e(16908),o.e(62475),o.e(3151),o.e(98629),o.e(58550),o.e(22900),o.e(85128),o.e(95555),o.e(90409),o.e(63077),o.e(74562),o.e(95794),o.e(46414),o.e(8184),o.e(99353),o.e(52681),o.e(14518),o.e(17713),o.e(28271),o.e(17254),o.e(4422),o.e(59794),o.e(67435),o.e(75355),o.e(48315),o.e(47123),o.e(847),o.e(5887),o.e(70769),o.e(97965),o.e(17989),o.e(3965),o.e(38911),o.e(9034),o.e(52012),o.e(56985),o.e(50142),o.e(20838),o.e(21627),o.e(88860),o.e(83210),o.e(26090),o.e(82472),o.e(96345),o.e(10596),o.e(73285),o.e(75659),o.e(78846),o.e(47858),o.e(13324),o.e(51860),o.e(15724),o.e(81141),o.e(27274),o.e(99346),o.e(92448),o.e(65638),o.e(72915),o.e(28721),o.e(69689),o.e(23463),o.e(25426),o.e(6463),o.e(91056),o.e(26483),o.e(29333),o.e(5396),o.e(1440),o.e(34576),o.e(95810),o.e(89109),o.e(3560),o.e(77169),o.e(24071),o.e(68610),o.e(67064),o.e(49978),o.e(3720),o.e(47762),o.e(85475),o.e(11740),o.e(97996),o.e(5066),o.e(35299),o.e(68117),o.e(14267),o.e(33731),o.e(30016),o.e(14410),o.e(49471),o.e(31185),o.e(75681)]).then(o.bind(o,996594)),Promise.all([o.e(23806),o.e(75134),o.e(43380),o.e(9304),o.e(96346),o.e(36192),o.e(44711),o.e(53321),o.e(16471),o.e(90825),o.e(37353),o.e(49889),o.e(97727),o.e(55373),o.e(29151),o.e(16908),o.e(62475),o.e(3151),o.e(98629),o.e(58550),o.e(22900),o.e(85128),o.e(95555),o.e(90409),o.e(63077),o.e(74562),o.e(95794),o.e(46414),o.e(8184),o.e(99353),o.e(52681),o.e(14518),o.e(17713),o.e(28271),o.e(17254),o.e(4422),o.e(59794),o.e(67435),o.e(75355),o.e(48315),o.e(47123),o.e(847),o.e(5887),o.e(70769),o.e(97965),o.e(17989),o.e(3965),o.e(38911),o.e(9034),o.e(52012),o.e(56985),o.e(50142),o.e(20838),o.e(21627),o.e(88860),o.e(83210),o.e(26090),o.e(82472),o.e(96345),o.e(10596),o.e(73285),o.e(75659),o.e(78846),o.e(47858),o.e(13324),o.e(51860),o.e(15724),o.e(81141),o.e(27274),o.e(99346),o.e(92448),o.e(65638),o.e(72915),o.e(28721),o.e(69689),o.e(23463),o.e(25426),o.e(6463),o.e(91056),o.e(26483),o.e(29333),o.e(5396),o.e(1440),o.e(34576),o.e(95810),o.e(89109),o.e(3560),o.e(77169),o.e(24071),o.e(68610),o.e(67064),o.e(49978),o.e(3720),o.e(47762),o.e(85475),o.e(11740),o.e(97996),o.e(5066),o.e(35299),o.e(68117),o.e(14267),o.e(33731),o.e(30016),o.e(14410),o.e(49471),o.e(31185),o.e(75681)]).then(o.bind(o,241504)),Promise.all([o.e(23806),o.e(75134),o.e(43380),o.e(9304),o.e(96346),o.e(36192),o.e(44711),o.e(53321),o.e(16471),o.e(90825),o.e(37353),o.e(49889),o.e(97727),o.e(55373),o.e(29151),o.e(16908),o.e(62475),o.e(3151),o.e(98629),o.e(58550),o.e(22900),o.e(85128),o.e(95555),o.e(90409),o.e(63077),o.e(74562),o.e(95794),o.e(46414),o.e(8184),o.e(99353),o.e(52681),o.e(14518),o.e(17713),o.e(28271),o.e(17254),o.e(4422),o.e(59794),o.e(67435),o.e(75355),o.e(48315),o.e(47123),o.e(847),o.e(5887),o.e(70769),o.e(97965),o.e(17989),o.e(3965),o.e(38911),o.e(9034),o.e(52012),o.e(56985),o.e(50142),o.e(20838),o.e(21627),o.e(88860),o.e(83210),o.e(26090),o.e(82472),o.e(96345),o.e(10596),o.e(73285),o.e(75659),o.e(78846),o.e(47858),o.e(13324),o.e(51860),o.e(15724),o.e(81141),o.e(27274),o.e(99346),o.e(92448),o.e(65638),o.e(72915),o.e(28721),o.e(69689),o.e(23463),o.e(25426),o.e(6463),o.e(91056),o.e(26483),o.e(29333),o.e(5396),o.e(1440),o.e(34576),o.e(95810),o.e(89109),o.e(3560),o.e(77169),o.e(24071),o.e(68610),o.e(67064),o.e(49978),o.e(3720),o.e(47762),o.e(85475),o.e(11740),o.e(97996),o.e(5066),o.e(35299),o.e(68117),o.e(14267),o.e(33731),o.e(30016),o.e(14410),o.e(49471),o.e(31185),o.e(75681)]).then(o.bind(o,273579)),Promise.all([o.e(23806),o.e(75134),o.e(43380),o.e(9304),o.e(96346),o.e(36192),o.e(44711),o.e(53321),o.e(16471),o.e(90825),o.e(37353),o.e(49889),o.e(97727),o.e(55373),o.e(29151),o.e(16908),o.e(62475),o.e(3151),o.e(98629),o.e(58550),o.e(22900),o.e(85128),o.e(95555),o.e(90409),o.e(63077),o.e(74562),o.e(95794),o.e(46414),o.e(8184),o.e(99353),o.e(52681),o.e(14518),o.e(17713),o.e(28271),o.e(17254),o.e(4422),o.e(59794),o.e(67435),o.e(75355),o.e(48315),o.e(47123),o.e(847),o.e(5887),o.e(70769),o.e(97965),o.e(17989),o.e(3965),o.e(38911),o.e(9034),o.e(52012),o.e(56985),o.e(50142),o.e(20838),o.e(21627),o.e(88860),o.e(83210),o.e(26090),o.e(82472),o.e(96345),o.e(10596),o.e(73285),o.e(75659),o.e(78846),o.e(47858),o.e(13324),o.e(51860),o.e(15724),o.e(81141),o.e(27274),o.e(99346),o.e(92448),o.e(65638),o.e(72915),o.e(28721),o.e(69689),o.e(23463),o.e(25426),o.e(6463),o.e(91056),o.e(26483),o.e(29333),o.e(5396),o.e(1440),o.e(34576),o.e(95810),o.e(89109),o.e(3560),o.e(77169),o.e(24071),o.e(68610),o.e(67064),o.e(49978),o.e(3720),o.e(47762),o.e(85475),o.e(11740),o.e(97996),o.e(5066),o.e(35299),o.e(68117),o.e(14267),o.e(33731),o.e(30016),o.e(14410),o.e(49471),o.e(31185),o.e(75681)]).then(o.bind(o,315729)),Promise.all([o.e(23806),o.e(75134),o.e(43380),o.e(9304),o.e(96346),o.e(36192),o.e(44711),o.e(53321),o.e(16471),o.e(90825),o.e(37353),o.e(49889),o.e(97727),o.e(55373),o.e(29151),o.e(16908),o.e(62475),o.e(3151),o.e(98629),o.e(58550),o.e(22900),o.e(85128),o.e(95555),o.e(90409),o.e(63077),o.e(74562),o.e(95794),o.e(46414),o.e(8184),o.e(99353),o.e(52681),o.e(14518),o.e(17713),o.e(28271),o.e(17254),o.e(4422),o.e(59794),o.e(67435),o.e(75355),o.e(48315),o.e(47123),o.e(847),o.e(5887),o.e(70769),o.e(97965),o.e(17989),o.e(3965),o.e(38911),o.e(9034),o.e(52012),o.e(56985),o.e(50142),o.e(20838),o.e(21627),o.e(88860),o.e(83210),o.e(26090),o.e(82472),o.e(96345),o.e(10596),o.e(73285),o.e(75659),o.e(78846),o.e(47858),o.e(13324),o.e(51860),o.e(15724),o.e(81141),o.e(27274),o.e(99346),o.e(92448),o.e(65638),o.e(72915),o.e(28721),o.e(69689),o.e(23463),o.e(25426),o.e(6463),o.e(91056),o.e(26483),o.e(29333),o.e(5396),o.e(1440),o.e(34576),o.e(95810),o.e(89109),o.e(3560),o.e(77169),o.e(24071),o.e(68610),o.e(67064),o.e(49978),o.e(3720),o.e(47762),o.e(85475),o.e(11740),o.e(97996),o.e(5066),o.e(35299),o.e(68117),o.e(14267),o.e(33731),o.e(30016),o.e(14410),o.e(49471),o.e(31185),o.e(75681)]).then(o.bind(o,83842)),Promise.all([o.e(23806),o.e(75134),o.e(43380),o.e(9304),o.e(96346),o.e(36192),o.e(44711),o.e(53321),o.e(16471),o.e(90825),o.e(37353),o.e(49889),o.e(97727),o.e(55373),o.e(29151),o.e(16908),o.e(62475),o.e(3151),o.e(98629),o.e(58550),o.e(22900),o.e(85128),o.e(95555),o.e(90409),o.e(63077),o.e(74562),o.e(95794),o.e(46414),o.e(8184),o.e(99353),o.e(52681),o.e(14518),o.e(17713),o.e(28271),o.e(17254),o.e(4422),o.e(59794),o.e(67435),o.e(75355),o.e(48315),o.e(47123),o.e(847),o.e(5887),o.e(70769),o.e(97965),o.e(17989),o.e(3965),o.e(38911),o.e(9034),o.e(52012),o.e(56985),o.e(50142),o.e(20838),o.e(21627),o.e(88860),o.e(83210),o.e(26090),o.e(82472),o.e(96345),o.e(10596),o.e(73285),o.e(75659),o.e(78846),o.e(47858),o.e(13324),o.e(51860),o.e(15724),o.e(81141),o.e(27274),o.e(99346),o.e(92448),o.e(65638),o.e(72915),o.e(28721),o.e(69689),o.e(23463),o.e(25426),o.e(6463),o.e(91056),o.e(26483),o.e(29333),o.e(5396),o.e(1440),o.e(34576),o.e(95810),o.e(89109),o.e(3560),o.e(77169),o.e(24071),o.e(68610),o.e(67064),o.e(49978),o.e(3720),o.e(47762),o.e(85475),o.e(11740),o.e(97996),o.e(5066),o.e(35299),o.e(68117),o.e(14267),o.e(33731),o.e(30016),o.e(14410),o.e(49471),o.e(31185),o.e(75681)]).then(o.bind(o,296431)),Promise.all([o.e(23806),o.e(75134),o.e(43380),o.e(9304),o.e(96346),o.e(36192),o.e(44711),o.e(53321),o.e(16471),o.e(90825),o.e(37353),o.e(49889),o.e(97727),o.e(55373),o.e(29151),o.e(16908),o.e(62475),o.e(3151),o.e(98629),o.e(58550),o.e(22900),o.e(85128),o.e(95555),o.e(90409),o.e(63077),o.e(74562),o.e(95794),o.e(46414),o.e(8184),o.e(99353),o.e(52681),o.e(14518),o.e(17713),o.e(28271),o.e(17254),o.e(4422),o.e(59794),o.e(67435),o.e(75355),o.e(48315),o.e(47123),o.e(847),o.e(5887),o.e(70769),o.e(97965),o.e(17989),o.e(3965),o.e(38911),o.e(9034),o.e(52012),o.e(56985),o.e(50142),o.e(20838),o.e(21627),o.e(88860),o.e(83210),o.e(26090),o.e(82472),o.e(96345),o.e(10596),o.e(73285),o.e(75659),o.e(78846),o.e(47858),o.e(13324),o.e(51860),o.e(15724),o.e(81141),o.e(27274),o.e(99346),o.e(92448),o.e(65638),o.e(72915),o.e(28721),o.e(69689),o.e(23463),o.e(25426),o.e(6463),o.e(91056),o.e(26483),o.e(29333),o.e(5396),o.e(1440),o.e(34576),o.e(95810),o.e(89109),o.e(3560),o.e(77169),o.e(24071),o.e(68610),o.e(67064),o.e(49978),o.e(3720),o.e(47762),o.e(85475),o.e(11740),o.e(97996),o.e(5066),o.e(35299),o.e(68117),o.e(14267),o.e(33731),o.e(30016),o.e(14410),o.e(49471),o.e(31185),o.e(75681)]).then(o.bind(o,952451)),Promise.all([o.e(23806),o.e(75134),o.e(43380),o.e(9304),o.e(96346),o.e(36192),o.e(44711),o.e(53321),o.e(16471),o.e(90825),o.e(37353),o.e(49889),o.e(97727),o.e(55373),o.e(29151),o.e(16908),o.e(62475),o.e(3151),o.e(98629),o.e(58550),o.e(22900),o.e(85128),o.e(95555),o.e(90409),o.e(63077),o.e(74562),o.e(95794),o.e(46414),o.e(8184),o.e(99353),o.e(52681),o.e(14518),o.e(17713),o.e(28271),o.e(17254),o.e(4422),o.e(59794),o.e(67435),o.e(75355),o.e(48315),o.e(47123),o.e(847),o.e(5887),o.e(70769),o.e(97965),o.e(17989),o.e(3965),o.e(38911),o.e(9034),o.e(52012),o.e(56985),o.e(50142),o.e(20838),o.e(21627),o.e(88860),o.e(83210),o.e(26090),o.e(82472),o.e(96345),o.e(10596),o.e(73285),o.e(75659),o.e(78846),o.e(47858),o.e(13324),o.e(51860),o.e(15724),o.e(81141),o.e(27274),o.e(99346),o.e(92448),o.e(65638),o.e(72915),o.e(28721),o.e(69689),o.e(23463),o.e(25426),o.e(6463),o.e(91056),o.e(26483),o.e(29333),o.e(5396),o.e(1440),o.e(34576),o.e(95810),o.e(89109),o.e(3560),o.e(77169),o.e(24071),o.e(68610),o.e(67064),o.e(49978),o.e(3720),o.e(47762),o.e(85475),o.e(11740),o.e(97996),o.e(5066),o.e(35299),o.e(68117),o.e(14267),o.e(33731),o.e(30016),o.e(14410),o.e(49471),o.e(31185),o.e(75681)]).then(o.bind(o,275193)),Promise.all([o.e(23806),o.e(75134),o.e(43380),o.e(9304),o.e(96346),o.e(36192),o.e(44711),o.e(53321),o.e(16471),o.e(90825),o.e(37353),o.e(49889),o.e(97727),o.e(55373),o.e(29151),o.e(16908),o.e(62475),o.e(3151),o.e(98629),o.e(58550),o.e(22900),o.e(85128),o.e(95555),o.e(90409),o.e(63077),o.e(74562),o.e(95794),o.e(46414),o.e(8184),o.e(99353),o.e(52681),o.e(14518),o.e(17713),o.e(28271),o.e(17254),o.e(4422),o.e(59794),o.e(67435),o.e(75355),o.e(48315),o.e(47123),o.e(847),o.e(5887),o.e(70769),o.e(97965),o.e(17989),o.e(3965),o.e(38911),o.e(9034),o.e(52012),o.e(56985),o.e(50142),o.e(20838),o.e(21627),o.e(88860),o.e(83210),o.e(26090),o.e(82472),o.e(96345),o.e(10596),o.e(73285),o.e(75659),o.e(78846),o.e(47858),o.e(13324),o.e(51860),o.e(15724),o.e(81141),o.e(27274),o.e(99346),o.e(92448),o.e(65638),o.e(72915),o.e(28721),o.e(69689),o.e(23463),o.e(25426),o.e(6463),o.e(91056),o.e(26483),o.e(29333),o.e(5396),o.e(1440),o.e(34576),o.e(95810),o.e(89109),o.e(3560),o.e(77169),o.e(24071),o.e(68610),o.e(67064),o.e(49978),o.e(3720),o.e(47762),o.e(85475),o.e(11740),o.e(97996),o.e(5066),o.e(35299),o.e(68117),o.e(14267),o.e(33731),o.e(30016),o.e(14410),o.e(49471),o.e(31185),o.e(75681)]).then(o.bind(o,756710)),Promise.all([o.e(23806),o.e(75134),o.e(43380),o.e(9304),o.e(96346),o.e(36192),o.e(44711),o.e(53321),o.e(16471),o.e(90825),o.e(37353),o.e(49889),o.e(97727),o.e(55373),o.e(29151),o.e(16908),o.e(62475),o.e(3151),o.e(98629),o.e(58550),o.e(22900),o.e(85128),o.e(95555),o.e(90409),o.e(63077),o.e(74562),o.e(95794),o.e(46414),o.e(8184),o.e(99353),o.e(52681),o.e(14518),o.e(17713),o.e(28271),o.e(17254),o.e(4422),o.e(59794),o.e(67435),o.e(75355),o.e(48315),o.e(47123),o.e(847),o.e(5887),o.e(70769),o.e(97965),o.e(17989),o.e(3965),o.e(38911),o.e(9034),o.e(52012),o.e(56985),o.e(50142),o.e(20838),o.e(21627),o.e(88860),o.e(83210),o.e(26090),o.e(82472),o.e(96345),o.e(10596),o.e(73285),o.e(75659),o.e(78846),o.e(47858),o.e(13324),o.e(51860),o.e(15724),o.e(81141),o.e(27274),o.e(99346),o.e(92448),o.e(65638),o.e(72915),o.e(28721),o.e(69689),o.e(23463),o.e(25426),o.e(6463),o.e(91056),o.e(26483),o.e(29333),o.e(5396),o.e(1440),o.e(34576),o.e(95810),o.e(89109),o.e(3560),o.e(77169),o.e(24071),o.e(68610),o.e(67064),o.e(49978),o.e(3720),o.e(47762),o.e(85475),o.e(11740),o.e(97996),o.e(5066),o.e(35299),o.e(68117),o.e(14267),o.e(33731),o.e(30016),o.e(14410),o.e(49471),o.e(31185),o.e(75681)]).then(o.bind(o,680777))]);return{CustomizePageMenuRenderer:e,TopbarPageAnalyticsOptOutMenu:t,ImportModal:n,ExportModal:i,PageTemplateModal:a,GoogleAuthPromptModal:r,StudentNotEligibleModal:l,CookieModal:s,ForkPagePopup:c,DatePropertyMenu:u,ReportPageModal:d,SidebarCreateTeamModal:m,SidebarTeamModal:p,CreateTeamFromPageConfirmModal:g,CollectionTypedDatabaseMigrationModal:h,OpenInDesktopAppPopup:y,BlockMenu:f,ImportIntoNewPageModal:v}})),a=(0,n()._h)(i,(e=>e.CustomizePageMenuRenderer)),r=(0,n()._h)(i,(e=>e.TopbarPageAnalyticsOptOutMenu)),l=(0,n()._h)(i,(e=>e.PageTemplateModal)),s=(0,n()._h)(i,(e=>e.ImportModal)),c=(0,n()._h)(i,(e=>e.ExportModal)),u=(0,n()._h)(i,(e=>e.ReportPageModal)),d=(0,n()._h)(i,(e=>e.GoogleAuthPromptModal)),p=(0,n()._h)(i,(e=>e.StudentNotEligibleModal)),m=(0,n()._h)(i,(e=>e.CookieModal)),g=(0,n()._h)(i,(e=>e.BlockMenu)),h=(0,n()._h)(i,(e=>e.ForkPagePopup)),y=(0,n()._h)(i,(e=>e.CollectionTypedDatabaseMigrationModal)),f=(0,n()._h)(i,(e=>e.SidebarCreateTeamModal)),v=(0,n()._h)(i,(e=>e.SidebarTeamModal)),x=(0,n()._h)(i,(e=>e.CreateTeamFromPageConfirmModal)),S=(0,n()._h)(i,(e=>e.OpenInDesktopAppPopup)),b=(0,n()._h)(i,(e=>e.ImportIntoNewPageModal))},701545:(e,t,o)=>{o.d(t,{p:()=>i});o(296540);var n=o(474848);const i=(0,o(340498).wt)("checkMarkLine",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M6.79297 13.2871C6.48047 13.2871 6.21484 13.1523 5.99609 12.8828L2.96094 9.14453C2.875 9.04297 2.8125 8.94336 2.77344 8.8457C2.73828 8.74805 2.7207 8.64648 2.7207 8.54102C2.7207 8.30664 2.79883 8.11328 2.95508 7.96094C3.11133 7.80859 3.30859 7.73242 3.54688 7.73242C3.81641 7.73242 4.04297 7.84766 4.22656 8.07812L6.76953 11.3008L11.7324 3.4375C11.834 3.28125 11.9395 3.17188 12.0488 3.10938C12.1582 3.04297 12.2949 3.00977 12.459 3.00977C12.6973 3.00977 12.8926 3.08398 13.0449 3.23242C13.1973 3.38086 13.2734 3.57031 13.2734 3.80078C13.2734 3.89453 13.2578 3.98828 13.2266 4.08203C13.1953 4.17578 13.1465 4.27344 13.0801 4.375L7.5957 12.8594C7.4082 13.1445 7.14062 13.2871 6.79297 13.2871Z"})})},736767:(e,t,o)=>{o.d(t,{A:()=>r});var n=o(296540),i=o(474848);function a(e,t){return(0,i.jsx)(o(678553).A,{...e,ref:t,style:{background:"none",borderBottom:"none",boxShadow:"",marginTop:2,marginBottom:6,paddingTop:4,paddingBottom:4,minHeight:"none",...e.style}})}const r=(0,n.forwardRef)(a)},748054:(e,t,o)=>{o.d(t,{M:()=>i});o(296540);const n={viewBox:"0 0 20 20",svg:(0,o(474848).jsx)("path",{d:"M10.282 3.66a5.39 5.39 0 0 0-5.217-.54l-.711.305a.63.63 0 0 0-.38.575v12.425a.625.625 0 1 0 1.25 0v-3.913l.333-.142a4.14 4.14 0 0 1 4.008.414 5.39 5.39 0 0 0 5.504.405l1.06-.53a.63.63 0 0 0 .346-.56V4a.625.625 0 0 0-.905-.558l-1.06.53c-1.36.68-2.983.56-4.228-.312m-5.057 7.495V4.412l.332-.142a4.14 4.14 0 0 1 4.008.413 5.39 5.39 0 0 0 5.504.406l.156-.078v6.703l-.715.357c-1.36.68-2.983.56-4.228-.312a5.4 5.4 0 0 0-5.057-.604"})},i=(0,o(340498).wt)("flag",n)},751109:(e,t,o)=>{o.d(t,{z:()=>i});o(296540);var n=o(474848);const i=(0,o(340498).wt)("slackLogo",{viewBox:"0 0 16 16",svg:(0,n.jsxs)("g",{children:[(0,n.jsx)("path",{d:"M1.68078 11.7915C2.60586 11.7915 3.36156 11.0358 3.36156 10.1107V8.42993H1.68078C0.755701 8.42993 0 9.18563 0 10.1107C0 11.0358 0.755701 11.7915 1.68078 11.7915Z",fill:"#E01E5A"}),(0,n.jsx)("path",{d:"M5.88928 8.42993C4.9642 8.42993 4.2085 9.18563 4.2085 10.1107V14.3192C4.2085 15.2443 4.9642 16 5.88928 16C6.81436 16 7.57006 15.2443 7.57006 14.3192V10.1107C7.57006 9.18563 6.81436 8.42993 5.88928 8.42993Z",fill:"#E01E5A"}),(0,n.jsx)("path",{d:"M4.2085 1.68078C4.2085 2.60586 4.9642 3.36156 5.88928 3.36156H7.57006V1.68078C7.57006 0.755701 6.81436 0 5.88928 0C4.9642 0 4.2085 0.755701 4.2085 1.68078Z",fill:"#36C5F0"}),(0,n.jsx)("path",{d:"M7.57003 5.88928C7.57003 4.9642 6.81433 4.2085 5.88925 4.2085H1.68078C0.755701 4.2085 0 4.9642 0 5.88928C0 6.81436 0.755701 7.57006 1.68078 7.57006H5.88925C6.81433 7.57006 7.57003 6.81436 7.57003 5.88928Z",fill:"#36C5F0"}),(0,n.jsx)("path",{d:"M10.1107 7.57003C11.0358 7.57003 11.7915 6.81433 11.7915 5.88925V1.68078C11.7915 0.755701 11.0358 0 10.1107 0C9.18563 0 8.42993 0.755701 8.42993 1.68078V5.88925C8.42993 6.81433 9.18563 7.57003 10.1107 7.57003Z",fill:"#2EB67D"}),(0,n.jsx)("path",{d:"M14.3192 4.2085C13.3941 4.2085 12.6384 4.9642 12.6384 5.88928V7.57006H14.3192C15.2443 7.57006 16 6.81436 16 5.88928C16 4.9642 15.2443 4.2085 14.3192 4.2085Z",fill:"#2EB67D"}),(0,n.jsx)("path",{d:"M8.42993 10.1107C8.42993 11.0358 9.18563 11.7915 10.1107 11.7915H14.3192C15.2443 11.7915 16 11.0358 16 10.1107C16 9.18563 15.2443 8.42993 14.3192 8.42993H10.1107C9.18563 8.42993 8.42993 9.18563 8.42993 10.1107Z",fill:"#ECB22E"}),(0,n.jsx)("path",{d:"M11.7915 14.3192C11.7915 13.3941 11.0358 12.6384 10.1107 12.6384H8.42993V14.3192C8.42993 15.2443 9.18563 16 10.1107 16C11.0358 16 11.7915 15.2443 11.7915 14.3192Z",fill:"#ECB22E"})]})})},774256:(e,t,o)=>{o.d(t,{z:()=>l});o(296540);var n=()=>o(484714),i=()=>o(401497),a=()=>o(449552),r=o(474848);function l(e){const{children:t,icon:o}=e,l=function(){const{isMobile:e}=(0,n().Y0)();return(0,i().IS)((t=>({iconWrap:{flexGrow:0,flexShrink:0},messageWrap:{flexGrow:1},lockedIcon:{fill:t.icon.secondary,height:"100%",width:"100%"},lockedIconWrap:{background:t.fill.lightGraySecondary,borderRadius:4,height:20,padding:2,width:20},paragraph:{color:t.text.secondary,fontSize:e?14:12,margin:0},wrap:{alignItems:"center",display:"flex",flexDirection:"row",marginBottom:6,gap:10},wrapWrap:{padding:e?"0 12px 12px":"0 0 6px 0"}})),[e])}();return(0,r.jsx)("div",{style:l.wrapWrap,children:(0,r.jsxs)("div",{style:l.wrap,children:[(0,r.jsx)("div",{style:l.iconWrap,children:(0,r.jsx)("div",{style:l.lockedIconWrap,children:o||(0,a().g)(l.lockedIcon)})}),(0,r.jsx)("div",{style:l.messageWrap,children:(0,r.jsx)("p",{style:l.paragraph,children:t})})]})})}},820579:(e,t,o)=>{o.d(t,{f:()=>i});o(296540);const n={viewBox:"0 0 20 20",svg:(0,o(474848).jsx)("path",{d:"M10 2.4c.345 0 .625.28.625.625v9.966l3.333-3.333a.625.625 0 1 1 .884.884l-4.4 4.4a.625.625 0 0 1-.884 0l-4.4-4.4a.625.625 0 0 1 .884-.884l3.333 3.333V3.025c0-.345.28-.625.625-.625M4.15 16.35a.625.625 0 1 0 0 1.25h11.7a.625.625 0 0 0 0-1.25z"})},i=(0,o(340498).wt)("arrowLineDown",n)},826352:(e,t,o)=>{o.d(t,{j:()=>d});o(296540);var n=()=>o(401497),i=()=>o(959013),a=()=>o(284371),r=()=>o(84817),l=()=>o(493823),s=()=>o(546461),c=o(474848);const u=(0,i().YK)({automationRequiresSubscription:{defaultMessage:"To edit or run this automation, upgrade your plan.",id:"AutomationHeaderView.automationRequiresSubscription"},automationRequiresSubscriptionButton:{defaultMessage:"To edit or run this automation, upgrade your plan or remove any connected action steps.",id:"AutomationHeaderView.automationRequiresSubscriptionButton"},automationRequiresSubscriptionTitle:{defaultMessage:"Upgrade to use connected actions",id:"AutomationHeaderView.automationRequiresSubscriptionTitle"},automationRequiresSubscriptionUpgradeButton:{defaultMessage:"Upgrade",id:"AutomationHeaderView.automationRequiresSubscriptionUpgradeButton"}});function d(e){const{onUpsellClick:t}=e,{contextType:o}=(0,s().EC)(),d="button_block"===o||"button_property"===o,p=d?u.automationRequiresSubscriptionButton:u.automationRequiresSubscription,m=(0,n().IS)((e=>({wrap:{fontSize:14,background:e.surface.wash,border:`1px solid ${e.surface.wash}`,borderRadius:6,padding:12,marginBottom:12},button:{fontWeight:a().Wy.medium,borderRadius:6,border:`1px solid ${e.stroke.primary}`,alignSelf:"flex-start"},title:{color:e.text.primary,fontWeight:a().Wy.medium,margin:0},text:{color:e.text.secondary,margin:0}})),[]);return(0,c.jsxs)(r().Y1,{direction:"vertical",gap:4,style:m.wrap,children:[d&&(0,c.jsx)("p",{style:m.title,children:(0,c.jsx)(i().sA,{...u.automationRequiresSubscriptionTitle})}),(0,c.jsx)("p",{style:m.text,children:(0,c.jsx)(i().sA,{...p})}),(0,c.jsx)(l().p,{onClick:t,style:m.button,children:(0,c.jsx)(i().sA,{...u.automationRequiresSubscriptionUpgradeButton})})]})}},828973:(e,t,o)=>{o.d(t,{A:()=>p});o(898992),o(672577),o(581454);var n=o(296540),i=()=>o(56366),a=()=>o(496603),r=()=>o(406699),l=()=>o(939740),s=()=>o(14235),c=()=>o(89924),u=()=>o(722872),d=o(474848);const p=function(e){let{icon:t,iconStyle:p,title:m,selectedKey:g,onChange:h,onClick:y,popupStyle:f,menuItemOptionsStyle:v,menuStyle:x,disabled:S,collectionContextStore:b,openButtonPopup:C,hideCheck:A,children:k,disableParentClose:j,inputPlaceholder:M,...T}=e;const I=(0,o(484714).Y0)(),w="options"in T?T.options:a().Bq(T.sections),P=w.find((e=>a().n4(e.key,g))),B=(0,i().uB)(void 0,o(463830).A),R=(0,i().O$)(B);return(0,n.useEffect)((()=>{b&&C&&(B.setState({...B.state,open:C}),b.settingsStore.setState({...b.settingsStore.state,openButtonPopup:void 0})),P||o(857639).log({level:"error",from:"CollectionSettingsPickListMenuItem",type:"InvalidSelectedItem",error:(0,o(229833).n6)("Selected key is invalid.")})})),(0,d.jsx)(r().Ay,{popupType:I.isMobile?s().nl.SlideUp:s().nl.Popup,alignmentToOrigin:r().yP.End,placementToOrigin:r().sx.Bottom,style:f,originGap:0,buttonPopupStore:B,disabled:S,onClick:y,renderOrigin:e=>(0,d.jsx)(o(497222).A,{title:m,showChevron:!0,right:(0,d.jsx)("span",{style:o(284371).RC,children:"input"===(null==P?void 0:P.type)?P.inputValue:null==P?void 0:P.title}),rotateChevron:R.open,disabled:S,icon:t,iconStyle:p,...(0,o(553965).A)(e,T)}),render:e=>{let t;t=I.isMobile?{menuType:u().gu.ActionSheet}:{menuType:u().gu.Popup,width:250,...x};const n=(t,n)=>{if(t.hideOption)return null;let i;return i="input"===t.type?{key:n,render:n=>(0,d.jsx)(o(419357).Ay,{...n,style:{width:"100%",paddingTop:4,paddingBottom:4},value:t.inputValue??"",onChange:e=>{var o;null===(o=t.onChange)||void 0===o||o.call(t,e.target.value)},onSubmit:o=>{var n;null===(n=t.onSubmit)||void 0===n||n.call(t,t.key,e,t.inputValue),e.close()},placeholder:M,checkState:!A&&a().n4(t.key,g)}),action:()=>{}}:{key:n,render:e=>(0,d.jsx)(o(760217).A,{...e,disabled:!1,title:t.title,icon:t.icon,caption:t.caption,captionStyle:t.captionStyle,inline:t.captionInline,spacerStyle:t.inlineSpacerStyle,body:t.body,style:v,checkState:!A&&a().n4(t.key,g)}),action:()=>{h(t.key,e),j||e.close()}},i},i="sections"in T?T.sections.map(((e,t)=>({key:t,render:e=>(0,d.jsx)(c().A,{enableActionSheetTitle:!0,topBorder:t>0,...e}),items:a().oE(e.map(n))}))):[{key:0,render:e=>(0,d.jsx)(c().A,{enableActionSheetTitle:!0,...e}),items:a().oE(w.map(n))}];return(0,d.jsxs)(o(928600).A,{...t,children:[(0,d.jsx)(l().Ay,{type:l().Oh.Vertical,sections:i,initialFocus:0,resetFocusOnMouseOut:!0}),k||null]})}})}},858163:(e,t,o)=>{o.d(t,{W:()=>l});var n=o(296540),i=()=>o(973647),a=()=>o(217827),r=()=>o(546461);function l(e){const t=(0,r().YC)();return{onTextStoreSelect:(0,n.useMemo)((()=>{if(t.defined&&i().Q.isSuccess(t.typecheckResult)){const{automationStore:o,contextType:n,typecheckResult:i}=t;return function(){a().A.focus({automationStore:o,contextType:n,typecheckResult:i.value,automationActionStore:e})}}}),[e,t]),onTextStoreUnselect:(0,n.useMemo)((()=>{if(t.defined&&i().Q.isSuccess(t.typecheckResult)){const{automationStore:o,contextType:n,typecheckResult:i}=t;return function(){a().A.blur({automationStore:o,contextType:n,typecheckResult:i.value,automationActionStore:e})}}}),[e,t])}}},881254:(e,t,o)=>{o.d(t,{R:()=>P});var n=o(296540),i=()=>o(908006),a=()=>o(484714),r=()=>o(401497),l=()=>o(925907),s=()=>o(30626),c=()=>o(657222),u=()=>o(173019),d=()=>o(959013),p=()=>o(100622),m=()=>o(284371),g=()=>o(884107),h=()=>o(522945),y=()=>o(115512),f=()=>o(962730),v=()=>o(397248),x=()=>o(630116),S=()=>o(704152),b=()=>o(406699),C=()=>o(854672),A=()=>o(285790),k=()=>o(816559),j=()=>o(710149),M=()=>o(21140),T=()=>o(904694),I=()=>o(24611),w=o(474848);function P(e){const t=(0,a().v3)(),{hoverData:o,href:P,handleEditClick:B,showEditButton:R,loading:_,store:V,token:E,onDismiss:F}=e,D=(0,r().IS)((e=>({newWrapper:{width:280,flexDirection:"column",alignItems:"flex-start"},coverContainer:{width:280,height:120},pageTitle:{display:"inline",fontWeight:m().Wy.semibold,color:e.text.primary,fontSize:13,lineHeight:1.15},highlightedBlockWrapper:{display:"flex",marginBottom:8},contentNew:{display:"flex",flexDirection:"column",alignItems:"flex-start",padding:"12px 16px",gap:12,width:280},titleAndDescription:{display:"flex",flexDirection:"column",alignItems:"flex-start",padding:0,gap:2,width:248},linkTitle:{...(0,y().pA)(2),fontStyle:"normal",fontWeight:m().Wy.semibold,fontSize:14,letterSpacing:-.154,lineHeight:"143%",fontFeatureSettings:"'case' on",textOverflow:"ellipsis",color:e.regularTextColor},newDescription:{display:"flex",flexDirection:"column",alignItems:"flex-start",padding:0,...(0,y().pA)(3),textOverflow:"ellipsis",width:248},newText:{fontSize:12,fontWeight:400,whiteSpace:"normal",wordBreak:"break-word",color:e.regularTextColor},buttonStyle:{display:"flex",alignItems:"center",justifyContent:"center",width:24,height:24,borderRadius:4,fill:e.lightIconColor,background:o?(0,I().FF)(t):"dark"===e.mode?e.accentColors.gray[100]:e.buttonBackground,border:o?void 0:"1px solid var(--Stroke-Deemphasized, rgba(227, 226, 224, 0.50))"},iconBoxImageStyle:{margin:1}})),[t,o]),L=(0,d().tz)(),O=(0,n.useRef)(null),K=(0,d().YK)({copyLink:{defaultMessage:"Copy link",id:"hoverPreviewOverlay.copyLink"},editLink:{defaultMessage:"Edit link",id:"hoverPreviewOverlay.editLink"}}),N=(0,n.useCallback)((async()=>{await i().default.afterNextFlush();const e=await g().R.clipboardActions.load(),o=e.clipboardMessages.copiedLinkToClipboard,n=P;e.copyString({environment:t,stringValue:n,copiedMessage:o})}),[t,P]),W=V&&V.recordStoreUIParentStore&&V.recordStoreUIParentStore instanceof x().Bv?V.recordStoreUIParentStore:V instanceof x().Bv?V:void 0,z=(null==o?void 0:o.thumbnail_url)??((null==o?void 0:o.images)&&o.images.length>0&&o.images[0].url);return(0,w.jsxs)(M().wt,{style:D.newWrapper,children:[R&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(A().A,{onClick:N,icon:l().n,isDarkIconColor:!0,ariaLabel:L.formatMessage(K.copyLink),hasBackground:!0,style:{position:"absolute",top:8,right:8}}),(0,w.jsx)(A().A,{onClick:B,icon:u().r,isDarkIconColor:!0,ariaLabel:L.formatMessage(K.editLink),hasBackground:!0,style:{position:"absolute",top:8,right:35}})]}),E&&W&&!R&&(0,w.jsx)("div",{style:{position:"absolute",top:8,right:8},children:(0,w.jsx)(b().Ay,{popupType:b().z7.Popup,placementToOrigin:f().W.Right,alignmentToOrigin:f().C.Start,originGap:4,onClose:()=>{let e=!1;const t=O.current;t&&(e=(0,v().ux)(t.getBoundingClientRect(),h().$C.x,h().$C.y)),e||null==F||F()},renderOrigin:e=>(0,w.jsx)(S().A,{style:D.buttonStyle,...e,children:(0,s()._)({width:14,fill:o?p().Ay.white:p().Ay.uiGray})}),render:e=>(0,w.jsx)(T().A,{parentBlockStore:W,store:V,token:E,href:P,hoverData:o,onAccept:()=>e.close()})})}),z&&(0,w.jsx)(M().Ye,{style:D.coverContainer,children:(0,w.jsx)(k().Ay,{src:z,style:{width:"100%",height:"100%",left:0,top:"calc(50% - 280px/2)"}})}),(0,w.jsxs)(M().wt,{style:D.contentNew,children:[((null==o?void 0:o.title)||(null==o?void 0:o.description))&&(0,w.jsxs)(M().wt,{style:D.titleAndDescription,children:[(null==o?void 0:o.title)&&(0,w.jsx)(M().Ye,{gap:2,children:(0,w.jsx)("div",{style:D.linkTitle,children:null==o?void 0:o.title})}),(null==o?void 0:o.description)&&(0,w.jsx)(M().Ye,{gap:2,children:(0,w.jsx)("div",{style:D.newDescription,children:(0,w.jsx)("div",{spellCheck:!1,style:D.newText,children:(0,w.jsx)("div",{children:null==o?void 0:o.description})})})})]}),_?(0,w.jsx)(j().A,{style:{width:200,height:16}}):(0,w.jsxs)(M().Ye,{alignItems:"left",style:{display:"flex",flexDirection:"row",alignItems:"center",padding:0,gap:4,width:205,height:16},children:[null!=o&&o.favicon_url?(0,w.jsx)(C().A,{type:"image_url",imageURL:null==o?void 0:o.favicon_url,size:16,style:D.iconBoxImageStyle}):null!=o&&o.icon_url?(0,w.jsx)(C().A,{type:"image_url",imageURL:null==o?void 0:o.icon_url,size:16,style:D.iconBoxImageStyle}):(0,w.jsx)(A().A,{icon:c().w,isDarkIconColor:!0,disabled:!0}),(0,w.jsx)("div",{style:{flexGrow:0,fontWeight:m().Wy.medium,color:"#787774",fontSize:12,...m().RC},children:(null==o?void 0:o.provider_name)||(null==o?void 0:o.link_provider)||P})]})]})]})}},881707:(e,t,o)=>{o.d(t,{Dy:()=>l,Os:()=>c,l$:()=>s,qO:()=>r});o(944114),o(898992),o(354520);var n=()=>o(617871),i=()=>o(792071),a=()=>o(402904);function r(e){if(e.integration_id!==n().zG)throw"Cannot render account for integration.";const t=/(.+) - (.+)/.exec(e.account_name);if(!t)return{accountName:e.account_name};const[,o,i]=t;return{organizationName:o,accountName:i}}function l(e){return i().Bj6.fromValue(a().As,e).getSlackWorkspaceId()}function s(e,t){return t?e.filter((e=>{const o=l(e);return!!o&&t(o)})):e}function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const o={};for(const n of e){const{accountName:e,organizationName:i}=r(n);u({query:t,accountName:e,organizationName:i})&&(o[e]||(o[e]=[]),o[e].push({externalAuthentication:n,workspaceName:i}))}return o}function u(e){const{accountName:t,organizationName:o,query:n}=e;if(0===n.length)return!0;const i=t.toLocaleLowerCase().indexOf(n.trim().toLocaleLowerCase())>=0,a=!!o&&o.toLocaleLowerCase().indexOf(n.trim().toLocaleLowerCase())>=0;return i||a}},904694:(e,t,o)=>{o.d(t,{A:()=>x});o(944114),o(296540);var n=()=>o(484714),i=()=>o(700500),a=()=>o(925907),r=()=>o(673724),l=()=>o(919709),s=()=>o(959013),c=()=>o(443120),u=()=>o(884107),d=()=>o(246826),p=()=>o(317909),m=()=>o(722872),g=()=>o(575143),h=()=>o(928600),y=()=>o(939740),f=()=>o(89924),v=o(474848);function x(e){const{store:t,parentBlockStore:o,onAccept:x,token:S,href:b,hoverData:C}=e,A=(0,n().v3)(),k=[];return k.push({key:0,render:e=>(0,v.jsx)(f().A,{...e,style:{paddingTop:0,paddingBottom:0}}),items:[{key:"copy link",render:e=>(0,v.jsx)(g().A,{...e,title:(0,v.jsx)(s().sA,{id:"linkMention.copyLink",defaultMessage:"Copy Link"}),svg:a().n}),action:async()=>{if(!t)return;if(!S)return;const e=await u().R.clipboardActions.load(),o=e.clipboardMessages.copiedLinkToClipboard,n=b;e.copyString({environment:A,stringValue:n,copiedMessage:o})}}]}),k.push({key:1,render:e=>(0,v.jsx)(f().A,{...e,style:{paddingTop:0,paddingBottom:0}}),items:[{key:"convert to bookmark",render:e=>(0,v.jsx)(g().A,{...e,title:(0,v.jsx)(s().sA,{id:"linkMention.convertToBookmark",defaultMessage:"Turn into preview"}),svg:r().I}),action:()=>{t&&S&&p().createAndCommit({userAction:"LinkMentionMenu.convertToBookmark",environment:A,canUndo:!0,perform:e=>{if(C){const n=d().Wv({environment:A,type:i().xd.bookmark,inMemoryRecordCache:t.inMemoryRecordCache,properties:{title:C&&C.title?l().x9d(C.title):l().x9d(b),link:l().x9d(b),description:C&&C.description?l().x9d(C.description):void 0},format:{bookmark_cover:C.thumbnail_url,bookmark_icon:C.favicon_url?C.favicon_url:C.icon_url},transaction:e,spaceId:t.pointer.spaceId});c().ed({environment:A,parentBlockStore:o,blockStore:n,token:S,transaction:e})}else{const n=d().Wv({environment:A,type:i().xd.bookmark,inMemoryRecordCache:t.inMemoryRecordCache,properties:{title:l().x9d(b),link:l().x9d(b)},transaction:e,spaceId:t.pointer.spaceId});c().ed({environment:A,parentBlockStore:o,blockStore:n,token:S,transaction:e})}}})}}]}),(0,v.jsx)(h().A,{menuType:m().gu.Popup,children:(0,v.jsx)(y().Ay,{type:y().Oh.Vertical,initialFocus:void 0,onAccept:x,sections:k,style:{paddingTop:3,paddingBottom:3}})})}},931077:(e,t,o)=>{o.d(t,{Q:()=>l});o(296540);var n=()=>o(484714),i=()=>o(401497),a=()=>o(494379),r=o(474848);function l(e){const{isMobile:t}=(0,n().Y0)(),o=(0,i().DP)();return(0,r.jsx)(a().Q,{...e,theme:o,isMobile:t})}},938818:(e,t,o)=>{o.d(t,{J:()=>u,L:()=>d});o(18107),o(967357);var n=o(296540),i=()=>o(563015),a=()=>o(959013),r=()=>o(534177),l=()=>o(554509),s=()=>o(963589),c=o(474848);function u(e){const{analyzedFormulaOutput:t}=e,{parseErrors:o,typeErrors:i}=t,u=(0,a().tz)(),p=(0,s().X)("automation_updated_error_states"),m=(0,n.useMemo)((()=>d(u,o??[],i??[])),[u,o,i]);return(0,r().O9)(m)?(0,c.jsx)(l().D,{colorName:p?"uiRedPrimary":"secondary",styleName:"UISmall-12px/Regular",children:(0,c.jsx)(a().sA,{...m})}):null}function d(e,t,o){const n=null==t?void 0:t.at(0);if((0,r().O9)(n))return(0,i().ml)(n);const a=null==o?void 0:o.at(0);return(0,r().O9)(a)?(0,i().rA)(e,a):void 0}},938987:(e,t,o)=>{o.d(t,{H2:()=>f,iB:()=>v,cG:()=>g,UY:()=>x,x3:()=>h});var n=o(296540),i=()=>o(56366),a=()=>o(401497),r=()=>o(654601),l=()=>o(430483),s=()=>o(270483),c=()=>o(783793),u=()=>o(311004);const d=o.p+"c9223887dcb57b7d.gif",p=o.p+"7e9cbd56b1eca7b9.gif";var m=o(474848);function g(e){const{variant:t,style:o,forceSparkles:n}=e,a=(0,i().O$)(l().ts);let r;return r=!n&&a?(0,m.jsx)("div",{style:{display:"flex",alignItems:"center"},children:(0,m.jsx)(c().o,{variant:t,shadowVariant:"light"})}):(0,m.jsx)(s().g,{variant:n?"small":t}),(0,m.jsx)("div",{style:o,children:r})}function h(e){const{variant:t}=e,o=(0,i().O$)(l().ts),n=(0,a().IS)((()=>({sparklesWrapper:{borderRadius:"100%",border:"2px solid RGB(182,208,240)",marginRight:8,marginLeft:8,padding:4},badge:{position:"absolute",left:"27px",top:"-5px"},faceWrapper:{marginRight:8}})),[]);return o?(0,m.jsx)("div",{style:n.faceWrapper,children:(0,m.jsx)(y,{variant:t})}):(0,m.jsxs)("div",{style:n.sparklesWrapper,children:[(0,m.jsx)(s().g,{variant:t}),(0,m.jsx)("div",{style:n.badge,children:(0,m.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10",height:"11",viewBox:"0 0 10 11",fill:"none",children:(0,m.jsx)("circle",{cx:"5",cy:"5.5",r:"4",fill:"#2383E2",stroke:"white",strokeWidth:"2"})})})]})}function y(e){const{variant:t}=e,o="dark"===(0,a().DP)().mode,[i,r]=(0,n.useState)(!0);(0,n.useEffect)((()=>{setTimeout((()=>{r(!1)}),6e3)}),[]);const l=(0,n.useMemo)((()=>{if(i)return o?d:p}),[o,i]);return(0,m.jsx)("div",{style:{marginLeft:8},children:(0,m.jsx)(c().o,{variant:t,shadowVariant:"light",wrapWithPadding:!0,imgSource:l})})}function f(){const e=(0,i().O$)(l().ts),t=(0,a().IS)((e=>({faceImgStyles:{width:20,height:20,background:e.assistantCornerButtonBackground,borderRadius:"50%",border:`1px solid ${e.tableDividerColor}`},sparklesIconStyle:{width:16,height:16,fill:e.icon.secondary}})),[]);return e?(0,m.jsx)("img",{style:t.faceImgStyles,src:u(),role:"presentation",alt:"Notion AI Face"}):(0,r().X)(t.sparklesIconStyle)}function v(){const e=(0,i().O$)(l().ts),t=(0,a().IS)((e=>({faceImgStyles:{width:20,height:20,background:e.assistantCornerButtonBackground,borderRadius:"50%",border:`1px solid ${e.tableDividerColor}`},sparklesIconStyle:{width:16,height:16,fill:e.icon.secondary}})),[]);return e?(0,m.jsx)("img",{style:t.faceImgStyles,src:u(),role:"presentation",alt:"Notion AI Face"}):(0,r().X)(t.sparklesIconStyle)}function x(){const e=(0,i().O$)(l().ts),t=(0,a().IS)((e=>({faceImgStyles:{width:20,height:20,background:e.assistantCornerButtonBackground,borderRadius:"50%",border:`1px solid ${e.tableDividerColor}`,marginLeft:-2,marginRight:2},sparklesIconStyle:{width:16,height:16,marginRight:2},sparklesIconWrapper:{borderRadius:4,display:"flex",alignItems:"center",justifyContent:"center"}})),[]);return e?(0,m.jsx)("img",{style:t.faceImgStyles,src:u(),role:"presentation",alt:"Notion AI Face"}):(0,m.jsx)("div",{style:t.sparklesIconWrapper,children:(0,r().X)(t.sparklesIconStyle)})}},957963:(e,t,o)=>{o.d(t,{j:()=>i});o(296540);var n=o(474848);const i=(0,o(340498).wt)("editPropertyType",{viewBox:"0 0 16 16 ",svg:(0,n.jsx)("path",{d:"M11.5615 4.84473L12.2998 4.11328C12.6689 3.74414 12.6826 3.34082 12.3545 3.00586L12.0879 2.73926C11.7529 2.4043 11.3428 2.43848 10.9736 2.79395L10.2354 3.52539L11.5615 4.84473ZM3.22168 13.1641L10.9053 5.4873L9.59277 4.16797L1.90918 11.8516L1.23926 13.4512C1.16406 13.6562 1.37598 13.875 1.57422 13.7998L3.22168 13.1641ZM3.92578 13.8066H14.1045C14.4736 13.8066 14.7744 13.499 14.7744 13.1367C14.7744 12.7676 14.4736 12.4668 14.1045 12.4668H5.27246L3.92578 13.8066Z"})})},987017:(e,t,o)=>{o.d(t,{Ay:()=>c,Jy:()=>s,vU:()=>l});o(581454);var n=o(296540),i=()=>o(722872),a=o(474848);function r(e){let{tabs:t,selectedIndex:r,onChange:c,separatorIndexes:u,right:d,style:p,rightStyle:m,tabStyle:g,tabTitleStyle:h,selectedTabTitleStyle:y,tabBorderStyle:f,selectedTabStyle:v,readOnly:x,hideTabBorder:S,idPrefix:b}=e;const C=(0,n.useContext)(i().xu),{device:A,WindowSizeStore:k}=(0,o(484714).v3)(),{safePaddingLeft:j,safePaddingRight:M}=(0,o(56366).K8)((()=>({safePaddingLeft:k.getSafePaddingLeftCSS(16),safePaddingRight:k.getSafePaddingRightCSS(16)})),[k]),T=(0,o(401497).IS)((e=>{const t={paddingTop:6,paddingBottom:6,whiteSpace:"nowrap",minWidth:0,flexShrink:0,color:e.mediumTextColor,...g},o=`inset 0 -1px 0 ${e.regularDividerColor}`,n=C.menuType===i().gu.Popup,a={fontSize:16,paddingTop:2,paddingLeft:n?16:j,paddingRight:n?16:M,zIndex:2,height:44,background:e.popoverBackground};return{container:{overflowY:"visible",overflowX:"auto",display:"flex",width:"100%",position:"relative",boxShadow:S?void 0:o,...A.isMobile?a:{fontSize:14,paddingLeft:8,paddingRight:8,zIndex:1},...p},separator:{display:"inline-flex",alignItems:"center",margin:"0 4px",paddingBottom:4,whiteSpace:"nowrap",minWidth:0,flexShrink:0,color:e.regularDividerColor},mobile:{},tab:t,selectedTab:{...t,position:"relative",color:e.regularTextColor,...v},border:{borderBottom:`2px solid ${e.regularTextColor}`,position:"absolute",bottom:0,left:8,right:8,...f},rightContainer:{flexGrow:1,display:"flex",alignItems:"center",justifyContent:"flex-end",color:e.mediumTextColor,...m}}}),[C.menuType,A.isMobile,m,j,M,v,p,f,g,S]);return(0,a.jsxs)("div",{className:"hide-scrollbar",style:T.container,role:"tablist",children:[t.map(((e,t)=>{const i=t===r;return(0,a.jsxs)(n.Fragment,{children:[(0,a.jsxs)("div",{style:i?T.selectedTab:T.tab,children:[(0,a.jsx)(o(493823).p,{style:{...h,...i?y:{}},onClick:()=>c(t),disabled:x,mobileFeedback:A.isMobile,isLightGray:!Boolean(i),role:"tab","aria-selected":i,id:l(b,t),"aria-controls":s(b,t),children:e}),i&&(0,a.jsx)("div",{style:T.border})]},`tabButton-${t}`),u&&u.includes(t)&&(0,a.jsx)("div",{style:T.separator,className:"notranslate",children:"|"},`${t}-separator`)]},t)})),d&&(0,a.jsx)("div",{style:T.rightContainer,children:d})]})}function l(e,t){if(e)return`${e}-tab-${t}`}function s(e,t){if(e)return`${e}-tabpanel-${t}`}const c=n.memo(r)},992510:(e,t,o)=>{o.d(t,{A:()=>r});o(296540);var n=()=>o(959013),i=()=>o(250202),a=o(474848);const r=function(e){const t=(0,o(484714).v3)(),{device:r}=t;if(r.isMobile)return e.propertySchema?(0,a.jsx)(i().G,{propertySchema:e.propertySchema,onClick:e.onClick,focused:!1,format:i().e.Name,showExtensionArrow:!e.disabled}):(0,a.jsx)(o(760217).A,{focused:!1,title:(0,a.jsx)(n().sA,{defaultMessage:"Property",id:"database.mobileFilterAndSortMenu.property.buttonMenuItem.label"})});{const t=e.propertySchema&&(0,a.jsx)(o(717402).Ay,{propertySchema:e.propertySchema,showIcon:!0,style:{lineHeight:1.4}}),i=(0,a.jsx)(n().sA,{defaultMessage:"Property",id:"database.filterAndSortMenu.propertyButton.label"});return(0,a.jsx)(o(272630).A,{title:t,placeholder:i,onClick:e.onClick,disabled:e.disabled,disableMargins:e.disableMargins,desktopStyle:e.textWrapperStyle})}}}}]);