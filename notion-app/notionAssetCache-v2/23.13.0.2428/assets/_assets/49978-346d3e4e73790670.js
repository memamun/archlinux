"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[49978],{77126:(e,t,r)=>{r.d(t,{j:()=>o});class a extends(()=>r(959180))().A{}const o=new a},367262:(e,t,r)=>{r.d(t,{S:()=>n});var a=()=>r(963589),o=()=>r(167946);function n(){return(0,a().X)("opfs_recordmap_cache")&&(0,o().M)()}},556048:(e,t,r)=>{r.d(t,{C8:()=>p,Dz:()=>s,GC:()=>h,GL:()=>g,YY:()=>f,dM:()=>d,h9:()=>l,jX:()=>i,oF:()=>u,uj:()=>c});var a=()=>r(645873);const o={JiraSyncInfoPopup:new(a().O2)("JiraSyncInfoPopup",(async()=>await Promise.all([r.e(75134),r.e(68744)]).then(r.bind(r,408453)))),ImproveJiraSyncPopup:new(a().O2)("ImproveJiraSyncPopup",(async()=>await Promise.all([r.e(75134),r.e(2686)]).then(r.bind(r,484967)))),JiraDCAuthModal:new(a().O2)("JiraDCAuthModal",(async()=>await r.e(28763).then(r.bind(r,992567)))),ExternalImportAndSyncIndicator:new(a().O2)("ExternalImportAndSyncIndicator",(async()=>await r.e(98288).then(r.bind(r,984289)))),JiraSyncedAllProjectsTooltip:new(a().O2)("JiraSyncedAllProjectsTooltip",(async()=>await Promise.all([r.e(23806),r.e(21446)]).then(r.bind(r,470020)))),JiraSyncedAllIssuesTooltip:new(a().O2)("JiraSyncedAllIssuesTooltip",(async()=>await Promise.all([r.e(23806),r.e(21446)]).then(r.bind(r,470020)))),JiraSyncedDatabaseViewsAndFiltersTooltip:new(a().O2)("JiraSyncedDatabaseViewsAndFiltersTooltip",(async()=>await Promise.all([r.e(23806),r.e(21446)]).then(r.bind(r,470020)))),JiraSyncSourceTooltip:new(a().O2)("JiraSyncSourceTooltip",(async()=>await Promise.all([r.e(23806),r.e(21446)]).then(r.bind(r,470020)))),JiraSyncedSettingsToSetupProjectsAndIssuesTooltip:new(a().O2)("JiraSyncedSettingsToSetupProjectsAndIssuesTooltip",(async()=>await Promise.all([r.e(23806),r.e(21446)]).then(r.bind(r,470020))))},n={JiraSyncTeamSpaceModal:new(a().O2)("JiraSyncTeamSpaceModal",(async()=>Promise.all([r.e(23806),r.e(56188)]).then(r.bind(r,604698))))},c=(0,a()._h)(n.JiraSyncTeamSpaceModal,(e=>e.default)),i=(0,a()._h)(o.JiraSyncedAllProjectsTooltip,(e=>e.JiraSyncedAllProjectsTooltip)),s=(0,a()._h)(o.JiraDCAuthModal,(e=>e.default)),l=(0,a()._h)(o.JiraSyncedAllIssuesTooltip,(e=>e.JiraSyncedAllIssuesTooltip)),d=(0,a()._h)(o.JiraSyncedDatabaseViewsAndFiltersTooltip,(e=>e.JiraSyncedDatabaseViewsAndFiltersTooltip)),u=(0,a()._h)(o.JiraSyncedSettingsToSetupProjectsAndIssuesTooltip,(e=>e.JiraSyncedSettingsToSetupProjectsAndIssuesTooltip)),p=(0,a()._h)(o.JiraSyncSourceTooltip,(e=>e.JiraSyncSourceTooltip)),f=(0,a()._h)(o.JiraSyncInfoPopup,(e=>e.JiraSyncInfoPopup)),h=(0,a()._h)(o.ImproveJiraSyncPopup,(e=>e.ImproveJiraSyncPopup)),g=(0,a()._h)(o.ExternalImportAndSyncIndicator,(e=>e.ExternalImportAndSyncIndicator));(0,r(340498).xh)("jira",{default:{loader:()=>r.e(60677).then(r.bind(r,460677)),size:20},small:{loader:()=>r.e(60677).then(r.bind(r,460677)),size:16},mini:{loader:()=>r.e(60677).then(r.bind(r,460677)),size:14},large:{loader:()=>r.e(60677).then(r.bind(r,460677)),size:24}})},773582:(e,t,r)=>{r.d(t,{I:()=>o,O:()=>n});var a=()=>r(143197);function o(e){const{cursors:t,rootStore:r}=e,o={};for(const a of t)for(const e of a.stack)for(const t of e)o[t.id]=t.index;a().A.setLimitParents(r,o)}function n(e){a().A.removeLimitParents(e.rootStore)}},851240:(e,t,r)=>{r.d(t,{A:()=>H});r(16280),r(898992),r(354520),r(672577),r(430670),r(964979);var a=r.n(r(625473)),o=r(296540),n=()=>r(17022),c=()=>r(908006),i=()=>r(484714),s=()=>r(56366),l=()=>r(591779),d=()=>r(386164),u=()=>r(631616),p=()=>r(388821),f=()=>r(161479),h=()=>r(449412),g=()=>r(319625),m=()=>r(496603),S=()=>r(763824),k=()=>r(498212),y=()=>r(534177),C=()=>r(787172),R=()=>r(915086),v=()=>r(773582),M=()=>r(466721),P=()=>r(507785),_=()=>r(666144),b=()=>r(255460),I=()=>r(633457),w=()=>r(374026),A=()=>r(504836),O=()=>r(603815),T=()=>r(953418),J=()=>r(449506);var D=()=>r(303626),q=()=>r(367262),L=()=>r(865085),F=()=>r(53429),E=()=>r(495074),N=()=>r(695625),W=()=>r(792415),V=()=>r(351360),x=()=>r(227440),z=()=>r(508496),j=()=>r(83573),B=()=>r(961581),K=()=>r(606932),U=()=>r(865688);function $(e){performance.mark(`OPFS:useLoadPage:${e}`)}function G(e,t,r){return performance.measure(`OPFS:useLoadPage:${e}`,`OPFS:useLoadPage:${t}`,`OPFS:useLoadPage:${r}`)}let Y=!1;function H(e){return function(e){!function(e){const{pageStore:t,store:r}=e,{initialRequestCompleted:a,error:n}=(0,s().K8)((()=>({initialRequestCompleted:r.state.initialRequestCompleted,error:r.state.error})),[r]);(0,o.useEffect)((()=>{if(a&&!n)return E().A.trackPage(t),()=>{E().A.untrackPage(t)}}),[a,n,t])}(e);const{isCollectionInPage:t,updateIsCollectionInPage:r}=function(){const e=(0,i().v3)(),[t,r]=(0,o.useState)(!1),a=(0,o.useCallback)((r=>{var a;const{page:o,recordMap:n,inMemoryRecordCache:c}=r;if(t)return!0;const i=null===(a=c.getRecord({pointer:{table:"block",id:o.id,spaceId:o.spaceId},userId:e.currentUser.id}))||void 0===a?void 0:a.value;if(i)for(const e of n.getByTable("block")){var s,l,d;if(("collection_view"===(null===(s=e.value)||void 0===s||null===(s=s.value)||void 0===s?void 0:s.type)||"collection_view_page"===(null===(l=e.value)||void 0===l||null===(l=l.value)||void 0===l?void 0:l.type))&&i.parent_id!==(null===(d=e.value)||void 0===d||null===(d=d.value)||void 0===d?void 0:d.collection_id))return!0}return!1}),[e,t]);return{isCollectionInPage:t,updateIsCollectionInPage:(0,o.useCallback)((e=>{r(a(e))}),[a])}}(),a=(0,o.useRef)(null);(function(e){const{store:t,pageStore:r}=e,a=(0,i().v3)(),l=(0,i().Y0)(),f=(0,q().S)(),{loading:h,endOfResultsReached:m,initialRequestCompleted:k,error:v}=(0,s().K8)((()=>({loading:t.state.loading,endOfResultsReached:t.state.endOfResultsReached,initialRequestCompleted:t.state.initialRequestCompleted,error:t.state.error})),[t]),M=Q(e),P=function(e){const{initialChunkSize:t,pageStore:r}=e,a=(0,i().v3)(),n=(0,i().Y0)(),c=Z(e),s=X(e),l=Q(e);return(0,o.useCallback)((async e=>{const{diskMode:o}=e,i={page:{id:r.id,spaceId:r.getSpaceId()},limit:t,cursor:{stack:[]},verticalColumns:n.isMobile};try{return{firstPageChunkResult:await c({request:i,mode:"inMemoryOnly",isFirstChunk:!0})}}catch(v){}const u=function(e){const{environment:t,pageId:r}=e,a=window.__serverSidePrefetchData;if(a&&(delete window.__serverSidePrefetchData,a.pageId===r)){(0,C().s)({environment:t,eventName:"loadCachedPageChunkV2",response:a,userId:t.currentUser.id});const e=p().RecordMapWithRole.create(a.recordMap);return{source:"server",cursors:a.cursors,recordMap:e}}}({environment:a,pageId:r.id});if(u)return{firstPageChunkResult:u};const f=re(i),h=f?a.prefetchCache.getPrefetchStatus(f):void 0,g=Boolean(a.defaultRecordCache.persistedRecordCache)&&"success"!==h,m=new AbortController,S=new AbortController,k=[...g?[c({request:i,mode:o,isFirstChunk:!0,abortSignal:m.signal})]:[],s({request:i,headers:(0,d().WS)({recordId:r.id,spaceId:r.getSpaceId()}),abortSignal:S.signal})];l.concurrentlyWithAsyncRequests();const R=await Promise.any(k);return"local"===R.source?S.abort():"remote"===R.source||"remoteV2"===R.source||"server"===R.source?m.abort():(0,y().HB)(R),{firstPageChunkResult:R}}),[l,n.isMobile,t,c,s,r,a])}(e),b=function(e){const{pageStore:t,incrementChunkSize:r}=e,a=(0,i().Y0)(),n=Z(e),c=X(e),s=Q(e);return(0,o.useCallback)((async e=>{const{firstPageChunkResult:o,diskMode:i}=e,l=e=>(te(e)?e.cursors:[e.cursor]).filter((e=>e.stack.length>0));let u=l(o);for(;u.length>0;){u=(await S().lX(u,10,(async e=>{const l={page:{id:t.id,spaceId:t.getSpaceId()},limit:r,cursor:e,verticalColumns:a.isMobile};let u;try{u="local"===o.source?await n({request:l,mode:i,isFirstChunk:!1}):await c({request:l,headers:(0,d().WS)({cellId:"cellId"in e?e.cellId:void 0})})}catch(v){u=te(o)?{source:"remoteV2",cursors:[],recordMap:p().RecordMapWithRole.create({})}:"remote"===o.source?{source:o.source,cursor:{stack:[]},recordMap:p().RecordMapWithRole.create({})}:{source:o.source,localSource:o.localSource,cursor:{stack:[]},recordMap:p().RecordMapWithRole.create({})}}return s.afterEachChunk(u),u}))).flatMap((e=>l(e)))}}),[s,a.isMobile,r,n,c,t])}(e);if(h||m||k&&v)return;async function I(){var e;let o,n;if(t.setState({...t.state,loading:!0}),K().A.markRequestFirstChunkStart(),B().A.state.initialRenderCompleted||R().setSubMetric({name:"render_end_to_await_page_chunk_start",startTime:e=>{var t;return null===(t=e.render_start_to_render_end)||void 0===t?void 0:t.endTime},endTime:performance.now()}),f){if(!B().A.state.initialRenderCompleted&&L().z.initialPageRecordMapJSONPromise)try{$("readJSON.start");const e=await L().z.initialPageRecordMapJSONPromise;$("readJSON.end");const t=G("readJSON","readJSON.start","readJSON.end");$("createRecordMap.start");const r=p().RecordMapWithRole.create(e);$("createRecordMap.end");const a=G("createRecordMap","createRecordMap.start","createRecordMap.end");L().z.updateInitialMetricData({await_read_blocking_page_chunk_end_duration:t.duration,create_recordmap_duration:a.duration}),o={recordMap:r,source:"local",localSource:"opfs",cursor:{stack:[]}}}catch(v){}else if(a.currentUser.id)try{$("load-opfs-recordmap.start");const e=await async function(e,t){const{json:r}=await F().J.readJSON((0,u().$)(e,t)),a=p().RecordMapWithRole.create(r);if(a)return{source:"local",localSource:"opfs",cursor:{stack:[]},recordMap:a}}(a.currentUser.id,r.id);if(e&&e.recordMap){o={source:"local",localSource:"opfs",cursor:{stack:[]},recordMap:e.recordMap},$("load-opfs-recordmap.end");G("load-opfs-recordmap","load-opfs-recordmap.start","load-opfs-recordmap.end")}}catch(v){v instanceof DOMException&&v.name}if(o){$("setRecordMap.start"),await _()._O({environment:a,inMemoryRecordCache:a.defaultRecordCache.inMemoryRecordCache,recordMap:o.recordMap,debugSource:"PageLoadingContainer.OPFSRecordMap"}),$("setRecordMap.end");const e=G("setRecordMap","setRecordMap.start","setRecordMap.end");L().z.updateInitialMetricData({set_recordmap_duration:e.duration})}}if(n=null!==(e=a.defaultRecordCache.persistedRecordCache)&&void 0!==e&&e.deviceSupportsLoadPageChunk()&&z().default.checkGate({gateName:"load_page_chunk_in_web_worker"})?"diskCacheOnlyInWebWorker":l.isAndroid?"inMemoryAndDiskCache":"inMemoryAndDiskCacheWithInexactPreload",!o)try{o=(await P({diskMode:n})).firstPageChunkResult}catch(v){return void O(v)}if(!B().A.state.initialRenderCompleted){R().setSubMetric({name:"await_page_chunk_start_to_await_page_chunk_end",startTime:e=>{var t;return null===(t=e.render_end_to_await_page_chunk_start)||void 0===t?void 0:t.endTime},endTime:performance.now()}),"local"===o.source&&"opfs"===o.localSource&&L().z.IPRMetricData&&R().updateOPFSMetricData(L().z.IPRMetricData);const e=a.prefetchCache;R().updateMetricData({page_chunk_source:o.source,local_source:"local"===o.source?o.localSource:void 0,page_chunk_prefetch:"server"===o.source?{type:"hit-server"}:e.getPrefetchAnalytic(`loadCachedPageChunk(${r.id})`)})}K().A.markRequestFirstChunkEnd({chunkSource:o.source,chunkDiskMode:"local"===o.source&&"disk"===o.localSource?n:void 0}),w(),z().default.checkGate({gateName:"load_page_flush"})?await c().default.flush():await c().default.afterNextFlush(),M.afterEachChunk(o);const i=b({firstPageChunkResult:o,diskMode:"diskCacheOnlyInWebWorker"===n?"diskCacheOnlyInWebWorker":"inMemoryAndDiskCache"});try{await i}catch(v){return void O(v)}A(),M.afterAllChunks()}function w(){t.setState({...t.state,initialRequestCompleted:!0})}function A(){t.setState({initialRequestCompleted:!0,ready:!0,loading:!1,endOfResultsReached:!0,error:void 0})}function O(e){t.setState({ready:!0,initialRequestCompleted:!0,loading:!1,endOfResultsReached:!1,error:(0,g().A)(e)})}n().A.withListenerIgnored((()=>{I()}))})({...e,updateIsCollectionInPage:r,scrollerRef:a}),function(e){const{store:t,scrollToBlockIds:r,onReady:a,onDone:n,pageStore:i}=e;(0,o.useEffect)((()=>{let e;const o=m().Oo((()=>{r&&a&&(e=async function(e,t){e&&await b().NH(t,e)}(r,i))})),s=m().Oo((()=>{a&&c().default.afterNextFlush((()=>{c().default.afterNextFlush((async()=>{if(e){const t=performance.now();await(0,S().Vq)(e,5e3),B().A.state.initialRenderCompleted||R().updateMetricData({scroll_to_blocks_wait_time:performance.now()-t})}a()}))}))})),l=m().Oo((()=>{null==n||n()})),d=()=>{t.state.loading&&o(),t.state.ready&&s(),(t.state.endOfResultsReached||t.state.error)&&l()};return t.addListener(d),()=>{t.removeListener(d)}}),[n,a,i,r,t])}(e),function(e){const{store:t}=e,r=(0,s().K8)((()=>t.state.error),[t]),a=(0,s().K8)((()=>x().A.state.online),[]),n=(0,l().ZC)(a),c=void 0!==n&&(a&&!n);(0,o.useEffect)((()=>{c&&r&&t.reset()}),[c,t,r])}(e),function(){const e=(0,i().v3)(),t=(0,s().K8)((()=>{var e;return null===(e=V().default.state.mainEditorCurrentBlockStore)||void 0===e?void 0:e.id}),[]),r=(0,s().K8)((()=>V().default.state.currentUserRootStore),[]),a=(0,s().K8)((()=>x().A.state.online),[]),n=(0,l().ZC)(a),c=void 0!==n&&(a&&!n);(0,o.useEffect)((()=>{async function a(){const{route:a}=e.RouterStore.state,o=await P().Ty({environment:e,request:{...a,type:"block-space",blockId:t,spaceId:"spaceId"in a?a.spaceId:void 0,slug:"slug"in a?a.slug:void 0,spaceDomain:"spaceDomain"in a?a.spaceDomain:void 0,requestedOnPublicDomain:"requestedOnPublicDomain"in a?a.requestedOnPublicDomain:void 0,isBot:!1}});if("failed"===o.type)return;const n=o.data;if(W().A.setState({publicPageData:n}),n.spaceId&&r){const e=r.getSpaceViewStores().find((e=>e.getSpaceId()===n.spaceId));e&&V().default.setState({...V().default.state,currentSpaceStore:e.getSpaceStore(),currentSpaceViewStore:e})}}c&&t&&a()}),[c,e,t,r])}();const{store:f}=e;return{...(0,s().K8)((()=>({ready:f.state.ready,error:f.state.error,initialRequestCompleted:f.state.initialRequestCompleted,endOfResultsReached:f.state.endOfResultsReached})),[f]),isCollectionInPage:t,scrollerRef:a}}({...e,store:(0,s().uB)(e.store,U().A)})}function X(e){const{pageStore:t}=e,r=(0,i().v3)();return(0,o.useCallback)((async e=>{const{request:a,headers:o,abortSignal:n}=e,c=O().JQ(t),i=await O().Vn({environment:r,request:{...a,...c?{omitExistingRecordVersions:c}:{}},abortSignal:n,prefetchCacheKey:re(a),headers:o});if(null!=n&&n.aborted)throw new Error("Abort signal received");if("success"===i.type){return{recordMap:p().RecordMapWithRole.create(i.data.recordMap),cursors:i.data.cursors,source:"remoteV2"}}throw h().O8(i.error,{from:"useLoadRemotePageChunk",type:"pageLoadingError",data:{pageId:t.id,miscDataToConvertToString:{offline:i.offline,status:i.status,body:i.body}}}),new Error("No successful load result found.")}),[r,t])}function Z(e){const{pageStore:t}=e,r=(0,i().v3)();return(0,o.useCallback)((async e=>{const{request:a,mode:o,isFirstChunk:n,abortSignal:c}=e,i=await D().N.measure("localLoadPageChunk",a.page.id,(()=>O().s4({mode:o,environment:r,request:a,isFirstChunk:n,abortSignal:c})));if(null!=c&&c.aborted)throw new Error("Abort signal received");const s=p().RecordMapWithRole.create(i.recordMap);return _()._O({environment:r,inMemoryRecordCache:t.inMemoryRecordCache,recordMap:s,debugSource:"PageLoadingContainer.performLocalLoadPageChunk"}),{source:"local",localSource:"inMemoryOnly"===o?"memory":"disk",cursor:i.cursor,recordMap:s}}),[r,t])}function Q(e){const{pageStore:t,store:r,scrollToDiscussionId:a,scrollerRef:n,scrollToPosition:s,scrollToBlockIds:l,updateIsCollectionInPage:d,pageVisitStore:u,disableSideEffects:p}=e,f=(0,i().v3)(),h=(0,o.useCallback)((()=>{p||(z().default.checkGate({gateName:"fetch_backlinks_after_page_load"})||ee({environment:f,blockPointer:t.pointer}),M().Ds(f,{blockStore:t,pageVisitStore:u,incremental:!1}).catch((()=>{})))}),[p,f,t,u]),g=(0,o.useCallback)((e=>{if(p)return;const o=te(e)?e.cursors:[e.cursor];var i,u;0===(i=o).length||1===i.length&&(!(u=i[0])||0===u.stack.length)||c().default.afterNextFlush((()=>{if(r.state.ready)return;const e=!a||(t=a,Boolean((0,w().V)({discussionId:t})));var t;const o=!0===function(e){const{scrollerRef:t,scrollToPosition:r}=e;if(null===t.current)return;const a=(0,T().NM)(t.current);return!a||!m().Et(r)||r<=a.scrollHeight-a.clientHeight}({scrollerRef:n,scrollToPosition:s})&&function(e){return!e||N().T.findSelectablesFromIds(e).length===e.length}(l)&&e;o&&r.setState({...r.state,ready:!0})})),d({page:{id:t.id,spaceId:t.getSpaceId()},recordMap:e.recordMap,inMemoryRecordCache:t.inMemoryRecordCache}),f.currentUser.isLoggedIn()&&(j().A.addFromRecordMapWithRole(e.recordMap),j().A.isEmpty()||I().lK({environment:f})),v().I({rootStore:t,cursors:o})}),[p,f,t,l,a,s,n,r,d]),S=(0,o.useCallback)((()=>{p||(z().default.checkGate({gateName:"fetch_backlinks_after_page_load"})&&"personal_home_page"!==t.getType()&&ee({environment:f,blockPointer:t.pointer}),f.currentUser.isLoggedIn()&&(0,A().Yq)(t)&&async function(e,t){await J().callApi({eventName:"resyncJiraCollection",environment:e,data:{pagePointer:t}})}(f,t.pointer))}),[p,f,t]);return(0,o.useMemo)((()=>({concurrentlyWithAsyncRequests:h,afterEachChunk:g,afterAllChunks:S})),[h,g,S])}async function ee(e){const{blockPointer:t,environment:r}=e;r.LocalBacklinkStore.initializeBacklinks({block:{id:t.id,spaceId:(0,f().e)(t.spaceId)},currentUserId:r.currentUser.id,environment:r});try{await r.LocalBacklinkStore.awaitLoaded(t.id)}catch(a){}}function te(e){return"remoteV2"===e.source||"server"===e.source}function re(e){if(function(e){return!e.cursor||0===e.cursor.stack.length}(e))return`loadCachedPageChunk(${e.page.id})`;{const t=(0,k().gB)(a()(e.cursor));return`loadCachedPageChunk(${e.page.id})-${t}`}}(0,r(604341).exposeDebugValue)("toggleLogLocalPageLoadFailures",(()=>{Y=!Y,console.info(Y?"Local page load error logging enabled":"Local page load error logging disabled")}))}}]);