(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[96345],{24279:(e,t,r)=>{"use strict";r.d(t,{XO:()=>s,aR:()=>d,b1:()=>c,h7:()=>l,kO:()=>p,ox:()=>u,wc:()=>i,y8:()=>m});r(16280),r(898992),r(672577),r(430670);var n=()=>r(534177),o=()=>r(706461),a=()=>r(754093);(0,n().u0)((e=>"context"===e.type?{true:e}:{false:e}));const i=(0,n().u0)((e=>"instructions"===e.type?{true:e}:{false:e})),s=(0,n().u0)((e=>"observation"===e.type&&"error"===e.observationType?{true:e}:{false:e})),l=((0,n().u0)((e=>"observation"===e.type&&"warning"===e.observationType?{true:e}:{false:e})),(0,n().u0)((e=>"observation"===e.type&&"page"===e.observationType?{true:e}:{false:e})),(0,n().u0)((e=>"observation"===e.type&&"search"===e.observationType?{true:e}:{false:e})));(0,n().u0)((e=>"observation"===e.type&&"database"===e.observationType?{true:e}:{false:e})),(0,n().u0)((e=>"observation"===e.type&&"queryDatabase"===e.observationType?{true:e}:{false:e})),(0,n().u0)((e=>"observation"===e.type&&"pagesFromQueryDatabase"===e.observationType?{true:e}:{false:e}));function d(e){const t=new Error(e.value);return e.stack&&(t.stack=e.stack),t}const c=(0,n().u0)((e=>"assistant"===e.type?{true:e}:{false:e})),u=(0,n().u0)((e=>"human"===e.type?{true:e}:{false:e}));function p(e){return"observation"===e.type&&"attachment"===e.observationType}function m(e){const t=(0,a().BD)(e.value.summary.value)[0];if(!t||"element"!==t.type)return"invalid summary node";const r=e.value.pages.flatMap((e=>(0,a().BD)(e.value))),n={...t,children:[...t.children??[],...r]};return(0,o()._o)(n)}},33642:(e,t,r)=>{"use strict";r.d(t,{YL:()=>o,qO:()=>n});const n=10,o=10},90612:(e,t,r)=>{"use strict";r.d(t,{Ay:()=>F,fQ:()=>P,mD:()=>R,sg:()=>O});r(944114),r(898992),r(354520),r(672577),r(803949),r(581454);var n=r(296540),o=()=>r(484714),a=()=>r(56366),i=()=>r(584262),s=()=>r(178901),l=()=>r(245241),d=()=>r(959013),c=()=>r(496603),u=()=>r(534177),p=()=>r(284371),m=()=>r(824188),h=()=>r(839752),g=()=>r(260488),f=()=>r(825972),y=()=>r(437622),b=()=>r(645873),v=()=>r(869562),x=()=>r(351360),k=()=>r(430483),w=()=>r(948914),S=()=>r(982254),I=()=>r(968172),T=()=>r(712505),C=()=>r(899677),N=()=>r(939740),M=()=>r(89924),_=()=>r(896278),B=()=>r(379819),A=()=>r(913441),j=r(474848);function P(e){const{environment:t,offsetFromBottom:r,spaceId:n,setIsLoadingRecents:o,setEndOfRecentsReached:a,numRecents:i,setNumRecents:s,endOfRecentsReached:l,isLoadingRecents:d,incrementBy:u=50}=e;if(r>200||d||l)return;const p=I().A.getWithoutSubscribing(n),h=p[p.length-1],g=null==h?void 0:h.visitedAt;if(!g)return;const y=c().nF((async()=>{const e=t.currentUser.id;if(!e||!g)return;o(!0);const r=await m().loadMoreRecentPages(g,{environment:t,userId:e,spaceId:n});o(!1),r||a(!0)}),300);if((0,f().Dd)()){const e=f().NK.state.length,t=Math.min(i+u,e);s(t),a(t>=e)}else y()}function R(e){const{environment:t,isNewElectronTab:r,electronTabs:n,intl:o}=e,a=o.formatMessage({id:"searchDefaultBody.searchActionMenuItem.newPage",defaultMessage:"Create a new page"});return(0,_().g)({environment:t,queryId:void 0,desktopProps:{isNewElectronTabSearch:Boolean(r),electronTabs:n},action:()=>{g().st({environment:t,reset:!1})},result:{type:"client_action",eventName:"tab_new_page",value:{icon:s().j,title:a,behavior:"action",aliases:void 0,caption:void 0,action:()=>{const e=i().y8.SearchTabs;(async()=>{var r;const o=await(0,v().quickAddPage)({environment:t,from:"electron_new_tab_search",pageVisitSource:e,navigateOnCreate:!1});o&&(await(null===(r=t.defaultRecordCache.persistedRecordCache)||void 0===r?void 0:r.flushPendingWrites()),h().q9({environment:t,pageVisitSource:e,openInNew:void 0,electronTabSearch:{tabs:n,isNewTab:!0},searchResult:{type:"custom",store:o},queryId:void 0,context:"new_page"}))})()}}}})}function E(e,t){return{store:e,id:e.id,score:-1,spaceId:e.getSpaceId(),sources:[l().Ni.Local],featureGroups:[],originalPosition:t,serverEventProperties:void 0}}function O(e){let{bucket:t}=e;switch(t){case"today":return(0,j.jsx)(d().sA,{id:"search.recentPagesTimeBuckets.today.text",defaultMessage:"Today"});case"yesterday":return(0,j.jsx)(d().sA,{id:"search.recentPagesTimeBuckets.yesterday.text",defaultMessage:"Yesterday"});case"past_week":return(0,j.jsx)(d().sA,{id:"search.recentPagesTimeBuckets.pastWeek.text",defaultMessage:"Past week"});case"past_30_days":return(0,j.jsx)(d().sA,{id:"search.recentPagesTimeBuckets.past30Days.text",defaultMessage:"Past 30 days"});case"older":return(0,j.jsx)(d().sA,{id:"search.recentPagesTimeBuckets.older.text",defaultMessage:"Older"})}(0,u().HB)(t)}const F=function(e){var t;const{onSelect:i,spaceId:s,extraTopPadding:l,comboboxProps:c}=e,[m,v]=n.useState(!1),[I,F]=n.useState(!1),L=(0,a().K8)((()=>(0,f().Dd)()?30:-1),[]),[D,q]=n.useState(L),K=(0,a().uB)(void 0,r(970585).A),{section:U,indexLocal:H,indexGlobal:$}=(0,a().K8)((()=>K.state.focus),[K]),V=(0,o().v3)(),z=(0,d().tz)(),W=(0,o().Y0)(),Q=(0,a().K8)((()=>r(227440).A.state.online&&k().zD.shouldShowSearchMenuItemAskAI(W)),[W]),G=(0,r(401497).IS)((e=>({wrapper:{paddingTop:l||!Q?8:4,width:"100%",height:"100%",overflowX:"hidden",overflowY:"auto",paddingLeft:4,paddingRight:4},sectionHeader:{marginBottom:8},section:{marginBottom:4},notionAiLabel:{lineHeight:"20px",fontSize:14,textOverflow:"ellipsis",overflow:"hidden",display:"block",fontWeight:p().Wy.medium},notionAiIcon:{fill:e.icon.primary,overflow:"visible",marginRight:0,height:20,width:20,display:"grid",placeItems:"center"},menuItemLabel:{lineHeight:"20px",fontSize:14,fontWeight:p().Wy.medium}})),[l,Q]),{setDefaultBodyFocusedResult:Z,isQuickSearch:Y}=(0,n.useContext)(r(307060).SearchStaticContext),X=(0,a().K8)((()=>{const e=T().default.state,t=T().default.isCenterPeekOpen()||r(502438).default.isInPeekRenderer();return e.open&&(t||e.isOpening)?e.targetStore:x().default.state.mainEditorCurrentBlockStore}),[]),J=(0,a().K8)((()=>{const e=f().NK.state.filter((e=>e.pageId!==(null==X?void 0:X.id)));return D>0?e.slice(0,D):e}),[null==X?void 0:X.id,D]),ee=(0,a().K8)((()=>{const{currentUserSettingsStore:e,currentSpaceStore:t,mainEditorCurrentBlockStore:r}=x().default.state;return!!(t&&r&&r.canRead())&&k().zD.isQnATooltipsVisible(V.device,e)}),[V.device]);(0,n.useEffect)((()=>()=>{Z(void 0)}),[Z]);const te=(0,n.useRef)(null),{value:re}=(0,b().fJ)(r(650829).assistantDependency),ne=(0,a().K8)((()=>C().default.state.isNewElectronTab),[]),oe=(0,a().K8)((()=>S().A.state.tabs),[]),ae=(0,a().K8)((()=>k().zD.isDeepFindEnabled()),[]),ie=(0,a().K8)((()=>{var e;const t=[];Q&&t.push({key:"actionMenuItem.assistant",action:e=>{const{currentUserSettingsStore:t}=x().default.state;t&&(0,r(576590).setQnaOnboardingPhase)(V,{phase:"complete",transactionUserAction:"AiQnaIntroModal.debug.clickTooltipClose",userSettingsStore:t}),g().sv({environment:V,shouldResetAssistantStore:r(295169).default.wasActiveSessionLastOpenedOutsideOfHistorySavedWindow(),quickSearchMode:Y,device:W,event:e.event,from:Y?"command_search_switching_panes":"search_switching_panes"}),null==re||re.assistantActions.updateAssistantTimestampsAfterSessionInitialization({environment:V})},render:e=>{const t=null==X?void 0:X.getSpaceStore(),n=t?(0,y().GK)(V,t):void 0,o=(0,j.jsx)("div",{className:"notranslate",style:G.notionAiLabel,children:ae?(0,j.jsx)(d().sA,{id:"searchResultsBody.askAiMenuItem.deepFindTitle",defaultMessage:"Open search in full page"}):(0,j.jsx)(j.Fragment,{children:n?(0,j.jsx)(d().sA,{id:"searchDefaultBody.searchActionMenuItem.askAiInSpace",defaultMessage:"Ask AI in {spaceName}",values:{spaceName:n}}):(0,j.jsx)(d().sA,{id:"searchDefaultBody.searchActionMenuItem.askNotionAi",defaultMessage:"Ask Notion AI about..."})})});return ee?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(r(332390).oG,{origin:te}),(0,j.jsx)(B().A,{type:"assistant",...e,blueOutlineFocused:!0,ref:te,title:o})]}):(0,j.jsx)(B().A,{type:"assistant",...e,title:o})}});const n=null===(e=w().A.state.preferences)||void 0===e?void 0:e.isNewTabSearchEnabled;if(ne&&n){const e=R({environment:V,isNewElectronTab:ne,electronTabs:oe,intl:z});t.push(e)}return t}),[Q,ne,V,Y,W,null==re?void 0:re.assistantActions,X,G.notionAiLabel,ae,ee,z,oe]),se=(0,a().K8)((()=>{var e;const t=W.isElectron&&(null===(e=w().A.state.preferences)||void 0===e?void 0:e.isNewTabSearchEnabled)&&S().A.getState().tabs,n=C().default.state.isNewElectronTab,{currentSpaceStore:o}=x().default.state;if(!o||!t||!n)return[];return t.slice(0,4).map(((e,t)=>{let n;if(e.pageId){var a;const s=(null===(a=J.find((t=>{let{pageId:r}=t;return e.pageId===r})))||void 0===a?void 0:a.store)??r(630116).Bv.createChildStore(o,{table:r(179034).ev,id:e.pageId});n={key:`${s.id}:${e.id}`,action:e=>i({index:{local:e.indexLocal,global:e.index},event:e.event,selectedResult:E(s,t),fromSidePeekPanel:!1,additionalResultsCount:ie.length,context:"tabs"}),render:e=>(0,j.jsx)(A().GC,{...e,inline:!0,store:s,hidePath:!1,buttonStyle:{paddingLeft:1},type:"tabs"})}}else if("chat"===e.type){const t=(0,j.jsx)("div",{style:{...G.menuItemLabel,marginLeft:2},children:(0,j.jsx)(d().sA,{id:"searchDefaultBody.searchTabMenuItem.notionAI",defaultMessage:"Notion AI"})});n={key:e.id,action:t=>h().HI({tabId:e.id,url:r(427704).JZ.chat,event:t.event,environment:V}),render:e=>(0,j.jsx)(B().A,{type:"assistant",...e,title:t})}}return n})).filter(u().O9)}),[W.isElectron,i,ie.length,J,G.menuItemLabel,V]),le=(0,a().K8)((()=>{const e={};return J.forEach((t=>{let{pageId:r,visitedAt:n}=t;return e[r]=n})),e}),[J]),de=(0,a().K8)((()=>{const e=new Map;return J.map(((t,r)=>{const n=f().ht(t.visitedAt),o="today"!==n&&"yesterday"!==n,a={key:`${t.store.id}:${r}`,action:e=>i({index:{local:e.indexLocal,global:e.index},event:e.event,selectedResult:E(t.store,r),fromSidePeekPanel:!1,additionalResultsCount:ie.length+se.length,context:"recent_pages"}),render:e=>(0,j.jsx)(A().GC,{...e,inline:!W.isMobile,store:t.store,hidePath:!1,lastViewed:o?le[t.store.id]:void 0,buttonStyle:{paddingLeft:1},type:"recent_pages"})},s={result:a,store:t.store};var l;e.has(n)?null===(l=e.get(n))||void 0===l||l.push(s):e.set(n,[s])})),e}),[ie.length,W.isMobile,J,i,le,se.length]),ce=(0,b().fJ)(r(601734).Aw),ue=(0,a().K8)((()=>(0,y().p3)().function),[]),pe=(0,a().K8)((()=>{var e;const t=null===(e=ce.value)||void 0===e?void 0:e.templatePickerItems.getSuggestedTemplatesForSearch({persona:ue,environment:V}).slice(0,3);return null==t?void 0:t.map(((e,t)=>(0,_().g)({environment:V,queryId:void 0,desktopProps:{isNewElectronTabSearch:Boolean(ne),electronTabs:oe},action:()=>{g().st({environment:V,reset:!1})},result:{type:"client_action",eventName:"new_user_template",value:{icon:()=>(0,j.jsx)("div",{children:e.icon}),title:e.name,behavior:"action",aliases:void 0,caption:void 0,action:()=>e.onClick()}}})))}),[null===(t=ce.value)||void 0===t?void 0:t.templatePickerItems,ue,V,ne,oe]),me=(0,a().K8)((()=>{const e=[];ie.length>0&&e.push({key:"actions",items:ie,render:e=>(0,j.jsx)(M().A,{title:ae?void 0:"Actions",desktopTitleStyle:G.sectionHeader,style:G.section,children:e.children})}),se.length>0&&e.push({key:"tabs",items:se,render:e=>(0,j.jsx)(M().A,{title:"Tabs",desktopTitleStyle:G.sectionHeader,style:G.section,children:e.children})});for(const[t,r]of de.entries()){const n={key:t,items:r.map((e=>e.result)),render:e=>(0,j.jsx)(M().A,{title:(0,j.jsx)(O,{bucket:t}),desktopTitleStyle:G.sectionHeader,style:{...G.section},children:e.children})};e.push(n)}return!Y&&pe&&pe.length>0&&e.push({key:"templates",items:pe,render:e=>(0,j.jsx)(M().A,{title:(0,j.jsx)(d().sA,{id:"search.templateSuggestions.header",defaultMessage:"Start with a template"}),desktopTitleStyle:G.sectionHeader,style:G.section,children:e.children})}),e}),[ie,se,Y,pe,ae,G.sectionHeader,G.section,de]),he=(0,n.useCallback)((e=>P({environment:V,offsetFromBottom:e,spaceId:s,setIsLoadingRecents:v,setEndOfRecentsReached:F,numRecents:D,setNumRecents:q,endOfRecentsReached:I,isLoadingRecents:m})),[I,V,m,D,s]);(0,n.useEffect)((()=>{var e;if(void 0===U||void 0===H||void 0===$)return;const t=null===(e=me[U])||void 0===e?void 0:e.key;if(t&&"string"==typeof t)if("actions"===t)Z({type:"assistant"});else if(f().Rj.includes(t)){var r;const e=null===(r=de.get(t))||void 0===r||null===(r=r[H])||void 0===r?void 0:r.store;e&&Z({type:"page_result",value:{index:{local:{indexLocal:H,section:U},global:$},selectedResult:E(e,$-ie.length)}})}}),[ie.length,Z,$,U,H,de,me]);const ge=(0,a().K8)((()=>ie.length),[ie.length]),fe=!W.isMobile&&J.length>0;return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)("div",{style:G.wrapper,children:[(0,j.jsx)(N().Ay,{store:K,type:N().Oh.Vertical,initialFocus:ge,disableKeyboardArrowWrap:!0,sections:me,unfocusOnScroll:!0,comboboxProps:c}),(0,j.jsx)(r(228927).A,{onChange:he})]}),fe&&(0,j.jsx)(r(482173).A,{title:(0,j.jsx)(r(507552).A,{})})]})}},160907:(e,t,r)=>{"use strict";r.d(t,{f:()=>a});var n=()=>r(351360),o=()=>r(712505);function a(){if(o().default.state.open)return o().default.state.targetStore;return n().default.state.mainEditorCurrentBlockStore??n().default.state.currentSpaceStore}},162278:(e,t,r)=>{"use strict";r.d(t,{V8:()=>k,st:()=>x,vj:()=>w});r(18107),r(944114),r(967357),r(898992),r(823215),r(354520),r(581454),r(737550);var n=()=>r(496603),o=()=>r(973647),a=()=>r(534177),i=()=>r(251582),s=()=>r(181856),l=()=>r(252050),d=()=>r(228803),c=()=>r(525704),u=()=>r(233364),p=()=>r(491810),m=()=>r(331119);function h(e){return i().p.mapResult((0,m().U5)("table"),(t=>{const r=(0,m().ke)({inputAttributes:t.attributes,definitions:{id:{required:!1,values:!0,mappingMode:"block_counter"}},tagName:t.tagName,validateRequiredAttributes:!1,mapCounterToKey:e.mapCounterToKey});if(o().Q.isFail(r))return r;const a=y(e,t.tagName,r.value);if(o().Q.isFail(a))return a;const s=a.value,l=(0,i().$d)((0,m().nx)(t.tagName,[f(e)]),t.children??[]);if(o().Q.isFail(l))return l;const d=Math.max(...l.value.map((e=>Object.keys(e.node.properties).length))),c=l.value.map((e=>{const t=Object.keys(e.node.properties).length;return t<d?{...e.node,properties:Object.fromEntries([...Object.entries(e.node.properties),...n().y1(t,d).map((e=>{const t=(e+1).toString();return[t,{tagName:"property-text",type:"property",attributes:{name:t},children:[]}]}))])}:e.node}));return{value:{tagName:"table",type:"block",attributes:{id:s,...l.value.length>0&&l.value.every((e=>e.firstChildIsHeader))?{"header-row":"true"}:{},...l.value.length>0&&l.value[0].allChildrenAreHeaders?{"header-column":"true"}:{}},persisted:e.persisted,text:[],children:c,properties:{},schemas:{},hasUncited:!1}}}))}function g(e){return i().p.mapResult(i().p.choice([(0,m().U5)("th"),(0,m().U5)("td")]),(t=>{const r=(0,i().$d)((0,m().nx)(t.tagName,[(0,d().Et)({inlineNodesAllowed:l().qI,textAllowed:!0,parentTagName:t.tagName,mapCounterToKey:e.mapCounterToKey})]),t.children??[]);return o().Q.isFail(r)?r:{value:{text:r.value,isHeader:"th"===t.tagName}}}))}function f(e){return i().p.mapResult((0,m().U5)("tr"),(t=>{var r;const n=(0,m().ke)({inputAttributes:t.attributes,definitions:{id:{required:!1,values:!0,mappingMode:"block_counter"}},tagName:t.tagName,validateRequiredAttributes:!1,mapCounterToKey:e.mapCounterToKey});if(o().Q.isFail(n))return n;const a=y(e,t.tagName,n.value);if(o().Q.isFail(a))return a;const s=a.value,l=(0,i().$d)((0,m().nx)(t.tagName,[g(e)]),t.children??[]);if(o().Q.isFail(l))return l;return{value:{node:{tagName:"tr",type:"block",attributes:{id:s},persisted:e.persisted,text:[],children:[],properties:Object.fromEntries(l.value.map(((e,t)=>{const r=(t+1).toString();return[r,{tagName:"property-text",type:"property",attributes:{name:r},children:e.text}]}))),schemas:{},hasUncited:!1},allChildrenAreHeaders:l.value.every((e=>e.isHeader)),firstChildIsHeader:Boolean(null===(r=l.value.at(0))||void 0===r?void 0:r.isHeader)}}}))}function y(e,t,r){return e.persisted?r.id?{value:r.id}:{error:new(s().oN)}:"unknown-block"===t?r.id?{value:r.id}:{error:new(s().N8)}:r.id?{error:new(s().oS)}:{value:e.allocateIdFn()}}function b(e){const t=(0,a().s8)(l().sA,((r,n)=>{const g=function(e,t,r){const n=l().sA[e],{allowMove:h,allowUncited:g,persisted:f,mapCounterToKey:b}=t;let k=(0,m().U5)(e);return"page"===e&&(k=i().p.choice([k,(0,m().U5)("instructions-page")])),i().p.mapResult(k,(k=>{const w=(0,m().ke)({inputAttributes:k.attributes,definitions:{...n.attributes,id:{required:!1,values:!0,mappingMode:"block_counter"}},tagName:e,validateRequiredAttributes:!1,mapCounterToKey:b});if(o().Q.isFail(w))return w;if("synced-block-reference"===e&&!f&&k.children&&k.children.length>0)return{error:new(s().w5)};const S=y(t,e,w.value);if(o().Q.isFail(S))return S;const I=S.value,T=[];n.title&&T.push((0,d().Et)({inlineNodesAllowed:l().qI,textAllowed:!0,parentTagName:e,mapCounterToKey:b}));const C=n.schemas.map((e=>`schema-${e}`)),N=(0,p().D)({mapCounterToKey:b});T.push(...(0,a().WP)(N).filter((e=>{let[t]=e;return C.includes(t)})).map((e=>{let[,t]=e;return t}))),T.push(h?(0,c().Y)({mapCounterToKey:b}):v),g&&T.push(x());const M=[...n.properties];T.push(...(0,a().WP)((0,u().x)({mapCounterToKey:b})).filter((e=>{let[t]=e;return(0,a().Xk)(M,t)})).map((e=>{let[,t]=e;return t})));for(const e of n.content)T.push(r(e));const _=(0,i().$d)((0,m().nx)(e,T),k.children??[]);if(o().Q.isFail(_))return _;const B=_.value.some((e=>"uncited"===e.type)),A=_.value.filter((e=>"uncited"!==e.type)),j=(0,m().t7)([["inline or text node",(0,a().u0)((e=>"text"===e.type||"inline"===e.type?{true:e}:{false:e}))],["property node",(0,a().u0)((e=>"property"===e.type?{true:e}:{false:e}))],["schema node",(0,a().u0)((e=>"schema"===e.type?{true:e}:{false:e}))],["block node",(0,a().u0)((e=>"block"===e.type||"move"===e.type?{true:e}:{false:e}))]],A);if(o().Q.isFail(j))return{error:new(s().SX)({foundNodeType:j.error.incorrectLabel,incorrectlyAfterType:j.error.lastLabel})};const[P,R,E,O]=j.value;if("tr"===e)for(const e of R)if(!/^-?\d+$/.test(e.attributes.name))return{error:new(s().dO)};return{value:{type:"block",tagName:e,attributes:{...w.value,id:I},persisted:f,text:P,children:O,properties:Object.fromEntries(R.map((e=>[e.attributes.name,e]))),schemas:Object.fromEntries(E.map((e=>[e.attributes.name,e]))),hasUncited:B}}}))}(n,e,(e=>t[e]));return"table"===n?i().p.choice([i().p.try(g),h(e)]):"tr"===n?i().p.choice([i().p.try(g),i().p.map(f(e),(e=>e.node))]):g}));return t}const v=i().p.mapResult((0,m().U5)("move"),(()=>({error:new(s().Qv)})));function x(){return i().p.mapResult((0,m().U5)("uncited"),(e=>({value:{type:"uncited"}})))}function k(e){return i().p.choice([...Object.values(b(e)),...e.allowMove?[]:[v],i().p.fail((e=>new(s().yc)({nodeType:"block",unexpectedNode:n().$1(e)})))])}function w(e){return i().p.choice([...Object.values(b(e)),(0,c().Y)({mapCounterToKey:e.persisted?void 0:e.mapCounterToKey}),i().p.fail((e=>new(s().yc)({nodeType:"block",unexpectedNode:n().$1(e)})))])}},178901:(e,t,r)=>{"use strict";r.d(t,{j:()=>o});r(296540);var n=r(474848);const o=(0,r(340498).wt)("createPage",{viewBox:"0 0 24 24",svg:(0,n.jsx)("g",{children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M9.944 14.721c.104.094.216.12.336.079l1.703-.688 6.844-6.844-1.406-1.398-6.836 6.836-.711 1.68c-.052.13-.029.242.07.335zm8.102-9.484l1.414 1.406.515-.523a.917.917 0 00.282-.633.76.76 0 00-.258-.61l-.25-.25a.702.702 0 00-.578-.187.975.975 0 00-.617.297l-.508.5zm-9.453.127a3.85 3.85 0 00-3.85 3.85v6.5a3.85 3.85 0 003.85 3.85h6.5a3.85 3.85 0 003.85-3.85V12.95a.85.85 0 10-1.7 0v2.764a2.15 2.15 0 01-2.15 2.15h-6.5a2.15 2.15 0 01-2.15-2.15v-6.5a2.15 2.15 0 012.15-2.15h3.395a.85.85 0 000-1.7H8.593z",clipRule:"evenodd"})})})},198427:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});r(296540);var n=()=>r(484714),o=()=>r(401497),a=r(474848);function i(){(0,n().v3)(),(0,o().IS)((e=>({container:{margin:"8px 16px",background:e.accentColors.yellow[100],borderRadius:8,height:"fit-content"}})),[]);return(0,a.jsx)(a.Fragment,{})}},233364:(e,t,r)=>{"use strict";r.d(t,{Q:()=>m,x:()=>p});r(898992),r(354520);var n=()=>r(496603),o=()=>r(973647),a=()=>r(534177),i=()=>r(251582),s=()=>r(181856),l=()=>r(252050),d=()=>r(147427),c=()=>r(228803),u=()=>r(331119);function p(e){return(0,a().s8)(l().GU,((t,r)=>function(e,t){const r=l().GU[e],{mapCounterToKey:n}=t;return i().p.mapResult((0,u().U5)(e),(t=>{const a=(0,u().ke)({inputAttributes:t.attributes,definitions:{...r.attributes,name:{required:!0,values:!0}},tagName:e,mapCounterToKey:n});if(o().Q.isFail(a))return a;let s=t.children??[];r.text||(s=s.filter((e=>!(0,d().A)(e))));const l=(0,i().$d)(i().p.manyTill((0,c().Et)({inlineNodesAllowed:r.inline,textAllowed:r.text,parentTagName:e,mapCounterToKey:n}),i().p.eof()),s);if(o().Q.isFail(l))return l;const p=l.value;return{value:{type:"property",tagName:e,attributes:a.value,children:p}}}))}(r,e)))}function m(e){return i().p.choice([...Object.values(p(e)),i().p.fail((e=>new(s().yc)({nodeType:"property",unexpectedNode:n().$1(e)})))])}},242634:()=>{},251383:(e,t,r)=>{"use strict";r.d(t,{V:()=>i});var n=()=>r(943290),o=()=>r(295169),a=()=>r(358579);function i(e){const{environment:t,sessionId:r,operationIds:i}=e,s=o().default.getSessionContextOrThrow(r);s.caches.clear();const l=s.clearUncommittedOperations({onlyClearOperationIds:i}),d=0===s.uncommittedExecutableOperations.length,c=(0,n().iL)(l);for(const n of l)"addBlockToPage"===n.command&&s.evaluator.state.unmarkPageAsLoaded(n.blockNode.attributes.id);return(0,a().Z)({environment:t,sessionContext:s}),{allEditsRejected:d,editGroupsThatWereRejected:c}}},288466:(e,t,r)=>{"use strict";r.d(t,{O:()=>o});class n extends(()=>r(757695))().default{getInitialState(){return{currentState:"default",lastStepLoadingCompletionUnixEpochMs:-1/0,aiWindowLastSeenUnixEpochMs:-1/0}}setAssistantLastViewedTime(){this.setState({...this.state,aiWindowLastSeenUnixEpochMs:Date.now()})}}const o=new n;(0,r(604341).exposeDebugValue)("AssistantOriginElementStore",o)},292722:(e,t,r)=>{"use strict";r.d(t,{A0:()=>i,Ld:()=>c,Os:()=>p,SH:()=>s,ag:()=>u,c9:()=>d,rk:()=>l});r(944114),r(898992),r(354520),r(581454);var n=()=>r(534177),o=()=>r(252050),a=()=>r(706461);function i(e){return e.replace(/<think>[\s\S]*?<\/think>/g,"").trim()}function s(e){return e.replace(/<lang[\s\S]*?\/?>/g,"").trim()}function l(e){return e.replaceAll(a().uS,"").replaceAll(a().dK,"")}function d(e){const{tagName:t,inputString:r}=e,n=new RegExp(`<${t}(?:\\s+[^>]*)?>([\\s\\S]*?)</${t}>`,"g");let o;const a=[];for(;null!==(o=n.exec(r));)a.push(o[1]);return a.join("\n")}function c(e){return(0,n().Xk)(o().F6,e.tagName)}function u(e){return(0,n().Xk)(o().qI,e.tagName)}function p(e){const t=[];for(const r of e.children)"collectionView"!==r.type&&(t.push(r),t.push(...p(r)));return t}},295692:(e,t,r)=>{"use strict";r.d(t,{z:()=>c});r(296540);var n=()=>r(401497),o=()=>r(340498),a=r(474848);const i=(0,o().wt)("command",{viewBox:"0 0 16 16",svg:(0,a.jsx)("path",{d:"M4.35938 5.5625L4.35938 9.21094L2.78906 9.21094C1.25 9.21094 0 10.4219 0 11.9688C0 13.5156 1.25 14.7656 2.78906 14.7656C4.32812 14.7656 5.57812 13.5156 5.57812 11.9688L5.57812 10.4062L9.17969 10.4062L9.17969 11.9688C9.17969 13.5156 10.4297 14.7656 11.9688 14.7656C13.5078 14.7656 14.7578 13.5156 14.7578 11.9688C14.7578 10.4219 13.5078 9.21094 11.9688 9.21094L10.3984 9.21094L10.3984 5.5625L11.9688 5.5625C13.5078 5.5625 14.7578 4.35156 14.7578 2.80469C14.7578 1.25781 13.5078 0 11.9688 0C10.4297 0 9.17969 1.25781 9.17969 2.80469L9.17969 4.36719L5.57812 4.36719L5.57812 2.80469C5.57812 1.25781 4.32812 0 2.78906 0C1.25 0 0 1.25781 0 2.80469C0 4.35156 1.25 5.5625 2.78906 5.5625ZM2.78906 4.38281C1.92969 4.38281 1.21875 3.67188 1.21875 2.80469C1.21875 1.9375 1.92969 1.21875 2.78906 1.21875C3.64844 1.21875 4.35938 1.9375 4.35938 2.80469L4.35938 4.38281ZM11.9688 4.38281L10.3984 4.38281L10.3984 2.80469C10.3984 1.9375 11.1094 1.21875 11.9688 1.21875C12.8281 1.21875 13.5391 1.9375 13.5391 2.80469C13.5391 3.67188 12.8281 4.38281 11.9688 4.38281ZM5.57812 9.22656L5.57812 5.54688L9.17969 5.54688L9.17969 9.22656ZM2.78906 10.3828L4.35938 10.3828L4.35938 11.9609C4.35938 12.8281 3.64844 13.5391 2.78906 13.5391C1.92969 13.5391 1.21875 12.8281 1.21875 11.9609C1.21875 11.0938 1.92969 10.3828 2.78906 10.3828ZM11.9688 10.3828C12.8281 10.3828 13.5391 11.0938 13.5391 11.9609C13.5391 12.8281 12.8281 13.5391 11.9688 13.5391C11.1094 13.5391 10.3984 12.8281 10.3984 11.9609L10.3984 10.3828Z"})}),s=(0,o().wt)("control",{viewBox:"0 0 16 16",svg:(0,a.jsx)("path",{d:"M0.210938 6.41406C0.078125 6.55469 0 6.72656 0 6.92188C0 7.32812 0.304688 7.64062 0.710938 7.64062C0.914062 7.64062 1.09375 7.55469 1.21875 7.42969L7.20312 1.32031L6.36719 1.32031L12.3516 7.42969C12.4844 7.55469 12.6641 7.64062 12.8594 7.64062C13.2656 7.64062 13.5703 7.32812 13.5703 6.92188C13.5703 6.72656 13.4922 6.55469 13.3594 6.41406L7.3125 0.226562C7.17969 0.078125 6.98438 0 6.78906 0C6.58594 0 6.40625 0.078125 6.25781 0.226562Z"})}),l=(0,o().wt)("option",{viewBox:"0 0 16 16",svg:(0,a.jsx)("path",{d:"M4.5 0L0.734375 0C0.320312 0 0 0.304688 0 0.703125C0 1.10156 0.320312 1.41406 0.734375 1.41406L4.17188 1.41406C4.45312 1.41406 4.65625 1.53906 4.77344 1.79688L9.92188 13.3594C10.2109 14.0156 10.6875 14.3203 11.4062 14.3203L15.2188 14.3203C15.625 14.3203 15.9531 14.0078 15.9531 13.6172C15.9531 13.2266 15.625 12.9062 15.2188 12.9062L11.7578 12.9062C11.4453 12.9062 11.25 12.7891 11.125 12.5312L6 0.976562C5.73438 0.367188 5.17188 0 4.5 0ZM15.2188 0L10.1641 0C9.75 0 9.42969 0.296875 9.42969 0.695312C9.42969 1.09375 9.75 1.39844 10.1641 1.39844L15.2188 1.39844C15.6328 1.39844 15.9453 1.09375 15.9453 0.695312C15.9453 0.296875 15.6328 0 15.2188 0Z"})}),d=(0,o().wt)("shift",{viewBox:"0 0 16 16",svg:(0,a.jsx)("path",{d:"M5.99219 14.5L10.8125 14.5C11.9062 14.5 12.4922 13.8594 12.4922 12.8281L12.4922 9.32812L15.6641 9.32812C16.3047 9.32812 16.8047 8.9375 16.8047 8.34375C16.8047 7.97656 16.6172 7.70312 16.3359 7.42188L9.36719 0.476562C9.0625 0.171875 8.75 0 8.39844 0C8.05469 0 7.73438 0.171875 7.4375 0.476562L0.46875 7.42188C0.164062 7.71875 0 7.97656 0 8.34375C0 8.9375 0.5 9.32812 1.13281 9.32812L4.3125 9.32812L4.3125 12.8281C4.3125 13.8594 4.89844 14.5 5.99219 14.5ZM6.11719 13.2891C5.82031 13.2891 5.61719 13.0859 5.61719 12.7969L5.61719 8.41406C5.61719 8.21875 5.54688 8.14844 5.35938 8.14844L1.75 8.14844C1.69531 8.14844 1.66406 8.125 1.66406 8.08594C1.66406 8.05469 1.67969 8.03125 1.71094 7.99219L8.23438 1.50781C8.29688 1.44531 8.35156 1.42969 8.39844 1.42969C8.45312 1.42969 8.50781 1.44531 8.5625 1.50781L15.0859 7.99219C15.125 8.03125 15.1328 8.05469 15.1328 8.08594C15.1328 8.125 15.1094 8.14844 15.0469 8.14844L11.4453 8.14844C11.2578 8.14844 11.1875 8.21875 11.1875 8.41406L11.1875 12.7969C11.1875 13.0781 10.9766 13.2891 10.6875 13.2891Z"})});function c(e){const{shortcut:t,iconStyles:r,containerStyles:o}=e,c=(0,n().IS)((e=>({container:{display:"flex",gap:3,alignItems:"center",color:e.mediumIconColor,...o},icon:{strokeWidth:.25,overflow:"visible",stroke:e.mediumIconColor,...r}})),[o,r]);return t?(0,a.jsxs)("div",{style:c.container,children:[t.shift?d(c.icon):void 0,t.control?s(c.icon):void 0,t.option?l(c.icon):void 0,t.command?i(c.icon):void 0,t.key?1===t.key.length?t.key.toUpperCase():t.key:void 0]}):null}},305872:(e,t,r)=>{"use strict";r.d(t,{H:()=>a});var n=()=>r(645873);const o=new(n().O2)("AdminReactJson",(async()=>Promise.all([r.e(29151),r.e(64038),r.e(83755)]).then(r.bind(r,726368)))),a=(0,n()._h)(o,(e=>e.AdminReactJson))},307060:(e,t,r)=>{"use strict";r.r(t),r.d(t,{DEFAULT_MODAL_WIDTH_WITH_SIDE_PEEK:()=>de,INACTIVE_TIMEOUT_MS:()=>ie,Search:()=>ce,SearchStaticContext:()=>se,SearchStoresContext:()=>le,getSearchResultMetadata:()=>pe});r(944114),r(898992),r(803949),r(581454);var n=r(296540),o=()=>r(17022),a=()=>r(908006),i=()=>r(484714),s=()=>r(852507),l=()=>r(118884),d=()=>r(56366),c=()=>r(401497),u=()=>r(584262),p=()=>r(921940),m=()=>r(715256),h=()=>r(282834),g=()=>r(620333),f=()=>r(959013),y=()=>r(534177),b=()=>r(720665),v=()=>r(222917),x=()=>r(705540),k=()=>r(839752),w=()=>r(260488),S=()=>r(650829),I=()=>r(677590),T=()=>r(140022),C=()=>r(631611),N=()=>r(38337),M=()=>r(728611),_=()=>r(108944),B=()=>r(71304),A=()=>r(780865),j=()=>r(470928),P=()=>r(941541),R=()=>r(406792),E=()=>r(109054),O=()=>r(770906),F=()=>r(869562),L=()=>r(351360),D=()=>r(430483),q=()=>r(288466),K=()=>r(295169),U=()=>r(982254),H=()=>r(508496),$=()=>r(793765),V=()=>r(899677),z=()=>r(245241),W=()=>r(250484);class Q extends(()=>r(757695))().default{getInitialState(){return{queryBasedActionResults:void 0,fixedActionResults:void 0,localResults:void 0,serverResultsLoading:!1,serverResults:void 0,serverEventProperties:void 0,serverResultsAllLoaded:!1,errorState:G,selectedQueryResultQuery:void 0,timesToRender:new Map,focusedIndex:void 0}}setState(e){const t={...this.instanceState};if(!(0,r(821062).A)(this.instanceState,t))return;const n=function(e){const{newState:t,priorState:r}=e,{localResults:n,serverError:o,serverResultsLoading:a,serverResults:i}=t,s=Boolean(n),l=a?void 0:o;if(!s&&a)return!r.errorState.isLoading&&r.errorState.showMajorError?r.errorState:{isLoading:a};if(s)return{hasLocalResults:s,serverError:l,isLoading:!1,showMajorError:!1};if(l)return{hasLocalResults:s,serverError:l,isLoading:!1,showMajorError:!0};if(0===(null==i?void 0:i.results.length))return{hasLocalResults:s,serverError:z().yq.NoResults,isLoading:!1,showMajorError:!0};return{hasLocalResults:s,serverError:l,isLoading:!1,showMajorError:!1}}({newState:e,priorState:t});super.setState({...e,errorState:n})}getResultCount(){const{serverResults:e,localResults:t}=this.state,r=(null==e?void 0:e.total)??(null==t?void 0:t.total)??0,n=Boolean(e&&r>=100);return{count:r,isLowerBound:Boolean(e&&t&&r<W().ZK)||n}}}const G={showMajorError:!1,isLoading:!1,hasLocalResults:!1,serverError:void 0};const Z=Q;var Y=()=>r(498719),X=()=>r(543491),J=()=>r(847554),ee=()=>r(749240),te=()=>r(433876),re=()=>r(718680),ne=()=>r(764458),oe=r(474848);const ae=50,ie=120*b().TD,se=n.createContext(null);se.displayName="SearchStaticContext";const le=n.createContext(null);le.displayName="SearchStoresContext";const de=755;function ce(e){var t;const r=(0,i().v3)(),[o,S]=(0,n.useState)(),C=(0,n.useRef)(),N=(0,n.useRef)(),_=(0,n.useRef)(!0),z=(0,d().K8)((()=>Boolean(V().default.state.open||V().default.state.openAsPage)),[],{debugName:"isOpen"}),Q=(0,n.useRef)(null),G=(0,n.useRef)(null),ne=(0,n.useRef)(null),se=(0,d().K8)((()=>new Z),[],{debugName:"searchResultStore"}),le=(0,d().K8)((()=>new Z),[],{debugName:"secondarySearchResultStore"}),ce=(0,d().K8)((()=>W().Ay.state.query),[]),ye=(0,d().K8)((()=>ce.text.trim()),[ce]),be=(0,d().K8)((()=>ce.filters),[ce]),ve=(0,d().K8)((()=>A().SC(be)),[be],{debugName:"hasActiveFilterOtherThanTitleOnly"}),xe=(0,d().K8)((()=>Boolean(ye.trim())||ve),[ve,ye],{debugName:"hasQuery"}),{isDebugSidebarOpen:ke,isSidePeekPanelOpen:we,mode:Se}=(0,d().K8)((()=>({isDebugSidebarOpen:W().Ay.state.isDebugSidebarOpen,isSidePeekPanelOpen:W().Ay.state.isSidePeekPanelOpen,mode:W().Ay.state.mode})),[]),Ie=(0,d().K8)((()=>se.state.localResults),[se]),Te=(0,d().K8)((()=>{var e;return(null===(e=se.state.serverResults)||void 0===e?void 0:e.results)??[]}),[se]),Ce=(0,n.useMemo)((()=>(null==Ie?void 0:Ie.results)??[]),[null==Ie?void 0:Ie.results]),Ne=(0,n.useMemo)((()=>Ce.length),[Ce]),Me=(0,n.useMemo)((()=>(null==Ie?void 0:Ie.total)??0),[null==Ie?void 0:Ie.total]),_e=(0,d().K8)((()=>(se.state.fixedActionResults??[]).length),[se],{debugName:"numberOfFixedActionResults"}),Be=(0,d().K8)((()=>(se.state.queryBasedActionResults??[]).length),[se],{debugName:"numberOfQueryBasedActionResults"}),Ae=(0,d().K8)((()=>{var e;return(null===(e=se.state.localResults)||void 0===e?void 0:e.totalResultIds)??[]}),[se],{debugName:"totalLocalResultIds"}),je=(0,d().K8)((()=>{var e;return(null===(e=se.state.localResults)||void 0===e?void 0:e.allMatchingResultIds)??[]}),[se],{debugName:"allMatchingResultIds"}),Pe=(0,d().K8)((()=>_e+Be),[_e,Be]),Re=(0,n.useCallback)((()=>A().rp({environment:r,searchResultsSection:Q.current,modalBodyMenu:ne.current,searchFilterMenu:G.current,actionItemCount:Pe})),[Pe,r]),Ee=(0,d().K8)((()=>se.state.timesToRender),[se],{debugName:"timesToRender"}),Oe=(0,d().K8)((()=>V().default.state.sessionId),[]),Fe=(0,d().K8)((()=>V().default.state.openedTimeMs),[]),Le=(0,d().K8)((()=>W().Ay.state.hasScrolled),[]),{numKeystrokes:De,numServerRequests:qe,firstKeyStrokeTimeMs:Ke,numLocalRequests:Ue}=(0,d().K8)((()=>({numKeystrokes:Y().default.state.numKeystrokes,numServerRequests:Y().default.state.numServerRequests,numLocalRequests:Y().default.state.numLocalRequests,firstKeyStrokeTimeMs:Y().default.state.firstKeyStrokeTimeMs})),[]),He=(0,d().K8)((()=>Y().default.state.hadMetaClick),[]),$e=(0,d().O$)(ee().subscriptionDataStoreInstance),Ve=(0,J().b)($e),ze=(0,d().K8)((()=>(0,A().yu)({localResults:Ce,serverResults:Te})),[Ce,Te]),We=(0,d().K8)((()=>null==ze?void 0:ze.length),[ze]),Qe=(0,f().tz)(),Ge=(0,n.useCallback)((e=>{const{selectedResult:t,index:n,fromSidePeekPanel:o,context:a,openedTimeMs:i,additionalResultsCount:s}=e,{serverEventProperties:l,store:d}=t,c=Date.now(),u=(0,B().Qe)(t.store,Qe,r,!1),p=(0,E().u)({query:ye,resultText:u??"",isLastQueryTermPartialMatchOK:!1}),m=L().default.state.currentSpaceStore,g=Boolean(null==m?void 0:m.getSettings().enable_ai_training);return{...l,context:a,queryStringLength:ye.length,numQueryTokens:h().qw(ye).length,hasFilters:A().J3(be),activeFilters:be,selectedItemIndex:n.global-(Pe+(s??0)),selectedItemLocalIndex:{section:n.local.section,index:n.local.indexLocal},numKeystrokes:De,fromSidePeekPanel:o,isSidePeekPanelOpen:we,isSidebarOpen:ke,timeToSelectMs:c-i,timeFromFirstKeyStrokeToSelectMs:Ke?c-Ke:c-i,sources:null==t?void 0:t.sources,localSources:[...(null==t?void 0:t.localSource)??[]],hadMetaClick:He,numResultsAboveFold:Re(),selectedSearchResultMetadata:pe(t,je),selectedSearchResultContent:void 0,allSearchResultMetadata:null==ze?void 0:ze.slice(0,ae).map((e=>pe(e))),totalSearchResultCount:We,searchSessionId:Oe,aiSessionId:void 0,searchSessionFlowNumber:qe,originalPosition:null==t?void 0:t.originalPosition,numLocalResults:Ne,numTotalLocalResults:Me,totalLocalResultIds:Ae,numVisibleMembers:Ve,isMobile:r.device.isMobile,timeToRenderResult:Ee.get(d.id),hasScrolled:Le,verificationState:(0,j().i1)(t.store),searchSource:"quick_find",isTitleMatch:p,queryIfLeap:g?ye:void 0}}),[Qe,r,ye,be,Pe,De,we,ke,Ke,He,Re,ze,We,Oe,qe,Ne,Me,Ae,Ve,Ee,Le,je]),Ze=(0,n.useCallback)((e=>{let{index:t,context:n,selectedResult:o,fromSidePeekPanel:a,source:i,additionalResultsCount:s}=e;z&&Oe&&Fe&&v().yN(r,{...Ge({index:t,context:n,selectedResult:o,fromSidePeekPanel:a,openedTimeMs:Fe,additionalResultsCount:s}),source:i,searchSessionId:Oe})}),[Ge,r,z,Fe,Oe]),Ye=(0,n.useCallback)((()=>{if(!z)return;clearTimeout(C.current),W().Ay.update((e=>({...e,hasScrolled:!1})));const e=_.current?"search_modal_first_open_lag":"search_modal_open_lag";_.current&&(_.current=!1),R().default.mark(e)}),[z]),Xe=(0,d().K8)((()=>"chat"===r.RouterStore.state.route.name),[r.RouterStore]),Je=(0,n.useCallback)((()=>{w().Yc({resultStore:se,secondaryResultStore:le}),e.quickSearchMode?(V().default.closeAndResetMetricsState(),Xe||(0,I().U)({environment:r})):V().default.reset()}),[r,Xe,e.quickSearchMode,se,le]),et=(0,d().K8)((()=>se.state.serverEventProperties),[se]),tt=(0,n.useCallback)((t=>{const{device:n}=r,{selectedQueryResult:o}=Y().default.state;if(De>0&&(qe>0||Ue>0)&&!o&&!He&&Oe&&Fe&&z){const e=Date.now(),t=e-Fe;v().mG(r,{...et,timeToAbandonMs:t,timeFromFirstKeyStrokeToAbandonMs:Ke?e-Ke:void 0,numKeystrokes:De,numResultsAboveFold:Re(),searchSessionId:Oe,searchSessionFlowNumber:qe,hasScrolled:Le,numLocalResults:Ne,numTotalLocalResults:Me,numVisibleMembers:Ve,isMobile:n.isMobile}),w().jd({environment:r,query:ye})}"assistant"===Se&&"keydown"===(null==t?void 0:t.type)?(W().Ay.switchToSearchPane(),x().quickSearchSetSearchAssistantMode(!1)):e.quickSearchMode?(V().default.closeAndResetMetricsState(),Y().default.reset(),o&&!He&&Je(),x().closeQuickSearch()):w().st({environment:r,reset:!1}),"assistant"===Se&&q().O.setAssistantLastViewedTime(),""===ye&&"assistant"!==Se&&W().Ay.reset();const a=H().default.getEligibleGroup({experimentId:"search-shorten-inactive-timer",defaultGroup:"control"});let i=ie;"control"!==a&&m().hH["search-shorten-inactive-timer"].includes(a)&&(i=parseInt(a,10)*b().TD),C.current&&clearTimeout(C.current),i>0?C.current=window.setTimeout(Je,i):Je(),!e.quickSearchMode&&n.isMobile&&F().close(),O().VI({environment:r,skipAnimation:!0}),Y().default.reset()}),[r,De,qe,Ue,Ve,He,Oe,Fe,z,Se,e.quickSearchMode,ye,et,Ke,Re,Le,Ne,Me,Je]),rt=(0,d().K8)((()=>K().default.getActiveSessionId()),[]),nt=(0,d().K8)((()=>{if(rt)return K().default.getSessionContext(rt)}),[rt]),ot=(0,n.useCallback)(((t,n,o,i)=>{if(!e.quickSearchMode)return;const s=P().Ay;if("stopQueueingSubscriptions"in s&&s.stopQueueingSubscriptions(r),n){let e;e="tray-icon"===o?"quick-search-tray-icon":"shortcut"===o?"quick-search-shortcut":"debug-menu"===o?"quick-search-debug-menu":"quick-search";const t=("search"===Se&&i||"assistant"===Se&&!i)&&!(!z&&n);i&&D().zD.shouldShowSearchMenuItemAskAI(r.device)?w().sv({environment:r,quickSearchMode:!0,from:t?"command_search_switching_panes":"command_search_shortcut",device:r.device}):!0!==i&&(W().Ay.update((e=>({...e,mode:"search"}))),t&&(e="command_search_switching_panes",rt&&(0,T().trackAssistantClosed)(r,{from:"command_search_switching_panes",sessionContext:nt}))),w()._N({environment:r,analyticsFrom:e,isQuickSearch:!0,doNotTrackOpenSearchEvent:i}),a().default.afterNextFlush((()=>x().quickSearchRenderCompleted()))}else tt()}),[nt,rt,r,tt,z,Se,e.quickSearchMode]),at=(0,n.useCallback)((t=>{e.quickSearchMode&&tt()}),[tt,e.quickSearchMode]),it=(0,n.useCallback)((()=>{w().Yc({resultStore:se,secondaryResultStore:le}),e.quickSearchMode||(V().default.reset(),(0,I().U)({environment:r}))}),[r,e.quickSearchMode,se,le]),st=(0,n.useCallback)((()=>{const t=L().default.state.currentSpaceStore&&L().default.state.currentSpaceStore.id;N.current!==t&&(N.current=t,it(),N.current&&L().default.state.currentUserStore&&e.quickSearchMode&&x().quickSearchReady())}),[e.quickSearchMode,it]),lt=(0,n.useRef)(),dt=(0,n.useRef)(),ct=(0,n.useRef)(),ut=(0,n.useRef)();(0,s().l)((()=>{var t;N.current=null===(t=L().default.state.currentSpaceStore)||void 0===t?void 0:t.id,L().default.state.currentSpaceStore&&L().default.state.currentUserStore&&e.quickSearchMode&&x().quickSearchReady(),L().default.addListener(st),V().default.addListener(Ye),e.quickSearchMode?dt.current=x().quickSearchVisibilityState.addListener(ot):(lt.current=x().openSearchModalFromQuickSearch.addListener((()=>fe(r,!1))),ct.current=x().openNotionAiFromQuickSearch.addListener((()=>{"chat"!==r.RouterStore.state.route.name&&fe(r,!0)}))),k().w7.addListener(at),ut.current=x().openSearchModalForNewTab.addListener((()=>{w()._N({environment:r,isNewElectronTab:!0,analyticsFrom:"new-tab"})}))})),(0,l().X)((()=>{var e,t,r,n;Je(),V().default.removeListener(Ye),k().w7.removeListener(at),L().default.removeListener(st),null===(e=dt.current)||void 0===e||e.call(dt),null===(t=lt.current)||void 0===t||t.call(lt),null===(r=ct.current)||void 0===r||r.call(ct),null===(n=ut.current)||void 0===n||n.call(ut),C&&(clearTimeout(C.current),C.current=void 0)}));const pt=(0,d().K8)((()=>U().A.state.tabs),[]),mt=(0,d().K8)((()=>V().default.state.isNewElectronTab),[]),ht=(0,n.useCallback)((t=>{let{index:n,event:o,context:a,selectedResult:i,fromSidePeekPanel:s,additionalResultsCount:l}=t;if(!z||!Fe||!Oe)return;const d=L().default.state.currentSpaceStore,c=Boolean(null==d?void 0:d.getSettings().enable_ai_training),m=M().Vr(o);"query_results"===a&&(Y().default.update((e=>({...e,selectedQueryResult:!0}))),se.update((e=>({...e,selectedQueryResultQuery:ce})))),v().bo(r,{...Ge({index:n,context:a,selectedResult:i,fromSidePeekPanel:s,openedTimeMs:Fe,additionalResultsCount:l}),searchSource:"quick_find",searchSessionId:Oe,isMetaClick:Boolean(m),queryIfLeap:c?ye:void 0});const h=(null==et?void 0:et["server-queryId"])??(0,g().mk)({searchSessionId:Oe,searchSessionFlowNumber:qe});let f;if("recent_pages"===a?f=u().y8.SearchRecents:"query_results"===a?f=u().y8.SearchQuery:"tabs"===a||"new_page"===a?f=u().y8.SearchTabs:"action"===a?f=u().y8.SearchCustomAction:(0,y().HB)(a),r.device.isElectron&&e.quickSearchMode){const e=(0,p().A)({pageModel:i.store.getModel(),pageId:i.store.id,scrollToBlockId:(0,A().pV)(i),pageVisitSource:f,queryId:h});x().openQuickSearchResult(e)}else k().q9({searchResult:{type:"page",...i},environment:r,pageVisitSource:f,queryId:h,openInNew:m,electronTabSearch:{tabs:pt,isNewTab:Boolean(mt)},context:a});X().A.setState({queryId:h,pageId:i.store.id,timeEntered:new Date}),m?Y().default.update((e=>({...e,hadMetaClick:!0}))):tt()}),[Ge,r,tt,mt,z,qe,Fe,e.quickSearchMode,ce,se,Oe,et,pt,ye]),gt=(0,n.useMemo)((()=>({queryResultsSectionRef:Q,searchMobileFilterMenuRef:G,modalBodyMenuRef:ne,handleSelectSearchResult:ht,handleCopySearchItemLink:Ze,handleQueryChange:ge,handlePopupOpen:me,handlePopupClose:he,searchResultStore:se,secondarySearchResultStore:le,defaultBodyFocusedResult:o,isQuickSearch:e.quickSearchMode,setDefaultBodyFocusedResult:S})),[o,Ze,ht,e.quickSearchMode,se,le]),ft=xe?"search_results":"default_body",yt=function(e){const t=(0,i().v3)(),r=(0,d().K8)((()=>(0,re().CX)({searchContentPaneType:e,quickSearchMode:!1,environment:t})),[t,e]),n=(0,d().K8)((()=>(0,$().I5)({device:t.device})?"90vw":de),[t]);return(0,c().IS)((e=>({wrapper:{width:"100%",minHeight:r.minHeight,maxHeight:r.maxHeight,transform:"translate3d(0,0,0)",background:e.popoverBackground,maxWidth:n,borderRadius:12}})),[n,r]).wrapper}(ft);return e.quickSearchMode?(0,oe.jsx)(ue,{searchContentPaneType:ft,quickSearchMode:e.quickSearchMode,handleComponentClose:tt,parentStore:e.parentStore,staticContext:gt}):(0,oe.jsx)(te().A,{open:z,onDismiss:tt,modalStyle:yt,disableAnimation:!r.device.isMobile||(null===(t=r.mobileNative)||void 0===t?void 0:t.supportsNativeHomeOnPhone())||!1,renderContent:()=>(0,oe.jsx)(ue,{searchContentPaneType:ft,quickSearchMode:e.quickSearchMode,handleComponentClose:tt,parentStore:e.parentStore,staticContext:gt})})}function ue(e){const{searchContentPaneType:t,quickSearchMode:r,handleComponentClose:n,parentStore:o,staticContext:a}=e,s=(0,i().v3)(),l=(0,d().K8)((()=>W().Ay.state.isPopupOpen),[]),c=(0,d().K8)((()=>W().Ay.state.mode),[]),u=r?C().wy.commandSearch:s.device.isMobile?C().wy.mobileSearch:C().wy.searchPane;return(0,oe.jsx)(se.Provider,{value:a,children:(0,oe.jsx)(le.Provider,{value:{parentStore:o},children:(0,oe.jsxs)(C().hP,{surface:u,children:[r&&!l&&(0,oe.jsx)("div",{style:{position:"absolute",height:ne().A,width:"100%"},className:N().sbV}),"search"===c?(0,oe.jsx)(re().sb,{quickSearchMode:r,searchContentPaneType:t,onClose:n}):(0,oe.jsx)(S().LazySearchAssistantPane,{quickSearchMode:r,searchContentPaneType:t,onClose:n})]})})})}function pe(e,t){const{store:r,highlight:n,sources:a,localSource:i}=e,s=t?t.indexOf(r.id):-1;return o().A.withListenerIgnored((()=>{var t,o,l,d,c;return{blockId:r.id,blockType:r.getType(),lowestNavigableAncestorId:null===(t=r.getNavigableBlockStore())||void 0===t?void 0:t.id,depth:_().g7(r).length,matchesText:Boolean(null==n?void 0:n.text),matchesPathText:Boolean((null==n?void 0:n.pathText)||(null==n?void 0:n.title)),matchesTitle:Boolean(null==n?void 0:n.title),isNavigable:r.isNavigableBlock(),lastEditedTime:r.getLastEditedTime(),isTeamArchived:null===(o=(0,_().Uo)(r))||void 0===o?void 0:o.isArchived(),sources:a,localSource:[...i??[]],badges:(null===(l=e.badges)||void 0===l?void 0:l.map((e=>e.type)))??[],isCollectionPropertyMatch:void 0!==(null===(d=e.matchedCollectionProperties)||void 0===d?void 0:d.collectionText),isCollectionPropertyHighlight:void 0!==(null===(c=e.highlight)||void 0===c?void 0:c.collectionText),featureGroups:e.featureGroups,allMatchingLocalResultsIndex:s>=0?s:void 0}}))}function me(){W().Ay.setIsAnyPopupOpen(!0)}function he(){W().Ay.setIsAnyPopupOpen(!1)}function ge(e){""!==e?(Y().default.update((e=>({...e,numKeystrokes:e.numKeystrokes+1}))),W().Ay.updateQueryText(e),"full-content"===V().default.state.searchMode&&V().default.update((e=>({...e,searchMode:"nav-local-only"})))):W().Ay.resetQuery({resetFilters:!1})}function fe(e,t){t&&W().Ay.update((e=>({...e,mode:"assistant"}))),w()._N({environment:e,analyticsFrom:"keyboard-shortcut-quick-search-hotkey",isQuickSearch:!1})}},313948:(e,t,r)=>{"use strict";r.d(t,{m:()=>j});var n=r(296540),o=()=>r(484714),a=()=>r(56366),i=()=>r(401497),s=()=>r(563884),l=()=>r(668725),d=()=>r(959013),c=()=>r(56394),u=()=>r(780865),p=()=>r(962730),m=()=>r(377586),h=()=>r(35394),g=()=>r(250484),f=()=>r(704152),y=()=>r(760217),b=()=>r(545805),v=()=>r(14235),x=()=>r(89924),k=()=>r(933117),w=()=>r(427711),S=()=>r(821879),I=()=>r(978625),T=()=>r(604995),C=()=>r(416504),N=()=>r(534177),M=r(474848);const _={today:(0,M.jsx)(d().sA,{defaultMessage:"Today",id:"searchDateFilter.quickActions.today.label"}),pastWeek:(0,M.jsx)(d().sA,{defaultMessage:"Last 7 days",id:"searchDateFilter.quickActions.last7Days.label"}),pastMonth:(0,M.jsx)(d().sA,{defaultMessage:"Last 30 days",id:"searchDateFilter.quickActions.last30Days.label"})};function B(e){let{date:t,onClick:r,onDismiss:n}=e;const o=(0,C().P)(),a=T().Ec(o),i=a;let s;const l=_[t];"today"===t?s=a:"pastWeek"===t?s=T().t0(o):"pastMonth"===t?s=T().ZG(o):(0,N().HB)(t);return(0,M.jsx)(y().A,{focused:!1,title:l,onClick:e=>{r({value:{starting:{type:"date",start_date:s.start_date},ending:{type:"date",start_date:i.start_date}}}),n(e)}})}var A=()=>r(806754);function j(e){const{initialValue:t,dateFilterType:r,onMenuDismiss:a,title:i,icon:s,disabled:l,onMenuOpen:d,dateFormat:c,mode:u,shouldAlsoUpdateSearchStore:p}=e,m=(0,o().Y0)(),{current:g}=(0,n.useRef)(e.store??new(h().A)({initialDateRange:t,shouldAlsoUpdateSearchStore:p}));return(0,n.useEffect)((()=>{g.state.dateFilterType===r||g.update((e=>({...e,dateFilterType:r})))}),[r,g]),m.isMobile?(0,M.jsx)(W,{onMenuDismiss:a,title:i,disabled:l,onMenuOpen:d,dateFormat:c,icon:s,store:g,mode:u}):(0,M.jsx)(z,{onMenuDismiss:a,title:i,disabled:l,onMenuOpen:d,icon:s,store:g})}function P(e){const{dateFilterType:t,nextState:r,store:n}=e;n.update((e=>({...e,temporaryDateRange:{...n.state.temporaryDateRange,...r},dateFilterType:t}))),n.state.shouldAlsoUpdateSearchStore&&g().Ay.updateFilters({[t]:r})}function R(e){return{lastEditedTime:(0,M.jsx)(d().sA,{id:"search.filterMenu.moreFilters.lastEdited",defaultMessage:"Last edited"}),createdTime:(0,M.jsx)(d().sA,{id:"search.filterMenu.moreFilters.created",defaultMessage:"Created"})}[e]}function E(e){const{device:t}=e;return t.isMobile?m().n.SlideUp:m().n.Popup}function O(){const e=(0,o().v3)(),{device:t}=e;return(0,l().b)({width:10,height:10,...t.isMobile&&{marginTop:2}})}function F(e){e.preventDefault&&e.preventDefault()}function L(e,t,r){t||(r&&r(),e.setState({...e.state,isOpen:!0,focus:"starting"}))}function D(e,t,r){const{temporaryDateRange:n,dateFilterType:o}=t.state;u().a9(e)||(P({dateFilterType:o,nextState:n,store:t}),t.setState({...t.state,isOpen:!1}),r&&r())}function q(e){const{dateFilterType:t}=e.state;P({dateFilterType:t,nextState:{starting:void 0,ending:void 0},store:e}),e.clearTemporaryDateRange()}function K(e){let{store:t}=e;const r=(0,i().DP)(),n=(0,o().v3)(),{device:s}=n,l=(0,a().K8)((()=>t.state.dateFilterType),[t]),d=(0,a().K8)((()=>t.state.temporaryDateRange??{starting:void 0,ending:void 0}),[t]),c={width:190,items:["createdTime","lastEditedTime"],selectedItem:l,getKey:e=>e,onSelect:e=>function(e,t,r){const{dateFilterType:n}=r.state;P({dateFilterType:e,nextState:t,store:r}),e!==n&&(P({dateFilterType:n,nextState:{starting:void 0,ending:void 0},store:r}),r.setState({...r.state,dateFilterType:e}))}(e,d,t),renderItem:e=>(0,M.jsx)(y().A,{title:R(e.value),...e}),renderOrigin:e=>(0,M.jsx)(f().A,{...e,style:{paddingLeft:4,paddingRight:4,borderRadius:4,flexShrink:0},children:(0,M.jsxs)("div",{style:{display:"flex",alignItems:"center",...!s.isMobile&&{color:r.mediumTextColor,fill:r.lightIconColor,fontWeight:500,fontSize:12,lineHeight:"16px"}},children:[(0,M.jsx)("span",{style:{marginRight:4},children:R(l)}),(0,M.jsx)(O,{})]})})};return(0,M.jsx)(k().A,{...c,mobileActionSheet:!0})}function U(e){let{disabled:t,onMenuOpen:r,icon:o,title:a,store:s}=e;const l=(0,n.useCallback)((()=>L(s,t,r)),[s,t,r]),d=(0,i().IS)((()=>({icon:{height:14,width:14,fill:"currentColor"}})),[]);return(0,M.jsx)(y().A,{disabled:t,focused:!1,icon:o(d.icon),title:a,onClick:l})}function H(e){let{disabled:t,onMenuOpen:r,title:o,store:l,dateFormat:c}=e;const p=(0,d().tz)(),m=(0,n.useCallback)((()=>q(l)),[l]),h=(0,n.useCallback)((()=>L(l,t,r)),[l,t,r]),g=(0,a().K8)((()=>l.state.temporaryDateRange??{starting:void 0,ending:void 0}),[l]),f=(0,i().IS)((()=>({summary:{display:"inline-flex"},iconActiveMobile:{height:14,width:14,fill:"currentColor",marginTop:1,marginRight:6}})),[]),y=(0,M.jsxs)("div",{style:f.summary,children:[(0,s().k)(f.iconActiveMobile),u().tX(g,p,c)]});return(0,M.jsx)(I().A,{disabled:t,onClick:h,onClickClear:m,label:o,title:y})}function $(e){let{disabled:t,onMenuOpen:r,icon:o,title:s,store:l}=e;const d=(0,n.useCallback)((()=>L(l,t,r)),[l,t,r]),u=(0,i().IS)((()=>({pillIcon:{height:16,width:16,fill:"currentColor",marginRight:6}})),[]),p=(0,a().K8)((()=>l.state.temporaryDateRange.starting),[l]);return(0,M.jsx)(c().A,{on:Boolean(p),icon:o(u.pillIcon),title:(0,M.jsx)("span",{children:s}),onClick:d})}function V(e){let{onMenuDismiss:t,title:r,store:o}=e;const s=(0,a().K8)((()=>o.state.dateFilterType),[o]),l=(0,a().K8)((()=>o.state.temporaryDateRange),[o]),c=(0,n.useCallback)((e=>D(e,o,t)),[o,t]),u=(0,n.useCallback)((e=>{if(e.error)return;o.setState({...o.state,temporaryDateRange:{...l,...e.value}});const{starting:t,ending:r}=o.state.temporaryDateRange;t&&r&&P({dateFilterType:s,nextState:{starting:t,ending:r},store:o})}),[s,l,o]),p=(0,n.useCallback)((()=>q(o)),[o]),m=(0,i().IS)((e=>({dateFilterHeader:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",paddingTop:4,paddingRight:4,paddingBottom:2,paddingLeft:4},clearButton:{color:e.mediumTextColor,fill:e.lightIconColor,fontWeight:500,fontSize:12,lineHeight:"16px",paddingLeft:4,paddingRight:4,borderRadius:4,flexShrink:0},showBottomDivider:{boxShadow:`0 1px 0 ${e.regularDividerColor}`}})),[]);return(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(x().A,{children:(0,M.jsxs)("div",{style:m.dateFilterHeader,children:[(0,M.jsx)(K,{store:o}),(0,M.jsx)(f().A,{style:m.clearButton,onClick:p,children:(0,M.jsx)(d().sA,{defaultMessage:"Clear",id:"searchDateFilter.clearButton.label"})})]})}),(0,M.jsxs)(x().A,{style:m.showBottomDivider,children:[(0,M.jsx)(B,{date:"today",onClick:u,onDismiss:c}),(0,M.jsx)(B,{date:"pastWeek",onClick:u,onDismiss:c}),(0,M.jsx)(B,{date:"pastMonth",onClick:u,onDismiss:c})]}),(0,M.jsx)(w().A,{title:r,value:l,onUpdate:u,store:o,onDismiss:c,hideDateInputMenuItems:!0})]})}function z(e){let{onMenuDismiss:t,title:r,disabled:s,onMenuOpen:l,icon:d,store:c}=e;const u=(0,o().v3)(),m=(0,a().K8)((()=>c.state.isOpen),[c]),h=(0,n.useCallback)((e=>D(e,c,t)),[c,t]),g=(0,i().IS)((()=>({sectionMenuItem:{display:"flex"}})),[]);return(0,M.jsx)(A().A,{style:g.sectionMenuItem,children:(0,M.jsx)(b().A,{debugName:"SearchGenericDateFilter",capture:m,onUp:F,onDown:F,onEnter:F,children:(0,M.jsx)(v().Ay,{popupType:E(u),open:m,origin:(0,M.jsx)($,{disabled:s,onMenuOpen:l,icon:d,title:r,store:c}),render:()=>(0,M.jsx)(V,{onMenuDismiss:t,title:r,store:c}),onDismiss:h,placementToOrigin:p().W.Bottom,alignmentToOrigin:p().C.Start,keepFocus:!0})})})}function W(e){let{mode:t,onMenuDismiss:r,title:o,disabled:i,onMenuOpen:s,dateFormat:l,icon:d,store:c}=e;const u=(0,n.useCallback)((e=>D(e,c,r)),[c,r]),p=(0,n.useCallback)((()=>(0,M.jsx)(V,{onMenuDismiss:r,title:o,store:c})),[r,o,c]),h=(0,a().K8)((()=>c.state.isOpen),[c]),g=t===S().C.Section?(0,M.jsx)(H,{disabled:i,onMenuOpen:s,title:o,store:c,dateFormat:l}):(0,M.jsx)(U,{disabled:i,onMenuOpen:s,icon:d,title:o,store:c});return(0,M.jsx)(v().Ay,{popupType:m().n.SlideUp,open:h,origin:g,render:p,onDismiss:u,preventScaleTransition:!0})}},316581:(e,t,r)=>{"use strict";r.d(t,{_A:()=>d,nt:()=>l});r(16280),r(944114),r(898992),r(354520),r(672577),r(430670),r(803949),r(581454),r(908872),r(737550);var n=r.n(r(755373)),o=()=>r(496603),a=()=>r(534177),i=()=>r(832443),s=()=>r(252050);function l(e){const{searchResults:t,state:r}=e;for(const o of t){const e=i().tD.parseAssistantHref(o.id);if("slack"===o.type)o.messages.forEach(((e,t)=>{const a=i().tD.parseAssistantHref(e.messageId);if(!a||"slack"!==a.type)throw new Error(`HREF (${e.messageId}) could not be parsed as a Slack message result`);if(0===t&&a.threadTs){const e=(0,s().Su)(`slack://?${n().stringify({base_url:a.baseUrl,channel_id:a.channelId,message_id:a.threadTs,thread_ts:a.threadTs})}`);r.setUniversalResultPayload(e,{type:"slack",href:e,threadHref:e,title:o.title,text:o.text,user:"",lastEdited:o.lastEdited,domain:a.domain,baseUrl:a.baseUrl,channelId:a.channelId,messageId:a.threadTs,threadTs:a.threadTs,threadMessages:o.messages.map((e=>e.messageId))})}r.setUniversalResultPayload((0,s().Su)(e.messageId),{type:"slack",href:e.messageId,threadHref:e.threadId,title:o.title,text:e.text,user:e.user,lastEdited:e.lastEdited,domain:a.domain,baseUrl:a.baseUrl,channelId:a.channelId,messageId:a.messageId,threadTs:a.threadTs,threadMessages:o.messages.map((e=>e.messageId))})}));else if("helpdoc"===o.type){if(!e||"helpdoc"!==e.type)throw new Error(`HREF (${o.id}) could not be parsed as a helpdoc result`);const t={type:"helpdoc",href:o.id,title:o.title,text:o.text,lastEdited:o.lastEdited,url:e.url};r.setUniversalResultPayload((0,s().h5)(o.id),t)}else if("helpdoc-section"===o.type){if(!e||"helpdoc-section"!==e.type)throw new Error(`HREF (${o.id}) could not be parsed as a helpdoc-section result`);const t={type:"helpdoc-section",href:o.id,parentPageHref:e.parentPageHref,title:o.title,text:o.text,lastEdited:o.lastEdited,url:e.url};r.setUniversalResultPayload(e.href,t);const n=i().tD.parseAssistantHref(e.parentPageHref);if("helpdoc"!==(null==n?void 0:n.type))throw new Error(`HREF (${o.id}) could not be parsed as a helpdoc-section result because its parent page could not be parsed as a helpdoc`);r.setUniversalResultPayload(e.parentPageHref,{...t,type:"helpdoc",href:e.parentPageHref,title:o.path,text:"",lastEdited:o.lastEdited,url:n.url})}else if("webpage"===o.type){if(!e||"webpage"!==e.type)throw new Error(`HREF (${o.id}) could not be parsed as a webpage result`);const t={type:"webpage",href:o.id,title:o.title,text:o.text,lastEdited:o.lastEdited,url:e.url};r.setUniversalResultPayload((0,s().RW)(o.id),t)}else if("google-drive"===o.type){if(!e||"google-drive"!==e.type)throw new Error(`HREF (${o.id}) could not be parsed as a google-drive result`);const t={type:"google-drive",href:o.id,title:o.title,text:o.text,lastEdited:o.lastEdited,url:e.url};r.setUniversalResultPayload((0,s().Fu)(o.id),t)}else if("github"===o.type){if(!e||"github"!==e.type)throw new Error(`HREF (${o.id}) could not be parsed as a github result`);const t={type:"github",href:o.id,title:o.title,text:o.text,lastEdited:o.lastEdited,url:e.url};r.setUniversalResultPayload((0,s().Tj)(o.id),t)}else if("jira"===o.type){if(!e||"jira"!==e.type)throw new Error(`HREF (${o.id}) could not be parsed as a jira result`);const t={type:"jira",href:o.id,title:o.title,text:o.text,lastEdited:o.lastEdited,url:e.url};r.setUniversalResultPayload((0,s().MQ)(o.id),t)}else if("microsoftTeams"===o.type);else if("sharepoint"===o.type){if(!e||"sharepoint"!==e.type)throw new Error(`HREF (${o.id}) could not be parsed as a sharepoint result`);const t={type:"sharepoint",href:o.id,title:o.title,text:o.text,lastEdited:o.lastEdited,url:e.url};r.setUniversalResultPayload((0,s().L7)(o.id),t)}else if("page"===o.type){const e={type:"page",id:o.id,highlight:o.highlight,title:o.title,text:o.text,lastEdited:o.lastEdited};r.setUniversalResultPayload((0,s().ew)(o.id),e)}else{if("block"===o.type||"properties"===o.type)continue;(0,a().HB)(o)}}}function d(e){const{searchResults:t,systemMessages:r}=e;let n=!1;const i=t.filter((e=>"block"===e.type||"properties"===e.type)),s=function(e){return e.reduce(((e,t)=>{const r=e.find((e=>e.pageId===t.pageId));return r?(r.blocks.push(t),e):[...e,{pageId:t.pageId,title:t.title,path:t.path,lastEdited:t.lastEdited,blocks:[t]}]}),[])}(i),l=s.map((e=>(e.blocks.some((e=>e.isPrivate))&&(n=!0),{type:"element",tagName:"page",attributes:{id:e.pageId,title:e.title,...e.path&&{path:e.path},"last-edited-datetime":e.lastEdited},children:c(e.blocks).map((e=>({type:"element",tagName:"block",attributes:{id:e.id},children:[{type:"text",value:e.text}]})))}))),d=t.filter((e=>"page"===e.type||"slack"===e.type||"helpdoc"===e.type||"helpdoc-section"===e.type||"webpage"===e.type||"google-drive"===e.type||"github"===e.type||"microsoftTeams"===e.type||"sharepoint"===e.type||"jira"===e.type||"block"!==e.type&&"properties"!==e.type&&(0,a().HB)(e))),u=[];for(const o of d){const{id:e,title:t,text:r,lastEdited:i}=o;if(o.isPrivate&&(n=!0),"slack"===o.type)u.push({type:"element",tagName:"slack-thread",attributes:{id:e,channel:o.channel||"","last-edited-datetime":i},children:o.messages.map((e=>({type:"element",tagName:"slack-message",attributes:{id:e.messageId,"last-edited-datetime":e.lastEdited,user:e.user},children:[{type:"text",value:e.text}]})))});else if("helpdoc"===o.type)u.push({type:"element",tagName:"helpdoc",attributes:{id:e,title:t,"last-edited-datetime":i},children:[{type:"element",tagName:"helpdoc-section",attributes:{id:e,title:t},children:[{type:"text",value:r}]}]});else if("helpdoc-section"===o.type){let n=u.find((e=>"helpdoc"===e.tagName&&e.attributes.id===o.pageId));n||(n={type:"element",tagName:"helpdoc",attributes:{id:o.pageId,title:o.path,"last-edited-datetime":i},children:[]},u.push(n)),n.children.push({type:"element",tagName:"helpdoc-section",attributes:{id:e,title:t},children:[{type:"text",value:r}]})}else if("google-drive"===o.type)u.push({type:"element",tagName:"google-drive-result",attributes:{id:e,title:t,"last-edited-datetime":i,...o.fileType&&{"file-type":o.fileType}},children:[{type:"text",value:r}]});else if("webpage"===o.type)u.push({type:"element",tagName:"webpage",attributes:{id:e,title:t,"updated-datetime":i},children:[{type:"text",value:r}]});else if("github"===o.type){const n=void 0===i||i.toLowerCase().includes("invalid");u.push({type:"element",tagName:"github-result",attributes:{id:e,title:t,...o.authorName&&{"author-username":o.authorName},...o.statusTag&&{status:o.statusTag},"repo-name":o.githubRepoName,...o.path&&{path:o.path},...!n&&{"last-edited-datetime":i},...o.fileType&&{"file-type":o.fileType}},children:[{type:"text",value:r}]})}else"jira"===o.type?u.push({type:"element",tagName:"jira-result",attributes:{id:e,title:t,"last-edited-datetime":i,project:o.path},children:[{type:"text",value:r}]}):"microsoftTeams"===o.type||("sharepoint"===o.type?u.push({type:"element",tagName:"sharepoint-result",attributes:{id:e,title:t,"last-edited-datetime":i,...o.fileType&&{"file-type":o.fileType}},children:[{type:"text",value:r}]}):"page"===o.type?u.push({type:"element",tagName:"page-result",attributes:{id:e,title:t,path:o.path,"last-edited-datetime":i},children:[{type:"text",value:r}]}):(0,a().HB)(o))}const p={},m=o().hS(t.flatMap((e=>{const{id:t,pageId:r,type:n}=e;if(t&&r&&(p[t]={deIdentifiedId:r,type:n}),"block"===e.type||"properties"===e.type){const t=l.find((t=>t.attributes.id===e.pageId));return t?[t]:[]}if("github"===e.type||"google-drive"===e.type||"jira"===e.type||"microsoftTeams"===e.type||"sharepoint"===e.type||"page"===e.type||"slack"===e.type||"helpdoc"===e.type||"webpage"===e.type){const t=u.find((t=>t.attributes.id===e.id));return t?[t]:[]}if("helpdoc-section"===e.type){const t=u.find((t=>"helpdoc"===t.tagName&&t.children.some((t=>t.attributes.id===e.id))));return t?[t]:[]}(0,a().HB)(e)})),"attributes.id");return{type:"observation",observationType:"search",value:{type:"element",resultType:"universal",tagName:"search-results",attributes:{"current-results":m.length.toString()},children:m},containsNonSpaceSharedResults:n,systemMessages:r,idToDeIdentifiedIds:p}}function c(e){const t=["numbered_list","bulleted_list","text"];let r=[];return e.reduce(((n,o,i)=>{const s=o.blockType,l=[...n],d=(0,a().Xk)(t,s),c=d&&r.length>0&&o.text.length<750&&(p=r,(m=o).spanIndex-p[0].spanIndex<=5&&m.spanIndex-p[0].spanIndex>=0);var p,m;r.length>0&&(!c||r.length>10)&&(1===r.length?l.push(r[0]):l.push(u(r)),r=[]);return d&&0===r.length&&o.text.length<500||c?(r.push(o),i===e.length-1&&(l.push(u(r)),r=[])):l.push(o),l}),[])}function u(e){const t=e[0];return{type:"block",id:t.id,text:e.map((e=>e.text)).join("\n"),path:t.path,isPrivate:t.isPrivate,pageId:t.pageId,title:t.title,lastEdited:t.lastEdited,blockType:t.blockType,spanIndex:t.spanIndex}}},316808:(e,t,r)=>{"use strict";r.d(t,{g:()=>o});r(296540);var n=r(474848);const o=(0,r(340498).wt)("filterCircled",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M8 15.126C11.8623 15.126 15.0615 11.9336 15.0615 8.06445C15.0615 4.20215 11.8623 1.00293 7.99316 1.00293C4.13086 1.00293 0.938477 4.20215 0.938477 8.06445C0.938477 11.9336 4.1377 15.126 8 15.126ZM8 13.7383C4.85547 13.7383 2.33301 11.209 2.33301 8.06445C2.33301 4.91992 4.84863 2.39746 7.99316 2.39746C11.1377 2.39746 13.667 4.91992 13.6738 8.06445C13.6738 11.209 11.1445 13.7383 8 13.7383ZM4.41797 6.75879H11.5889C11.9307 6.75879 12.1699 6.54688 12.1699 6.22559C12.1699 5.9043 11.9307 5.68555 11.5889 5.68555H4.41797C4.07617 5.68555 3.84375 5.9043 3.84375 6.22559C3.84375 6.54688 4.07617 6.75879 4.41797 6.75879ZM5.36816 9.02148H10.6455C10.9805 9.02148 11.2197 8.80273 11.2197 8.48145C11.2197 8.16016 10.9805 7.94141 10.6455 7.94141H5.36816C5.02637 7.94141 4.78711 8.16016 4.78711 8.48145C4.78711 8.80273 5.02637 9.02148 5.36816 9.02148ZM6.35254 11.2773H9.6543C9.99609 11.2773 10.2354 11.0654 10.2354 10.7441C10.2354 10.4229 9.99609 10.2041 9.6543 10.2041H6.35254C6.01074 10.2041 5.77148 10.4229 5.77148 10.7441C5.77148 11.0654 6.01074 11.2773 6.35254 11.2773Z"})})},349348:(e,t,r)=>{"use strict";r.d(t,{Y:()=>o});r(296540);var n=r(474848);const o=(0,r(340498).wt)("newWindowPlus",{viewBox:"0 0 33 25",svg:(0,n.jsx)("path",{d:"M5.11328 10.5V3.92578C5.11328 2.66797 5.4375 1.71875 6.08594 1.07812C6.73438 0.4375 7.69141 0.117188 8.95703 0.117188H29.0195C30.293 0.117188 31.2539 0.4375 31.9023 1.07812C32.5508 1.71875 32.875 2.66797 32.875 3.92578V18.1875C32.875 19.4375 32.5508 20.3828 31.9023 21.0234C31.2539 21.6719 30.293 21.9961 29.0195 21.9961H12.8711C13.0898 21.6523 13.2695 21.2852 13.4102 20.8945C13.5586 20.5039 13.668 20.1016 13.7383 19.6875H28.8906C29.4297 19.6875 29.8438 19.5469 30.1328 19.2656C30.4219 18.9844 30.5664 18.5586 30.5664 17.9883V6.1875H7.42188V10.5C7.22656 10.4688 7.03125 10.4453 6.83594 10.4297C6.64062 10.4141 6.44922 10.4062 6.26172 10.4062C6.06641 10.4062 5.87109 10.4141 5.67578 10.4297C5.48828 10.4375 5.30078 10.4609 5.11328 10.5ZM8.07812 3.15234C8.07812 3.44141 8.18359 3.69531 8.39453 3.91406C8.61328 4.13281 8.87109 4.24219 9.16797 4.24219C9.47266 4.24219 9.73047 4.13281 9.94141 3.91406C10.1602 3.69531 10.2695 3.44141 10.2695 3.15234C10.2695 2.86328 10.1602 2.60938 9.94141 2.39062C9.73047 2.17187 9.47266 2.0625 9.16797 2.0625C8.87109 2.0625 8.61328 2.17187 8.39453 2.39062C8.18359 2.60938 8.07812 2.86328 8.07812 3.15234ZM11.5352 3.15234C11.5352 3.44922 11.6406 3.70703 11.8516 3.92578C12.0625 4.13672 12.3203 4.24219 12.625 4.24219C12.9297 4.24219 13.1875 4.13672 13.3984 3.92578C13.6172 3.70703 13.7266 3.44922 13.7266 3.15234C13.7266 2.86328 13.6172 2.60938 13.3984 2.39062C13.1875 2.17187 12.9297 2.0625 12.625 2.0625C12.3203 2.0625 12.0625 2.17187 11.8516 2.39062C11.6406 2.60938 11.5352 2.86328 11.5352 3.15234ZM14.9922 3.15234C14.9922 3.44922 15.0977 3.70703 15.3086 3.92578C15.5195 4.13672 15.7773 4.24219 16.082 4.24219C16.3789 4.24219 16.6328 4.13672 16.8438 3.92578C17.0625 3.70703 17.1719 3.44922 17.1719 3.15234C17.1719 2.86328 17.0625 2.60938 16.8438 2.39062C16.6328 2.17187 16.3789 2.0625 16.082 2.0625C15.7773 2.0625 15.5195 2.17187 15.3086 2.39062C15.0977 2.60938 14.9922 2.86328 14.9922 3.15234ZM6.27344 24.1406C5.44531 24.1406 4.66797 23.9844 3.94141 23.6719C3.21484 23.3594 2.57422 22.9219 2.01953 22.3594C1.46484 21.8047 1.03125 21.1641 0.71875 20.4375C0.398438 19.7109 0.238281 18.9336 0.238281 18.1055C0.238281 17.2773 0.398438 16.5 0.71875 15.7734C1.03125 15.0469 1.46484 14.4062 2.01953 13.8516C2.57422 13.2891 3.21484 12.8516 3.94141 12.5391C4.66797 12.2266 5.44531 12.0703 6.27344 12.0703C7.10156 12.0703 7.87891 12.2266 8.60547 12.5391C9.33203 12.8516 9.97266 13.2852 10.5273 13.8398C11.082 14.3945 11.5156 15.0391 11.8281 15.7734C12.1484 16.5 12.3086 17.2773 12.3086 18.1055C12.3086 18.9258 12.1484 19.6992 11.8281 20.4258C11.5156 21.1602 11.0781 21.8047 10.5156 22.3594C9.96094 22.9141 9.31641 23.3477 8.58203 23.6602C7.85547 23.9805 7.08594 24.1406 6.27344 24.1406ZM6.27344 21.9258C6.51562 21.9258 6.70703 21.8516 6.84766 21.7031C6.99609 21.5547 7.07031 21.3633 7.07031 21.1289V18.9023H9.29688C9.53125 18.9023 9.72266 18.832 9.87109 18.6914C10.0195 18.543 10.0938 18.3477 10.0938 18.1055C10.0938 17.8633 10.0195 17.6719 9.87109 17.5312C9.72266 17.3828 9.53125 17.3086 9.29688 17.3086H7.07031V15.082C7.07031 14.8477 6.99609 14.6562 6.84766 14.5078C6.70703 14.3594 6.51562 14.2852 6.27344 14.2852C6.03125 14.2852 5.83594 14.3594 5.6875 14.5078C5.54688 14.6562 5.47656 14.8477 5.47656 15.082V17.3086H3.25C3.01562 17.3086 2.82422 17.3828 2.67578 17.5312C2.52734 17.6719 2.45312 17.8633 2.45312 18.1055C2.45312 18.3477 2.52734 18.543 2.67578 18.6914C2.82422 18.832 3.01562 18.9023 3.25 18.9023H5.47656V21.1289C5.47656 21.3633 5.54688 21.5547 5.6875 21.7031C5.83594 21.8516 6.03125 21.9258 6.27344 21.9258Z"})})},353566:(e,t,r)=>{"use strict";r.d(t,{Mz:()=>m,Yf:()=>h,TE:()=>V,fw:()=>g,W6:()=>b,vr:()=>y,vt:()=>z,et:()=>f,AR:()=>W,N:()=>w,p$:()=>ke,Eo:()=>T,WH:()=>q,nc:()=>D,mK:()=>K,yK:()=>S,XD:()=>x,Hh:()=>O,WM:()=>E,qY:()=>N,UQ:()=>j,xR:()=>P,C1:()=>A,FO:()=>R,wu:()=>M,TM:()=>B,uz:()=>_,Yh:()=>v,By:()=>C,ZL:()=>ie,zY:()=>I,__:()=>k,$P:()=>F,lo:()=>L,Bq:()=>H,oq:()=>G,UO:()=>$,D6:()=>U,F1:()=>ve});r(16280),r(944114),r(517642),r(658004),r(733853),r(845876),r(432475),r(515024),r(731698),r(898992),r(354520),r(672577),r(430670),r(803949),r(581454);var n=()=>r(244641),o=()=>r(496603),a=()=>r(534177),i=()=>r(251582),s=()=>r(181856),l=()=>r(252050),d=()=>r(857639);var c=()=>r(316581),u=()=>r(292722),p=()=>r(162278);const m=16,h=20;function g(e){var t;const r=e.children??[];return{type:"block",tagName:e.tagName,parent:null===(t=e.parent)||void 0===t?void 0:t.attributes.id,attributes:{...e.attributes},children:"database-views"===e.tagName?e.children:r.map((e=>e.attributes.id)),text:e.text,properties:e.properties,schemas:e.schemas,schemaId:e.schemaId,persisted:e.persisted}}function f(e){const t=new Map;for(const[o,a]of Object.entries(e))for(const e of a.children){var r;if("string"==typeof e)t.set(e,o);else if(null!==(r=e.attributes)&&void 0!==r&&r.id){var n;t.set(null===(n=e.attributes)||void 0===n?void 0:n.id,o)}}return t}function y(e){const{node:t,getBlockById:r,alreadyConvertedBlocks:n=new Map,childIdToParentIdMap:o,assistantLoggingData:i}=e,s=n.get(t.attributes.id);if(s)return s;let l;if(t.parent&&"object"==typeof t.parent)l=t.parent;else{let e;if(e=t.parent&&"string"==typeof t.parent?t.parent:null==o?void 0:o.get(t.attributes.id),e){const a=r(e);if(!a)return void(i&&function(e,t){const{spaceId:r,userId:n,sessionId:o}=e,{parentTagType:a,parentId:i}=t;d().log({level:"debug",from:"convertAssistantBlockToBlockNode",type:"parentNotFound",data:{userId:n,spaceId:r,sessionId:o,miscDataToConvertToString:{parentTagType:a,parentId:i}}})}(i,{parentTagType:t.tagName,parentId:t.attributes.id}));l=y({node:a,getBlockById:r,alreadyConvertedBlocks:n,childIdToParentIdMap:o})}}l&&n.set(l.attributes.id,l);const c={type:t.type,tagName:t.tagName,parent:l,attributes:{...t.attributes},text:t.text,properties:t.properties,schemas:t.schemas,children:[],persisted:t.persisted,schemaId:t.schemaId};return n.set(c.attributes.id,c),c.children=t.children.map((e=>{if("string"==typeof e){const a=r(e);if(!a){if("database-views"===t.tagName)return;return void(i&&function(e,t){const{spaceId:r,userId:n,sessionId:o}=e,{parentTagType:a,parentId:i,childBlockId:s}=t;d().log({level:"debug",from:"convertAssistantBlockToBlockNode",type:"childNotFound",data:{userId:n,spaceId:r,sessionId:o,miscDataToConvertToString:{parentTagType:a,childBlockId:s,parentId:i}}})}(i,{parentTagType:t.tagName,parentId:t.attributes.id,childBlockId:e}))}return y({node:a,getBlockById:r,alreadyConvertedBlocks:n,childIdToParentIdMap:o,assistantLoggingData:i})}return e})).filter(a().O9),c}function b(e){const{node:t,blockIdMap:r,childIdToParentIdMap:n,alreadyConvertedBlocks:o,assistantLoggingData:a}=e;return y({node:t,getBlockById:e=>r instanceof Map?r.get(e):r[e],childIdToParentIdMap:n,alreadyConvertedBlocks:o,assistantLoggingData:a})}const v={"load-page":M,"query-database":async function(e){const{state:t,observationNode:r}=e,n=r.query.databaseId,o=function(e){const{id:t,state:r}=e,n=r.getCollectionFromCollectionIdMap(t);if(n)return n;for(const o of Array.from(r.getBlockIdMap_DO_NOT_USE().values()))if("block"===o.type&&"database-views"===o.tagName)for(const e of o.children)if("collectionView"===e.type&&"database-view"===e.tagName&&e.attributes.id===t){const t=e.attributes["database-id"];return r.getCollectionFromCollectionIdMap(t)}}({id:n,state:t});if(!o)throw new(s().Te)("database_not_found",`Database not found: ${n}`);fe(r.query.filter,o),function(e,t){for(const r of e){if(!t.schemas[r.propertyName])throw new(s().Te)("sort_invalid_property_name",`<sort> property name "${r.propertyName}" not found in database "${t.attributes.id}"`)}}(r.query.sorts,o),function(e,t){if(!e)return;const r=e.attributes.name,n=t.schemas[r];if(!n)throw new(s().Te)("aggregation_invalid_property_name",`<${e.tagName}> property name "${r}" does not exist in database`);const{propertyTagName:o}=l().U4[n.tagName];if(e.tagName!==`aggregation-${o}`)throw new(s().Te)("aggregation_invalid_property_tag_name",`Filter for property name "${r}" must be <aggregation-${o}>, not <${e.tagName}>`)}(r.query.aggregation,o);const a={databaseId:o.attributes.id,filter:r.query.filter,sorts:r.query.sorts,search:r.query.search,aggregation:r.query.aggregation,limit:r.query.limit},i=await t.queryDatabase(a);function d(e){t.doesBlockIdMapHaveBlock(e.attributes.id)||t.setBlockIdMapForBlock(e.attributes.id,e);for(const t of e.children)"block"===t.type&&d(t)}for(const s of i.results)d(s);for(const s of i.dependentAssistantNodes)"block"===s.type?t.doesBlockIdMapHaveBlock(s.attributes.id)||t.setBlockIdMapForBlock(s.attributes.id,s):(t.addCollectionToCollectionIdMap(s.attributes.id,s),t.setSchemaIdMapForSchema(s.schemaId,s.schemas));return[{type:"observation",observationType:"queryDatabase",value:xe({requestAggregation:r.query.aggregation,queryDatabaseResult:i,databaseQuery:a}),databaseId:o.attributes.id}]},search:F,"search-people":async function(e){const{state:t,observationNode:r}=e,{search:n}=r.attributes,o=await t.searchPeople(n),a={type:"element",tagName:"search-people-results",attributes:{"current-results":Math.min(6,o.results.length).toString(),"total-results":o.total.toString()},children:o.results.slice(0,6).map((e=>{const{id:t,name:r,email:n}=e;return{type:"element",tagName:"person",attributes:{"person-id":t},children:[{type:"element",tagName:"property-text",attributes:{name:"Name"},children:[{type:"text",value:r}]},{type:"element",tagName:"property-email",attributes:{name:"Email"},children:[{type:"text",value:n}]}]}}))};return t.appendNewSearchPeopleResult(o.results),[{type:"observation",observationType:"searchPeople",value:a}]},"load-database":N,load:O,"search-databases":L,"load-slack":B,"load-attachment":E,"load-web-page":_,"load-google-drive":A,"load-github":j,"load-github-code":P,"load-jira":R};function x(e){return e.tagName in v}function k(e,t){return"load-page"===e.tagName||"query-database"===e.tagName||"search"===e.tagName||"search-people"===e.tagName||"load-database"===e.tagName||"search-databases"===e.tagName||"load-slack"===e.tagName||"load-attachment"===e.tagName||"load-web-page"===e.tagName||"load-google-drive"===e.tagName||"load-github"===e.tagName||"load-github-code"===e.tagName||"load-jira"===e.tagName?v[e.tagName]({observationNode:e,state:t}):void(0,a().HB)(e)}const w={"insert-before":D,"insert-after":q,"insert-inside":K,delete:function(e){const{state:t,effectNode:r}=e,n=r.attributes.id;if("property"===r.deleteType){const e=t.getBlockFromBlockIdMap(n);if("child-page"!==e.tagName)throw new(s().Te)("delete_property_on_non_database_child_page","Cannot call delete on a non-database child-page.");const[o]=r.children;switch(o.tagName){case"property-relation":!function(e){var t;let{parentBlock:r,relationPropertyName:n,relationPropertyUpdates:o,state:a}=e;const i=new Set(he({propertyChild:o,parentBlock:r,propertyName:n,action:"delete",state:a})),l=r.properties[n];if("property-relation"!==l.tagName)throw new(s().Te)("invalid_relation_property_child","Invalid property child when setting relation");const d=l.children.filter((e=>{const t=e.attributes["page-id"];return!i.has(t)})),c={...l,children:d};r.properties[n]=c,a.addOperation({command:"setBlockProperty",blockNode:r,parentBlockId:null===(t=r.parent)||void 0===t?void 0:t.attributes.id,property:c})}({parentBlock:e,relationPropertyName:o.attributes.name,relationPropertyUpdates:o,state:t});break;case"property-person":ne({parentBlock:e,personPropertyUpdate:o,state:t,action:"delete"});break;case"property-multi-select":oe({parentBlock:e,multiSelectPropertyName:o.attributes.name,multiSelectPropertyUpdates:o,state:t,action:"delete"});break;default:(0,a().HB)(o)}}else if("block"===r.deleteType){ie({remove:[t.getBlockFromBlockIdMap(n)],state:t})}else"table-column"===r.deleteType?W({state:t,effectNode:r}):(0,a().HB)(r)},"set-title":U,"set-attribute":H,"set-tag-name":$,"set-property":G,chat:V,"chat-md":function(e){const{state:t,effectNode:r}=e,n=["⁰","¹","²","³","⁴","⁵","⁶","⁷","⁸","⁹"];let o=r.text;const a=/\[([0-9])\]/g;let i,s=1;for(;null!==(i=a.exec(r.text));)o=o.replace(i[0],`[${n[s]}](${t.getIdMapper().mapCounterToKey(i[1]).key.replaceAll("-","")})`),s++;t.chatMd(o)},"persist-blocks":function(e){const{state:t,effectNode:r}=e,n=J({parent:void 0,children:r.children,state:t});for(const o of n)ee({block:o,state:t})},create:z,"related-content":()=>[]};function S(e){return e.tagName in w}function I(e,t){return"chat"===e.tagName||"insert-after"===e.tagName||"delete"===e.tagName||"insert-before"===e.tagName||"insert-inside"===e.tagName||"persist-blocks"===e.tagName||"create"===e.tagName||"set-attribute"===e.tagName||"set-property"===e.tagName||"set-tag-name"===e.tagName||"set-title"===e.tagName||"chat-md"===e.tagName||"related-content"===e.tagName?w[e.tagName]({effectNode:e,state:t}):void(0,a().HB)(e)}const T=["load-database","load-page","load","query-database","search","search-people","chat","create","search-databases","load-slack","insert-before","insert-after","insert-inside","delete","set-title","set-attribute","set-tag-name","set-property","replace","create-page","replace"],C={search:3,"search-people":3,"query-database":3,load:10,"load-page":10,"load-database":10,"search-databases":3};async function N(e){const{state:t,observationNode:r}=e,{attributes:{id:n}}=r,{databaseNode:a,relatedNodes:i}=await t.loadDatabase(n);t.markDatabaseAsLoaded(n),t.addCollectionToCollectionIdMap(n,a),t.setSchemaIdMapForSchema(a.schemaId,a.schemas);const s=[];for(const{node:o,shouldShowObservation:l}of i)t.markDatabaseAsLoaded(o.attributes.id),t.setSchemaIdMapForSchema(o.schemaId,o.schemas),t.addCollectionToCollectionIdMap(o.attributes.id,o),l&&s.push(o);return o().hS([a,...s],(e=>e.attributes.id)).map((e=>"block"===e.type?{type:"observation",observationType:"page",pageId:e.attributes.id,value:e}:{type:"observation",observationType:"database",databaseId:e.attributes.id,value:e}))}async function M(e){const{state:t,observationNode:r}=e,{id:n}=r.attributes,{pageBlockNode:a,relatedNodes:i,relatedDatabaseNodes:s,isNonSpaceShared:l}=await t.loadPage(n);t.markPageAsLoaded(n),Z(t,a);const d=[];for(const{node:o,shouldShowObservation:c}of i)"block"===o.type&&(Z(t,o),c&&d.push(o));for(const o of s??[]){const e=o.node;t.addCollectionToCollectionIdMap(e.attributes.id,e),t.setSchemaIdMapForSchema(e.schemaId,e.schemas)}return o().hS([a,...d],(e=>e.attributes.id)).map((e=>({type:"observation",observationType:"page",pageId:e.attributes.id,value:e,isNonSpaceShared:l})))}async function _(e){const{state:t,observationNode:r}=e,{id:n}=r.attributes,o=await t.loadWebPage(n);t.markUniversalIdAsLoaded(n);const a={type:"observation",observationType:"webpage",value:{tagName:"webpage",type:"webpage",attributes:{id:n,title:o.AssistantWebpageSearchResult.title,"updated-datetime":o.AssistantWebpageSearchResult.lastEdited},children:[{type:"text",value:o.AssistantWebpageSearchResult.text}]}};return Y(t,a.value),[a]}async function B(e){const{state:t,observationNode:r}=e,{id:n}=r.attributes;try{const e=(await t.loadSlack(n)).slackMessage;t.markUniversalIdAsLoaded(n);const r={type:"slackMessages",tagName:"slack-messages",attributes:{id:n,channel:e.channel},children:e.messages.map((e=>({type:"slackMessage",tagName:"message",attributes:{user:e.user.name},value:e.text})))};return Y(t,r),[{type:"observation",observationType:"slack",value:r}]}catch(o){return[{type:"observation",observationType:"slack",value:{type:"slackMessages",tagName:"slack-messages",attributes:{id:n,channel:"unable to load"},children:[]}}]}}async function A(e){const{state:t,observationNode:r}=e,{id:n}=r.attributes;try{const e=(await t.loadGoogleDrive(n)).googleDriveContent;t.markUniversalIdAsLoaded(n);const r={type:"googleDrive",tagName:"google-drive",attributes:{id:(0,l().Fu)(e.fileId),fileType:e.fileType,title:e.title},children:e.blocks.map((e=>({type:"googleDriveBlock",tagName:"google-drive-block",value:e})))};return Y(t,r),[{type:"observation",observationType:"googleDrive",value:r}]}catch(o){return[{type:"observation",observationType:"googleDrive",value:{type:"googleDrive",tagName:"google-drive",attributes:{id:n,title:"unable to load",fileType:"unable to load"},children:[]}}]}}async function j(e){const{state:t,observationNode:r}=e,{id:n}=r.attributes;try{const e=(await t.loadGithub(n)).githubContent;t.markUniversalIdAsLoaded(n);const r={type:"github",tagName:"github",attributes:{id:(0,l().Tj)(e.prNumber),orgName:e.orgName,repoName:e.repoName,title:e.title},children:e.blocks.map((e=>({type:"githubBlock",tagName:"github-block",value:e})))};return Y(t,r),[{type:"observation",observationType:"github",value:r}]}catch(o){return[{type:"observation",observationType:"github",value:{type:"github",tagName:"github",attributes:{id:n,title:"unable to load",repoName:"unable to load",orgName:"unable to load"},children:[]}}]}}async function P(e){const{state:t,observationNode:r}=e,{id:n}=r.attributes;try{const e=(await t.loadGithubCode(n)).githubCodeContent;t.markUniversalIdAsLoaded(n);const r={type:"githubCode",tagName:"github-code",attributes:{id:(0,l().Tj)(e.codePath),...e}};return Y(t,r),[{type:"observation",observationType:"githubCode",value:r}]}catch(o){return[{type:"observation",observationType:"github",value:{type:"github",tagName:"github",attributes:{id:n,title:"unable to load",repoName:"unable to load",orgName:"unable to load"},children:[]}}]}}async function R(e){const{state:t,observationNode:r}=e,{id:n}=r.attributes;try{const e=(await t.loadJira(n)).jiraContent;t.markUniversalIdAsLoaded(n);const r={type:"jira",tagName:"jira",attributes:{id:n,title:e.title},children:[{type:"text",value:e.text}]};return Y(t,r),[{type:"observation",observationType:"jira",value:r}]}catch(o){return[{type:"observation",observationType:"jira",value:{type:"jira",tagName:"jira",attributes:{id:n,title:"unable to load"},children:[{type:"text",value:""}]}}]}}async function E(e){const{state:t,observationNode:r}=e,{id:n}=r.attributes;if("pdf"===r.attributes.attachmentType)return t.markAttachmentAsLoaded(n),async function(e){const{state:t,observationNode:r}=e,{id:n}=r.attributes,{pdfContent:o}=await t.loadPdf(n),a={type:"attachment",tagName:"attachment",attributes:{id:n,attachmentType:"pdf"},children:o.textContent.map((e=>({type:"attachmentContent",tagName:"attachment-content",attributes:{assistantAttachmentContentId:(0,l().Y1)()},value:e})))};return[{type:"observation",observationType:"attachment",value:a}]}({state:t,observationNode:r});(0,a().HB)(r.attributes.attachmentType)}function O(e){const{observationNode:t,state:r}=e;return"load-page"===t.tagName?M({state:r,observationNode:t}):"load-database"===t.tagName?N({state:r,observationNode:t}):"load-slack"===t.tagName?B({state:r,observationNode:t}):"load-google-drive"===t.tagName?A({state:r,observationNode:t}):"load-github"===t.tagName?j({state:r,observationNode:t}):"load-github-code"===t.tagName?P({state:r,observationNode:t}):"load-attachment"===t.tagName?E({state:r,observationNode:t}):"load-web-page"===t.tagName?_({state:r,observationNode:t}):"load-jira"===t.tagName?R({state:r,observationNode:t}):void(0,a().HB)(t)}async function F(e){const{state:t,observationNode:r}=e,{question:n,keywords:o,lookback:a}=r.attributes;return await async function(e){const{state:t,query:r}=e,n=await t.search(r);return(0,c().nt)({searchResults:n.searchResults,state:t}),[(0,c()._A)(n)]}({state:t,query:{question:n,keywords:o,lookback:a,questionIntl:r.attributes["question-intl"],database:r.attributes.database,channel:r.attributes.channel,sourcePreference:r.attributes.source,sort:r.attributes.sort,fileType:r.attributes["file-type"],contributor:r.attributes.contributor,repo:r.attributes.repo,maybeNotionHelp:"true"===r.attributes[l().HV]}})}async function L(e){const{state:t,observationNode:r}=e,{results:n,total:o}=await t.searchDatabases(r.attributes.search),a=n.map((e=>{const{id:t,title:r}=e;return{type:"collection",tagName:"database",parent:e.parentId,attributes:{id:t,title:r},persisted:!0,schemaId:e.parentId,schemas:{},properties:{}}})),i={type:"element",tagName:"search-databases-results",attributes:{"current-results":n.length.toString(),"total-results":o.toString()},children:a};return t.appendNewSearchDatabasesResult(a),[{type:"observation",observationType:"searchDatabases",value:i}]}function D(e){const{state:t,effectNode:r}=e,{id:n}=r.attributes,o=t.getBlockFromBlockIdMap(n),i=t.getIdMapper().mapKeyToCounter({type:"block",key:n});if("page"===o.tagName&&"block"===r.insertType){const e=o.children[0];return e?void D({state:t,effectNode:{type:"effect",tagName:"insert-before",insertType:"block",attributes:{id:e.attributes.id},children:r.children}}):void K({state:t,effectNode:{type:"effect",tagName:"insert-inside",insertType:"block",attributes:{id:o.attributes.id},children:r.children}})}if(!o.parent)throw new(s().Te)("block_has_no_parent",`Cannot <insert-before> block with id ${i} because it has no parent.`);if("block"!==r.insertType)if("table"===r.insertType){const{name:e}=r.attributes;if("table"!==o.tagName)throw new(s().Te)("insert_before_name_not_on_table",`Cannot <insert-before> block with id ${i} with name attribute only works on tables.`);const n=Number(e);if(!Number.isInteger(n)||n<1)throw new(s().Te)("insert_before_invalid_column_index",`Invalid column index: ${n}.`);for(const t of o.children){if(!t.properties[e])throw new(s().Te)("insert_before_property_does_not_exist",`Property ${e} does not exist on table row.`)}ae({tableBlockNode:o,children:r.children,atZeroBasedIndex:n-1,state:t})}else(0,a().HB)(r);else{const e=o.parent,n=e.children.findIndex((e=>e.attributes.id===o.attributes.id)),a=J({parent:e,children:r.children,state:t});if(n<0)throw new(s().Te)("block_not_found",`Cannot <insert-before> block with id ${i} as it no longer exists. Do not reference block with id ${i}.`);const{parentForOperation:l}=re({parent:e,index:n,insert:a,state:t});for(const r of a)t.addOperation({command:"insertBlockBefore",parentId:l.attributes.id,insertBlockNode:r,beforeId:o.attributes.id}),"page"===r.tagName&&(t.markPageAsLoaded(r.attributes.id),t.setBlockIdMapForBlock(r.attributes.id,r))}}function q(e){const{state:t,effectNode:r}=e,{id:n}=r.attributes,o=t.getIdMapper().mapKeyToCounter({type:"block",key:n}),i=t.getBlockFromBlockIdMap(n);if("page"===i.tagName&&"block"===r.insertType){const e=i.children[0];return e?void D({state:t,effectNode:{type:"effect",tagName:"insert-before",insertType:"block",attributes:{id:e.attributes.id},children:r.children}}):void K({state:t,effectNode:{type:"effect",tagName:"insert-inside",insertType:"block",attributes:{id:i.attributes.id},children:r.children}})}if(!i.parent)throw new(s().Te)("block_not_found",`Cannot <insert-after> block with id ${o} as it no longer exists. Do not reference block with id ${o}.`);if("block"!==r.insertType)if("table"===r.insertType){const{name:e}=r.attributes;if("table"!==i.tagName)throw new(s().Te)("insert_after_name_not_on_table",`Cannot <insert-after> block with id ${o} using name attribute as this only works on tables.`);const n=Number(e);if(!Number.isInteger(n)||n<1)throw new(s().Te)("insert_after_invalid_column_index",`Invalid column index: ${n}.`);for(const t of i.children){if(!t.properties[e])throw new(s().Te)("insert_after_property_does_not_exist",`Property ${e} does not exist on table row.`)}ae({tableBlockNode:i,children:r.children,atZeroBasedIndex:n,state:t})}else(0,a().HB)(r);else{const e=i.parent,n=e.children.findIndex((e=>e.attributes.id===i.attributes.id)),a=J({parent:e,children:r.children,state:t});if(n<0)throw new(s().Te)("block_not_found",`Cannot <insert-after> block with id ${o} as it no longer exists. Do not reference block with id ${o}.`);const{parentForOperation:l}=re({parent:e,index:n+1,insert:a,state:t}),d=[...a].reverse();for(const r of d)t.addOperation({command:"insertBlockAfter",parentId:l.attributes.id,insertBlockNode:r,afterId:i.attributes.id}),"page"===r.tagName&&(t.markPageAsLoaded(r.attributes.id),t.setBlockIdMapForBlock(r.attributes.id,r))}}function K(e){const{state:t,effectNode:r}=e;if("block"!==r.insertType)if("blockIntoDatabase"!==r.insertType)if("property"===r.insertType){const e=r.attributes.id,n=t.getBlockFromBlockIdMap(e);if("child-page"!==n.tagName&&"page"!==n.tagName)throw new(s().Te)("append_properties_to_page_only","You can only append to properties on a page object.");const o=r.children[0];switch(o.tagName){case"property-relation":!function(e){var t;const{parentBlock:r,relationPropertyName:n,relationPropertyUpdates:o,state:i}=e,l=he({propertyChild:o,parentBlock:r,propertyName:n,action:"append",state:i}),d=(0,a().O)(r.properties,n)?r.properties[n]:void 0;if("property-relation"!==(null==d?void 0:d.tagName))throw new(s().Te)("invalid_relation_property_child","Invalid property child when setting relation");for(const a of l){const e={type:"inline",tagName:"mention-page",attributes:{"page-id":a},children:[]};d.children.push(e)}i.addOperation({command:"setBlockProperty",blockNode:r,parentBlockId:null===(t=r.parent)||void 0===t?void 0:t.attributes.id,property:d})}({parentBlock:n,relationPropertyName:o.attributes.name,relationPropertyUpdates:o,state:t});break;case"property-person":ne({parentBlock:n,personPropertyUpdate:o,state:t,action:"append"});break;case"property-multi-select":oe({parentBlock:n,multiSelectPropertyName:o.attributes.name,multiSelectPropertyUpdates:o,state:t,action:"append"});break;default:throw new(s().Te)("invald_child_tag_for_insert_inside","Invalid child tag for insert-inside")}}else(0,a().HB)(r);else{const e=r.attributes.id,n=t.getCollectionFromCollectionIdMap(e);if(!n)throw new Error(`No database to insert block ${r.attributes.id}`);const o=J({parent:void 0,children:r.children,state:t,databaseSchemaId:n.schemaId});for(const r of o)ee({block:r,state:t,databaseSchemaId:n.schemaId}),t.addOperation({command:"setBlockParent",parentId:n.schemaId,blockNode:r}),t.markPageAsLoaded(r.attributes.id),t.setBlockIdMapForBlock(r.attributes.id,r)}else{const e=r.attributes.id,n=t.getBlockFromBlockIdMap(e),o=J({parent:n,children:r.children,state:t}),a=n.children.length,{parentForOperation:i}=re({parent:n,index:a,insert:o,state:t});for(const r of o)t.addOperation({command:"insertBlockAfter",parentId:i.attributes.id,insertBlockNode:r}),"page"===r.tagName&&(t.markPageAsLoaded(r.attributes.id),t.setBlockIdMapForBlock(r.attributes.id,r))}}function U(e){const{state:t,effectNode:r}=e,n=r.attributes.id,a=t.getBlockFromBlockIdMap(n),i=t.getIdMapper().mapKeyToCounter({type:"block",key:n});if(!l().sA[a.tagName].title&&"page"!==a.tagName)throw new(s().Te)("block_does_not_allow_title",`Block with id ${i} is a <${a.tagName}>, which does not allow title.`);const d=r.children;o().n4(a.text,d)||(t.addOperation({command:"setBlockText",blockNode:a,text:d}),a.text=d)}function H(e){const{state:t,effectNode:r}=e,{id:n,attributes:o}=r,a=t.getBlockFromBlockIdMap(n),i=Object.fromEntries(Object.entries(l().sA[a.tagName].attributes).map((e=>{let[t,{values:r}]=e;return[t,r]})));for(const{key:l,value:d}of o){const e=i[l];if(!e)throw new(s().Te)("attempted_to_set_invalid_attribute",`Attempted to set an attribute on ID ${t.getIdMapper().mapKeyToCounter({type:"block",key:n})} that is not allowed: ${l}.`);if(!0!==e&&!e.includes(d))throw new(s().Te)("attempted_to_set_invalid_attribute_value",`Attempted to set attribute on ID ${t.getIdMapper().mapKeyToCounter({type:"block",key:n})} ${l} to value that is not allowed: ${d}.`);t.addOperation({command:"setBlockAttribute",blockNode:a,attribute:l,value:d}),a.attributes[l]=d}}function $(e){const{state:t,effectNode:r}=e,{id:n,newTagName:o}=r.attributes,a=t.getBlockFromBlockIdMap(n);a.tagName=o,t.addOperation({command:"setBlockTagName",blockNode:a,tagName:o})}function V(e){let{state:t,effectNode:r}=e;const{actionButtons:n,children:o,uncited:a}=r,i=J({parent:void 0,children:o,state:t}),s=i.map((e=>e.attributes.id)),l=[...i,...i.flatMap((e=>(0,u().Os)(e)))].map((e=>({command:"createBlock",blockNode:e})));t.chat({blockIds:s,operations:l,actionButtons:n,uncited:a})}function z(e){const{state:t,effectNode:r}=e,n=J({parent:void 0,children:r.children,state:t});if(1!==n.length)throw new(s().Te)("create_effect_no_children","<create> must have a single page block.");for(const o of n){if("page"!==o.tagName)throw new(s().Te)("create_effect_must_have_page","<create> must have a single page block.");ee({block:o,state:t}),t.addOperation({command:"addBlockToPage",blockNode:o}),t.markPageAsLoaded(o.attributes.id)}}function W(e){const{state:t,effectNode:r}=e,n=r.attributes.id,o=t.getBlockFromBlockIdMap(n);if("table"!==o.tagName)throw new(s().Te)("delete_name_not_on_table","<delete> with name attribute can only be used on <table> blocks.");const a=r.attributes.name,i=Number(a);for(const l of o.children){const e=l.properties;if(1===Object.keys(e).length)throw new(s().Te)("cannot_delete_last_property",`Cannot delete property ${a} from row because it is the last property.`);if(!e[a])throw new(s().Te)("cannot_delete_nonexistent_property",`Cannot delete property ${a} from row because it does not exist.`);delete e[a];let t=i;for(;e[t+1];)e[t+1].attributes.name=t.toString(),t++}t.addOperation({command:"removeTableColumn",blockNode:o,columnIndex:i-1})}function Q(e){const{block:t,property:r}=e,n=r.attributes.name;if((0,a().O)(t.properties,n))return t.properties[n];if("property-title"===r.tagName)for(const o of(0,a().uv)(t.properties)){const e=t.properties[o];if("property-title"===e.tagName)return e}}function G(e){const{state:t,effectNode:r}=e,n=r.attributes.id,o=r.children;for(const i of o){const e=t.getBlockFromBlockIdMap(n),r=i.attributes.name;if("tr"!==e.tagName){const o=Q({block:e,property:i});if(!o){let o=`Cannot set property '${r}' on block with id=${t.getIdMapper().mapKeyToCounter({type:"block",key:n})}.`;throw Object.keys(e.properties).length>0?o+=` These are properties that can be set: ${Object.keys(e.properties).join(",")}`:o+=" When setting the property of a page inside a database, you may need to <load> first.",new(s().Te)("cannot_set_property_on_block",o)}if(o.tagName!==i.tagName)throw new(s().Te)("cannot_set_property_to_different_type",`Attempted to set a property to a different tag name: ${o.tagName} -> ${i.tagName}.`)}var a;if("property-relation"===i.tagName)X({block:e,propertyName:r,state:t,newPropertyValue:i});else"property-select"===i.tagName||"property-multi-select"===i.tagName||"property-status"===i.tagName?me({newPropertyValue:i,parentBlock:e,propertyName:r,state:t}):"property-number"===i.tagName?le({newPropertyValue:i}):"property-date"===i.tagName&&pe({newPropertyValue:i}),e.properties[r]=i,t.addOperation({command:"setBlockProperty",blockNode:e,parentBlockId:null===(a=e.parent)||void 0===a?void 0:a.attributes.id,property:i})}}function Z(e,t){const r=[t],n=new Set;let o;for(;o=r.pop();)n.has(o.attributes.id)||(e.setSchemaIdMapForSchemaIfNotExists(o.schemaId,o.schemas),e.setBlockIdMapForBlock(o.attributes.id,o),"database-views"!==o.tagName&&r.push(...o.children),n.add(o.attributes.id))}function Y(e,t){e.setUniversalIdMapForUniversalNode(t.attributes.id,t)}function X(e){var t;const{block:r,propertyName:n,state:o,newPropertyValue:a}=e;he({propertyChild:a,parentBlock:r,propertyName:n,state:o,action:"overwrite"}),r.properties[n]=a,o.addOperation({command:"setBlockProperty",blockNode:r,parentBlockId:null===(t=r.parent)||void 0===t?void 0:t.attributes.id,property:a})}function J(e){const{state:t,children:r,databaseSchemaId:n,parent:o}=e;return r.map((e=>be({state:t,parsedBlock:e,parent:o,databaseSchemaId:n})))}function ee(e){const{block:t,state:r,databaseSchemaId:n}=e;if(!t.persisted&&"database-views"!==t.tagName){r.addOperation({command:"createBlock",blockNode:t,databaseSchemaId:n});for(const e of t.children)ee({block:e,state:r});t.persisted=!0}}function te(e){const{parent:t,state:r}=e;if("synced-block-reference"===t.tagName){if(!t.attributes["synced-block-id"])throw new(s().Te)("invalid_synced_block_reference","Synced block reference missing synced-block-id!");return r.getBlockFromBlockIdMap(t.attributes["synced-block-id"])}return t}function re(e){const{parent:t,index:r,insert:n,state:o}=e,a=Array.isArray(n)?n:[n],i=te({parent:t,state:o}),d=l().sA[i.tagName].content,c=a.map((e=>e.tagName));for(const l of c)if(!d.includes(l)){if("child-page"===t.tagName)throw new(s().Te)("invalid_insert",`You attempted to insert a ${l} inside a child-page, which is invalid. You may have wanted to insert this ${l} in a database instead.`);throw new(s().Te)("invalid_insert",`You attempted to insert a ${l} inside ${t.tagName}. ${d.length>0?`${t.tagName} allows only children of type ${d.join(", ")}`:`${t.tagName} is not allowed children of any type.`}`)}for(let l=a.length-1;l>=0;l--){const e=a[l];if("block"!==e.type)throw new(s().Te)("cannot_insert_non_block_node","Cannot insert a non-block node.");e.parent=i,i.children.splice(r,0,e),ee({block:e,state:o})}return{parentForOperation:i}}function ne(e){var t;const{parentBlock:r,personPropertyUpdate:n,state:i,action:l}=e,d=n.attributes.name,c=(0,a().O)(r.properties,d)?r.properties[d]:void 0;if("property-person"!==(null==c?void 0:c.tagName))throw new(s().Te)("invalid_person_property_child","Invalid property child when appending to person property");const u=function(e){const{propertyChild:t,parentBlock:r,propertyName:n,state:i,action:l}=e,d=t.children.filter((e=>"mention-person"===e.tagName)).map((e=>e.attributes["person-id"])),c=i.getSchemaFromSchemaIdMapIfExists(r.schemaId);if(!c)throw new(s().Te)("schema_not_found",`Database ${r.schemaId} was not found. You may need to use load-database to load it first.`);if(!(0,a().O)(c,n))throw new(s().Te)("cannot_update_nonexistent_property","Invalid schema for person property");const u=c[n];if("schema-property-person"!==u.tagName)throw new(s().Te)("invalid_schema_for_person_property","Invalid property schema for property person");const p=u.attributes.limit;switch(l){case"overwrite":if(d.length>1&&"1"===p)throw new(s().Te)("cannot_set_too_many_people_for_person_property","Tried to set too many people for person property with limit 1");return d;case"append":{const e=r.properties[n].children.filter((e=>"mention-person"===e.tagName)).map((e=>e.attributes["person-id"])),t=o().sb([...d,...e]);if(t.length>1&&"1"===p)throw new(s().Te)("cannot_set_too_many_people_for_person_property","Tried to set too many people for person property with limit 1");return t}case"delete":{const e=r.properties[n].children.filter((e=>"mention-person"===e.tagName)).map((e=>e.attributes["person-id"]));return o().R9(e,d)}default:(0,a().HB)(l)}}({propertyChild:n,parentBlock:r,propertyName:d,state:i,action:l}),p=[];for(const o of u){const e={type:"inline",tagName:"mention-person",attributes:{"person-id":o,"person-name":void 0},children:[]};p.push(e)}c.children=p,i.addOperation({command:"setBlockProperty",blockNode:r,parentBlockId:null===(t=r.parent)||void 0===t?void 0:t.attributes.id,property:c})}function oe(e){var t;let{parentBlock:r,multiSelectPropertyName:n,multiSelectPropertyUpdates:i,state:d,action:c}=e;const u=function(e){const{propertyChild:t,parentBlock:r,propertyName:n,action:i}=e,l=t.children.map((e=>e.attributes.option));switch(i){case"overwrite":return l;case"append":{if(!(0,a().O)(r.properties,n))throw new(s().Te)("cannot_append_to_nonexistent_property",`"${n}" missing from properties`);const e=r.properties[n].children.map((e=>e.attributes.option));return o().sb([...l,...e])}case"delete":{if(!(0,a().O)(r.properties,n))throw new(s().Te)("cannot_delete_from_nonexistent_property",`"${n}" missing from properties`);const e=r.properties[n].children.map((e=>e.attributes.option));return o().R9(e,l)}default:(0,a().HB)(i)}}({propertyChild:i,parentBlock:r,propertyName:n,action:c}),p=[];for(const o of u){const e={type:"inline",tagName:"option",attributes:{option:(0,l().Su)(o)},children:[]};p.push(e)}const m=(0,a().O)(r.properties,n)?r.properties[n]:void 0;if("property-multi-select"!==(null==m?void 0:m.tagName))throw new(s().Te)("invalid_multi_select_property_child","Invalid property child when updating multi-select");m.children=p,me({state:d,propertyName:n,newPropertyValue:m,parentBlock:r}),d.addOperation({command:"setBlockProperty",blockNode:r,parentBlockId:null===(t=r.parent)||void 0===t?void 0:t.attributes.id,property:m})}function ae(e){const{tableBlockNode:t,children:r,atZeroBasedIndex:n,state:o}=e;let i=n+1;const d=[];for(const c of r){if("move"===c.type){const e=c.attributes.name;if(!e)throw new(s().Te)("move_inside_insert_requires_name_attribute","<move> inside <insert-X> with name attribute requires name attribute.");for(const r of t.children){if((0,l().gc)(r))throw new Error(`Invalid table operation for block node: ${r.tagName}`);const t=r.properties;if(!(0,a().O)(t,e))throw new(s().Te)("move_inside_insert_property_does_not_exist",`Property ${e} does not exist on table row.`)}if(d.includes(e))throw new(s().Te)("cannot_move_property_more_than_once",`Cannot move property ${e} more than once.`);d.push(e)}else if("schema"===c.type){if(c.attributes.name!==i.toString())throw new(s().Te)("insert_inside_insert_requires_properties_in_order","<insert-X> with name attribute requires properties to be in order.")}else(0,a().HB)(c);i++}for(const c of t.children){if((0,l().gc)(c))throw new Error(`Invalid table operation for block node: ${c.tagName}`);const e=Object.values(c.properties).filter((e=>!d.includes(e.attributes.name))).sort(((e,t)=>Number(e.attributes.name)-Number(t.attributes.name))),t=e.map((e=>Number(e.attributes.name))),o=t.indexOf(Math.max(...t.filter((e=>e<n+1))))+1,i=Object.fromEntries([...e.slice(0,o),...r.map((e=>{if("move"===e.type){if((0,a().O)(c.properties,e.attributes.name))return c.properties[e.attributes.name];throw new(s().Te)("property_missing_in_table_row",`"${e.attributes.name}" was missing in table row node properties`)}if("schema"===e.type){return{type:"property",tagName:"property-text",attributes:{name:e.attributes.name},children:[]}}(0,a().HB)(e)})),...e.slice(o)].map(((e,t)=>{const r=t+1;return[r,{...e,attributes:{...e.attributes,name:r.toString()}}]})));c.properties=i}o.addOperation({command:"insertOrMoveTableColumns",blockNode:t,atIndex:n,insertOrMoves:r})}function ie(e){const{remove:t,state:r}=e;for(const n of t){if(!n.parent)throw new(s().Te)("cannot_remove_block_without_parent",`Cannot remove block with id=${r.getIdMapper().mapKeyToCounter({type:"block",key:n.attributes.id})} because it has no parent.`);const e=te({parent:n.parent,state:r});if("child-page"===n.tagName&&"database-views"===n.parent.tagName)r.addOperation({command:"removeBlock",parentId:e.attributes.id,removeBlockNode:n});else{const t=e.children.findIndex((e=>e.attributes.id===n.attributes.id));if(t<0)throw new(s().Te)("cannot_remove_block_without_parent",`Cannot remove block with id=${r.getIdMapper().mapKeyToCounter({type:"block",key:n.attributes.id})} because it has no parent.`);r.addOperation({command:"removeBlock",parentId:e.attributes.id,removeBlockNode:n}),n.parent.children.splice(t,1)}}}const se=/^\s*[+-]?(\d+|\d*\.\d+|\d+\.\d*)([Ee][+-]?\d+)?\s*$/;function le(e){const{newPropertyValue:t}=e;if(t.attributes.number&&!se.test(t.attributes.number))throw new(s().Te)("invalid_number_format","Invalid value for number property")}const de=/\d{4}-\d{2}-\d{2}/,ce=/\d{2}:\d{2}/;function ue(e){const{date:t,time:r}=e;if(!de.test(t))throw new(s().Te)("invalid_date_format","Invalid date for date property: incorrect format");if(r&&!ce.test(r))throw new(s().Te)("invalid_time_format","Invalid time for date property: incorrect format");let o;const a=e.timeZone?{zone:e.timeZone}:void 0;if(o=r?n().c9.fromFormat(`${t}T${r}`,"yyyy-MM-dd'T'HH:mm",a):n().c9.fromFormat(`${t}`,"yyyy-MM-dd"),!o.isValid)throw new(s().Te)("invalid_date_format","Invalid date for date property");return o}function pe(e){const{newPropertyValue:t}=e;if(0===t.children.length)return;if(t.children.length>1)throw new(s().Te)("invalid_date_format","Invalid value for date property. Expected only 1 child.");const[r]=t.children;if("mention-date"===r.tagName)ue({date:r.attributes.date});else if("mention-datetime"===r.tagName)ue({date:r.attributes.date,time:r.attributes.time});else if("mention-date-range"===r.tagName){const e=ue({date:r.attributes["start-date"]}),t=ue({date:r.attributes["end-date"]});if(e.valueOf()>t.valueOf())throw new(s().Te)("invalid_date_range","Invalid date range: start must be before end")}else if("mention-datetime-range"===r.tagName){const e=ue({date:r.attributes["start-date"],time:r.attributes["start-time"]}),t=ue({date:r.attributes["end-date"],time:r.attributes["end-time"]});if(e.valueOf()>t.valueOf())throw new(s().Te)("invalid_date_range","Invalid date range: start must be before end")}else(0,a().HB)(r)}function me(e){const{newPropertyValue:t,parentBlock:r,propertyName:n,state:o}=e,a=o.getSchemaFromSchemaIdMapIfExists(r.schemaId);if(!a)throw new(s().Te)("schema_not_found",`Database ${r.schemaId} was not found. You may need to use load-database to load it first.`);const i=a[n];if(!i||i.tagName!==`schema-${t.tagName}`)throw new(s().Te)("invalid_schema_for_property","Invalid schema for block. You may need to use load-database to load the database schema first.");const l=new Set;for(const s of i.children)if("schema-option"===s.tagName&&l.add(s.attributes.option),"schema-option-category"===s.tagName)for(const e of s.children)l.add(e.attributes.option);for(const d of t.children)if(!l.has(d.attributes.option))throw new(s().Te)("invalid_option_value",`Invalid option value: ${d.attributes.option}`);if("property-multi-select"!==t.tagName&&t.children.length>1)throw new(s().Te)("invalid_option_value","Invalid option value: limited to 1 option")}function he(e){const{propertyChild:t,parentBlock:r,propertyName:n,state:o,action:i}=e,l=o.getSchemaFromSchemaIdMapIfExists(r.schemaId);if(!l)throw new(s().Te)("schema_not_found",`Database ${r.schemaId} was not found. You may need to use load-database to load it first.`);const d=t.children.map((e=>e.attributes["page-id"]));if("page"!==r.tagName&&"child-page"!==r.tagName)throw new(s().Te)("cannot_set_relation_property_on_non_page","Attempted to set relation property on a block that isn't a page");const c=r.properties[n];if(!c)throw new(s().Te)("cannot_set_relation_property_on_nonexistent_property",`There is no relation property named ${n}`);if("property-relation"!==c.tagName)throw new(s().Te)("cannot_set_relation_property_on_non_relation_property",`The ${n} property is not a relation`);const u=c.attributes["database-id"];if(!u)throw new(s().Te)("cannot_set_relation_property_on_nonexistent_database","Attempted to set relation property on a page that's not in a database");const p=l[n];if(!p||"schema-property-relation"!==p.tagName)throw new(s().Te)("invalid_schema_for_property","Invalid schema for block");const m=o.getCollectionFromCollectionIdMap(u);if("database"!==(null==m?void 0:m.tagName))throw new(s().Te)("ivalid_database_id_for_relation_property","Invalid database id for relation property");const h=o.getPageIdToBlockIdMap();for(const a of d){const e=h.get(a);if(!e)throw new(s().Te)("invalid_page_id_for_mention",`Invalid page id: ${a}`);if(o.getBlockFromBlockIdMap(e).schemaId!==m.schemaId)throw new(s().Te)("invalid_page_id_for_relation","Invalid page id for relation")}switch(i){case"overwrite":if("1"===p.attributes.limit&&d.length>1)throw new(s().Te)("cannot_set_too_many_pages_for_relation_property","Too many mentioned page ids for a relation field with limit 1");return d;case"append":{const e=r.properties[n];if("property-relation"!==e.tagName)throw new(s().Te)("invalid_relation_property_child","Invalid property child when setting relation");const t=new Set(e.children.map((e=>e.attributes["page-id"])));if(d.forEach(t.add,t),t.size>1&&"1"===p.attributes.limit)throw new(s().Te)("cannot_set_too_many_pages_for_relation_property",`Too many mentioned page ids for a relation field with limit ${p.attributes.limit}`);return d}case"delete":{const e=r.properties[n];if("property-relation"!==e.tagName)throw new(s().Te)("invalid_relation_property_child","Invalid property child when setting relation");const t=new Set(e.children.map((e=>e.attributes["page-id"])));for(const r of d)if(!t.has(r))throw new(s().Te)("cannot_delete_page_id_not_in_relation","Attempting to delete pageId not contained in relation.");return d}default:(0,a().HB)(i)}}function ge(e,t){const r=e.propertyName,n=t.schemas[r];if(!n)throw new(s().Te)("filter_invalid_property_name",`<filter-${e.propertyTagName}> property name "${r}" does not exist in database`);const{propertyTagName:o}=l().U4[n.tagName];if(e.propertyTagName!==o)throw new(s().Te)("filter_invalid_property_tag_name",`Filter for property name "${r}" must be <filter-${o}>, not <filter-${e.propertyTagName}>`);if("schema-property-select"===n.tagName||"schema-property-multi-select"===n.tagName){if("property-select"!==e.propertyTagName&&"property-multi-select"!==e.propertyTagName)throw new(s().Te)("filter_invalid_property_tag_name","Unexpected filter type");for(const t of e.children)if(!n.children.find((e=>e.attributes.option===t.attributes.option)))throw new(s().Te)("filter_invalid_option",`<filter-${e.propertyTagName}> has invalid option: ${t.attributes.option}. Remember to wrap the option in <option> tags.`)}if("schema-property-status"===n.tagName){if("property-status"!==e.propertyTagName)throw new(s().Te)("filter_invalid_property_tag_name","Unexpected filter type");for(const t of e.children)if("option-category"===t.tagName){if(!n.children.find((e=>e.attributes.category===t.attributes.category)))throw new(s().Te)("filter_invalid_category",`<filter-${e.propertyTagName}> has invalid category: ${t.attributes.category}`)}else if("option"===t.tagName){if(!n.children.flatMap((e=>e.children)).find((e=>e.attributes.option===t.attributes.option)))throw new(s().Te)("filter_invalid_option",`<filter-${e.propertyTagName}> has invalid option: ${t.attributes.option}. Remember to wrap the option in <option> tags.`)}else(0,a().HB)(t)}}function fe(e,t){for(const r of e.filters)"any"===r.operator||"all"===r.operator?fe(r,t):ge(r,t)}function ye(e){const{parsedBlock:t,persisted:r,parent:n,databaseSchemaId:o}=e;return(0,l().g5)(t.tagName),{tagName:t.tagName,type:"block",persisted:r,attributes:t.attributes,text:t.text,properties:t.properties,schemas:t.schemas,children:[],parent:n,schemaId:o??t.attributes.id}}function be(e){const{state:t,parsedBlock:r,parent:n,databaseSchemaId:o}=e;if("move"===r.type){const e=t.getBlockFromBlockIdMap(r.attributes.id);if(!n)throw new(s().Te)("cannot_move_block_without_parent","Parentless move node");return function(e){const{move:t,state:r,moveToParent:n}=e;for(const o of t){const e=r.getBlockFromBlockIdMap(o.attributes.id),t=r.getIdMapper().mapKeyToCounter({type:"block",key:e.attributes.id});if(!o.parent)throw new(s().Te)("cannot_move_block_without_parent",`Cannot move block without parent on block with id=${t}.`);r.addOperation({command:"moveBlock",parentId:n.attributes.id,oldParentId:o.parent.attributes.id,blockNode:o});const a=te({parent:o.parent,state:r}).children.findIndex((e=>e.attributes.id===o.attributes.id));if(a<0)throw new(s().Te)("cannot_move_block_without_parent",`Cannot move block without parent on block with id=${t}.`);o.parent.children.splice(a,1),o.parent=n}}({move:[e],state:t,moveToParent:n}),e}const a=ye({parsedBlock:r,persisted:!1,parent:n,databaseSchemaId:o});for(const i of r.children)a.children.push(be({state:t,parsedBlock:i,parent:a,databaseSchemaId:o}));return t.setBlockIdMapForBlock(a.attributes.id,a),t.setSchemaIdMapForSchema(a.schemaId,a.schemas),a}function ve(e){const{node:t,mapCounterToKey:r}=e;return function e(t,r){const n=ye({parsedBlock:t,parent:r,persisted:!0,databaseSchemaId:void 0});for(const o of t.children){if("move"===o.type)throw new(s().Te)("unexpected_move_node","Unexpected move node");n.children.push(e(o,n))}return n}((0,i().AZ)((0,p().V8)({allowMove:!1,allowUncited:!0,persisted:!0,mapCounterToKey:r}),t),void 0)}function xe(e){const{queryDatabaseResult:t,databaseQuery:r}=e,n=(0,l().aL)(r);return{type:"element",tagName:"query-database-results",attributes:{"total-results":t.total.toString(),id:n},children:[...t.results]}}const ke={version:m,context:{mode:"shared","available-commands":T},selection:void 0,loadedPageIds:[],schemaIdMap:{},peopleIdMap:{},blockIdMap:{},idMapper:{keyMap:[]},collectionIdMap:{},loadedDatabaseIds:[],loadedUniversalIds:[],universalIdMap:{},universalSearchResultPayloadMap:{},loadedAttachmentIds:[]}},358579:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});r(898992),r(430670);var n=()=>r(371621),o=()=>r(980382);function a(e){const{environment:t,sessionContext:r}=e,a=r.getAllPendingExecutableOperations();if(0===a.length)return;const i=a.flatMap((e=>{let{operations:t}=e;return t}));(0,n().gv)({environment:t,operations:i,caches:r.caches,attributionActor:r.attributionActor}),(0,o().I)({environment:t,assistantSessionContext:r})}},371621:(e,t,r)=>{"use strict";r.d(t,{BB:()=>A,CD:()=>R,_W:()=>j,gv:()=>_,r0:()=>M,y2:()=>N});r(16280),r(944114),r(517642),r(658004),r(733853),r(845876),r(432475),r(515024),r(731698),r(898992),r(354520),r(803949),r(581454);var n=()=>r(181856),o=()=>r(691309),a=()=>r(175482),i=()=>r(416504),s=()=>r(134025),l=()=>r(68263),d=()=>r(696706),c=()=>r(179034),u=()=>r(798880),p=()=>r(439180),m=()=>r(763824),h=()=>r(973647),g=()=>r(534177),f=()=>r(750660),y=()=>r(255460),b=()=>r(317909),v=()=>r(436725),x=()=>r(351360),k=()=>r(295169),w=()=>r(148832),S=()=>r(878710),I=()=>r(881480);async function T(e){const{environment:t,latentOperation:r,operationContext:n,inMemoryRecordCache:a,transaction:i}=e,s=x().default.state.currentSpaceStore,l=x().default.state.currentSpaceViewStore;if(!l||!s)throw new Error("No space or space view.");const d=new Set,{assistantOperation:u,type:p}=r;if("addBlockToPage"===p||"insertBlockAfter"===p){const e="addBlockToPage"===p?u.blockNode.attributes.id:u.insertBlockNode.attributes.id;d.add(e);const r=w().B.createChildStore(l,{id:(0,o().So)(e),table:c().ev}),{target:a}=n.addBlockToPage,m=s.id;let h;"insertBlockAfter"===p&&n.enforceDefaultInsertBehavior?(h={type:"page",id:u.parentId,spaceId:m},d.add(u.parentId)):"page"===a?(h={type:"page",id:n.addBlockToPage.pageId,spaceId:m},d.add(n.addBlockToPage.pageId)):"collection"===a?h={type:"collection",id:n.addBlockToPage.collectionId,spaceId:m}:"privatePages"===a?h={type:"space-private-pages",spaceId:m}:"team"===a?h={type:"team",id:n.addBlockToPage.teamspaceId,spaceId:m}:(0,g().HB)(a);const y={environment:t,value:h,targets:[r],transaction:i};"insertBlockAfter"===p?"team"===y.value.type||n.enforceDefaultInsertBehavior?await f().HY(y):await f().LC(y):"addBlockToPage"===p?await f().HY(y):(0,g().HB)(p)}else if("removeBlock"===p){const{actorPointer:e}=r.data,n=(0,o().o4)({assistantOperation:u,updateMetadata:{last_edited_by_table:e.table,last_edited_by_id:e.id,last_edited_time:Date.now()},includeRemoveFromParent:!0});for(const r of n){B({environment:t,operation:r,recordCache:a,transaction:i});const e=C({operation:r,environment:t,inMemoryRecordCache:a});e&&d.add(e)}}else(0,g().HB)(p);return{editedPageIds:d}}function C(e){const{operation:t,environment:r,inMemoryRecordCache:n}=e;if(t.pointer.table===c().ev){const e=new(w().B)(r,t.pointer,{inMemoryRecordCache:n});if(e.isPageBlock())return e.id}}async function N(e){const{environment:t,transaction:r,operations:n,inMemoryRecordCache:o,operationContext:i,useCrdtOverride:s}=e,l=new Set;for(const d of n)if("latentOperation"===d.type){const{latentOperation:e}=d,{editedPageIds:n}=await T({environment:t,latentOperation:e,operationContext:i,inMemoryRecordCache:o,transaction:r});n.forEach((e=>l.add(e)))}else if("operation"===d.type){const{operation:e}=d;B({environment:t,operation:(0,g().O9)(s)?(0,a().t)([{...e,args:(0,a().ir)(e.args)}],s)[0]:e,recordCache:o,transaction:r});const n=C({operation:e,environment:t,inMemoryRecordCache:o});n&&l.add(n)}else(0,g().HB)(d);return{editedPageIds:l}}function M(e){var t;const{assistantOperation:r,attributionActor:n,caches:a,environment:s,currentUserId:l}=e,d=(0,I().g)(),u=d.getSpaceId(),p=null===(t=x().default.state.currentSpaceViewStore)||void 0===t?void 0:t.id,m=h().Q.unwrap((0,o().Vz)({assistantOperation:r,actorPointer:n,getRecordValue:a.makeGetRecordValueFnFromUpdatesCache(l),spaceId:u,spaceViewId:p,useCrdt:d.table===c().ev&&d.useCrdt(),currentTimeZone:(0,i().P)()}));return m.length>0&&_({environment:s,operations:m,caches:a,attributionActor:n}),m}function _(e){const{environment:t,operations:r,caches:a,attributionActor:i,operationContext:s}=e,l=t.currentUser.id;if(!l)throw new Error("No current user.");const p=d().L3.isEqual(i,{id:l,table:u().oo}),m=new Set;a.commitTransaction({environment:t,transactionActions:b(),perform(e,a,i){const l=(0,o().g$)(r,s??(0,o().tF)({shouldRemoveBlocksFromParent:i}));for(const r of l){if(!P(t,r))throw new(n().Te)("page_edit_insufficient_permissions","Insufficient permissions to perform this edit. Respond with a chat instead.");r.pointer.table===c().ev&&m.add(r.pointer.id),B({environment:t,operation:r,recordCache:a,transaction:e})}},userAction:"assistantActions.applyTemporaryOperations",userId:l,...!p&&{skipUpdatingEditedMetadata:!0}});const h=x().default.state.mainEditorCurrentBlockStore;h&&y().YW(h,[...m])}function B(e){const{environment:t,operation:r,transaction:n,recordCache:o}=e;if((0,p().ph)(r))(0,v().e)({environment:t,operation:r,transaction:n,inMemoryRecordCache:o});else if(r.pointer.table===c().ev)(0,v().e)({environment:t,operation:r,transaction:n,inMemoryRecordCache:o});else if((0,s().$Y)(r)||(0,s().mP)(r)){const e=new(S().pm)({environment:t,pointer:r.pointer,path:r.path,recordStoreOptions:{inMemoryRecordCache:o}});b().applyOperation({store:e,operation:r,transaction:n})}else(0,g().HB)(r)}function A(){const e=k().default.getActiveSession();if(null!=e&&e.assistantConfigurationState.requestedOnPublicDomain)return(0,o().ze)();const t=x().default.state.currentSpaceViewStore;if(!t)throw new Error("No space view.");return(0,o().OS)(t.id)}function j(e){const t=x().default.state.currentSpaceViewStore;if(!t)throw new Error("No space view.");let r;const{type:n}=e;if("page"===n)r={addBlockToPage:{target:"page",pageId:e.id}};else if("space-private-pages"===n)r={addBlockToPage:{target:"privatePages",spaceViewId:t.id}};else if("collection"===n)r={addBlockToPage:{target:"collection",collectionId:e.id}};else if("team"===n)r={addBlockToPage:{target:"team",teamspaceId:e.id}};else{if("space"===n)throw new Error("Move to Space not supported");(0,g().HB)(n)}return r}function P(e,t){const r=t.pointer,n=new(S().pm)({environment:e,pointer:r}).getRole();return!n||(0,l().p2)(n)}async function R(e){const{environment:t,assistantOperations:r}=e,n=[];for(const i of r)"createBlock"===i.command&&(0,g().O9)(i.databaseSchemaId)&&n.push({id:i.databaseSchemaId,table:c().ev});const o=n.map((e=>new(w().B)(t,e)));await m().lX(o,500,(e=>e.load()));const a=o.map((e=>e.getCollectionStore())).filter(g().O9);await m().lX(a,500,(e=>e.load()))}},379819:(e,t,r)=>{"use strict";r.d(t,{A:()=>v});r(18107),r(967357);var n=r.n(r(32485)),o=r(296540),a=()=>r(588165),i=()=>r(484714),s=()=>r(56366),l=()=>r(401497),d=()=>r(498474),c=()=>r(356596),u=()=>r(115512),p=()=>r(563253),m=()=>r(948914),h=()=>r(125565),g=()=>r(295692),f=r(474848);function y(e,t){const{inline:o,title:a,focused:i,className:d,blueOutlineFocused:c,compact:u,shouldShowArrowUp:p}=e,m=(0,l().IS)((e=>({hoveredStyle:{background:e.buttonHoveredBackground}})),[]),g=(0,l().IS)((e=>({style:{minHeight:36,paddingTop:8,paddingBottom:8,width:u?"min-content":"100%",display:"flex",...c?{boxShadow:e.focusedShadow,borderRadius:6}:{}},textWrapper:{alignItems:void 0,flex:void 0,display:"block",textOverflow:"ellipsis",...o&&{alignItems:"baseline"}},icon:{display:"block",flexShrink:0,height:20,width:20,color:e.mediumTextColor,overflow:"visible"},enterIcon:{height:12,width:12,fill:e.mediumIconColor},iconContainer:{overflow:"visible"},compactButtonHover:{background:e.buttonHoveredBackground},compactButton:{borderRadius:44,marginLeft:10,marginRight:10,padding:"6px 12px",display:"inline-flex",boxShadow:c?e.focusedShadow:void 0,maxWidth:"calc(100% - 20px)"},menuItem:{overflow:"hidden"},menuItemTextWrapper:{marginLeft:0,marginRight:0},right:{marginLeft:i?8:void 0,marginRight:2}})),[o,c,i,u]);var y,v,x;const k={title:a,icon:(0,s().K8)((()=>r(430483).zD.isDeepFindEnabled()),[])?(y=r(799384).o,v=g.icon,x=g.iconContainer,(0,f.jsx)(h().A,{style:x,children:y(v)})):(0,f.jsx)(r(938987).cG,{style:g.icon,variant:"xsmall"}),style:g.style,textWrapperStyle:g.textWrapper,right:(0,f.jsx)(b,{shouldShowArrowUp:p,focused:i}),className:n()("notranslate",d),buttonStyle:{paddingLeft:2,width:u?"min-content":void 0},hoveredStyle:m.hoveredStyle};return(0,f.jsx)(r(760217).A,{...e,...k,disableTransition:!0,ignoreLocalHoverState:!0,ref:t})}function b(e){const{focused:t,shouldShowArrowUp:r}=e,{isElectron:n,isMac:o}=(0,i().Y0)(),h=(0,i().v3)(),{shortcut:y,shortcutString:b}=(0,s().K8)((()=>{var e;const t=null===(e=m().A.state.preferences)||void 0===e?void 0:e.notionAiShortcut,r=(0,a().c)(h.device,"notionAiCommandSearchDefault").at(0),n=t||r;if(!n)return{shortcut:void 0,shortcutString:void 0};const i=(0,p().z_)(n,o);return{shortcut:i,shortcutString:(0,p().Vd)(i,o)}}),[o,h]),v=(0,s().K8)((()=>.75*(0,u().ny)(h,"UIRegular")),[h]),x=(0,l().IS)((e=>({container:{fontSize:(0,u().ny)(h,"UISmall"),color:e.mediumIconColor},keyboardIconSize:{width:v-1,height:v-1,marginTop:.5},icon:{height:12,width:12,fill:e.mediumIconColor}})),[v,h]);return r?(0,f.jsx)("div",{style:x.container,children:(0,d().q)(x.icon)}):t?(0,f.jsx)("div",{style:x.container,children:(0,c().K)(x.icon)}):n&&y&&b?o?(0,f.jsx)(g().z,{shortcut:y,iconStyles:x.keyboardIconSize,containerStyles:x.container}):(0,f.jsx)("div",{style:x.container,children:b}):null}const v=o.forwardRef(y)},409066:(e,t,r)=>{"use strict";r.d(t,{E:()=>S});r(517642),r(658004),r(733853),r(845876),r(432475),r(515024),r(731698),r(898992),r(354520),r(581454),r(296540);var n=()=>r(484714),o=()=>r(56366),a=()=>r(784892),i=()=>r(687646),s=()=>r(179034),l=()=>r(959013),d=()=>r(972435),c=()=>r(825972),u=()=>r(106628),p=()=>r(351360),m=()=>r(630116),h=()=>r(614505),g=()=>r(305390),f=()=>r(16006),y=()=>r(297401),b=()=>r(881690),v=()=>r(821879),x=r(474848);const k={token:{display:"flex",alignItems:"center"},icon:{marginRight:4}},w=(0,l().YK)({searchPages:{defaultMessage:"Search pages",id:"searchPageFilter.searchTokenFilter.tokenInput.placeholder"},selectAPage:{defaultMessage:"Select a page",id:"searchPageFilter.searchTokenFilter.resultSection.title"}});function S(e){let{mode:t,title:r,blockIds:o,onChange:a,disabled:s,focused:m,onMenuDismiss:h,onMenuOpen:g,parentStore:f}=e;const y=(0,n().v3)();return(0,x.jsx)(v().A,{mode:t,hasItemsSelected:(null==o?void 0:o.length)>0,title:r,icon:i().k,iconStyles:M(y).recordIcon,items:o,onChange:a,focused:m,renderFilter:(e,t)=>(0,x.jsx)(_,{item:e,args:t,parentStore:f}),renderToken:(e,t)=>(0,x.jsx)(C,{item:e,handlers:t,blockIds:o,parentStore:f}),renderItemForSummary:e=>(0,x.jsx)(T,{item:e,parentStore:f}),addItemLabel:(0,x.jsx)(l().sA,{defaultMessage:"Add another page",id:"searchPageFilter.searchTokenFilter.addAPage.button"}),labelText:{title:r,tokenInputPlaceholder:d().A.formatMessage(w.searchPages),componentDebugName:"SearchPageFilter"},performRequest:e=>async function(e,t){let{query:r,current:n}=e;const{currentSpaceStore:o}=p().default.state;if(!o)return[];const a=await u().T.searchActions.load(),i=r?(await a.searchPageIds({environment:t,query:r,limit:20,spaceId:o.id,requireEditPermissions:!1,excludeTemplates:!1,source:"ancestor_filter_page_search",boostRecentlyViewedPages:!0})).results:c().NK.state.map((e=>e.pageId)),s=new Set(n);return i.filter((e=>!s.has(e)))}(e,y),renderResultMenuItem:(e,t)=>(0,x.jsx)(N,{item:e,props:t,parentStore:f}),disabled:s,onMenuDismiss:h,onMenuOpen:g})}function I(e,t){return m().Bv.createChildStore(t,{table:s().ev,id:e})}function T(e){let{item:t,parentStore:r}=e;const n=I(t,r);return(0,x.jsx)(f().A,{store:n,shouldWrap:!0,maxLength:50})}function C(e){let{item:t,handlers:r,blockIds:i,parentStore:s}=e;const l=(0,n().v3)(),d=k,c=1===i.length,u=I(t,s),p=(0,o().K8)((()=>u.getIcon()),[u]),m=(0,x.jsxs)("div",{style:d.token,children:[(0,x.jsx)(h().A,{disabled:!0,icon:p,isEmptyPage:!1,size:20,style:d.icon}),(0,x.jsx)(f().A,{store:u})]});return(0,x.jsx)(b().A,{format:l.device.isMobile?a().NY.Large:a().NY.Small,value:m,showRemoveButton:!0,onClickRemove:r.onRemove,isSingle:c,shouldShrink:!0,backgroundColor:"transparent",shouldWrap:!1})}function N(e){let{item:t,props:r,parentStore:n}=e;const a=(0,o().K8)((()=>I(t,n)),[t,n]);return(0,x.jsx)(g().A,{...r,store:a})}function M(e){return{menuItem:{minHeight:void 0,paddingTop:e.device.isMobile?12:4,paddingBottom:e.device.isMobile?12:4},menuItemTitle:{width:"100%"},labeledMenuItemTitle:{display:"inline-flex",alignItems:"center"},menuItemLabel:{marginRight:12},recordIcon:{fill:"currentColor"}}}function _(e){let{item:t,args:r,parentStore:o}=e;const{disabled:a,onRemove:i,onClick:s}=r,l=M((0,n().v3)()),d=I(t,o),c=(0,x.jsx)(y().A,{disabled:a,onClick:i});return(0,x.jsx)(g().A,{disabled:a,focused:!1,store:d,right:c,style:l.menuItem,desktopTitleStyle:l.menuItemTitle,onClick:s})}},471159:(e,t,r)=>{"use strict";r.d(t,{gO:()=>v});r(16280),r(18107),r(944114),r(517642),r(658004),r(733853),r(845876),r(432475),r(515024),r(731698),r(967357),r(898992),r(823215),r(354520),r(672577),r(430670),r(581454),r(737550);var n=()=>r(496603),o=()=>r(534177),a=()=>r(252050),i=()=>r(706461),s=()=>r(51618),l=()=>r(762282),d=(r(803949),r.n(r(42833))),c=r.n(r(542922));const u={h1:{disableRules:["list"]},h2:{disableRules:["list"]},h3:{disableRules:["list"]},text:{disableRules:[]},uli:{disableRules:["heading"]},oli:{disableRules:[]},toggle:{disableRules:[]},quote:{disableRules:[]},todo:{disableRules:[]}};function p(e){return"element"===e.type&&void 0!==u[e.tagName]}class m extends l().o0{constructor(){super(...arguments),this.name="ConvertUliWithNumberToOli"}applyImpl(e,t){return e.map((e=>this.convertUliWithNumberToOli(e)))}convertUliWithNumberToOli(e){if("text"===e.type)return e;if("uli"===e.tagName){const t=(e.children.length>0&&"text"===e.children[0].type?e.children[0].value:"").match(/^(\d+)\.\s(.*)$/);if(t){const r=[...e.children.slice(1)];""!==t[2]&&r.unshift({type:"text",value:t[2]}),e={type:"element",tagName:"oli",attributes:{index:t[1]},children:r},this.markModified()}return e}return{...e,children:e.children.map((e=>this.convertUliWithNumberToOli(e)))}}}class h extends l().o0{constructor(){super(...arguments),this.name="ConvertMarkdownFormattingToXMLUsingMarkdownIt"}applyImpl(e,t){return e.flatMap((e=>this.convertMarkdownFormattingToXMLUsingMarkdownIt(e)))}convertMarkdownFormattingToXMLUsingMarkdownIt(e){if("text"===e.type)return e;if(p(e)){const t=(0,i()._o)(e,!1,0,!0),n=";!--childPlaceholder--;",o="\x3c!--childPlaceholder--\x3e",a="\x3c!--lt--\x3e",s="\x3c!--gt--\x3e",l=[],p=e.children.map((e=>"element"===e.type?(l.push(e),{type:"text",value:n}):e)).map((e=>(0,i()._o)(e,!1,0,!0))).join("").replaceAll("&lt;",a).replaceAll("&gt;",s).replaceAll(n,o),{disableRules:m}=u[e.tagName];let g=(0,r(128713).uY)({markdown:p,LinkifyIt:d(),MarkdownIt:c(),options:{breaks:!0},disable:["newline",...m]}).replace(/\n+/g,"\n").replace(/>\n+</g,"><").replace(/>\n$/,">").replace(/^\n/,"");for(const[e,r]of Object.entries(h.REPLACEMENTS))g=g.replaceAll(e,r);g=g.replace(new RegExp(o,"g"),(()=>{const e=l.shift();return e?(0,i()._o)(e,!1,0,!0):""})).replaceAll(a,"&lt;").replaceAll(s,"&gt;");let f=(0,r(754093).BD)(g);1===f.length&&"element"===f[0].type&&"text"===f[0].tagName&&(f=f[0].children);const y={...e,children:f};return t!==(0,i()._o)(y,!1,0,!0)&&this.markModified(),y}return{...e,children:e.children.flatMap((e=>this.convertMarkdownFormattingToXMLUsingMarkdownIt(e)))}}}h.REPLACEMENTS={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#46;":".","<ul>":"","</ul>":"","<li>":"<uli>","</li>":"</uli>","<strong>":"<b>","</strong>":"</b>","<em>":"<i>","</em>":"</i>","<p>":"<text>","</p>":"</text>","<br>":"\n","<br/>":"\n"};class g extends l().o0{constructor(){super(...arguments),this.name="ConvertUnicodeBulletsToUlis"}applyImpl(e,t){return e.map((e=>this.convertUnicodeBulletsToUlis(e,!1)))}convertUnicodeBulletsToUlis(e,t){if("text"===e.type){const r=e.value.trim();if(r.startsWith("•")){this.markModified();const e=r.replaceAll("•","").trim();return t?{type:"text",value:e}:{type:"element",tagName:"uli",attributes:{},children:[{type:"text",value:e}]}}return e}const r="uli"===e.tagName||"oli"===e.tagName;return{...e,children:e.children.map((e=>this.convertUnicodeBulletsToUlis(e,r)))}}}class f extends l().o0{constructor(){super(...arguments),this.name="ConvertOlUliToOli"}applyImpl(e,t){return e.map((e=>this.convertOl(e)))}convertOl(e){return"text"===e.type?e:p(e)?(e=this.convertOlUliToOli(e),e=this.removeToDeleteNodes(e)):{...e,children:e.children.map((e=>this.convertOl(e)))}}convertOlUliToOli(e){if("element"===e.type&&"ol"===e.tagName){const t=e.children.filter((e=>"element"===e.type&&"uli"===e.tagName)),r=e.children.filter((e=>!("element"===e.type&&"uli"===e.tagName)));return{...e,tagName:"toDelete",children:[...t.map((t=>{var r;return{...t,tagName:"oli",attributes:{index:null===(r=e.attributes)||void 0===r?void 0:r.start}}})),...r]}}return"element"===e.type?{...e,children:e.children.map((e=>this.convertOlUliToOli(e)))}:e}removeToDeleteNodes(e){if("element"===e.type){let t=[];return e.children.forEach((e=>{"element"===e.type&&"toDelete"===e.tagName?(this.markModified(),t=t.concat(e.children)):t.push(this.removeToDeleteNodes(e))})),{...e,children:t}}return e}}class y extends l().o0{constructor(){super(...arguments),this.name="ConvertTextChildrenOfListItems"}applyImpl(e,t){return e.flatMap((e=>this.convertTextChildrenOfListItems(e)))}convertTextChildrenOfListItems(e){return"text"===e.type?e:"oli"===e.tagName||"uli"===e.tagName||"quote"===e.tagName?{...e,children:e.children.flatMap((e=>"element"===e.type&&"text"===e.tagName?(this.markModified(),e.children):e))}:{...e,children:e.children.map((e=>this.convertTextChildrenOfListItems(e)))}}}class b extends l().o0{constructor(){super(...arguments),this.name="CollapseRedundantParentTags"}applyImpl(e,t){return e.flatMap((e=>this.collapseRedundantParentTags(e)))}collapseRedundantParentTags(e){return"text"===e.type?e:p(e)?this.generalCollapse(e):{...e,children:e.children.map((e=>this.collapseRedundantParentTags(e)))}}generalCollapse(e){if("element"===e.type){for(const[t,[r,n]]of b.collapseRules){if(("hx"===r?/^h[1-3]$/.test(e.tagName):e.tagName===r)&&1===e.children.length&&"element"===e.children[0].type){const r=e.children[0],o="hx"===n?/^h[1-3]$/.test(r.tagName):r.tagName===n;if("element"===r.type&&o)return this.markModified(),{...r,tagName:"hx"===t?e.tagName:t,attributes:{...e.attributes,...r.attributes}}}}return{...e,children:e.children.map((e=>this.generalCollapse(e)))}}return e}}function v(e,t,r){const{nodes:n}=function(e){let{xmlNodes:t,state:r,debug:n=!1,autoFixerNamesToSkip:o}=e,a="",s="";const l=[],d=new Set(o??[]),c=ee.filter((e=>!d.has(e.name)));for(const u of c)n&&(a=t.map((e=>(0,i()._o)(e))).join("")),t=u.apply(t,r),n&&u.modified()&&(s=t.map((e=>(0,i()._o)(e))).join(""),l.push({name:u.name,before:a,after:s}));return{nodes:t,activeAutoFixerNames:c.filter((e=>e.modified())).map((e=>e.name)),debugLogs:l}}({xmlNodes:e,state:t,debug:!1,autoFixerNamesToSkip:r});return n}b.collapseRules=[["oli",["uli","oli"]],["uli",["hx","uli"]],["hx",["hx","oli"]],["hx",["hx","text"]],["text",["text","text"]],["b",["b","b"]],["uli",["text","uli"]],["uli",["uli","text"]],["oli",["text","oli"]],["oli",["oli","text"]],["toggle",["toggle","text"]],["quote",["quote","text"]],["todo",["todo","text"]],["oli",["oli","text"]]];class x extends l().o0{constructor(){super(...arguments),this.name="CleanupSearchTags"}applyImpl(e,t){return e.map((e=>this.cleanupSearchTags(e)))}cleanupSearchTags(e){if("element"!==e.type)return e;if("search"!==e.tagName)return e;const t=Object.fromEntries(Object.entries(e.attributes).map((e=>{let[t,r]=e;return"question"===t||"keywords"===t||"question-intl"===t?[t,r]:"source"===t?s().jT.includes(r)?["source",r]:void this.markModified():"lookback"===t?["lookback",r]:"channel"===t?["channel",r]:"sort"===t?["sort",r]:"file-type"===t?s().Km.includes(r)?["file-type",r]:void this.markModified():"contributor"===t?["contributor",r]:"repo"===t?["repo",r]:"database"===t?["database",r]:"database-id"===t?(this.markModified(),["database",r]):"search-notion-help"===t&&"true"===r?["search-notion-help","true"]:void this.markModified()})).filter((e=>void 0!==e)));return{...e,attributes:t}}}class k extends l().o0{constructor(){super(...arguments),this.name="CollapseTableSectionTags"}applyImpl(e,t){return e.flatMap((e=>this.collapseTableSectionTags(e)))}collapseTableSectionTags(e){return"element"===e.type?"thead"===e.tagName||"tbody"===e.tagName||"tfoot"===e.tagName?(this.markModified(),e.children.flatMap((e=>this.collapseTableSectionTags(e)))):[{...e,children:e.children.flatMap((e=>this.collapseTableSectionTags(e)))}]:[e]}}class w extends l().o0{constructor(){super(...arguments),this.name="CitationATagInnerTextRemover"}applyImpl(e,t){return e.map((e=>"element"===e.type&&"chat"===e.tagName?{...e,children:e.children.flatMap((e=>this.ensureCitationATagsHaveNoInnerText(e)))}:e))}ensureCitationATagsHaveNoInnerText(e){if("element"===e.type){if("a"===e.tagName){const t=e.attributes.href;if(t&&/^[0-9]+$/.test(t)){e.children.length>0&&this.markModified();const t=e.children.flatMap((e=>this.ensureCitationATagsHaveNoInnerText(e)));return e.children=[],[...t,e]}}const{children:t,...r}=e;return[{...r,children:t.flatMap((e=>this.ensureCitationATagsHaveNoInnerText(e)))}]}return[e]}}class S extends l().o0{constructor(){super(...arguments),this.name="MarkdownInlineNodeConverter"}applyImpl(e,t){return e.map((e=>"element"===e.type&&"chat"===e.tagName?{...e,children:e.children.flatMap((e=>this.convertInlineMarkdownToXML(e,[])))}:e))}convertInlineMarkdownToXML(e,t){const r=t.some((e=>"element"===e.type&&("code-block"===e.tagName||"code"===e.tagName||"math-block"===e.tagName)));if("text"!==e.type||r)return"element"===e.type?[{...e,children:e.children.flatMap((r=>this.convertInlineMarkdownToXML(r,[...t,e])))}]:[e];{const t=/(\*\*|~~|\*|`)(.+?)\1/g,r=[];let n,o=0;for(;null!==(n=t.exec(e.value));){const[a,i,s]=n,l=e.value.slice(o,n.index);let d;switch(l&&r.push({type:"text",value:l}),i){case"**":d={type:"element",tagName:"b",attributes:{},children:[{type:"text",value:s}]};break;case"*":d={type:"element",tagName:"i",attributes:{},children:[{type:"text",value:s}]};break;case"`":d={type:"element",tagName:"code",attributes:{},children:[{type:"text",value:s}]};break;case"~~":d={type:"element",tagName:"s",attributes:{},children:[{type:"text",value:s}]}}if(!d)throw new Error("Unreachable");r.push(d),this.markModified(),o=t.lastIndex}const a=e.value.slice(o);return a&&r.push({type:"text",value:a}),r}}}class I extends l().o0{constructor(){super(...arguments),this.name="RemoveExtraSearchNotionHelpAttributes"}applyImpl(e,t){const r=e.map((e=>(0,i()._o)(e))).join(""),n=this.removeExtraSearchNotionHelpAttributes(e);return r!==n.map((e=>(0,i()._o)(e))).join("")&&this.markModified(),n}removeExtraSearchNotionHelpAttributes(e){let t=!1;return e.map((e=>("element"===e.type&&"search"===e.tagName&&a().HV in e.attributes&&(t?(this.markModified(),delete e.attributes[a().HV]):t=!0),e)))}}class T extends l().o0{constructor(){super(...arguments),this.name="DowngradeBlocksToTextInSimpleTables"}applyImpl(e,t){return e.map((e=>this.downgradeBlocksToTextInSimpleTables(e)))}downgradeBlocksToTextInSimpleTables(e){return"text"===e.type?e:"table"===e.tagName?{...e,children:e.children.flatMap((e=>this.maybeConvertToInlineNode(e)))}:{...e,children:e.children.map((e=>this.downgradeBlocksToTextInSimpleTables(e)))}}maybeConvertToInlineNode(e){if("text"===e.type||(0,l().Qz)(e))return[e];if("text"===e.tagName||"h2"===e.tagName||"h1"===e.tagName||"h3"===e.tagName||"quote"===e.tagName||"todo"===e.tagName||"toggle"===e.tagName||"callout"===e.tagName||"code-block"===e.tagName||"math-block"===e.tagName)return this.markModified(),e.children.flatMap((e=>this.maybeConvertToInlineNode(e)));if("uli"===e.tagName||"oli"===e.tagName){const t=e.children.flatMap((e=>this.maybeConvertToInlineNode(e)));return this.markModified(),[{type:"text",value:"· "},...t]}{const t=e.children.flatMap((e=>this.maybeConvertToInlineNode(e)));return[{...e,children:t}]}}}class C extends l().o0{constructor(){super(...arguments),this.name="TextWrapTopLevelInlineNodes"}applyImpl(e,t){return e.map((e=>"element"!==e.type||"chat"!==e.tagName&&"insert"!==e.tagName&&"insert-before"!==e.tagName&&"insert-after"!==e.tagName&&"create-page"!==e.tagName&&"replace"!==e.tagName?e:this.textWrapTopLevelInlineNodes(e)))}textWrapTopLevelInlineNodes(e){if("element"===e.type){const t=[],r=this.trimLeadingAndTrailingWhitespace(e.children),n=e=>{if(e&&"element"===e.type&&(0,l().Y7)(e)){const t=e.children.at(-1);return!t||(0,l().Qz)(t)}return!1};for(const e of r)if((0,l().Qz)(e)){this.markModified();const r=t.at(-1);"element"===(null==r?void 0:r.type)&&n(r)?r.children.push(e):t.push({type:"element",tagName:"text",attributes:{},children:[e]})}else t.push(e);return{...e,children:t}}return e}}class N extends l().o0{constructor(){super(...arguments),this.name="WrapNodesWithRequiredParent",this.wrapNodesMap={td:"tr",tr:"table"}}applyImpl(e,t){return e.map((e=>this.wrapNodesWithRequiredParent(e)))}wrapNodesWithRequiredParent(e){if("element"===e.type){let t=e;for(const r of(0,o().uv)(this.wrapNodesMap))t.tagName!==this.wrapNodesMap[r]&&e.children.some((e=>"element"===e.type&&e.tagName===r))&&(this.markModified(),t={...e,children:[{type:"element",tagName:this.wrapNodesMap[r],attributes:{},children:e.children}]});return{...t,children:t.children.map((e=>this.wrapNodesWithRequiredParent(e)))}}return e}}class M extends l().o0{constructor(){super(...arguments),this.name="UnwrapHTMLLists"}applyImpl(e,t){return e.flatMap((e=>this.unwrapHTMLLists(e,void 0)))}unwrapHTMLLists(e,t){return"element"===e.type?"ul"===e.tagName||"ol"===e.tagName?(this.markModified(),e.children.flatMap((t=>this.unwrapHTMLLists(t,e.tagName)))):"li"===e.tagName?(this.markModified(),[{...e,tagName:"ol"===t?"oli":"uli",children:e.children.flatMap((e=>this.unwrapHTMLLists(e,t)))}]):[{...e,children:e.children.flatMap((e=>this.unwrapHTMLLists(e,t)))}]:[e]}}class _ extends l().o0{constructor(){super(...arguments),this.name="RemoveBlockIds"}applyImpl(e,t){return e.map((e=>this.removeBlockIds(e)))}removeBlockIds(e){if("element"===e.type){if((0,l().CD)(e)&&"unknown-block"!==e.tagName){e.attributes.id&&this.markModified();const t=n().cJ(e.attributes,"id");return{...e,attributes:t,children:e.children.map((e=>this.removeBlockIds(e)))}}return{...e,children:e.children.map((e=>this.removeBlockIds(e)))}}return e}}class B extends l().o0{constructor(){super(...arguments),this.name="FixCodeBlockLanguage"}applyImpl(e,t){return e.map((e=>this.fixCodeBlockLanguage(e)))}fixCodeBlockLanguage(e){if("element"===e.type){if("code-block"===e.tagName){const t=e.attributes.language;if(t&&!r(15440).yz.includes(t)){this.markModified();const t=n().cJ(e.attributes,"language");return{...e,attributes:t,children:e.children.map((e=>this.fixCodeBlockLanguage(e)))}}}return{...e,children:e.children.map((e=>this.fixCodeBlockLanguage(e)))}}return e}}class A extends l().o0{constructor(){super(...arguments),this.name="SanitizeTextNodes"}applyImpl(e,t){const r=e.map((e=>(0,i()._o)(e))).join(""),o=n().oE(e.map((e=>this.sanitizeTextNodes(e))));return r!==(0,i().PJ)(o)&&(this.modified()||this.markModified()),o}sanitizeTextNodes(e){if("element"===e.type){if((0,o().O)(a().sA,e.tagName)&&a().sA[e.tagName].title){let t=!1;const r=[...e.children],n=[],o=[];for(;r.length>0;){const e=r.shift();if((0,l().Qz)(e))if(t){const t=[e];for(;r.length>0&&(0,l().Qz)(r[0]);)t.push(r.shift());const o=this.trimLeadingAndTrailingWhitespace(t);o.length>0&&n.push({type:"element",tagName:"text",attributes:{},children:o})}else o.push(e);else{const r=this.sanitizeTextNodes(e);r&&n.push(r),t=!0}}const a=[...this.trimLeadingAndTrailingWhitespace(o),...n];return{...e,children:a}}return(0,o().O)(a().GU,e.tagName)?{...e,children:this.trimLeadingAndTrailingWhitespace(e.children)}:{...e,children:e.children?n().oE(e.children.map((e=>this.sanitizeTextNodes(e)))):[]}}{const t=e.value.trim();return t?t!==e.value?{...e,value:t}:e:void 0}}}class j extends l().o0{constructor(){super(...arguments),this.name="TrimLinesBetweenBrTags"}applyImpl(e,t){return e.map((e=>this.trimLinesBetweenBrTags(e)))}trimLinesBetweenBrTags(e){if("element"===e.type){if(e.children.some((e=>"element"===e.type&&"br"===e.tagName))){const t=e.children.map((e=>{if("text"===e.type){const t=e.value.trim();return t!==e.value?(this.markModified(),{type:"text",value:t}):e}return this.trimLinesBetweenBrTags(e)}));return{...e,children:t}}return{...e,children:e.children.map((e=>this.trimLinesBetweenBrTags(e)))}}return e}}class P extends l().o0{constructor(){super(...arguments),this.name="ConvertBrToNewline"}applyImpl(e,t){return e.flatMap((e=>this.convertBrToNewline(e)))}convertBrToNewline(e){return"element"===e.type?"br"===e.tagName?(this.markModified(),[{type:"text",value:"\n"}]):[{...e,children:e.children.flatMap((e=>this.convertBrToNewline(e)))}]:[e]}}class R extends l().o0{constructor(){super(...arguments),this.name="RemoveTopLevelWhitespace"}applyImpl(e,t){return e.flatMap((e=>"text"===e.type?(this.markModified(),[]):[e]))}}class E extends l().o0{constructor(){super(...arguments),this.name="ClampHeaderLevel",this.headerRegex=/^h(\d+)$/}applyImpl(e,t){return e.map((e=>this.clampHeaderLevel(e)))}clampHeaderLevel(e){if("element"!==e.type)return e;let t=e.tagName;const r=e.tagName.match(this.headerRegex);if(r){parseInt(r[1],10)>3&&(this.markModified(),t="h3")}return{...e,tagName:t,children:e.children.map((e=>this.clampHeaderLevel(e)))}}}class O extends l().o0{constructor(){super(...arguments),this.name="MoveCreatePageInChatToTopLevel"}applyImpl(e,t){return e.flatMap((e=>this.moveCreatePageInChatToTopLevel(e)))}moveCreatePageInChatToTopLevel(e){if("element"===e.type&&"chat"===e.tagName){const t=e.children.filter((e=>"element"===e.type&&"create-page"===e.tagName));if(0===t.length)return[e];this.markModified();const r=e.children.filter((e=>!t.includes(e)));return[{...e,children:r},...t]}return[e]}}class F extends l().o0{constructor(){super(...arguments),this.name="TransformTopLevelApisInCreatePageToCreatePage"}applyImpl(e,t){return e.map((e=>this.transformTopLevelApisInCreatePageToCreatePage(e)))}transformTopLevelApisInCreatePageToCreatePage(e){const t=["page","insert"];if("element"===e.type&&"create-page"===e.tagName){let r,n=[];for(const o of e.children)"element"===o.type&&t.includes(o.tagName)?(r||(r=o),n=[...n,...o.children]):n.push(o);return r?(this.markModified(),{type:"element",tagName:"create-page",attributes:{...r.attributes,...e.attributes.in&&{in:e.attributes.in}},children:n}):e}return e}}class L extends l().o0{constructor(){super(...arguments),this.name="MoveTopLevelCreateOrPageToCreatePage"}applyImpl(e,t){return e.map((e=>this.moveTopLevelCreateOrPageToCreatePage(e)))}moveTopLevelCreateOrPageToCreatePage(e){return"element"===e.type&&"page"===e.tagName?(this.markModified(),{type:"element",tagName:"create-page",attributes:{},children:e.children}):"element"===e.type&&"create"===e.tagName&&1===e.children.length&&"element"===e.children[0].type&&"page"===e.children[0].tagName?(this.markModified(),{type:"element",tagName:"create-page",attributes:{},children:e.children[0].children}):e}}class D extends l().o0{constructor(){super(...arguments),this.name="TagNameMapper",this.inlineTagNameMap={strong:"b",p:"text",span:"inline",sub:"inline",sup:"inline"}}applyImpl(e,t){return e=(e=e.flatMap((e=>this.mapTagNames(e,this.inlineTagNameMap)))).map((e=>"element"===e.type&&"chat"===e.tagName?{...e,children:e.children.flatMap((e=>this.mapTagNames(e,{chat:"text"})))}:e))}mapTagNames(e,t){if("element"===e.type){const r=t[e.tagName.toLowerCase()];if(void 0!==r&&this.markModified(),"inline"===r){return{type:"text",value:e.children.map((e=>"text"===e.type?e.value:"")).join("")}}const n=r||e.tagName;return{...e,tagName:n,children:e.children.map((e=>this.mapTagNames(e,t)))}}return e}}class q extends l().o0{constructor(){super(...arguments),this.name="UnwrapEmptyBlocks"}applyImpl(e,t){return e.flatMap((e=>this.unwrapEmptyBlocks(e)))}unwrapEmptyBlocks(e){if("element"===e.type){return!e.children.every((e=>(0,l().CD)(e)))||"uli"!==e.tagName&&"oli"!==e.tagName&&"text"!==e.tagName&&"toggle"!==e.tagName&&"quote"!==e.tagName?[{...e,children:e.children.flatMap((e=>this.unwrapEmptyBlocks(e)))}]:(this.markModified(),e.children.flatMap((e=>this.unwrapEmptyBlocks(e))))}return[e]}}class K extends l().o0{constructor(){super(...arguments),this.name="UnwrapSyncedBlocks"}applyImpl(e,t){return e.flatMap((e=>this.unwrapSyncedBlocks(e)))}unwrapSyncedBlocks(e){return"element"===e.type?"synced-block-reference"===e.tagName||"synced-block"===e.tagName?(this.markModified(),e.children.flatMap((e=>this.unwrapSyncedBlocks(e)))):[{...e,children:e.children.flatMap((e=>this.unwrapSyncedBlocks(e)))}]:[e]}}class U extends l().o0{constructor(){super(...arguments),this.name="RemoveDisallowedBlocks"}applyImpl(e,t){return e.flatMap((e=>this.removeDisallowedBlocks(e)))}removeDisallowedBlocks(e){return"element"===e.type?U.removeBlockTagNames[e.tagName]?(this.markModified(),[]):[{...e,children:e.children.flatMap((e=>this.removeDisallowedBlocks(e)))}]:[e]}}U.removeBlockTagNames={"database-views":!0};class H extends l().o0{constructor(){super(...arguments),this.name="UnwrapBlocksInProperties"}applyImpl(e,t){return e.flatMap((e=>this.unwrapBlocksInProperties(e)))}unwrapBlocksInProperties(e){if("element"===e.type){if((0,l().YV)(e))return[{...e,children:e.children.flatMap((e=>this.unwrapBlocks(e)))}];{const t=e;return[{...t,children:t.children.flatMap((e=>this.unwrapBlocksInProperties(e)))}]}}return[e]}unwrapBlocks(e){if("element"===e.type){if((0,l().CD)(e))return this.markModified(),[...e.children.flatMap((e=>this.unwrapBlocks(e))),{type:"text",value:"\n"}];{const t=e;return[{...t,children:t.children.flatMap((e=>this.unwrapBlocks(e)))}]}}return[e]}}class $ extends l().o0{constructor(){super(...arguments),this.name="RemoveUnsupportedProperties"}applyImpl(e,t){return e.flatMap((e=>this.removeUnsupportedProperties(e)))}removeUnsupportedProperties(e){return"element"===e.type?"property-created-time"===e.tagName||"property-last-edited-time"===e.tagName||"property-created-by"===e.tagName||"property-last-edited-by"===e.tagName?(this.markModified(),[]):[{...e,children:e.children.flatMap((e=>this.removeUnsupportedProperties(e)))}]:[e]}}class V extends l().o0{constructor(){super(...arguments),this.name="RemoveNonTitleProperties"}applyImpl(e,t){return e.flatMap((e=>"element"!==e.type||("create-page"!==e.tagName||e.attributes.in)&&"replace"!==e.tagName?[e]:this.removeNonTitleProperties(e)))}removeNonTitleProperties(e){return"element"===e.type?e.tagName.startsWith("property-")&&"property-title"!==e.tagName?(this.markModified(),[]):[{...e,children:e.children.flatMap((e=>this.removeNonTitleProperties(e)))}]:[e]}}class z extends l().o0{constructor(){super(...arguments),this.name="ConvertToggleToUli"}applyImpl(e,t){return e.map((e=>"element"===e.type&&"chat"===e.tagName?this.convertToggleToUli(e):e))}convertToggleToUli(e){return"element"===e.type?"toggle"===e.tagName?(this.markModified(),{...e,tagName:"uli",attributes:{},children:e.children.map((e=>this.convertToggleToUli(e)))}):{...e,children:e.children.map((e=>this.convertToggleToUli(e)))}:e}}class W extends l().o0{constructor(){super(...arguments),this.name="RemoveATargetAttribute"}applyImpl(e,t){return e.map((e=>this.removeATargetAttribute(e)))}removeATargetAttribute(e){if("element"===e.type&&"a"===e.tagName&&e.attributes.target){const t=n().cJ(e.attributes,"target");return{...e,attributes:t,children:e.children.map((e=>this.removeATargetAttribute(e)))}}return e}}class Q extends l().o0{constructor(){super(...arguments),this.name="JoinAdjacentTextNodes"}applyImpl(e,t){return e.map((e=>this.joinAdjacentTextNodes(e)))}joinAdjacentTextNodes(e){if("text"===e.type)return e;const t=[];for(const r of e.children){const e=t.at(-1);"text"===r.type&&e&&"text"===e.type&&""!==r.value?(this.markModified(),t[t.length-1]={type:"text",value:e.value+r.value}):t.push(this.joinAdjacentTextNodes(r))}return{...e,children:t}}}class G extends l().o0{constructor(){super(...arguments),this.name="UnwrapPages"}applyImpl(e,t){return e.flatMap((e=>"element"!==e.type||"insert"!==e.tagName&&"chat"!==e.tagName?[e]:this.unwrapPages(e)))}unwrapPages(e){return"element"===e.type?"page"===e.tagName||"child-page"===e.tagName?(this.markModified(),e.children.flatMap((e=>this.unwrapPages(e)))):[{...e,children:e.children.flatMap((e=>this.unwrapPages(e)))}]:[e]}}class Z extends l().o0{constructor(){super(...arguments),this.name="RemoveProperties"}applyImpl(e,t){return e.map((e=>"element"!==e.type||"insert"!==e.tagName&&"chat"!==e.tagName?e:this.removeProperties(e)))}removeProperties(e){if("text"===e.type)return e;if(e.children.some(l().YV)){const t=e.children.flatMap((t=>"element"!==e.type?[t]:(0,l().YV)(t)?(this.markModified(),"property-title"===t.tagName?[{type:"element",attributes:{},tagName:"h1",children:t.children}]:[]):[t]));return{...e,children:t.map((e=>this.removeProperties(e)))}}return{...e,children:e.children.map((e=>this.removeProperties(e)))}}}class Y extends l().o0{constructor(){super(...arguments),this.name="TruncateSearches"}applyImpl(e,t){return this.truncateSearches(e)}truncateSearches(e){let t=0;return e.flatMap((e=>"element"!==e.type||"search"!==e.tagName?[e]:t<3?(t+=1,[e]):(this.markModified(),[])))}}class X extends l().o0{constructor(){super(...arguments),this.name="FillEmptyQueryDatabaseWithEmptySearch"}applyImpl(e,t){return e.map((e=>this.fillEmptyQueryDatabaseWithEmptySearch(e)))}fillEmptyQueryDatabaseWithEmptySearch(e){return"element"!==e.type||"query-database"!==e.tagName||e.children.length>0?e:(this.markModified(),{...e,children:[{type:"element",tagName:"search",attributes:{question:"",keywords:"",lookback:"default"},children:[]}]})}}class J extends l().o0{constructor(){super(...arguments),this.name="AutofixTypesInDatabaseQueryOutput"}applyImpl(e,t){return t?e.map((e=>this.autofixTypesInDatabaseQueryOutput(e,t))):e}autofixTypesInDatabaseQueryOutput(e,t){var r;if("element"!==e.type||"query-database"!==e.tagName)return e;const n=e.attributes.id;if(!n)return e;const o=null===(r=t.idMapper.keyMap.find((e=>e.counter===n)))||void 0===r?void 0:r.key;if(!o)return e;const a=t.collectionIdMap[o.key];if(!a)return e;const i=(0,l().uI)(e,(e=>this.fixQueryDatabaseFilterSortTypes(e,a.schemas)));return i}fixQueryDatabaseFilterSortTypes(e,t){if("element"!==e.type)return e;const r=e.tagName.startsWith("filter"),n=e.tagName.startsWith("sort");if(!r&&!n)return e;const o=e.attributes.name,a=Object.entries(t).filter((e=>{let[t,r]=e;return t===o})).map((e=>{let[t,r]=e;return r.tagName.replace(/^schema-property-/,"")})),i=e.tagName.replace(/^(filter|sort)-property-/,"");return 0===a.length||a.includes(i)?e:(this.markModified(),{...e,tagName:`${r?"filter":"sort"}-property-${a[0]}`})}}const ee=[new x,new w,new S,new g,new D,new T,new j,new P,new R,new E,new C,new A,new N,new V,new $,new M,new _,new B,new F,new G,new Z,new O,new L,new m,new h,new f,new y,new q,new b,new W,new K,new U,new z,new H,new Q,new Y,new X,new I,new J,new k]},472499:(e,t,r)=>{"use strict";r.d(t,{J:()=>u});r(296540);var n=()=>r(484714),o=()=>r(401497),a=()=>r(56394),i=()=>r(574036),s=()=>r(978625),l=()=>r(806754),d=()=>r(821879),c=r(474848);function u(e){let{title:t,value:r,disabled:o,icon:a,style:i,onChange:s,focused:l,mode:d}=e;const u=(0,n().v3)(),{device:p}=u;return p.isMobile?(0,c.jsx)(f,{title:t,value:r,disabled:o,icon:a,style:i,onChange:s,focused:l,mode:d}):(0,c.jsx)(g,{title:t,icon:a,value:r,style:i,onChange:s,focused:l,mode:d})}function p(e,t){t(!e)}function m(e){return{menuItem:{minHeight:void 0,paddingTop:e.device.isMobile?12:4,paddingBottom:e.device.isMobile?12:4},icon:{height:14,width:14,fill:"currentColor"},pillIcon:{height:16,width:16,fill:"currentColor",marginRight:6},sectionMenuItem:{display:"flex"}}}function h(e){let{mode:t,title:r,icon:s,value:l,style:u,onChange:h,focused:g}=e;const f=(0,o().DP)(),y=m((0,n().v3)()),b=function(e){return{menuItem:{color:e.mediumTextColor}}}(f),v={...y.menuItem,...b.menuItem,...u};return t===d().C.Pill?(0,c.jsx)(a().A,{on:l,hideChevron:!0,title:(0,c.jsx)("span",{children:r}),onClick:()=>p(l,h),icon:s(y.pillIcon)}):(0,c.jsx)(i().A,{title:r,icon:s(y.icon),on:l,onClick:()=>p(l,h),style:v,focused:g})}function g(e){let{mode:t,title:r,icon:o,value:a,style:i,onChange:s,focused:d}=e;const u=(0,n().v3)();return(0,c.jsx)(l().A,{marginAfter:!1,style:m(u).sectionMenuItem,children:(0,c.jsx)(h,{title:r,icon:o,value:a,style:i,onChange:s,mode:t,focused:d})})}function f(e){let{mode:t,title:r,value:n,disabled:o,icon:a,style:i,onChange:l,focused:u}=e;return t===d().C.Button?(0,c.jsx)(h,{title:r,icon:a,value:n,style:i,onChange:l,mode:t,focused:u}):(0,c.jsx)(s().A,{disabled:o,onClick:()=>p(n,l),label:r,isToggle:!0,isToggleActive:n})}},482173:(e,t,r)=>{"use strict";r.d(t,{A:()=>l,q:()=>s});r(296540);var n=()=>r(284371),o=()=>r(115512),a=()=>r(250484),i=r(474848);function s(e){return{fontSize:12,color:e.lightTextColor,marginLeft:6,paddingRight:4,paddingLeft:4,height:24}}const l=function(e){const t=(0,r(401497).DP)(),l=function(e,t){return{footer:()=>{const{device:t}=e;return{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",fontSize:t.isMobile?n().J.UIRegular.mobile:n().J.UIRegular.desktop}},footerWrapper:{flexShrink:0},footerText:{color:t.lightTextColor,fontSize:o().ny(e,"UISmall"),...n().RC},footerDebugButton:{...s(t),marginRight:6},debugGearIcon:{color:t.accentColors.gray[400]},hoveredDebugGearIcon:{color:t.accentColors.gray[600]}}}((0,r(484714).v3)(),t),d=(0,r(56366).K8)((()=>a().Ay.state.isDebugSidebarOpen),[]);return(0,i.jsx)("footer",{style:l.footerWrapper,children:(0,i.jsxs)(r(89924).A,{topBorder:!0,style:l.footer(),disableDesktopPadding:!0,children:[(0,i.jsx)(r(678553).A,{...e,style:l.footerText}),(0,r(211134).PF)(r(780054).A)&&!d&&(0,i.jsx)(r(493823).p,{onClick:()=>a().Ay.setState({...a().Ay.state,isDebugSidebarOpen:!0}),size:"sm",style:l.debugGearIcon,hoveredStyle:l.hoveredDebugGearIcon,children:(0,r(846899).B)({width:12,height:12})})]})})}},491810:(e,t,r)=>{"use strict";r.d(t,{D:()=>d});var n=()=>r(973647),o=()=>r(534177),a=()=>r(251582),i=()=>r(252050),s=()=>r(228803),l=()=>r(331119);function d(e){const t=(0,o().s8)(i().U4,((t,r)=>function(e,t){const r=i().U4[e],{mapCounterToKey:o}=t;return a().p.mapResult((0,l().U5)(e),(t=>{const i=(0,l().ke)({inputAttributes:t.attributes,definitions:{...r.attributes,name:{required:!0,values:!0},description:{required:!1,values:!0}},tagName:e,mapCounterToKey:o});if(n().Q.isFail(i))return i;const d=(0,a().$d)(a().p.manyTill((0,s().Et)({inlineNodesAllowed:r.inline,textAllowed:!1,parentTagName:e,mapCounterToKey:o}),a().p.eof()),t.children??[]);if(n().Q.isFail(d))return d;const c=d.value;return{value:{type:"schema",tagName:e,attributes:i.value,children:c}}}))}(r,e)));return t}},507552:(e,t,r)=>{"use strict";r.d(t,{A:()=>I});var n=r(296540),o=()=>r(484714),a=()=>r(56366),i=()=>r(401497),s=()=>r(148307),l=()=>r(134421),d=()=>r(356596),c=r(474848);const u=(0,r(340498).wt)("flatNotionLogoMenuBar",{viewBox:"0 0 128 128",svg:(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M76.8 10.25H51.2C42.07 10.25 35.839 10.258 31.0171 10.6519C26.3149 11.0361 23.8625 11.7357 22.1257 12.6206C18.0332 14.7059 14.7059 18.0332 12.6206 22.1257C11.7357 23.8625 11.0361 26.3149 10.6519 31.0171C10.258 35.839 10.25 42.07 10.25 51.2V76.8C10.25 85.93 10.258 92.161 10.6519 96.9829C11.0361 101.685 11.7357 104.138 12.6206 105.874C14.7059 109.967 18.0332 113.294 22.1257 115.379C23.8625 116.264 26.3149 116.964 31.0171 117.348C35.839 117.742 42.07 117.75 51.2 117.75H76.8C85.93 117.75 92.161 117.742 96.9829 117.348C101.685 116.964 104.138 116.264 105.874 115.379C109.967 113.294 113.294 109.967 115.379 105.874C116.264 104.138 116.964 101.685 117.348 96.9829C117.742 92.161 117.75 85.93 117.75 76.8V51.2C117.75 42.07 117.742 35.839 117.348 31.0171C116.964 26.3149 116.264 23.8625 115.379 22.1257C113.294 18.0332 109.967 14.7059 105.874 12.6206C104.138 11.7357 101.685 11.0361 96.9829 10.6519C92.161 10.258 85.93 10.25 76.8 10.25ZM3.48779 17.4723C0 24.3175 0 33.2783 0 51.2V76.8C0 94.7217 0 103.683 3.48779 110.528C6.55574 116.549 11.4511 121.444 17.4723 124.512C24.3175 128 33.2783 128 51.2 128H76.8C94.7217 128 103.683 128 110.528 124.512C116.549 121.444 121.444 116.549 124.512 110.528C128 103.683 128 94.7217 128 76.8V51.2C128 33.2783 128 24.3175 124.512 17.4723C121.444 11.4511 116.549 6.55574 110.528 3.48779C103.683 0 94.7217 0 76.8 0H51.2C33.2783 0 24.3175 0 17.4723 3.48779C11.4511 6.55574 6.55574 11.4511 3.48779 17.4723Z"}),(0,c.jsx)("path",{d:"M34.8247 30H51.877L82.6339 73.8338V38.7877L72.8 36.9046C72.5211 35.0215 72.9047 33.4174 73.9508 32.0923C74.997 30.6974 76.6708 30 78.9723 30H99.5816C100.14 31.4646 100.105 32.7897 99.4769 33.9754C98.919 35.161 97.838 36.1026 96.2339 36.8L92.8862 38.3692V97.1631C90.9334 98.0697 89.4339 98.6626 88.3877 98.9415C87.3416 99.2205 86.0513 99.36 84.517 99.36C82.4246 99.36 80.5416 98.8718 78.8677 97.8954C77.1939 96.919 75.6595 95.4195 74.2646 93.3969L45.4954 52.7015V89.3169L55.957 91.2C56.2359 93.0831 55.8523 94.722 54.8062 96.1169C53.76 97.5118 52.0862 98.2092 49.7847 98.2092C48.32 98.2092 46.2975 98.1744 43.717 98.1046C41.1365 98.0349 38.8 98 36.7077 98C34.8944 98 33.1857 98.0349 31.5816 98.1046C30.0472 98.1046 29.0011 98.1395 28.4431 98.2092C28.3036 97.8605 28.199 97.4769 28.1293 97.0585C28.0595 96.64 28.0247 96.2564 28.0247 95.9077C28.0247 94.9313 28.2688 94.0246 28.757 93.1877C29.3149 92.3508 30.2565 91.6882 31.5816 91.2L35.2431 89.7354V37.9508L28.6524 36.5908C28.3734 34.7077 28.757 33.1385 29.8031 31.8831C30.8493 30.6277 32.5231 30 34.8247 30Z"})]})});var p=()=>r(959013),m=()=>r(284371),h=()=>r(222917),g=()=>r(705540),f=()=>r(115512),y=()=>r(563253),b=()=>r(962730),v=()=>r(948914),x=()=>r(899677),k=()=>r(35392),w=()=>r(859428),S=()=>r(295692);function I(){const e=(0,o().v3)(),t=(0,p().tz)(),r=(0,o().Y0)(),s=(0,a().K8)((()=>r.isElectron),[r.isElectron]),u=(0,a().K8)((()=>.75*f().ny(e,"UIRegular")),[e]),y=(0,i().IS)((t=>({listStyle:{...f().$t,...m().RC,display:"inline-flex",alignItems:"center",fontSize:f().ny(e,"UISmall"),color:t.lightTextColor,gap:20},upDownIcon:{display:"inline",width:u+2,height:u+2,fill:t.mediumIconColor},enterIcon:{display:"inline",width:u+1,height:u+1,fill:t.mediumIconColor},commandGlyph:{fontSize:.75*f().ny(e,"UIRegular"),paddingRight:1,color:t.mediumIconColor},inlineHint:{display:"flex",gap:6,alignItems:"center",height:"max-content"},forwardSlash:{fontSize:9,userSelect:"none",fontWeight:500,display:"flex",lineHeight:1.4},icons:{width:u-1,height:u-1,marginTop:.5},keyboardShortcutContainer:{fontSize:f().ny(e,"UISmall")}})),[e,u]),b=(0,a().K8)((()=>{var t;const r=null===(t=v().A.state.preferences)||void 0===t?void 0:t.isQuickSearchEnabled;return e.device.isElectron&&r}),[e.device.isElectron]),w=(0,n.useCallback)((()=>{(x().default.state.open||x().default.state.openAsPage)&&h().$n(e,{searchSessionId:x().default.state.sessionId})}),[e]),I=(0,a().K8)((()=>e.device.isMac),[e.device.isMac]);return(0,c.jsxs)("ul",{style:y.listStyle,children:[(0,c.jsxs)("li",{style:y.inlineHint,children:[(0,l().X)(y.upDownIcon),t.formatMessage({id:"searchFooter.helpText.selectHint",defaultMessage:"Select"})]}),(0,c.jsxs)("li",{style:y.inlineHint,children:[(0,d().K)(y.enterIcon),t.formatMessage({id:"searchFooter.helpText.openHint",defaultMessage:"Open"})]}),s?(0,c.jsxs)("li",{style:y.inlineHint,children:[I?(0,c.jsx)(S().z,{shortcut:{command:!0,key:"L"},iconStyles:y.icons,containerStyles:y.keyboardShortcutContainer}):(0,c.jsx)(k().A,{name:"copyLinkToCurrentPage"}),t.formatMessage({id:"searchFooter.helpText.copyLink",defaultMessage:"Copy link"})]}):void 0,b?(0,c.jsx)("li",{style:y.inlineHint,onClick:()=>{w(),g().openQuickSearchShortcutSetting()},children:(0,c.jsx)(T,{environment:e,containerStyles:y.inlineHint})}):void 0]})}function T(e){const{environment:t,containerStyles:r}=e,[o,s]=(0,n.useState)(!1),l=(0,a().K8)((()=>.75*f().ny(t,"UIRegular")),[t]),d=(0,i().IS)((e=>({container:{...r,cursor:"pointer"},commandSearchHint:{display:"flex",alignItems:"center"},commandText:{padding:"2px 4px",borderRadius:4,background:o?e.buttonHoveredBackground:void 0},hintAndBadgeContainer:{display:"flex",gap:3,alignItems:"center",width:"max-content"},tooltip:{background:"transparent",boxShadow:"none"},icons:{width:l-1,height:l-1,marginTop:.5},keyboardShortcutContainer:{fontSize:f().ny(t,"UISmall")}})),[r,t,o,l]),u=(0,a().K8)((()=>t.device.isMac),[t.device.isMac]),m=(0,p().tz)(),{commandSearchShortcut:k,commandSearchShortcutToString:I}=(0,a().K8)((()=>{var e;const t=null===(e=v().A.state.preferences)||void 0===e?void 0:e.quickSearchShortcut;if(!t)return{commandSearchShortcut:void 0,commandSearchShortcutToString:void 0};const r=(0,y().z_)(t,u);return{commandSearchShortcut:r,commandSearchShortcutToString:(0,y().Vd)(r,u)}}),[u]),T=(0,n.useCallback)((()=>{(x().default.state.open||x().default.state.openAsPage)&&h().WF(t,{searchSessionId:x().default.state.sessionId})}),[t]);return(0,c.jsx)(w().A,{delayThreshold:400,placement:b().W.Bottom,originGap:8,disableTooltip:!u,renderTooltip:()=>(T(),(0,c.jsx)(C,{shortcut:I})),closeDelay:0,style:d.tooltip,render:e=>(0,c.jsxs)("div",{...e,style:d.container,onClick:()=>g().openQuickSearchShortcutSetting(),onMouseEnter:t=>{e.onMouseEnter&&e.onMouseEnter(t),o||s(!0)},onMouseLeave:t=>{e.onMouseLeave&&e.onMouseLeave(t),o&&setTimeout((()=>{s(!1)}),200)},children:[(0,c.jsx)("span",{style:d.commandText,children:u?(0,c.jsx)(S().z,{shortcut:k,iconStyles:d.icons,containerStyles:d.keyboardShortcutContainer}):I}),(0,c.jsx)("div",{style:d.commandSearchHint,children:o?(0,c.jsx)("span",{children:m.formatMessage({id:"searchFooter.commandSearch.editText",defaultMessage:"Click to edit shortcut"})}):(0,c.jsx)("div",{style:d.hintAndBadgeContainer,children:m.formatMessage({id:"searchFooter.commandSearch.defaultText",defaultMessage:"Command Search"})})})]})})}function C(e){const{shortcut:t}=e,r=s().A.images.commandSearch.tooltipPng,[o,a]=(0,n.useState)(!1);(0,n.useEffect)((()=>{const e=new Image;e.src=r,e.onload=()=>{a(!0)}}),[r]);const l=(0,i().IS)((e=>({container:{width:260,borderRadius:8,backgroundColor:"transparent"},textContainer:{whiteSpace:"break-spaces",padding:15,display:"flex",flexDirection:"column",gap:1,backgroundColor:"light"===e.mode?e.accentColors.gray[700]:e.accentColors.gray[300],borderTopRightRadius:8,borderTopLeftRadius:8},description:{fontWeight:m().Wy.regular,color:"light"===e.mode?e.accentColors.gray[300]:e.accentColors.gray[600]},image:{width:"100%"}})),[]);return o?(0,c.jsxs)("div",{style:l.container,children:[(0,c.jsxs)("div",{style:l.textContainer,children:[(0,c.jsx)("div",{children:(0,c.jsx)(p().sA,{id:"searchFooter.commandSearch.tooltip.header",defaultMessage:"Use search and Q&A anywhere"})}),(0,c.jsx)("div",{style:l.description,children:(0,c.jsx)(p().sA,{id:"searchFooter.commandSearch.tooltip.description",defaultMessage:"Try {shortcut} or click on {menuBarIcon} in your menubar to access search and Ask AI anytime, even with Notion minimized.",values:{shortcut:t,menuBarIcon:(0,c.jsx)(N,{})}})})]}),(0,c.jsx)("img",{style:l.image,src:r})]}):null}function N(){const e=(0,i().IS)((e=>({container:{display:"inline-block",position:"relative"},placeholder:{width:15,height:15,display:"inline-block"},flatMenuIcon:{position:"absolute",left:0,top:3,width:15,height:15,fill:"light"===e.mode?e.accentColors.gray[300]:e.accentColors.gray[600]}})),[]);return(0,c.jsxs)("div",{style:e.container,children:[(0,c.jsx)("span",{style:e.placeholder}),u(e.flatMenuIcon)]})}},510818:(e,t,r)=>{"use strict";r.d(t,{MJ:()=>f,Pm:()=>h,WF:()=>v,dR:()=>k,e_:()=>m,rf:()=>x,sX:()=>y,tm:()=>g});r(16280),r(18107),r(944114),r(517642),r(658004),r(733853),r(845876),r(432475),r(515024),r(731698),r(967357),r(898992),r(354520),r(672577),r(430670),r(803949),r(581454);var n=()=>r(496603),o=()=>r(973647),a=()=>r(534177),i=()=>r(939768),s=()=>r(179034),l=()=>r(798880),d=()=>r(919709),c=()=>r(24279),u=()=>r(252050),p=()=>r(754093);function m(e){const t=[],r=/<\/?([a-zA-Z0-9_-]+)(?:\s[^>]*)?>/g;let n,o=e.replace(/<[^>]+$/,"").replace(/<[^>]+\/$/,"");for(;n=r.exec(o);){const e=n[1],r=n[0];r.startsWith("</")?t.length>0&&t[t.length-1]===e&&t.pop():r.endsWith("/>")||t.push(e)}for(;t.length;)o+=`</${t.pop()}>`;return o}function h(e){return e.replace(/[<>]/g,(e=>{switch(e){case"<":return"&lt;";case">":return"&gt;";default:throw new Error(`Invalid match: "${e}"`)}}))}n().Bj((()=>[...r(353566).Eo,...Object.keys(u().sA),...Object.keys(u()._S),...Object.keys(u().GU),...Object.keys(u().U4),...Object.keys(u().RD)]));function g(e){return e.replace(/<(code|code-block)(?:\s([^>]*))?>([\s\S]*?)<\/\1>/g,((e,t,r,n)=>`<${t}${r?` ${r}`:""}>${n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}</${t}>`))}function f(e){const t=[],r=[...e];let n;for(;n=r.pop();){if("collection"===n.type)for(const e of Object.values(n.schemas))if("schema-property-relation"===e.tagName){const r=e.attributes["database-id"];t.push(r)}if("child-page"===n.tagName){for(const e of Object.values(n.properties))if("property-relation"===e.tagName){const r=e.attributes["database-id"];(0,a().O9)(r)&&t.push(r)}}else if("child-database"===n.tagName||"database"===n.tagName){for(const e of Object.values(n.schemas))if("schema-property-relation"===e.tagName){const r=e.attributes["database-id"];t.push(r)}}else if(n.children)for(const e of n.children)(0,u().gc)(e)||r.push(e)}return t}function y(e){const t=[],r=[e];let n;for(;n=r.pop();){if("synced-block-reference"===n.tagName){if(!n.attributes["synced-block-id"])throw new Error("Synced block reference missing synced-block-id");t.push(n.attributes["synced-block-id"])}if(n.children)for(const e of n.children)(0,u().gc)(e)||r.push(e)}return t}function b(e,t){if(t(e),"block"===e.type){if(e.text)for(const r of e.text)b(r,t);if(e.children)for(const r of e.children)b(r,t)}else if("inline"===e.type){if(e.children)for(const r of e.children)b(r,t)}else if("property"===e.type&&e.children)for(const r of e.children)b(r,t)}function v(e){const t=e.getTranscript().filter(c().h7),r=e.state.getIdMapper();return t.flatMap((e=>{const t=(0,p().BD)(e.value)[0];return"element"===(null==t?void 0:t.type)&&"search-results"===t.tagName&&t.children?n().oE(t.children.map((e=>{var t;if("element"===e.type&&"page"===e.tagName&&null!==(t=e.attributes)&&void 0!==t&&t.id)return o().Q.unwrap(r.mapCounterToKeyInMode(e.attributes.id,"block_counter"))}))):[]}))}async function x(e){const{value:t,loadRecordModel:r}=e,n=(0,d().RQ)(t);let o="";for(const a of n){const e=a[0],t=(0,d().uPN)(a);e===d().Sj||(0,d().GiG)(a)||(o+=e);for(const n of t){if((0,d().rie)(n)){const e=(0,d().NcG)(n),t=await r({table:l().oo,id:e});o+=null==t?void 0:t.getName()}if((0,d().qsB)(n))o+=(0,d().YhW)(n);else if((0,d().sh$)(n)){const e=(0,d().cQR)(n),t=i().qg(e);o+=` ${t.hostname||""}${t.pathname||""} `}else if((0,d().gir)(n))o+=(0,d().U35)(n);else if((0,d().jIt)(n)){const e=(0,d().v55)(n),t=await r({table:s().ev,id:e});o+=(0,d().k4p)(null==t?void 0:t.getProperties().title)}}}return o}function k(e){const{pageIds:t,evaluator:r,loadInlineDatabases:o}=e,a=Array.from(r.state.getLoadedDatabaseIds()),i=n().sb(t.flatMap((e=>{const t=r.state.getBlockFromBlockIdMap(e);if(t&&"database-views"===t.tagName){const e=t.children.find((e=>"database-view"===e.tagName));if(e&&e.attributes["database-id"])return[e.attributes["database-id"]]}const n=new Set,a=o?3:0;return b(t,(e=>{if(!(n.size>=a)&&"database-view"===e.tagName){const t=e.attributes["database-id"];t&&n.add(t)}})),[...n]})));return n().R9(i,a)}},525704:(e,t,r)=>{"use strict";r.d(t,{M:()=>i,Y:()=>a});r(581454);var n=()=>r(251582),o=()=>r(331119);function a(e){return n().p.map((0,o().RB)({tagName:"move",attributeDefinitions:{id:{required:!0,values:!0,mappingMode:"block_counter"}},mapCounterToKey:e.mapCounterToKey}),(e=>{let{attributes:t}=e;return{type:"move",tagName:"move",attributes:t,children:[]}}))}function i(e){return n().p.map((0,o().RB)({tagName:"move",attributeDefinitions:{id:{required:!0,values:!0,mappingMode:"block_counter"},name:{required:!0,values:!0}},mapCounterToKey:e.mapCounterToKey}),(e=>{let{attributes:t}=e;return{type:"move",tagName:"move",attributes:t,children:[]}}))}},575695:(e,t,r)=>{"use strict";r.d(t,{A:()=>T});var n=r(296540),o=()=>r(484714),a=()=>r(56366),i=()=>r(401497),s=()=>r(563884),l=()=>r(959013),d=()=>r(534177),c=()=>r(56394),u=()=>r(780865),p=()=>r(962730),m=()=>r(377586),h=()=>r(493823),g=()=>r(760217),f=()=>r(545805),y=()=>r(14235),b=()=>r(204063),v=()=>r(427711),x=()=>r(297401),k=()=>r(978625),w=()=>r(806754),S=()=>r(821879),I=r(474848);const T=function(e){let{onChange:t,onMenuDismiss:n,showButtons:i,title:s,value:l,disabled:d,dateFormat:c,icon:u,mode:p,focused:m}=e;const h=(0,o().v3)(),g=(0,a().uB)(void 0,r(35394).A);(0,r(852507).l)((()=>{P({value:l},g)}));const{device:f}=h;return f.isMobile?(0,I.jsx)(K,{onChange:t,onMenuDismiss:n,showButtons:i,title:s,value:l,disabled:d,dateFormat:c,icon:u,mode:p,store:g}):(0,I.jsx)(q,{onChange:t,onMenuDismiss:n,showButtons:i,title:s,value:l,disabled:d,dateFormat:c,focused:m,icon:u,mode:p,store:g})};function C(e){const{device:t}=e;return t.isMobile?m().n.SlideUp:m().n.Popup}function N(e){return{buttonMenuItem:{color:e.mediumTextColor},activeMenuItem:{color:e.regularTextColor}}}function M(e){e.preventDefault&&e.preventDefault()}function _(e){e({starting:void 0,ending:void 0})}function B(e){return{menuItem:{minHeight:void 0,paddingTop:e.device.isMobile?12:4,paddingBottom:e.device.isMobile?12:4},icon:{height:14,width:14,fill:"currentColor"},iconActiveDesktop:{height:14,width:14,fill:"currentColor",alignSelf:"flex-start",marginTop:2,marginRight:2},iconActiveDesktopWrapper:{marginTop:0},iconActiveMobile:{height:14,width:14,fill:"currentColor",marginTop:1,marginRight:6},popup:{paddingTop:12,paddingBottom:8},menuItemTitleDesktop:{width:"100%"},sectionMenuItem:{display:"flex"},summary:{display:"inline-flex"}}}function A(e,t){t||e.setState({...e.state,isOpen:!0,focus:"starting"})}function j(e,t,r,n,o){const{temporaryDateRange:a}=r.state;u().a9(e)||(o||t(a),r.setState({...r.state,isOpen:!1,temporaryDateRange:{starting:void 0,ending:void 0}}),n&&n())}function P(e,t){if(!e.error)return t.setState({...t.state,temporaryDateRange:{...t.state.temporaryDateRange,...e.value}})}function R(e){let{disabled:t,icon:r,title:a,store:i}=e;const s=(0,o().v3)(),l=(0,n.useCallback)((()=>A(i,t)),[i,t]),d=B(s);return(0,I.jsx)(g().A,{disabled:t,focused:!1,icon:r(d.icon),title:a,onClick:l})}function E(e){let{disabled:t,title:r,value:a,dateFormat:i,onChange:d,store:c}=e;const p=(0,l().tz)(),m=(0,o().v3)(),h=(0,n.useCallback)((()=>A(c,t)),[c,t]),g=B(m),f=(0,I.jsxs)("div",{style:g.summary,children:[(0,s().k)(g.iconActiveMobile),u().tX(a,p,i)]});return(0,I.jsx)(k().A,{disabled:t,onClick:h,onClickClear:()=>_(d),label:r,title:f})}function O(e){let{disabled:t,value:r,dateFormat:a,focused:d,onChange:c,store:p}=e;const m=(0,l().tz)(),h=(0,i().DP)(),f=(0,o().v3)(),y=(0,n.useCallback)((()=>A(p,t)),[p,t]),b=B(f),v=N(h),k={...b.menuItem,...v.activeMenuItem},w=u().tX(r,m,a),S=(0,I.jsx)(x().A,{onClick:()=>_(c),disabled:t});return(0,I.jsx)(g().A,{focused:d,disabled:t,icon:(0,s().k)(b.iconActiveDesktop),title:w,right:S,isTokenTitle:!0,alignIconTop:!0,onClick:y,desktopTitleStyle:b.menuItemTitleDesktop,desktopIconStyle:b.iconActiveDesktopWrapper,style:k})}function F(e){let{disabled:t,title:r,icon:a,focused:s,mode:l,store:d}=e;const c=(0,i().DP)(),u=(0,o().v3)(),p=(0,n.useCallback)((()=>A(d,t)),[d,t]),m=B(u),h=N(c),f={...m.menuItem,...h.buttonMenuItem,...l===S().C.Pill?{width:"fit-content",border:"solid 1px",paddingLeft:0,paddingRight:0,borderRadius:20,fontSize:12}:{}};return(0,I.jsx)(g().A,{focused:s,disabled:t,icon:a(m.icon),title:r,onClick:p,style:f})}function L(e){let{disabled:t,value:r,title:o,store:a}=e;const i=(0,n.useCallback)((()=>A(a,t)),[a,t]);return(0,I.jsx)(c().A,{on:Boolean(r.starting||r.ending),icon:(0,s().k)({width:16,marginRight:6,fill:"currentColor"}),title:(0,I.jsx)("span",{children:o}),onClick:i})}function D(e){let{onChange:t,onMenuDismiss:r,showButtons:o,title:i,value:s,store:d}=e;const c=(0,n.useCallback)((e=>j(e,t,d,r,o)),[t,d,r,o]),u=(0,n.useCallback)((e=>P(e,d)),[d]),p=(0,a().K8)((()=>function(e,t){const{temporaryDateRange:r}=t.state;return{...e,...r}}(s,d)),[d,s]);return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(v().A,{title:i,value:p,onUpdate:u,store:d,onDismiss:c}),o&&(0,I.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",width:"100%",padding:"0px 10px"},children:[(0,I.jsx)(h().p,{isGray:!0,style:{marginLeft:"auto",marginRight:8},onClick:c,children:(0,I.jsx)(l().sA,{defaultMessage:"Cancel",id:"searchDateFilter.cancelButton.label"})}),(0,I.jsx)(b().A,{onClick:()=>t(d.state.temporaryDateRange),children:(0,I.jsx)(l().sA,{defaultMessage:"Accept",id:"searchDateFilter.acceptButton.label"})})]})]})}function q(e){let{mode:t,onChange:r,onMenuDismiss:i,showButtons:s,title:l,value:c,disabled:u,dateFormat:m,focused:h,icon:g,store:b}=e;const v=(0,o().v3)(),x=(0,n.useCallback)((e=>j(e,r,b,i,s)),[r,b,i,s]),k=(0,n.useCallback)((()=>(0,I.jsx)(D,{onChange:r,onMenuDismiss:i,showButtons:s,title:l,value:c,store:b})),[r,i,s,l,c,b]),T=B(v),N=t===S().C.Section,_=N?l:void 0,A=t===S().C.Section?(0,I.jsx)(O,{disabled:u,value:c,dateFormat:m,focused:h,onChange:r,store:b}):t===S().C.Button?(0,I.jsx)(F,{disabled:u,title:l,icon:g,focused:h,mode:t,store:b}):t===S().C.Pill?(0,I.jsx)(L,{disabled:u,value:c,title:l,store:b}):void(0,d().HB)(t),P=(0,a().K8)((()=>b.state.isOpen),[b]);return(0,I.jsx)(w().A,{title:_,marginAfter:N,children:(0,I.jsx)(f().A,{debugName:"SearchDateFilter",capture:P,onUp:M,onDown:M,onEnter:M,children:(0,I.jsx)(y().Ay,{popupType:C(v),open:P,origin:A,render:k,onDismiss:x,placementToOrigin:p().W.Bottom,alignmentToOrigin:p().C.Start,keepFocus:!0,style:T.popup})})})}function K(e){let{mode:t,onChange:r,onMenuDismiss:o,showButtons:i,title:s,value:l,disabled:d,dateFormat:c,icon:u,store:p}=e;const h=(0,a().K8)((()=>p.state.isOpen),[p]),g=(0,n.useCallback)((e=>j(e,r,p,o,i)),[r,p,o,i]),f=(0,n.useCallback)((()=>(0,I.jsx)(D,{onChange:r,onMenuDismiss:o,showButtons:i,title:s,value:l,store:p})),[r,o,i,s,l,p]),b=t===S().C.Section?(0,I.jsx)(E,{disabled:d,title:s,value:l,dateFormat:c,onChange:r,store:p}):(0,I.jsx)(R,{disabled:d,icon:u,title:s,store:p});return(0,I.jsx)(y().Ay,{popupType:m().n.SlideUp,open:h,origin:b,render:f,onDismiss:g,preventScaleTransition:!0})}},586984:(e,t,r)=>{"use strict";r.d(t,{C:()=>M,VY:()=>B,WR:()=>v,Y2:()=>I,ZE:()=>C,dF:()=>f,dl:()=>x,oZ:()=>h,pf:()=>T,tl:()=>_,wT:()=>y,wq:()=>N});r(898992),r(354520),r(581454),r(737550);var n=()=>r(973647),o=()=>r(534177),a=()=>r(251582),i=()=>r(181856),s=()=>r(832443),l=()=>r(252050),d=()=>r(162278),c=()=>r(228803),u=()=>r(233364),p=()=>r(331119);function m(e){return a().p.mapResult((0,p().U5)("insert-inside"),(t=>{const r=(0,p().ke)({inputAttributes:t.attributes,definitions:{id:{required:!0,values:!0,mappingMode:"block_counter"}},tagName:"insert-inside",mapCounterToKey:e.mapCounterToKey});if(n().Q.isFail(r))return r;const o=(0,u().x)(e),s=(0,a().$d)(a().p.sequence([a().p.choice([o["property-relation"],o["property-person"],o["property-multi-select"]]),a().p.eof((()=>new(i().yd)))]),t.children??[]);if(n().Q.isFail(s))return s;return{value:{type:"effect",tagName:"insert-inside",insertType:"property",attributes:r.value,children:[s.value[0]]}}}))}function h(e){return a().p.choice([a().p.try(m(e)),a().p.andThen(a().p.lookAhead(a().p.map((0,p().U5)("insert-inside"),(t=>{const{mapCounterToKey:r}=e;if(!(0,o().O9)(r)||!(0,o().O9)(t.attributes.id))return!1;const a=(0,n().j)((()=>r(t.attributes.id)));return!n().Q.isFail(a)&&"collection"===a.value.type}))),(t=>t?function(e){return a().p.mapResult((0,p().U5)("insert-inside"),(t=>{const r=(0,p().ke)({inputAttributes:t.attributes,definitions:{id:{required:!0,values:!0,mappingMode:"collection_counter"}},tagName:"insert-inside",mapCounterToKey:e.mapCounterToKey});if(n().Q.isFail(r))return r;const o=(0,a().$d)((0,p().nx)("insert-inside",[(0,d().vj)({allocateIdFn:e.allocateIdFn,allowMove:!0,allowUncited:!1,persisted:!1,mapCounterToKey:e.mapCounterToKey})]),t.children??[]);return n().Q.isFail(o)?o:{value:{type:"effect",tagName:"insert-inside",insertType:"blockIntoDatabase",attributes:r.value,children:o.value}}}))}(e):function(e){return a().p.mapResult((0,p().U5)("insert-inside"),(t=>{const r=(0,p().ke)({inputAttributes:t.attributes,definitions:{id:{required:!0,values:!0,mappingMode:"block_counter"}},tagName:"insert-inside",mapCounterToKey:e.mapCounterToKey});if(n().Q.isFail(r))return r;const o=(0,a().$d)((0,p().nx)("insert-inside",[(0,d().vj)({allocateIdFn:e.allocateIdFn,allowMove:!0,allowUncited:!1,persisted:!1,mapCounterToKey:e.mapCounterToKey})]),t.children??[]);return n().Q.isFail(o)?o:{value:{type:"effect",tagName:"insert-inside",insertType:"block",attributes:r.value,children:o.value}}}))}(e)))])}function g(e){return t=>{const i=a().p.mapResult((0,p().U5)(e),(r=>{const o=(0,p().ke)({inputAttributes:r.attributes,definitions:{id:{required:!0,values:!0,mappingMode:"block_counter"}},tagName:e,mapCounterToKey:t.mapCounterToKey});if(n().Q.isFail(o))return o;const i=(0,a().$d)((0,p().nx)(e,[(0,d().vj)({allocateIdFn:t.allocateIdFn,allowMove:!0,allowUncited:!1,persisted:!1,mapCounterToKey:t.mapCounterToKey})]),r.children??[]);if(n().Q.isFail(i))return i;return{value:{type:"effect",tagName:e,insertType:"block",attributes:o.value,children:i.value}}})),s=a().p.mapResult((0,p().U5)(e),(o=>{const i=(0,p().ke)({inputAttributes:o.attributes,definitions:{id:{required:!0,values:!0,mappingMode:"block_counter"},name:{required:!0,values:!0}},tagName:e,mapCounterToKey:t.mapCounterToKey});if(n().Q.isFail(i))return i;const s=(0,r(491810).D)({mapCounterToKey:t.mapCounterToKey}),l=(0,a().$d)((0,p().nx)(e,[(0,r(525704).M)(t),s["schema-property-text"]]),o.children??[]);if(n().Q.isFail(l))return l;return{value:{type:"effect",tagName:e,insertType:"table",attributes:i.value,children:l.value}}}));return a().p.andThen(a().p.lookAhead(a().p.map(a().p.any(),(t=>{var r;return"element"===t.type&&t.tagName===e&&(0,o().O9)(null===(r=t.attributes)||void 0===r?void 0:r.name)}))),(e=>e?s:i))}}const f=g("insert-before"),y=g("insert-after"),b=a().p.mapResult((0,p().U5)("action-button"),(e=>{const t=(0,p().ke)({inputAttributes:e.attributes,definitions:{name:{required:!0,values:!0},icon:{required:!1,values:!0},action:{required:!1,values:!0}},tagName:"action-button",mapCounterToKey:void 0});return n().Q.isFail(t)?t:{value:{name:t.value.name,icon:t.value.icon,action:t.value.action}}})),v=a().p.mapResult((0,p().U5)("chat-md"),(e=>{const t=e.attributes?Object.keys(e.attributes):[];if(t.length>0)return{error:new(i().LN)({tagName:"chat-md",attributeNames:t})};const r=(0,a().$d)((0,p().nx)("chat-md",[p().W6]),e.children??[]);if(n().Q.isFail(r))return r;const o={type:"effect",tagName:"chat-md",text:r.value.map((e=>e.value)).join("")};return{value:o}}));function x(e){return a().p.mapResult((0,p().U5)("chat"),(t=>{const r=t.attributes?Object.keys(t.attributes):[];if(r.length>0)return{error:new(i().LN)({tagName:"chat",attributeNames:r})};const s=(0,a().$d)((0,p().nx)("chat",[(0,d().st)(),(0,d().V8)({allocateIdFn:e.allocateIdFn,allowMove:!1,allowUncited:!0,persisted:!1,mapCounterToKey:e.mapCounterToKey}),a().p.map(b,(e=>({type:"action-button",value:e})))]),t.children??[]);if(n().Q.isFail(s))return s;const l=s.value.some((e=>"uncited"===e.type)),c=s.value.filter((e=>"uncited"!==e.type)),u=c.filter((0,o().u0)((e=>"block"===e.type?{true:e}:{false:e}))),m=c.filter((0,o().u0)((e=>"action-button"===e.type?{true:e}:{false:e}))),h=u.some((e=>e.hasUncited));return{value:{type:"effect",tagName:"chat",children:u,actionButtons:m.map((e=>e.value)),uncited:l||h}}}))}function k(e){return a().p.mapResult((0,p().U5)("delete"),(t=>{const r=(0,p().ke)({inputAttributes:t.attributes,definitions:{id:{required:!0,values:!0,mappingMode:"block_counter"}},tagName:"delete",mapCounterToKey:e.mapCounterToKey});if(n().Q.isFail(r))return r;const o=(0,p().x3)(t);if(n().Q.isFail(o))return o;return{value:{type:"effect",tagName:"delete",deleteType:"block",attributes:r.value}}}))}function w(e){return a().p.mapResult((0,p().U5)("delete"),(t=>{const r=(0,p().ke)({inputAttributes:t.attributes,definitions:{id:{required:!0,values:!0,mappingMode:"block_counter"}},tagName:"delete",mapCounterToKey:e.mapCounterToKey});if(n().Q.isFail(r))return r;const o=(0,u().x)(e),s=(0,a().$d)(a().p.sequence([a().p.choice([o["property-relation"],o["property-person"],o["property-multi-select"]]),a().p.eof((()=>new(i().nD)))]),t.children??[]);if(n().Q.isFail(s))return s;return{value:{type:"effect",tagName:"delete",deleteType:"property",attributes:r.value,children:[s.value[0]]}}}))}function S(e){return a().p.map((0,p().RB)({tagName:"delete",attributeDefinitions:{id:{required:!0,values:!0,mappingMode:"block_counter"},name:{required:!0,values:!0}},mapCounterToKey:e.mapCounterToKey}),(e=>{let{attributes:t}=e;return{type:"effect",tagName:"delete",deleteType:"table-column",attributes:t}}))}function I(e){return a().p.choice([a().p.try(k(e)),a().p.try(w(e)),S(e)])}function T(e){return a().p.mapResult((0,p().U5)("set-title"),(t=>{const r=(0,p().ke)({inputAttributes:t.attributes,definitions:{id:{required:!0,values:!0,mappingMode:"block_counter"}},tagName:"set-title",mapCounterToKey:e.mapCounterToKey});if(n().Q.isFail(r))return r;const o=(0,a().$d)((0,p().nx)("set-title",[(0,c().Et)({inlineNodesAllowed:l().qI,textAllowed:!0,parentTagName:"set-title",mapCounterToKey:e.mapCounterToKey})]),t.children??[]);if(n().Q.isFail(o))return o;return{value:{type:"effect",tagName:"set-title",attributes:r.value,children:o.value}}}))}function C(e){return a().p.mapResult((0,p().U5)("set-attribute"),(t=>{const{id:r,...o}=t.attributes??{};if(!r)return{error:new(i().HQ)({tagName:"set-attribute",attributeName:"id"})};if(!(0,s().D4)(r))return{error:new(i().qW)("id",r)};const a=e.mapCounterToKey?s().tD.mapCounterToKeyInMode({mapCounterToKey:e.mapCounterToKey},r,"block_counter","set-attribute"):{value:r};if(n().Q.isFail(a))return a;const l=a.value;if(0===Object.keys(o).length)return{error:new(i().Uc)};const d=(0,p().x3)(t);if(n().Q.isFail(d))return d;const c=Object.entries(o).map((e=>{let[t,r]=e;return{key:t,value:r}}));return{value:{type:"effect",tagName:"set-attribute",id:l,attributes:c}}}))}function N(e){return a().p.map((0,p().RB)({tagName:"set-tag-name",attributeDefinitions:{id:{required:!0,values:!0,mappingMode:"block_counter"},"tag-name":{required:!0,values:(0,o().uv)(l().sA)}},mapCounterToKey:e.mapCounterToKey}),(e=>{let{attributes:t}=e;return{type:"effect",tagName:"set-tag-name",attributes:{id:t.id,newTagName:t["tag-name"]}}}))}function M(e){return a().p.mapResult((0,p().U5)("set-property"),(t=>{const r=(0,p().ke)({inputAttributes:t.attributes,definitions:{id:{required:!0,values:!0,mappingMode:"block_counter"}},tagName:"set-property",mapCounterToKey:e.mapCounterToKey});if(n().Q.isFail(r))return r;const o=t.children.filter((e=>"element"===e.type)),i=(0,a().$d)(a().p.map(a().p.sequence([(0,u().Q)(e),a().p.manyTill((0,u().Q)(e),a().p.eof())]),(e=>{let[t,r]=e;return[t,...r]})),o);if(n().Q.isFail(i))return i;return{value:{type:"effect",tagName:"set-property",attributes:r.value,children:i.value}}}))}function _(e){return a().p.mapResult((0,p().U5)("persist-blocks"),(t=>{const r=t.attributes?Object.keys(t.attributes):[];if(r.length>0)return{error:new(i().LN)({tagName:"persist-blocks",attributeNames:r})};const o=(0,a().$d)((0,p().nx)("persist-blocks",[(0,d().V8)({allocateIdFn:e.allocateIdFn,allowMove:!1,allowUncited:!1,persisted:!1,mapCounterToKey:e.mapCounterToKey})]),t.children??[]);if(n().Q.isFail(o))return o;return{value:{type:"effect",tagName:"persist-blocks",children:o.value}}}))}function B(e){return a().p.mapResult((0,p().U5)("create"),(t=>{const r=t.attributes?Object.keys(t.attributes):[];if(r.length>0)return{error:new(i().LN)({tagName:"create",attributeNames:r})};const o=(0,a().$d)((0,p().nx)("create",[(0,d().V8)({allocateIdFn:e.allocateIdFn,allowMove:!1,allowUncited:!1,persisted:!1,mapCounterToKey:e.mapCounterToKey})]),t.children??[]);if(n().Q.isFail(o))return o;return{value:{type:"effect",tagName:"create",children:o.value}}}))}},659467:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});class n extends(()=>r(757695))().default{getInitialState(){return{open:!1}}}const o=new n},677590:(e,t,r)=>{"use strict";r.d(t,{U:()=>d});r(898992),r(354520),r(581454);var n=()=>r(861017),o=()=>r(496603),a=()=>r(534177),i=()=>r(435009),s=()=>r(295169),l=()=>r(251383);function d(e){const{environment:t}=e,r=e.sessionId??s().default.getActiveSessionId(),d=r?s().default.getSessionContext(r):void 0;if(!r||!d)return;d.addTemporaryOperationsToUncommittedOperations();const{editGroupsThatWereRejected:c}=(0,l().V)({environment:t,sessionId:r}),u=t.RouterStore.state.route,p=(0,n().hZ)(u);if(p.length>0){const e=c.map((e=>"updatedPage"===e.type&&e.didCreatePage?e.pageId:void 0)).filter(a().O9);o().E$(p,e).length>0&&i().oo({environment:t,url:d.urlAtStartOfSession})}d.caches.removeDefaultCacheOverride(t),s().default.setState({...s().default.state,...s().default.state.activeAiSessionId===r&&{activeAiSessionId:void 0}})}},691309:(e,t,r)=>{"use strict";r.d(t,{Nc:()=>P,OS:()=>C,So:()=>F,Vg:()=>L,Vz:()=>T,g$:()=>B,l4:()=>R,o4:()=>A,qY:()=>_,tF:()=>N,ze:()=>M});r(16280),r(944114),r(517642),r(658004),r(733853),r(845876),r(432475),r(515024),r(731698),r(898992),r(354520),r(672577),r(430670),r(581454);var n=()=>r(496603),o=()=>r(183558),a=()=>r(973647),i=()=>r(534177),s=()=>r(700500),l=()=>r(15440),d=()=>r(970013),c=()=>r(175482),u=()=>r(236162),p=()=>r(206267),m=()=>r(792071),h=()=>r(72135),g=()=>r(134025),f=()=>r(54821),y=()=>r(179034),b=()=>r(519831),v=()=>r(96689),x=()=>r(84520),k=()=>r(798880),w=()=>r(252050),S=()=>r(716301),I=()=>r(33642);(0,i().u0)((e=>"createBlock"===e.command?{true:e}:{false:e}));function T(e){const{useCrdt:t,...r}=e,l=function(e){const{assistantOperation:t,actorPointer:r,getRecordValue:l,spaceId:c,citationHandling:h,currentTimeZone:b}=e,v=Date.now(),x={last_edited_by_table:r.table,last_edited_by_id:r.id,last_edited_time:v},k={created_by_table:r.table,created_by_id:r.id,created_time:v,...x},w=m().b4_.fromGetRecordValueFn(l);let I=[];if("createBlock"===t.command){if("database"===t.blockNode.tagName)return{error:new Error("Invalid creation operation for database")};const e=w({table:y().ev,id:t.blockNode.attributes.id}),r={},a={};let u;if("toggle"===t.blockNode.tagName&&(0,i().O9)(t.blockNode.attributes.size)&&(u=S().oc[t.blockNode.attributes.size],a.toggleable=!0),u||(u=S().w$[t.blockNode.tagName]),!u)return{error:new Error(`Unknown block type: ${t.blockNode.tagName}`)};if(t.blockNode.attributes)for(const[n,o]of Object.entries(t.blockNode.attributes)){const e=D[n];if(e){const t=e(o,{spaceId:c,isCreate:!0});Object.assign(r,t.properties),Object.assign(a,t.format)}}const m=Object.values(t.blockNode.properties).find((e=>"property-title"===e.tagName)),v=m?m.children:t.blockNode.text,x={};if(t.databaseSchemaId){const e={table:y().ev,id:t.databaseSchemaId},r=l(e);if(!r)return{error:new Error("No collection view block")};const n=(0,f().OZ)({table:y().ev,value:r});if(!n)return{error:new Error("No collection pointer")};const o=l(n);if(!o)return{error:new Error("No collection")};const a=(0,d().Dp)(o);for(const[i,s]of Object.entries(t.blockNode.properties)){const e=Object.entries(a).find((e=>{let[,t]=e;return(null==t?void 0:t.name)===i}));if(!e)return{error:new Error(`Property not found: ${i}`)};const[t]=e;x[t]=(0,S().ld)({type:"property",property:s,nodes:s.children,getRecordModel:w,currentTimeZone:b})||[]}}if("unknown-block"===t.blockNode.tagName&&e?I.push({pointer:{table:y().ev,id:F(p().Dt())},command:"set",path:[],args:{type:e.getType(),space_id:c,properties:e.getProperties(),content:e.getContentIds(),...t.blockNode.parent&&{parent_id:F(t.blockNode.parent.attributes.id),parent_table:y().ev,alive:!0},...k,format:e.getFormat()}}):I.push({pointer:{table:y().ev,id:F(t.blockNode.attributes.id)},command:"set",path:[],args:{type:u,space_id:c,properties:{title:(null==v?void 0:v.length)>0?(0,S().ld)({type:"text",nodes:v,citationHandling:h,getRecordModel:w,currentTimeZone:b}):void 0,...r,...x},content:t.blockNode.children.length>0?t.blockNode.children.map((e=>F(e.attributes.id))):void 0,...t.blockNode.parent&&{parent_id:F(t.blockNode.parent.attributes.id),parent_table:y().ev,alive:!0},...k,format:a}}),"tr"===t.blockNode.tagName){var T,C;const e=t.blockNode.attributes.id,r=null===(T=t.blockNode.parent)||void 0===T?void 0:T.attributes.id;if(!r)return{error:new Error(`Parent not found: ${r}.`)};const a={table:y().ev,id:F(e)},i={table:y().ev,id:F(r)},d=l(i);if(!d)return{error:new Error(`Parent block not found: ${r}.`)};if(d.type!==s().xd.table)return{error:new Error("Parent block is not of type table.")};let c=(null===(C=d.format)||void 0===C?void 0:C.table_block_column_order)||[];const u=Object.values(t.blockNode.properties).sort(((e,t)=>parseInt(e.attributes.name)-parseInt(t.attributes.name)));if(c.length>0&&c.length!==u.length){const e=e=>({type:"property",tagName:"property-text",attributes:{name:e},children:[{type:"text",value:""}]});for(const t of n().y1(u.length,c.length)){const r=(t+1).toString();u.push(e(r))}}for(const t of u)if(u.indexOf(t)+1!==parseInt(t.attributes.name))return{error:new Error("Table row properties are not in order.")};if(0===c.length){c=u.map((()=>(0,o().Ay)()));const e={last_edited_by_table:k.last_edited_by_table,last_edited_by_id:k.last_edited_by_id,last_edited_time:k.last_edited_time};I.push(g().op.update({pointer:i,path:["format"],args:{table_block_column_order:c}}),g().op.update({pointer:i,path:[],args:e}))}const p=Object.fromEntries(u.map(((e,t)=>[c[t],e.children.length>0?(0,S().ld)({type:"property",nodes:e.children,property:e,getRecordModel:w,currentTimeZone:b}):void 0])));I.push(g().op.update({pointer:a,path:["properties"],args:p}))}}else{if("removeBlock"===t.command)return{value:[{type:"latentOperation",latentOperation:{type:"removeBlock",assistantOperation:t,data:{spaceId:c,actorPointer:r}}}]};if("moveBlock"===t.command)I=[{pointer:{table:y().ev,id:F(t.oldParentId)},command:"listRemove",path:["content"],args:{id:F(t.blockNode.attributes.id)}},g().op.update({pointer:{table:y().ev,id:F(t.parentId)},path:[],args:x}),{pointer:{table:y().ev,id:F(t.blockNode.attributes.id)},command:"update",path:[],args:{parent_id:F(t.parentId),parent_table:y().ev,alive:!0,...x}}];else if("insertBlockBefore"===t.command)I=[{pointer:{table:y().ev,id:F(t.parentId)},command:"listBefore",path:["content"],args:{id:F(t.insertBlockNode.attributes.id),before:t.beforeId?F(t.beforeId):void 0}},g().op.update({pointer:{table:y().ev,id:F(t.parentId)},path:[],args:x}),{pointer:{table:y().ev,id:F(t.insertBlockNode.attributes.id)},command:"update",path:[],args:{parent_id:F(t.parentId),parent_table:y().ev,alive:!0,...x}}];else if("insertBlockAfter"===t.command){if("page"===t.insertBlockNode.tagName)return{value:[{type:"latentOperation",latentOperation:{type:"insertBlockAfter",assistantOperation:t,data:{spaceId:c,actorPointer:r}}}]};I=j(t,x)}else if("setBlockText"===t.command)I=[{pointer:{table:y().ev,id:F(t.blockNode.attributes.id)},command:"update",path:["properties"],args:{title:t.text&&t.text.length>0?(0,S().ld)({type:"text",nodes:t.text,getRecordModel:w,currentTimeZone:b}):void 0}},g().op.update({pointer:{table:y().ev,id:F(t.blockNode.attributes.id)},path:[],args:x})];else if("setBlockAttribute"===t.command){const e=D[t.attribute];if(!e)return{value:[]};{const r=e(t.value,{spaceId:c,isCreate:!1}),n={table:y().ev,id:F(t.blockNode.attributes.id)};I=[...r.properties?[g().op.update({pointer:n,path:["properties"],args:r.properties})]:[],...r.format?[g().op.update({pointer:n,path:["format"],args:r.format})]:[],g().op.update({pointer:n,path:[],args:x})]}}else if("setBlockTagName"===t.command){const e=S().w$[t.tagName];if(!e)return{error:new Error(`Unknown tag name: ${t.tagName}`)};I=[{pointer:{table:y().ev,id:F(t.blockNode.attributes.id)},command:"update",path:[],args:{type:e,...x}}]}else if("setBlockProperty"===t.command){const{blockNode:e,property:r,parentBlockId:n}=t,a={table:y().ev,id:F(e.attributes.id)},i=n?{table:y().ev,id:F(n)}:void 0,c=l(a),p=i?l(i):void 0;if(!c)return{error:new Error(`Block not found: ${e.attributes.id}.`)};if("property-title"===r.tagName)I=[{pointer:{table:y().ev,id:F(t.blockNode.attributes.id)},command:"update",path:["properties"],args:{title:(0,S().ld)({type:"text",nodes:r.children,getRecordModel:w,currentTimeZone:b})}},g().op.update({pointer:{table:y().ev,id:F(t.blockNode.attributes.id)},path:[],args:x})];else if(c.type===s().xd.tableRow){var N;if(!i||!p)return{error:new Error(`Block not found: ${n}.`)};if(p.type!==s().xd.table)return{error:new Error("Parent block is not of type table.")};const e=Number(r.attributes.name);if(!Number.isInteger(e)||e<1)return{error:new Error(`Invalid column index: ${e}.`)};const t=(null===(N=p.format)||void 0===N?void 0:N.table_block_column_order)||[];if(e>t.length+1)return{error:new Error(`Column index too high: ${e}.`)};const l=t[e-1];let d,c;l?(d=l,c=[...t]):(d=(0,o().Ay)(),c=[...t,d]),I=[g().op.update({pointer:a,path:["properties"],args:{[d]:r.children.length>0?(0,S().ld)({type:"text",nodes:r.children,getRecordModel:w,currentTimeZone:b})||[]:null}}),g().op.update({pointer:a,path:[],args:x})],l||I.push(g().op.update({pointer:i,path:["format"],args:{table_block_column_order:c}}),g().op.update({pointer:i,path:[],args:x}))}else{const e=(0,u().zN)({getRecordValue:l,block:c});if(!e)return{error:new Error("Block is not in a database.")};const n=r.attributes.name,o=(0,d().Dp)(e),a=Object.entries(o).find((e=>{let[,t]=e;return(null==t?void 0:t.name)===n}));if(!a)return{error:new Error(`Property not found: ${n}`)};const[i]=a,s=(0,S().ld)({type:"property",property:r,nodes:r.children,getRecordModel:w,currentTimeZone:b});I=[{pointer:{table:y().ev,id:F(t.blockNode.attributes.id)},command:"update",path:["properties"],args:{[i]:s}},g().op.update({pointer:{table:y().ev,id:F(t.blockNode.attributes.id)},path:[],args:x})]}}else if("insertOrMoveTableColumns"===t.command){var M;const{blockNode:e,atIndex:r,insertOrMoves:n}=t,d={table:y().ev,id:F(e.attributes.id)},c=l(d);if(!c)return{error:new Error(`Block not found: ${e.attributes.id}.`)};if(c.type!==s().xd.table)return{error:new Error("Block is not of type table.")};const u=(null===(M=c.format)||void 0===M?void 0:M.table_block_column_order)||[],p=a().Q.map(n,(e=>{if("schema"===e.type){return{value:(0,o().Ay)()}}if("move"===e.type){const t=u[Number(e.attributes.name)-1];return t?{value:t}:{error:new Error(`Invalid column index: ${e.attributes.name}.`)}}(0,i().HB)(e)}));if(a().Q.isFail(p))return p;const m=p.value,h=[...u.slice(0,r).filter((e=>!m.includes(e))),...m,...u.slice(r).filter((e=>!m.includes(e)))];I=[g().op.update({pointer:d,path:["format"],args:{table_block_column_order:h}}),g().op.update({pointer:d,path:[],args:x})]}else if("removeTableColumn"===t.command){var _;const{blockNode:e,columnIndex:r}=t,n={table:y().ev,id:F(e.attributes.id)},o=l(n);if(!o)return{error:new Error(`Block not found: ${e.attributes.id}.`)};if(o.type!==s().xd.table)return{error:new Error("Block is not of type table.")};const a=(null===(_=o.format)||void 0===_?void 0:_.table_block_column_order)||[],i=a[r];if(!i)return{error:new Error(`Invalid column index: ${r}.`)};const d=[...a.slice(0,r),...a.slice(r+1)];I=[g().op.update({pointer:n,path:["format"],args:{table_block_column_order:d}}),g().op.update({pointer:n,path:[],args:x}),...(o.content||[]).flatMap((e=>{const t={table:y().ev,id:e},r=l(t);return r&&r.type===s().xd.tableRow?[g().op.update({pointer:t,path:["properties"],args:{[i]:null}}),g().op.update({pointer:t,path:[],args:x})]:[]}))]}else if("setBlockParent"===t.command){const e={table:y().ev,id:t.parentId};let r;const n=l(e);n&&(r=(0,f().OZ)({table:y().ev,value:n})),I=[{pointer:{table:y().ev,id:F(t.blockNode.attributes.id)},command:"update",path:[],args:{...r?{parent_id:F(r.id),parent_table:r.table}:{parent_id:F(e.id),parent_table:e.table},alive:!0,...x}}]}else{if("addBlockToPage"===t.command){return{value:[{type:"latentOperation",latentOperation:{type:"addBlockToPage",assistantOperation:t,data:{spaceId:c,actorPointer:r}}}]}}(0,i().HB)(t)}}return{value:I.map((e=>({type:"operation",operation:e})))}}(r);if(a().Q.isFail(l))return l;return{value:l.value.map((e=>"operation"===e.type?{...e,operation:(0,c().t)([e.operation],t)[0]}:"latentOperation"===e.type?e:void(0,i().HB)(e)))}}function C(e){return{addBlockToPage:{target:"privatePages",spaceViewId:e},enforceDefaultInsertBehavior:!0,shouldRemoveBlocksFromParent:!1}}function N(e){const{shouldRemoveBlocksFromParent:t}=e;return{addBlockToPage:{spaceViewId:void 0,target:"unlistedPages"},enforceDefaultInsertBehavior:!0,shouldRemoveBlocksFromParent:t}}function M(){return{addBlockToPage:{target:"privatePages",spaceViewId:void 0},enforceDefaultInsertBehavior:!0,shouldRemoveBlocksFromParent:!1}}function _(){return{addBlockToPage:{target:"privatePages",spaceViewId:void 0},enforceDefaultInsertBehavior:!0,shouldRemoveBlocksFromParent:!0}}function B(e,t){let r=[];for(const n of e){if("operation"===n.type){r.push(n.operation);continue}const{latentOperation:e}=n,{type:o}=e;if("addBlockToPage"===o){const{assistantOperation:n,data:o}=e,{spaceId:a,actorPointer:i}=o,{addBlockToPage:s}=t,l=[{type:"user_permission",role:"editor",user_id:i.id}];"unlistedPages"===s.target&&l.push({type:"space_permission",role:"editor",unlisted_timestamp:Date.now()});const d={pointer:{table:y().ev,id:F(n.blockNode.attributes.id)},command:"update",path:[],args:{permissions:l,parent_id:a,parent_table:v().NX,alive:!0}},{spaceViewId:c}=s,u=c&&{pointer:{table:x().mu,id:c},command:"listAfter",path:["private_pages"],args:{id:F(n.blockNode.attributes.id)}};u&&r.push(u),r.push(d)}else if("insertBlockAfter"===o){const{actorPointer:t}=e.data;r=r.concat(j(e.assistantOperation,{last_edited_by_table:t.table,last_edited_by_id:t.id,last_edited_time:Date.now()}))}else if("removeBlock"===o){const{actorPointer:n}=e.data;r=r.concat(A({assistantOperation:e.assistantOperation,updateMetadata:{last_edited_by_table:n.table,last_edited_by_id:n.id,last_edited_time:Date.now()},includeRemoveFromParent:t.shouldRemoveBlocksFromParent}))}else(0,i().HB)(o)}return r}function A(e){const{assistantOperation:t,updateMetadata:r,includeRemoveFromParent:n}=e;return(n?[{pointer:{table:y().ev,id:F(t.parentId)},command:"listRemove",path:["content"],args:{id:F(t.removeBlockNode.attributes.id)}}]:[]).concat([g().op.update({pointer:{table:y().ev,id:F(t.parentId)},path:[],args:r}),{pointer:{table:y().ev,id:F(t.removeBlockNode.attributes.id)},command:"update",path:[],args:{parent_id:F(t.parentId),parent_table:y().ev,alive:!1,...r}}])}function j(e,t){return[{pointer:{table:y().ev,id:F(e.parentId)},command:"listAfter",path:["content"],args:{id:F(e.insertBlockNode.attributes.id),after:e.afterId?F(e.afterId):void 0}},g().op.update({pointer:{table:y().ev,id:F(e.parentId)},path:[],args:t}),{pointer:{table:y().ev,id:F(e.insertBlockNode.attributes.id)},command:"update",path:[],args:{parent_id:F(e.parentId),parent_table:y().ev,alive:!0,...t}}]}function P(e){const t=new Set;for(const r of e)"latentOperation"===r.type?"removeBlock"===r.latentOperation.type?t.add(r.latentOperation.assistantOperation.removeBlockNode.attributes.id):"insertBlockAfter"===r.latentOperation.type?t.add(r.latentOperation.assistantOperation.insertBlockNode.attributes.id):"addBlockToPage"===r.latentOperation.type?t.add(r.latentOperation.assistantOperation.blockNode.attributes.id):(0,i().HB)(r.latentOperation):"operation"===r.type?r.operation.pointer.table===y().ev&&t.add(r.operation.pointer.id):(0,i().HB)(r);return[...t]}async function R(e){let{assistantDatabaseQuery:t,spaceId:r,loadRecordModel:n}=e;const a={databaseId:F(t.databaseId),filter:t.filter,sorts:t.sorts,limit:t.limit},i={table:b().Vl,id:a.databaseId,spaceId:r},s=await n(i);if(!s)throw new Error("No collection");const l=s.getNormalizedSchema(),d=s.getParentPointer();if(d.table===b().Vl)throw new Error("Unsupported parent object for collection");const c={...d,spaceId:r};return{collectionViewBlockPointer:c,collectionPointer:{...i,spaceId:c.spaceId},filter:E({groupFilter:a.filter,schema:l}),sort:a.sorts.map((e=>{const t=Object.keys(l).find((t=>{var r;return(0,o().Ut)(t)&&(null===(r=l[t])||void 0===r?void 0:r.name)===e.propertyName}));if(!t)throw new Error(`Invalid property name: ${e.propertyName}.`);return{property:t,direction:e.direction}})),aggregation:O({collectionSchema:l,aggregationRequest:t.aggregation}),limit:Math.min(a.limit||I().qO,I().qO)}}function E(e){const{groupFilter:t,schema:r}=e;return{operator:{any:"or",all:"and"}[t.operator],filters:t.filters.map((e=>{const{operator:t}=e;return"any"===t||"all"===t?E({groupFilter:e,schema:r}):"is"===t||"contains"===t||">"===t||"<"===t||"≥"===t||"≤"===t||"is empty"===t?function(e){const{filter:t,schema:r}=e,{propertyTagName:n,operator:a,not:s,attributes:l,children:d,propertyName:c}=t,u=Object.keys(r).find((e=>{var t;return(0,o().Ut)(e)&&(null===(t=r[e])||void 0===t?void 0:t.name)===c}));if(!u)throw new Error(`Invalid property name: ${c}.`);if("property-title"===n||"property-text"===n||"property-url"===n||"property-email"===n||"property-phone-number"===n){const e={empty:s?"is_not_empty":"is_empty",is:s?"string_is_not":"string_is",contains:s?"string_does_not_contain":"string_contains"};return{property:u,filter:"is empty"!==a&&(0,i().EI)(d)?{operator:e[a],value:{type:"exact",value:d[0].value}}:{operator:e.empty}}}if("property-person"===n||"property-created-by"===n||"property-last-edited-by"===n){const e={empty:s?"is_not_empty":"is_empty",contains:s?"person_does_not_contain":"person_contains"};return{property:u,filter:(0,i().EI)(d)?{operator:e[a],value:d.filter((e=>"mention-person"===e.tagName)).map((e=>{const t=e.attributes["person-id"];return{type:"exact",value:{table:k().oo,id:t}}}))}:{operator:e.empty}}}if("property-relation"===n){const e={empty:s?"is_not_empty":"is_empty",contains:s?"relation_does_not_contain":"relation_contains"};return{property:u,filter:(0,i().EI)(d)?{operator:e[a],value:d.map((e=>({type:"exact",value:e.attributes["page-id"]})))}:{operator:e.empty}}}if("property-date"===n||"property-created-time"===n||"property-last-edited-time"===n){if("is"===a&&!0===s)throw new Error("Data filter does not support 'is not' operator");const e={empty:s?"is_not_empty":"is_empty",is:"date_is",">":s?"date_is_on_or_before":"date_is_after","<":s?"date_is_on_or_after":"date_is_before","≥":s?"date_is_before":"date_is_on_or_after","≤":s?"date_is_after":"date_is_on_or_before"};if("is empty"===a)return{property:u,filter:{operator:e.empty}};let t;const r=d[0];if("mention-date"!==r.tagName)throw new Error("Invalid mention date in filter. This should never happen");return t={type:"date",start_date:r.attributes.date},{property:u,filter:{operator:e[a],value:{type:"exact",value:t}}}}if("property-checkbox"===n)return{property:u,filter:{operator:{is:s?"checkbox_is_not":"checkbox_is"}[a],value:{type:"exact",value:{true:!0,false:!1}[l.checked]}}};if("property-select"===n){const e={empty:s?"is_not_empty":"is_empty",is:s?"enum_is_not":"enum_is"};return{property:u,filter:(0,i().EI)(d)?{operator:e[a],value:d.map((e=>({type:"exact",value:e.attributes.option})))}:{operator:e.empty}}}if("property-multi-select"===n){const e={empty:s?"is_not_empty":"is_empty",contains:s?"enum_does_not_contain":"enum_contains"};return{property:u,filter:(0,i().EI)(d)?{operator:e[a],value:d.map((e=>({type:"exact",value:e.attributes.option})))}:{operator:e.empty}}}if("property-status"===n){const e={empty:s?"is_not_empty":"is_empty",is:s?"status_is_not":"status_is"};return{property:u,filter:(0,i().EI)(d)?{operator:e[a],value:d.map((e=>"option-category"===e.tagName?{type:"is_group",value:e.attributes.category}:"option"===e.tagName?{type:"is_option",value:e.attributes.option}:(0,i().HB)(e)))}:{operator:e.empty}}}if("property-number"===n){const e={empty:s?"is_not_empty":"is_empty",is:s?"number_does_not_equal":"number_equals",">":s?"number_less_than_or_equal_to":"number_greater_than","<":s?"number_greater_than_or_equal_to":"number_less_than","≥":s?"number_less_than":"number_greater_than_or_equal_to","≤":s?"number_greater_than":"number_less_than_or_equal_to"};if("is empty"===a)return{property:u,filter:{operator:e.empty}};const t=r[u];if(!t||"number"!==t.type)throw new Error("Invalid property type");const n=h().$J(l.number);if("number"!=typeof n)throw new Error("Invalid number");const o={property:u,filter:{operator:e[a],value:{type:"exact",value:n}}};return!s||">"!==a&&"<"!==a&&"≥"!==a&&"≤"!==a?o:{operator:"or",filters:[o,{property:u,filter:{operator:"is_empty"}}]}}(0,i().HB)(n)}({filter:e,schema:r}):void(0,i().HB)(t)}))}}function O(e){const{collectionSchema:t,aggregationRequest:r}=e;if(!r)return;const n=Object.entries(t).find((e=>{let[,t]=e;return t&&t.name===r.attributes.name}));if(!n)return;const o=n[0];return"aggregation-property-status"===r.tagName?{property:o,aggregator:"Count per group"===r.attributes.aggregation||"Percent per group"===r.attributes.aggregation?{operator:w().sk[r.attributes.aggregation],groupName:r.attributes.group}:w().sk[r.attributes.aggregation]}:{property:o,aggregator:w().sk[r.attributes.aggregation]}}function F(e){return e.split("/")[0]}function L(e){return e}const D={checked:e=>({properties:{checked:"true"===e?d().h4:d().ZO}}),color:e=>{if(!e)return{};const t=w().BP[e];if(!t)throw new Error(`Unrecognized assistant color: ${e}`);return{format:{block_color:t}}},"synced-block-id":(e,t)=>{let{spaceId:r}=t;return e?{format:{transclusion_reference_pointer:{id:e,table:y().ev,spaceId:r}}}:{}},"page-font":e=>({format:{page_font:e&&(0,r(284371).PE)(e)?e:void 0}}),"page-font-size":e=>({format:{page_small_text:"small"===e}}),"page-width":e=>({format:{page_full_width:"full-width"===e}}),language:(e,t)=>{if(!e||!(0,l().Ll)(e))return{};const r=l().nD[e];return{properties:{language:[[r]]},...t.isCreate&&(0,l().OG)(r)?{format:{code_preview_format:"preview"}}:{}}},index:e=>{if(!e)return{};const t=parseInt(e);return Number.isInteger(t)?{format:{list_start_index:t}}:{}}}},693176:(e,t,r)=>{"use strict";r.d(t,{S:()=>k});r(517642),r(658004),r(733853),r(845876),r(432475),r(515024),r(731698),r(898992),r(354520),r(803949),r(581454);var n=r(296540),o=()=>r(484714),a=()=>r(56366),i=()=>r(874963),s=()=>r(854150),l=()=>r(245241),d=()=>r(959013),c=()=>r(37433),u=()=>r(106628),p=()=>r(351360),m=()=>r(630116),h=()=>r(988499),g=()=>r(614505),f=()=>r(848401),y=()=>r(297401),b=()=>r(626822),v=()=>r(821879),x=r(474848);function k(e){let{mode:t,title:r,teamIds:n,onChange:a,disabled:s,focused:m,onMenuDismiss:g,onMenuOpen:f,parentStore:y}=e;const b=(0,o().v3)(),k=(0,d().tz)(),w=(0,l().fg)(n);return(0,x.jsx)(v().A,{mode:t,title:r,icon:i().f,iconStyles:C(b).recordIcon,items:w||[],onChange:a,disabled:s,focused:m,renderFilter:(e,t)=>(0,x.jsx)(N,{item:e,args:t,parentStore:y}),renderToken:(e,t)=>(0,x.jsx)(T,{item:e,handlers:t,teamIds:n,parentStore:y}),renderItemForSummary:e=>(0,x.jsx)(S,{item:e,parentStore:y}),addItemLabel:(0,x.jsx)(d().sA,{defaultMessage:"Add a teamspace",id:"search.filterMenu.addATeamButton.label"}),labelText:{title:r,tokenInputPlaceholder:k.formatMessage({defaultMessage:"Search teamspaces",id:"search.filterMenu.searchTeams.placeholder"}),componentDebugName:"SearchTeamFilter"},performRequest:e=>async function(e,t){var r;let{query:n,current:o}=e;const a=new Set(o),i=p().default.state.currentSpaceViewStore,s=p().default.state.currentSpaceStore,l=null===(r=p().default.state.currentUserStore)||void 0===r?void 0:r.id;if(!i||!s||!l)return[];if(!n){const e=new Set(i.getTeamsStores().map((e=>e.id)));if(h().A.state.teams.map((e=>e.id)).forEach((t=>e.add(t))),e.size>0)return[...e]}const d=await(0,c().qd)({fromCache:!0,environment:t,spaceStore:s,includeArchived:!1,currentUserId:l}),m=await u().T.searchActions.load();return(await m.searchTeams({query:n,spaceViewStore:i,teamStores:d.teams})).filter((e=>!a.has(e.id))).slice(0,20).map((e=>e.id))}(e,b),renderResultMenuItem:(e,t)=>(0,x.jsx)(I,{item:e,props:t,parentStore:y}),onMenuDismiss:g,onMenuOpen:f,hasItemsSelected:Boolean(w&&(null==w?void 0:w.length)>0)})}function w(e,t){return m().h4.createChildStore(t,{table:s().yK,id:e})}function S(e){let{item:t,parentStore:r}=e;return(0,x.jsx)(x.Fragment,{children:w(t,r).getName()})}function I(e){let{item:t,props:r,parentStore:o}=e;const a=w(t,o);return(0,n.createElement)(b().A,{...r,key:t,teamStore:a})}function T(e){let{item:t,handlers:r,teamIds:n,parentStore:i}=e;const s=(0,o().v3)(),d=(0,l().fg)(n),c=1===(null==d?void 0:d.length),u=(0,a().K8)((()=>w(t,i)),[t,i]),p=(0,a().K8)((()=>u.getName()),[u]),m=(0,a().K8)((()=>function(e){const t=e.getIcon();return function(e){return(0,x.jsx)(g().A,{disabled:!0,icon:t,isEmptyPage:!1,size:e})}}(u)),[u]);return u?(0,x.jsx)(f().Ay,{format:s.device.isMobile?f().mI.Large:f().mI.Small,showRemoveButton:!0,isSingle:c,onClickRemove:r.onRemove,renderAvatar:m,title:p,style:{background:"transparent"}}):null}function C(e){return{menuItem:{minHeight:void 0,paddingTop:e.device.isMobile?12:4,paddingBottom:e.device.isMobile?12:4},menuItemTitle:{width:"100%"},labeledMenuItemTitle:{display:"inline-flex",alignItems:"center"},menuItemLabel:{marginRight:12},recordIcon:{marginRight:6,fill:"currentColor"}}}function N(e){let{item:t,args:r,parentStore:n}=e;const{disabled:a,onRemove:i,onClick:s}=r,l=C((0,o().v3)()),d=w(t,n),c=(0,x.jsx)(y().A,{disabled:a,onClick:i});return(0,x.jsx)(b().A,{disabled:a,focused:!1,teamStore:d,right:c,style:l.menuItem,desktopTitleStyle:l.menuItemTitle,onClick:s},t)}},716301:(e,t,r)=>{"use strict";r.d(t,{BM:()=>W,Ij:()=>he,Rz:()=>U,Xp:()=>z,jk:()=>H,ld:()=>J,oc:()=>ne,om:()=>pe,w$:()=>te,y5:()=>me});r(16280),r(944114),r(517642),r(658004),r(733853),r(845876),r(432475),r(515024),r(731698),r(898992),r(354520),r(672577),r(430670),r(803949),r(581454),r(737550);var n=()=>r(244641),o=()=>r(496603),a=()=>r(763824),i=()=>r(183558),s=()=>r(973647),l=()=>r(534177),d=()=>r(720665),c=()=>r(612740),u=()=>r(700500),p=()=>r(15440),m=()=>r(970013),h=()=>r(713998),g=()=>r(604995),f=()=>r(651124),y=()=>r(236162),b=()=>r(416504),v=()=>r(390066),x=()=>r(206267),k=()=>r(792071),w=()=>r(72135),S=()=>r(251582),I=()=>r(433847),T=()=>r(388821),C=()=>r(179034),N=()=>r(519831),M=()=>r(869558),_=()=>r(798880),B=()=>r(797809),A=()=>r(919709),j=()=>r(983650),P=()=>r(181856),R=()=>r(510818),E=()=>r(832443),O=()=>r(353566),F=()=>r(252050),L=()=>r(706461),D=()=>r(471159),q=()=>r(972261),K=()=>r(586984);async function U(e){const{pointer:t,intl:r,currentTimeZone:n}=e,o="loadRecordValue"in e?k().h0Y.fromLoadRecordValueFn(e.loadRecordValue):e.loadRecordModel,a=(0,I().ns)({pointer:t,loadRecordModel:o}),i=await z({pointer:t,loadRecordModel:o,rootPointer:t,parentPointer:void 0,spaceId:t.spaceId,intl:r,currentTimeZone:n});if(!i)throw new(P().u7)(t.id,"Failed to build XML node");return{node:i,isNonSpaceShared:!(await a)}}async function H(e){const{intl:t,textValue:r,allowsText:n,allowedTagNames:o,loadRecordModel:a,shouldUsePlaceholderRecordInformation:i,currentTimeZone:s,allowWebLoading:d=!1}=e,p=[],m=T().RecordMap.create(),h=A().RQ(r).flatMap((e=>A().uPN(e)));if(i&&a)throw new Error("Expected no loadRecordModelFn when using placeholder record information");if(!i&&!a)throw new Error("Expected loadRecordModelFn to be defined when not using placeholder record info");!i&&a&&await Promise.all(h.map((async e=>{if(A().jIt(e)){const t={table:C().ev,id:A().v55(e)},r=await a(t);if(m.setModel(t,r),!r)return;const n=r.getCollectionPointer();if(n)m.setModel(n,await a(n));else for(const e of r.getCollectionViewPointers()){const t=await a(e);if(m.setModel(e,t),t){const e=t.getCollectionPointer(r);if(e){const t=await a(e);m.setModel(e,t)}}}}else if(A().rie(e)){const t={table:_().oo,id:A().NcG(e)};m.setModel(t,await a(t))}else if(A().$ch(e)){const t=A().KdU(e);m.setModel(t,await a(t))}})));const f=i?void 0:k().b4_.fromRecordMap(m);for(const v of A().RQ(r)){let e=p,r=!1,a=A().uPN(v);if(A().GiG(v)?a=[...a.filter((e=>!A().gir(e))),...a.filter((e=>A().gir(e)))]:A().qXl(v)&&(a=[...a.filter((e=>!A().iGj(e))),...a.filter((e=>A().iGj(e)))]),!a.some((e=>(0,A().O3D)(e)))){for(const n of a){(A().iGj(n)||A().gir(n))&&(r=!0);const a=A()._XS(n),i=se[a];if(!(0,l().Xk)(o,i))continue;let p;if("e"===i){if(!A().GiG(v)){r=!1;continue}p={type:"inline",tagName:i,attributes:{equation:A().u$N(v)},children:[]}}else if("a"===i){if(!A().sh$(n))throw new Error("Unexpected annotation for link annotation");const e=A().cQR(n);let t=(0,q().Tq)(e);t=d||"web"!==t?t:void 0,p=t?{type:"inline",tagName:i,attributes:{href:e,type:t,"external-id":(0,F().Su)(e)},children:[]}:{type:"inline",tagName:i,attributes:{href:e,type:void 0,"external-id":void 0},children:[]}}else if("mention-page"===i){if(!A().jIt(n))throw new Error("Unexpected annotation for page annotation");const e=A().v55(n);if(f){var y;const r=f({table:C().ev,id:e}),n=(null==r?void 0:r.getCollectionPointer())??(null==r?void 0:r.getFirstCollectionPointerFromViews(f)),o=r?n&&(null===(y=f(n))||void 0===y?void 0:y.getName())||(null==r?void 0:r.getProperty("title")):A().x9d(c().mA(t)),a=[{type:"text",value:(0,R().Pm)(A().q4_(o))}];if(r&&(0,u().Ef)(r.type)){if(!n)throw new Error("Unable to find collection for mention-database");p={type:"inline",tagName:"mention-database",attributes:{"database-id":(0,F().z5)(n.id)},children:a}}else p={type:"inline",tagName:i,attributes:{"page-id":(0,F().ew)(e)},children:a}}else{const t=[{type:"text",value:(0,R().Pm)("Page title")}];p={type:"inline",tagName:i,attributes:{"page-id":(0,F().ew)(e)},children:t}}}else if("mention-database"===i){if(!A().$ch(n))throw new Error("Unexpected annotation for database annotation");const e=A().KdU(n);if(f){var b;const r=e?(null===(b=f(e))||void 0===b?void 0:b.getName())??A().x9d("Unnamed collection"):A().x9d(c().mA(t)),n=[{type:"text",value:(0,R().Pm)(A().q4_(r))}];p={type:"inline",tagName:i,attributes:{"database-id":(0,F().z5)(e.id)},children:n}}else{const t=[{type:"text",value:(0,R().Pm)("Collection title")}];p={type:"inline",tagName:i,attributes:{"database-id":(0,F().z5)(e.id)},children:t}}}else if("mention-person"===i){if(!A().rie(n))throw new Error("Unexpected annotation for user annotation");const e=A().NcG(n);if(f){const r=f({table:_().oo,id:e});p={type:"inline",tagName:i,attributes:{"person-id":(0,F().ew)(e),"person-name":null==r?void 0:r.getDisplayName(t)},children:[]}}else p={type:"inline",tagName:i,attributes:{"person-id":(0,F().ew)(e),"person-name":"Person name"},children:[]}}else if("mention-date"===i){if(!A().qsB(n))throw new Error("Unexpected annotation for date annotation");const e=A().K7D(n),t=(0,g().kW)(e,s);let r,o;"date"===t.type?(r="mention-date",o={date:t.start_date}):"datetime"===t.type?(r="mention-datetime",o={date:t.start_date,time:t.start_time}):"daterange"===t.type?(r="mention-date-range",o={"start-date":t.start_date,"end-date":t.end_date}):(r="mention-datetime-range",o={"start-date":t.start_date,"start-time":t.start_time,"end-date":t.end_date,"end-time":t.end_time}),p={type:"inline",tagName:r,attributes:o,children:[]}}else if("h"===i){if(!A().YuY(n))throw new Error("Unexpected annotation for highlight annotation");p={type:"inline",tagName:i,attributes:{color:F().P8[A().uIc(n)]},children:[]}}else if("mention-link"===i){if(!A().ik2(n))throw new Error("Unexpected annotation for link mention annotation");const e=A().q1R(n);p={type:"inline",tagName:i,attributes:{title:e.title,href:e.href,description:e.description,icon_url:e.icon_url},children:[]}}else p={type:"inline",tagName:i,attributes:{},children:[]};e.push(p),e=p.children}if(!r&&n){const t=A().N8A(v);t.length>0&&e.push({type:"text",value:(0,R().Pm)(t)})}}}return p}function $(e){const{tagName:t,blockId:r,schemaId:n,attributes:o}=e;return(0,F().g5)(t),{type:"block",tagName:t,text:[],attributes:{id:r,...o},properties:{},schemas:{},children:[],parent:void 0,persisted:!0,schemaId:n}}function V(e){const t=ee[e];return(0,l().O)(F().sA,t)}async function z(e){const{pointer:t,loadRecordModel:r,rootPointer:n,parentPointer:o,spaceId:i,intl:s,currentTimeZone:d,viewedBlockIds:c=new Set}=e;if(c.has(t.id))return;c.add(t.id);const m=await r(t);if(!m)return;if(!V(m.type))return;const h=t.table===n.table&&t.id===n.id&&t.spaceId===n.spaceId,g=m.getFormatValue("suggestions");if(!h&&g&&g.some((e=>"insert"===e.type)))return;let f,b=t;const v=(0,F().ew)((null==o?void 0:o.id)??n.id);if(m.isType(u().xd.page)){var x;const e=null===(x=await(0,y().wC)({block:m,loadRecordModel:r}))||void 0===x?void 0:x.id,t=e?(0,F().z5)(e):void 0,a=m.getFormatValue("page_font"),i=m.getFormatValue("page_small_text")?"small":void 0,l=m.getFormatValue("page_full_width")?"full-width":void 0;if(h){const e=await(0,y().wC)({block:m,loadRecordModel:r});let n;n=e&&e.parent_table!==N().Vl?(0,F().ew)(e.parent_id):(0,F().ew)(m.id),f=$({tagName:ee[m.type],blockId:(0,F().ew)(m.id),attributes:{...a&&"comic"!==a?{"page-font":a}:{},...i?{"page-font-size":i}:{},...l?{"page-width":l}:{},...t?{"database-id":t}:{}},schemaId:n})}else f=$({tagName:"child-page",blockId:(0,F().ew)(`${m.id}/${(null==o?void 0:o.id)||n.id}`),attributes:{"page-id":(0,F().ew)(m.id),"database-id":t,"has-content":m.getContentLength()>0?"true":"false"},schemaId:v});await Z({node:f,block:m,loadRecordModel:r,intl:s,currentTimeZone:d}),!h&&t&&await async function(e){const{node:t,loadRecordModel:r,intl:n,currentTimeZone:o,block:a,maxBlocksToLoad:i=50,viewedBlockIds:s=new Set}=e,l=a.getContentPointers(),d=[];for(const c of l){const e=await z({pointer:c,rootPointer:a.pointer,parentPointer:a.pointer,spaceId:a.getSpaceId(),loadRecordModel:r,intl:n,currentTimeZone:o,viewedBlockIds:s});if(e&&(d.push(e),d.length>=i))break}t.children.push(...d.slice(0,i))}({node:f,loadRecordModel:r,intl:s,currentTimeZone:d,block:m,maxBlocksToLoad:50,viewedBlockIds:c})}else if(m.type===u().xd.collectionView||m.type===u().xd.collectionViewPage)f=$({tagName:"database-views",blockId:(0,F().ew)(m.id),schemaId:(0,F().ew)(m.id),attributes:{}}),await Z({block:m,node:f,loadRecordModel:r,intl:s,currentTimeZone:d});else if(m.type===u().xd.alias){const e=m.getFormatValue("alias_pointer");if(!e||e.table!==C().ev)return;const t=await r(e);if(!t)return;if(t.type===u().xd.collectionView||t.type===u().xd.collectionViewPage)f=$({tagName:"link-database",blockId:(0,F().ew)(m.id),schemaId:v,attributes:{"database-id":(0,F().z5)(t.id)}});else{var k;const e=null===(k=await(0,y().wC)({block:m,loadRecordModel:r}))||void 0===k?void 0:k.getParentId();f=$({tagName:"link-page",blockId:(0,F().ew)(m.id),schemaId:v,attributes:{"page-id":(0,F().ew)(t.id),...e?{"database-id":(0,F().z5)(e)}:{}}})}await Z({node:f,block:t,loadRecordModel:r,intl:s,currentTimeZone:d})}else if(m.type===u().xd.table){const e=m.getFormatValue("table_block_row_header"),t=m.getFormatValue("table_block_column_header");f=$({tagName:ee[m.type],blockId:(0,F().ew)(m.id),schemaId:v,attributes:{...e?{"header-row":"true"}:{},...t?{"header-column":"true"}:{}}})}else if(m.type===u().xd.tableRow){if(m.parent_table!==C().ev)return;const e=await r({table:m.parent_table,id:m.parent_id,spaceId:m.space_id});if(!e||e.type!==u().xd.table)return;f=$({tagName:ee[m.type],blockId:(0,F().ew)(m.id),schemaId:v,attributes:{}});const t=e.getFormatValue("table_block_column_order")||[];for(const n of t){const e=(t.indexOf(n)+1).toString(),o={type:"property",tagName:"property-text",attributes:{name:e},children:await H({textValue:m.getProperty(n),allowsText:F().GU["property-text"].text,allowedTagNames:F().GU["property-text"].inline,loadRecordModel:r,intl:s,currentTimeZone:d})};f.properties[e]=o}}else if(m.isType(u().xd.transclusionReference)){const e=m.getTransclusionReferenceTargetPointer();if(!e)return;f=$({tagName:ee[m.type],blockId:(0,F().ew)(m.id),schemaId:v,attributes:{"synced-block-id":(0,F().ew)(e.id)}}),b=e}else if(m.getFormatValue("toggleable")&&(m.isType(u().xd.header)||m.isType(u().xd.subHeader)||m.isType(u().xd.subSubHeader))){const e=re[m.type];f=$({tagName:"toggle",blockId:(0,F().ew)(m.id),schemaId:v,attributes:{size:e}}),await Z({block:m,node:f,loadRecordModel:r,intl:s,currentTimeZone:d})}else if(m.isType(u().xd.code)){const e=A().q4_(m.getProperties().language),t=(0,p().aN)(e)?e:oe,n=p().$K[t];f=$({tagName:"code-block",blockId:(0,F().ew)(m.id),schemaId:v,attributes:{language:n}}),await Z({block:m,node:f,loadRecordModel:r,intl:s,currentTimeZone:d})}else"unknown-block"===ee[m.type]?(f=$({tagName:"unknown-block",blockId:(0,F().ew)(m.id),schemaId:v,attributes:{type:m.type}}),await Z({block:m,node:f,loadRecordModel:r,intl:s,currentTimeZone:d})):(f=$({tagName:ee[m.type],blockId:(0,F().ew)(m.id),schemaId:v,attributes:{}}),await Z({block:m,node:f,loadRecordModel:r,intl:s,currentTimeZone:d}));if((0,l().Xk)(F().sW,f.tagName)){const e=m.getFormatValue("block_color");e&&(f.attributes.color=F().P8[e])}if(m.isType(u().xd.collectionViewPage)||m.isType(u().xd.collectionView)){const e=m.getCollectionViewIds(),t=(await a().lX(e,500,(async e=>await async function(e){const{pointer:t,parentPointer:r,loadRecordModel:n}=e,o=await n(t);if(!o)return;const a=await n(r);if(!a)return;const i=o.getCollectionPointer(a);if(!i)return;const s=await n(i);if(!s)return;const l=(0,A().k4p)(s.getName()),d=o.getName(),c={type:"collectionView",tagName:"database-view",parent:(0,F().ew)(r.id),attributes:{id:(0,F().wn)(t.id),title:d??"","database-id":(0,F().z5)(s.id),"database-name":l},persisted:!0,schemaId:(0,F().ew)(r.id)};return c}({pointer:{table:M().Gy,id:e},loadRecordModel:r,rootPointer:n,intl:s,parentPointer:{table:C().ev,id:f.attributes.id}})))).filter(l().O9);f.children.push(...t)}else if(h||!(0,u().$I)(m.type)){let e;if(m.isType(u().xd.transclusionReference)){e=[];const t=m.getTransclusionReferenceTargetPointer();if(t){const n=await r(t);n&&(e=n.getRenderableContentIds())}}else e=m.getRenderableContentIds();const t=(await Promise.all(e.map((e=>z({pointer:{table:"block",id:e},loadRecordModel:r,rootPointer:n,parentPointer:b,spaceId:i,intl:s,currentTimeZone:d,viewedBlockIds:c}))))).filter(l().O9);f.children.push(...t),t.forEach((e=>{e.parent=f}))}return f}async function W(e){const{loadRecordModel:t,collectionPointer:r,intl:n,currentTimeZone:o}=e,a=await t(r);if(!a)throw new(P().S2)(r.id,"Failed to build XML Node. No available collection model");const i=a.getParentPointer();if(i.table===N().Vl)throw new(P().S2)(r.id,"Unsupported operation for table");const s=await t(i);if(!s)throw new(P().S2)(r.id,"Failed to build XML node: missing block");if(!V(s.type))throw new(P().S2)(r.id,`Failed to build XML node: unsupported block type ${s.type}`);const l=T().RecordMapWithRole.create(),d=k().b4_.fromRecordMapWithRole(l),c={type:"collection",tagName:"database",parent:(0,F().ew)(i.id),attributes:{id:(0,F().z5)(r.id),title:a.getRenderTitle({getRecordModel:d,userTimeZone:(0,g().dB)(),intl:n})??""},persisted:!0,schemaId:(0,F().ew)(s.id),schemas:{},properties:{}},u=a.getDescription();if(u){const e={type:"property",tagName:"property-text",attributes:{name:"Description"},children:await H({textValue:u,allowsText:!0,allowedTagNames:Object.keys(F()._S),loadRecordModel:t,intl:n,currentTimeZone:o})};c.properties.description=e}return await G({collectionPointedTo:a,node:c,loadRecordModel:t}),c}function Q(e){const t=e.getNormalizedSchema(),r=["title",...((0,v().L)(e.getFormat()||{},t,void 0,f().jf.Page).collection_page_properties||[]).map((e=>{let{property:t}=e;return t}))];return Object.entries(t).sort(((e,t)=>{let[n]=e,[o]=t;return r.indexOf(n)-r.indexOf(o)}))}async function G(e){let{collectionPointedTo:t,node:r,loadRecordModel:n}=e;await Promise.all(Q(t).map((async e=>{let[t,o]=e;if(!(0,i().Ut)(t)||!o)return;const a=`schema-${ae[o.type]}`;if((0,l().O)(F().U4,a))switch(a){case"schema-property-title":case"schema-property-text":case"schema-property-url":case"schema-property-email":case"schema-property-phone-number":case"schema-property-checkbox":case"schema-property-created-time":case"schema-property-created-by":case"schema-property-last-edited-by":case"schema-property-last-edited-time":{const e={type:"schema",tagName:a,attributes:{name:o.name,description:o.description},children:[]};r.schemas[o.name]=e;break}case"schema-property-date":{const e={type:"schema",tagName:a,attributes:{name:o.name,description:o.description},children:[]};r.schemas[o.name]=e;break}case"schema-property-number":{if("number"!==o.type)throw new Error(`Unexpected property schema type ${o.type}`);const e={type:"schema",tagName:a,attributes:{name:o.name,description:o.description,format:o.number_format||"number"},children:[]};r.schemas[o.name]=e;break}case"schema-property-person":{if("person"!==o.type)throw new Error(`Unexpected property schema type ${o.type}`);const e=1===o.limit?"1":"Infinity",t={type:"schema",tagName:a,attributes:{name:o.name,description:o.description,limit:e},children:[]};r.schemas[o.name]=t;break}case"schema-property-multi-select":case"schema-property-select":{if("select"!==o.type&&"multi_select"!==o.type)throw new Error(`Unexpected property schema type ${o.type}`);const e={type:"schema",tagName:a,attributes:{name:o.name,description:o.description},children:(o.options||[]).map((e=>({type:"inline",tagName:"schema-option",attributes:{option:e.value},children:[]})))};r.schemas[o.name]=e;break}case"schema-property-relation":{var s;if("relation"!==o.type)throw new Error(`Unexpected property schema type ${o.type}`);const e=1===o.limit?"1":"Infinity",t=(0,m().zO)(o),i=t?(0,F().z5)(t):void 0;if(!i)throw new Error("Cannot link to relation without table pointer");if(o.connectedRelation)break;const d=await n({id:i,table:N().Vl});if(!d)break;const c=d.getNormalizedSchema(),u=o.property&&(0,l().O)(c,o.property)?(null===(s=c[o.property])||void 0===s?void 0:s.name)??void 0:void 0,p={type:"schema",tagName:a,attributes:{name:o.name,description:o.description,limit:e,"database-id":i,"synced-property-name":u},children:[]};r.schemas[o.name]=p;break}case"schema-property-status":{if("status"!==o.type)throw new Error(`Unexpected property schema type ${o.type}`);const e={type:"schema",tagName:a,attributes:{name:o.name,description:o.description},children:(o.groups||[]).map((e=>({type:"inline",tagName:"schema-option-category",attributes:{category:e.name},children:(e.optionIds||[]).flatMap((e=>{var t;const r=null===(t=o.options)||void 0===t?void 0:t.find((t=>t.id===e));return r?{type:"inline",tagName:"schema-option",attributes:{option:r.value},children:[]}:[]}))})))};r.schemas[o.name]=e;break}default:(0,l().HB)(a)}})))}async function Z(e){const{block:t,node:r,loadRecordModel:o,intl:s,currentTimeZone:d}=e,c=t.getCollectionPointer(),p=c&&await o(c);p&&"database-views"!==r.tagName&&await G({collectionPointedTo:p,node:r,loadRecordModel:o});const g=await(0,y().wC)({block:t,loadRecordModel:o}),f=g?Q(g):(0,u().$I)(t.type)?(0,l().WP)({title:(0,B().RX)(s).title}):void 0;if(f)await async function(e){let{propertySchemaByIdEntries:t,block:r,node:o,intl:s,collectionPointedTo:d,loadRecordModel:c,currentTimeZone:u}=e;const p=new Map;await(0,a().lX)(t,25,(async e=>{let[t,o]=e;if(!(0,i().Ut)(t)||!o)return;const a=ae[o.type];if(!(0,l().O)(F().GU,a))return;const g="title"===t&&(null==d?void 0:d.getName())||r.getProperty(t);switch(a){case"property-title":{const e={type:"property",tagName:a,attributes:{name:o.name},children:await H({textValue:g,allowsText:F().GU[a].text,allowedTagNames:F().GU[a].inline,loadRecordModel:c,intl:s,currentTimeZone:u})};p.set(t,e);break}case"property-text":{const e={type:"property",tagName:a,attributes:{name:o.name},children:await H({textValue:g,allowsText:F().GU[a].text,allowedTagNames:F().GU[a].inline,loadRecordModel:c,intl:s,currentTimeZone:u})};p.set(t,e);break}case"property-url":{const e={type:"property",tagName:a,attributes:{name:o.name},children:await H({textValue:h().jw(h().MO(g)),allowsText:F().GU[a].text,allowedTagNames:F().GU[a].inline,loadRecordModel:c,intl:s,currentTimeZone:u})};p.set(t,e);break}case"property-email":case"property-phone-number":{const e={type:"property",tagName:a,attributes:{name:o.name},children:await H({textValue:g,allowsText:F().GU[a].text,allowedTagNames:F().GU[a].inline,loadRecordModel:c,intl:s,currentTimeZone:u})};p.set(t,e);break}case"property-person":{const e=k().Bj6.fromBlock(r),n={type:"property",tagName:a,attributes:{name:o.name},children:await H({textValue:h().AH(h().e5({textValue:g,propertySchema:o,blockCreatorPointer:e.getCreatedByPointer()})),allowsText:F().GU[a].text,allowedTagNames:F().GU[a].inline,loadRecordModel:c,intl:s,currentTimeZone:u})};p.set(t,n);break}case"property-created-by":case"property-last-edited-by":{let e;e="property-created-by"===a?r.getCreatedByPointer():r.getLastEditedByPointer();const n={type:"property",tagName:a,attributes:{name:o.name},children:await H({textValue:h().AH(e?[e]:[]),allowsText:F().GU[a].text,allowedTagNames:F().GU[a].inline,loadRecordModel:c,intl:s,currentTimeZone:u})};p.set(t,n);break}case"property-relation":{if("relation"!==o.type)throw new Error("Invalid type for property-relation");const e=(0,m().zO)(o);if(!e)throw new Error("Invalid database id for property-relation");const r=await c({table:N().Vl,id:e});if(!r)break;if(o.connectedRelation)break;const n=(0,F().z5)(r.id),i=(await h().jB({relationValue:(0,h().n)(g),loadRecordModel:c,limit:10,propertySchema:o})).map((e=>e.pointer)),l={type:"property",tagName:a,attributes:{name:o.name,"database-id":n},children:await H({textValue:(0,h().Ap)(i),allowsText:F().GU[a].text,allowedTagNames:F().GU[a].inline,loadRecordModel:c,intl:s,currentTimeZone:u})};p.set(t,l);break}case"property-date":{const e={type:"property",tagName:a,attributes:{name:o.name},children:await H({textValue:g,allowsText:F().GU[a].text,allowedTagNames:F().GU[a].inline,loadRecordModel:c,intl:s,currentTimeZone:u})};p.set(t,e);break}case"property-created-time":case"property-last-edited-time":{const e=n().c9.fromMillis(r[ie[a]]),i={type:"property",tagName:a,attributes:{name:o.name},children:await H({textValue:h().m5({type:"datetime",start_date:e.toISODate(),start_time:e.toFormat("HH:mm"),time_zone:e.zone.name}),allowsText:F().GU[a].text,allowedTagNames:F().GU[a].inline,loadRecordModel:c,intl:s,currentTimeZone:u})};p.set(t,i);break}case"property-checkbox":{const e={type:"property",tagName:a,attributes:{name:o.name,checked:h().wu(g)?"true":"false"},children:await H({textValue:g,allowsText:F().GU[a].text,allowedTagNames:F().GU[a].inline,loadRecordModel:c,intl:s,currentTimeZone:u})};p.set(t,e);break}case"property-select":case"property-multi-select":case"property-status":{let e;if("select"===o.type){const t=h().L3(g,o.options||[]);e=void 0!==t?[t]:[]}else if("multi_select"===o.type)e=h().o2(g,o.options||[]);else{if("status"!==o.type)throw new Error("Unexpected property schema type");{const t=h().RZ(g,o);e=void 0!==t?[t]:[]}}const r={type:"property",tagName:a,attributes:{name:o.name},children:e.map((e=>({type:"inline",tagName:"option",attributes:{option:e},children:[]})))};p.set(t,r);break}case"property-number":{if("number"!==o.type)throw new Error("Unexpected property schema type");const e=w().ZV(h().Me(g),o.number_format,s),r={type:"property",tagName:a,attributes:{name:o.name,number:e},children:await H({textValue:g,allowsText:F().GU[a].text,allowedTagNames:F().GU[a].inline,loadRecordModel:c,intl:s,currentTimeZone:u})};p.set(t,r);break}default:(0,l().HB)(a)}}));for(const[n,a]of t){if(!a)continue;const e=p.get(n);e&&(o.properties[a.name]=e)}}({propertySchemaByIdEntries:f,block:t,node:r,intl:s,loadRecordModel:o,collectionPointedTo:p,currentTimeZone:d});else for(const n of B().vn){const e=t.getProperty(n);if(e)if("title"===n)r.text.push(...await H({textValue:e,allowsText:!0,allowedTagNames:(0,l().uv)(F()._S),loadRecordModel:o,intl:s,currentTimeZone:d}));else{const t=Y(n,e);t&&(r.attributes[n]=t)}}}function Y(e,t){if("checked"===e)return A().q4_(t)===m().I1?"true":"false"}const X=Symbol("CitationToStrip");function J(e){const{getRecordModel:t,currentTimeZone:r}=e;if("text"===e.type){const{nodes:n,citationHandling:o}=e,a=function(e){return e.map(((t,r)=>{if(t===X)return;const n=t;let o=A().N8A(n);return r<e.length&&e[r+1]===X&&(o=o.trimEnd()),r>=0&&e[r-1]===X&&(o=o.trimStart()),0!==o.length?A().Ey_(o,A().uPN(n)):void 0})).filter(l().O9)}(n.flatMap((e=>{if("inline"===e.type){const n=function(e){if("mention-date"===e||"mention-datetime"===e||"mention-date-range"===e||"mention-datetime-range"===e)return"d";if("mention-database"===e)return"p";const t=ue[e];return t}(e.tagName);if(!n)throw new Error(`Unknown inline element: ${e.tagName}`);const a=e.children;let i;if((0,l().O)(le,n)){const r={node:e,getRecordModel:t};i=le[n](r)}else{if(!ce(n))throw new Error(`Unsupported annotation type: ${n}`);i=[n]}if(!i)return[];const s=J({type:"text",nodes:a,getRecordModel:t,currentTimeZone:r})||[];if(A().iGj(i))return[A().Ey_(A().Sj,[i])];if(A().gir(i))return[A().Ey_(A().Yl$,[i])];if(A().sh$(i)&&(0,l().O9)(i[1])&&0===A().AhH(s)&&(0,l().O9)(o))if("createCitations"===o.type){const e=A().cQR(i),t=E().tD.parseAssistantHref(e);if(t){if("database_query_results"===t.type){const e=t.id;return[A().wmz(A().X$({type:"query_database_result",href:i[1],queryDatabaseResultId:e}))]}if("block"===t.type){const{blockId:e}=t;return[A().wmz(A().X$({href:i[1],blockId:e,type:"block"}))]}if("slack"===t.type){const{baseUrl:e,domain:r,channelId:n,messageId:a,threadTs:s}=t;return[A().wmz(A().X$({type:"slack",href:i[1],baseUrl:e,domain:r,channelId:n,messageId:a,threadTs:s,threadHref:o.getPageLevelCitationId(t.href)}))]}if("helpdoc"===t.type){const{url:e}=t;return[A().wmz(A().X$({href:i[1],url:e,type:t.type}))]}if("helpdoc-section"===t.type){const{url:e}=t;return[A().wmz(A().X$({href:i[1],url:e,type:t.type,parentPageHref:t.parentPageHref}))]}if("google-drive"===t.type){const{url:e}=t;return[A().wmz(A().X$({href:i[1],url:e,type:t.type,messageId:e}))]}if("github"===t.type){const{url:e}=t;return[A().wmz(A().X$({href:i[1],url:e,type:"github",messageId:e}))]}if("jira"===t.type){const{url:e}=t;return[A().wmz(A().X$({href:i[1],url:e,type:"jira",messageId:e}))]}if("sharepoint"===t.type){const{url:e}=t;return[A().wmz(A().X$({href:i[1],url:e,type:"sharepoint",messageId:e}))]}if("webpage"===t.type){const{url:e}=t;return[A().wmz(A().X$({href:i[1],url:e,type:"webpage"}))]}if("citation_unsupported"===t.type)return[X];(0,l().HB)(t)}}else{if("stripCitations"===o.type)return[X];(0,l().HB)(o)}if(A().sh$(i)&&(0,l().O9)(i[1])){const e=A().cQR(i),t=E().tD.parseAssistantHref(e);if(t)if("slack"===t.type){const{baseUrl:e,domain:r,channelId:n,messageId:o,threadTs:a}=t,s=(0,j().mQ)({baseUrl:e,domain:r,channelId:n,messageId:o,threadTs:a});i=A().Sez(s)}else"google-drive"!==t.type&&"github"!==t.type&&"webpage"!==t.type&&"helpdoc"!==t.type&&"helpdoc-section"!==t.type||(i=A().Sez(t.url))}const d=i;return s.map((e=>A().Ey_(A().N8A(e),[d,...A().uPN(e)])))}if("text"===e.type)return[A().Ey_(e.value,[])];(0,l().HB)(e)}))),i="createCitations"!==(null==o?void 0:o.type)?a:function(e){let{tokens:t,getPageLevelCitationId:r}=e;const n=e=>{var t;if(!A().qXl(e))return;const n=null===(t=A().g2K(e[1]))||void 0===t?void 0:t[1].href;return n?r(n):void 0};return t.filter(((e,r)=>{if(0===r)return!0;const o=n(e);return!(0,l().O9)(o)||o!==n(t[r-1])}))}({tokens:a,getPageLevelCitationId:o.getPageLevelCitationId});return A().__s(i)}{const{property:n,nodes:a}=e;if("property-title"===n.tagName||"property-text"===n.tagName||"property-url"===n.tagName||"property-email"===n.tagName||"property-phone-number"===n.tagName)return J({type:"text",nodes:a,getRecordModel:t,currentTimeZone:r});if("property-person"===n.tagName){const e=o().oE(a.map((e=>"inline"===e.type&&"mention-person"===e.tagName?e.attributes["person-id"]:void 0)));return h().AH(e.map((e=>({table:_().oo,id:e}))))}if("property-relation"===n.tagName){const e=o().oE(a.map((e=>{if("inline"===e.type&&"mention-page"===e.tagName)return e.attributes["page-id"]})));return(0,h().Ap)(e.map((e=>({table:C().ev,id:e}))))}if("property-date"===n.tagName){if(1!==a.length)throw new Error("Date property XML definition is invalid - should only have 1 mention");const e=a[0];if("inline"!==e.type)throw new Error("Date property XML definition should only have inline children");if("mention-date"===e.tagName)return h().m5({type:"date",start_date:e.attributes.date});if("mention-date-range"===e.tagName)return h().m5({type:"daterange",start_date:e.attributes["start-date"],end_date:e.attributes["end-date"]});if("mention-datetime"===e.tagName)return h().m5({type:"datetime",start_date:e.attributes.date,start_time:e.attributes.time,time_zone:r});if("mention-datetime-range"===e.tagName)return h().m5({type:"datetimerange",start_date:e.attributes["start-date"],end_date:e.attributes["end-date"],start_time:e.attributes["start-time"],end_time:e.attributes["end-time"],time_zone:r});throw new Error("Date property XML mention option is invalid")}if("property-checkbox"===n.tagName)return"true"===n.attributes.checked?m().h4:m().ZO;if("property-select"===n.tagName||"property-status"===n.tagName){const e=o().oE(a.map((e=>"inline"===e.type&&"option"===e.tagName?e.attributes.option:void 0)))[0];return h().U8(e)}if("property-multi-select"===n.tagName){const e=o().oE(a.map((e=>"inline"===e.type&&"option"===e.tagName?e.attributes.option:void 0)));return h().rK(e)}if("property-number"===n.tagName){const e=n.attributes.number,t=e?w().$J(e):void 0;return h().hk(t)}if("property-created-time"===n.tagName||"property-last-edited-time"===n.tagName||"property-created-by"===n.tagName||"property-last-edited-by"===n.tagName)throw new Error(`You should not manually edit metadata of type ${n.tagName}.`);(0,l().HB)(n)}}const ee={encrypted_text:"text",text:"text",page:"page",bulleted_list:"uli",numbered_list:"oli",toggle:"toggle",quote:"quote",factory:"factory",button:"button",to_do:"todo",column_list:"columns",column:"column",embed:"unknown-block",framer:"unknown-block",tweet:"unknown-block",gist:"unknown-block",drive:"unknown-block",figma:"unknown-block",loom:"unknown-block",typeform:"unknown-block",codepen:"unknown-block",audio:"unknown-block",maps:"unknown-block",invision:"unknown-block",image:"unknown-block",pdf:"unknown-block",video:"unknown-block",file:"unknown-block",bookmark:"unknown-block",equation:"math-block",code:"code-block",header:"h1",sub_header:"h2",sub_sub_header:"h3",collection_view:"database-views",collection_view_page:"database-views",breadcrumb:"breadcrumb",copy_indicator:"unknown-block",link_to_page:"link_to_page",link_to_collection:"link_to_collection",alias:"link-page",transclusion_container:"synced-block",transclusion_reference:"synced-block-reference",divider:"hr",callout:"callout",table_of_contents:"tableofcontents",whimsical:"unknown-block",miro:"unknown-block",abstract:"unknown-block",sketch:"unknown-block",excalidraw:"unknown-block",replit:"unknown-block",hex:"unknown-block",deepnote:"unknown-block",mixpanel:"unknown-block",post:"unknown-block",external_object_instance:"unknown-block",workflow:"unknown-block",transcription:"transcript",external_object_instance_page:"unknown-block",table:"table",table_row:"tr",tab:"tab",ai_block:"ai-block",drawing:"drawing",slide:"slide",personal_home_page:"page",form:"page",person_profile:"page"},te={...(0,d().MU)((0,l().WP)(ee).map((e=>{let[t,r]=e;return[r,t]}))),"child-page":"page","child-database":"page","link-page":"alias","link-database":"alias",page:"page"},re={[u().xd.header]:"h1",[u().xd.subHeader]:"h2",[u().xd.subSubHeader]:"h3"},ne=(0,d().AH)(re),oe="JavaScript",ae={title:"property-title",text:"property-text",url:"property-url",email:"property-email",phone_number:"property-phone-number",checkbox:"property-checkbox",person:"property-person",created_by:"property-created-by",last_edited_by:"property-last-edited-by",file:"property-file",select:"property-select",multi_select:"property-multi-select",status:"property-status",number:"property-number",date:"property-date",created_time:"property-created-time",last_edited_time:"property-last-edited-time",last_visited_time:"property-last-visited-time",formula:"property-formula",rollup:"property-rollup",button:"property-button",auto_increment_id:"property-id",location:"property-location",verification:"property-verification",geo_point:"property-geo-point",relation:"property-relation"},ie=o().B8(ae),se={b:"b",i:"i",s:"s",c:"code","~":"~",_:"u","+":"+","-":"-",z:"z",u:"mention-person",r:"r",p:"mention-page",ce:"ce",pt:"pt",d:"mention-date",eoi:"eoi",tv:"tv",cm:"cm",m:"m",a:"a",h:"h",e:"e",et:"et",xt:"xt",st:"st",fpp:"fpp",fv:"fv",g:"group",t:"team",mark:"find-highlight",smark:"selected-find-highlight",ci:"ci",tc:"tc",si:"si",sr:"sr",sa:"sa",sua:"sua",mabf:"mabf",dut:"dut",ht:"ht",lm:"mention-link",aic:"mention-database",tch:"tch",tsu:"tsu",geo:"geo"},le={u:e=>{let{node:t}=e;if(!t.attributes["person-id"])throw new Error(`Missing attribute person-id for inline element ${t.tagName}`);return["u",t.attributes["person-id"]]},p:e=>{let{node:t,getRecordModel:r}=e;if("mention-page"===t.tagName){if(!t.attributes["page-id"])throw new Error(`Missing attribute page-id for inline element ${t.tagName}`);return["p",t.attributes["page-id"]]}if("mention-database"===t.tagName){if(!t.attributes["database-id"])throw new Error(`Missing attribute database-id for inline element ${t.tagName}`);const e=r({id:t.attributes["database-id"],table:N().Vl}),n=null==e?void 0:e.getParentPointer();if((null==n?void 0:n.table)===C().ev)return["p",n.id]}else(0,l().HB)(t)},d:e=>{let{node:t}=e;return"mention-date-range"===t.tagName?["d",{start_date:t.attributes["start-date"],end_date:t.attributes["end-date"],type:"daterange"}]:"mention-date"===t.tagName?["d",{start_date:t.attributes.date,type:"date"}]:"mention-datetime"===t.tagName?["d",{start_date:t.attributes.date,start_time:t.attributes.time,time_zone:(0,b().P)(),type:"datetime"}]:"mention-datetime-range"===t.tagName?["d",{start_date:t.attributes["start-date"],start_time:t.attributes["start-time"],end_date:t.attributes["end-date"],end_time:t.attributes["end-time"],time_zone:(0,b().P)(),type:"datetimerange"}]:void(0,l().HB)(t)},a:e=>{let{node:t}=e;if(!t.attributes.href)throw new Error(`Missing attribute href for inline element ${t.tagName}`);return["a",t.attributes.href]},h:e=>{let{node:t}=e;if(!t.attributes.color)throw new Error(`Missing color attribute for inline element ${t.tagName}`);if(!F().Bt.includes(t.attributes.color))throw new Error(`Bad color attribute for inline element: ${t.attributes.color}`);return["h",F().BP[t.attributes.color]]},lm:e=>{let{node:t}=e;if(!t.attributes.href)throw new Error(`Missing attribute href for inline element ${t.tagName}`);return["lm",{href:t.attributes.href,title:t.attributes.title,description:t.attributes.description,icon_url:t.attributes.icon_url}]},e:e=>{let{node:t}=e;if(!t.attributes.equation)throw new Error(`Missing attribute equation for inline element ${t.tagName}`);return["e",t.attributes.equation]}},de={[A().Ifu.Bold]:!0,[A().Ifu.Italic]:!0,[A().Ifu.Strike]:!0,[A().Ifu.Code]:!0,[A().Ifu.FormulaError]:!0,[A().Ifu.Underline]:!0,[A().Ifu.Inserted]:!0,[A().Ifu.Deleted]:!0,[A().Ifu.TemporaryComment]:!0,[A().Ifu.TemporaryCursor]:!0,[A().Ifu.TemporaryPage]:!0,[A().Ifu.TemporaryEquation]:!0,[A().Ifu.TemporarySelection]:!0,[A().Ifu.TemporaryFindHighlight]:!0,[A().Ifu.TemporarySelectedFindHighlight]:!0,[A().Ifu.TemporaryCommentHighlight]:!0},ce=(0,l().u0)((e=>(0,l().O)(de,e)?{true:e}:{false:e})),ue=(0,d().AH)(se);async function pe(e){return{type:"instructions",tagName:"instructions",attributes:{},children:e.shouldUsePlaceholderRecordInformation?await H({textValue:e.textValue,allowsText:!0,allowedTagNames:F().qI,intl:e.intl,shouldUsePlaceholderRecordInformation:!0,currentTimeZone:e.currentTimeZone}):await H({textValue:e.textValue,allowsText:!0,allowedTagNames:F().qI,loadRecordModel:e.loadRecordModel,intl:e.intl,currentTimeZone:e.currentTimeZone})}}function me(e){const{inlineNodes:t,idMapper:r,humanChatTag:n}=e,o=function(e){const{inlineNodes:t,idMapper:r}=e;return`<text>${t.map((e=>r.mapNodeKeyToCounter(e))).map((e=>(0,L().sD)({node:e,selection:void 0,namespace:"end_to_end"}))).join("")}</text>`}({inlineNodes:t,idMapper:r});return`<${n}>${o}</${n}>`}function he(e){const t=function(e){const{chatValue:t,evaluatorState:r}=e,n=r.getIdMapper(),o=(0,D().gO)(r.parse(t),O().p$),a=(0,S().$d)((0,K().dl)({allocateIdFn:()=>(0,F().ew)(x().Dt()),mapCounterToKey:e=>n.mapCounterToKey(e)}),o);return s().Q.isSuccess(a)?a.value.children:[]}({chatValue:e.humanChatValue,evaluatorState:e.evaluatorState});return t.flatMap((e=>{if("text"in e)return e.text})).filter(l().O9)}},718680:(e,t,r)=>{"use strict";r.d(t,{sb:()=>fn,CX:()=>bn});var n=r(296540),o=()=>r(484714),a=()=>r(56366),i=()=>r(401497),s=()=>r(584262),l=()=>r(175947),d=()=>r(496603),c=()=>r(222917),u=()=>r(884107),p=()=>r(187778),m=()=>r(38337),h=()=>r(492414),g=()=>r(722872),f=()=>r(825972),y=()=>r(780865),b=()=>r(755278),v=()=>r(857437),x=()=>r(691298),k=()=>r(227440),w=()=>r(574012),S=()=>r(899677),I=()=>r(250484),T=()=>r(297872),C=()=>r(545805),N=()=>r(928600),M=()=>r(45552),_=()=>r(198427),B=()=>r(307060),A=(r(581454),()=>r(715256)),j=r(474848);const P=(0,r(340498).wt)("bot",{viewBox:"0 0 16 16",svg:(0,j.jsx)("path",{d:"M7.996 16C12.381 16 16 12.38 16 8s-3.627-8-8.012-8C3.611 0 0 3.62 0 8s3.62 8 7.996 8zm0-1.594A6.375 6.375 0 011.61 8a6.366 6.366 0 016.38-6.398A6.393 6.393 0 0114.398 8a6.383 6.383 0 01-6.403 6.406zM4.648 8.518c0 .21.17.364.386.364h2.53l-1.346 3.605c-.202.527.355.813.703.395l4.168-5.176a.515.515 0 00.132-.325c0-.209-.17-.356-.379-.356H8.305l1.346-3.613c.201-.518-.356-.812-.704-.395l-4.16 5.184a.484.484 0 00-.14.317z"})});var R=()=>r(211134),E=()=>r(534177),O=()=>r(780054),F=()=>r(658883),L=()=>r(508496),D=()=>r(793765),q=()=>r(760217),K=()=>r(625830),U=()=>r(472499),H=()=>r(821879),$=()=>r(668725),V=()=>r(959013),z=()=>r(100622),W=()=>r(493823),Q=()=>r(406699),G=()=>r(939740),Z=()=>r(89924);function Y(e){const t=(0,o().Y0)();return(0,j.jsx)(Q().Ay,{popupType:t.isMobile?Q().z7.SlideUp:Q().z7.Popup,renderOrigin:t=>(0,j.jsx)(J,{events:t,...e}),render:t=>(0,j.jsx)(X,{parent:t,...e})})}function X(e){let{parent:t,experiment:r,onChange:n}=e;const a=(0,o().Y0)(),s=(0,i().IS)((()=>({menuOptionStyle:{color:z().Ay.mediumTextColor}})),[]);let l;l=a.isMobile?{menuType:g().gu.Modal,title:r.experimentId,right:(0,j.jsx)(V().sA,{defaultMessage:"Done",id:"appearanceSettings.modal.done"}),onClickRight:t.close}:{menuType:g().gu.Popup,width:250};const d=r.groups.map((e=>({key:e,action:o=>{n({experimentId:r.experimentId,group:e}),t.close()},render:(t,r)=>(0,j.jsx)(q().A,{...t,title:e,style:s.menuOptionStyle})})));return(0,j.jsx)(N().A,{...l,children:(0,j.jsx)(G().Ay,{type:G().Oh.Vertical,initialFocus:void 0,sections:[{key:r.experimentId,render:e=>(0,j.jsx)(Z().A,{...e}),items:d}]})})}function J(e){let{experiment:t,events:r,searchExperimentOverrides:o}=e;const a=(0,i().IS)((e=>({experimentGroupButtonChevronStyle:{width:10,fill:e.lightIconColor},experimentGroupButtonStyle:{overflowX:"hidden",justifyContent:"left",overflow:"hidden",marginLeft:6,color:e.mediumTextColor},rowContainer:{display:"flex",overflow:"hidden",flexDirection:"row"},groupCell:{overflow:"hidden",marginRight:4}})),[]);return(0,n.createElement)(W().p,{...r,size:"sm",key:t.experimentId,style:a.experimentGroupButtonStyle},(0,j.jsxs)("div",{style:a.rowContainer,children:[(0,j.jsx)("div",{style:a.groupCell,children:o[t.experimentId]||t.group}),(0,j.jsx)("div",{children:(0,$().b)(a.experimentGroupButtonChevronStyle)})]}))}function ee(e){return{fontSize:14,lineHeight:1.2,color:e.mediumTextColor,marginRight:4,display:"flex",alignItems:"center",whiteSpace:"nowrap"}}const te=function(e){const{experiment:t}=e,{leftOverrides:r,rightOverrides:o,experimentDiffers:s,experimentAgreesButNondefault:l}=(0,a().K8)((()=>{const e=D().E.state.searchExperimentOverrides,r=D().nS.state.searchExperimentOverrides,n=(e[t.experimentId]??t.group)!==(r[t.experimentId]??t.group);return{leftOverrides:e,rightOverrides:r,experimentDiffers:n,experimentAgreesButNondefault:!n&&void 0!==r[t.experimentId]&&e[t.experimentId]!==t.group}}),[t]),d=(0,i().IS)((e=>({rowContainer:{backgroundColor:s?e.equationErrorPlaceholderBackground:l?e.accentColors.yellow[100]:void 0},titleCell:{...ee(e),maxWidth:180,textOverflow:"ellipsis",overflow:"hidden"}})),[l,s]),c=(0,n.useCallback)((e=>{const{experimentId:t,group:r,store:n}=e;n.setState({...n.state,searchExperimentOverrides:{...n.state.searchExperimentOverrides,[t]:r}})}),[]);return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("div",{style:{...d.titleCell,...d.rowContainer},children:t.experimentId.replace("search-","")}),(0,j.jsx)("div",{style:d.rowContainer,children:(0,j.jsx)(Y,{experiment:t,searchExperimentOverrides:r,onChange:e=>{c({...e,store:D().E})}})}),(0,j.jsx)("div",{style:d.rowContainer,children:(0,j.jsx)(Y,{experiment:t,searchExperimentOverrides:o,onChange:e=>{c({...e,store:D().nS})}})})]})};var re=()=>r(806754),ne=()=>r(805751),oe=()=>r(623580);function ae(e){const{leftValue:t,rightValue:r,setLeftValue:o,setRightValue:a,placeholder:s,label:l}=e,{titleCell:d,rightTitleCell:c,leftTitleCell:u}=(0,i().IS)((e=>{const n=ee(e);return{titleCell:n,rightTitleCell:{...n,color:r?n.color:e.lightTextColor,width:"95%"},leftTitleCell:{...n,color:t?n.color:e.lightTextColor,width:"95%"}}}),[t,r]),[p,m]=(0,n.useState)(r),[h,g]=(0,n.useState)(t);(0,n.useEffect)((()=>{void 0===r&&m(void 0),void 0===t&&g(void 0)}),[r,t]);const f=(0,n.useCallback)((()=>{a(p)}),[a,p]),y=(0,n.useCallback)((()=>{o(h)}),[o,h]),b=(0,n.useCallback)((e=>{m(e.target.value)}),[]),v=(0,n.useCallback)((e=>{g(e.target.value)}),[]);return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("div",{style:d,children:l}),(0,j.jsxs)(ne().A,{debugName:"SearchStringOverrideControls",capture:!0,allowMenuList:!1,children:[(0,j.jsx)(oe().A,{style:u,onBlur:y,value:h,onChange:v,placeholder:s}),(0,j.jsx)(oe().A,{style:c,onBlur:f,value:p,onChange:b,placeholder:s})]})]})}function ie(){const e=(0,n.useRef)(null),t=(0,a().K8)((()=>(0,E().WP)(A().hH).map((e=>{let[t,r]=e;return{experimentId:t,experimentVersion:1,group:L().default.getGroup(t),groups:["control",...r]}}))),[]);return(0,j.jsx)(se,{ref:e,searchExperimentsToToggle:t})}const se=n.forwardRef((function(e,t){let{searchExperimentsToToggle:n}=e;const s=(0,i().DP)(),l=(0,o().v3)(),d={sidebar:{paddingTop:12,paddingBottom:24,overflowY:"auto",overflowX:"hidden",flex:"0 0 250px",minHeight:400},sidebarHidden:{display:"none"}},c=function(e){return{sidebar:{backgroundColor:e.sidebarSecondaryBackground,borderLeft:`1px solid ${e.regularDividerColor}`}}}(s),u=(0,a().K8)((()=>I().Ay.isDebugSidebarOpen()),[]),p=(0,a().K8)((()=>(0,F().q)(l)),[l]),m={...d.sidebar,...c.sidebar,...!u&&d.sidebarHidden};return(0,j.jsxs)("aside",{ref:t,style:m,children:[(0,j.jsx)(r(197190).A,{onClick:he,style:{display:"flex",alignItems:"center",justifyContent:"center",background:void 0,borderRadius:6,width:16,height:16,position:"absolute",top:10,right:10,...p&&(0,r(745766).g)({noDrag:!0})},children:(0,r(66913).V)({width:14,fill:s.mediumTextColor})}),(0,j.jsx)(le,{searchExperimentsToToggle:n})]})}));function le(e){let{searchExperimentsToToggle:t}=e;const{leftForcedClusterPattern:n,rightForcedClusterPattern:o,leftForcedBlockIds:i,rightForcedBlockIds:s}=(0,a().K8)((()=>({leftForcedClusterPattern:D().E.state.forcedClusterPattern,rightForcedClusterPattern:D().nS.state.forcedClusterPattern,leftForcedBlockIds:D().E.state.forcedBlockIds,rightForcedBlockIds:D().nS.state.forcedBlockIds})),[]);return(0,R().PF)(O().A)?(0,j.jsx)(re().A,{title:"Dev Tools",children:(0,j.jsxs)(r(145214).A,{animate:{height:"100%"},style:{overflow:"scroll"},children:[(0,j.jsx)(pe,{}),(0,j.jsx)(me,{}),(0,j.jsx)(ue,{}),(0,j.jsxs)(re().A,{style:{marginTop:16},title:"Quick Switch",children:[(0,j.jsx)(ce,{title:"No local at all",searchExperimentOverrides:{"search-no-local-blending":"on","search-debug-only-no-recent-boosting":"on"}}),(0,j.jsx)(ce,{title:"No local results",searchExperimentOverrides:{"search-no-local-blending":"on"}}),(0,j.jsx)(ce,{title:"No local boosting",searchExperimentOverrides:{"search-debug-only-no-recent-boosting":"on"}}),(0,j.jsx)(ce,{title:"Vector only",searchExperimentOverrides:{"search-vectors":"log-norm"}})]}),(0,j.jsx)(re().A,{style:{marginTop:16},title:"Dev Experiments",right:(0,j.jsx)(r(920773).p,{onClick:()=>{D().E.reset(),D().nS.reset()},style:{paddingLeft:0,paddingRight:0,height:"unset"},children:(0,r(796073).$)({width:12})}),children:(0,j.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr 1fr",minWidth:"100%",maxWidth:"100%",paddingLeft:14},children:[(0,j.jsx)("div",{}),(0,j.jsx)("div",{}),(0,j.jsx)(de,{columnStore:D().nS}),t.map((e=>(0,j.jsx)(te,{experiment:e},e.experimentId))),(0,j.jsx)(ae,{leftValue:n,rightValue:o,setLeftValue:e=>D().E.updateForcedClusterPattern(e),setRightValue:e=>D().nS.updateForcedClusterPattern(e),placeholder:"cluster-pattern",label:"forced cluster pattern"}),(0,j.jsx)(ae,{leftValue:i,rightValue:s,setLeftValue:e=>D().E.updateForcedBlockIds(e),setRightValue:e=>D().nS.updateForcedBlockIds(e),placeholder:"block ids",label:"forced block ids"})]})})]})}):null}function de(e){let{columnStore:t}=e;const r=(0,a().K8)((()=>t.state.visible),[t]);return(0,j.jsx)(q().A,{icon:(0,j.jsx)(K().A,{checked:r,size:14,onClick:()=>t.update((e=>({...e,visible:!e.visible})))}),focused:!1,title:"Show",onClick:()=>t.update((e=>({...e,visible:!e.visible})))})}function ce(e){let{title:t,searchExperimentOverrides:r}=e;return(0,j.jsx)(q().A,{focused:!1,title:t,onClick:()=>{D().nS.update((e=>({...e,visible:!1}))),D().E.update((e=>({...e,searchExperimentOverrides:r})))}})}function ue(){return null}function pe(){const e=(0,a().K8)((()=>D().Ay.state.showDebugInfo),[]);return(0,j.jsx)(U().J,{mode:H().C.Button,focused:!1,title:"Show debug info",icon:P,value:e,onChange:e=>{D().Ay.setState({...D().Ay.state,showDebugInfo:Boolean(e)})}})}function me(){const e=(0,a().K8)((()=>"everything"===D().Ay.state.debug),[]);return(0,j.jsx)(U().J,{mode:H().C.Button,focused:!1,title:"Profile query",icon:P,value:e,onChange:e=>{D().Ay.setState({...D().Ay.state,debug:e?"everything":void 0})}})}function he(){I().Ay.update((e=>({...e,isDebugSidebarOpen:!1})))}var ge=()=>r(284371),fe=()=>r(678553),ye=()=>r(563884),be=()=>r(37433),ve=()=>r(575695),xe=()=>r(409066),ke=()=>r(140828),we=()=>r(693176),Se=(r(898992),r(354520),()=>r(604995)),Ie=()=>r(416504),Te=()=>r(91451),Ce=()=>r(687646),Ne=()=>r(351360),Me=()=>r(704152);let _e=function(e){return e[e.Button=0]="Button",e[e.MenuItem=1]="MenuItem",e}({});function Be(e){let{mode:t,icon:r,title:n,filter:o,isLastInSection:a,onMenuDismiss:i,focused:s}=e;return t===_e.Button?(0,j.jsx)(qe,{icon:r,title:n,filter:o,isLastInSection:a,onMenuDismiss:i}):t===_e.MenuItem?(0,j.jsx)(Ke,{icon:r,title:n,filter:o,focused:s,isLastInSection:a,onMenuDismiss:i}):void(0,E().HB)(t)}function Ae(e){const t=(0,a().K8)((()=>Re()),[]);return t?(0,j.jsx)(Be,{icon:Ce().k,title:(0,j.jsx)(V().sA,{id:"search.filterMenu.quickFilters.inCurrentPage",defaultMessage:"In current page"}),filter:t,...e}):null}function je(e){const t=Oe((0,o().v3)());return t?(0,j.jsx)(Be,{icon:Te().z,title:(0,j.jsx)(V().sA,{id:"search.filterMenu.quickFilters.createdByMe",defaultMessage:"Created by me"}),filter:t,...e}):null}function Pe(e){const t=Ee();return t?(0,j.jsx)(Be,{icon:ye().k,title:(0,j.jsx)(V().sA,{id:"search.filterMenu.quickFilters.editedLastWeek",defaultMessage:"Edited last week"}),filter:t,...e}):null}function Re(){const{mainEditorCurrentBlockStore:e}=Ne().default.state;if(e&&e.id)return{ancestors:[e.id]}}function Ee(){return{lastEditedTime:{starting:Se().t0((0,Ie().P)()),ending:Se().Ec((0,Ie().P)())}}}function Oe(e){const{id:t}=e.currentUser;if(t)return{createdBy:[t]}}function Fe(e,t,r){const{device:n}=t;return{menuItem:{color:n.isDesktop?r.mediumTextColor:void 0,...e&&{boxShadow:void 0}},buttonFilter:{color:r.mediumTextColor}}}function Le(e,t){!function(e){I().Ay.updateFilters(e)}(e),I().Ay.isDebugSidebarOpen()||I().Ay.setState({...I().Ay.state,isDebugSidebarOpen:!0}),t&&t()}function De(e){return{menuItem:{minHeight:void 0,paddingTop:e.device.isMobile?12:4,paddingBottom:e.device.isMobile?12:4},buttonFilter:{padding:"4px 8px",display:"flex",alignItems:"center",overflow:"hidden"},buttonText:{...ge().RC},icon:{display:"inline-block",height:14,width:14,fill:"currentColor"},buttonIcon:{marginRight:6}}}function qe(e){let{icon:t,title:r,filter:n,isLastInSection:a,onMenuDismiss:s}=e;const l=(0,i().DP)(),d=(0,o().v3)(),c=De(d),u=Fe(a,d,l);return(0,j.jsxs)(Me().A,{style:{...c.buttonFilter,...u.buttonFilter},onClick:()=>Le(n,s),children:[t&&t({...c.icon,...c.buttonIcon}),(0,j.jsx)("span",{style:c.buttonText,children:r})]})}function Ke(e){let{icon:t,title:r,filter:n,focused:a,isLastInSection:s,onMenuDismiss:l}=e;const d=(0,i().DP)(),c=(0,o().v3)(),u=De(c),p=Fe(s,c,d),m={...u.menuItem,...p.menuItem};return(0,j.jsx)(q().A,{icon:t&&t(u.icon),focused:a,title:r,onClick:()=>Le(n,l),style:m})}let Ue=function(e){return e.Button="Button",e.Section="Section",e}({});function He(e,t){let{mode:o}=e;const i=(0,a().uB)(void 0,r(463830).A),s=(0,n.useRef)(null),l=(0,n.useRef)(null);return(0,n.useImperativeHandle)(t,(()=>({getClientHeight:()=>{if(null!==s.current){const e=s.current.getAnchor();return(null==e?void 0:e.clientHeight)??0}return null!==l.current?l.current.clientHeight:0}}))),o===Ue.Button?(0,j.jsx)(st,{ref:s,buttonPopupStore:i}):o===Ue.Section?(0,j.jsx)(it,{ref:l,buttonPopupStore:i}):void(0,E().HB)(o)}const $e=n.forwardRef(He);function Ve(e){return t=>I().Ay.updateFilters({[e]:t})}function ze(e){let{mode:t}=e;const n=(0,a().K8)((()=>I().Ay.state.query.filters),[]);return(0,j.jsx)(U().J,{mode:t,focused:!1,title:(0,j.jsx)(V().sA,{id:"search.filterMenu.deletedOnlyToggle.label",defaultMessage:"Deleted only"}),icon:r(735384).I,value:n.isDeletedOnly||!1,onChange:Ve("isDeletedOnly")})}function We(){return(0,j.jsx)(V().sA,{id:"search.filterMenu.moreFiltersSection.title",defaultMessage:"More filters"})}function Qe(e){I().Ay.updateFilters({navigableBlockContentOnly:e})}function Ge(e){let{mode:t}=e;const{filters:n}=(0,a().K8)((()=>I().Ay.state.query),[]);return(0,j.jsx)(U().J,{mode:t,focused:!1,title:(0,j.jsx)(V().sA,{id:"search.filterMenu.onlyMatchTitlesToggle.label",defaultMessage:"Title only"}),icon:r(263931).D,value:n.navigableBlockContentOnly||!1,onChange:Qe})}function Ze(e){const t={addFilterButtonMobile:{fontSize:ge().J.UISmall.mobile,fontWeight:ge().Wy.medium,marginRight:-8}};return(0,j.jsx)(W().p,{...e,style:t.addFilterButtonMobile,icon:r(316808).g,isBlue:!0,children:(0,j.jsx)(V().sA,{defaultMessage:"Add filter",id:"search.addFilter.button.label"})})}function Ye(e){e.setState({...e.state,open:!1})}function Xe(e){let{buttonPopupStore:t}=e;const r=(0,o().v3)(),i=(0,n.useCallback)((()=>Ye(t)),[t]),{filters:s}=(0,a().K8)((()=>I().Ay.state.query),[]),l=function(e,t){const r=Oe(e);if(!r)return!1;if(!r.createdBy)return!1;const n=r.createdBy[0];return-1!==t.createdBy.indexOf(n)}(r,s),c=function(e){const{lastEditedTime:t}=Ee();return d().n4(t,e.lastEditedTime)}(s),u=(0,a().K8)((()=>function(e){const t=Re();if(!t)return!1;if(!t.ancestors)return!1;const r=t.ancestors[0];return-1!==e.ancestors.indexOf(r)}(s)),[s]);return l&&c&&u?null:(0,j.jsxs)(re().A,{title:(0,j.jsx)(V().sA,{id:"search.filterMenu.quickFiltersSection.title",defaultMessage:"Quick filters"}),marginAfter:!0,children:[!l&&(0,j.jsx)(je,{mode:_e.MenuItem,focused:!1,onMenuDismiss:i}),!c&&(0,j.jsx)(Pe,{mode:_e.MenuItem,focused:!1,onMenuDismiss:i}),!u&&(0,j.jsx)(Ae,{mode:_e.MenuItem,focused:!1,onMenuDismiss:i,isLastInSection:!0})]})}function Je(e){let{mode:t,buttonPopupStore:r}=e;const o=(0,n.useCallback)((()=>Ye(r)),[r]),{filters:i}=(0,a().K8)((()=>I().Ay.state.query),[]);return(0,j.jsx)(B().SearchStoresContext.Consumer,{children:e=>{let{parentStore:r}=e;return(0,j.jsx)(xe().E,{mode:t,focused:!1,title:(0,j.jsx)(V().sA,{id:"search.filterMenu.moreFilters.inPage",defaultMessage:"In"}),parentStore:r,blockIds:i.ancestors,onMenuDismiss:o,onChange:Ve("ancestors")})}})}function et(e){let{mode:t,buttonPopupStore:r}=e;const o=(0,n.useCallback)((()=>Ye(r)),[r]),{filters:i}=(0,a().K8)((()=>I().Ay.state.query),[]);return(0,j.jsx)(B().SearchStoresContext.Consumer,{children:e=>{let{parentStore:r}=e;return(0,j.jsx)(ke().A,{mode:t,focused:!1,title:(0,j.jsx)(V().sA,{id:"search.filterMenu.moreFilters.createdBy",defaultMessage:"Created by"}),parentStore:r,userIds:i.createdBy,onMenuDismiss:o,onChange:Ve("createdBy")})}})}function tt(e){let{mode:t,buttonPopupStore:r}=e;const o=(0,n.useCallback)((()=>Ye(r)),[r]),{filters:i}=(0,a().K8)((()=>I().Ay.state.query),[]);return(0,j.jsx)(ve().A,{mode:t,focused:!1,title:(0,j.jsx)(V().sA,{id:"search.filterMenu.moreFilters.created",defaultMessage:"Created"}),icon:ye().k,value:i.createdTime,onMenuDismiss:o,onChange:Ve("createdTime")})}function rt(e){let{mode:t,buttonPopupStore:r}=e;const o=(0,n.useCallback)((()=>Ye(r)),[r]),{filters:i}=(0,a().K8)((()=>I().Ay.state.query),[]);return(0,j.jsx)(ve().A,{mode:t,focused:!1,title:(0,j.jsx)(V().sA,{id:"search.filterMenu.moreFilters.lastEdited",defaultMessage:"Last edited"}),icon:ye().k,value:i.lastEditedTime,onMenuDismiss:o,onChange:Ve("lastEditedTime")})}function nt(e){let{mode:t,buttonPopupStore:r}=e;const o=(0,n.useCallback)((()=>Ye(r)),[r]),{filters:i}=(0,a().K8)((()=>I().Ay.state.query),[]);return(0,a().K8)((()=>(0,be().zI)()>0),[])?(0,j.jsx)(B().SearchStoresContext.Consumer,{children:e=>{let{parentStore:r}=e;return(0,j.jsx)(we().S,{mode:t,focused:!1,title:(0,j.jsx)(V().sA,{id:"search.filterMenu.moreFilters.inTeams",defaultMessage:"Teamspace"}),parentStore:r,teamIds:i.inTeams,onMenuDismiss:o,onChange:Ve("inTeams")})}}):null}function ot(e){let{activeFilters:t,mode:r,buttonPopupStore:o}=e;return(0,j.jsxs)(n.Fragment,{children:[t.createdBy&&(0,j.jsx)(et,{buttonPopupStore:o,mode:r}),t.createdTime&&(0,j.jsx)(tt,{buttonPopupStore:o,mode:r}),t.lastEditedTime&&(0,j.jsx)(rt,{buttonPopupStore:o,mode:r}),t.ancestors&&(0,j.jsx)(Je,{buttonPopupStore:o,mode:r}),t.inTeams&&(0,j.jsx)(nt,{buttonPopupStore:o,mode:r})]})}function at(e){let{buttonPopupStore:t}=e;return(0,j.jsxs)(N().A,{menuType:g().gu.ActionSheet,children:[(0,j.jsx)(Xe,{buttonPopupStore:t}),(0,j.jsxs)(re().A,{title:(0,j.jsx)(We,{}),children:[(0,j.jsx)(et,{buttonPopupStore:t,mode:H().C.Button}),(0,j.jsx)(tt,{buttonPopupStore:t,mode:H().C.Button}),(0,j.jsx)(rt,{buttonPopupStore:t,mode:H().C.Button}),(0,j.jsx)(Je,{buttonPopupStore:t,mode:H().C.Button}),(0,j.jsx)(nt,{buttonPopupStore:t,mode:H().C.Button})]})]})}const it=n.forwardRef((function(e,t){let{buttonPopupStore:r}=e;const n=(0,a().O$)(I().Ay),o=(0,a().K8)((()=>y().ug(n.query.filters)),[n.query.filters]);return(0,j.jsxs)(Z().A,{ref:t,disableMobilePadding:!0,disableMobileBorders:!0,children:[(0,j.jsx)(Ge,{mode:H().C.Section}),(0,j.jsx)(ze,{mode:H().C.Section}),(0,j.jsx)(ot,{buttonPopupStore:r,activeFilters:o,mode:H().C.Section})]})})),st=n.forwardRef((function(e,t){let{buttonPopupStore:r}=e;const o=(0,n.useCallback)((()=>(0,j.jsx)(at,{buttonPopupStore:r})),[r]);return(0,j.jsx)(Q().Ay,{ref:t,popupType:Q().z7.SlideUp,buttonPopupStore:r,renderOrigin:e=>(0,j.jsx)(Ze,{...e}),render:o})}));var lt=()=>r(413267),dt=()=>r(962730);const ct=function(e){const t=n.useRef(),a=(0,o().Y0)(),{isMobile:s}=a,{activeOption:l,items:d}=n.useMemo((()=>function(e){const{currentSortBy:t,setSortBy:r,sortOptions:n,selectButton:o}=e;let a=n[0];const i=n.map((e=>{const n=t.field,i=`${n}.${"relevance"===n?"":t.direction}`,s=e.key===i;return s&&(a=e),{key:e.key,action:()=>{r(e.sort),o&&o.current&&o.current.closeMenu()},render:t=>(0,j.jsx)(q().A,{...t,title:e.formattedName,right:s&&(0,lt().b)({fill:z().Ay.regularIconColor,width:14,height:14})})}}));return{activeOption:a,items:i}}({...e,selectButton:t})),[e,t]),c=(0,i().IS)((e=>({selectedTitle:{color:e.mediumTextColor},label:{marginRight:2,fontSize:s?ge().J.UISmall.mobile:ge().J.UISmall.desktop,transform:"translateY(0.5px)"},innerButton:{color:e.mediumTextColor,fontWeight:ge().Wy.semibold,fontSize:s?ge().J.UISmall.mobile:ge().J.UISmall.desktop,height:20,padding:"2px 4px",marginRight:1,transform:"translateY(0.5px)"},menu:{minWidth:200}})),[s]),u=s?(0,j.jsx)(V().sA,{id:"search.sort.sortMenuTitle",defaultMessage:"Sort By"}):void 0;return(0,j.jsx)(r(500861).A,{ref:e=>{e&&(t.current=e)},alignmentToOrigin:dt().C.Start,selectedTitle:(0,j.jsx)("div",{style:c.selectedTitle,children:l.formattedName}),label:void 0,renderMenuSections:()=>[{key:"searchSortOrder",render:e=>(0,j.jsx)(re().A,{...e,title:u,desktopStyle:c.menu,disableDesktopPadding:!1}),items:d}],labelStyle:c.label,innerButtonStyle:c.innerButton})};const ut=[{key:"relevance.",formattedName:(0,j.jsx)(V().sA,{id:"search.sort.sortOrder.bestMatches",defaultMessage:"Best matches"}),sort:{field:"relevance"}},{key:"lastEdited.desc",formattedName:(0,j.jsx)(V().sA,{id:"search.sort.sortOrder.lastEdited.newestFirst",defaultMessage:"Last edited: Newest first"}),sort:{field:"lastEdited",direction:"desc"}},{key:"lastEdited.asc",formattedName:(0,j.jsx)(V().sA,{id:"search.sort.sortOrder.lastEdited.oldestFirst",defaultMessage:"Last edited: Oldest first"}),sort:{field:"lastEdited",direction:"asc"}},{key:"created.desc",formattedName:(0,j.jsx)(V().sA,{id:"search.sort.sortOrder.created.newestFirst",defaultMessage:"Created: Newest first"}),sort:{field:"created",direction:"desc"}},{key:"created.asc",formattedName:(0,j.jsx)(V().sA,{id:"search.sort.sortOrder.created.oldestFirst",defaultMessage:"Created: Oldest first"}),sort:{field:"created",direction:"asc"}}],pt=function(e){let{isPublicPageSearch:t}=e;const r=(0,o().v3)(),{device:n}=r,a=function(e){return{menuItemMobile:{paddingBottom:0},titleWrapper:{flex:void 0,marginTop:-3,marginBottom:-1},showSidebarButton:()=>{const{device:t}=e;return{padding:"0 4px",fontSize:t.isMobile?ge().J.UISmall.mobile:ge().J.UISmall.desktop,fontWeight:ge().Wy.medium,borderRadius:4,height:20,lineHeight:"20px"}}}}(r),i={...n.isMobile&&a.menuItemMobile},s=t?void 0:(0,j.jsx)(ht,{});return(0,j.jsx)(fe().A,{title:(0,j.jsx)(mt,{}),right:s,textWrapperStyle:a.titleWrapper,style:i})};function mt(){const e=(0,a().K8)((()=>I().Ay.state.query.sort),[]);return(0,j.jsx)(ct,{currentSortBy:e,setSortBy:e=>{I().Ay.setState({...I().Ay.state,query:{...I().Ay.state.query,sort:e}})},sortOptions:ut})}function ht(){const e=(0,o().v3)(),{device:t}=e;return t.isMobile?(0,j.jsx)($e,{mode:Ue.Button}):null}var gt=()=>r(764458),ft=()=>r(186445),yt=()=>r(90612),bt=(r(517642),r(658004),r(733853),r(845876),r(432475),r(515024),r(731698),()=>r(925844)),vt=()=>r(763884),xt=()=>r(756279),kt=()=>r(439264),wt=()=>r(2143),St=()=>r(681873),It=()=>r(179034),Tt=()=>r(854150),Ct=()=>r(798880),Nt=()=>r(245241),Mt=()=>r(695608),_t=()=>r(972435),Bt=()=>r(630116);function At(e){const{filterUIName:t}=e,{parentStore:r}=(0,n.useContext)(B().SearchStoresContext),o=(0,a().K8)((()=>I().Ay.state.query.filters),[]),s=(0,i().IS)((e=>({title:{maxWidth:220,...ge().RC}})),[]),l=(0,a().K8)((()=>{switch(t){case"personFilter":return function(e,t){const r=e.createdBy,n=_t().A.getIntl(),o=d().oE(r.map((e=>{const r=Bt().LU.createChildStore(t,{table:Ct().oo,id:e});return(0,Mt().c6)(n,r.getModel())})));return(0,St().A)(o,Et)}(o,r);case"teamsFilter":case"dev_notInTeamFilter":return function(e,t){const r=(0,Nt().fg)(e.inTeams);if(!r)return[];const n=d().oE(r.map((e=>Bt().h4.createChildStore(t,{table:Tt().yK,id:e}).getName())));return(0,St().A)(n,Et)}(o,r);case"pageFilter":case"dev_notInPageFilter":return Ot(o,r);case"dateFilter":return function(e){const t=_t().A.getIntl(),r=Pt(e);if("createdTime"===r)return y().tX(e.createdTime,t);if("lastEditedTime"===r)return y().tX(e.lastEditedTime,t);return""}(o);case"titleToggle":return[];default:(0,E().HB)(t)}}),[r,t,o]);return(0,j.jsx)("div",{style:s.title,children:(0,j.jsx)(V().sA,{defaultMessage:"{filterName}{colon} {filterOperator} {filterValues}",id:"search.filterBarFilter.title",values:{filterName:jt(t),filterOperator:0===l.length?void 0:Rt(t,o),filterValues:l,colon:0===l.length?void 0:":"}})})}function jt(e){switch(e){case"personFilter":return(0,j.jsx)(V().sA,{id:"search.filterMenu.moreFilters.person",defaultMessage:"Created by"});case"teamsFilter":return(0,j.jsx)(V().sA,{id:"search.filterMenu.moreFilters.inTeams",defaultMessage:"Teamspace"});case"pageFilter":return(0,j.jsx)(V().sA,{id:"search.filterMenu.moreFilters.inPage",defaultMessage:"In"});case"dateFilter":return(0,j.jsx)(V().sA,{id:"search.filterMenu.moreFilters.date",defaultMessage:"Date"});case"titleToggle":return(0,j.jsx)(V().sA,{id:"search.filterMenu.onlyMatchTitlesToggle.label",defaultMessage:"Title only"});case"dev_notInPageFilter":return(0,j.jsx)(V().sA,{id:"[DO NOT TRANSLATE].search.filterMenu.notInPageFilter.label",defaultMessage:"[dev] Not in page"});case"dev_notInTeamFilter":return(0,j.jsx)(V().sA,{id:"[DO NOT TRANSLATE].search.filterMenu.notInTeamFilter.label",defaultMessage:"[dev] Not in teamspace"})}(0,E().HB)(e)}function Pt(e){const t=y().z7.createdTime(e.createdTime),r=y().z7.lastEditedTime(e.lastEditedTime);return t?"createdTime":r?"lastEditedTime":void 0}function Rt(e,t){switch(e){case"personFilter":case"teamsFilter":case"pageFilter":case"dev_notInPageFilter":case"dev_notInTeamFilter":case"dateFilter":case"titleToggle":return}(0,E().HB)(e)}function Et(e){return", "}function Ot(e,t){const r=e.ancestors,n=d().oE(r.map((e=>{const r=Bt().Bv.createChildStore(t,{table:It().ev,id:e});return r.isDefined()?r.getModel().getRenderTitle({getRecordModel:r.getRecordModel,userTimeZone:(0,Ie().P)(),intl:_t().A.getIntl()}):""})));return(0,St().A)(n,Et)}var Ft=()=>r(313948),Lt=(r(944114),r(672577),()=>r(134421)),Dt=()=>r(56394);function qt(e){const t=I().Ay.state.query.sort,r=ut.find((e=>d().n4(e.sort,t)))??ut[0],n="relevance"===r.sort.field?(0,j.jsx)(V().sA,{id:"search.sort.sortOrder.bestMatches.title",defaultMessage:"Sort"}):r.formattedName;return(0,j.jsx)(Dt().A,{disabled:!1,title:n,onClick:e.onClick,icon:(0,Lt().X)({width:16,marginRight:6,fill:"currentColor"})})}function Kt(){const e=I().Ay.state.query.sort,t=ut.findIndex((t=>d().n4(t.sort,e))),r=[];for(const n of ut)r.push({key:n.key,render:e=>(0,j.jsx)(q().A,{...e,title:n.formattedName}),action:()=>{I().Ay.setState({...I().Ay.state,query:{...I().Ay.state.query,sort:n.sort}})}});return(0,j.jsx)(N().A,{menuType:g().gu.Popup,children:(0,j.jsx)(G().Ay,{type:G().Oh.Vertical,initialFocus:t<0?0:t,sections:[{key:"sortOptions",items:r,render:e=>(0,j.jsx)(Z().A,{...e})}]})})}const Ut=function(e){return(0,j.jsx)(Q().Ay,{popupType:Q().z7.Popup,renderOrigin:qt,render:Kt,disabled:!1,placementToOrigin:dt().W.Bottom,alignmentToOrigin:dt().C.Start,onClick:e.onMenuOpen,onClose:e.onMenuDismiss})},Ht="SearchFilterSettings",$t={starting:void 0,ending:void 0};function Vt(e){const{isMobile:t}=e,{parentStore:r}=(0,n.useContext)(B().SearchStoresContext),{handlePopupOpen:s,handlePopupClose:l}=(0,n.useContext)(B().SearchStaticContext),c=(0,o().v3)(),u=(0,a().K8)((()=>c.currentUser.id),[c]),p=(0,a().K8)((()=>I().Ay),[]),m=(0,a().O$)(p),h=m.query.filters,g=(0,a().K8)((()=>S().default.state.isPublicPageSearch),[]),f=(0,a().K8)((()=>(0,be().zI)()>0&&!g),[g]),y=(0,a().K8)((()=>!g),[g]),b=!1,v=(0,i().IS)((e=>({scroller:{display:"flex",alignItems:"center",paddingTop:10,paddingRight:12,paddingBottom:10,paddingLeft:12},barContainer:{display:"flex",alignItems:"center"},scrollerContainer:{position:"relative",flexGrow:0,overflow:"hidden"},draggableList:{display:"flex",flexShrink:0,marginLeft:6},divider:{height:16,width:1,borderRadius:1,backgroundColor:e.stroke.secondary}})),[]),x=(0,n.useCallback)((e=>t=>p.updateFilters({[e]:t})),[p]),k=(0,n.useCallback)((e=>{const{onMenuDismiss:t,onMenuOpen:n}=e;if(y)return(0,j.jsx)(ke().A,{mode:H().C.Pill,focused:!1,title:(0,j.jsx)(At,{filterUIName:"personFilter"}),parentStore:r,userIds:h.createdBy,onMenuDismiss:t,onMenuOpen:n,onChange:x("createdBy")})}),[y,r,h.createdBy,x]),w=(0,n.useCallback)((e=>{const{onMenuDismiss:t,onMenuOpen:n}=e;return f&&(0,j.jsx)(we().S,{mode:H().C.Pill,focused:!1,title:(0,j.jsx)(At,{filterUIName:"teamsFilter"}),parentStore:r,teamIds:h.inTeams,onMenuDismiss:t,onMenuOpen:n,onChange:x("inTeams")})}),[r,h.inTeams,x,f]),T=(0,n.useCallback)((e=>{const{onMenuDismiss:t,onMenuOpen:n}=e;return(0,j.jsx)(xe().E,{mode:H().C.Pill,focused:!1,title:(0,j.jsx)(At,{filterUIName:"pageFilter"}),parentStore:r,blockIds:h.ancestors,onMenuDismiss:t,onMenuOpen:n,onChange:x("ancestors")})}),[r,h.ancestors,x]),C=(0,n.useCallback)((()=>null),[r,h.dev_excludedPages,x,b]),N=(0,n.useCallback)((()=>null),[r,h.dev_excludedTeams,x,b]),M=(0,a().K8)((()=>d().Im(h.createdTime)||d().n4(h.createdTime,$t)?"lastEditedTime":"createdTime"),[h.createdTime]),_=(0,a().K8)((()=>"createdTime"===M?h.createdTime:h.lastEditedTime),[M,h.createdTime,h.lastEditedTime]),A=(0,n.useCallback)((e=>{const{onMenuDismiss:t,onMenuOpen:r}=e,n={mode:H().C.Pill,focused:!1,title:(0,j.jsx)(At,{filterUIName:"dateFilter"}),icon:ye().k,initialValue:_,dateFilterType:M,onMenuDismiss:t,onMenuOpen:r,shouldAlsoUpdateSearchStore:!0};return(0,j.jsx)(Ft().m,{...n})}),[M,_]),P=(0,n.useCallback)((()=>!t&&(0,j.jsx)(U().J,{mode:H().C.Pill,focused:!1,title:(0,j.jsx)(At,{filterUIName:"titleToggle"}),icon:bt().g,value:h.navigableBlockContentOnly||!1,onChange:x("navigableBlockContentOnly")})),[h.navigableBlockContentOnly,x,t]);(0,n.useEffect)((()=>{const e=vt().A.get({userId:u,key:Ht});e&&d().n4(new Set(e.filterOrder),new Set(m.filterBar.order))&&!d().n4(e.filterOrder,m.filterBar.order)&&e.filterOrder&&p.updateFilterOrder(e.filterOrder)}),[m.filterBar.order,u,p]);const R={onMenuOpen:s,onMenuDismiss:l},E={titleToggle:P(),personFilter:k(R),teamsFilter:w(R),pageFilter:T(R),dateFilter:A(R),dev_notInPageFilter:C(),dev_notInTeamFilter:N()};const O=(0,n.useCallback)((e=>{const{onMenuDismiss:t,onMenuOpen:r}=e;return(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,j.jsx)(Ut,{onMenuOpen:r,onMenuDismiss:t}),(0,j.jsx)("div",{style:v.divider})]})}),[v.divider]);return(0,j.jsx)("div",{style:v.barContainer,children:(0,j.jsx)("div",{style:v.scrollerContainer,children:(0,j.jsxs)(wt().H,{type:xt().A.X,style:v.scroller,children:[(0,j.jsx)(j.Fragment,{children:O(R)}),(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(kt().Ay,{direction:"horizontal",keys:m.filterBar.order,disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,renderKey:e=>E[e],style:v.draggableList,onDrop:e=>function(e){const t={filterOrder:e};vt().A.set({userId:u,key:Ht,value:t}),p.updateFilterOrder(e)}(e)})})]})})})}var zt=()=>r(260488),Wt=()=>r(437622),Qt=()=>r(430483),Gt=()=>r(970585),Zt=()=>r(757695),Yt=()=>r(305872),Xt=()=>r(115512),Jt=()=>r(957986),er=()=>r(864943),tr=()=>r(482173);const rr=Zt().default.createClass(!1,{name:"RequestModalOpenStore"}),nr=Zt().default.createClass(!1,{name:"ResponseModalOpenStore"});const or=function(e){let{searchResultStore:t,shouldShow:n,showSpinner:s}=e;const l=(0,i().DP)(),d=(0,o().v3)(),c=(0,a().uB)(void 0,nr),u=(0,a().uB)(void 0,rr);if(!n)return null;const p=ar(d,l),m=(0,j.jsx)("div",{style:p.resultCountWrapper,children:(0,j.jsx)("div",{style:p.navigationHints,children:(0,j.jsx)(r(507552).A,{})})});return(0,j.jsx)(tr().A,{title:m,right:(0,j.jsx)(ir,{searchResultStore:t,requestModalOpenStore:u,responseModalOpenStore:c})})};function ar(e,t){return{footer:()=>{const{device:t}=e;return{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",fontSize:t.isMobile?ge().J.UIRegular.mobile:ge().J.UIRegular.desktop}},footerText:{fontSize:Xt().ny(e,"UISmall"),...ge().RC},inlineHint:{display:"inline",marginRight:16},resultCountWrapper:{display:"flex",alignItems:"center",...ge().RC},resultCount:{fontWeight:ge().Wy.medium},resultText:{verticalAlign:"middle",marginRight:6},spinner:{display:"inline",width:12,height:12,verticalAlign:"middle"},keyboardShortcut:{marginRight:4,marginBottom:1,fontVariant:"all-small-caps",fontSize:1.1*Xt().ny(e,"UISmall")},commandGlyph:{fontSize:.75*Xt().ny(e,"UIRegular")},footerDebugButton:(0,tr().q)(t),debugModalStyle:{maxHeight:"90vh",maxWidth:"90vw",height:"90vh",width:"90vw",overflow:"scroll",padding:10},navigationHints:{marginLeft:15}}}function ir(e){var t;let{searchResultStore:r,requestModalOpenStore:n,responseModalOpenStore:s}=e;const l=(0,i().DP)(),d=(0,o().v3)(),{debug:c,showDebugInfo:u}=(0,a().K8)((()=>{const{debug:e,showDebugInfo:t}=D().Ay.state;return{debug:e,showDebugInfo:t}}),[]),p=(0,a().K8)((()=>r.state.serverResults),[r]),m=(0,a().O$)(n),h=(0,a().O$)(s);if(!c&&!u)return null;const{rawRequests:g,rawResponses:f}=(null==p||null===(t=p.debugInfo)||void 0===t?void 0:t.response)||{};return(0,j.jsxs)(j.Fragment,{children:[g&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(Jt().A,{open:m,innerStyle:ar(d,l).debugModalStyle,onDismiss:()=>{n.setState(!1)},render:()=>(0,j.jsx)(Yt().H,{showCopyButton:"large",defaultCollapsed:!1,data:g})}),(0,j.jsx)(er().A,{size:"lg",style:ar(d,l).footerDebugButton,onClick:()=>n.setState(!0),children:"Open Request"})]}),f&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(Jt().A,{open:h,innerStyle:ar(d,l).debugModalStyle,onDismiss:()=>{s.setState(!1)},render:()=>(0,j.jsx)(Yt().H,{showCopyButton:"large",data:{rawResponses:f},defaultCollapsed:!1})}),(0,j.jsx)(er().A,{size:"lg",style:ar(d,l).footerDebugButton,onClick:()=>s.setState(!0),children:"Open Response"})]})]})}var sr=r(440961),lr=()=>r(989423),dr=()=>r(496067),cr=()=>r(718807),ur=()=>r(710149),pr=()=>r(64e3),mr=()=>r(187485);const hr=function(e){const{style:t,captionStyle:r,title:n,caption:a}=e,i=(0,o().v3)(),s=yr(i),l={...s.menuItem,...t},d={...s.caption,...r};return(0,j.jsx)(fe().A,{...e,title:(0,j.jsx)(br,{title:n}),caption:(0,j.jsx)(fr,{caption:a,captionStyle:d}),textWrapperStyle:yr(i).text,style:l,captionStyle:d})};function gr(e){return{title:{color:e.mediumTextColor},caption:{color:e.lightTextColor}}}function fr(e){let{captionStyle:t,caption:r}=e;const n=(0,i().DP)();if(!r)return null;const o={...t,...gr(n).caption};return(0,j.jsx)("div",{style:o,children:r})}function yr(e){return{menuItem:{minHeight:void 0,...e.device.isMobile&&{background:void 0,boxShadow:void 0},paddingTop:32,paddingBottom:32},text:{textAlign:"center"},title:{margin:0,fontWeight:ge().Wy.medium,fontSize:Xt().ny(e,"UIRegular"),lineHeight:Xt().ks(e,"UIRegular")},caption:{fontSize:Xt().ny(e,"UIRegular")}}}function br(e){let{title:t}=e;const r=(0,i().DP)(),n=(0,o().v3)();if(!t)return null;const a=yr(n),s=gr(r),l={...a.title,...s.title};return(0,j.jsx)("div",{role:"alert",style:l,children:t})}const vr=(0,j.jsx)(V().sA,{defaultMessage:"No results",id:"searchErrorMenuItem.error.noResults"});const xr=function(e){const t=(0,i().IS)((e=>({menuItem:{marginTop:"auto",marginBottom:"auto"},caption:{marginTop:"auto"},reportProblemButton:{display:"inline",color:e.blueColor},searchDeletedButton:{display:"inline",lineHeight:"25px",color:e.blueColor}})),[]),s=(0,o().v3)(),{isQuickSearch:l}=(0,n.useContext)(B().SearchStaticContext),d=(0,a().K8)((()=>(0,r(836251).w6)(s)),[s]),c=()=>{r(994877).SI({environment:s,from:"quick_find"})};function u(r,n){const o=function(r,n){if(r||n)return;const o=y().J3(p);if(!y().z7.isDeletedOnly(p.isDeletedOnly))return(0,j.jsx)(V().sA,{id:"searchErrorMenuItem.errorPrompt.searchDeleted",defaultMessage:"Some results may be in your deleted pages.{br}<searchdeleted>Search deleted pages</searchdeleted>",values:{searchdeleted:r=>(0,j.jsx)(mr().A,{onClick:e.handleSearchDeletedOnly,style:t.searchDeletedButton,children:r}),br:(0,j.jsx)("br",{})}});return o?(0,j.jsx)(V().sA,{defaultMessage:"Try different search terms or filters",id:"searchErrorMenuItem.errorPrompt.searchTermsAndFilters"}):(0,j.jsx)(V().sA,{defaultMessage:"Try different search terms",id:"searchErrorMenuItem.errorPrompt.searchTerms"})}(r,n);return{title:vr,caption:o}}const p=(0,a().K8)((()=>I().Ay.state.query.filters),[]);return(0,j.jsx)(hr,{...function(r,n){const o=e.error;switch(o.type){case Nt().yq.NoResults.type:return u(r,n);case Nt().yq.Offline.type:return function(){const e=(0,j.jsx)(V().sA,{defaultMessage:"Go online for more results.",id:"searchErrorMenuItem.errorPrompt.goOnline"});return{title:vr,caption:e}}();case Nt().yq.RequestFailed.type:return{title:(0,j.jsx)(V().sA,{id:"searchErrorMenuItem.error.genericErrorMessage",defaultMessage:"Something went wrong"}),caption:(0,j.jsx)(V().sA,{id:"searchErrorMenuItem.errorPrompt.refreshOrReport",defaultMessage:"Try refreshing or <reportlink>report a problem</reportlink>.",values:{reportlink:e=>(0,j.jsx)(mr().A,{onClick:c,style:t.reportProblemButton,children:e})}})};default:(0,E().HB)(o)}}(l??!1,d),style:t.menuItem,captionStyle:t.caption,shouldWrapCaption:!0})};var kr=()=>r(913441);const wr=n.memo((function(e){var t,s,l,c,u;const[p,h]=(0,n.useState)(!1),{searchResultStore:g,localResults:f,serverResults:b,resultListStore:v,searchExperimentOverrides:x,assistantResultItem:k,extraTopPadding:w,comboboxProps:T}=e,C=(0,o().Y0)().isMobile,N=(0,i().IS)((e=>({results:{paddingTop:w?8:4,flex:1,display:"flex",flexDirection:"column",overflow:"auto",height:"100%",paddingLeft:4,paddingRight:4},messageMenuItem:{...C&&{background:void 0,boxShadow:void 0}},debugMessageMenuItemTextStyle:{whiteSpace:"pre-wrap",fontFamily:"monospace",marginTop:0},menuListContainer:{display:"flex",flexDirection:"column",marginTop:C?13:void 0,marginBottom:4},section:{marginBottom:4}})),[C,w]),M=(0,o().v3)(),_=e.errorState,A=(0,a().K8)((()=>g.state.queryBasedActionResults??[]),[g]),{isNewElectronTab:P,searchSessionId:R}=(0,a().K8)((()=>({isNewElectronTab:Boolean(S().default.state.isNewElectronTab),searchSessionId:S().default.state.sessionId})),[]),O=(0,a().K8)((()=>{const{tabs:e}=r(982254).A.state;return e}),[]),L=(0,a().K8)((()=>(0,r(620333).mk)({searchSessionId:S().default.state.sessionId,searchSessionFlowNumber:r(498719).default.state.numServerRequests})),[]),q=(0,a().K8)((()=>0===A.length?[]:A.map((e=>(0,r(896278).g)({environment:M,result:e,queryId:L,desktopProps:{electronTabs:O,isNewElectronTabSearch:P},action:t=>{"full_search"!==e.eventName&&zt().st({environment:M,reset:!0,searchResultStore:g}),(0,lr().u4)({environment:M,event:{eventName:"search_action_result_click",eventProperties:{type:e.eventName,search_session_id:R}}})}})))),[A,M,L,O,P,g,R]),K=(0,a().K8)((()=>Qt().zD.isDeepFindEnabled()),[]),U=(0,a().K8)((()=>{if(!k)return;const e=function(e){const{item:t,key:n}=e;return{key:"SearchResults.SearchAssistantMenuItem"+(n?`.${n}`:""),action:e=>t.action(e),render:e=>(0,j.jsx)(r(379819).A,{...e,...t,title:t.renderTitle()})}}({item:k,key:"FixedActionResults.0"});return{key:"search-results-actions-section",render:e=>(0,j.jsx)(Z().A,{...e,shouldShowBottomDivider:!1,disableMobilePadding:!0,disableMobileBorders:!0,title:K?void 0:(0,j.jsx)(V().sA,{id:"search.searchActions.actions.text",defaultMessage:"Actions"}),titleClassName:m().J5z,style:N.section}),items:[e]}}),[k,K,N.section]),H=((null==U?void 0:U.items.length)??0)+A.length,$=(0,F().Y)(),z=(0,n.useMemo)((()=>(0,y().HA)({intentBasedGrouping:$,localResults:f,serverResults:b})),[$,f,b]),W=(0,n.useCallback)((t=>{const{results:r,sectionTitle:o,compact:a,additionalResults:i}=t,{id:s,title:l}=function(e){if(!e)return{id:"allSearchResults",title:void 0};switch(e.type){case"unique-id":return{id:"uniqueIdSearchResults",title:(0,j.jsx)(V().sA,{id:"search.searchResultBuckets.uniqueID.text",defaultMessage:"ID matches"})};case"jump-back-in":return{id:"jumpBackInSearchResults",title:(0,j.jsx)(V().sA,{id:"search.searchResultBuckets.topResults.text",defaultMessage:"Top results"})};case"server":return{id:"serverOnlySearchResults",title:(0,j.jsx)(V().sA,{id:"search.searchResultBuckets.server.text",defaultMessage:"{count}{maybeLowerBoundSign} results",values:{count:e.values.count,maybeLowerBoundSign:e.values.isLowerBound?"+":""}})};case"main":return{id:"mainSearchResults",title:(0,j.jsx)(V().sA,{id:"search.searchResultBuckets.bestMatches.text",defaultMessage:"Best matches"})};default:(0,E().HB)(e)}}(o);return r.length+((null==i?void 0:i.length)??0)>0?{key:s,render:e=>(0,j.jsx)(Z().A,{...e,shouldShowBottomDivider:!1,disableMobilePadding:!0,disableMobileBorders:!0,title:l,titleClassName:m().J5z,style:N.section}),items:d().oE([...i??[],...r.map(((t,r)=>function(e){var t;const{selectedResult:r,index:o,props:a,compact:i}=e,{store:s}=r,l=s.isNavigableBlock()?s:s.getNavigableBlockStore();if(!l)return;const d=n.createRef(),c=Boolean(D().Ay.getDebugLevel()),u=c&&r.sources.includes(Nt().Ni.Local)?{id:r.id,localSource:r.localSource,score:r.score,localRelevancies:r.localRelevancies,frecencyScore:r.frecencyScore,personalizationBoost:r.personalizationBoost,terms:r.terms}:void 0,p=c&&(r.sources.includes(Nt().Ni.ElasticSearch)||r.sources.includes(Nt().Ni.VectorDBBlock)||r.sources.includes(Nt().Ni.VectorDBCollection))?null===(t=a.debugInfo)||void 0===t||null===(t=t.response)||void 0===t?void 0:t.resultsDebugMap[s.id]:void 0,h=a.clusterInfo;return{key:`${s.id}:${o}`,action:e=>{const{event:t}=e;function n(e){const r=sr.findDOMNode(e.current);return Boolean(r&&"target"in t&&t.target&&(r===t.target||r.contains(t.target)))}d.current&&n(d)||a.handleSelectResult({event:e.event,index:{local:e.indexLocal,global:e.index},selectedResult:r,fromSidePeekPanel:!1,context:"query_results"})},render:e=>{var t;return(0,j.jsx)(kr().GC,{...e,index:o,originalPosition:r.originalPosition,isFirstInSection:0===o,store:l,hidePath:!1,result:r,className:m().LF7,debugLocal:u,debugHits:p,debugAreaRef:d,clusterInfo:h,inline:i&&!c,inlineCaptionMinWidthPercentage:20,queryId:null===(t=r.serverEventProperties)||void 0===t?void 0:t["server-queryId"],type:"query_results"})}}}({selectedResult:t,index:r,props:e,compact:a})))])}:void 0}),[e,N.section]),Q=(0,a().K8)((()=>W({results:"intent-based-grouping"===z.type?z.sections.jumpBackInSearchResults:[],additionalResults:void 0,sectionTitle:{type:"jump-back-in"},compact:!0})),[W,z.sections,z.type]),Y=(0,a().K8)((()=>{const e="intent-based-grouping"===z.type?z.sections.serverOnlySearchResults:[],{count:t,isLowerBound:r}=g.getResultCount();return W({results:e,additionalResults:void 0,sectionTitle:{type:"server",values:{count:t,isLowerBound:r}},compact:!1})}),[W,z.sections,z.type,g]),X=[U,Q,(0,a().K8)((()=>W({results:"uniqueIdSearchResults"in z.sections?z.sections.uniqueIdSearchResults:[],additionalResults:void 0,sectionTitle:{type:"unique-id"},compact:!1})),[W,z.sections]),Y,(0,a().K8)((()=>W({results:"unique-id"===z.type?z.sections.nonUniqueIdSearchResults:"all"===z.type?z.sections.allSearchResults:[],additionalResults:q,sectionTitle:"unique-id"===z.type||H>0?{type:"main"}:void 0,compact:!1})),[W,z.type,z.sections,q,H])].filter(E().O9),J=null===(t=e.debugInfo)||void 0===t||null===(t=t.response)||void 0===t?void 0:t.parsedQueries,ee=null===(s=e.debugInfo)||void 0===s||null===(s=s.response)||void 0===s?void 0:s.detectedLanguages,te=null===(l=e.debugInfo)||void 0===l?void 0:l.traceLogs,re=null===(c=e.debugInfo)||void 0===c||null===(c=c.response)||void 0===c?void 0:c.debugUrls,{onMaybeLoadMoreResults:ne}=e,oe=(0,n.useCallback)(((e,t)=>{const r=e<=200;r&&!p&&ne(),h(r),t.offsetFromTop&&I().Ay.update((e=>({...e,hasScrolled:!0})))}),[p,ne]),ae=0===((null==f?void 0:f.length)??0)&&0===q.length&&"serverError"in _&&"NoResultsFound"===(null===(u=_.serverError)||void 0===u?void 0:u.type)?0:(null==U?void 0:U.items.length)??0,ie=(0,a().K8)((()=>Qt().zD.showSearchAiFeatures()),[]),se=(0,a().K8)((()=>g.state.serverResultsLoading),[g]),le=(0,a().K8)((()=>{if(void 0!==b&&b.length>0)return 0;const e="serverError"in _&&void 0!==_.serverError;return(se||void 0===b&&"nav-local-only"!==S().default.state.searchMode)&&!e?Sr-((null==f?void 0:f.length)??0)-q.length:0}),[b,null==f?void 0:f.length,q.length,_,se]);return(0,j.jsx)(B().SearchStaticContext.Consumer,{children:e=>{let{queryResultsSectionRef:t}=e;return(0,j.jsxs)("section",{style:N.results,ref:t,children:[!d().Im(x)&&Nr((0,j.jsx)(Yt().H,{data:{searchExperimentOverrides:x},showCopyButton:!1,showModalButton:!1,defaultCollapsed:!1}),N.debugMessageMenuItemTextStyle),J&&(0,j.jsxs)(j.Fragment,{children:[Nr((0,j.jsx)(j.Fragment,{children:"NOTE: reranking is disabled when profile_query is turned on, due to TASK-189077."}),N.debugMessageMenuItemTextStyle),Nr((0,j.jsx)(Yt().H,{data:{parsedQueries:J},customCollapsedRenderers:[jr],showCopyButton:"small",showModalButton:!0,defaultCollapsed:!0}),N.debugMessageMenuItemTextStyle)]}),ee&&Nr((0,j.jsx)(Yt().H,{data:{detectedLanguages:ee},customCollapsedRenderers:[Br]}),N.debugMessageMenuItemTextStyle),te&&Nr((0,j.jsx)(Yt().H,{data:{tracer:{traceLogs:te}},customCollapsedRenderers:[_r],defaultCollapsed:!0}),N.debugMessageMenuItemTextStyle),re&&Nr((0,j.jsx)(Yt().H,{data:{debugUrls:re},defaultCollapsed:!0,customCollapsedRenderers:[Rr],showCopyButton:"small",showModalButton:!0,maxLinkValueLength:40}),N.debugMessageMenuItemTextStyle),X&&(0,j.jsx)("div",{className:"search-results-list",children:(0,j.jsx)(G().Ay,{type:G().Oh.Vertical,initialFocus:ae,store:v,disableKeyboardArrowWrap:!0,sections:X,style:N.menuListContainer,comboboxProps:T})}),Cr(M,_,N.messageMenuItem)||(0,j.jsx)(r(228927).A,{onChange:oe}),le>0&&(0,j.jsx)(Tr,{numberOfShimmerResults:le,assistantActionsEnabled:ie})]})}})})),Sr=8;function Ir(e){const{numberOfShimmerResults:t,assistantActionsEnabled:r}=e,n=t===Sr&&r,o=(0,i().IS)((e=>({container:{margin:(n?"0px":"8px")+" 10px 6px 10px",display:"flex",flexDirection:"column",gap:10},icon:{width:20,height:20,borderRadius:5,marginLeft:6},titleAndPath:{width:"100%",display:"flex",flexDirection:"column",gap:5},title:{height:18,borderRadius:5},path:{height:12,borderRadius:5},resultContainer:{display:"flex",gap:10,boxShadow:`0 1px 0 ${e.lightDividerColor}`,paddingBottom:10},sectionHeader:{marginBottom:7,marginTop:8},section:{marginBottom:4}})),[n]),a=Array.from({length:t},(()=>!0));return(0,j.jsxs)("div",{children:[n&&(0,j.jsx)(Z().A,{desktopTitleStyle:o.sectionHeader,title:(0,j.jsx)(V().sA,{id:"search.searchResultsShimmer.bestMatches.text",defaultMessage:"Best matches"}),style:o.section}),(0,j.jsx)("div",{style:o.container,children:a.map(((e,t)=>(0,j.jsxs)("div",{style:{...o.resultContainer,...t===a.length-1&&{boxShadow:"none"}},children:[(0,j.jsx)(ur().A,{style:o.icon}),(0,j.jsxs)("div",{style:o.titleAndPath,children:[(0,j.jsx)(ur().A,{style:{...o.title,width:d().XM(["30%","45%","55%","60%","70%","75%","80%","90%"])}}),(0,j.jsx)(ur().A,{style:{...o.path,width:d().XM(["10%","15%","20%","25%","30%","35%","55%","70%"])}})]})]},`shimmer-item-${t}`)))})]})}const Tr=n.memo(Ir);function Cr(e,t,r){if(!t.isLoading)return t.showMajorError?(0,j.jsx)(xr,{error:t.serverError,handleSearchDeletedOnly:()=>{const t=I().Ay.state.query.text;zt().st({environment:e,reset:!1}),dr().A.setState({...dr().A.state,open:!0}),cr().Ay.setState({...cr().Ay.state,currentTab:"all_pages",filter:t,limit:cr().Ay.startLimit})}}):t.serverError&&t.serverError!==Nt().yq.NoResults?function(e,t){return(0,j.jsx)(Z().A,{disableMobilePadding:!0,disableMobileBorders:!0,children:(0,j.jsx)(pr().A,{title:e,style:t})})}(t.serverError.message,r):void 0}function Nr(e,t){return(0,j.jsx)(Z().A,{disableMobilePadding:!0,disableMobileBorders:!0,topBorder:!1,style:{marginTop:0,paddingTop:0},children:(0,j.jsx)(fe().A,{body:e,bodyStyle:t})})}function Mr(e){const t=e.replaceAll(/\(MatchNoDocsQuery\("Matching no documents because no terms present"\)\)\^[0-9\.]/g,"").replaceAll(/MatchNoDocsQuery\("Matching no documents because no terms present"\)/g,"").replaceAll(/ConstantScore\(([^)]+):([^)]+)\)/g,"<i>$1</i>:<b>$2</b>").replace(/function score \(\((.*)\), functions:.*\)/,"$1").replaceAll("( ","(").replaceAll(" )",")").replaceAll("|","| <br/>").replaceAll(/([^( ]+):"([^"]+)"/g,'<i>$1</i>:<b>"$2"</b>').replaceAll(/([^( ]+):([^) ]+)/g,"<i>$1</i>:<b>$2</b>");return(0,j.jsx)("span",{dangerouslySetInnerHTML:{__html:t}})}function _r(e){let{data:t,keyPath:r}=e;if("traceLogs"===(null==r?void 0:r[0])&&d().Qd(t)&&Array.isArray(t.log)&&t.log.length>0){const{log:e,startTimeMs:r}=t;return{element:(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("div",{children:(0,j.jsx)("b",{children:`Trace started at ${r}`})}),e.map(((e,t)=>(0,j.jsxs)("div",{children:[(0,j.jsx)("span",{style:Pr,children:`[${e.timestamp-r}ms][${e.callerFileName.split(".")[0]}]`}),(0,j.jsx)("span",{children:`${e.msg}`})]},t)))]}),expanded:!1}}return null}function Br(e){let{data:t,keyPath:r}=e;return"detectedLanguages"===r.join(".")&&d().Qd(t)?{element:(0,j.jsx)(j.Fragment,{children:Object.entries(t).filter((e=>{let[t,r]=e;return Boolean(r)})).map((e=>{let[t]=e;return t})).join(", ")||"None"}),expanded:!1}:null}const Ar=["type","description","time_in_nanos"];function jr(e){var t,r;let{data:n,keyPath:o}=e;const a=n,i=Object.values(a).find((e=>void 0!==e));if(!i)return null;if(!Ar.every((e=>i[e])))return null;if(1===o.length)return{element:Mr(i.description),expanded:!1};let s=i.description??"";return null!==(t=s)&&void 0!==t&&t.includes("permissions.teamIds")&&(s="PermissionsQuery"),null!==(r=s)&&void 0!==r&&r.includes("(_id:[")&&(s="BoostRecentPageIds"),{element:Mr(s),expanded:!1}}const Pr={color:"blue"};function Rr(e){let{data:t}=e;const r=t;if(!r)return null;const n=Object.values(r).find((e=>{let{clusterName:t}=e;return void 0!==t}));if(n){const{clusterName:e}=n;return{element:(0,j.jsx)(j.Fragment,{children:e}),expanded:!1}}return{element:(0,j.jsx)(j.Fragment,{children:"unknown"}),expanded:!1}}var Er=()=>r(764880),Or=()=>r(657222),Fr=()=>r(654601),Lr=()=>r(646736),Dr=()=>r(285790),qr=()=>r(35392),Kr=()=>r(859428),Ur=()=>r(659467),Hr=(r(803949),r(737550),()=>r(919709)),$r=()=>r(449506),Vr=()=>r(901389),zr=()=>r(436572),Wr=()=>r(666429);const Qr=(0,V().YK)({additionalInformationPlaceholder:{id:"SearchBadResultsForm.additionalInformation.placeholder",defaultMessage:"What went wrong with this search? Please be as specific as possible."},submitFailed:{id:"SearchBadResultsForm.submitFailed",defaultMessage:"Failed to submit report"},submitSuccess:{id:"SearchBadResultsForm.submitSuccess",defaultMessage:"Your report has been submitted, thanks!"},title:{id:"SearchBadResultsForm.title",defaultMessage:"Give search feedback"},warning:{id:"SearchBadResultsForm.warning",defaultMessage:"The pages from the search results, the search query, and the feedback will be sent to Notion for quality improvement."},cancel:{id:"SearchBadResultsForm.cancel",defaultMessage:"Cancel"},submit:{id:"SearchBadResultsForm.submit",defaultMessage:"Submit"},urlPlaceholder:{id:"SearchBadResultsForm.url.placeholder",defaultMessage:"Link to page you were looking for..."},additionalInformationWarning:{id:"SearchBadResultsForm.additionalInformation.warning",defaultMessage:"The details you provided are too similar to your search keywords. To help us understand the issue, please describe what went wrong."},checkboxLabel:{id:"SearchBadResultsForm.followUpCheckbox",defaultMessage:"Allow Notion to contact me by email to follow up regarding this search"}});function Gr(e){(0,lr().u4)({environment:e,event:{eventName:"report_bad_search_abandon",eventProperties:{}}}),Ur().A.reset()}const Zr=function(e){const{isMobile:t}=(0,o().Y0)(),s=(0,o().v3)();(0,r(852507).l)((()=>{(0,lr().u4)({environment:s,event:{eventName:"report_bad_search_modal_open",eventProperties:{}}})}));const l=(0,i().IS)((e=>({wrap:{display:"flex",flexDirection:"column",width:t?"min(100%, 600px)":void 0,minHeight:128,maxHeight:t?void 0:"max(calc(100vh - 78px), 300px)"},modalWrap:{width:"32rem",padding:24,fontSize:14,maxWidth:"100%"},modalTitle:{fontSize:16,fontWeight:ge().Wy.medium},modalWarning:{fontSize:13,color:e.lightTextColor},titleContainer:{marginBottom:12},buttonArea:{display:"flex",justifyContent:"flex-end",marginTop:18,gap:6},feedbackArea:{marginTop:17,padding:8},warningMessage:{color:e.text.uiRedPrimary,marginTop:10},checkboxArea:{marginTop:12,display:"flex",gap:6,alignItems:"center"}})),[t]),[d]=(0,n.useState)(I().Ay),c=(0,a().K8)((()=>Ne().default.state.currentSpaceStore),[]),[u,p]=(0,a().$y)(Ur().A),[m,h]=(0,n.useState)(""),[g,f]=(0,n.useState)(!1),[b,v]=(0,n.useState)(true),x=(0,n.useCallback)((()=>{(0,lr().u4)({environment:s,event:{eventName:"report_bad_search_submit",eventProperties:{}}}),b&&(0,lr().u4)({environment:s,event:{eventName:"report_bad_search_allow_follow_up",eventProperties:{}}}),function(e){return e.source===Nt().m2.searchModal}(e)&&function(e){var t,r,n,o,a;let{serverResults:i,localResults:s,exposedSearchExperiments:l,debugInfo:d,source:c,environment:u,allowFollowUp:p,searchStoreState:m,currentSpaceStore:h}=e;const g=Ur().A.getState(),f=y().fz(i),b=y().fz(s),v=void 0,x={query:m.query,limit:m.limit,debug:v},{publicAccessPermissionAncestorBlockId:k}=y().Er(u),w=y().eV({environment:u,input:x,spaceId:null==h?void 0:h.id,publicAccessPermissionAncestorBlockId:k,source:"report_bad_search"});if(!w)return;const S=null===(t=document.getElementsByClassName("notion-overlay-container notion-default-overlay-container")[0])||void 0===t?void 0:t.outerHTML,I=document.getElementsByClassName("notion-app-inner notion-dark-theme")[0],T=null==I?void 0:I.style.cssText,C=document.createElement("div");C.innerHTML=S,C.style.cssText=T,null===(r=C.querySelector("[data-search-suggested-text]"))||void 0===r||r.remove(),null===(n=C.querySelector("[data-search-snapshot-delete-nearest-overlay]"))||void 0===n||null===(n=n.closest("[data-overlay]"))||void 0===n||n.remove(),function(e,t){const r=document.createElement("span");r.innerHTML="💻";const n=document.createElement("span");n.innerHTML="⬇️🌐";e.querySelectorAll(".notranslate.search-query-result-item").forEach(((e,o)=>{var a;const i=null===(a=e.firstElementChild)||void 0===a||null===(a=a.children[1])||void 0===a||null===(a=a.firstElementChild)||void 0===a?void 0:a.firstElementChild;o<t?null==i||i.appendChild(r.cloneNode(!0)):null==i||i.appendChild(n.cloneNode(!0))}))}(C,b.length);const N=f.some((e=>e.sources.includes(Nt().Ni.VectorDBBlock)||e.sources.includes(Nt().Ni.VectorDBCollection)));N&&f.splice(0,-20);const M=l??{},_={queryText:m.query.text.trim(),apiRequest:w,serverResults:JSON.stringify(f,null,2),localResults:JSON.stringify(b,((e,t)=>t instanceof Set?Array.from(t):t),2),additionalInformation:g.additionalInformation,desiredUrl:g.desiredUrl,renderedHtml:(0,Hr().xV3)(C.outerHTML),experiments:JSON.stringify(M,null,2),isVectorSearchEnabled:N,traceLogs:null==d||null===(o=d.traceLogs)||void 0===o?void 0:o.log,userId:u.currentUser.id??"",platform:u.device.platform,workSpaceSize:(null===(a=(0,Wt().Mz)(null==h?void 0:h.getPublicSpaceData()))||void 0===a?void 0:a.toString())??"",planType:(null==h?void 0:h.getPlanType())??"",allowFollowUp:p,source:c};$r().callApi({eventName:"reportBadSearch",environment:u,data:_}).then((e=>{"failed"===e.type?Vr().f1((0,j.jsx)("h1",{children:_t().A.formatMessage(Qr.submitFailed)})):zr().D6({label:_t().A.formatMessage(Qr.submitSuccess),durationMs:Wr().LX})})),Ur().A.reset()}({...e,searchStoreState:d.state,currentSpaceStore:c,environment:s,allowFollowUp:b})}),[s,c,b,e,d]),k=e=>{const t=e.target.value;p({...u,additionalInformation:t}),t.trim()===d.state.query.text.trim()?(h(_t().A.formatMessage(Qr.additionalInformationWarning)),f(!0)):(h(""),f(!1))},w=()=>{v(!b)};return(0,j.jsx)(r(641514).A,{onDismiss:()=>Gr(s),render:()=>(0,j.jsx)(T().A,{allowMobileAutoScroll:!0,capture:!0,allowUndo:!0,allowEsc:!0,allowTabUntab:!1,render:e=>(0,j.jsx)("div",{style:l.wrap,"data-search-snapshot-delete-nearest-overlay":!0,children:(0,j.jsxs)("div",{style:l.modalWrap,...e,children:[(0,j.jsxs)("div",{style:l.titleContainer,children:[(0,j.jsx)("div",{style:l.modalTitle,children:_t().A.formatMessage(Qr.title)}),(0,j.jsx)("div",{style:l.modalWarning,children:_t().A.formatMessage(Qr.warning)})]}),(0,j.jsx)(oe().A,{placeholder:_t().A.formatMessage(Qr.additionalInformationPlaceholder),value:u.additionalInformation,onChange:k,focusInitial:!0,inputStyle:{padding:8},style:l.feedbackArea,textarea:!0}),m&&(0,j.jsx)("div",{style:l.warningMessage,children:m}),(0,j.jsx)(oe().A,{placeholder:_t().A.formatMessage(Qr.urlPlaceholder),value:u.desiredUrl,onChange:e=>{p({...u,desiredUrl:e.target.value})},style:l.feedbackArea}),(0,j.jsxs)("div",{style:l.checkboxArea,children:[(0,j.jsx)(K().A,{checked:b,onClick:w,size:12}),(0,j.jsx)("div",{onClick:w,children:(0,j.jsx)(r(125565).A,{style:{cursor:"pointer"},isSmall:!0,children:_t().A.formatMessage(Qr.checkboxLabel)})})]}),(0,j.jsxs)("div",{style:l.buttonArea,children:[(0,j.jsx)(er().A,{size:"lg",onClick:()=>Gr(s),children:_t().A.formatMessage(Qr.cancel)}),(0,j.jsx)(r(204063).A,{size:"lg",onClick:x,disabled:g,children:_t().A.formatMessage(Qr.submit)})]})]})})}),isOpen:u.open})};function Yr(e){const[t,r]=(0,a().$y)(Ur().A),n=(0,V().tz)().formatMessage({defaultMessage:"Give search feedback",id:"search.header.badSearch.button.label"}),o=(0,a().K8)((()=>t.open),[t.open]),s=(0,i().IS)((t=>({button:{...e.buttonStyles,display:"inline-block",fontSize:12,color:t.lightTextColor,paddingRight:4,paddingLeft:4,cursor:"pointer",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",userSelect:"none",height:"inherit",alignContent:"center"}})),[e.buttonStyles]);return(0,j.jsx)(Kr().A,{renderTooltip:e=>(0,j.jsx)("span",{...e,children:n}),disableTooltip:o,placement:dt().W.Top,render:o=>(0,j.jsxs)(er().A,{...o,size:"lg",style:s.button,onClick:()=>{r({...t,open:!0})},children:[n,t.open&&(0,j.jsx)(Zr,{...e})]})})}function Xr(e){const{itemName:t,itemValue:r,associatedUser:n}=e,o=(0,i().IS)((e=>({itemName:{fontSize:12,color:e.lightTextColor},itemValue:{fontSize:12,...n&&{display:"grid",gridTemplateColumns:"1fr auto auto",gap:5,textAlign:"right"}},itemContainer:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",gap:12},metadataActorName:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}})),[n]),a=n;return(0,j.jsxs)("div",{style:o.itemContainer,children:[(0,j.jsx)("div",{style:o.itemName,children:t}),(0,j.jsxs)("div",{style:o.itemValue,children:[a&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(Kr().A,{delayThreshold:50,placement:dt().W.Top,allowHover:!0,renderTooltip:()=>(0,j.jsxs)("div",{style:{display:"flex",gap:5},children:[a.avatar,a.name]}),closeDelay:0,render:e=>(0,j.jsx)("span",{...e,style:o.metadataActorName,children:a.name})}),(0,j.jsx)("span",{children:"·"})]}),(0,j.jsx)("span",{children:r})]})]})}const Jr={createdBy:(0,j.jsx)(V().sA,{id:"search.preview.metadata.createdBy",defaultMessage:"Created by"}),created:(0,j.jsx)(V().sA,{id:"search.preview.metadata.created",defaultMessage:"Created"}),lastEditedBy:(0,j.jsx)(V().sA,{id:"search.preview.metadata.lastEditedBy",defaultMessage:"Last edited by"}),lastEdited:(0,j.jsx)(V().sA,{id:"search.preview.metadata.lastEdited",defaultMessage:"Edited"})},en={type:"page_content"},tn=n.memo((function(e){const{selectedResult:t}=e,s=(0,V().tz)(),l=(0,o().v3)(),{searchResultStore:d}=(0,n.useContext)(B().SearchStaticContext),c="page_result"===t.type,u=(0,i().IS)((e=>({sidePeekPanel:{width:250,overflowY:"auto",overflowX:"hidden",position:"relative",minHeight:400,borderLeft:`1px solid ${e.lightDividerColor}`,display:"flex",flexDirection:"column",justifyContent:"space-between",zIndex:1,padding:16},emoji:{width:20},centerPaneContent:{display:"flex",flexGrow:1,alignItems:"center",justifyContent:"center"},report:{fontSize:12,display:"flex",justifyContent:"flex-end",gap:10},action:{borderRadius:4,background:"unset",fontSize:12,display:"flex"},metadataActorWrapper:{overflow:"hidden"},doubleChevronIcon:{color:e.accentColors.gray[400],cursor:"pointer",width:"max-content"},debugGearIcon:{color:e.accentColors.gray[400]},hoveredDebugGearIcon:{color:e.accentColors.gray[600]}})),[]),{localResults:p}=(0,a().K8)((()=>{var e;return{localResults:null===(e=d.state.localResults)||void 0===e?void 0:e.results}}),[d]),m=(0,a().K8)((()=>d.state.serverResults),[d]),h=(0,n.useMemo)((()=>null==m?void 0:m.results),[m]),g=(0,n.useMemo)((()=>null==m?void 0:m.debugInfo),[m]),f=(0,n.useMemo)((()=>{var e;return null==m||null===(e=m.serverEventProperties)||void 0===e?void 0:e["server-searchExperiments"]}),[m]),y=(0,R().PF)(O().A);return(0,j.jsxs)("aside",{style:u.sidePeekPanel,children:[(0,j.jsx)("div",{style:c?void 0:u.centerPaneContent,children:(()=>{switch(t.type){case"page_result":return(0,j.jsx)(rn,{selectedResult:t,intl:s,environment:l});case"assistant":return(0,j.jsx)(nn,{query:t.value??""});case"client_action":const e=t.value.caption??t.value.title;return(0,j.jsx)(sn,{title:t.value.title,caption:e,icon:t.value.icon})}})()}),(0,j.jsxs)("div",{style:u.report,children:[(0,j.jsx)(Yr,{exposedSearchExperiments:f,localResults:p,serverResults:h,debugInfo:g,source:Nt().m2.searchModal}),y&&(0,j.jsx)(Dr().A,{ariaLabel:s.formatMessage({id:"search.preview.debugGearIcon.ariaLabel",defaultMessage:"Show debug sidebar"}),onClick:()=>I().Ay.setState({...I().Ay.state,isDebugSidebarOpen:!0}),style:u.debugGearIcon,hoveredStyle:u.hoveredDebugGearIcon,icon:e=>(0,r(846899).B)({width:12,height:12})})]})]})}));function rn(e){const{environment:t,intl:o,selectedResult:l}=e,{handleSelectSearchResult:d,handleCopySearchItemLink:p}=(0,n.useContext)(B().SearchStaticContext),m=(0,a().K8)((()=>l.value.selectedResult.store),[l.value.selectedResult.store]),{previewIcon:g,isEmptyPage:f}=(0,a().K8)((()=>({previewIcon:m.getIcon(),isEmptyPage:m.isEmptyPage()})),[m]),y=(0,n.useCallback)((e=>{const{id:t,spaceStore:n,table:a,showAvatar:i}=e;if(void 0===t||void 0===a)return;const s=(0,Er().xC)({pointer:{id:t,spaceId:n.id,table:a},getRecordModel:n.getRecordModel}).asActor;return!s||s.isUser()&&!(0,Lr().dp)(n,s.id).isMember()||s.isBot()&&!(0,Lr().Ts)(n,s.id).isMember()?void 0:{name:(0,Er().lR)(o,s),avatar:i?(0,r(43972).w)({actor:s,size:18,style:{marginRight:5}}):void 0}}),[o]),b=(0,n.useCallback)((e=>(0,r(907514).nl)(e,{useUltraCompactFormat:!0,useWeeks:!0,useLowercase:!0})),[]),v=(0,n.useCallback)((()=>{const{index:e,selectedResult:t}=l.value;return r=>d({event:r,index:e,selectedResult:t,fromSidePeekPanel:!0,context:"query_results"})}),[d,l.value]),x=(0,n.useCallback)((e=>{if("page_result"!==(null==l?void 0:l.type))return;const{index:t,selectedResult:r}=l.value,{source:n}=e;p({index:t,selectedResult:r,fromSidePeekPanel:n===c().rD.SidePeekPanel,context:"query_results",source:n})}),[p,l]),k=(0,i().IS)((e=>({metadataContainer:{marginTop:8,display:"flex",flexDirection:"column",gap:8},pageIconAndTitleContainer:{marginTop:12,display:"flex",gap:8,flexDirection:"column",justifyContent:"space-between"},title:{fontSize:16,fontWeight:ge().Wy.semibold,textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},untitledPageColor:{color:e.text.tertiary},titleAndLinkContainer:{display:"grid",gridTemplateColumns:"1fr auto",width:"fit-content",gap:5},previewContainer:{marginTop:8,marginBottom:8,display:"flex",flexDirection:"column",position:"relative"},hoveredOrPressedPreview:{background:"unset",boxShadow:"unset"},preview:{borderRadius:6,background:"unset",boxShadow:"unset",border:`1px solid ${e.lightDividerColor}`,padding:12},contentCover:{color:e.text.primary,fontSize:11,lineHeight:1.5,marginBottom:0,width:"110%",transform:"translateX(-12px) translateY(-4px) scale(0.91)",paddingLeft:12,paddingRight:12,paddingTop:12,paddingBottom:0,borderRadius:6,border:`1px solid ${e.lightDividerColor}`,background:"transparent"},contentCoverFade:{height:48,background:`linear-gradient(to bottom, transparent, ${"light"===e.mode?e.contentBackground:e.surface.wash} 100%)`}})),[]),{createdBy:w,created:S,lastEditedBy:I,lastEdited:T}=(0,a().K8)((()=>{const e=Ne().default.state.currentSpaceStore;return e?{createdBy:y({id:m.getCreatedById(),table:m.getCreatedByTable(),spaceStore:e,showAvatar:!0}),created:b(m.getCreatedTime()),lastEditedBy:y({id:m.getLastEditedById(),table:m.getLastEditedByTable(),spaceStore:e,showAvatar:!0}),lastEdited:b(m.getLastEditedTime())}:{createdBy:void 0,created:void 0,lastEditedBy:void 0,lastEdited:void 0}}),[y,m,b]),C=[{key:"created",itemName:Jr.created,itemValue:S,associatedUser:w},{key:"lastEdited",itemName:Jr.lastEdited,itemValue:T,associatedUser:I}],N=(0,a().K8)((()=>{const e=(0,r(71304).Qe)(m,o,t,!Qt().zD.isXMLAssistantEnabled());return e&&e.trim().length>0?e:void 0}),[m,o,t]),M=(0,a().K8)((()=>{var e;return(null==m||null===(e=m.getModel())||void 0===e?void 0:e.getEmptyTitlePlaceholder({getRecordModel:m.getRecordModel,userTimeZone:(0,Ie().P)(),intl:o}))||o.formatMessage({id:"search.preview.untitledPage",defaultMessage:"Untitled"})}),[m,o]),_=(0,a().K8)((()=>{if("page_result"!==l.type)return;const e=l.value.selectedResult.store;return(0,h().Ay)({store:e,collectionViewId:e.id,fullyQualified:!0,pageVisitSource:s().y8.SearchQuery})}),[l]),A=(0,n.useCallback)((async()=>{if(_){const e=await u().R.clipboardActions.load();e.copyString({environment:t,stringValue:_,copiedMessage:e.clipboardMessages.copiedLinkToClipboard}),x({source:c().rD.SidePeekPanel})}}),[x,t,_]);return(0,j.jsxs)("div",{children:[(0,j.jsxs)("div",{style:k.pageIconAndTitleContainer,children:[(0,j.jsx)(r(614505).A,{disabled:!0,icon:g,isEmptyPage:f,size:26,largeIcon:!0}),(0,j.jsxs)("span",{style:k.titleAndLinkContainer,children:[(0,j.jsx)("span",{style:{...k.title,...!N&&k.untitledPageColor},children:N??M}),(0,j.jsx)(on,{onClick:A})]})]}),(0,j.jsx)(r(296798).A,{style:k.previewContainer,href:_,hoveredStyle:k.hoveredOrPressedPreview,pressedStyle:k.hoveredOrPressedPreview,onClick:v,children:(0,j.jsx)(r(545040).z,{variant:"default",store:m,coverFormat:en,coverSizeFormat:"large",showEmptyGalleryCover:!1,coverContentFadedOverlay:!0,coverContentFadedOverlayStyle:k.contentCoverFade,contentWrapStyle:k.contentCover,coverHeight:180,onLoadProxiedImage:()=>{},renderAdditionalBlocks:!0,rendererBlockStyle:{fontSize:9}})}),(0,j.jsx)("div",{style:k.metadataContainer,children:C.filter((e=>void 0!==e.itemValue)).map(((e,t)=>(0,j.jsx)(Xr,{isFirstInList:0===t,itemName:e.itemName,itemValue:e.itemValue,associatedUser:e.associatedUser},e.key)))})]})}function nn(e){const t=(0,V().tz)(),{query:r}=e,n=(0,i().IS)((e=>({container:{display:"flex",flexDirection:"column",gap:30},chatAndAvatarContainer:{display:"flex",gap:6,alignItems:"flex-end"},chatContainer:{display:"flex",flexDirection:"column",gap:10,flexGrow:1,justifyContent:"center"},questionBubble:{backgroundColor:e.cardHoveredBackground,color:e.lightTextColor,padding:8,borderRadius:16,fontSize:12,minWidth:40,minHeight:32,width:"fit-content",maxWidth:180,alignSelf:"flex-end",userSelect:"none",overflow:"hidden",textOverflow:"ellipsis"},introBubble:{backgroundColor:e.cardHoveredBackground,color:e.lightTextColor,padding:8,borderRadius:16,fontSize:14,width:170,userSelect:"none",overflow:"hidden",display:"flex",flexDirection:"column",gap:6,textOverflow:"ellipsis"},helperDescription:{textAlign:"center",fontSize:12,color:e.lightTextColor,display:"flex",justifyContent:"center"},loadingDots:{border:`1px solid ${e.lightDividerColor}`,padding:12,borderRadius:100,width:"max-content"},writingIndicatorCircle:{height:5,width:5,opacity:.6,backgroundColor:e.lightIconColor,borderRadius:"100%"},writingButtonWrapper:{display:"flex",alignItems:"center",justifyContent:"center",gap:3,width:"inherit",height:"inherit"}})),[]);return(0,j.jsxs)("div",{style:n.container,children:[(0,j.jsxs)("div",{style:n.chatAndAvatarContainer,children:[(0,j.jsx)(an,{}),(0,j.jsx)("div",{style:n.chatContainer,children:r?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("div",{style:n.questionBubble,children:r}),(0,j.jsx)("div",{"aria-valuetext":t.formatMessage({id:"search.preview.loadingLabel",defaultMessage:"Loading..."}),role:"progressbar",style:n.loadingDots,children:(0,j.jsxs)("div",{style:n.writingButtonWrapper,children:[(0,j.jsx)("div",{style:n.writingIndicatorCircle}),(0,j.jsx)("div",{style:n.writingIndicatorCircle}),(0,j.jsx)("div",{style:n.writingIndicatorCircle})]})})]}):(0,j.jsxs)("div",{style:n.introBubble,children:[(0,j.jsx)("div",{children:(0,j.jsx)(V().sA,{id:"searchSidePeekPanel.welcomeMessage.title",defaultMessage:"Hi! I’m Notion AI."})}),(0,j.jsx)(V().sA,{id:"searchSidePeekPanel.welcomeMessage.caption",defaultMessage:"Let me help you find information and answer questions."})]})})]}),(0,j.jsx)("div",{style:n.helperDescription,children:(0,j.jsx)("div",{style:{width:"90%"},children:(0,j.jsx)(V().sA,{id:"SearchSidePeek.caption",defaultMessage:"Get quick answers for anything in your workspace"})})})]})}function on(e){const t=(0,o().Y0)(),r=(0,i().IS)((e=>({linkIcon:{width:14,height:14,fill:"light"===e.mode?e.accentColors.gray[300]:e.accentColors.gray[500]},hoveredBackground:{backgroundColor:e.buttonHoveredBackground},shortcutLabel:{color:e.text.contrastSecondary},tooltipContent:{display:"flex",flexDirection:"column"}})),[]),n=(0,a().K8)((()=>t.isElectron),[t]),s=(0,V().tz)().formatMessage({id:"search.preview.copyLink",defaultMessage:"Copy link"});return(0,j.jsx)(Kr().A,{delayThreshold:600,placement:dt().W.Top,allowHover:!0,renderTooltip:()=>(0,j.jsxs)("div",{style:r.tooltipContent,children:[s,n&&(0,j.jsx)(qr().A,{style:r.shortcutLabel,name:"copyLinkToCurrentPage"})]}),closeDelay:0,render:t=>(0,j.jsx)(Dr().A,{...t,icon:e=>(0,Or().w)(r.linkIcon),ariaLabel:s,hoveredStyle:r.hoveredBackground,onClick:e.onClick})})}function an(){const e=(0,i().IS)((e=>({faceImgWrap:{width:32,height:32,borderRadius:"100%",background:e.whiteButtonBackground,border:`1px solid ${e.lightDividerColor}`,overflow:"hidden",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center"},faceImg:{width:40,pointerEvents:"none"},aiSparklesFill:{height:14,width:14,fill:e.mediumIconColor,pointerEvents:"none"}})),[]);return(0,j.jsx)("div",{style:e.faceImgWrap,children:(0,Fr().X)(e.aiSparklesFill)})}function sn(e){const{title:t,icon:r}=e,n=(0,i().IS)((e=>({container:{color:e.text.quaternary,display:"flex",flexDirection:"column",alignItems:"center",userSelect:"none"},title:{fontSize:12,fontWeight:400},icon:{height:24,width:24}})),[]);return(0,j.jsxs)("div",{style:n.container,children:[(0,j.jsx)("div",{children:r(n.icon)}),(0,j.jsx)("div",{style:n.title,children:t})]})}const ln=function(e){const{searchResultStore:t,sxsMode:s,searchDebugColumnStore:l,extraTopPadding:d,comboboxProps:c}=e,u=(0,o().v3)(),p=(0,o().Y0)(),m=(0,V().tz)(),h=(0,a().K8)((()=>Ne().default.state.currentSpaceStore),[]),g=(0,a().K8)((()=>Qt().zD.shouldShowSearchMenuItemAskAI(p)&&k().A.state.online),[p]),f=(0,a().K8)((()=>I().Ay.state.query.text),[]),b=(0,a().uB)(void 0,Gt().A),v=(0,a().K8)((()=>b.state.focus),[b]),{handleSelectSearchResult:x,isQuickSearch:w}=(0,n.useContext)(B().SearchStaticContext),{localResults:T,serverResults:C,clusterInfo:N,debugInfo:M,serverResultsLoading:_,searchExperimentOverrides:A,hasPublicAccessPermission:P,serverResultsAllLoaded:R}=(0,a().K8)((()=>{var e,r;const{hasPublicAccessPermission:n}=y().Er(u);return{localResults:t.state.localResults,serverResults:t.state.serverResults,serverResultsLoading:t.state.serverResultsLoading,clusterInfo:null===(e=t.state.serverResults)||void 0===e?void 0:e.clusterInfo,debugInfo:null===(r=t.state.serverResults)||void 0===r?void 0:r.debugInfo,searchExperimentOverrides:l.state.searchExperimentOverrides,hasPublicAccessPermission:n,serverResultsAllLoaded:t.state.serverResultsAllLoaded,queryBasedActionResults:t.state.queryBasedActionResults}}),[t,l,u]),E=(0,a().K8)((()=>t.state.errorState),[t]),O=(0,n.useCallback)((()=>{!_&&!R&&void 0!==C&&I().Ay.update((e=>({...e,limit:e.limit+I().ZK,isScrolled:!0,source:"quick_find_scroll"})))}),[_,R,C]),F=(0,a().K8)((()=>y().yu({localResults:null==T?void 0:T.results,serverResults:null==C?void 0:C.results})??[]),[T,C]),L=(0,a().K8)((()=>{let e;return e=h?(0,Wt().GK)(u,h):m.formatMessage({defaultMessage:"Untitled workspace",id:"searchResultsBody.askAiInUntitledWorkspacePlaceholder"}),m.formatMessage({id:"searchResultsBody.askAiInSpace",defaultMessage:"in {name}"},{name:e})}),[h,u,m]),q=(0,a().K8)((()=>Qt().zD.isDeepFindEnabled()),[]),K=(0,i().IS)((e=>({container:{display:"flex",flexDirection:"column",width:s?"50%":"100%",overflow:"hidden",paddingTop:g?void 0:5},resultsContainer:{display:"flex",flex:1,overflowY:"scroll"},askAiQueryContainer:{display:"flex",flexDirection:"row",width:s?"50%":"100%",flex:1,overflow:"hidden",alignItems:"center",color:e.regularTextColor,fontWeight:ge().Wy.medium,fontSize:14},query:{fontWeight:ge().Wy.regular,marginLeft:6,...ge().RC}})),[s,g]),U=(0,n.useCallback)((e=>{const{shouldShow:t,shouldShowArrowUp:n}=e;return{type:"assistant",renderTitle:()=>(0,j.jsxs)("div",{className:"notranslate",style:K.askAiQueryContainer,children:[(0,j.jsx)("span",{children:q?f.length>0?(0,j.jsx)(V().sA,{id:"searchResultsBody.askAiMenuItem.deepFindTitleWithQuery",defaultMessage:"Search “{query}” in full page",values:{query:f}}):(0,j.jsx)(V().sA,{id:"searchResultsBody.askAiMenuItem.deepFindTitle",defaultMessage:"Open search in full page"}):(0,j.jsx)(V().sA,{id:"searchResultsBody.askAiMenuItem.title",defaultMessage:"Ask AI"})}),q?null:(0,j.jsx)("span",{style:K.query,children:f.length>0?` “${f}”`:` ${L}`})]}),action:e=>{zt().sv({environment:u,shouldResetAssistantStore:f.length>0||r(295169).default.wasActiveSessionLastOpenedOutsideOfHistorySavedWindow(),quickSearchMode:w,device:p,event:e.event,from:w?"command_search_switching_panes":"search_switching_panes"})},shouldShow:t,shouldShowArrowUp:n}}),[p,u,q,w,f,L,K]),H=(0,a().K8)((()=>{var e;return null===(e=t.state.focusedIndex)||void 0===e?void 0:e.global}),[t]),$=(0,a().K8)((()=>void 0!==H&&1===H),[H]),z=(0,a().K8)((()=>{if(s||"default"!==S().default.state.searchMode)return;const e=U({shouldShow:g,shouldShowArrowUp:$});return g?e:void 0}),[s,U,g,$],{useDeepEqual:!0}),W=(0,a().K8)((()=>{const e=[];z&&e.push({type:"assistant",value:I().Ay.state.query.text}),t.update((t=>({...t,fixedActionResults:e})));return e.length}),[z,t]),Q=(0,n.useCallback)((e=>b.update((t=>t.focus.isInitialized&&0===t.focus.section&&0===t.focus.indexLocal&&0===t.focus.indexGlobal||void 0!==F&&void 0!==t.focus.indexGlobal&&t.focus.indexGlobal<=F.length?t:{...t,focus:e.numberOfFixedActionResults>0?{section:1,indexLocal:0,indexGlobal:e.numberOfFixedActionResults,footerFocused:!1}:{section:0,indexLocal:0,indexGlobal:0,footerFocused:!1}}))),[b,F]),G=(0,a().K8)((()=>!w&&u.WindowSizeStore.state.width<B().DEFAULT_MODAL_WIDTH_WITH_SIDE_PEEK),[u,w]),Z=(0,a().K8)((()=>!((0,D().I5)({device:p})||G||I().Ay.state.isDebugSidebarOpen||u.device.isMobile)),[p,G,u.device.isMobile]);(0,a().K8)((()=>{I().Ay.state.isSidePeekPanelOpen!==Z&&I().Ay.update((e=>({...e,isSidePeekPanelOpen:Z})))}),[Z]),(0,n.useEffect)((()=>{Q({numberOfFixedActionResults:W})}),[F,W,Q]),(0,n.useEffect)((()=>{void 0!==v.section&&void 0!==v.indexLocal&&void 0!==v.indexGlobal?t.update((e=>({...e,focusedIndex:{local:{section:v.section,indexLocal:v.indexLocal},global:v.indexGlobal}}))):t.update((e=>({...e,focusedIndex:void 0})))}),[v,t]);const Y=(0,a().K8)((()=>D().Ay.state.showDebugInfo||s),[s]),X=(0,a().K8)((()=>(0,y().lO)({searchResultStore:t})),[t]);return(0,j.jsxs)("div",{style:K.container,children:[(0,j.jsxs)("div",{style:K.resultsContainer,children:[(0,j.jsx)(wr,{errorState:E,handleSelectResult:x,onMaybeLoadMoreResults:O,resultListStore:b,searchResultStore:t,localResults:null==T?void 0:T.results,serverResults:null==C?void 0:C.results,debugInfo:M,clusterInfo:N,publicAccessPermission:P,searchExperimentOverrides:A,assistantResultItem:z,extraTopPadding:d,comboboxProps:c}),Z&&void 0!==X?(0,j.jsx)(tn,{selectedResult:X}):null]}),(0,j.jsx)(or,{searchResultStore:t,showSpinner:_,shouldShow:Y})]})};var dn=()=>r(700500);function cn(e,t,r){const n=[];return un(t({table:It().ev,id:e}),t,n,!0,new Set,r),d().sb(n)}function un(e,t,r,n,o,a){if(!e)return;if(o.has(e.id))return;if(o.add(e.id),r.length>=a)return r;e.isType(dn().Gz)&&r.push(e.id);const i=e.getType()===dn().xd.transclusionReference&&e.getTransclusionReferenceTargetPointer();i&&un(t(i),t,r,!1,o,a);if(n||e.hasContent())for(const s of e.getContentIds())un(t({table:It().ev,id:s}),t,r,!1,o,a)}const pn=function(e){const{onSelect:t,pageId:r,comboboxProps:s}=e,l=(0,a().uB)(void 0,Gt().A),d=(0,o().v3)(),c=(0,o().Y0)(),u=(0,a().K8)((()=>new(Bt().Bv)(d,{table:It().ev,id:r})),[d,r]),p=(0,a().K8)((()=>cn(r,u.getRecordModel,10).map((e=>new(Bt().Bv)(d,{table:It().ev,id:e}))).filter(E().O9)),[u.getRecordModel,d,r]),m=(0,i().IS)((e=>({wrapper:{width:"100%",height:"100%",overflowX:"hidden",overflowY:"auto"}})),[]),h=[{key:"pages",items:p.map((e=>({key:null==e?void 0:e.id,render:t=>(0,n.createElement)(kr().GC,{...t,store:e,inline:!c.isMobile,hidePath:!1,buttonStyle:{paddingLeft:1},type:"recent_pages",key:null==e?void 0:e.id}),action:r=>t({index:{local:r.indexLocal,global:r.index},event:r.event,selectedResult:{store:e,id:e.id,score:-1,spaceId:e.getSpaceId(),sources:[Nt().Ni.Local],featureGroups:[],originalPosition:0,serverEventProperties:void 0},fromSidePeekPanel:!1,context:"recent_pages"})}))),render:e=>(0,j.jsx)(Z().A,{title:(0,j.jsx)(V().sA,{id:"search.default_page_body.pages",defaultMessage:"Pages"}),children:e.children})}];return(0,j.jsx)("div",{style:m.wrapper,children:(0,j.jsx)(G().Ay,{store:l,type:G().Oh.Vertical,initialFocus:0,disableKeyboardArrowWrap:!0,sections:h,unfocusOnScroll:!0,comboboxProps:s})})};function mn(e){const{searchContentPaneType:t,comboboxProps:r}=e,{searchMobileFilterMenuRef:s,handleSelectSearchResult:l,searchResultStore:d,secondarySearchResultStore:c}=(0,n.useContext)(B().SearchStaticContext),u=(0,o().Y0)(),p=(0,a().K8)((()=>Boolean((0,D().I5)({device:u})&&D().nS.state.visible)),[u]),m=(0,a().K8)((()=>{const e=d.state.errorState;return!1===e.isLoading&&e.showMajorError}),[d]),h=(0,i().IS)((()=>({sxsContainer:{display:"flex",flexDirection:"row",height:"100%",overflow:"hidden",maxWidth:"100%"}})),[]),g=(0,a().K8)((()=>I().Ay.state.filterBar.show),[]),f=!u.isMobile&&!g,y=(0,n.useMemo)((()=>({searchResultStore:d,searchDebugColumnStore:D().E,sxsMode:p,extraTopPadding:f,comboboxProps:r})),[f,d,p,r]),b=(0,a().K8)((()=>(0,ft().s0)()),[]),v=(0,a().K8)((()=>{var e;return null===(e=Ne().default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]);return(0,j.jsxs)(j.Fragment,{children:[!u.isMobile&&g&&(0,j.jsx)(Vt,{isMobile:u.isMobile}),"search_results"===t?(0,j.jsxs)(j.Fragment,{children:[!m&&u.isMobile&&(0,j.jsx)($e,{mode:Ue.Section,ref:s}),(0,j.jsxs)("div",{style:h.sxsContainer,children:[(0,j.jsx)(ln,{...y}),p&&(0,j.jsx)(ln,{...y,searchResultStore:c,searchDebugColumnStore:D().nS})]})]}):v?(0,j.jsx)(yt().Ay,{onSelect:l,spaceId:v,extraTopPadding:f,comboboxProps:r}):b?(0,j.jsx)(pn,{onSelect:l,pageId:b,comboboxProps:r}):null]})}const hn=570,gn=500;function fn(e){const t=(0,o().Y0)(),r=(0,o().v3)();return(0,n.useEffect)((()=>{(0,f().Dd)()||p().G(r,"searchContentPane")}),[r]),(0,b().A)(),(0,x().A)({shouldPreserveTextSelection:!0,shouldPreserveBlockSelection:!0,shouldRestoreSelection:!t.isMobile}),(0,j.jsx)(T().A,{capture:!0,allowMenuList:!0,render:t=>(0,j.jsx)(yn,{...e,ignoreAreaEvents:t})})}function yn(e){const{ignoreAreaEvents:t,quickSearchMode:r,onClose:l,searchContentPaneType:p}=e,{handleQueryChange:f,modalBodyMenuRef:b,searchResultStore:x,defaultBodyFocusedResult:T,handleCopySearchItemLink:M}=(0,n.useContext)(B().SearchStaticContext),[A,P]=(0,n.useState)(!1),[R,E]=(0,n.useState)(!1),[O,F]=(0,v().$)(),L=(0,o().v3)(),D=(0,o().Y0)(),q=(0,a().K8)((()=>I().Ay.state.query.text),[]),{isSearchMenuOpen:K,shouldShowDebugSidebar:U,hasPublicAccessPermission:H,shouldShowSpinner:$}=(0,a().K8)((()=>{const e=Boolean(k().A.state.online),{hasPublicAccessPermission:t}=y().Er(L);return{isSearchMenuOpen:S().default.state.open,shouldShowSpinner:e&&Boolean(q)&&x.state.serverResultsLoading&&!A,shouldShowDebugSidebar:kn({device:D,isPublicAccessPermissionForPage:t}),hasPublicAccessPermission:t}}),[A,x,D,L,q]),V=(0,n.useMemo)((()=>d().sg((()=>{const{activeElement:e}=document;e instanceof HTMLInputElement&&e.blur()}),gn,{leading:!0})),[]),z=(0,n.useCallback)((()=>{R&&V()}),[V,R]),W=(0,n.useCallback)((e=>{E(e),e||D.isMobileNative&&w().A.updateKeyboardPhase(L,w().i.willHide,0)}),[D.isMobileNative,L]),Q=(0,a().K8)((()=>y().lO({searchResultStore:x})),[x]),G=(0,a().K8)((()=>T),[T]),Z=(0,n.useMemo)((()=>(0,j.jsx)(gt().h,{isOpen:r||K,onTypingChange:P,onFocusChange:W,showSpinner:$,onQueryChange:f,quickSearchMode:r,selectedResultStore:"page_result"===(null==Q?void 0:Q.type)?Q.value.selectedResult.store:void 0,inputComboboxProps:O})),[K,W,$,f,r,Q,O]),Y=(0,a().K8)((()=>bn({searchContentPaneType:p,quickSearchMode:r,environment:L})),[p,r,L]),X=(0,i().IS)((e=>({body:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column",zIndex:2},topbar:{height:void 0,marginTop:10,marginLeft:16,marginBottom:10,marginRight:16},topbarRightButtonWrapper:{flex:void 0,paddingLeft:16},topbarButton:{fontWeight:void 0,padding:0,color:e.mediumTextColor},scroller:{display:"flex",flexDirection:"row",flexWrap:"nowrap",justifyContent:"space-between",maxHeight:Y.maxHeight,minHeight:Y.minHeight}})),[Y.maxHeight,Y.minHeight]),J=(0,n.useMemo)((()=>{if(D.isMobile){return{menuType:g().gu.Modal,left:Z,shouldRenderLeftDirectly:!0,width:r?"100vw":void 0,...vn({style:X.topbarRightButtonWrapper,quickSearchMode:r,onClick:l}),header:"search_results"===p&&(0,j.jsx)(pt,{isPublicPageSearch:H}),disableHeaderShadow:!0,topbarStyle:X.topbar,leftRightButtonStyle:X.topbarButton,onScroll:xn(D)?z:void 0,bodyScrollerClassName:m().Smt,...t}}return{menuType:g().gu.Popup,maxHeight:Y.maxHeight,minHeight:Y.minHeight,maxWidth:"100%",...r?{width:"100vw"}:{},disableScroller:!0,scrollerStyle:X.scroller,...t}}),[D,X,t,Z,l,p,H,z,Y.minHeight,Y.maxHeight,r]),ee=G||Q,te=(0,n.useCallback)((e=>{if("page_result"!==(null==ee?void 0:ee.type))return;const{index:t,selectedResult:r}=ee.value;M({index:t,selectedResult:r,fromSidePeekPanel:e.source===c().rD.SidePeekPanel,context:"search_results"===p?"query_results":"recent_pages",source:e.source})}),[M,p,ee]),re=(0,n.useCallback)((async()=>{if(!L.device.isElectron||!ee||"page_result"!==ee.type)return;const e=ee.value.selectedResult.store,t=(0,h().J8)({store:e,collectionViewId:e.id,fullyQualified:!0,pageVisitSource:s().y8.SearchQuery});if(!t)return;const r=await u().R.clipboardActions.load();r.copyString({environment:L,stringValue:t,copiedMessage:r.clipboardMessages.copiedLinkToClipboard}),te({source:c().rD.KeyboardShortcut})}),[L,te,ee]);return(0,j.jsx)(C().A,{debugName:"SearchContentPane",capture:!0,onCopyLinkToCurrentPage:e=>{re()},onCopyLinkToPageInCommandSearch:e=>{re()},children:(0,j.jsxs)(N().A,{...J,className:m().Y0h,ref:b,children:[(0,j.jsxs)("div",{style:X.body,children:[(0,j.jsx)(_().A,{}),!D.isMobile&&Z,(0,j.jsx)(mn,{searchContentPaneType:p,comboboxProps:F})]}),U&&(0,j.jsx)(ie,{})]})})}function bn(e){const{searchContentPaneType:t,quickSearchMode:r,environment:n}=e;if(r)return{maxHeight:"100vh",minHeight:"100vh"};const o=n.WindowSizeStore.state.height,a=(0,l().jq)(n.device.isElectronMac),i=o>hn+a?hn:0;return{minHeight:`max(${"search_results"===t?70:50}vh, ${i}px)`,maxHeight:`max(${"search_results"===t?70:50}vh, ${i}px)`}}function vn(e){let{style:t,quickSearchMode:r,onClick:n}=e;return r?{rightOuterStyle:{display:"none"}}:{right:(0,j.jsx)(M().CancelMenuText,{}),onClickRight:n,rightOuterStyle:t}}function xn(e){return!!e.isMobile&&(!e.isIOS||e.isMobileNative)}function kn(e){let{device:t,isPublicAccessPermissionForPage:r}=e;if(!r&&!t.isMobile)return I().Ay.isDebugSidebarOpen()}},755278:(e,t,r)=>{"use strict";r.d(t,{A:()=>m});var n=r(296540),o=()=>r(484714),a=()=>r(56366),i=()=>r(496603),s=()=>r(307060),l=()=>r(361330),d=()=>r(793765),c=()=>r(531770);const u=(0,i().sg)(c().Lj,l().ab),p=(0,i().sg)(c().Lj,l().ab);function m(){const e=(0,o().Y0)(),{searchResultStore:t,secondarySearchResultStore:r}=(0,n.useContext)(s().SearchStaticContext),{parentStore:i}=(0,n.useContext)(s().SearchStoresContext),l=(0,c().Nu)(i),m=(0,a().K8)((()=>Boolean((0,d().I5)({device:e})&&d().nS.state.visible)),[e]);(0,c().nR)({dependencies:l,searchResultStore:t,debugColumnStore:d().E,enabled:!0,serverSearchFn:u}),(0,c().nR)({dependencies:l,searchResultStore:r,debugColumnStore:d().nS,enabled:m,serverSearchFn:p,preventUpdateSearchMetrics:!0})}},762282:(e,t,r)=>{"use strict";r.d(t,{CD:()=>s,Qz:()=>i,Y7:()=>l,YV:()=>d,o0:()=>a,uI:()=>c});r(18107),r(967357),r(898992),r(354520),r(581454);var n=()=>r(534177),o=()=>r(252050);class a{constructor(){this.didModify=!1}modified(){return this.didModify}markModified(){this.didModify=!0}resetModified(){this.didModify=!1}apply(e,t){return this.resetModified(),this.applyImpl(e,t)}trimLeadingAndTrailingWhitespace(e){if(0===e.length)return e;const t=[...e],r=t[0];if("text"===r.type){const e=(n=r.value)!==n.trimStart()&&""!==n.trimStart()&&" "===n[0]?` ${n.trimStart()}`:n.trimStart();""===e?(this.markModified(),t.shift()):e!==r.value&&(this.markModified(),t[0]={type:"text",value:e})}var n;const o=t.at(-1);if("text"===(null==o?void 0:o.type)){const e=function(e){return e!==e.trimEnd()&&""!==e.trimEnd()&&" "===e[e.length-1]?`${e.trimEnd()} `:e.trimEnd()}(o.value);""===e?(this.markModified(),t.pop()):e!==o.value&&(this.markModified(),t[t.length-1]={type:"text",value:e})}return t}}function i(e){return"text"===e.type||Boolean(o()._S[e.tagName])}function s(e){return"element"===e.type&&Boolean(o().sA[e.tagName])}function l(e){if("element"!==e.type)return!1;const t=o().sA[e.tagName];return void 0!==t&&!0===t.title}function d(e){return"element"===e.type&&e.tagName in o().GU}function c(e,t){const r=t(e);return"element"===r.type?{...r,children:r.children.map((e=>c(e,t))).filter(n().O9)}:r}},764458:(e,t,r)=>{"use strict";r.d(t,{A:()=>P,h:()=>O});r(898992),r(737550);var n=r(296540),o=()=>r(484714),a=()=>r(56366),i=()=>r(401497),s=()=>r(316808),l=()=>r(620333),d=()=>r(919709),c=()=>r(959013),u=()=>r(38337),p=()=>r(780865),m=()=>r(437622),h=()=>r(962730),g=()=>r(351360),f=()=>r(430483),y=()=>r(948914),b=()=>r(982254),v=()=>r(899677),x=()=>r(498719),k=()=>r(250484),w=()=>r(285790),S=()=>r(623580),I=()=>r(614505),T=()=>r(859428),C=(r(581454),()=>r(546806)),N=()=>r(496603),M=()=>r(222917),_=()=>r(406699),B=r(474848);function A(e){const{events:t,spaceIcon:r,spaceName:o}=e,[a,s]=(0,n.useState)(!1),l=(0,i().IS)((e=>({downIcon:{height:8,width:8,stroke:e.icon.tertiary},wrapper:{display:"flex",alignItems:"center",gap:2,paddingRight:5,cursor:"pointer"},recordIcon:{backgroundColor:a?e.buttonHoveredBackground:void 0,padding:4,height:void 0,width:void 0}})),[a]);return(0,B.jsxs)("span",{...t,style:l.wrapper,onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1),role:"button",children:[(0,B.jsx)(I().A,{bucket:"public",disabled:!0,icon:r,isEmptyPage:!1,size:24,style:l.recordIcon,title:o}),(0,C().e)(l.downIcon)]})}const j=function(){const e=(0,a().K8)((()=>g().default.state.currentSpaceStore),[]),t=(0,a().K8)((()=>null==e?void 0:e.id),[null==e?void 0:e.id]),i=(0,o().v3)(),s=(0,a().K8)((()=>i.currentUser.id),[i.currentUser.id]),{handlePopupOpen:l,handlePopupClose:d}=(0,n.useContext)(r(307060).SearchStaticContext),c=(0,n.useCallback)((async e=>{const{newSpaceViewStore:t,associatedUserId:n,closeSwitcherPopupFn:o}=e,a=t.getSpaceId();if(t&&s&&a){var l;const e=null===(l=g().default.state.currentSpaceViewStore)||void 0===l?void 0:l.id,d=M().wr();e&&d&&a&&M().mg(i,{currentSearchSessionId:d,currentWorkspaceId:e,newWorkspaceId:a}),o(),g().default.update((e=>({...e,currentSpaceViewStore:t,currentSpaceStore:null==t?void 0:t.getSpaceStore()}))),s!==n&&await r(840153).T({environment:i,newCurrentUserId:n}),f().zD.isAiEnabled()&&r(650829).assistantDependency.load().then((e=>{let{assistantActions:t}=e;t.clearAllAssistantSessions()})),v().default.closeAndResetMetricsState(),r(786601).A.closeAndResetMetricsState(),x().default.reset(),r(260488)._N({environment:i,analyticsFrom:"quick-search-switch-workspace",isQuickSearch:!0})}}),[s,i]),{spaceIcon:u,spaceName:p}=(0,a().K8)((()=>e?{spaceName:e.getName(),spaceIcon:(0,m().c2)(i,e)}:{spaceName:void 0,spaceIcon:void 0}),[e,i]),y=[...i.currentUser.loggedInUserIds],b=(0,a().K8)((()=>{var e;return N().hS(N().oE((null===(e=g().default.state.currentUserRootStore)||void 0===e?void 0:e.getSpaceViewStores())??[]),(e=>e.getSpaceId()))}),[]);return e?!t||!s||!e||b.length<=1&&1===y.length?null:(0,B.jsx)(_().Ay,{popupType:_().z7.Popup,renderOrigin:e=>(0,B.jsx)(A,{events:e,spaceIcon:u,spaceName:p}),render:e=>(0,B.jsx)(r(928600).A,{menuType:r(722872).gu.Popup,children:y.map(((t,n)=>(0,B.jsx)(r(930561).ti,{onSpaceClick:r=>c({newSpaceViewStore:r.spaceViewStore,associatedUserId:t,closeSwitcherPopupFn:e.close}),userId:t,isLastUser:n===y.length-1,disableAccountActions:!0},`commandSearch-userworkspaces-${n}`)))}),onClick:l,onClose:d,disabled:!1,placementToOrigin:h().W.Bottom,alignmentToOrigin:h().C.Start,style:{marginRight:30}}):null},P=48;function R(e){const{onTypingChange:t,onFocusChange:s,isOpen:l,showSpinner:p,onQueryChange:h,selectedResultStore:w,quickSearchMode:T,inputComboboxProps:C}=e,N=(0,c().tz)(),M=(0,n.useRef)();(0,n.useEffect)((()=>()=>{M.current&&(window.clearTimeout(M.current),M.current=void 0)}),[]);const _=(0,o().v3)(),A=(0,a().K8)((()=>k().Ay.state.isPopupOpen),[]),{electronTabsState:R,isPinnedState:O}=(0,a().K8)((()=>({electronTabsState:b().A.state.tabs,isPinnedState:b().A.state.currentTab.isPinned})),[]),D=(0,a().K8)((()=>v().default.state.isNewElectronTab),[]),{isElectronTabSearchEnabledState:q,isPinnedTabNewTabEnabledState:K}=(0,a().K8)((()=>{var e,t;return{isElectronTabSearchEnabledState:null===(e=y().A.state.preferences)||void 0===e?void 0:e.isNewTabSearchEnabled,isPinnedTabNewTabEnabledState:null===(t=y().A.state.preferences)||void 0===t?void 0:t.isPinnedTabNewTabEnabled}}),[]),U=Boolean(D)&&Boolean(q)||Boolean(K)&&Boolean(O),H=(0,o().Y0)(),$=(0,i().IS)((e=>({inputDesktop:{fontSize:18,height:P,paddingLeft:12,paddingRight:16,alignItems:"center",flexGrow:0,flexShrink:0,zIndex:1,boxShadow:`0 1px 0 ${e.regularDividerColor}`},inputMobile:{fontSize:16,border:"none",boxShadow:"none",borderRadius:7,lineHeight:"1.2",padding:"6px 8px",background:e.inputBackground},searchIcon:{width:16,height:16},searchIconColor:{fill:e.mediumIconColor},headerIcon:{height:24,width:24,display:"flex",alignItems:"center",justifyContent:"center"},input:{minWidth:0,...r(284371).RC},suggestedText:{whiteSpace:"pre",color:e.mediumTextColor},suggestedTextWrapper:{overflow:"hidden",textOverflow:"ellipsis"},autoCompletedText:{background:e.tint.regular},clearButton:{marginLeft:8},userInputAndSuggestedTextContainer:{display:"grid",gridTemplateColumns:"auto 1fr"}})),[]),{userText:V}=(0,a().K8)((()=>({userText:k().Ay.state.query.text})),[]),{currentSpaceStore:z,mainEditorCurrentBlockStore:W}=(0,a().K8)((()=>({currentSpaceStore:g().default.state.currentSpaceStore,mainEditorCurrentBlockStore:g().default.state.mainEditorCurrentBlockStore})),[]),Q=(0,a().K8)((()=>null==W?void 0:W.getTitleValue()),[W]),G=(0,a().K8)((()=>z&&(0,m().GK)(_,z)),[_,z]),Z=(0,a().K8)((()=>f().zD.showSearchAiFeatures()),[]),Y=H.isMobile?S().C.ExtraLarge:S().C.Transparent,X=(0,a().K8)((()=>function(e){const{intl:t,isNewElectronTab:r,spaceName:n,pageTitleValue:o,showSearchAiFeatures:a}=e;if(r)return t.formatMessage({id:"searchInputMenuItem.placeholder.newTab",defaultMessage:"Open in new tab..."});if(n&&a)return t.formatMessage({id:"searchInputMenuItem.placeholder.SearchOrAskQuestionInSpace",defaultMessage:"Search or ask a question in {spaceName}…"},{spaceName:n});if(n)return t.formatMessage({id:"searchInputMenuItem.placeholder.searchInSpace",defaultMessage:"Search {spaceName}…"},{spaceName:n});if(o){const e=100,r=d().k4p(o).slice(0,e);return t.formatMessage({id:"searchInputMenuItem.placeholder.namedPage",defaultMessage:"Search in {pageTitle}…"},{pageTitle:r})}return t.formatMessage({id:"searchInputMenuItem.placeholder.unnamedPage",defaultMessage:"Search in page…"})}({intl:N,isNewElectronTab:U,spaceName:G,pageTitleValue:Q,showSearchAiFeatures:Z})),[N,U,G,Q,Z]),J=(0,a().K8)((()=>{const e=Boolean(q)?R:[];return function(e,t,r,n,o,a){if(0===n.length||n.length>=20||t.isMobile||void 0===r)return;const i=d().k4p(r.getTitleValue()),s=i.replaceAll("\n"," "),l=i.slice(0,n.length),c=i.length>0&&l.toLocaleLowerCase()===n.toLocaleLowerCase(),u=c?s.substring(n.length):"";switch(!0){case t.isElectron&&o.some((e=>e.pageId===r.id)):return`${u} — ${e.formatMessage(L.switchTab)}`;case t.isElectron&&a:return`${u} — ${e.formatMessage(L.openInTab)}`;default:return`${u} — ${e.formatMessage(L.open)}`}}(N,H,w,V,e,U)}),[R,q,w,H,V,U,N]),ee=(0,a().K8)((()=>r(659467).A.state.open),[]),te=V.trim().length>0&&J?(0,B.jsxs)("div",{style:$.userInputAndSuggestedTextContainer,"data-search-suggested-text":!0,children:[(0,B.jsx)("span",{style:{whiteSpace:"pre-wrap"},children:V}),(0,B.jsx)("div",{style:{...$.suggestedTextWrapper},className:T&&!A?u().sbV:void 0,children:(0,B.jsx)("span",{style:$.autoCompletedText,children:J})})]}):"",re=H.isMobile?$.inputMobile:$.inputDesktop,ne={...$.input,width:0===V.length&&T?`min(${X.length}ch, 100%)`:"100%"},oe=(0,a().K8)((()=>null==w?void 0:w.getIcon()),[w]),ae=(0,a().K8)((()=>Boolean(V.trim())&&!H.isMobile),[V,H]),ie=(0,n.useMemo)((()=>{const e={...$.searchIconColor,...$.searchIcon};if(T)return(0,B.jsx)(j,{});return(0,B.jsx)("div",{style:$.headerIcon,children:(()=>{switch(!0){case p:return(0,B.jsx)(r(331542).A,{size:"md"});case ae:return(0,B.jsx)(I().A,{disabled:!0,icon:oe,isEmptyPage:Boolean(oe),size:20});case U:return(0,r(349348).Y)({...$.searchIconColor,width:18,height:18});default:return(0,r(381138).q)(e)}})()})}),[$.searchIconColor,$.headerIcon,$.searchIcon,T,p,ae,oe,U]),se=()=>{void 0===x().default.state.firstKeyStrokeTimeMs&&x().default.update((e=>({...e,firstKeyStrokeTimeMs:Date.now()}))),M.current&&window.clearTimeout(M.current),t(!0),M.current=window.setTimeout((()=>t(!1)),300)};return(0,B.jsx)("div",{style:{display:"flex",flex:1},className:T&&!A?u().sbV:void 0,children:(0,B.jsx)(S().A,{format:Y,placeholder:X,left:ie,value:V,suggestedText:te,suggestedTextStyle:$.suggestedText,focus:H.isMobile?void 0:l&&!ee,focusInitial:!(0,r(155959).T)("supportsNativeHome")&&H.isMobile,focusAfterAnimation:!0,showClearButton:!0,right:!H.isMobile&&(0,B.jsx)(E,{quickSearchMode:T}),isRightLastElementOfInput:!0,selectAll:!0,onChange:e=>{se();const t=String(e.target.value);h(t)},onClearButtonClick:F,style:re,inputStyle:ne,...(0,r(553965).A)(C,{onFocus:()=>function(e){e(!0)}(s),onBlur:()=>function(e){e(!1)}(s)})})})}function E(e){const[t,r]=(0,a().K8)((()=>{const e=k().Ay.state.query.filters,t=(0,p().J3)(e);return[k().Ay.state.filterBar.show,t]}),[]),n=(0,o().v3)();(0,a().K8)((()=>{const e=n.currentUser.id;if(!e)return;!1===(0,l().YT)(e)&&!0===t&&k().Ay.collapseFilterBar()}),[n,t]);const d=(0,i().IS)((e=>({container:{padding:4,marginLeft:5,borderRadius:4,height:"fit-content",width:"fit-content",display:"flex"},hoveredContainerStyles:{background:r?e.accentColors.uiBlue[100]:e.buttonHoveredBackground},icon:{width:17,height:17,cursor:"pointer",fill:r?e.accentColors.uiBlue[600]:"light"===e.mode?e.accentColors.gray[300]:e.accentColors.gray[500]}})),[r]),u=(0,c().tz)(),m=t?u.formatMessage({id:"searchInputMenuItem.filterBarToggleButtonTooltip.hide",defaultMessage:"Hide filters"}):u.formatMessage({id:"searchInputMenuItem.filterBarToggleButtonTooltip.show",defaultMessage:"Show filters"});return(0,B.jsx)(T().A,{renderTooltip:()=>(0,B.jsx)("div",{children:m}),placement:h().W.Bottom,alignment:h().C.Start,disableTooltip:n.device.isMobile,delayThreshold:400,render:e=>(0,B.jsx)(w().A,{...e,icon:e=>(0,s().g)(d.icon),ariaLabel:m,style:d.container,hoveredStyle:d.hoveredContainerStyles,onClick:()=>t?k().Ay.collapseFilterBar():k().Ay.expandFilterBar()})})}const O=R;function F(){k().Ay.resetQuery({resetFilters:!0}),k().Ay.update((e=>({...e,source:"quick_find"})))}const L=(0,c().YK)({open:{id:"search.inputMenu.suggestedText.open",defaultMessage:"Open"},openInTab:{id:"search.inputMenu.suggestedText.openInTab",defaultMessage:"Open in tab"},switchTab:{id:"search.inputMenu.suggestedText.switchTab",defaultMessage:"Switch tab"}});R.displayName="SearchInputMenuItem"},839752:(e,t,r)=>{"use strict";r.d(t,{HI:()=>h,q9:()=>p,w7:()=>u});r(898992),r(672577);var n=()=>r(728611),o=()=>r(211716),a=()=>r(492414),i=()=>r(780865),s=()=>r(705540),l=()=>r(260488),d=()=>r(857783),c=()=>r(867201);const u=new(r(592328).A);function p(e){const{searchResult:t,environment:r}=e,n="page"===t.type?(0,i().pV)(t):t.store.id;r.device.isElectron?function(e){const{searchResult:t,scrollToBlockId:r,electronTabSearch:n,openInNew:o,context:i,pageVisitSource:l,queryId:d,environment:c}=e;if(!n)return;const{isNewTab:u}=n,{store:p}=t,h=p.id,g=(0,a().Ay)({pageVisitSource:l,store:p,scrollToBlockId:r,queryId:d}),f=n?n.tabs.find((e=>e.pageId===h)):void 0,y=Boolean(o),b="tabs"===i||"query_results"===i;if(f&&!y&&b)return void s().handleTabClicked(f.id);if(u)return void s().openNotionUrl({makeTabActive:!y,url:g,position:"end",isNewPage:"new_page"===i,openInNew:o??"tab",environment:c});m({...e,scrollToBlockId:r})}({...e,scrollToBlockId:n}):m({...e,scrollToBlockId:n})}function m(e){const{searchResult:t,environment:r,openInNew:n,pageVisitSource:a,queryId:i,scrollToBlockId:s}=e,{store:l}=t;void 0===s?c().Y({store:l,openInNew:n,environment:r,pageVisitSource:a,queryId:i}):d().uK({environment:r,store:l,scrollToBlockId:s,openInNew:n,visitType:o().ig.Search,pageVisitSource:a,queryId:i})}function h(e){let{environment:t,event:r,tabId:o,url:a}=e;l().st({environment:t,reset:!1});const i=n().Vr(r);i?s().openNotionUrl({makeTabActive:!1,url:a,position:"end",openInNew:i??"tab",environment:t}):s().handleTabClicked(o)}},881480:(e,t,r)=>{"use strict";r.d(t,{g:()=>o});r(16280);var n=()=>r(160907);function o(){const e=(0,n().f)();if(!e)throw new Error("No available store");return e}},896278:(e,t,r)=>{"use strict";r.d(t,{g:()=>m});r(296540);var n=()=>r(401497),o=()=>r(584262),a=()=>r(356596),i=()=>r(534177),s=()=>r(435009),l=()=>r(839752),d=()=>r(728611),c=()=>r(760217),u=r(474848);function p(e){const{menuListItemProps:t,title:r,caption:o,icon:i}=e,s=(0,n().IS)((e=>({container:{paddingTop:8,paddingBottom:8,display:"flex"},title:{fontWeight:500},shortcut:{fontSize:12,color:e.text.quaternary},icon:{height:20,width:20,fontSize:20},enterIcon:{height:12,width:12,fill:e.text.secondary}})),[]);return(0,u.jsx)(c().A,{title:(0,u.jsx)("div",{style:s.title,children:r}),caption:o?(0,u.jsx)("div",{children:o}):void 0,...t,icon:i(s.icon),style:s.container,buttonStyle:e.buttonStyles,right:t.focused?(0,a().K)(s.enterIcon):void 0,rightStyle:s.shortcut})}function m(e){const{result:t,desktopProps:{isNewElectronTabSearch:r,electronTabs:n},queryId:a,environment:c,isMiniSearch:m}=e,{title:h,icon:g,caption:f}=t.value;let y=`${h}-search-action-item`;if("navigation"===t.value.behavior){const e=t.value.destination,r="block"===e.type?e.blockStore.id:e.url;y=`${h}-${r}-search-action-item`}return{key:y,action:u=>{let{event:p}=u;e.action(p);const{behavior:m}=t.value;if("action"===m)t.value.action();else if("navigation"===m){const e=t.value.destination,u=r?"tab":(0,d().Vr)(p);"block"===e.type?l().q9({environment:c,openInNew:u,pageVisitSource:o().y8.SearchCustomAction,queryId:a,context:"action",electronTabSearch:{tabs:n??[],isNewTab:r},searchResult:{type:"custom",store:e.blockStore}}):"url"===e.type?s().oo({environment:c,url:e.url,queryId:a,openInNew:u,makeTabActive:r}):(0,i().HB)(e)}},render:t=>(0,u.jsx)(p,{menuListItemProps:t,caption:f,icon:g,isMiniSearch:m,title:h,...e})}}},913441:(e,t,r)=>{"use strict";r.d(t,{rx:()=>Y,iY:()=>Z,oj:()=>G,GC:()=>K});r(944114),r(517642),r(658004),r(733853),r(845876),r(432475),r(515024),r(731698),r(898992),r(823215),r(354520),r(672577),r(430670),r(581454),r(737550);var n=r.n(r(32485)),o=r(296540),a=()=>r(484714),i=()=>r(56366),s=()=>r(401497);function l(e){var t;let{explanation:r,simple:n=!1,filterZeros:o=!1}=e;return function e(t,r){if(!t)return[];const{value:a,description:i,details:s}=t;if(0===a&&o)return[];const l=(0===a?"0":a.toFixed(4)).padStart(8);function d(e){return`${"  ".repeat(r+(arguments.length>1&&void 0!==arguments[1]?arguments[1]:0))}${e}`}const c=`[${l}] ${i}`;if(i.startsWith("match on required clause")){return[d(`[${l}] match on required clause ${null==s?void 0:s[1].description}`)]}if(["max of:","sum of:","min of:"].includes(i)&&1===(null==s?void 0:s.length))return e(s[0],r);if(i.startsWith("tf")||i.startsWith("idf")){var u;const e=i.split(",")[0],t=null===(u=i.split(" computed as ")[1])||void 0===u?void 0:u.replace(" from:","");return[d(`[${l}] ${e}: [${(s??[]).map((e=>`${e.description.split(",")[0]}=${e.value}`)).join(" ")}] --\x3e ${t}`)]}if(i.startsWith("ConstantScore(_id:"))return[d(`[${l}] ids query`)];const p=n&&0!==r&&(i.startsWith("weight")||i.startsWith("Function"));return[d(c.replace(", result of:","").replace(" from:","").replace(" [PerFieldSimilarity]","").replace(/:$/,"").trim()),...(p?[]:s??[]).flatMap((t=>e(t,r+1)))]}(null==r||null===(t=r.details)||void 0===t?void 0:t[0],0)}var d=()=>r(356596),c=()=>r(372160),u=()=>r(207289),p=()=>r(179034),m=()=>r(245241);var h=()=>r(931075),g=()=>r(959013),f=()=>r(100622),y=()=>r(534177),b=()=>r(284371),v=()=>r(305872),x=()=>r(186445),k=()=>r(751380),w=()=>r(108944),S=()=>r(907514),I=()=>r(470928),T=()=>r(240865),C=()=>r(351360),N=()=>r(948914),M=()=>r(982254),_=()=>r(630116),B=()=>r(793765),A=()=>r(464708),j=()=>r(760217),P=()=>r(720128),R=()=>r(957986),E=()=>r(614505),O=()=>r(128295),F=()=>r(16006),L=()=>r(717402),D=r(474848);function q(e,t){const[r,l]=(0,o.useState)(!1),{focused:d,isLastInSection:c,inline:u,className:p}=e,m=function(){const{isMobile:e}=(0,a().Y0)();return(0,s().IS)((t=>({menuItem:{minHeight:36,paddingTop:e?12:8,paddingBottom:e?12:8},menuItemBorder:{boxShadow:`0 1px 0 ${t.lightDividerColor}`},textWrapper:{alignItems:"center",width:"100%"},inlineTextWrapper:{alignItems:"center"},caption:{marginTop:1,color:t.text.secondary},timestamp:{fontSize:b().J.UISmall.desktop,fontWeight:b().Wy.regular,color:t.text.tertiary}})),[e])}(),h=(0,s().IS)((e=>({hovered:{background:e.tint.regular}})),[]),g=(0,i().K8)((()=>{return{title:(0,D.jsx)(re,{store:e.store,result:e.result,placeholder:e.placeholder,index:e.index,focused:e.focused,originalPosition:e.originalPosition,inline:e.inline}),icon:(0,D.jsx)(V,{store:e.store}),caption:(0,D.jsx)(oe,{store:e.store,inline:e.inline,result:e.result,debugLocal:e.debugLocal,debugHits:e.debugHits,debugAreaRef:e.debugAreaRef,debugModalState:{explanationModalOpen:r,setExplanationModalOpen:l}}),body:(0,D.jsx)(z,{result:e.result,store:e.store}),right:(0,D.jsx)(te,{focused:e.focused,type:e.type,lastViewed:e.lastViewed,result:e.result}),rightStyle:d?void 0:m.timestamp,dontShrinkRight:!0,captionStyle:m.caption,style:{...m.menuItem,...!u&&!c&&!d&&!e.isBeforeFocused&&m.menuItemBorder},spacerStyle:(t=e.store,o=e.hidePath,o||!(0,O().a6)(t)?{visibility:"hidden"}:void 0),textWrapperStyle:{...m.textWrapper,...e.inline&&m.inlineTextWrapper},className:n()("notranslate",p),buttonStyle:{paddingLeft:2},hoveredStyle:h.hovered};var t,o}),[h.hovered,p,r,d,u,c,e.debugAreaRef,e.debugHits,e.debugLocal,e.focused,e.hidePath,e.index,e.inline,e.isBeforeFocused,e.lastViewed,e.originalPosition,e.placeholder,e.result,e.store,e.type,m.caption,m.inlineTextWrapper,m.menuItem,m.menuItemBorder,m.textWrapper,m.timestamp]);return(0,D.jsx)(j().A,{ref:t,...e,...g,disableTransition:!0,ignoreLocalHoverState:!0})}const K=o.memo((0,o.forwardRef)(q),((e,t)=>{var r,n;const o=t.focused!==e.focused,a=(null===(r=t.result)||void 0===r?void 0:r.highlight)!==(null===(n=e.result)||void 0===n?void 0:n.highlight),i=t.isLastInSection!==e.isLastInSection,s=t.isBeforeFocused!==e.isBeforeFocused;return o||a||i||s}));function U(e){let{data:t}=e;const r=t;if(!r)return null;if("localSource"in r){const{localSource:e}=r,t=e||["unknown"];return{element:(0,D.jsx)(D.Fragment,{children:`from ${[...t].join(",")}`}),expanded:!1}}return null}function H(e){return e&&!e.sources.includes(m().Ni.Local)}function $(e){var t;let{result:r,index:n,originalPosition:o}=e;const a=null===(t=(null==r?void 0:r.sources)??[])||void 0===t?void 0:t.flatMap((e=>e===m().Ni.Local?["💻"]:e===m().Ni.ElasticSearch?["🌐"]:e===m().Ni.Postgres?["🐘"]:e===m().Ni.VectorDBBlock||e===m().Ni.VectorDBCollection?["🔭"]:e===m().Ni.ElasticsearchRandom?["🎲"]:e===m().Ni.ElasticsearchUniqueID?["🆔"]:e===m().Ni.ElasticsearchForcedRecentRecall?["⏰"]:e===m().Ni.NotionUnknown?["🤷"]:e===m().Ni.UniversalUnknown?["👽"]:void(0,y().HB)(e))).reverse(),i=[...void 0===n||void 0===o?[" "]:n>o?["⬇️"]:n<o?["⬆️"]:[],...a].join("").trim();return i?(0,D.jsx)("span",{children:i}):null}function V(e){let{store:t}=e;const r=(0,i().K8)((()=>t.getIcon()),[t]),n=(0,i().K8)((()=>t.isEmptyPage()),[t]);return(0,D.jsx)(E().A,{disabled:!0,icon:r,isEmptyPage:n,size:20,largeIcon:!1})}function z(e){var t,r;let{result:n,store:a}=e;const l=(null==n||null===(t=n.sources)||void 0===t?void 0:t.includes(m().Ni.VectorDBBlock))||(null==n||null===(r=n.sources)||void 0===r?void 0:r.includes(m().Ni.VectorDBCollection)),d=(0,s().IS)((e=>({highlight:{color:e.text.primary,fontWeight:b().Wy.medium,...l?{whiteSpace:"pre-wrap"}:{}},collectionTextMatchingProperty:{lineHeight:2,fontSize:12}})),[l]),c=(0,o.useMemo)((()=>n?_().Bv.createChildStore(a,{table:p().ev,id:n.id,spaceId:n.spaceId}):void 0),[n,a]),h=(0,i().K8)((()=>null==c?void 0:c.isNavigableBlock()),[c]);if(!n)return null;if(!n.highlight)return null;if(h&&!H(n))return null;let g,f;if(n.highlight.text)g=n.highlight.text;else if(n.highlight.collectionText){var y;g=n.highlight.collectionText,f=null==n||null===(y=n.matchedCollectionProperties)||void 0===y?void 0:y.collectionText}if(g=(0,u().KM)(g),!g)return null;const v=(0,k().Ay)(g);let x=!1;if(H(n)){const e=e=>e.filter(k().dJ).map((e=>e[0].toLowerCase())),t=t=>void 0===t?[]:e((0,k().Ay)(t)),r=[...new Set([...t(n.highlight.title),...t(n.highlight.pathText)])],o=e=>r.some((t=>t.includes(e)));x=e(v).every((e=>o(e)))}const w=x?{}:d.highlight;return(0,D.jsxs)(D.Fragment,{children:[void 0!==f&&(0,D.jsx)(L().Ay,{propertySchema:f,showIcon:!0,style:d.collectionTextMatchingProperty}),(0,D.jsx)(P().A,{text:g,highlighter:{tokenize:e=>(0,k().nB)(v),style:w}})]})}function W(){return(0,s().IS)((e=>({badge:{background:"light"===e.mode?e.accentColors.blue[30]:e.accentColors.blue[200]},badgeContent:{display:"flex",alignItems:"center",width:"100%"},badgeCaption:{marginLeft:2,color:e.blueColor},verifiedBadgeIcon:{width:10,height:10,fill:e.blueColor},grayedOutBadgeCaption:{marginLeft:1}})),[])}function Q(e){let{label:t}=e;const r=W();return(0,D.jsx)(A().A,{style:r.badge,content:(0,D.jsxs)("div",{style:r.badgeContent,children:[(0,c().E)(r.verifiedBadgeIcon),(0,D.jsx)("div",{style:r.badgeCaption,children:t})]})})}function G(e){let{label:t}=e;const r=W();return(0,D.jsx)(A().A,{style:r.badge,content:(0,D.jsx)("div",{style:r.badgeCaption,children:t})})}function Z(e){let{label:t}=e;const r=W();return(0,D.jsx)(A().A,{style:r.badge,content:(0,D.jsx)("div",{style:r.badgeCaption,children:t})})}function Y(e){let{label:t}=e;const r=W();return(0,D.jsx)(A().A,{content:(0,D.jsx)("div",{style:r.grayedOutBadgeCaption,children:t})})}function X(){const e=W();return(0,D.jsx)(A().A,{content:(0,D.jsx)("div",{style:e.grayedOutBadgeCaption,children:(0,D.jsx)(g().sA,{id:"search.result.archived.badge.text",defaultMessage:"Archived"})})})}function J(){const e=W();return(0,D.jsx)(A().A,{content:(0,D.jsx)("div",{style:e.grayedOutBadgeCaption,children:(0,D.jsx)(g().sA,{id:"search.result.current.page.badge.text",defaultMessage:"Current Page"})})})}function ee(e){var t;let{result:r,focused:n}=e;const o=(0,a().v3)(),l=null==r||null===(t=r.highlight)||void 0===t?void 0:t.uniqueId,d=(0,i().K8)((()=>"dark"===o.ThemeStore.state.mode),[o]),c=(0,s().IS)((()=>({uniqueIDBadgeWrapper:{display:"flex",gap:8,marginRight:8,alignItems:"center"}})),[]),u=(0,k().PO)({words:l?[l]:[]});if(!l)return null;const p=n?d?f().XA.dark.translucentGray[300]:f().CM.light.darkgray.alpha(.09):d?f().XA.dark.translucentGray[200]:f().CM.light.darkgray.alpha(.06);return(0,D.jsxs)("div",{style:c.uniqueIDBadgeWrapper,children:[(0,D.jsx)("div",{children:(0,D.jsx)(P().A,{text:l,highlighter:u})}),(0,D.jsx)("div",{style:{borderRight:`1.5px solid ${p}`,height:14,borderRadius:1}})]})}function te(e){let{focused:t,type:r,lastViewed:n,result:o}=e;const l=(0,a().v3)(),c=(0,i().K8)((()=>M().A.getState().tabs),[]),u=(0,i().K8)((()=>{var e;return Boolean(null===(e=N().A.state.preferences)||void 0===e?void 0:e.isNewTabSearchEnabled)&&l.device.isElectron}),[l.device.isElectron]),p=(0,i().K8)((()=>(0,x().s0)()),[]),m=p&&p===(null==o?void 0:o.id),h=u&&("tabs"===r||c.some((e=>e.pageId===(null==o?void 0:o.id)&&"page"===e.type))),f=(0,s().IS)((e=>({right:{display:"flex"},rightIcon:{height:12,width:12,fill:e.icon.secondary,opacity:t?1:0},rightContentWrapper:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center"},switchToTab:{fontSize:b().J.UISmall.desktop,fontWeight:b().Wy.regular,color:e.text.secondary,marginRight:4}})),[t]);if(l.device.isMobile)return null;if(n&&!t)return(0,D.jsx)(D.Fragment,{children:(0,S().nl)(n,{useCompactFormat:!0})});const y=h&&!m&&t;return(0,D.jsx)("div",{style:f.right,children:(0,D.jsxs)("div",{style:f.rightContentWrapper,children:[y&&(0,D.jsx)("div",{style:f.switchToTab,children:(0,D.jsx)(g().sA,{id:"search.result.switchTab.text",defaultMessage:"Switch tab"})}),(0,d().K)(f.rightIcon)]})})}function re(e){let{store:t,result:r,placeholder:n,index:o,focused:a,originalPosition:l,inline:d}=e;const c=(0,g().tz)(),u=void 0===r,f=(0,s().IS)((e=>({title:{fontWeight:b().Wy.medium,lineHeight:"20px",...!u&&!a&&{color:e.text.secondary}},titleContent:{display:"flex",...d?{}:{width:0,flexGrow:1}}})),[a,d,u]),y=(0,i().K8)((()=>{const e=[];if(r&&r.highlight)if(e.push(...(0,k().oQ)(r.highlight.pathText)),H(r))e.push(...(0,k().oQ)(r.highlight.title));else{_().Bv.createChildStore(t,{table:p().ev,id:r.id,spaceId:r.spaceId}).isNavigableBlock()&&e.push(...(0,k().oQ)(r.highlight.text))}return e}),[r,t]),v=(0,k().PO)({words:a?[]:y}),S=(0,i().K8)((()=>{var e;return null===(e=(0,w().Uo)(t))||void 0===e?void 0:e.isArchived()}),[t]),N=function(e){if(e)return e.sources.includes(m().Ni.ElasticsearchUniqueID)}(r),M=(0,i().K8)((()=>(0,x().s0)()),[]),A=M&&M===(null==r?void 0:r.id),j=(0,i().K8)((()=>{var e;if(!(0,I().Io)())return!1;const r=null===(e=C().default.state.currentSpaceStore)||void 0===e?void 0:e.getModel();return!(!r||!(0,h().Xi)(r))&&(0,h().sN)(t.getModel())}),[t]);const P=function(){function e(e){var t;return null==r||null===(t=r.badges)||void 0===t?void 0:t.find((t=>t.type===e))}for(const t of["is_template","popular_this_week","most_viewed","verified"]){const r=e(t);if(void 0!==r)return{type:r.type,label:r.label};if("verified"===t&&j)return{type:"verified",label:c.formatMessage(m().Nz.verified)}}}(),R=(0,T().V)()??0,E=(0,i().K8)((()=>R>1&&!A&&!S||"is_template"===(null==P?void 0:P.type)),[A,S,P,R])?P:void 0,O={is_template:e=>(0,D.jsx)(Y,{label:e}),verified:e=>(0,D.jsx)(Q,{label:e}),popular_this_week:e=>(0,D.jsx)(G,{label:e}),most_viewed:e=>(0,D.jsx)(Z,{label:e})},L=(0,i().K8)((()=>B().Ay.state.showDebugInfo),[]);return(0,D.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",...f.title},children:[(0,D.jsxs)("div",{style:f.titleContent,children:[L&&void 0!==o&&`${o+1}. `,N&&(0,D.jsx)(ee,{focused:a,result:r}),(0,D.jsx)(F().A,{style:f.title,store:t,placeholder:n,highlighter:v}),S&&(0,D.jsx)(X,{}),A&&(0,D.jsx)(J,{}),E&&O[E.type](E.label)]}),L&&(0,D.jsx)($,{result:r,index:o,originalPosition:l})]})}function ne(e,t){const{data:r,keyPath:n}=e;if(2===n.length&&"_explanation"===n[0])return{element:(0,D.jsx)("button",{onClick:e=>{t(!0),e.stopPropagation()},children:"show simplified explanation"}),expanded:!1};const o=r._ltrlog;if(o)return function(e){const t=Object.keys(e[0])[0],r=e[0][t],n={paddingLeft:5,paddingRight:20,paddingTop:2,paddingBottom:2,border:"1px solid black",color:f().XA.dark.green[900]},o={...n,color:f().XA.dark.gray[30]},a=r.map(((e,t)=>{const r=t%2==0?o:n;return(0,D.jsxs)("tr",{children:[(0,D.jsx)("td",{style:r,children:`${t}`}),(0,D.jsx)("td",{style:r,children:`${e.name}`}),(0,D.jsx)("td",{style:r,children:`${e.value}`})]},e.name)}));return{element:(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)("div",{children:(0,D.jsx)("b",{children:`Featureset: ${t}`})}),(0,D.jsx)("div",{style:{maxHeight:200,overflowY:"scroll"},children:(0,D.jsx)("table",{style:{border:"1px solid black"},children:a})})]}),expanded:!1}}(o);if(!["_score","matched_queries"].every((e=>r[e])))return null;const{_score:a,matched_queries:i}=r;return{element:(0,D.jsx)(D.Fragment,{children:`score ${a}, ${(i??[]).length} matched query clauses`}),expanded:!1}}function oe(e){let{store:t,inline:r,result:n,debugLocal:d,debugHits:c,debugAreaRef:u,debugModalState:p}=e;const m=(0,a().Y0)(),h=(0,s().IS)((e=>({captionTooltip:{color:e.text.contrastPrimary},captionTooltipDivider:{color:e.text.contrastPrimary},debugArea:{fontFamily:"monospace"},breadcrumb:{height:"100%",flexGrow:0,marginRight:8,fontSize:10,minWidth:0}})),[]),g=(0,o.useCallback)((e=>ne(e,p.setExplanationModalOpen)),[p.setExplanationModalOpen]),f=(0,k().PO)({words:(0,k().oQ)(n&&n.highlight&&n.highlight.pathText),removeDuplicate:!0}),y=r||m.isMobile?0:2,b=(c??[]).find((e=>"elasticsearch"===e.type&&void 0!==e._explanation)),x="elasticsearch"===(null==b?void 0:b.type)?null==b?void 0:b._explanation:void 0,w=(0,i().K8)((()=>Boolean(B().Ay.getDebugLevel())),[]);return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(O().Ay,{store:t,extraLength:y,showFullPathInTooltip:!0,highlighter:f,enableHoverAncestor:!0,tooltipStyle:h.captionTooltip,tooltipDividerStyle:h.captionTooltipDivider}),(0,D.jsxs)("div",{ref:u,children:[d&&(0,D.jsx)("div",{style:h.debugArea,children:(0,D.jsx)(v().H,{data:{debugLocal:d},defaultCollapsed:!0,customCollapsedRenderers:[U],showCopyButton:!1,showModalButton:!1})}),c&&(0,D.jsx)("div",{style:h.debugArea,children:(0,D.jsx)(v().H,{data:{debugHits:c},defaultCollapsed:!0,customCollapsedRenderers:[g],showCopyButton:"small",showModalButton:!0})}),c&&(null==n?void 0:n.rankingSignals)&&(0,D.jsx)("div",{style:h.debugArea,children:(0,D.jsx)(v().H,{data:{rankingSignals:n.rankingSignals},defaultCollapsed:!0,showCopyButton:"small",showModalButton:!1})}),w&&(null==n?void 0:n.featureGroups)&&(0,D.jsx)("div",{style:h.debugArea,children:(0,D.jsx)(v().H,{data:{featureGroups:n.featureGroups},defaultCollapsed:!0,showCopyButton:"small",showModalButton:!1})}),x&&(0,D.jsx)(R().A,{open:p.explanationModalOpen,innerStyle:{maxHeight:"90vh",maxWidth:"90vw",height:"90vh",width:"90vw",overflow:"scroll",padding:10},onDismiss:()=>p.setExplanationModalOpen(!1),render:()=>(0,D.jsx)("pre",{children:l({explanation:x}).join("\n")})})]})]})}},925844:(e,t,r)=>{"use strict";r.d(t,{g:()=>o});r(296540);var n=r(474848);const o=(0,r(340498).wt)("title",{viewBox:"0 0 14 10",svg:(0,n.jsx)("path",{d:"M10.674 9.45c.293 0 .576-.052.85-.153.273-.098.515-.238.726-.422.215-.184.383-.4.504-.65h.03v.662a.569.569 0 00.163.416c.11.101.25.152.422.152a.579.579 0 00.428-.164c.11-.105.164-.256.164-.451V4.973c0-.43-.104-.805-.31-1.125-.208-.32-.5-.569-.88-.744-.378-.18-.828-.27-1.347-.27-.594 0-1.114.115-1.559.346-.445.226-.75.533-.914.92-.031.07-.056.14-.076.21a.684.684 0 00-.03.194c0 .148.05.27.147.363.102.09.23.135.387.135a.61.61 0 00.287-.064.555.555 0 00.217-.2c.172-.32.377-.554.615-.703.238-.148.533-.223.885-.223.426 0 .76.112 1.002.334.242.223.363.528.363.915v.486l-1.828.1c-.77.042-1.361.23-1.775.562-.41.328-.616.773-.616 1.336 0 .379.09.71.27.996.183.285.435.508.756.668.324.16.697.24 1.119.24zm.328-.938c-.367 0-.666-.092-.897-.276a.906.906 0 01-.345-.738.86.86 0 01.34-.709c.23-.184.558-.29.984-.322l1.664-.106v.598c0 .293-.078.557-.234.791a1.69 1.69 0 01-.627.557c-.266.136-.56.205-.885.205zM.689 9.414c.2 0 .354-.045.463-.135.114-.086.202-.234.264-.445l.65-1.816h3.346l.65 1.816c.063.21.149.36.258.445.114.09.268.135.463.135.207 0 .371-.057.492-.17a.593.593 0 00.188-.463c0-.129-.027-.27-.082-.422L4.79 1.357c-.09-.246-.22-.43-.393-.55C4.23.686 4.012.625 3.742.625c-.508 0-.847.244-1.02.732L.116 8.39a1.3 1.3 0 00-.076.404c0 .195.057.348.17.457.117.11.277.164.48.164zm1.717-3.486L3.73 2.119h.03l1.324 3.809H2.406z"})})},943290:(e,t,r)=>{"use strict";r.d(t,{BL:()=>p,BP:()=>m,Wd:()=>u,Wu:()=>T,iL:()=>x,j_:()=>C,qT:()=>c,s2:()=>N,wF:()=>w});r(16280),r(944114),r(517642),r(658004),r(733853),r(845876),r(432475),r(515024),r(731698),r(898992),r(354520),r(672577),r(430670),r(803949),r(581454);var n=r.n(r(794148)),o=()=>r(99895),a=()=>r(496603),i=()=>r(534177),s=()=>r(795727),l=()=>r(252050),d=()=>r(691309);function c(e){return e.flatMap((e=>"removedPage"===e.type||e.didCreatePage?e.operationIds:e.groupedEdits.flatMap((e=>e.operationIds))))}const u=(0,i().u0)((e=>p(e)?{false:e}:{true:e})),p=(0,i().u0)((e=>"updatedPage"===e.type&&e.didCreatePage?{true:e}:{false:e})),m=(0,i().u0)((e=>"updatedPage"===e.type?{true:e}:{false:e}));class h{constructor(){this.parentToChildIndexMap=new(o().G)((e=>{if("database-views"===e.tagName)return new Map;const t=new Map;return e.children.forEach(((e,r)=>t.set(e.attributes.id,r))),t})),this.blockIdMap=new Map}getIndexInParentForBlock(e){return this.blockIdMap.set(e.attributes.id,e),(e.parent&&this.parentToChildIndexMap.get(e.parent).get(e.attributes.id))??0}getIndexInParentForBlockId(e){const t=this.blockIdMap.get(e);return t?this.getIndexInParentForBlock(t):0}}const g=["insertedBlocks","updatedBlocks"];function f(e){const{groupedEditType:t,group:r,block:n,executableOperation:o,blockIndexFinder:a}=e,s=n.parent?[n.parent.attributes.id,a.getIndexInParentForBlock(n)]:[void 0,0],l=r.groupedEditsByType[t].blocksByParent.get(s);"insertedBlocks"===t?r.groupedEditsByType[t].blocksByParent.set(s,{editId:n.attributes.id,type:t,blockIds:new Set([n.attributes.id,...(null==l?void 0:l.blockIds)??[]]),operationIds:[...(null==l?void 0:l.operationIds)??[],o.id]}):"updatedBlocks"===t?r.groupedEditsByType[t].blocksByParent.set(s,{editId:n.attributes.id,type:t,blockIds:new Set([n.attributes.id]),operationIds:[...(null==l?void 0:l.operationIds)??[],o.id]}):(0,i().HB)(t)}function y(e){const{group:t,block:r,executableOperation:n}=e,o=t.groupedEditsByType.removedBlocks;t.groupedEditsByType.removedBlocks={type:"removedBlocks",blockIds:new Set([...(null==o?void 0:o.blockIds)??[],r.attributes.id]),editId:(null==o?void 0:o.editId)??r.attributes.id,operationIds:[...(null==o?void 0:o.operationIds)??[],n.id]}}function b(e){const{group:t,executableOperation:r}=e;t.groupedEditsByType.updatedTitle={editId:`${t.pageId}.title`,type:"updatedTitle",blockId:t.pageId,operationIds:[r.id]}}function v(e){const{group:t,names:r,executableOperation:n}=e;0!==r.length&&t.groupedEditsByType.updatedProperties.push({editId:`${t.pageId}.properties`,type:"updatedProperties",propertyNames:new Set(r),operationIds:[n.id]})}function x(e){const t=new h,r=new(o().G)((e=>({type:"updatedPage",pageId:e,didCreatePage:!1,updatedTitle:!1,updatedPropertyNames:new Set,insertedBlockIds:new Set,updatedBlockIds:new Set,removedBlockIds:new Set,groupedEditsByType:{insertedBlocks:{blocksByParent:new(s().A)},removedBlocks:void 0,updatedBlocks:{blocksByParent:new(s().A)},updatedProperties:[],updatedTitle:void 0},extraOperationIds:[]}))),c=new(o().G)((e=>({type:"removedPage",pageId:e,operationIds:[]}))),{rootOperations:u,descendantOperationsMap:m,movedBlocks:x}=function(e){const t=new Map,r=new Set,n=new Set;for(const o of e){const e=w(o);t.set(e.attributes.id,e),"createBlock"===o.command||"insertBlockAfter"===o.command||"insertBlockBefore"===o.command||"setBlockProperty"===o.command||"setBlockText"===o.command||"setBlockAttribute"===o.command||"setBlockParent"===o.command?r.add(e.attributes.id):"moveBlock"===o.command&&n.add(e.attributes.id)}const a=[],i=new(o().G)((e=>[]));for(const o of e){const e=w(o),n=S(e).slice().reverse().find((e=>t.get(e.attributes.id)));n?i.get(n.attributes.id).push({...o}):"removeBlock"===o.command&&r.has(e.attributes.id)?i.get(e.attributes.id).push(o):a.push(o)}return{rootOperations:a,descendantOperationsMap:i,movedBlocks:n}}(e);for(const n of u){const e=w(n);if("moveBlock"===n.command||x.has(e.attributes.id)){const o=k(r,e);o.updatedBlockIds.add(e.attributes.id),f({groupedEditType:"updatedBlocks",group:o,block:e,executableOperation:n,blockIndexFinder:t})}else if("createBlock"===n.command||"insertBlockAfter"===n.command||"insertBlockBefore"===n.command){const o=[];for(const t of e.children)o.push(t.attributes.id);const a=Object.values(e.properties).filter((e=>"property-title"!==e.tagName)).map((e=>e.attributes.name));if(I(e)){const i=r.get((0,d().So)(e.attributes.id));i.didCreatePage=!0,a.forEach((e=>i.updatedPropertyNames.add(e))),o.forEach((e=>i.insertedBlockIds.add(e))),e.children.forEach((e=>{(0,l().gc)(e)||f({groupedEditType:"insertedBlocks",group:i,block:e,executableOperation:n,blockIndexFinder:t})})),(0,l().gc)(e)||f({groupedEditType:"insertedBlocks",group:i,block:e,executableOperation:n,blockIndexFinder:t}),v({group:i,names:a,executableOperation:n})}else{const o=k(r,e);o.insertedBlockIds.add(e.attributes.id),f({groupedEditType:"insertedBlocks",group:o,block:e,executableOperation:n,blockIndexFinder:t})}}else if("setBlockParent"===n.command){f({groupedEditType:"insertedBlocks",group:r.get(n.blockNode.attributes.id),block:n.blockNode,executableOperation:n,blockIndexFinder:t})}else if("removeBlock"===n.command)if(I(n.removeBlockNode)){c.get((0,d().So)(n.removeBlockNode.attributes.id)).operationIds.push(n.id)}else{const t=k(r,e);t.removedBlockIds.add(e.attributes.id),y({group:t,block:e,executableOperation:n})}else if("setBlockAttribute"===n.command||"setBlockTagName"===n.command||"setBlockText"===n.command||"setBlockProperty"===n.command||"insertOrMoveTableColumns"===n.command||"addBlockToPage"===n.command||"removeTableColumn"===n.command)if(I(n.blockNode)){const e=r.get((0,d().So)(n.blockNode.attributes.id)),t="setBlockText"===n.command;t&&(e.updatedTitle=!0);const o="setBlockProperty"===n.command?n.property.attributes.name:void 0;o&&e.updatedPropertyNames.add(o),t||"Title"===o?b({group:e,executableOperation:n}):o&&v({group:e,names:[o],executableOperation:n}),"addBlockToPage"===n.command&&(e.extraOperationIds.push(n.id),e.didCreatePage=!0)}else{const o=k(r,e);o.updatedBlockIds.add(n.blockNode.attributes.id),f({groupedEditType:"updatedBlocks",group:o,block:n.blockNode,executableOperation:n,blockIndexFinder:t})}else(0,i().HB)(n)}const T=[...r.entries()].map((e=>{let[r,o]=e;if(!c.has(r)){if(o.didCreatePage)return function(e){var t,r;const{updatedPageGroup:o,descendantOperationsMap:i}=e;n()(o.didCreatePage);const{extraOperationIds:s,didCreatePage:l,groupedEditsByType:d,...c}=o;return{didCreatePage:!0,...c,operationIds:a().sb([...d.insertedBlocks.blocksByParent.valuesArray().flatMap((e=>e.operationIds)),...d.updatedBlocks.blocksByParent.valuesArray().flatMap((e=>e.operationIds)),...(null===(t=d.removedBlocks)||void 0===t?void 0:t.operationIds)??[],...(null===(r=d.updatedTitle)||void 0===r?void 0:r.operationIds)??[],...d.updatedProperties.flatMap((e=>e.operationIds)),...s,...[...i.values()].flat().map((e=>e.id))])}}({updatedPageGroup:o,descendantOperationsMap:m});{const e=function(e){const{updatedPageGroup:t,blockIndexFinder:r}=e;if(n()(!t.didCreatePage),t.extraOperationIds.length>0)throw new Error("Non page create update group contained unaccounted-for operations");const{groupedEditsByType:o,didCreatePage:s,extraOperationIds:l,...d}=t,c=[],{updatedProperties:u,updatedTitle:p}=o;p&&c.push(p);u.length>0&&c.push({type:"updatedProperties",editId:u[0].editId,operationIds:u.flatMap((e=>e.operationIds)),propertyNames:new Set(u.flatMap((e=>[...e.propertyNames])))});for(const n of g){const e=o[n].blocksByParent,t=[];for(;e.size>0;){const r=[e.keys().next().value],n=e.get(r[0]);for(t.push(n);e.size>0&&r.length>0;){const t=r.shift(),o=e.get(t);o&&(e.delete(t),n.operationIds.push(...o.operationIds),o.blockIds.forEach((e=>n.blockIds.add(e))),r.push([t[0],t[1]-1],[t[0],t[1]+1]))}}c.push(...t)}o.removedBlocks&&c.push(o.removedBlocks);for(const n of c){if((0,i().Xk)(g,n.type))if("insertedBlocks"===n.type||"updatedBlocks"===n.type){const e=a().Ul([...n.blockIds],(e=>r.getIndexInParentForBlockId(e)));n.blockIds=new Set(e)}else(0,i().HB)(n.type);n.operationIds=a().sb(n.operationIds)}return{didCreatePage:!1,...d,groupedEdits:c}}({updatedPageGroup:o,blockIndexFinder:t});return function(e){const{rootUpdatedPageGroup:t,descendantOperationsMap:r}=e;for(const n of t.groupedEdits)if("insertedBlocks"===n.type||"updatedBlocks"===n.type||"removedBlocks"===n.type)for(const e of n.blockIds){const o=r.get(e);for(const e of o)n.operationIds.push(e.id),"removeBlock"===e.command&&t.removedBlockIds.add(e.removeBlockNode.attributes.id)}return t}({rootUpdatedPageGroup:e,descendantOperationsMap:m})}}})).filter(i().O9),C=function(e){const{allGroups:t,rootOperations:r}=e,n=e=>{const{pageId:t}=e,n=r.find((e=>w(e).attributes.id===t)),o=n&&w(n),a=null==o?void 0:o.parent;return o&&a?a.children.findIndex((e=>e.attributes.id===t)):-1},o=t.slice().sort(((e,t)=>p(e)&&p(t)?n(e)-n(t):0));return o}({allGroups:[...T,...c.values()],rootOperations:u});return C}function k(e,t){const r=function(e){let t=e;for(;t;){if(I(t))return t;t=t.parent}}(t);if(!r)throw new Error(`No ancestor page found for block: ${t.attributes.id}`);return e.get(r.attributes.id)}function w(e){return"removeBlock"===e.command?e.removeBlockNode:"insertBlockAfter"===e.command||"insertBlockBefore"===e.command?e.insertBlockNode:e.blockNode}function S(e){let t=null==e?void 0:e.parent;const r=[];for(;t;){if(I(t))return r;r.push(t),t=t.parent}return r}function I(e){return"page"===e.tagName||"database"===e.tagName||"child-page"===e.tagName||"child-database"===e.tagName}function T(e){let t=0;for(const r of e)if("updatedPage"===r.type)t+=r.didCreatePage?1:r.groupedEdits.length;else{if("removedPage"!==r.type)return(0,i().HB)(r);t+=1}return t}function C(e){const{insertedBlockIds:t,updatedBlockIds:r,removedBlockIds:n,updatedTitle:o,updatedPropertyNames:a}=e;return t.size+r.size+n.size+(o?1:0)+a.size}function N(e){const{updatedPageGroups:t,executableOperations:r}=e,n=new Map;for(const a of r)n.set(a.id,{block:w(a),operation:a});const o=new Map;for(const a of t)if(a.didCreatePage)o.set(a.pageId,[a,void 0]);else{o.set(a.pageId,[a,void 0]);for(const e of a.groupedEdits)if("insertedBlocks"===e.type||"updatedBlocks"===e.type||"removedBlocks"===e.type)for(const t of e.operationIds){const r=n.get(t);if(r){const{block:t}=r;o.set(t.attributes.id,[a,e])}}}return{blockIdToPageGroupAndEdit:o}}},980382:(e,t,r)=>{"use strict";r.d(t,{I:()=>C});r(898992),r(354520);var n=()=>r(943290),o=()=>r(691309),a=(r(16280),r(944114),r(823215),r(672577),r(581454),r(737550),()=>r(438632));function i(e){return function(e){const{beforeString:t,afterString:r}=e,n=(0,a().PD)(t,r).filter((e=>{let[t]=e;return t!==a().cb.same})).length;return[n>5,{numberOfDiffs:n}]}(e)[0]}var s=()=>r(700500),l=()=>r(970013),d=()=>r(795727),c=()=>r(179034),u=()=>r(919709),p=()=>r(496603),m=()=>r(534177),h=()=>r(246826),g=()=>r(606952),f=()=>r(317909),y=()=>r(630116);function b(e){const{blockStore:t,property:r}=e,n=t.getSchema(),o=Object.entries(n||{}).find((e=>{let[t]=e;return t===r})),a=null==o?void 0:o[1];return a?(0,l().QP)(a):void 0}function v(e,t){const{isIncompleteAfter:r,editId:n}=t;return(0,a().yR)({before:e??[],after:[],isIncompleteAfter:r,insertionAnnotation:n?[u().Ifu.Inserted,n]:[u().Ifu.Inserted],deletionAnnotation:n?[u().Ifu.Deleted,n]:[u().Ifu.Deleted]})}function x(e,t){const{isIncompleteAfter:r,editId:n}=t;return(0,a().yR)({before:[],after:e??[],isIncompleteAfter:r,insertionAnnotation:n?[u().Ifu.Inserted,n]:[u().Ifu.Inserted],deletionAnnotation:n?[u().Ifu.Deleted,n]:[u().Ifu.Deleted]})}function k(e){const{environment:t,transaction:r,blockStore:n,property:o,beforePropertyValue:i,afterPropertyValue:s,editId:l,isIncompleteAfter:c,dontDisplayRemoves:p}=e,h=function(e,t){if(!e||!t)return t;const r=e=>{if(!(0,u().qXl)(e))return;const[,t]=e;return(0,u().$CJ)(t)},n=e=>[e[0],{...e[1],date_format:void 0,time_format:void 0}];if(t.every((e=>!(0,u().uPN)(e).some(u().qsB)))||e.every((e=>!(0,u().uPN)(e).some(u().qsB))))return t;const o=e.map(r).filter(m().O9),a=new(d().A);for(const i of o){const e=n(i);a.set(e,i)}return t.map((e=>{const t=(0,u().uPN)(e).map((e=>{if(!(0,u().qsB)(e))return e;const t=n(e);return a.get(t)??e}));return(0,u().Ey_)((0,u().N8A)(e),t)}))}(i,s);if((i||h)&&!(0,u().MTk)(i,h)){let e=(0,a().yR)({before:i||[],after:h||[],isIncompleteAfter:c,insertionAnnotation:l?[u().Ifu.Inserted,l]:[u().Ifu.Inserted],deletionAnnotation:l?[u().Ifu.Deleted,l]:[u().Ifu.Deleted]});p&&(e=function(e){const t=e=>{if(!(0,u().BEe)(e))return!1;const[,t]=e;return t.some(u().XKU)};return e.filter((e=>!t(e)))}(e)),g().KY({environment:t,transaction:r,store:n.getPropertyStore(o),value:e})}}function w(e){const{environment:t,transaction:r,blockStore:n,property:o,beforePropertyValue:a,afterPropertyValue:i}=e;if((a||i)&&!(0,u().MTk)(a,i)){const s=v(a,e),l=x(i,e),d=s.concat([["\n"]]).concat(l);g().KY({environment:t,transaction:r,store:n.getPropertyStore(o),value:d})}}function S(e){const{environment:t,transaction:r,property:n,blockStore:o,originalPropertyValue:a}=e;g().KY({environment:t,transaction:r,store:o.getPropertyStore(n),value:v(a,e)})}function I(e){const{environment:t,transaction:r,property:n,blockStore:o,newPropertyValue:a}=e;g().KY({environment:t,transaction:r,store:o.getPropertyStore(n),value:x(a,e)})}var T=()=>r(371621);function C(e){const{assistantSessionContext:t,environment:r,processingBlockId:a}=e,l=t.getAllPendingOperations(),d=t.getAllPendingExecutableOperations(),m=(0,n().iL)(t.getAllPendingExecutableOperations()).filter(n().BP);!function(e){const{environment:t,operations:r,processingBlockId:o,caches:a,updatedPageGroups:l,executableOperations:d,originalCache:m=t.defaultRecordCache.inMemoryRecordCache}=e,g=t.currentUser.id;if(!g)throw Error("User is not logged in.");const{blockIdToPageGroupAndEdit:v}=(0,n().s2)({updatedPageGroups:l,executableOperations:d}),x=p().hS(p().oE(r.map((e=>{if(e.pointer.table===c().ev)return e.pointer}))),(e=>e.id));a.commitDiffPreviewTransaction({environment:t,transactionActions:f(),perform(e,r){for(const C of x){var n,l;const x=v.get(C.id);if(!x)continue;const N=new(y().Bv)(t,C,{inMemoryRecordCache:r}),M=null===(n=m.getEntry({pointer:C,userId:g},void 0,!0))||void 0===n||null===(n=n.value)||void 0===n?void 0:n.value,[_,B]=x;if(_.didCreatePage){const t=a.updatesCache.getEntry({pointer:C,userId:g},void 0,!0);var d;t&&h().KY({store:N.getContentStore(),transaction:e,value:(null===(d=t.value.value)||void 0===d?void 0:d.content)??[]});continue}const A=null===(l=r.getEntry({pointer:C,userId:g},void 0,!0))||void 0===l||null===(l=l.value)||void 0===l?void 0:l.value,j=p().sb([...Object.keys((null==M?void 0:M.properties)??{}),...Object.keys((null==A?void 0:A.properties)??{})]),P=_.removedBlockIds.has(C.id),R=P&&(null==M?void 0:M.type)===s().xd.text&&void 0===(null==M?void 0:M.properties);R&&j.push("title");for(const n of j){var f,T;const a=b({blockStore:N,property:n});if(a&&"text"!==a)continue;const s=null==M||null===(f=M.properties)||void 0===f?void 0:f[n],l=null==A||null===(T=A.properties)||void 0===T?void 0:T[n],d={environment:t,transaction:e,temporaryCache:r,blockStore:N,property:n,beforePropertyValue:s,afterPropertyValue:l,isIncompleteAfter:C.id===o&&C.table===c().ev,editId:null==B?void 0:B.editId},p=i({beforeString:(0,u().q4_)(s),afterString:(0,u().q4_)(l)}),m=_.updatedBlockIds.has(C.id)&&(0,u().MTk)(s,l),h=P&&!R&&void 0===s;(0,u().MTk)(N.getPropertyValue("language"),[["Mermaid"]])?k({...d,dontDisplayRemoves:!0}):p&&"title"===n?w({...d}):m?I({...d,newPropertyValue:l}):R?S({...d,originalPropertyValue:(0,u().x9d)("        ")}):h||P?S({...d,originalPropertyValue:l}):k(d)}}},userAction:"assistantActions.displayTransactionDiff",userId:g})}({environment:r,operations:(0,o().g$)(l,(0,T().BB)()),processingBlockId:a,caches:t.caches,updatedPageGroups:m,executableOperations:d})}}}]);