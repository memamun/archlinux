"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[51680],{19537:(e,t,o)=>{o.r(t),o.d(t,{CollectionMapView:()=>_});o(898992),o(581454),o(908872);var n=()=>o(912433),r=o.n(o(916443)),i=o(296540),l=()=>o(484714),a=()=>o(56366),c=()=>o(584262),s=()=>o(585849),u=()=>o(519839),d=()=>o(492414),p=()=>o(79043),m=()=>o(351360),g=()=>o(758740),S=()=>o(970330),f=()=>o(612008),y=()=>o(857783),v=()=>o(281948),h=()=>o(606952),C=()=>o(317909),P=()=>o(357643),x=()=>o(476492),b=()=>o(611371);function k(e){const{environment:t,geoPoint:o,collectionContextStore:n,query:r,schema:i,isFullScreen:l,store:a}=e,d="map_add_item";C().createAndCommit({userAction:"CollectionMapView.handleClick",environment:t,canUndo:!0,perform:e=>{const p=function(e){const{environment:t,transaction:o,geoPoint:n,query:r,isFullScreen:i,groupFormat:l,collectionContextStore:a,from:d}=e;if(!(0,b().EF)(t))return;const p=l?[l]:[],m=a.groupsStore.getGroupState(p);if(!m)return;a.searchQueryStore.state&&(0,P().S)({searchQuery:"",collectionContextStore:a,isFullScreen:i});const g=(0,f().Q)({environment:t,collectionContextStore:a,groupsPointer:p,shouldCoerce:!0,templateStore:a.defaultPageTemplateStore.state,transaction:o,from:{createBlock:d},inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache});if(!g)return;const S=g.newStore;(function(e){const{environment:t,store:o,query:n,geoPoint:r,transaction:i}=e,{map_by:l}=n;if(!l)return;const a=o.getAssociatedCollectionStore(),c=(null==a?void 0:a.getMappedProperty(l))??l;h().KY({environment:t,store:o.getPropertyStore(c),value:(0,s().n)(r),transaction:i})})({environment:t,store:S,query:r,geoPoint:n,transaction:o}),t.device.isMobile?y().uK({environment:t,store:S,pageVisitSource:c().y8.Create}):v().VU({environment:t,store:S,peekMode:(0,u().hH)(a),resultsStore:null==m?void 0:m.resultsStore,collectionContextStore:a,pageVisitSource:c().y8.Create});return S}({environment:t,transaction:e,store:a,query:r,schema:i,geoPoint:o,isFullScreen:l,groupFormat:void 0,collectionContextStore:n,from:d});S().v(t,{from:d,type:"page",new_page_id:null==p?void 0:p.id,creating_block_id:null==p?void 0:p.id,...(0,x().sl)(n)})}})}var w=o(474848);function _(e){const{collectionContextStore:t,query:o,paddingLeft:c,paddingRight:u,format:d,renderGroupResults:m,schema:g,store:S}=e,f=(0,l().v3)(),y=(0,p().A)(!0),v=(0,i.useRef)(null),h=(0,a().K8)((()=>{var e;const n=(null==t||null===(e=t.groupsStore.getGroupState([]))||void 0===e?void 0:e.resultsStore.state)||[],r=o.map_by;return r?n.map((e=>{const t=r?e.getProperties()[r]:void 0;return(0,s().w)(t)})):[]}),[t,o.map_by]);(0,i.useEffect)((()=>{const e=h.reduce((function(e,t){return t?e.extend(t):e}),new(r().LngLatBounds));var t;e.isEmpty()||(null===(t=v.current)||void 0===t||t.getMap().fitBounds(e))}));const C=(0,i.useCallback)((e=>{const n={lat:e.lngLat.lat,lon:e.lngLat.lng};k({environment:f,geoPoint:n,collectionContextStore:t,query:o,schema:g,isFullScreen:t.isFullScreenStore.state,store:S})}),[f,t,o,g,S]);return(0,w.jsx)("div",{style:{paddingLeft:c,paddingRight:u,height:400},...y,children:(0,w.jsx)(n().T5,{ref:v,initialViewState:{longitude:-100,latitude:40,zoom:3.5},onClick:C,style:{width:"100%",height:"100%",display:"flex"},mapStyle:"https://tiles.openfreemap.org/styles/liberty",children:m({disabled:!1,canDrag:!1,canDrop:!1,collectionContextStore:t,format:d,groupsPointer:[],shouldShowHoverMenu:!1,resultProps:{mapByProperty:o.map_by,disabled:!1,environment:f,collectionContextStore:t},resultComponent:M,emptyDroppableSize:0,analyticsName:"map"})})})}function M(e){const{mapByProperty:t,store:o,handleOpenPeekPage:r,environment:i,collectionContextStore:p}=e,S=(0,l().Y0)().isMobile,{geoPoint:f,title:y,url:v,peekUrl:h}=(0,a().K8)((()=>{const e=t?o.getProperties()[t]:void 0,n=o.getProperties().title,r=m().default.state.mainEditorCurrentBlockStore;return{geoPoint:(0,s().w)(e),title:n,url:(0,d().J8)({store:o,fullyQualified:!1,pageVisitSource:c().y8.LinkInPage}),peekUrl:(0,u().wy)({environment:i,store:o,mainEditorCurrentBlockStore:r,collectionContextStore:p,fullyQualified:!1})}}),[t,o,i,p]);return f?(0,w.jsx)(n().pH,{longitude:f.lon,latitude:f.lat,anchor:"bottom",children:(0,w.jsx)("div",{style:{backgroundColor:"white",borderRadius:"4px"},children:(0,w.jsx)(g().A,{onClick:e=>{r(),e.stopPropagation()},href:v,metaHref:S?v:h,children:y})})},null==y?void 0:y.toString()):null}},585849:(e,t,o)=>{o.d(t,{n:()=>i,w:()=>r});var n=()=>o(919709);function r(e){if(!e)return;const t=n().RQ(e),o=n().uPN(t[0])[0];if(!o||!n().zpJ(o))return;const r=o[1];return{lat:r.lat,lon:r.lon}}function i(e){if(!e)return[];const t=n().bxH(e);return[n().wmz(t)]}}}]);