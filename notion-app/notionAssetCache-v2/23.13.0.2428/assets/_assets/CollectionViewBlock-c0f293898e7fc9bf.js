"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[943,71204],{94778:(e,t,o)=>{o.d(t,{A:()=>S});o(296540);var n=()=>o(484714),r=()=>o(56366),i=()=>o(401497),l=()=>o(575157),s=()=>o(959013),a=()=>o(154017),c=()=>o(317909),d=()=>o(760217),u=()=>o(8980),p=()=>o(645873),m=()=>o(339034),g=o(474848);function S(e){const{collectionContextStore:t,onClose:o,focused:S,isCompact:h}=e,f=(0,n().v3)(),{value:v}=(0,p().fJ)(m().formsEditorDependency),y=(0,i().IS)((e=>({newFormButton:{color:e.mediumTextColor,display:"flex",flexDirection:"row"}})),[]),x=(0,r().K8)((()=>{var e;return(null===(e=t.collectionViewBlockStore())||void 0===e||null===(e=e.inMemoryRecordCache)||void 0===e?void 0:e.isTemporaryData)??!1}),[t]);function C(){c().createAndCommit({userAction:"CollectionViewTabBar.createGenericViewType",environment:f,canUndo:!0,skipDefaultPostPerformValidationChecks:x,perform:e=>{v&&v.formEditorActions.createAndFocusCollectionFormEditorView({environment:f,collectionContextStore:t,transaction:e})}}),o(),(0,a().b)({environment:f,collectionContextStore:t,view_type:"form_editor"})}if(!v)return null;const b=(0,g.jsx)(d().A,{focused:S,onClick:C,title:(0,g.jsx)("div",{style:y.newFormButton,children:(0,g.jsx)(s().sA,{defaultMessage:"New form",id:"database.collectionViewSelect.newFormButtonTitle"})}),style:{padding:"1 0"},icon:(0,g.jsx)(u().I,{icon:l().D,color:"secondary"})}),w=(0,g.jsx)(d().A,{focused:S,onClick:C,title:(0,g.jsx)("div",{style:{display:"flex",flexDirection:"row"},children:(0,g.jsx)(s().sA,{defaultMessage:"Form",id:"CollectionViewTabBar.newFormItem.title"})}),icon:(0,g.jsx)(u().I,{icon:l().D}),shouldWrapCaption:!0,caption:(0,g.jsx)(s().sA,{defaultMessage:"Create a form to input data directly into this database",id:"CollectionViewTabBar.newFormItem.description"})});return h?b:w}},97059:(e,t,o)=>{o.d(t,{W:()=>S,w:()=>g});o(944114);var n=()=>o(585515),r=()=>o(577449),i=()=>o(161479),l=()=>o(545285),s=()=>o(763824),a=()=>o(780054),c=()=>o(870618),d=()=>o(670631),u=()=>o(227440),p=()=>o(508496),m=()=>o(540758);async function g(e){const{environment:t}=e;return(await s().lX(Object.keys(d().A.state.offlinePages||{}),100,(e=>async function(e){const{environment:t,pageId:o}=e,s={page:{id:o,spaceId:(0,i().e)(void 0)},limit:1/0,cursor:{stack:[]},verticalColumns:!1},d=[];return await n().T({...s,baseUrl:a().A.domainBaseUrl,publicDomainName:a().A.publicDomainName,shouldTraverseToggleBlocks:!0},r().h.sideEffect((e=>((0,l().u)(e)&&d.push(e.id),Promise.resolve())),r().h.fromMonomorphicFunctionUnsafe((async e=>{const o=await c().h7({environment:t,pointer:e,useInMemoryCacheOnly:!1,skipAccessWrites:!0});return null==o?void 0:o.model})))),d}({environment:t,pageId:e})))).flat()}function S(e,t){return!u().A.state.online&&(e.device.isElectron||e.device.isMobileNative)&&p().default.checkGate({gateName:"download_for_offline"})&&!(0,m().B)(t)}},99600:(e,t,o)=>{o.d(t,{A:()=>T});var n=o(296540),r=()=>o(484714),i=()=>o(56366),l=()=>o(401497),s=()=>o(449552),a=()=>o(340498),c=o(474848);const d=(0,a().wt)("mobileLocked",{viewBox:"0 0 26 26",svg:(0,c.jsx)("path",{d:"M7.88672 23.417H18.1133C19.499 23.417 20.1758 22.7295 20.1758 21.2256V13.3408C20.1758 11.9873 19.6172 11.2891 18.4678 11.1709V8.46387C18.4678 4.41406 15.8145 2.45898 13 2.45898C10.1855 2.45898 7.53223 4.41406 7.53223 8.46387V11.2246C6.47949 11.3857 5.82422 12.0732 5.82422 13.3408V21.2256C5.82422 22.7295 6.50098 23.417 7.88672 23.417ZM9.26172 8.23828C9.26172 5.54199 10.9912 4.11328 13 4.11328C15.0088 4.11328 16.7383 5.54199 16.7383 8.23828V11.1602L9.26172 11.1709V8.23828Z"})}),u=(0,a().wt)("mobileUnlocked",{viewBox:"0 0 32 26",svg:(0,c.jsx)("path",{d:"M7.89355 23.417H18.1094C19.4951 23.417 20.1826 22.7295 20.1826 21.2256V13.3408C20.1826 12.0303 19.6562 11.332 18.582 11.1816V8.23828C18.582 5.54199 20.3115 4.11328 22.3203 4.11328C24.3291 4.11328 26.0586 5.54199 26.0586 8.23828V10.623C26.0586 11.2783 26.4346 11.6006 26.9287 11.6006C27.4014 11.6006 27.7881 11.3105 27.7881 10.623V8.46387C27.7881 4.41406 25.1348 2.45898 22.3203 2.45898C19.5059 2.45898 16.8525 4.41406 16.8525 8.46387V11.1602L8.1084 11.1816C6.72266 11.1816 5.82031 11.8584 5.82031 13.3408V21.2256C5.82031 22.7295 6.50781 23.417 7.89355 23.417Z"})}),p=(0,a().wt)("unlockedFilled",{viewBox:"0 0 16 16",svg:(0,c.jsx)("path",{d:"M2.33301 14.6338H8.94336C9.85938 14.6338 10.3105 14.1826 10.3105 13.1914V8.08496C10.3105 7.2168 9.95508 6.75195 9.24414 6.65625V4.83105C9.24414 3.22461 10.2627 2.35645 11.4863 2.35645C12.71 2.35645 13.7354 3.22461 13.7354 4.83105V6.28711C13.7354 6.76562 14.0156 7.01855 14.3848 7.01855C14.7471 7.01855 15.0273 6.7793 15.0273 6.28711V4.96094C15.0273 2.36328 13.2979 1.1123 11.4863 1.1123C9.6748 1.1123 7.94531 2.36328 7.94531 4.96094V6.64258L2.44922 6.64941C1.5332 6.64941 0.96582 7.10742 0.96582 8.08496V13.1914C0.96582 14.1826 1.41699 14.6338 2.33301 14.6338Z"})});var m=()=>o(798880),g=()=>o(695608),S=()=>o(959013),h=()=>o(989423);function f(e,t){h().vd(e,"edit_lock_toggle",t)}var v=()=>o(896628),y=()=>o(317909),x=()=>o(712505),C=()=>o(630116),b=()=>o(704152),w=()=>o(859428),k=()=>o(198688);const T=function(e){let{store:t,disableTooltip:n,hideText:l,isInlineCollection:s,buttonStyle:a,lockStore:d}=e;const{isMobile:u}=(0,r().Y0)(),p=(0,i().uB)(d,o(455425).A);return u?(0,c.jsx)(_,{store:t,lockStore:p,hideText:l}):(0,c.jsx)(B,{store:t,disableTooltip:n,hideText:l,isMobile:u,isInlineCollection:s,buttonStyle:a,lockStore:p})};function I(e,t,o){return{display:"flex",alignItems:"center",whiteSpace:"nowrap",fontSize:e?12:14,borderRadius:4,padding:"0 6px",marginRight:2,height:24,marginTop:e?1:0,marginLeft:e?0:-5,...t&&{marginLeft:e?8:12,marginRight:0},...o}}function R(e,t,o,n,r){return{...I(e,n,r),color:o.lightTextColor,fill:o.lightIconColor}}function j(e,t,o,n,r){return{...I(e,n,r),paddingLeft:5,border:`1px solid ${o.blueColor}`,color:o.blueColor,fill:o.blueColor}}function A(e){let{store:t}=e;const o=(0,l().DP)(),n=(0,i().K8)((()=>t.getFormat().block_locked_by),[t]),r=(0,S().tz)(),s=(0,i().K8)((()=>n&&(0,g().c6)(r,C().sk.createChildStore(t,{table:m().oo,id:n}).getModel())),[n,r,t]);return n?(0,c.jsx)("div",{children:(0,c.jsx)(S().sA,{defaultMessage:"Locked by {lockedByPerson}{br}to prevent accidental editing.{br}<prompttext>Click to unlock</prompttext>",id:"pageLockIndicator.lockedTooltip",values:{lockedByPerson:(0,c.jsx)("b",{children:s}),br:(0,c.jsx)("br",{}),prompttext:e=>(0,c.jsx)("span",{style:{color:o.text.contrastSecondary},children:e})}})}):null}function P(e,t,o){y().createAndCommit({userAction:"PageLockTopbarIndicator.handleLockClick",environment:e,canUndo:!0,perform:o=>{v()._l({environment:e,store:t,isLocked:!1,transaction:o})}}),o.setState({...o.state,justUnlocked:!0});const n=t.getType();if(n){var r;let o;t.isCollectionView()&&(o=t.getCollectionStore()),f(e,{from:"topbar",block_type:n,locked:!1,collection_id:null===(r=o)||void 0===r?void 0:r.id})}}function M(e,t,o){y().createAndCommit({userAction:"PageLockTopbarIndicator.handleUnlockClick",environment:e,canUndo:!0,perform:o=>{v()._l({environment:e,store:t,isLocked:!0,transaction:o})}}),o.setState({...o.state,justUnlocked:!1});const n=t.getType();if(n){var r;let o;t.isCollectionView()&&(o=t.getCollectionStore()),f(e,{from:"topbar",block_type:n,locked:!0,collection_id:null===(r=o)||void 0===r?void 0:r.id})}}function B(e){let{store:t,disableTooltip:o,hideText:a,isMobile:d,isInlineCollection:u,buttonStyle:m,lockStore:g}=e;const h=(0,l().DP)(),f=(0,r().v3)(),v=(0,n.useCallback)((()=>M(f,t,g)),[f,t,g]),y=(0,n.useCallback)((()=>P(f,t,g)),[f,t,g]),C=(0,i().K8)((()=>t.isLocked()),[t]),T=(0,i().K8)((()=>g.state.justUnlocked),[g]),I=(0,i().K8)((()=>x().default.state.open&&x().default.state.targetStore.id===t.id),[t.id]);return C?(0,c.jsx)(w().A,{renderTooltip:()=>(0,c.jsx)(A,{store:t}),disableTooltip:o,render:e=>(0,c.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[I&&(0,c.jsx)(k().A,{}),(0,c.jsxs)(b().A,{style:R(d,0,h,u,m),onClick:y,...e,children:[(0,s().g)({width:16,marginRight:a?void 0:4}),!a&&(0,c.jsx)("div",{style:{lineHeight:1},children:(0,c.jsx)(S().sA,{defaultMessage:"Locked",id:"pageLockIndicator.lockedButton.label"})})]})]})}):T?(0,c.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,c.jsx)(k().A,{}),(0,c.jsxs)(b().A,{style:j(d,0,h,u,m),onClick:v,hoveredStyle:{background:h.outlineBlueButtonHoveredBackground},pressedStyle:{background:h.outlineBlueButtonPressedBackground},children:[p({width:16,marginRight:a?void 0:4}),!a&&(0,c.jsx)("div",{style:{lineHeight:1},children:(0,c.jsx)(S().sA,{defaultMessage:"Re-lock",id:"pageLockIndicator.relockButton.label"})})]})]}):null}function _(e){let{store:t,lockStore:o,hideText:s}=e;const a=(0,l().DP)(),p=(0,r().v3)(),m=(0,n.useCallback)((()=>M(p,t,o)),[p,t,o]),g=(0,n.useCallback)((()=>P(p,t,o)),[p,t,o]),h=(0,i().K8)((()=>t.isLocked()),[t]),{WindowSizeStore:f}=p,v=(0,i().K8)((()=>f.getSafePaddingLeftCSS(10)),[f]),y=(0,i().K8)((()=>f.getSafePaddingRightCSS(14)),[f]),x=(0,i().K8)((()=>o.state.justUnlocked),[o]);return h?(0,c.jsxs)(b().A,{onClick:g,mobileFeedback:!0,style:{display:"flex",alignItems:"center",height:"100%",paddingLeft:v,paddingRight:y},children:[d({width:20,marginRight:6}),!s&&(0,c.jsx)("div",{children:(0,c.jsx)(S().sA,{defaultMessage:"Locked",id:"pageLockIndicator.mobileLockedButton.label"})})]}):x?(0,c.jsxs)(b().A,{onClick:m,mobileFeedback:!0,style:{display:"flex",alignItems:"center",width:"100%",height:"100%",paddingLeft:v,paddingRight:y,color:a.blueColor,fill:a.blueColor},children:[u({height:26,width:32,marginRight:6}),!s&&(0,c.jsx)("div",{children:(0,c.jsx)(S().sA,{defaultMessage:"Re-lock",id:"pageLockIndicator.mobileRelockButton.label"})})]}):null}},105819:(e,t,o)=>{o.d(t,{x:()=>r});o(296540);const n={viewBox:"0 0 20 20",svg:(0,o(474848).jsx)("path",{d:"m13.987 5.682-.684.684-1.288-1.288.692-.691a.91.91 0 0 1 1.28 0c.35.35.35.93 0 1.28zm-9.433 9.433 7.914-7.914-1.289-1.289-7.92 7.908c-.122.122-.214.29-.274.457l-.336 1.082c-.06.229.153.442.366.366l1.082-.335q.252-.07.457-.275m12.446.76H5.61l1.25-1.25H17a.625.625 0 1 1 0 1.25"})},r=(0,o(340498).wt)("pencilLine",n)},114641:(e,t,o)=>{o.d(t,{H:()=>r});var n=()=>o(989423);function r(e){const{collectionContextStore:t,environment:o,incrementLimitArgs:r}=e;t.groupsStore.incrementLimit(e.incrementLimitArgs),t.loadingDetailsStore.setState({type:"load_more_blocks",group:r.groupsPointer}),n().vd(o,"collection_load_more_blocks")}},124311:(e,t,o)=>{o.d(t,{K:()=>r});var n=()=>o(989423);function r(e){n().vd(e,"inline_collection_load_more_click")}},170356:(e,t,o)=>{o.d(t,{NS:()=>u,Pq:()=>g,Z3:()=>d,sw:()=>p});o(296540);var n=()=>o(484714),r=()=>o(297872),i=()=>o(928600),l=()=>o(678553),s=()=>o(45552),a=()=>o(722872),c=o(474848);const d=8,u=8,p=32,m={height:p+d-2,paddingTop:d-2};function g(e){let{title:t,helpButton:o,onCancel:l,desktopMinWidth:d,desktopMaxWidth:u,desktopWidth:p,children:m}=e;const{device:g}=(0,n().v3)();return(0,c.jsx)(r().A,{capture:!0,allowEsc:!0,allowUndo:!0,render:e=>{let n;return n=g.isMobile?{menuType:a().gu.Modal,title:t,right:(0,c.jsx)(s().DoneMenuText,{}),onClickRight:l,...e}:{menuType:a().gu.Popup,...d&&{minWidth:d},...u&&{maxWidth:u},...p&&{width:p},...e},(0,c.jsx)(i().A,{...n,header:t&&(0,c.jsx)(S,{title:t,helpButton:o}),children:m})}})}function S(e){let{title:t,helpButton:o}=e;return(0,n().v3)().device.isMobile?null:(0,c.jsx)(l().A,{style:m,title:t,right:o})}},198688:(e,t,o)=>{o.d(t,{A:()=>r});o(296540);var n=o(474848);const r=function(){const e=(0,o(401497).IS)((e=>({separator:{height:14,width:1,marginLeft:6,marginRight:6,background:e.darkDividerColor}})),[]);return(0,n.jsx)("div",{style:e.separator})}},285176:(e,t,o)=>{o.d(t,{o:()=>s});o(296540);var n=()=>o(401497),r=()=>o(133033),i=()=>o(959013),l=o(474848);function s(e){const{href:t,style:o}=e,s=(0,n().IS)((e=>({default:{display:"flex",marginTop:7,marginBottom:7,alignItems:"center",cursor:"pointer",textDecoration:"none",pointerEvents:"auto",width:"fit-content",color:e.mediumTextColor}})),[]);return(0,l.jsxs)("a",{href:t,target:"_blank",style:{...s.default,...o},children:[(0,r().$)({width:14,marginRight:4}),(0,l.jsx)(i().sA,{id:"LearnMoreLink.learnMore",defaultMessage:"Learn more"})]})}},286993:(e,t,o)=>{o.d(t,{c:()=>c});o(581454),o(296540);var n=()=>o(56366),r=()=>o(496603),i=()=>o(812119),l=()=>o(175116),s=()=>o(62856),a=o(474848);function c(e){const{isFullScreen:t,hasGroups:o,hasPartialResults:c,hasSearchQuery:d,overrideNumShimmerRows:u}=e,p=(0,l().Ks)(),m=(0,n().K8)((()=>null==p?void 0:p.isInHomeWidgetStore.state),[p]);if(!(0,s().A)(!0,0,100))return null;let g=1;void 0!==u?g=u:o||c||d||(g=t?10:3);const S=g>1?["50%","30%","40%","40%","30%","30%","40%","40%","30%","30%"]:["35%"],h=r().Hn(g).map((e=>(0,a.jsx)(i().J,{isInHomeWidget:m,widthPercentage:e<S.length?S[e]:void 0},e)));return(0,a.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch",marginLeft:m?8:3},children:h})}},299177:(e,t,o)=>{o.d(t,{A:()=>i});class n extends(()=>o(757695))().default{getInitialState(){return{}}}const r=new n;o(604341).exposeDebugValue("SpaceWorkflowTemplateInstanceMapStore",r);const i=r},316369:(e,t,o)=>{o.d(t,{w:()=>b});o(581454),o(296540);var n=()=>o(484714),r=()=>o(651124),i=()=>o(30626),l=()=>o(959013),s=()=>o(496603),a=()=>o(436696),c=()=>o(896628),d=()=>o(317909),u=()=>o(722872),p=()=>o(963589),m=()=>o(760217),g=()=>o(406699),S=()=>o(285790),h=()=>o(928600),f=()=>o(939740),v=()=>o(14235),y=()=>o(89924),x=o(474848);const C=(0,l().j4)((function(e){const{limit:t}=e;return(0,x.jsx)(l().sA,{defaultMessage:"{limit} pages",values:{limit:t.limit},id:"database.FirstLoadLimitSelectOption.limitPagesTitle"})}));function b(e){let{format:t,collectionContextStore:o}=e;const r=(0,n().v3)(),{device:l}=r,s=(0,p().X)("collection_mobile_load_limits");return l.isMobile&&s?null:(0,x.jsx)(g().Ay,{popupType:v().nl.Popup,renderOrigin:e=>(0,x.jsx)(S().A,{icon:i()._,style:{marginLeft:4,marginRight:4},...e}),alignmentToOrigin:g().yP.End,placementToOrigin:g().sx.Bottom,originGap:8,render:e=>(0,x.jsx)(k,{currentLimit:w(t),onAccept:e=>function(e,t,o){const n=t.collectionViewStore();if(!n)return;if(!n.getType())return;d().createAndCommit({userAction:"FirstLoadLimitActionButton.handleFirstLoadLimitAccept",environment:o,canUndo:!0,perform:t=>{c().zA({stores:[n],update:{inline_collection_first_load_limit:e},transaction:t})}}),t.groupsStore.resetAllLimits(),(0,a().X)({environment:o,collectionContextStore:t,action:"set_first_load_limit"})}(e,o,r),onClose:e.close,showTitle:!0})})}function w(e){return(0,r().i3)(e.inline_collection_first_load_limit,Boolean(e.collection_group_by))}function k(e){const t=(0,n().v3)(),{device:o}=t,{currentLimit:i,onAccept:a,onClose:c,showTitle:d}=e,p=(0,s().oE)(r().X9.map(((e,t)=>{const o={key:t,render:t=>(0,x.jsx)(m().A,{...t,disabled:!1,title:(0,x.jsx)(C,{limit:e}),checkState:(0,s().n4)(i,e)}),action:()=>a(e)};return o}))),g=[{key:0,render:e=>(0,x.jsx)(y().A,{enableActionSheetTitle:!0,title:d&&(0,x.jsx)(l().sA,{defaultMessage:"Show on first load",id:"database.firstLoadLimitSelectMenu.firstLoadLimitSetting"}),...e}),items:p}];let S;return S=o.isMobile?{menuType:u().gu.ActionSheet}:{menuType:u().gu.Popup,width:200},(0,x.jsx)(h().A,{...S,children:(0,x.jsx)(f().Ay,{type:f().Oh.Vertical,sections:g,onAccept:c,initialFocus:void 0})})}},319357:(e,t,o)=>{o.d(t,{O:()=>a});o(296540);var n=()=>o(484714),r=()=>o(430923),i=()=>o(406699),l=()=>o(962730),s=o(474848);function a(e){let{collectionContextStore:t,groupFormat:o,renderLinkButton:a,onAddOrLink:c,...d}=e;const u=(0,n().Y0)();return(0,s.jsx)(i().Ay,{popupType:u.isMobile?i().z7.BottomSheet:i().z7.Popup,alignmentToOrigin:l().C.Start,disableFlippingPlacement:!0,...d,renderOrigin:a,render:e=>(0,s.jsx)(r().l7,{collectionContextStore:t,groupFormat:o,onClose:()=>e.close(),onAddOrLink:c})})}},320260:(e,t,o)=>{o.d(t,{y:()=>p});var n=o(296540),r=()=>o(401497),i=()=>o(381828),l=()=>o(644187),s=()=>o(720665),a=()=>o(645873);const c=new(a().O2)("notionCalendarIcons",(async()=>o.e(23537).then(o.bind(o,531783)))),d=new(a().O2)("notionCalendarIconsRefresh",(async()=>o.e(39850).then(o.bind(o,91160))));var u=()=>o(963589);function p(e){const t=(0,u().X)("app_switcher_icon_refresh"),o=(0,a().fJ)(c),p=(0,a().fJ)(d),m=function(){const[e,t]=(0,n.useState)(new Date),o=(0,n.useRef)();return(0,n.useEffect)((()=>{const n=()=>{const o=new Date;o.getDate()!==e.getDate()&&t(o)},r=new Date,i=new Date(r);i.setHours(r.getHours()+1),i.setMinutes(0),i.setSeconds(0),i.setMilliseconds(0);const l=i.getTime()-r.getTime(),a=setTimeout((()=>{n(),o.current=window.setInterval(n,s().pT)}),l);return()=>{clearTimeout(a),clearInterval(o.current)}}),[e]),e}(),g=e.dateNumber??m.getDate(),S=(0,r().IS)((t=>({icon:{width:16,height:16,color:t.mediumIconColor,...e.style}})),[e.style]),h=(0,n.useCallback)((e=>{const n=t?l().K:i().K;if(e<1||e>31)return n(S.icon);const r=`calendarDate${e<10?`0${e}`:`${e}`}Icon`;if(t){if("resolved"!==p.status)return n(S.icon);return(0,p.value[r])(S.icon)}if("resolved"!==o.status)return n(S.icon);return(0,o.value[r])(S.icon)}),[S,o,p,t]);return h(g)}},338931:(e,t,o)=>{o.d(t,{Gj:()=>r,RN:()=>s,vZ:()=>i});o(944114),o(898992),o(823215),o(354520),o(672577);var n=()=>o(244641);function r(e){const t=n().c9.fromMillis(e.startUnixTimestampMS),o=e.endUnixTimestampMS?n().c9.fromMillis(e.endUnixTimestampMS):void 0,r=n().c9.fromMillis(e.startOfWeekUnixTimestampMS),i=n().c9.fromMillis(e.endOfWeekUnixTimestampMS),l=t.startOf("day"),s=n().c9.max(r,l),a=Math.ceil(s.diff(r,"days").get("days"));let c=1;if(o){const e=o.endOf("day"),t=n().c9.min(i,e);c=Math.ceil(t.diff(s,"days").get("days"))}return{start:t,end:o,startOfWeek:r,endOfWeek:i,startColumn:a,columnCount:c}}function i(e){const t=(e.attendees||[]).filter((e=>!e.self&&!e.resource));return e.hasParticipants&&t.length>0&&t.every((e=>"declined"===e.responseStatus))}const l={upcomingMinsThreshold:10,startingMinsThreshold:5,startedMinsThreshold:15};function s(e){const t=e.filter((e=>{var t;if(!e.conferencing)return!1;return!function(e){if("declined"===e)return!0;return!1}((null===(t=e.attendees)||void 0===t?void 0:t.find((e=>e.self)))?e.responseStatus??"accepted":"accepted")&&!e.isAllDay}));if(0===t.length)return;const{upcomingMinsThreshold:o,startingMinsThreshold:r,startedMinsThreshold:i}=l,s=[],c=[],d=[],u=[],p=[];for(const l of t){if(l.isAllDay)continue;const e=a(l),t=n().c9.now(),m=e.start.diff(t,"minutes").minutes;m>=0&&m<=o?s.push(l):-m>=r?d.push(l):-m>=i?u.push(l):e.contains(t)?c.push(l):p.push(l)}return[...s,...d,...u,...c,...p][0]}function a(e){const t=n().c9.fromISO(e.start.dateTime,{zone:e.start.timeZone}),o=n().c9.fromISO(e.end.dateTime,{zone:e.end.timeZone});return n().IX.fromDateTimes(t,o)}},344417:(e,t,o)=>{o.d(t,{u:()=>r});o(296540);const n={viewBox:"0 0 16 16",svg:(0,o(474848).jsx)("path",{d:"M7.1 1.975a5.125 5.125 0 1 0 3.155 9.164l3.107 3.107a.625.625 0 1 0 .884-.884l-3.107-3.107A5.125 5.125 0 0 0 7.1 1.975M3.225 7.1a3.875 3.875 0 1 1 7.75 0 3.875 3.875 0 0 1-7.75 0"})},r=(0,o(340498).wt)("magnifyingGlassSmall",n)},371948:(e,t,o)=>{o.r(t),o.d(t,{CollectionViewBlockErrorBoundary:()=>Jh,CollectionViewBlockWithErrorBoundary:()=>ef});var n=o(296540),r=(o(898992),o(581454),o(908872),o(737550),()=>o(244641)),i=()=>o(17022),l=()=>o(908006),s=()=>o(484714),a=()=>o(852507),c=()=>o(118884),d=()=>o(56366),u=()=>o(401497),p=()=>o(757695),m=()=>o(107041),g=()=>o(340498),S=o(474848);const h=(0,g().wt)("shippingBox",{viewBox:"0 0 37 36",svg:(0,S.jsx)("path",{d:"M4.91749 27.6943C4.20931 27.2881 3.66776 26.8193 3.29285 26.2881C2.91793 25.7568 2.73047 24.9339 2.73047 23.8193V11.4443C2.73047 10.6318 2.88148 9.95996 3.1835 9.42871C3.49593 8.88704 3.9854 8.42871 4.65192 8.05371L15.6964 1.77246C16.6441 1.23079 17.5814 0.959961 18.5083 0.959961C19.4352 0.959961 20.3672 1.23079 21.3045 1.77246L32.3646 8.05371C33.0207 8.42871 33.4998 8.88704 33.8018 9.42871C34.1143 9.95996 34.2705 10.6318 34.2705 11.4443V23.8193C34.2705 24.9339 34.083 25.7568 33.7081 26.2881C33.3436 26.8193 32.802 27.2881 32.0834 27.6943L19.8049 34.6631C19.3571 34.9131 18.9196 35.0381 18.4927 35.0381C18.0761 35.0381 17.6491 34.9131 17.2117 34.6631L4.91749 27.6943ZM6.32344 25.6318L17.2742 31.8662V18.8975L5.10495 11.9443V23.7412C5.10495 24.1683 5.19347 24.5277 5.37052 24.8193C5.54756 25.111 5.8652 25.3818 6.32344 25.6318ZM30.6931 25.6318C31.1409 25.3818 31.4534 25.111 31.6304 24.8193C31.8075 24.5277 31.896 24.1683 31.896 23.7412V11.9443L19.7268 18.8975V31.8662L30.6931 25.6318ZM18.5083 16.71L23.3354 13.9756L11.2755 7.11621L6.44841 9.88184L18.5083 16.71ZM25.8504 12.5537L30.5682 9.88184L20.2735 4.00684C19.1071 3.32975 17.9303 3.32975 16.743 4.00684L13.7437 5.70996L25.8504 12.5537Z"})});var f=()=>o(763884),v=()=>o(921997),y=()=>o(558842),x=()=>o(869558),C=()=>o(496603),b=()=>o(534177),w=()=>o(284371),k=()=>o(959013),T=()=>o(436696),I=()=>o(686526),R=()=>o(557281),j=()=>o(661920),A=()=>o(257615),P=()=>o(778417),M=()=>o(725614),B=()=>o(317909),_=()=>o(450510),V=()=>o(928530),F=(o(672577),()=>o(493260)),L=()=>o(519839),O=()=>o(760077);o(18107),o(967357),o(803949);var E=()=>o(179034),D=()=>o(741496),z=()=>o(388821),K=()=>o(951177);const H=new(o(178624).R)({key:"notion/async_clipboard_store",namespace:"AsyncClipboardStore",important:!0,trackingType:"necessary"});async function G(e,t){let{lastActionWasCut:o,valuePromise:n}=t;const r=(0,K().hB)(e);H.setState({eventId:r,waitingForCopy:!0,lastActionWasCut:void 0,value:void 0});const i=await n;if(!i)return void H.setState({});const{recordMaps:l,...s}=i;H.setState({eventId:r,waitingForCopy:!1,lastActionWasCut:o,value:{...s,recordMapsJson:$(l)}})}function W(e){const t=H.getState(),o=(0,K().hB)(e);if(!t||!o||t.eventId!==o)return Promise.resolve(void 0);const{waitingForCopy:n,value:r,lastActionWasCut:i}=t;return n?new Promise((e=>{H.addListener(function(e,t){return function o(n){const r=n.getState();if(!r)return void n.removeListener(o);const{waitingForCopy:i,value:l,lastActionWasCut:s}=r;i||r.eventId!==e||(n.removeListener(o),t(l?{lastActionWasCut:s||!1,value:{...l,recordMaps:N(l.recordMapsJson)}}:void 0))}}(o,e))})):r?Promise.resolve({lastActionWasCut:i||!1,value:{...r,recordMaps:N(r.recordMapsJson)}}):Promise.resolve(void 0)}function N(e){return new Map(e.map((e=>{let[t,o]=e;return[t,z().RecordMap.create(o)]})))}function $(e){return[...e.entries()].map((e=>{let[t,o]=e;return[t,o.toJson()]}))}var U=()=>o(884107),q=()=>o(60867),Y=()=>o(899453),X=()=>o(797265),Q=()=>o(545805),Z=()=>o(175116),J=()=>o(659602),ee=()=>o(335722),te=()=>o(405417),oe=()=>o(504836),ne=()=>o(645873),re=()=>o(630116),ie=()=>o(502438),le=()=>o(24157);const se=n.memo((function(){const e=(0,s().v3)(),t=(0,Z().ET)(),{value:r}=(0,ne().fJ)(J().g),{value:i}=(0,ne().fJ)(ee().S),a=(0,d().K8)((()=>{var e;return null===(e=t.collectionStore())||void 0===e?void 0:e.id}),[t]),c=(0,d().K8)((()=>{if(le().default.isEditingStore.state)return!1;const e=ie().default.state.stores.at(0),t=null==e?void 0:e.getModel();if(void 0===e||void 0===t)return!1;if(void 0===(0,te().oC)(e))return!1;const n=(0,o(236162).zN)({block:t,getRecordModel:e.getRecordModel});return void 0!==n&&n.id===a}),[a]),u=n.useCallback((async o=>{(await U().R.clipboardActions.load()).copy({event:o,environment:e,markdownLinkifyIt:r});const n=ie().default.state.stores;G(o,{lastActionWasCut:!1,valuePromise:ae(e).then((o=>{const{result:r,status:i}=o;if("failed"===i)return;for(const n of r){var l;(0,D().N)(e,{analyticsName:"Copy",from:"keyboard_shortcut",block_id:n.id,block_type:n.getType(),isBulk:!0,collection_id:null===(l=t.collectionStore())||void 0===l?void 0:l.id})}const s=r.length>0;for(const c of n){var a;(0,D().N)(e,{analyticsName:"Copy",from:"keyboard_shortcut",block_id:c.id,block_type:c.getType(),isBulk:s,collection_id:null===(a=t.collectionStore())||void 0===a?void 0:a.id})}return ce({environment:e,subitems:r})}))})}),[t,e,r]),p=n.useCallback((async o=>{(await U().R.clipboardActions.load()).copy({event:o,environment:e,markdownLinkifyIt:r});const n=t.collectionStore();if(null!=n&&n.isExternallyImportedAndSyncedCollection()&&(0,oe().pB)())return;const i=ie().default.state.stores,l=ae(e),s=ae(e).then((t=>{const{result:o,status:n}=t;if("failed"===n)return;for(const i of o)(0,D().N)(e,{analyticsName:"Cut",from:"keyboard_shortcut",block_id:i.id,block_type:i.getType(),isBulk:!0,collection_id:a});const r=o.length>0;for(const l of i)(0,D().N)(e,{analyticsName:"Cut",from:"keyboard_shortcut",block_id:l.id,block_type:l.getType(),isBulk:r,collection_id:a});return ce({environment:e,subitems:o})}));await G(o,{lastActionWasCut:!0,valuePromise:s});const c=ie().default.getState().stores,d=(await l).result;await q().vX({blocks:c,subitems:d,environment:e,canUndo:!0,skipConfirmation:!0})}),[t,a,e,r]),m=n.useCallback((async n=>{var s,c,d,u;const p=await U().R.clipboardActions.load(),m=await W(n),g=await o(855801).VI.duplicateActions.load();if(H.setState({...H.getState(),lastActionWasCut:!1}),!m){B().createAndCommit({userAction:"CollectionViewKeyboardArea.defaultPaste",environment:e,canUndo:!0,perform:t=>{p.paste({environment:e,event:n,disableEmbedMenu:!0,transaction:t,onPasteFiles:p.pasteFilesForBlocks,formulasModule:void 0,markdownLinkifyIt:r,tinyMceMicrosoftWordPasteFilter:i})}});const t=ie().default.state.stores[0];if(void 0===t)return;return void(0,D().N)(e,{analyticsName:"Paste",from:"keyboard_shortcut",block_id:t.id,block_type:t.getType(),isBulk:!1,collection_id:a})}const S=t.collectionViewBlockStore();if(!S)return;const h=t.collectionStore();if(!h)return;if(h.isExternallyImportedAndSyncedCollection()&&(0,oe().pB)())return;const{recordMaps:f,subitemFormat:v,childRelationSchema:y,parentRelationSchema:x}=m.value;if(!(f&&v&&y&&x))return;const C=[...f.entries()].map((e=>{let[t]=e;return re().Bv.createChildStore(h,{table:E().ev,id:t})}));await Promise.all(C.map((e=>e.load())));const b=ie().default.getState().stores,w=!(m.lastActionWasCut&&function(e,t){const o=t.map((t=>re().Bv.createChildStore(e,t.pointer)));if(o.find((e=>!e.isReady)))return!1;return!o.find((e=>e.getAlive()))}(h,C));let k=[],T=te().n9(t),I=null===(s=T)||void 0===s?void 0:s.parentRelationProperty,R=null===(c=T)||void 0===c?void 0:c.childRelationSchema,j=null===(d=T)||void 0===d?void 0:d.parentRelationSchema,A=null===(u=T)||void 0===u?void 0:u.subitemFormat;const M=t.permissionScopesStore.state.canConfigureCollection;for(const t of C)(0,D().N)(e,{analyticsName:"Paste",from:"keyboard_shortcut",block_id:t.id,block_type:t.getType(),isBulk:m.value.isBulk,collection_id:a});if(B().createAndCommit({userAction:"CollectionViewKeyboardArea.pasteWithSubitems",environment:e,canUndo:!0,perform:o=>{if(!A&&M){q().VI({transaction:o,collectionContextStore:t,environment:e})&&(T=te().n9(t),T&&(I=T.parentRelationProperty,R=T.childRelationSchema,j=T.parentRelationSchema,A=T.subitemFormat))}if(!(I&&R&&j&&A))return void p.paste({environment:e,event:n,disableEmbedMenu:!0,transaction:o,onPasteFiles:p.pasteFilesForBlocks,formulasModule:void 0,markdownLinkifyIt:r,tinyMceMicrosoftWordPasteFilter:i});const l=w?q().B2({blocks:C,environment:e,transaction:o,recordMaps:f,migrateSubitemFormat:{from:v,to:A},collectionContextStore:t,originalSubitemSchemas:{subitemRelationSchema:y,parentRelationSchema:x},analyticsFrom:m.lastActionWasCut?"cut":"copy",duplicateActionsModule:g}):q().fA({blocks:C,transaction:o,from:v,to:A,environment:e,originAction:"paste"});!function(e){const{environment:t,selectedBlocks:o,blocksToInsert:n,subitemFormat:r,collectionContextStore:i,transaction:l}=e,s=i.collectionStore();if(!s)return;const a=o.at(-1),c=te().Px(n,r);if(0===c.length)return;if(a){const e=te().W5(i,a),o=function(e,t){if(e)return t;if(t.recordStoreUIParentStore instanceof re().Bv&&t.recordStoreUIParentStore.isPageBlock())return t.recordStoreUIParentStore}(Boolean(null==e?void 0:e.isExpanded),a);c.forEach((e=>{q().VT({environment:t,blockStore:e,collectionStore:s,subitemFormat:r,transaction:l}),o&&Y().j$({environment:t,sourceStore:e,destStore:o,propertyWithInverse:{property:r.inverse,inverse:r.property},transaction:l,position:{type:"after"}})}))}else c.forEach((e=>{q().VT({environment:t,blockStore:e,collectionStore:s,subitemFormat:r,transaction:l})}))}({environment:e,selectedBlocks:b,blocksToInsert:l,subitemFormat:A,collectionContextStore:t,transaction:o}),X().LE({environment:e,blocksToInsert:l,target:b,transaction:o,replaceEmptyTextBlock:!1,preventSetSelection:!0}),k=l}}),!(I&&R&&j&&A))return;const _=te().BK({blocks:k,parentRelationProperty:I,parentRelationSchema:j,collectionViewBlockStore:S});l().default.afterNextFlush((()=>{l().default.afterNextFlush((()=>{P().td({environment:e,stores:_})}))}))}),[t,a,e,r,i]);return(0,S.jsx)(Q().A,{debugName:`CollectionViewKeyboardArea-${a}`,capture:!0,priority:c?0:-1,onCopy:u,onCut:p,onPaste:m})}));function ae(e){const t=ie().default.getState().stores;return q().zM({environment:e,blocks:t})}function ce(e){let{subitems:t,environment:n}=e;const r=ie().default.getState().stores,i=r.at(0);if(!i)return;const l=(0,te().oC)(i);if(!l)return;const s=[...r,...t],a=C().oE(s.map((e=>{const t=o(71584).loadLocalSubtree(n,{blockId:e.id,inMemoryRecordCache:e.inMemoryRecordCache,allowCopyCollections:!0,requireFullSubtree:!1,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0}).recordMap;return t&&[e.id,t]}))),c=new Map(a),{subitemFormat:d,childRelationSchema:u,parentRelationSchema:p}=l;return{recordMaps:c,subitemFormat:d,childRelationSchema:u,parentRelationSchema:p,isBulk:t.length>0}}var de=()=>o(835066),ue=()=>o(106412),pe=()=>o(789550),me=()=>o(862292),ge=()=>o(989423),Se=()=>o(186445),he=()=>o(38337),fe=()=>o(476492),ve=()=>o(69447),ye=()=>o(638146),xe=()=>o(728611),Ce=()=>o(753199),be=()=>o(807054),we=()=>o(592678),ke=()=>o(478726),Te=()=>o(747100),Ie=()=>o(347320),Re=()=>o(953418),je=()=>o(891078),Ae=()=>o(963589),Pe=()=>o(406792),Me=()=>o(117296),Be=()=>o(696746),_e=()=>o(665579),Ve=()=>o(644914),Fe=()=>o(962730),Le=()=>o(351360),Oe=()=>o(463830),Ee=()=>o(661179),De=()=>o(441307),ze=()=>o(227440),Ke=()=>o(230062),He=()=>o(961581),Ge=()=>o(666803),We=()=>o(977390),Ne=()=>o(606932),$e=()=>o(865241),Ue=()=>o(712505),qe=()=>o(472090),Ye=()=>o(611371),Xe=()=>o(563615),Qe=()=>o(845094),Ze=()=>o(632905),Je=()=>o(671593),et=()=>o(666144);async function tt(e){const{environment:t,collectionContextStore:o,blockIdToMinimumVersion:n}=e;await async function(e,t){return await Promise.all((0,b().WP)(t).map((async t=>{let[o,n]=t;return et().sy({environment:e,inMemoryRecordCache:e.defaultRecordCache.inMemoryRecordCache,pointer:{table:E().ev,id:o},userId:e.currentUser.id,minimumVersion:n})})))}(t,n),o.resultSetStore.addLocalChange(Object.keys(n))}class ot{constructor(e,t){this.queuedCollectionEmit=void 0,this.queuedBlockIdsToRefetch=void 0,this.isServerRequestRequired=void 0,this.collectionContextStore=void 0,this.environment=void 0,this.isServerQueryCollectionRequired=(e,t)=>{const o=this.collectionContextStore.isClientModeEnabledStore.state;if(o&&t&&"collectionTypedView"===this.collectionContextStore.contextType)return!0;const n=Boolean(e&&(0,Je().Xj)(Ze().yx,e)&&e.hasMore);if(o&&!n)return!1;const r=this.collectionContextStore.remoteRequestStore.state;if(!r)return!0;return!!(0,b().WP)(r.loader.reducers||{}).some((e=>{let[t,o]=e;return"results"!==o.type}))||!(e&&(0,Je().Xj)(Ze().yx,e)&&!e.hasMore)},this.throttledRefetch=(0,o(279900).A)((e=>this.refetchFromRemote({...e,queuedTimestamp:Date.now()}))),this.processCollectionRefetch=async e=>{const t=this.queuedBlockIdsToRefetch,o=this.isServerRequestRequired;if(this.reset(),o){var n;const o=null===(n=(0,b().uv)(t))||void 0===n?void 0:n[0],r=t[o];this.throttledRefetch({src:e,trigger:`${o}:${r}`})}t&&await tt({environment:this.environment,collectionContextStore:this.collectionContextStore,blockIdToMinimumVersion:t})},this.refetchFromRemote=async e=>{const t=this.collectionContextStore.throttleMsStore.state;await Promise.all([(0,V().M)(this.environment,this.collectionContextStore,e),(0,o(763824).wR)(t)])},this.queuedCollectionEmit=!1,this.isServerRequestRequired=!1,this.queuedBlockIdsToRefetch={},this.collectionContextStore=e,this.environment=t}reset(){this.queuedCollectionEmit=!1,this.isServerRequestRequired=!1,this.queuedBlockIdsToRefetch={}}addBlockIdToRefetch(e,t){this.queuedBlockIdsToRefetch[e]=Math.max(this.queuedBlockIdsToRefetch[e]??0,t)}async handleCollectionEmit(e){const{src:t,passThroughData:o,shouldQueueCollectionEmit:n,isCollectionTypeChange:r}=e;if((0,Je().Xj)(Ze().yx,o)&&null!=o&&o.blockIdToVersion&&(0,b().WP)(o.blockIdToVersion).forEach((e=>{let[t,o]=e;return this.addBlockIdToRefetch(t,o)})),this.isServerRequestRequired=this.isServerRequestRequired||this.isServerQueryCollectionRequired(o,r),!n)return await this.processCollectionRefetch(t);this.queuedCollectionEmit=!0}async maybeProcessQueuedCollectionEmit(e){if(this.queuedCollectionEmit)return await this.processCollectionRefetch(e)}}var nt=()=>o(155004),rt=()=>o(493823),it=()=>o(297872),lt=()=>o(199896),st=()=>o(425981),at=(o(354520),()=>o(66689)),ct=()=>o(59674),dt=()=>o(713998),ut=()=>o(735384),pt=()=>o(416726),mt=()=>o(548218),gt=()=>o(44729),St=()=>o(109488),ht=()=>o(454305),ft=()=>o(682146);o(944114);function vt(e){let{collectionContextStore:t,property:o,blockStores:n}=e;const r=t.normalizedFormatStore.state.collection_group_by;if((null==r?void 0:r.property)!==o)return;const i=function(e,t){const o=new Map,n=t.groupsStore.getAllGroupStates(),r=(0,C().E$)(e,ie().default.state.stores);if(!r.length)return o;for(const i of r){const e=n.find((e=>e.groupUiParentStore===i.getRecordStoreUIParent()));e&&o.set(i,e.resultsStore)}return o}(n,t),l=[];for(const[s,a]of i.entries())a.state.includes(s)||l.push(s);l.length&&P().DN({stores:(0,C().R9)(ie().default.state.stores,l)})}var yt=()=>o(972435),xt=()=>o(919709);class Ct extends p().default{getInitialState(){return{textStoresBeingEdited:[]}}getNumberOfTextStoresBeingEdited(){return this.state.textStoresBeingEdited.length}textStoresWithEmptyProperty(e){return this.state.textStoresBeingEdited.filter((t=>{const o=t.getPropertyValue(e);return""===xt().q4_(o)}))}}const bt=Ct;var wt=()=>o(77246),kt=()=>o(496889),Tt=()=>o(41459),It=()=>o(145214),Rt=()=>o(704152),jt=()=>o(285790),At=()=>o(859428),Pt=()=>o(717402);const Mt=32;function Bt(e){return{boxShadow:`1px 0 0 ${e.regularDividerColor}`,marginRight:1}}const _t=(0,k().YK)({delete:{id:"CollectionsBulkActionsToolbar.deleteButton.tooltip",defaultMessage:"Delete"}});function Vt(e){const t=(0,Z().ET)(),o=(0,d().K8)((()=>t.collectionViewBlockStore()),[t]),{marginLeft:r}=e,i=(0,s().v3)(),l=(0,d().uB)(void 0,bt),a=(0,n.useRef)(null),[c,p]=(0,n.useState)(!1),m=(0,d().K8)((()=>ie().default.state.stores),[]),g=m.length,h=(0,d().K8)((()=>l.getNumberOfTextStoresBeingEdited()),[l]),f=(0,d().K8)((()=>{var e;return!!(0,L().f5)({environment:i,collectionContextStore:t})&&(!m.some((e=>{var t;return null===(t=e.getAssociatedCollectionStore())||void 0===t?void 0:t.isExternallyImportedAndSyncedCollection()}))&&(h>0||m.length>=1&&(0,L().Rd)(m,null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.id)))}),[t,i,h,m]),v=(0,n.useRef)(void 0);(0,d().K8)((()=>{const e=Se().jQ().state;e.isOpen?v.current=e.property:v.current&&vt({collectionContextStore:t,property:v.current,blockStores:m})}),[t,m],{debugName:"cleanUpSelection"});const y=(0,d().K8)((()=>o&&"suggest"!==wt().Uv.getMode(o)),[o]),x=(0,u().IS)((e=>({inner:{display:"inline-flex",justifyContent:"center",alignItems:"center",borderRadius:5,background:e.popoverBackground,boxShadow:e.shadowSM,height:Mt},outer:{position:"sticky",top:1,left:0+(r??0),zIndex:999,visibility:c?"visible":"hidden"},outerLayoutAdjust:{marginBottom:-Mt},blockActionMenuButton:{width:30,height:"100%",borderRadius:void 0,borderTopRightRadius:5,borderBottomRightRadius:5},blockActionMenuButtonIcon:{fill:e.regularTextColor},trashButton:{borderRadius:0,height:"100%",border:0,...Bt(e),width:28},trashButtonIcon:{width:16},trashButtonIconHovered:{fill:e.accentColors.red[500]}})),[c,r]);return(0,S.jsx)(St().A,{capture:f,render:e=>(0,S.jsxs)(It().A,{visible:f,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onAnimationEnd:e=>{e||p(!1)},ref:a,...e,style:x.outer,children:[(0,S.jsx)(nt().s,{allowSelectionWithin:!1,children:(0,S.jsxs)("div",{style:x.inner,children:[(0,S.jsx)(Ft,{selectedItemCount:g,collectionsBulkActionsToolbarStore:l}),(0,S.jsx)(Ht,{collectionsBulkActionsToolbarStore:l,selectedItems:m,marginLeft:r,setIsReadyToRender:p,outerContainerRef:a}),y&&(0,S.jsx)(At().A,{renderTooltip:()=>(0,S.jsx)("div",{children:yt().A.formatMessage(_t.delete)}),render:e=>(0,S.jsx)(jt().A,{...e,ariaLabel:yt().A.formatMessage(_t.delete),icon:()=>(0,ut().I)(x.trashButtonIcon),style:x.trashButton,hoveredStyle:x.trashButtonIconHovered,hasBackground:!0,isDarkIconColor:!0,showShadow:!0,onClick:async()=>{var e;(0,D().N)(i,{analyticsName:pt().AY.deleteName.defaultMessage,from:"bulk_actions_toolbar",block_type:"page",collection_id:null===(e=t.collectionStore())||void 0===e?void 0:e.id}),await X().Af({environment:i,blocks:m,shouldCheckSuggestEdit:!0,overrideRemoveBlockFunc:(e,o)=>{var n,r;(null===(n=e.getAssociatedCollectionStore())||void 0===n?void 0:n.id)===(null===(r=t.collectionStore())||void 0===r?void 0:r.id)&&gt().by({childStore:e,transaction:o})}})}}),placement:Fe().W.Top}),(0,S.jsx)(kt().A,{store:m[0],fadeIn:!1,style:x.blockActionMenuButton,hoveredStyle:x.blockActionMenuButton,iconStyle:x.blockActionMenuButtonIcon,extraAnalyticsData:{isFromBulkActionsToolbar:!0},isFromCollectionView:!0})]})}),(0,S.jsx)("div",{style:x.outerLayoutAdjust})]})})}function Ft(e){const{collectionsBulkActionsToolbarStore:t,selectedItemCount:o}=e,n=(0,s().v3)(),r=(0,d().K8)((()=>t.getNumberOfTextStoresBeingEdited()),[t]),i=(0,d().K8)((()=>r>0?r:Math.max(1,o)),[r,o]),l=(0,u().IS)((e=>({button:{color:e.blueColor,fontSize:14,whiteSpace:"nowrap",height:"100%",alignItems:"center",display:"flex",paddingRight:10,paddingLeft:10,borderTopLeftRadius:5,borderBottomLeftRadius:5,fontVariantNumeric:"tabular-nums",...Bt(e)}})),[]);return(0,S.jsx)(Rt().A,{style:l.button,onClick:()=>P().IU({environment:n}),children:(0,S.jsx)(k().sA,{id:"SelectedItemCountWidget.numItemsSelected",defaultMessage:"{itemsSelectedCount} selected",values:{itemsSelectedCount:i}})})}const Lt=6,Ot=450,Et=2,Dt=32,zt=150,Kt=["title","rollup","formula","button"];function Ht(e){const{outerContainerRef:t,collectionsBulkActionsToolbarStore:o,selectedItems:r,marginLeft:i,setIsReadyToRender:l}=e,s=(0,Z().ET)(),a=(0,d().O$)(s.normalizedSchemaStore),c=(0,n.useRef)(null),u=(0,d().K8)((()=>s.databaseType===at().TC&&r.some((e=>e.getPropertyValue(ct().y.MeetingNoteToCalendarEventRelation)))),[s,r]),p=(0,d().K8)((()=>{var e;const t=s.normalizedFormatStore.state;return(null==t||null===(e=t.table_properties)||void 0===e?void 0:e.filter((e=>{const t=s.collectionStore();if((0,dt()._f)(null==t?void 0:t.getModel(),e.property))return!u;const o=a[e.property];return e.visible&&o&&!Kt.includes(o.type)&&(0,ft().g2)({propertySchema:o,property:e.property,blockStores:r,collectionSchema:a,collectionStore:t,spaceStore:Le().default.state.currentSpaceStore})})))??[]}),[s,a,r,u]).slice(0,Lt),m=(0,n.useRef)([]),[g,h]=(0,n.useState)(Lt),[f,v]=(0,n.useState)(!1);return(0,n.useEffect)((()=>{m.current.length>0&&m.current.forEach((e=>{var t;e&&(e.rightEdge=(null===(t=e.element)||void 0===t||null===(t=t.current)||void 0===t?void 0:t.getBoundingClientRect().right)??0)}))}),[m]),function(e){let{outerContainerRef:t,propertyButtonsContainerRef:o,propertyButtonRefs:r,marginLeft:i,setIsReadyToRender:l,setShowIconsOnly:s,setHiddenButtonsIndex:a}=e;(0,n.useEffect)((()=>{const e=C().sg((()=>{var e,n,c;const d=(null===(e=t.current)||void 0===e?void 0:e.getBoundingClientRect().right)??window.innerWidth,u=((null===(n=t.current)||void 0===n?void 0:n.getBoundingClientRect().width)??window.innerWidth)-(i??0),p=(null===(c=o.current)||void 0===c?void 0:c.getBoundingClientRect().left)??0,m=d-zt;let g=r.current.findIndex((e=>e.rightEdge>m));g=-1!==g?g:Lt;let S=r.current.findIndex(((e,t)=>p+t*Dt>m));S=-1!==S?S:Lt;const h=g<Et||u<=Ot;s(h),a(h?S:g),l(!0)}),150,{maxWait:150,leading:!0,trailing:!1});if(t.current){const o=new ResizeObserver((t=>{e()}));return e(),o.observe(t.current),()=>{o.disconnect()}}}),[i,t,r,o,a,l,s])}({propertyButtonsContainerRef:c,propertyButtonRefs:m,outerContainerRef:t,marginLeft:i,setIsReadyToRender:l,setHiddenButtonsIndex:h,setShowIconsOnly:v}),(0,S.jsx)("div",{ref:c,style:{display:"flex"},children:p.map(((e,t)=>{var r;let i=null===(r=m.current[t])||void 0===r?void 0:r.element;if(!i){const e=n.createRef();m.current[t]={element:e,rightEdge:0},i=e}const l=t>=g;return(0,S.jsx)("div",{ref:i,children:(0,S.jsx)(Gt,{collectionsBulkActionsToolbarStore:o,schema:a,property:e.property,isHidden:l,showIconsOnly:f},e.property)},e.property)}))})}function Gt(e){const{property:t,schema:o,collectionsBulkActionsToolbarStore:r,isHidden:i,showIconsOnly:l}=e,a=(0,Z().ET)(),c=o[t],p=(0,s().v3)(),m=(0,d().K8)((()=>!(a.permissionScopesStore.state.canEditContent||"collectionTypedView"===a.contextType)),[a]),g=(0,u().IS)((e=>({button:{display:i?"none":"flex",paddingLeft:8,paddingRight:8,height:Mt,alignItems:"center",...Bt(e)}})),[i]),h=(0,n.useRef)(null),f=(0,d().uB)(void 0,ht().A),v=(0,n.useCallback)((async e=>{var o,n;if(!h.current)return;const i=ie().default.state.stores;e.stopPropagation(),e.preventDefault();const l=null===(o=h.current)||void 0===o?void 0:o.getBoundingClientRect(),s=i[0].getAssociatedCollectionStore();a&&l&&s&&await mt().V({environment:p,store:i[0],additionalStores:i.slice(1),property:t,rect:l,format:Tt().j.Table,collectionStore:s,blockPropertyValueOverlayStore:Se().jQ(),collectionContextStore:a,statusSetCheckbox:"checkbox"===(null===(n=a.getPropertyFormat(t))||void 0===n?void 0:n.statusShowAs),mouseStore:f,preventClearSelection:!0,collectionsBulkActionsToolbarStore:r})}),[h,a,p,t,f,r]),y=(0,u().DP)();return c?(0,S.jsx)(At().A,{renderTooltip:()=>c.name,render:e=>(0,S.jsx)(Rt().A,{...e,ariaLabel:c.name,ref:h,style:g.button,disabled:m,onClick:v,children:(0,S.jsx)(Pt().Ay,{style:{maxWidth:"250px",textOverflow:"ellipsis"},propertySchema:c,hideName:l,showIcon:!0,property:t,iconStyle:{fill:y.regularTextColor}})}),disableTooltip:!l,placement:Fe().W.Top}):null}function Wt(e){let{isFullScreen:t,leftRightPaddingStore:o,leftRightMarginStore:n,overrideViewType:r}=e;const i=(0,s().v3)(),l=(0,Z().ET)(),a=(0,d().K8)((()=>(0,L().f5)({environment:i,collectionContextStore:l,overrideViewType:r})),[i,l,r]),c=(0,d().K8)((()=>{var e;if(!a)return 0;return(t?(null===(e=o.state)||void 0===e?void 0:e.paddingLeft)??0:0)+(n.state.marginLeft??0)}),[a,n,o,t]);return a?(0,S.jsx)(Vt,{marginLeft:c}):null}const Nt=n.memo(Wt);var $t=()=>o(735695),Ut=()=>o(236030),qt=()=>o(690471),Yt=()=>o(836251),Xt=()=>o(255824),Qt=()=>o(756279),Zt=()=>o(2143);function Jt(e){const{style:t,children:o}=e,n=(0,u().IS)((()=>({scroller:{height:"100%",maxHeight:"inherit",...t}})),[t]);return(0,S.jsx)(Zt().H,{type:Qt().A.Y,style:n.scroller,children:o})}function eo(e){let{store:t,children:r,isFullScreen:i,currentViewType:l,isInPeek:a,isInHomeWidget:c,handleEditorClick:u,isRootOrDirectChild:p,leftRightPaddingStore:m,paddingBottom:g,viewSettingsPlacementStore:h,paddingLeft:f,format:v,isMyTasksEmpty:y,isHomeCustomDbEmpty:x,isInFrameWhenSidePeekOpen:C,handleHorizontalScrollerMount:w,handleEditorMouseDown:k,isUnlistedView:T,isPreviewing:I}=e;const R=(0,Z().ET)(),j=(0,s().v3)(),{isPhone:A}=(0,s().Y0)(),P=(0,Ae().X)("disable_rectangular_selection_for_database_horizontal_scroll"),M=(0,d().K8)((()=>(0,Yt().w6)(j)),[j]),B=(0,d().K8)((()=>function(e){const{environment:t,isFullScreen:o,isInPeek:n,isPreviewing:r,isUnlistedView:i,isSettingsView:l,collectionViewType:s}=e;if(r)return Qt().A.None;if("page"===s)return Qt().A.None;if(i)return Qt().A.All;if(n)return Qt().A.X;if(l)return Qt().A.X;if(!o||!(0,Re().z4)(t))return Qt().A.X;return Qt().A.None}({environment:j,isFullScreen:i,isPreviewing:I,isInPeek:a,isUnlistedView:Boolean(T),isSettingsView:"collectionSettings"===R.contextType,collectionViewType:l})),[T,j,i,I,a,R,l]),V=(0,d().K8)((()=>!("collectionSystemView"===R.contextType)&&c&&function(e){switch(e){case"table":case"board":case"gallery":case"list":case"timeline":case"chart":case"page":case"form_editor":case"feed":case"chat":return!0;case"calendar":case"map":case"custom":return!1;default:return(0,b().HB)(e)}}(l)),[R,c,l]),F=(0,d().K8)((()=>_().B2({blockStore:t,isFullScreen:i,environment:j,collectionContextStore:R})),[t,i,j,R]),L=(0,d().K8)((()=>{const e=m.state,o=R.settingsStore.state.open,n=R.isInHomeWidgetStore.state&&R.isEditableHomeCollectionStore.state;let r={};return T&&(r=A?{height:M?Ut().gK:Ut().NH,width:void 0}:{height:Ut().PN,width:void 0}),{flexGrow:1,flexShrink:0,...t.isNonEditableState()&&{cursor:"default"},..."timeline"===l&&R.collectionStore()&&!i&&!(0,qt().Od)({environment:j,format:v,isFullScreen:i,isRootChild:p})&&e&&{marginLeft:e.paddingLeft,marginRight:e.paddingRight,marginBottom:g},...o&&!i&&"sidebar"===h.state&&{minHeight:$t().iZ},...n?{paddingRight:8,paddingLeft:"list"===l?8:16}:{},...c&&!V?{maxHeight:"inherit"}:{},...y||x||!V?{height:"100%"}:{},...!C||"timeline"===l||c||T?{}:{position:"sticky",left:0,paddingLeft:f,width:(0,Ve().Uh)(j)},..."chart"===l&&C&&!c?{paddingLeft:f}:{},..."page"===l?{zIndex:86}:{},...F&&{marginLeft:-Ut().Fh},...r,..."custom"===l&&{height:"100%"}}}),[m,R,p,t,l,i,j,v,g,h,c,V,y,x,C,f,F,T,A,M]),O=(0,Xt().g)(),E=(0,d().K8)((()=>O&&"page"===l?Qt().A.All:a||c?Qt().A.None:o(620689).u5(j)),[j,a,c,O,l]),D=(0,n.useCallback)((e=>{u(e,l)}),[u,l]),z=(0,S.jsx)(Zt().H,{type:B,className:he().ohG,onMouseDown:P?void 0:k,preventType:E,onClick:D,style:L,ref:w,children:r});return V?(0,S.jsx)(Jt,{style:{..."list"===l?{paddingBottom:8}:"timeline"===l?{paddingBottom:0}:{paddingBottom:16},...c&&"feed"!==l?{paddingTop:12}:{}},children:z}):z}var to=()=>o(700250);function oo(e){let{store:t,leftRightPaddingStore:n,viewSettingsPlacementStore:r,headerHeightStore:i,headerSizeObserver:l,contentSizeObserver:s,settingsHeaderSizeObserver:a,currentViewType:c,isInHomeWidget:u,placementToOrigin:p,alignmentToOrigin:m,headerRef:g}=e;const h=(0,Z().Ks)(),f=(0,d().K8)((()=>(0,L().RX)(t)?{paddingLeft:0,paddingRight:0}:n.state),[n,t]),v=(0,d().K8)((()=>{var e;return void 0!==(null==h||null===(e=h.viewsModuleContextStore.getState())||void 0===e?void 0:e.viewsModule)}),[null==h?void 0:h.viewsModuleContextStore]),y="form_editor"===c,x=(0,d().K8)((()=>{var e;if(p)return p;if(!y)return;return!(null==h||!h.settingsStore.state.open)&&(0,b().Xk)(["formQuestionCreateSettings","formQuestionEditSettings"],null===(e=(0,C().$1)(null==h?void 0:h.settingsStore.state.stack))||void 0===e?void 0:e.type)?to().UV.Right:to().UV.Bottom}),[p,y,null==h?void 0:h.settingsStore]),w=m??(u?to().MY.End:void 0),k=y?x===to().UV.Right?24:12:void 0,T=(0,d().K8)((()=>(null==h?void 0:h.isInlineViewStore.state)&&(null==h?void 0:h.isUnlistedViewStore.state)),[null==h?void 0:h.isInlineViewStore,null==h?void 0:h.isUnlistedViewStore]);return v?null:f&&h?(0,S.jsx)(o(517843).A,{collectionContextStore:h,headerSizeObserver:l,contentSizeObserver:s,settingsHeaderSizeObserver:a,headerHeightStore:i,placementStore:r,marginTop:T?-10:void 0,placementToOrigin:x,alignmentToOrigin:w,originGap:k,headerRef:g,...f}):null}const no=n.memo(oo),ro=(0,g().wt)("folderUnknownLarge",{viewBox:"0 0 48 48",svg:(0,S.jsx)("path",{d:"M39.1702 25.1855C43.1252 25.1855 46.4504 21.8896 46.4504 17.9053C46.4504 13.9062 43.1692 10.625 39.1702 10.625C35.1858 10.625 31.8899 13.9209 31.8899 17.9053C31.8899 21.9189 35.1858 25.1855 39.1702 25.1855ZM11.6604 37.5195H36.1379C38.7014 37.5195 40.1663 36.0547 40.1663 33.2422V26.8408C39.6829 26.9141 38.9504 26.9141 38.3498 26.8408V33.1543C38.3498 34.8389 37.427 35.7178 35.801 35.7178H11.6897C10.0491 35.7178 9.15551 34.8389 9.15551 33.1543V21.1133H30.7327C30.5276 20.5713 30.3811 20 30.3079 19.3994H9.15551V15.3125C9.15551 13.7598 9.94652 12.9834 11.4553 12.9834H14.8391C15.9084 12.9834 16.4797 13.2031 17.2707 13.9062L18.1057 14.6387C19.0286 15.4443 19.761 15.708 21.2405 15.708H30.4543C30.6008 15.0635 30.7766 14.5215 31.0842 13.8916H21.6799C20.5666 13.8916 19.9807 13.6865 19.219 13.0127L18.3694 12.2803C17.4172 11.4307 16.7434 11.1963 15.2786 11.1963H11.1038C8.67211 11.1963 7.3391 12.5293 7.3391 15.21V33.2422C7.3391 36.084 8.80395 37.5195 11.6604 37.5195ZM39.053 19.6924C38.5989 19.6924 38.3352 19.4287 38.3352 18.9746V18.916C38.3352 18.0811 38.76 17.6416 39.4485 17.1582C40.2248 16.6162 40.7375 16.2793 40.7375 15.5615C40.7375 14.9023 40.1955 14.4775 39.3606 14.4775C38.6575 14.4775 38.1741 14.8145 37.8664 15.166C37.6174 15.4297 37.4416 15.6934 37.0608 15.6934C36.6653 15.6934 36.4016 15.4297 36.4016 15.0195C36.4016 14.0088 37.8079 13.1299 39.3606 13.1299C41.133 13.1299 42.2463 14.1699 42.2463 15.4883C42.2463 16.5869 41.6164 17.0557 40.7815 17.6709C40.1077 18.1689 39.844 18.4473 39.7854 19.0479C39.7414 19.4434 39.5071 19.6924 39.053 19.6924ZM39.053 22.5195C38.4817 22.5195 38.0129 22.0508 38.0129 21.4795C38.0129 20.9229 38.4817 20.4541 39.053 20.4541C39.6243 20.4541 40.093 20.9229 40.093 21.4795C40.0784 22.0508 39.6243 22.5195 39.053 22.5195Z"})}),io=(0,g().wt)("formBuilderDisabled",{viewBox:"0 0 72 72",svg:(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5.77344 41.6953V17.2031H53.4922V22.6875H57.2656V13.2656C57.2656 10.8594 56.6562 9.04688 55.4375 7.82812C54.2188 6.60938 52.375 6 49.9062 6H9.35938C6.90625 6 5.0625 6.60938 3.82812 7.82812C2.60938 9.03125 2 10.8438 2 13.2656V41.9062C2 44.3125 2.60938 46.1172 3.82812 47.3203C5.0625 48.5391 6.90625 49.1484 9.35938 49.1484H40.4062V45.375H9.40625C8.23438 45.375 7.33594 45.0703 6.71094 44.4609C6.08594 43.8359 5.77344 42.9141 5.77344 41.6953ZM53.4922 13.4766V13.8984H5.77344V13.4766C5.77344 12.2578 6.08594 11.3359 6.71094 10.7109C7.33594 10.0859 8.23438 9.77344 9.40625 9.77344H49.8594C51.0156 9.77344 51.9062 10.0859 52.5312 10.7109C53.1719 11.3359 53.4922 12.2578 53.4922 13.4766Z"}),(0,S.jsx)("path",{d:"M14.1641 34.0781H40.4062V41.6719H14.1641C13.5391 41.6719 13.0312 41.4844 12.6406 41.1094C12.2656 40.7344 12.0781 40.2422 12.0781 39.6328V36.1172C12.0781 35.5078 12.2656 35.0156 12.6406 34.6406C13.0312 34.2656 13.5391 34.0781 14.1641 34.0781Z"}),(0,S.jsx)("path",{d:"M63.5781 34.5C63.8594 34.5 64.0938 34.5938 64.2812 34.7812C64.4792 34.9688 64.5781 35.2031 64.5781 35.4844C64.5781 35.776 64.4792 36.0208 64.2812 36.2188C64.0938 36.4167 63.8594 36.5156 63.5781 36.5156H52.4375C52.1458 36.5156 51.901 36.4167 51.7031 36.2188C51.5156 36.0208 51.4219 35.776 51.4219 35.4844C51.4219 35.2031 51.5156 34.9688 51.7031 34.7812C51.901 34.5938 52.1458 34.5 52.4375 34.5H63.5781Z"}),(0,S.jsx)("path",{d:"M63.5781 39.75C63.8594 39.75 64.0938 39.849 64.2812 40.0469C64.4792 40.2344 64.5781 40.4688 64.5781 40.75C64.5781 41.0417 64.4792 41.2865 64.2812 41.4844C64.0938 41.6823 63.8594 41.7812 63.5781 41.7812H52.4375C52.1458 41.7812 51.901 41.6823 51.7031 41.4844C51.5156 41.2865 51.4219 41.0417 51.4219 40.75C51.4219 40.4688 51.5156 40.2344 51.7031 40.0469C51.901 39.849 52.1458 39.75 52.4375 39.75H63.5781Z"}),(0,S.jsx)("path",{d:"M51.875 45.173C52.0377 45.0681 52.2252 45.0156 52.4375 45.0156H57.9062C58.1979 45.0156 58.4375 45.1146 58.625 45.3125C58.8229 45.5104 58.9219 45.7552 58.9219 46.0469C58.9219 46.3177 58.8229 46.5521 58.625 46.75C58.4375 46.9375 58.1979 47.0312 57.9062 47.0312H55.244C55.2387 47.0458 55.2332 47.0605 55.2276 47.0751C55.2093 47.1229 55.1899 47.1699 55.1695 47.216C55.1592 47.1922 55.1491 47.168 55.1392 47.1437C55.124 47.106 55.1097 47.0685 55.0963 47.0312H52.4375C52.2252 47.0312 52.0377 46.9816 51.875 46.8822C51.8142 46.845 51.757 46.801 51.7031 46.75C51.5156 46.5521 51.4219 46.3177 51.4219 46.0469C51.4219 45.9193 51.4398 45.8008 51.4756 45.6912C51.5218 45.5501 51.5976 45.4239 51.7031 45.3125C51.757 45.2587 51.8142 45.2122 51.875 45.173Z"}),(0,S.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M44.4062 31.9844C44.4062 30.2656 44.849 28.9531 45.7344 28.0469C46.6302 27.1406 47.9375 26.6875 49.6562 26.6875H66.3438C68.0521 26.6875 69.3542 27.1406 70.25 28.0469C71.1458 28.9531 71.5938 30.2656 71.5938 31.9844V55.4688C71.5938 57.1979 71.1458 58.5104 70.25 59.4062C69.3542 60.3021 68.0521 60.75 66.3438 60.75H49.6562C47.9375 60.75 46.6302 60.3021 45.7344 59.4062C44.849 58.5104 44.4062 57.1979 44.4062 55.4688V31.9844ZM47.875 55.1719C47.875 55.8594 48.0521 56.3802 48.4062 56.7344C48.7604 57.099 49.2969 57.2812 50.0156 57.2812H65.9844C66.7031 57.2812 67.2344 57.099 67.5781 56.7344C67.9323 56.3802 68.1094 55.8594 68.1094 55.1719V32.2812C68.1094 31.6042 67.9323 31.0833 67.5781 30.7188C67.2344 30.3542 66.7031 30.1719 65.9844 30.1719H50.0156C49.2969 30.1719 48.7604 30.3542 48.4062 30.7188C48.0521 31.0833 47.875 31.6042 47.875 32.2812V55.1719Z"})]})});var lo=()=>o(668435),so=()=>o(921598),ao=()=>o(566910),co=()=>o(970013),uo=()=>o(689094),po=()=>o(206267),mo=()=>o(821062);function go(e,t){ge().vd(e,"board_item_delete_newly_created",t)}var So=()=>o(114641),ho=()=>o(645099),fo=()=>o(690825),vo=()=>o(592269),yo=()=>o(416504),xo=(o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(823215),o(430670),()=>o(9559)),Co=()=>o(519831),bo=()=>o(708830),wo=()=>o(909470),ko=()=>o(337567),To=()=>o(861841),Io=()=>o(508496),Ro=()=>o(722101),jo=()=>o(73223),Ao=()=>o(317001),Po=()=>o(520861),Mo=()=>o(716728),Bo=()=>o(976405),_o=()=>o(394653);function Vo(e){var t;const{store:o,groupsPointer:n,environment:r,collectionContextStore:i,transaction:l}=e;if(!o.isDefined())return;const s=i.normalizedSchemaStore.state,a=i.relativeVariableStore.state,c=null===(t=i.viewsModuleContextStore.currentPageStore())||void 0===t?void 0:t.id,d=new Map,u=new Map;for(const p of n){const e=vo().jV({block:o.getModel(),schema:s,propertyMapping:void 0,userFilterContext:{userId:r.currentUser.id,userTimeZone:(0,yo().P)(),userStartOfWeek:Se().XX.state},group:p,groupBy:i.getGroupByAndGroupFormats().groupBy,getRecordModel:o.getRecordModel,intl:yt().A.getIntl(),relativeVariableResult:a,currentPageInRelatedCollection:c,resultCache:d,regExpCache:u,experimentService:Io().default});(0,_o().l)({environment:r,blockStore:o,properties:e,transaction:l})}}var Fo=()=>o(755673),Lo=()=>o(656432);function Oo(e){const{groupsPointer:t,collectionContextStore:o,blocks:n,formulasModule:r}=e,i=[];return t.map((e=>{var t,l;const s=null==o||null===(t=o.collectionStore())||void 0===t?void 0:t.getSchema()[e.property],a=null==o||null===(l=o.collectionStore())||void 0===l?void 0:l.getSchema(),c=new Map,d=new Map,u=n.flatMap((t=>{const o=t.getModel();if(s&&a&&o)return(0,xo().W)({property:e.property,schema:a,block:o,getRecordModel:t.getRecordModel,collectionRequestContext:{userId:void 0,userTimeZone:(0,yo().P)(),depth:0,intl:yt().A.getIntl(),visitedProperties:new Set,resultCache:c,regExpCache:d,experimentService:Io().default,collectionFeatureGates:(0,wo().i)()},exportedFilePaths:!1,formulasModule:r})})).filter((e=>!C().b0(e)));i.push(...u)})),C().Mp(i,C().n4)}function Eo(e){var t,o,n,r;const{environment:i,collectionStore:l,targetStore:s,droppedDirection:a,droppedStores:c,transaction:d,duplicate:u,collectionContextStore:p,groupsPointer:m,subitemPath:g,formulasModule:S}=e;if(!p.permissionScopesStore.state.canEditContent)return;if(c.some((e=>(0,ko().pQ)(e.id))))return;if(c.some((e=>{const t=e.getDiscussionStores();for(const o of t)if(o.isSuggestionDiscussion())return!0})))return;if(e.collapsedGroup&&function(e){var t;const{environment:o,droppedStores:n,duplicate:r,collectionContextStore:i,groupsPointer:l,transaction:s}=e,a=i.collectionStore(),c=i.collectionViewStore(),d=null===(t=n[0])||void 0===t?void 0:t.getAssociatedCollectionStore(),u=d&&d.id===(null==a?void 0:a.id),p=i.hasSingleCollection()&&r,m=(0,Po().T)({environment:o,droppedStores:n,duplicate:p,transaction:s,collectionStore:a});for(const g of m){const e=a??g.getAssociatedCollectionStore();e&&(0,Ao().j)({environment:o,store:g,collectionStore:e,collectionContextStore:i,groupsPointer:l,shouldCoerce:!0,transaction:s})}c&&(0,Fo().z)({resultIds:m.map((e=>e.id)),collectionViewStore:c,collectionContextStore:i,transaction:s}),s.postSubmitCallbacks.push((async e=>{!e&&a&&(Io().default.checkGate({gateName:"subitems_drag_drop_improvements"})&&u||await q().Bz({droppedStores:n,createdStores:m,collectionStore:a,environment:o,collectionContextStore:i,groupsPointer:l,shouldDuplicate:r}))}))}({environment:i,collectionContextStore:p,groupsPointer:m,droppedStores:c,duplicate:u,transaction:d}),!s)return;const h=p.collectionViewStore();if(!h)return;const f=null===(t=c[0])||void 0===t?void 0:t.getAssociatedCollectionStore(),v=f&&f.id===(null==l?void 0:l.id),y=null===(o=p.groupsStore.getGroupState(m))||void 0===o?void 0:o.groupUiParentStore;if(!y)return;const x=Oo({groupsPointer:m,collectionContextStore:p,blocks:c,formulasModule:S}),b=(null===(n=p.groupsStore.getGroupState(m))||void 0===n?void 0:n.resultsStore.state)||[],w=c.every((e=>e.isExternalObjectInstancePageBlockStore()))&&!(null!=l&&l.isSyncedCollection()&&(null===(r=c[0])||void 0===r?void 0:r.getParentId())===(null==l?void 0:l.id)),k=p.hasSingleCollection()&&(w||u);if(a===To().bH.Onto){P().IU({environment:i});const e=s.getContentStore(),t=(0,Po().T)({environment:i,droppedStores:c,duplicate:k,transaction:d,collectionStore:l});for(const o of t)Ro().BC({parentStore:e,appendStore:o,transaction:d});return[]}let T=!1,I=[];if(!k&&l){const e=function(e){const{environment:t,droppedStores:o,collectionStore:n,transaction:r}=e;if(!o.length)return;const i=(0,Lo().K)({environment:t,stores:o,spaceId:n.getSpaceId(),transaction:r});for(const l of i){if(l.getParentTable()===Co().Vl||l.getAssociatedCollectionStore())return;if(!gt().X$({childStore:l,parentStore:n,transaction:r}))return}return i}({environment:i,droppedStores:c,collectionStore:l,transaction:d});T=void 0!==e,I=e??[]}const R=(0,te().kY)([...(null==g?void 0:g.map((e=>e.value.store.pointer)))??[]]),j=p.subitemExpandedStore.state.get(R),A=g&&g.length>1||(null==j?void 0:j.isExpanded)&&a===To().bH.Below,M=p.groupsStore.getAllGroupStates();c.forEach((e=>{const t=M.find((t=>t.resultsStore.state.includes(e)));t&&!A&&Vo({environment:i,store:e,collectionContextStore:p,groupsPointer:t.groupsPointer,transaction:d})}));const B=(0,Po().T)({environment:i,droppedStores:c,duplicate:k,transaction:d,collectionStore:l});T||(I=(0,Lo().K)({environment:i,stores:B,spaceId:s.getSpaceId(),transaction:d})),d.postSubmitCallbacks.push((async e=>{!e&&l&&(Io().default.checkGate({gateName:"subitems_drag_drop_improvements"})&&v||await q().Bz({droppedStores:c,createdStores:B,collectionStore:l,environment:i,collectionContextStore:p,groupsPointer:m,alreadyMovedToCollection:T,shouldDuplicate:k}))}));const _=Oo({groupsPointer:m,collectionContextStore:p,blocks:B,formulasModule:S});for(const C of I){const e=l??C.getAssociatedCollectionStore();e&&(0,Ao().j)({environment:i,store:C,collectionStore:e,collectionContextStore:p,groupsPointer:Boolean(A)?[]:m,shouldCoerce:!0,transaction:d,alreadyMovedToCollection:T})}l&&function(e){var t,o,n;const{environment:r,isInsertingAsSubitem:i,shouldDuplicate:l,collectionContextStore:s,collectionStore:a,droppedStores:c,wrappedStores:d,targetSubitemExpandedState:u,subitemPath:p,targetStore:m,transaction:g}=e,S=s.currentSubitemFormatStoreForCollectionStore.state,h=null==S?void 0:S.inverse,f=h&&s.normalizedSchemaStore.state[h],v=null==S?void 0:S.property,y=v&&s.normalizedSchemaStore.state[v],x=null===(t=s.collectionViewStore())||void 0===t?void 0:t.getType(),C=null===(o=s.collectionViewStore())||void 0===o?void 0:o.getFormat();if(null!==(n=s.collectionViewStore())&&void 0!==n&&null!==(n=n.getCollectionStore())&&void 0!==n&&n.isExternallyImportedAndSyncedCollection()&&(0,oe().pB)())return;const b=(null==C?void 0:C.subitem_display_mode)??"show",w=S&&x&&(0,te().qS)(x)&&f&&(0,co().nC)(f)&&"flattened"!==b&&"disabled"!==b,k=(0,te().oC)(c[0]);null!=k&&k.subitemFormat&&S&&y&&(0,co().nC)(y)&&q().Ch({blocksToDuplicate:[...c],duplicatedBlocks:[...d],environment:r,shouldDuplicate:l,originSubitemFormat:k.subitemFormat,destinationSubitemFormat:S,transaction:g,subitemRelationSchema:y,relationPropertyCollectionId:a.id});const T=S?(0,te().Ku)(d,S):void 0,I=T?d.filter(((e,t)=>T.includes(t))):[];for(const R of I){if(w){const e=(0,te().eO)({store:R,subitemFormat:S,propertySchema:f});for(const t of e){const e=re().Bv.createChildStore(R,t);Y().c3({environment:r,sourceStore:e,destStore:R,propertyWithInverse:S,transaction:g})}}if(i){const e=null!=u&&u.isExpanded?"into":"below";(0,Mo().i)({environment:r,collectionContextStore:s,collectionStore:a,subitemPath:p&&(null==p?void 0:p.length)>0?p:[new(bo().PH)((0,te().f5)(m),[])],store:m,before:"into"===e,insertBlockStore:R,insertDirection:e,transaction:g})}}}({environment:i,isInsertingAsSubitem:Boolean(A),shouldDuplicate:k,collectionContextStore:p,collectionStore:l,droppedStores:c,wrappedStores:I,targetSubitemExpandedState:j,subitemPath:g,targetStore:s,transaction:d});const V=b.filter((e=>!B.includes(e))),F=V.indexOf(s),L=a===To().bH.Above||a===To().bH.Left?F:F+1,O=[...V.slice(0,L),...I,...V.slice(L)];(0,Fo().z)({resultIds:O.map((e=>e.id)),collectionViewStore:h,collectionContextStore:p,transaction:d});const D=C().n4(x.sort(),_.sort());Io().default.checkGate({gateName:"intelligent_collections_sort_modal"})?v&&D&&(0,Bo().f)({environment:i,collectionContextStore:p}):(0,Bo().f)({environment:i,collectionContextStore:p});if(!p.collectionViewBlockStore())return;const z=A?s:y,K=I.map((e=>re().Bv.createChildStore(z,{table:E().ev,id:e.id})));return P().td({environment:i,stores:K}),function(e,t){var o,n;(null===(o=e.collectionViewStore())||void 0===o?void 0:o.getFormat().app_config_uri)===at().Lu&&"sprint_board"===(null===(n=Le().default.state.mainEditorCurrentBlockStore)||void 0===n?void 0:n.getFormat().special_page_for_pm_launch)&&jo().tutorialAdvanceToStepAfter(t,"sprints-onboarding","sprint-task-tooltip")}(p,d),K}var Do=()=>o(522419),zo=()=>o(675074),Ko=()=>o(246826);function Ho(e){const{environment:t,collectionStore:o,targetStore:n,droppedDirection:r,files:i,transaction:l,collectionContextStore:s,groupsPointer:a,formulasModule:c}=e,d=s.collectionViewStore(),u=Se().y0(t);if(!d)return;const p=o.inMemoryRecordCache,m=zo().$C({environment:t,files:i,inMemoryRecordCache:p,pageWidth:u,transaction:l,spaceId:o.pointer.spaceId}).map(((e,n)=>{const r=i[n],s=Ko().Wv({environment:t,type:"page",inMemoryRecordCache:p,properties:{title:(0,xt().x9d)(Do().v5(r.name))},transaction:l,spaceId:o.pointer.spaceId});return Ro().BC({parentStore:s.getContentStore(),appendStore:e,transaction:l}),s}));Eo({environment:t,collectionStore:o,targetStore:n,droppedDirection:r,collectionContextStore:s,groupsPointer:a,droppedStores:m,duplicate:!1,transaction:l,collapsedGroup:!1,formulasModule:c})}var Go=()=>o(901389),Wo=()=>o(101981);var No=()=>o(10594),$o=()=>o(187174),Uo=()=>o(158359);var qo=()=>o(873050),Yo=()=>o(97059),Xo=()=>o(851802),Qo=()=>o(970330),Zo=()=>o(645302),Jo=()=>o(522986),en=()=>o(315221),tn=()=>o(843306),on=()=>o(544073),nn=()=>o(945895);function rn(e){const{store:t,resultProps:o,resultComponent:r,collectionContextStore:i,canDrag:l,canDrop:a,getItemSelectableStyle:c,belowDropZoneMargin:p,analyticsName:m,disabled:g,direction:h,onSelectableEnter:f,disableScrollToRevealHorizontal:v,touchDragOnly:y,isLast:x,groupsPointer:C,toggleButton:b,subitemPath:w,disableSelectable:T,itemSelectableHaloStyle:I,passesFilter:R,onSelectableInsertRow:A,blockPropertyValueOverlayStore:P,dropzoneGap:M}=e,_=(0,s().v3)(),V=(0,ue().Zp)(),F=(0,d().K8)((()=>t.canEdit()),[t]),O=(0,d().K8)((()=>t.getAssociatedCollectionStore()),[t]),E=(0,d().K8)((()=>"collectionTypedView"===i.contextType),[i]),D=(0,d().K8)((()=>{const e=i.groupsStore.getGroupState(C);return null==e?void 0:e.resultsStore}),[i,C]),z=(0,d().K8)((()=>L().NM(t)),[t]),K=(0,d().K8)((()=>L().f5({environment:_,collectionContextStore:i})?60:void 0),[i,_]),H=(0,d().K8)((()=>{const e=nn().A.state;return e.isActive&&e.store===t}),[t]),G=!g&&F,W=e.shouldShowHoverMenu&&G,N=h!==pn.Vertical&&a,$=h!==pn.Vertical&&a,U=h===pn.Vertical&&a,q=(0,d().K8)((()=>{var e;return null===(e=i.collectionViewStore())||void 0===e?void 0:e.getType()}),[i]),Y=(0,u().IS)((e=>({haloStyle:{...L().wh(e,z),...("board"===q||"gallery"===q)&&{borderRadius:vs},...I}})),[q,I,z]),X=(0,n.useCallback)((e=>{const{insertStores:o,transaction:n}=e;return O?(0,en().D)({environment:_,collectionStore:O,collectionContextStore:i,groupsPointer:C,insertStores:o,store:t,before:!1,transaction:n}):[]}),[O,i,_,C,t]),Q=(0,n.useCallback)((e=>{const{insertStores:o,transaction:n}=e;return O?(0,en().D)({environment:_,collectionStore:O,collectionContextStore:i,groupsPointer:C,insertStores:o,store:t,before:!0,transaction:n}):[]}),[O,i,_,C,t]),Z=(0,n.useCallback)((async e=>{const{droppedDirection:o,duplicate:n}=e;if(!O)return[];const r=Pe().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");Pe().default.DO_NOT_USE_measureAfterNextFlushLegacy(r,{environment:_,getData:()=>fe().tv({collectionContextStore:i,is_native_drop:!1,is_empty:!1})});const l=o!==To().bH.Onto?(0,No().f0)({stores:e.droppedStores,collectionContextStore:i}):e.droppedStores;if(0===l.length&&E)return void Go().f1((0,S.jsx)(k().sA,{...No().K0.unsupportedGroupAction}));const s=await me().T.formulas.load();B().createAndCommit({userAction:"CollectionGroupResultsItem.handleDrop",environment:_,canUndo:!0,perform:e=>{!Eo({environment:_,collectionStore:E?void 0:O,targetStore:t,droppedDirection:o,collectionContextStore:i,groupsPointer:C,droppedStores:l,duplicate:n,transaction:e,subitemPath:w,collapsedGroup:!1,formulasModule:s})&&E&&Go().f1((0,S.jsx)(k().sA,{...No().K0.unsupportedGroupAction}))}})}),[O,i,_,C,E,t,w]),J=(0,n.useCallback)((async e=>{const{files:o,droppedDirection:n}=e;if(!O)return[];const r=Pe().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");Pe().default.DO_NOT_USE_measureAfterNextFlushLegacy(r,{environment:_,getData:()=>fe().tv({collectionContextStore:i,is_native_drop:!0,is_empty:!1})});const l=await me().T.formulas.load();B().createAndCommit({userAction:"CollectionGroupResultsItem.handleNativeDrop",environment:_,canUndo:!0,perform:e=>{Ho({environment:_,collectionStore:O,targetStore:t,droppedDirection:n,collectionContextStore:i,groupsPointer:C,files:o,transaction:e,formulasModule:l})}})}),[O,i,_,C,t]),ee=(0,n.useCallback)((e=>o=>{let{transaction:n}=o;if(!O)return[];const r=(0,tn().u)({environment:_,collectionContextStore:i,groupsPointer:C,store:t,before:"above"===e,collectionStore:O,transaction:n,subitemPath:w,subitemInsertDirection:"below"});if(Qo().v(_,{...fe().sl(i),type:"page",from:"below"===e?"table_insert_below":"table_insert_above",new_page_id:null==r?void 0:r.id,creating_block_id:null==r?void 0:r.id}),r&&A&&A(t,r),r&&P){const e=()=>{Jo().ho({isNewBlock:!0,environment:_,blockPropertyValueOverlayStore:P,store:r,property:"title",format:Tt().j.Table,collectionContextStore:i})};i.registerCallbackForItemMounted(r,e)}}),[O,P,i,_,C,A,t,w]),te=e.handleOpenPeekPage,oe=(0,n.useCallback)((()=>{const e=i.collectionViewStore();Pe().default.DO_NOT_USE_markLegacy("collections.open_item_page_lag"),te&&te(),j().Ey({collectionContextStore:i,resultsStore:D});const t=null==e?void 0:e.getType();if(t){const e=i.normalizedFormatStore.state.collection_peek_mode,o=e||on().C9[t];Zo().bn(_,{is_peek:!0,from:t,peek_mode:o})}}),[i,_,te,D]),ne=(0,d().K8)((()=>c?c(x):void 0),[c,x]);(0,n.useEffect)((()=>{i.onItemMount(t)}),[t,i]);const re=n.createElement(r,{handleOpenPeekPage:oe,collectionContextStore:i,...o,store:t,key:t.id,isLast:x,toggleButton:b,subitemPath:w,passesFilter:R});return T?re:(0,S.jsx)(lt().A,{style:ne,store:t,canSelect:G,shouldShowHalo:!(H||null!=V&&V.isPreviewing),shouldForceRenderSelectionHalo:z,haloStyle:Y.haloStyle,canDrag:l,canDropBelow:U,canDropLeft:N,canDropRight:$,canNativeDropBelow:U&&!E,canNativeDropLeft:N&&!E,canNativeDropRight:$&&!E,canDropOnto:a,canTriggerContextMenu:G,isLastItem:x,showBlockMenuInput:!0,shouldShowHoverMenu:W,shouldShowCommentMenu:!1,onSelectableDrop:Z,onNativeDrop:J,onInsertBelow:X,onInsertAbove:Q,onRemove:e=>function(e,t,o,n,r){const{transaction:i}=e;r.length>0&&Vo({store:o,transaction:i,groupsPointer:r,collectionContextStore:n,environment:t});gt().by({childStore:o,transaction:i})}(e,_,t,i,C),canInsertAbove:a,canInsertBelow:a,onInsertRowBelow:ee("below"),onInsertRowAbove:ee("above"),belowDropZoneMargin:p,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,analyticsName:m,shouldShowDropZone:a,dropzoneGap:M,onEnter:f,className:he().E4t,disableScrollToRevealHorizontal:v,touchDragOnly:y,groupsPointer:C,verticalDropZoneExtraLeftEdgeOffset:K,children:re})}const ln=n.memo(rn,mo().A);var sn=()=>o(702796);function an(e){const{store:t,collectionContextStore:r,subitemPath:i,titleColumnIndex:l,nestedCreateSubitemButton:a,getItemSelectableStyle:c}=e,p=(0,s().v3)(),{isMobile:m}=(0,s().Y0)(),g=(0,u().DP)(),{currentSubitemFormatStoreForUiDisplayStore:h,subitemExpandedStore:f,subitemTreeStore:v}=r,y=(0,d().K8)((()=>L().Dj({store:t,collectionContextStore:r})),[r,t]),x=(0,d().K8)((()=>{var e;return null===(e=r.collectionViewStore())||void 0===e?void 0:e.getType()}),[r]),{value:b}=(0,ne().fJ)(me().T.formulas),w=(0,d().K8)((()=>i&&i.length>0?i:(0,bo().Qe)(v.state.children,(e=>e.value.store===t))),[i,v,t],{useDeepEqual:!0}),k=(0,n.useMemo)((()=>w?(0,te().kY)(w.map((e=>e.value.store))):""),[w]),T=(0,d().K8)((()=>f.state.get(k)),[f,k]),I=Boolean(null==T?void 0:T.isExpanded),R=(0,d().O$)(h),j=(0,d().K8)((()=>{if(!y||!R)return;const e=y.getSchema()[R.property];return void 0!==e&&(0,co().nC)(e)?e:void 0}),[y,R]),A=(0,d().K8)((()=>{var e;return j&&"relation"===j.type&&(0,co().zO)(j)===(null===(e=r.collectionStore())||void 0===e?void 0:e.id)&&j.property}),[r,j]),M=(0,d().K8)((()=>{const e=!A||x&&(0,te().qS)(x)?void 0:{property:A,filter:{operator:"is_empty"}};return!(!R||!y)&&(0,te().Ch)({store:t,collectionStore:y,subitemFormat:R,subitemPathKey:k,collectionContextStore:r,propertyFilters:[...e&&A?[{id:A,filter:e}]:[],...r.currentPropertyFiltersStore.state],combinatorFilter:r.currentCombinatorFilterStore.state,currentUserId:p.currentUser.id,resultCache:new Map,regExpCache:new Map,formulasModule:b}).length>0}),[r,x,p.currentUser.id,A,y,k,t,R,b]),B=(0,d().K8)((()=>!(!y||!R)&&(M||I||m||"timeline"===x)),[y,R,M,I,m,x]),_=(0,d().K8)((()=>!(!y||!R)&&Xo().A.getState().hoveredStore===t),[y,t,R]),V=(0,d().K8)((()=>{const e=(0,qo().AU)({collectionContextStore:r,collectionStore:y,environment:p});if(e)return(0,o(289915).oR)(e)}),[r,y,p]),F=(0,n.useCallback)((()=>{const e=f.state;if(I){e.delete(k);const o=ie().default.state.stores.filter((e=>t.uiContains(e)));o.length>0&&P().DN({stores:(0,C().R9)(ie().default.state.stores,o)}),function(e,t){ge().vd(e,"subitem_toggle_block_close",t)}(p,{...(0,fe().sl)(r),depth:(null==w?void 0:w.length)||0}),f.emit()}else e.set(k,{isExpanded:!0,limit:20}),function(e,t){ge().vd(e,"subitem_toggle_block_open",t)}(p,{...(0,fe().sl)(r),depth:(null==w?void 0:w.length)||0}),V&&e&&j&&R?(0,te().eI)({blockStore:t,subitemExpandedStore:f,subitemFormat:R,propertySchema:j,compiledFilter:V,pathKey:k,forceStoresToLoad:!1,visitedIds:new Set,resultCache:new Map,regExpCache:new Map}).then((()=>{f.emit()})):f.emit()}),[f,I,k,p,r,null==w?void 0:w.length,t,V,j,R]),O=(0,d().K8)((()=>{const o=v.state;return o&&w&&o.children.length>0?(0,te().ag)(o).value.store===t:e.isLast}),[v,e.isLast,t,w]),E=(0,o(991114).C)(),D=(0,d().K8)((()=>{var e;const o=t.getModel();if(!V||!o)return!0;const n=null===(e=t.getAssociatedCollectionStore())||void 0===e?void 0:e.getPropertyMapping();return V({block:o,getRecordModel:t.getRecordModel,propertyMapping:n,formulaTimeoutTimestampMs:Date.now()+E,resultCache:new Map,regExpCache:new Map,experimentService:Io().default,formulasModule:b})}),[t,V,E,b]),z=(0,d().K8)((()=>(0,Yo().W)(p,t.id)),[p,t]),K=(0,d().K8)((()=>c&&!D||z?()=>({...c?c(O):{},...D?{}:{opacity:.5},...z?{opacity:.5}:{}}):c),[c,D,O,z]);(0,$o().Yb)((async()=>{const e=t.getModel();await t.load();const o=t.getRecordModel;if(!B||!e||!V||!j||!o||!R||D)return;(0,te().eO)({store:t,subitemFormat:R,propertySchema:j}).length>0||(await(0,te().eI)({blockStore:t,subitemExpandedStore:f,subitemFormat:R,propertySchema:j,compiledFilter:V,pathKey:k,forceStoresToLoad:!0,visitedIds:new Set,resultCache:new Map,regExpCache:new Map}),f.emit())}),[B,V,D,k,t,f,R,j]);const H=(0,S.jsx)(ln,{...e,passesFilter:D,isLast:O,getItemSelectableStyle:K,subitemPath:w,toggleButton:B||_?(0,S.jsx)(sn().A,{isSidebar:!1,open:I,fill:!0,onClick:F,color:M||I?g.regularIconColor:g.mediumIconColor,disabled:w&&w.length>=te().x2}):void 0});if(!I||!w||0===w.length||w.length>=te().x2)return H;const G=w[w.length-1].children;return(0,S.jsxs)(S.Fragment,{children:[H,G.map((t=>{const o=t.value.store;return(0,n.createElement)(dn,{...e,key:o.id,store:o,subitemPath:[...w,t]})})),y&&a&&a({store:t,parentStore:y,subitemPath:w,indentLevel:w.length,titleColumnIndex:l}),T&&G.length>0&&G.length===T.limit&&(0,S.jsx)(cn,{collectionContextStore:e.collectionContextStore,pathKey:k,titleColumnIndex:l,limit:T.limit,indentLevel:w.length})]})}const cn=n.memo((function(e){const{collectionContextStore:t,pathKey:o,titleColumnIndex:r,limit:i,indentLevel:l}=e,s=(0,n.useCallback)((()=>{const{subitemExpandedStore:e}=t;e.state.set(o,{isExpanded:!0,limit:i+20}),e.emit()}),[t,i,o]),a=(0,d().K8)((()=>{var e;return"title"===(null===(e=t.collectionViewStore())||void 0===e?void 0:e.getFormat().table_subitem_toggle_column)}),[t]),c=(0,u().IS)((e=>({button:{display:"flex",alignItems:"center",height:32,width:"100%",paddingLeft:(0,_().si)({columnIndex:0,titleColumnIndex:r,indentLevel:l,isSubitemToggleOnTitleColumn:a}),fontSize:14,lineHeight:w().K_.UIRegular.desktop,borderTop:`1px solid ${e.tableDividerColor}`,borderBottom:`1px solid ${e.tableDividerColor}`,background:e.cardContentBackground},icon:{width:14,height:14,marginLeft:-1,marginRight:6,fill:e.lightIconColor},label:{color:e.lightTextColor}})),[r,l,a]);return(0,S.jsxs)(Rt().A,{onClick:s,onMouseDown:Ce().tr,style:c.button,children:[(0,Uo().P)(c.icon),(0,S.jsx)("span",{style:c.label,children:(0,S.jsx)(k().sA,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})})]})})),dn=n.memo(an),un=n.createContext(null);un.displayName="CollectionGroupContainerContext";let pn=function(e){return e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal",e}({});function mn(e){const{collectionContextStore:t,disabled:o,analyticsName:r,direction:i,disableRequest:l,onSelectableEnter:a,canDrop:c,canDrag:u,groupsPointer:p,loadContentCover:m,emptyDroppableSize:g,emptyDroppableStyle:h,virtualizeResults:f,useGroupCompatibleVirtualizer:v}=e,y=(0,s().v3)(),x=(0,Ae().X)("drag_respects_relation_limits"),b=(0,d().K8)((()=>t.collectionViewBlockStore()),[t]),w=(0,n.useMemo)((()=>{if(b)return new(re().Bv)(y,b.pointer)}),[b,y]),{groupState:k,reducer:T}=(0,d().K8)((()=>{const e=t.groupsStore.getGroupState(p);if(!e)return{groupState:void 0,reducer:void 0};const o=e.currentLimit.state,n=t.normalizedSchemaStore.state,r=C().oE(p.map((e=>(0,vo().K8)({schema:n,propertyMapping:void 0,groupBy:t.getGroupByAndGroupFormats().groupBy,group:e,timeZone:(0,yo().P)(),experimentService:Io().default}))));return{groupState:e,reducer:{type:"results",filter:r.length>0?{operator:"and",filters:r}:void 0,limit:o,loadContentCover:m}}}),[t,p,m]),I=(0,d().K8)((()=>{if(t.shouldDelayRenderStore.state)return[];const e=t.groupsStore.getGroupState(p);return(null==e?void 0:e.resultsStore.state)??[]}),[t.groupsStore,t.shouldDelayRenderStore,p]),R=(0,d().K8)((()=>"collectionTypedView"===t.contextType?void 0:t.collectionStore()),[t]),j=(0,d().K8)((()=>{if(!x)return!1;const e=t.normalizedSchemaStore.state;return p.some((t=>{const o=e[t.property];if("relation"===(null==o?void 0:o.type)&&null!=o&&o.property){const t=e[o.property];if("relation"===(null==t?void 0:t.type)&&1===t.limit)return!0}return!1}))}),[t,p,x]),A=i===pn.Vertical;var P;I.length>0&&(null===(P=t.databaseItemsVisibleTracker)||void 0===P||P.handleItemsRenderStart());(0,n.useEffect)((()=>t.renderEmitter.emit()));const M=g||void 0;return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("div",{style:{...A?{height:M}:{width:M},...h},children:(0,S.jsx)(Sn,{collectionContextStore:t,disabled:o,analyticsName:r,direction:i,canDrop:c,groupsPointer:p,instanceCollectionViewBlockStore:w,resultStores:I,droppedIntoCollectionStore:R,onSelectableEnter:a})}),f?(0,S.jsx)(fn,{collectionContextStore:t,groupsPointer:p,resultComponentProps:e,canDrag:u&&!j,useGroupCompatibleVirtualizer:v,groupState:k,resultStores:I}):I.map(((t,o,n)=>(0,S.jsx)(yn,{store:t,isLast:o===n.length-1,...e,canDrag:u&&!j},t.id))),(0,S.jsx)(xn,{collectionContextStore:t,groupsPointer:p,disableRequest:l,resultsReducer:T})]})}const gn=n.memo(mn);function Sn(e){const{collectionContextStore:t,disabled:o,analyticsName:r,direction:i,onSelectableEnter:l,canDrop:a,groupsPointer:c,instanceCollectionViewBlockStore:u,resultStores:p,droppedIntoCollectionStore:m}=e,g=(0,s().v3)(),h=(0,d().K8)((()=>"collectionTypedView"===t.contextType),[t]),f=(0,d().O$)(t.isInHomeWidgetStore),v=(0,d().K8)((()=>L().f5({environment:g,collectionContextStore:t})?60:void 0),[t,g]),y=(0,n.useCallback)((async e=>{const o=await me().T.formulas.load();return function(e,t,o,n,r,i){const{droppedDirection:l,duplicate:s}=e,a=o.collectionViewBlockStore();if(!a)return;const c=Pe().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");Pe().default.DO_NOT_USE_measureAfterNextFlushLegacy(c,{environment:t,getData:()=>fe().tv({collectionContextStore:o,is_native_drop:!1,is_empty:!0})});const d="collectionTypedView"===o.contextType,u=(0,No().f0)({stores:e.droppedStores,collectionContextStore:o});if(0===u.length&&d)return void Go().f1(yt().A.formatMessage(No().K0.unsupportedGroupAction));B().createAndCommit({userAction:"CollectionGroupResults.handleEmptyDroppableDrop",environment:t,canUndo:!0,perform:e=>{!Eo({environment:t,collectionStore:i,targetStore:a,droppedDirection:l,collectionContextStore:o,groupsPointer:n,droppedStores:u,duplicate:s,transaction:e,collapsedGroup:!1,formulasModule:r})&&d&&Go().f1(yt().A.formatMessage(No().K0.unsupportedGroupAction))}})}(e,g,t,c,o,m)}),[t,m,g,c]),x=(0,n.useCallback)((async t=>{const o=await me().T.formulas.load();return function(e,t,o,n,r,i){const{files:l,droppedDirection:s}=e;if(!i)return;const a=o.collectionViewBlockStore();if(!a)return;const c=Pe().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");Pe().default.DO_NOT_USE_measureAfterNextFlushLegacy(c,{environment:t,getData:()=>fe().tv({collectionContextStore:o,is_native_drop:!0,is_empty:!0})}),B().createAndCommit({userAction:"CollectionGroupResults.handleEmptyDroppableNativeDrop",environment:t,canUndo:!0,perform:e=>{Ho({environment:t,collectionStore:i,targetStore:a,droppedDirection:s,collectionContextStore:o,groupsPointer:n,files:l,transaction:e,formulasModule:r})}})}(t,g,e.collectionContextStore,e.groupsPointer,o,m)}),[m,g,e.collectionContextStore,e.groupsPointer]);if(!u)return null;const C=i!==pn.Vertical&&(!o&&0===p.length),b=i===pn.Vertical&&!o;return(0,S.jsx)(lt().A,{store:u,canSelect:!1,canEditText:!1,shouldShowHalo:!f,canDrag:!1,canDropLeft:a&&C,canNativeDropLeft:a&&C&&!h,canDropBelow:a&&b,canNativeDropBelow:a&&b&&!h,canTriggerContextMenu:!1,isLastItem:0===p.length,showBlockMenuInput:!1,shouldShowHoverMenu:!1,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,onSelectableDrop:y,onNativeDrop:x,analyticsName:r,shouldShowDropZone:a,onEnter:l,groupsPointer:c,verticalDropZoneExtraLeftEdgeOffset:v,style:i===pn.Vertical?void 0:{width:"100%",height:"100%"}})}function hn(e){let{collectionContextStore:t,groupsPointer:o,resultComponentProps:r,useGroupCompatibleVirtualizer:i,canDrag:l,groupState:a,resultStores:c}=e;const[u,p]=(0,n.useState)(!i),[m,g]=(0,n.useState)(0),h=(0,n.useContext)(pe().R),f=(0,n.useRef)(null),v=(0,n.useRef)(null),y=c.length<=0,x=(0,n.useContext)(un);(0,n.useEffect)((()=>{if(!i||0===o.length)return;const e=new ResizeObserver((()=>{var e;null===(e=v.current)||void 0===e||e.call(v)}));if(null!=x&&x.current)return e.observe(x.current),()=>e.disconnect();console.error("Missing block to observer resizes on, this will result in a broken virtualizer")}),[x,o.length,i]),(0,n.useEffect)((()=>{if(f.current&&i&&!u&&!y){var e;const t=null==h||null===(e=h.verticalScroller)||void 0===e?void 0:e.getNode();if(!t)return;const o=new IntersectionObserver((e=>{e[0].isIntersecting&&p(!0)}),{root:t,rootMargin:"300px 0px 300px 0px"});return o.observe(f.current),()=>o.disconnect()}}),[u,y,null==h?void 0:h.verticalScroller,i]);const C=(0,n.useCallback)((e=>{var t;f.current=e;const o=null==h||null===(t=h.verticalScroller)||void 0===t?void 0:t.getNode();if(!o)return;const n=()=>{let t=e,n=0;for(;t&&t!==document.body&&t!==o;)n+=t.offsetTop,t=t.offsetParent;g(n)};n(),v.current=n}),[null==h?void 0:h.verticalScroller]),b=(0,n.useCallback)((e=>c[e].id),[c]),w=(0,fo().Te)({count:c.length,estimateSize:()=>34,scrollMargin:m,getScrollElement:()=>{var e;return(null==h||null===(e=h.verticalScroller)||void 0===e?void 0:e.getNode())??null},getItemKey:b,overscan:u?10:0});return function(e){let{virtualizer:t,resultsStores:o,collectionContextStore:r,groupState:i}=e;const l=(0,n.useRef)({fetching:!1,previousTotal:0}),a=(0,s().v3)(),c=t.getVirtualItems(),u=o.length+1,p=(0,d().K8)((()=>{var e;return(null==i||null===(e=i.reducerResultStore)||void 0===e||null===(e=e.state)||void 0===e?void 0:e.hasMore)??!1}),[null==i?void 0:i.reducerResultStore]);(0,n.useEffect)((()=>{if(null!=i&&i.groupsPointer.length)return;const{fetching:e,previousTotal:t}=l.current;e&&t!==u&&(l.current={fetching:!1,previousTotal:0})}),[null==i?void 0:i.groupsPointer.length,u]),(0,n.useEffect)((()=>{if(!p||null==i||!i.groupsPointer||i.groupsPointer.length>0||l.current.fetching)return;const[e]=c.slice(-1);!e||u<=0||e.index-t.options.overscan>.67*u&&(l.current={fetching:!0,previousTotal:u},r.infiniteScrollLongTaskObserver.observe(),(0,So().H)({collectionContextStore:r,environment:a,incrementLimitArgs:{isFullScreen:!0,currentResultCount:o.length,groupsPointer:null==i?void 0:i.groupsPointer,incrementLimitsInRelatedGroups:!1}}))}),[r,a,null==i?void 0:i.groupsPointer,p,o.length,u,c,t.options.overscan])}({virtualizer:w,resultsStores:c,collectionContextStore:t,groupState:a}),(0,n.useEffect)((()=>{t.virtualizedModule.setRowVirtualizer(w)}),[t,w]),y?null:(0,S.jsx)("div",{ref:C,style:{height:w.getTotalSize(),width:"100%",position:"relative"},children:w.getVirtualItems().map((e=>{const t=c[e.index],o=c.length-1===e.index;return(0,S.jsx)("div",{"data-index":e.index,ref:w.measureElement,style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${(e.start??0)-w.options.scrollMargin}px)`},children:(0,S.jsx)(yn,{store:t,isLast:o,...r,canDrag:l},t.id)},e.key.toString())}))})}const fn=n.memo(hn,mo().A);function vn(e){const{isLast:t,collectionContextStore:o,dropzoneGap:r,resultProps:i,resultComponent:l,groupsPointer:s,shouldShowHoverMenu:a,canDrag:c,disabled:u,format:p,getItemSelectableStyle:m,handleOpenPeekPage:g,belowDropZoneMargin:h,analyticsName:f,direction:v,onSelectableEnter:y,canDrop:x,disableScrollToRevealHorizontal:C,touchDragOnly:b,blockPropertyValueOverlayStore:w,onSelectableInsertRow:k,disableSelectable:T,titleColumnIndex:I,nestedCreateSubitemButton:R,itemSelectableHaloStyle:j}=e,A=(0,d().K8)((()=>L().Dj({store:e.store,collectionContextStore:o})),[o,e.store]),P=(0,n.useMemo)((()=>[]),[]);return A?(0,S.jsx)(dn,{getItemSelectableStyle:m,itemSelectableHaloStyle:j,store:e.store,canDrag:c,resultProps:i,resultComponent:l,collectionContextStore:o,groupsPointer:s,shouldShowHoverMenu:a,canDrop:x&&!u,format:p,handleOpenPeekPage:g,belowDropZoneMargin:h,analyticsName:f,disabled:u,direction:v,dropzoneGap:r,onSelectableEnter:y,disableScrollToRevealHorizontal:C,touchDragOnly:b,isLast:t,subitemPath:P,titleColumnIndex:I,blockPropertyValueOverlayStore:w,onSelectableInsertRow:k,disableSelectable:T,nestedCreateSubitemButton:R}):null}const yn=n.memo(vn,mo().A);function xn(e){let{collectionContextStore:t,groupsPointer:o,disableRequest:n,resultsReducer:r}=e;const i=(0,d().K8)((()=>t.groupsStore.getGroupState(o)),[t,o]),l=(0,d().K8)((()=>Io().default.getConfigKey("collection_reducer_request_settings","general_debounce_wait_ms")),[]);return!n&&r&&i?(0,S.jsx)(Wo().A,{id:o.length>0?`results:${(0,so().Hm)(o)}`:"collection_group_results",reducer:r,groupsPointer:o,collectionContextStore:t,resultStore:i.reducerResultStore,debounceWait:l}):null}var Cn=()=>o(228927),bn=()=>o(325383),wn=()=>o(584262),kn=()=>o(612008),Tn=()=>o(857783),In=()=>o(281948),Rn=()=>o(573451),jn=()=>o(357643);function An(e){var t;const{transaction:o,environment:n,collectionContextStore:r,isFullScreen:i,groupsPointer:l,insertAtIndex:s,from:a,transient:c}=e,d=null===(t=r.groupsStore.getGroupState(l))||void 0===t?void 0:t.resultsStore;if(!d)return;r.searchQueryStore.state&&(0,jn().S)({searchQuery:"",collectionContextStore:r,isFullScreen:i});const u=(0,kn().Q)({environment:n,collectionContextStore:r,groupsPointer:l,insertAtIndex:s,shouldCoerce:!0,templateStore:r.defaultPageTemplateStore.state,transaction:o,from:{createBlock:a},inMemoryRecordCache:n.defaultRecordCache.inMemoryRecordCache});if(!u)return;const p=u.coercionSucceeded,m=u.newStore;if(n.device.isMobile)Tn().uK({environment:n,store:m,pageVisitSource:wn().y8.Create});else if(p){const e=m.getBlockTitleStore();P().hc({environment:n,store:m}),M().setSelectionAtEnd({store:e}),(0,Rn().C)({store:m,transient:c})}else{const e="collectionTypedView"===r.contextType;In().VU({environment:n,store:m,peekMode:(0,L().hH)(r),showMoveTo:e,resultsStore:d,collectionContextStore:r,pageVisitSource:wn().y8.Create})}Qo().v(n,{from:a,type:"page",new_page_id:m.id,creating_block_id:m.id,...(0,fe().sl)(r)})}var Pn=()=>o(100622),Mn=()=>o(151744);function Bn(e){const{collectionContextStore:t}=e,o=(0,k().tz)(),n=(0,d().K8)((()=>{var e;return t.databaseType?(0,Mn().Mw)(o,t.databaseType):(0,Mn()._o)(o,null===(e=t.collectionStore())||void 0===e?void 0:e.getModel())}),[t,o]);return(0,S.jsx)(S.Fragment,{children:n})}var _n=()=>o(860118);const Vn={fontSize:14,lineHeight:1.5,minHeight:21,fontWeight:w().Wy.medium,width:"auto"},Fn={fontSize:16,lineHeight:1.5,minHeight:24,fontWeight:w().Wy.medium,width:"auto"};function Ln(e,t,o,n,r){const i=o.getViewType();if(!t.isDefined()||!i)return[];return(0,ft().Wp)({viewType:i,format:o.normalizedFormatStore.state,visible:!0}).filter((i=>n&&i.property!==co().rn||(0,_n().T)({block:t.getModel(),property:i.property,schema:o.normalizedSchemaStore.state,getRecordModel:t.getRecordModel,userId:e.currentUser.id,userTimeZone:(0,yo().P)(),intl:yt().A.getIntl(),experimentService:Io().default,collectionFeatureGates:(0,wo().i)(),formulasModule:r})))}function On(e){const t=e.getViewType();if("board"===t||"gallery"===t){const o=e.normalizedFormatStore.state;return(0,ft().qI)(o,t)}return!1}var En=()=>o(331542);const Dn=function(e){let{shouldShowSpinner:t,color:o,collectionContextStore:n,isFullScreen:r,groupsPointer:i}=e;const l=(0,s().v3)(),{isMobile:a}=(0,s().Y0)(),c=(0,u().IS)((e=>{const t=o||e.lightTextColor,n=a?Fn.fontSize:Vn.fontSize;return{addItemButton:{width:"100%",color:t,borderRadius:vs,boxShadow:"dark"===e.mode?`${Pn().Ay.whiteWithAlpha(.05)} 0px 0px 0px 1px`:`${e.regularDividerColor} 0px 0px 0px 1px`,padding:"12px 16px 12px 16px",minHeight:(0,L().rU)({isMobile:a}),fontSize:n},plusIcon:{width:n,height:n,fill:t},spinner:{margin:"0 0 0 auto"}}}),[o,a]);return(0,S.jsxs)(rt().p,{icon:e=>(0,uo().W)({...e,...c.plusIcon}),isLightGray:!0,size:"lg",style:c.addItemButton,onClick:e=>function(e,t,o,n){if(!(0,Ye().EF)(n))return void(0,Ye().QY)(n);B().createAndCommit({userAction:"BoardGroupAddItemButton.handleClick",environment:n,canUndo:!0,perform:r=>{An({transaction:r,environment:n,collectionContextStore:e,isFullScreen:t,groupsPointer:o,from:"board_group_add_item_bottom",transient:!1})}})}(n,r,i,l),onMouseDown:Ce().tr,children:[(0,S.jsx)(Bn,{collectionContextStore:n}),t&&(0,S.jsx)("div",{style:c.spinner,children:(0,S.jsx)(En().A,{size:"sm"})})]})};var zn=()=>o(365683),Kn=()=>o(319357);function Hn(e){let{color:t,collectionContextStore:o,groupFormat:n,isHovered:r}=e;const{isMobile:i}=(0,s().Y0)(),l=(0,u().IS)((e=>{const o=t||e.lightTextColor,n=i?Fn.fontSize:Vn.fontSize;return{linkButton:{visibility:r?"visible":"hidden",marginTop:8,width:"100%",color:o,borderRadius:vs,padding:"12px 16px 12px 16px",fontSize:n},icon:{width:n,height:n,fill:o}}}),[t,i,r]);return(0,S.jsx)(Kn().O,{collectionContextStore:o,groupFormat:n,renderLinkButton:e=>(0,S.jsx)(rt().p,{icon:e=>(0,zn().H)({...e,...l.icon}),isLightGray:!0,size:"lg",style:l.linkButton,...e,children:(0,S.jsx)(k().sA,{id:"database.findOrCreatePage",defaultMessage:"Link existing"})})})}var Gn=()=>o(395361),Wn=()=>o(721908),Nn=()=>o(896628),$n=()=>o(435009),Un=()=>o(932210),qn=()=>o(244091),Yn=()=>o(743147),Xn=()=>o(164124),Qn=()=>o(296798),Zn=()=>o(492414),Jn=()=>o(231722),er=()=>o(34556),tr=()=>o(299709),or=()=>o(739041),nr=()=>o(886680);function rr(e,t,o,n,r){const i=o.getViewType();if("board"===i||"gallery"===i){const l=(0,ft().yT)(t);P().hc({environment:e,store:t}),M().setSelectionAtEnd({store:l}),(0,Rn().C)({store:t}),r&&(0,or().u)(e,"board_item_edit_mode_enter",{...(0,fe().sl)(o),block_id:t.id,from:r,view_type:i}),n.setState("existing")}}function ir(e,t,o,n,r,i,s,a){const c=r.normalizedSchemaStore.state,d=n.state;if(!d.isOpen)return;const u=Ln(t,o,r,s,a).map((e=>e.property)),p=u.findIndex((e=>e===d.property));let m;if("tab"===e){const e=u.find(((e,t)=>t>p&&(0,nr().B2)(c[e])))||u.find(((e,t)=>!s&&(0,nr().B2)(c[e])));m=e}else{const e=C().Uk(u,((e,t)=>t<p&&(0,nr().B2)(c[e])))||C().Uk(u,((e,t)=>!s&&(0,nr().B2)(c[e])));m=e}m?l().default.afterNextFlush((()=>{Jo().ho({environment:t,blockPropertyValueOverlayStore:n,store:o,property:m,format:Tt().j.Page,collectionContextStore:r})})):s&&l().default.afterNextFlush((()=>{rr(t,o,r,i)})),Jo().VN({environment:t,blockPropertyValueOverlayStore:n}),i.preventEmptyDelete()}function lr(e,t,o,n,r,i,l,s){const a=n.normalizedSchemaStore.state,c=Ln(t,o,n,l,s).map((e=>e.property));let d;if("tab"===e){d=c.length>0?c[0]:void 0}else{d=C().Uk(c,((e,t)=>{const o=a[e];return(0,nr().B2)(o)}))}d&&Jo().ho({environment:t,blockPropertyValueOverlayStore:r,store:o,property:d,format:Tt().j.Page,collectionContextStore:n}),i.preventEmptyDelete()}class sr extends p().default{getInitialState(){return"existing"}preventEmptyDelete(){"new_empty"===this.state&&(this.setState("new"),nn().A.state.isActive&&nn().A.setState({...nn().A.state,transient:!1}))}}const ar=sr;var cr=()=>o(126617);const dr={viewBox:"0 0 16 16",svg:(0,S.jsx)("path",{d:"M11.243 3.457a.803.803 0 0 0-1.13 0l-.554.552a.075.075 0 0 0 0 .106l1.03 1.03a.075.075 0 0 0 .107 0l.547-.546a.1.1 0 0 0 .019-.032.804.804 0 0 0-.02-1.11m-2.246 1.22a.075.075 0 0 0-.106 0l-6.336 6.326a1.1 1.1 0 0 0-.237.393l-.27.87v.002c-.062.232.153.466.389.383l.863-.267q.221-.061.397-.239l6.332-6.331a.075.075 0 0 0 0-.106zm-3.355 6.898a.08.08 0 0 0-.053.022l-1.1 1.1a.075.075 0 0 0 .053.128h9.06a.625.625 0 1 0 0-1.25z"})},ur=(0,g().wt)("pencilLineSmall",dr);var pr=()=>o(8980),mr=()=>o(24611);function gr(e){const t=(0,s().v3)(),n=(0,s().Y0)(),{value:r}=(0,ne().fJ)(me().T.formulas),i=(0,d().K8)((()=>e.collectionContextStore.normalizedFormatStore.state),[e.collectionContextStore.normalizedFormatStore]),l=(0,d().K8)((()=>e.collectionContextStore.getViewType()),[e.collectionContextStore]),a=(0,d().K8)((()=>e.collectionContextStore.permissionScopesStore.state),[e.collectionContextStore.permissionScopesStore]),c=(0,d().K8)((()=>nn().A.state.isActive&&nn().A.state.store===e.store),[e.store]),u=(0,d().K8)((()=>a.canEditContent&&e.store.canEdit()),[a.canEditContent,e.store]),p=(0,d().K8)((()=>Ue().default.state.open&&Ue().default.state.targetStore.id===e.store.id),[e.store.id]),m=(0,d().K8)((()=>{const t=(0,L().hH)(e.collectionContextStore);return(0,nr().lA)(t,!1)}),[e.collectionContextStore]),g=(0,d().K8)((()=>(0,L().wy)({environment:t,store:e.store,mainEditorCurrentBlockStore:Le().default.state.mainEditorCurrentBlockStore,collectionContextStore:e.collectionContextStore,fullyQualified:!1})),[t,e.store,e.collectionContextStore]),h=(0,d().K8)((()=>On(e.collectionContextStore)),[e.collectionContextStore]),f=(0,d().K8)((()=>{const o=l?(0,ft().Wp)({viewType:l,format:i,visible:!0}):[],n=Ln(t,e.store,e.collectionContextStore,c,r);return o.length>0&&o.length!==n.length}),[t,i,c,e.collectionContextStore,e.store,l,r]),v=(0,d().K8)((()=>{var t;const o=le().default.state;return!("editing"!==o.mode||!e.blockPropertyValueOverlayStore.state.isOpen)&&(null===(t=(0,Jn().H7)(o.multiSelection))||void 0===t?void 0:t.store)===(0,ft().yT)(e.store)}),[e.store,e.blockPropertyValueOverlayStore]),y=(0,d().K8)((()=>!(a.isLocked||!a.canEditContent||a.isSyncedCollection||a.isExternallyImportedAndSyncedCollection)&&("collectionTypedView"===e.collectionContextStore.contextType||e.store.canEdit())),[a.canEditContent,a.isExternallyImportedAndSyncedCollection,a.isLocked,a.isSyncedCollection,e.collectionContextStore,e.store]),x=e.lastProxiedUrl&&e.coverFormat&&"contain"!==e.coverAspectFormat&&u,C=y&&!c&&!v&&(h||f),b=c&&!p&&!e.disablePeekButton,w=!e.controlArgs.isRepositioning&&!e.disableMoreButton;return n.isMobile?null:(0,S.jsxs)(o(608581).A,{isVisible:e.controlArgs.isVisible,position:"top",children:[x&&!e.controlArgs.isRepositioning&&(0,S.jsx)(Rt().A,{style:mr().k,onClick:t=>e.controlArgs.handleRepositionClick(t,e.lastProxiedUrl),children:(0,S.jsx)(k().sA,{defaultMessage:"Reposition",id:"collectionViewCardItem.action.reposition"})}),x&&e.controlArgs.isRepositioning&&(0,S.jsx)(Rt().A,{style:mr().k,onClick:e.controlArgs.handleSavePositionClick,children:(0,S.jsx)(k().sA,{defaultMessage:"Save position",id:"collectionViewCardItem.action.savePosition"})}),x&&e.controlArgs.isRepositioning&&(0,S.jsx)(Rt().A,{style:mr().k,onClick:e.controlArgs.handleCancelClick,children:(0,S.jsx)(k().sA,{defaultMessage:"Cancel",id:"collectionViewCardItem.action.cancel"})}),C&&(0,S.jsx)(At().A,{renderTooltip:()=>(0,S.jsx)(k().sA,{defaultMessage:"Edit",id:"collectionCardItem.edit.tooltip"}),render:o=>(0,S.jsx)(Rt().A,{style:mr().k,onClick:()=>{rr(t,e.store,e.collectionContextStore,e.editModeStore,"click")},...o,children:(0,S.jsx)(pr().I,{icon:ur,size:"sm"})})}),b&&(0,S.jsx)(At().A,{renderTooltip:()=>m.tooltip,render:o=>(0,S.jsx)(Rt().A,{style:mr().k,onClick:()=>{g&&($n().oo({environment:t,url:g}),e.editModeStore.preventEmptyDelete())},...o,children:(0,S.jsx)(pr().I,{icon:m.icon,size:"sm"})})}),w&&(0,S.jsx)(At().A,{renderTooltip:()=>(0,S.jsx)(k().sA,{defaultMessage:"Rename, delete, move to and more…",id:"collectionViewCardItem.repositionAction.tooltip"}),render:n=>(0,S.jsx)(Rt().A,{style:mr().k,onClick:n=>{P().Lt({environment:t,store:e.store}),o(901265).it({environment:t,stores:ie().default.state.stores,left:n.clientX,top:n.clientY,showInput:!0,actionSectionGroupKey:"block_in_collection",analyticsFrom:"block_more_menu",optionalAnalyticsProperties:{collectionContextStore:e.collectionContextStore}})},...n,children:(0,S.jsx)(pr().I,{icon:cr().Y,size:"sm"})})})]})}const Sr=n.memo(gr);var hr=()=>o(187533);function fr(e){let{propertyFormat:t,store:o,blockPropertyValueOverlayStore:r,collectionContextStore:i,disabled:l,editModeStore:a,isCardSelected:c}=e;const u=(0,s().v3)(),{value:p}=(0,ne().fJ)(me().T.formulas),{collectionStore:m,canEdit:g}=(0,d().K8)((()=>({collectionStore:o.getAssociatedCollectionStore(),canEdit:o.canEdit()})),[o]),{viewType:h,collectionViewStore:f,isTableWrapped:v}=(0,d().K8)((()=>({viewType:i.getViewType(),collectionViewStore:i.collectionViewStore(),isTableWrapped:Boolean(i.normalizedFormatStore.state.table_wrap)})),[i]),y=(0,d().K8)((()=>i.permissionScopesStore.state.isLocked||!i.permissionScopesStore.state.canEditContent),[i.permissionScopesStore]),x=(0,n.useCallback)((()=>ir("tab",u,o,r,i,a,c,p)),[u,o,r,i,a,c,p]),C=(0,n.useCallback)((()=>ir("untab",u,o,r,i,a,c,p)),[u,o,r,i,a,c,p]),b=(0,n.useCallback)((()=>function(e,t,o,n){Jo().VN({environment:e,blockPropertyValueOverlayStore:t}),P().Lt({environment:e,store:o}),n.preventEmptyDelete()}(u,r,o,a)),[u,r,o,a]);if(!m)return null;const w="gallery"===h?Tt().j.GalleryView:Tt().j.Board;return(0,S.jsx)(hr().m,{store:o,property:t.property,disabled:l||!g,locked:y,format:w,tableWrap:v||Boolean(t.wrap),blockPropertyValueOverlayStore:r,collectionStore:m,showIfEmpty:c,onEnter:b,onEsc:b,onBgClick:b,onTab:x,onUntab:C,collectionViewStore:f},t.property)}const vr=n.memo(fr);var yr=()=>o(693954),xr=()=>o(614505);const Cr=(0,k().YK)({untitledBlock:{defaultMessage:"Untitled",id:"collectionViewCardItem.untitledBlock"},typeAName:{defaultMessage:"Type a name…",id:"collectionViewCardItem.itemName.placeholder"}});function br(e){const{store:t,collectionContextStore:r,editModeStore:i,onTextEsc:l,onTextEnter:a,blockPropertyValueOverlayStore:c,isCardSelected:p}=e,m=(0,s().v3)(),g=(0,s().Y0)().isMobile,h=(0,k().tz)(),{value:f}=(0,ne().fJ)(me().T.formulas),{collectionViewBlockId:v,collectionViewId:y,viewType:x}=(0,d().K8)((()=>{var t,o;return{collectionViewId:null===(t=e.collectionContextStore.collectionViewStore())||void 0===t?void 0:t.id,collectionViewBlockId:null===(o=e.collectionContextStore.collectionViewBlockStore())||void 0===o?void 0:o.id,viewType:e.collectionContextStore.getViewType()}}),[e.collectionContextStore]),C=(0,d().K8)((()=>Ln(m,t,r,p,f)),[m,t,r,p,f]),b=(0,d().K8)((()=>(0,te().Kk)({collectionContextStore:r,blockStore:t})),[t,r]),{titleStore:w,icon:T,isEmptyPage:I,hasError:R}=(0,d().K8)((()=>({titleStore:(0,ft().yT)(t),icon:t.getIcon(),isEmptyPage:t.isEmptyPage(),hasError:t.hasError()})),[t]),j=(0,d().K8)((()=>(t.hasIcon()||!t.isEmptyPage())&&r.shouldShowPageIcon()),[t,r]),A=(0,d().K8)((()=>{var e;return p?h.formatMessage(Cr.typeAName):(null===(e=t.getModel())||void 0===e?void 0:e.getEmptyTitlePlaceholder({getRecordModel:t.getRecordModel,userTimeZone:(0,yo().P)(),intl:h}))||h.formatMessage(Cr.untitledBlock)}),[p,h,t]),_=(0,d().K8)((()=>t.canEdit()&&r.permissionScopesStore.state.canEditContent),[t,r]),V=(0,n.useCallback)((()=>{lr("tab",m,t,r,c,i,p,f)}),[m,t,r,i,c,p,f]),F=(0,n.useCallback)((()=>{lr("untab",m,t,r,c,i,p,f)}),[m,t,r,i,c,p,f]),L=(0,n.useCallback)((()=>{(0,er().x)(),M().clear({environment:m});t.canEdit()&&r.permissionScopesStore.state.canEditContent&&("new_empty"===i.state?l(t):"new"===i.state?a(t):P().Lt({environment:m,store:t}),i.preventEmptyDelete())}),[m,t,r.permissionScopesStore,i,l,a]),O=(0,n.useCallback)((()=>{(0,er().x)();t.canEdit()&&r.permissionScopesStore.state.canEditContent&&("new_empty"===i.state?l(t):P().Lt({environment:m,store:t}),i.preventEmptyDelete())}),[t,r.permissionScopesStore,i,l,m]),E=(0,n.useCallback)((()=>{!function(e,t,o,n){const r=t.getViewType();"board"!==r&&"gallery"!==r||((0,tr().E)({environment:e,collectionContextStore:t,block_id:o.id,property:"title",property_type:"text",from:r}),n.preventEmptyDelete())}(m,r,t,i)}),[m,t,r,i]),D=(0,n.useCallback)((e=>{const o=t.getIconStore();o&&B().createAndCommit({userAction:"CollectionViewCardItemTitle.handleRecordIconChange",environment:m,canUndo:!0,perform:t=>{Ko().KY({store:o,value:e,transaction:t})}})}),[m,t]),z=(0,u().IS)((e=>{const t=C.length>0;return{titleWrap:{position:"relative",width:"gallery"===x?"100%":"auto",display:"flex",paddingLeft:10,paddingRight:10,paddingBottom:t?6:g?12:8,paddingTop:b?4:g?12:8},recordIcon:{float:"left",borderRadius:5,width:24,height:24,marginLeft:-2,...g?{marginTop:0,marginRight:4}:{marginTop:2,marginRight:4}},warningIcon:{fill:e.accentColors.orange[500],paddingBottom:6,paddingTop:6,display:"inline-block",verticalAlign:"bottom",...g?{width:20,marginLeft:2,marginRight:4}:{width:16,marginLeft:4,marginRight:6}},text:{pointerEvents:p?void 0:"none",cursor:p?"text":void 0,flexGrow:1,padding:"2px 1px",whiteSpace:"pre-wrap",...g?Fn:Vn}}}),[p,g,b,C.length,x]),K=(0,n.useMemo)((()=>({type:"page_property_value_match",propertyId:"title",collectionViewId:y,collectionViewBlockId:v})),[v,y]),H=(j||p)&&!R;return(0,S.jsxs)("div",{style:z.titleWrap,children:[H&&(0,S.jsx)(xr().A,{disabled:!1,bucket:"secure",style:z.recordIcon,progressContainerStyle:z.recordIcon,icon:T,store:t,size:g?24:_?20:18,isEmptyPage:I,onChange:D}),R&&(0,yr().Q)(z.warningIcon),(0,S.jsx)(o(246722).A,{store:w,disabled:!p,disableSlashCommands:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableEmbedMenu:!0,onEnter:L,onEsc:O,onTab:V,onUntab:F,onChange:E,placeholder:A,style:z.text,disableSelectAllBlocks:!0,pasteBehavior:"inline",inPageFind:K})]})}const wr=n.memo(br);function kr(e,t){const{store:o,onTextEsc:r,onTextEnter:i,onShiftEnter:l,handleOpenPeekPage:c,collectionContextStore:u,blockPropertyValueOverlayStore:p}=e,m=(0,s().v3)(),g=(0,n.useRef)(null),{value:h}=(0,ne().fJ)(me().T.formulas),f=(0,d().uB)(void 0,ht().A),v=(0,d().uB)(void 0,ar),y=(0,d().r6)((()=>{const t=nn().A.state;return t.isActive&&t.store===e.store}),[e.store]),x=(0,d().O$)(y),C=(0,d().K8)((()=>ie().default.state.stores.includes(o)),[o]),b=(0,d().K8)((()=>{var e,t,n;return!(o.getSpaceId()!==(null===(e=Le().default.state.currentSpaceStore)||void 0===e?void 0:e.id))&&((null===(t=u.collectionViewStore())||void 0===t?void 0:t.getFormat().app_config_uri)===at().Lu&&o.getFormat().app_config_uri===at().e4&&"sprint_board"===(null===(n=Le().default.state.mainEditorCurrentBlockStore)||void 0===n?void 0:n.getFormat().special_page_for_pm_launch))}),[o,u]),w=(0,d().K8)((()=>{const e=Le().default.state.mainEditorCurrentBlockStore;return(0,L().wy)({environment:m,store:o,mainEditorCurrentBlockStore:e,collectionContextStore:u,fullyQualified:!1})}),[m,u,o]),k=(0,n.useCallback)((()=>{rr(m,o,u,v,"space")}),[m,o,u,v]),T=(0,n.useCallback)((()=>{(0,er().x)(),v.preventEmptyDelete()}),[v]),I=(0,n.useCallback)((()=>{i(o)}),[i,o]),R=(0,n.useCallback)((()=>{ir("tab",m,o,p,u,v,x,h)}),[m,o,p,u,v,x,h]),j=(0,n.useCallback)((()=>{ir("untab",m,o,p,u,v,x,h)}),[m,o,p,u,v,x,h]),A=(0,n.useCallback)((()=>{B().createAndCommit({userAction:"CollectionViewCardItem.handleShiftEnter",environment:m,canUndo:!0,perform:e=>{l({blocks:ie().default.state.stores,transaction:e})}})}),[m,l]),P=(0,n.useCallback)((()=>{"new_empty"!==v.state||x||u.defaultPageTemplateStore.state||(r(o),y.removeListener(P))}),[u.defaultPageTemplateStore,v,x,y,r,o]);return(0,a().l)((()=>{var t;const o=le().default.state,n=nn().A.state,r=n.isActive&&n.transient,i="editing"===o.mode&&(null===(t=(0,Jn().H7)(o.multiSelection))||void 0===t?void 0:t.store)===(0,ft().yT)(e.store);i&&r?v.setState("new_empty"):i?v.setState("new"):v.setState("existing")})),(0,n.useEffect)((()=>(y.state&&"new_empty"===v.state&&y.addListener(P),()=>{y.removeListener(P)})),[v,y,P]),(0,je().NW)(o,t,(0,n.useMemo)((()=>({renderedType:"page",getBlockStore:()=>o,getNode:()=>g.current,activate:()=>{w&&(c(),$n().oo({environment:m,url:w}))}})),[m,c,w,o]),(0,S.jsx)(Q().A,{debugName:"CollectionViewCardItem",capture:x,onEsc:T,onEnter:I,onSpace:k,onTab:R,onUntab:j,children:(0,S.jsxs)(Q().A,{debugName:"CollectionViewCardItem",capture:C,onShiftEnter:A,children:[(0,S.jsx)(Ir,{...e,ref:g,mouseStore:f,editModeStore:v,isCardSelected:x,peekUrl:w}),b&&(0,S.jsx)(qn().Ni,{origin:g})]})}))}const Tr=n.memo(n.forwardRef(kr)),Ir=n.memo(n.forwardRef((function(e,t){const{store:r,disabled:i,peekUrl:l,editModeStore:a,handleOpenPeekPage:c,collectionContextStore:p,blockPropertyValueOverlayStore:m,mouseStore:g,isCardSelected:h,coverFormat:f,coverAspectFormat:v,colorStyle:y,coverSizeFormat:x,coverWidth:C,coverHeight:b}=e,k=(0,s().v3)(),T=(0,s().Y0)().isMobile,I=(0,ue().Zp)(),{value:R}=(0,ne().fJ)(me().T.formulas),[j,A]=(0,n.useState)(void 0),P=(0,d().K8)((()=>g.state.mouseEntered),[g]),{viewType:M,isInHomeWidget:_}=(0,d().K8)((()=>({viewType:p.getViewType(),isInHomeWidget:p.isInHomeWidgetStore.state})),[p]),V=(0,d().K8)((()=>(0,Zn().Ay)({store:r,fullyQualified:!1,pageVisitSource:wn().y8.LinkInPage})),[r]),F=(0,d().K8)((()=>On(p)),[p]),L=(0,d().K8)((()=>Ln(k,r,p,h,R)),[k,r,p,h,R]),O=(0,d().K8)((()=>(0,te().xC)({collectionContextStore:p,blockStore:r})),[p,r]),E=(0,d().K8)((()=>(0,te().Kk)({collectionContextStore:p,blockStore:r})),[p,r]),D=(0,d().K8)((()=>(0,o(299545).oC)(r,{recursivelyLoadAllDiscussions:!1})>0),[r]),z=(0,n.useCallback)((e=>{A(e)}),[A]),K=(0,n.useCallback)((e=>{c(),a.preventEmptyDelete()}),[a,c]),H=(0,n.useCallback)((()=>{Ke().A.state||g.setState({...g.state,mouseEntered:!0})}),[g]),G=(0,Wn().d)(H,100),W=(0,n.useCallback)((()=>{g.setState({...g.state,mouseEntered:!1})}),[g]),N=(0,Gn().Y)(W,100),$=(0,n.useCallback)((e=>{B().createAndCommit({userAction:"CollectionViewCardItem.handleFlushTemporaryPosition",environment:k,canUndo:!0,perform:t=>{Nn().G8({store:r,coverPosition:e.imagePosition,transaction:t}),e.reset()}})}),[k,r]),U=(0,n.useCallback)((e=>null!=I&&I.disableAllPointerEvents?null:(0,S.jsx)(Sr,{store:r,collectionContextStore:p,blockPropertyValueOverlayStore:m,coverFormat:f,coverAspectFormat:v,lastProxiedUrl:j,editModeStore:a,controlArgs:e,disablePeekButton:null==I?void 0:I.disablePageLinks,disableMoreButton:null==I?void 0:I.disablePageLinks})),[m,p,I,v,f,a,j,r]),q=(0,u().IS)((e=>{const t="board"===M?(null==y?void 0:y.cardBackgroundColor)||e.boardItemDefaultBackground:e.collectionGalleryPreviewCardBackground,o={background:t,boxShadow:e.homeShadow.card.base};return{linkBox:{borderRadius:vs,position:P?"relative":"static",overflow:"hidden",transition:"background 100ms ease-out",background:t,..."board"===M?{marginBottom:T?10:8}:{height:"100%"},..._?{boxShadow:e.homeShadow.card.base}:{boxShadow:e.shadowXS}},linkBoxInner:{userSelect:h?void 0:"none",WebkitUserSelect:h?void 0:"none",height:"100%",..."board"===M?{minHeight:40}:{display:"flex",flexDirection:"column"}},linkBoxHomeWidget:{background:t,boxShadow:e.homeShadow.card.base},linkBoxHovered:_?o:{background:(null==y?void 0:y.cardHoveredBackgroundColor)||e.cardHoveredBackground},linkBoxPressed:_?o:{background:(null==y?void 0:y.cardPressedBackgroundColor)||e.cardPressedBackground},propertiesWrapper:{paddingTop:F?0:8,lineHeight:1.5,display:"flex",flexDirection:"column",..."board"===M?{paddingBottom:6}:{paddingBottom:8,..._&&{flexWrap:"wrap"}}},iconsWrapper:{display:"flex",alignItems:"center",paddingRight:10,paddingBottom:D?4:8,paddingLeft:!D||E||F?10:4,paddingTop:"gallery"===M&&0===L.length?8:0,marginTop:"board"===M&&D?-2:0},commentsIndicatorWrapper:{display:"flex",alignItems:"center",color:e.lightTextColor,fill:e.lightTextColor,fontWeight:w().Wy.medium,fontSize:12}}}),[M,y,P,T,_,h,D,E,F,L.length]);return"board"!==M&&"gallery"!==M?null:(0,S.jsxs)(Qn().A,{ref:t,href:V,metaHref:T?V:l,onMouseEnter:G,onMouseMove:G,onMouseLeave:N,onClick:K,style:q.linkBox,innerStyle:q.linkBoxInner,hoveredStyle:h?{background:q.linkBox.background}:q.linkBoxHovered,pressedStyle:h?{background:q.linkBox.background}:q.linkBoxPressed,children:[(0,S.jsx)(o(801678).A,{store:r,source:M,mouseStore:g,renderControl:U,small:"small"===x,onFlushTemporaryPosition:$,render:e=>{let{imagePosition:t}=e;return f&&(0,S.jsx)(o(545040).z,{variant:"gallery",store:r,coverWidth:C,coverHeight:b,coverFormat:f,coverAspectFormat:v,coverSizeFormat:x,coverPosition:t,showEmptyGalleryCover:"gallery"===M,onLoadProxiedImage:z,isInHomeWidget:p.isInHomeWidgetStore.state})}}),O&&(0,S.jsx)("div",{style:{paddingRight:6,paddingTop:8,paddingBottom:0,paddingLeft:6,maxWidth:"100%"},children:(0,S.jsx)(Yn().n,{blockStore:r,collectionContextStore:p})}),F&&(0,S.jsx)(wr,{collectionContextStore:p,store:r,blockPropertyValueOverlayStore:m,onTextEsc:e.onTextEsc,onTextEnter:e.onTextEnter,editModeStore:e.editModeStore,isCardSelected:e.isCardSelected}),L.length>0&&(0,S.jsx)("div",{style:q.propertiesWrapper,children:L.map((e=>(0,S.jsx)(vr,{store:r,disabled:i,blockPropertyValueOverlayStore:m,collectionContextStore:p,editModeStore:a,isCardSelected:h,propertyFormat:e},e.property)))}),(D||E)&&(0,S.jsxs)("div",{style:q.iconsWrapper,children:[E&&(0,S.jsx)("div",{style:{display:"flex",alignItems:"center"},children:(0,S.jsx)(Xn().W,{blockStore:r,collectionContextStore:p})}),(0,S.jsx)(Un().g,{store:r,iconStyle:q.commentsIndicatorWrapper,buttonStyle:{position:"relative",marginLeft:E?-3:0}})]})]})})));const Rr=function(e){let{store:t,disabled:o,isFirstItem:n,isLastItem:r,hideContent:i,blockResizerStore:l,isQuickFind:s,style:a,disableCommentMenu:c,disableHoverMenu:d,disableDrag:u,numberedListCounterStore:p,bulletedListFormatStore:m,coverFormat:g,coverAspectFormat:h,coverSizeFormat:f,colorStyle:v,onTextEnter:y,onTextEsc:x,onShiftEnter:C,blockPropertyValueOverlayStore:b,handleOpenPeekPage:w,collectionContextStore:k}=e;return(0,S.jsx)(Tr,{store:t,disabled:o,isFirstItem:n,isLastItem:r,hideContent:i,blockResizerStore:l,isQuickFind:s,style:a,disableCommentMenu:c,disableHoverMenu:d,disableDrag:u,numberedListCounterStore:p,bulletedListFormatStore:m,coverFormat:g,coverAspectFormat:h,coverSizeFormat:f,coverHeight:void 0,coverWidth:void 0,colorStyle:v,onTextEnter:y,onTextEsc:x,onShiftEnter:C,blockPropertyValueOverlayStore:b,handleOpenPeekPage:w,collectionContextStore:k})};var jr=()=>o(62856),Ar=()=>o(569912);class Pr extends p().default{getInitialState(){return{}}}const Mr=Pr;var Br=()=>o(484792),_r=()=>o(599945);const Vr=function(e){let{store:t,disabled:o,isFirstItem:n,isLastItem:r,hideContent:i,blockResizerStore:l,isQuickFind:s,style:a,disableCommentMenu:c,disableHoverMenu:d,disableDrag:u,numberedListCounterStore:p,bulletedListFormatStore:m,coverFormat:g,coverAspectFormat:h,coverSizeFormat:f,coverHeight:v,coverWidth:y,onTextEnter:x,onTextEsc:C,onShiftEnter:b,blockPropertyValueOverlayStore:w,handleOpenPeekPage:k,collectionContextStore:T}=e;return(0,S.jsx)(_r().c,{store:t,step:"demo_collection_record",children:(0,S.jsx)(Tr,{store:t,disabled:o,isFirstItem:n,isLastItem:r,hideContent:i,blockResizerStore:l,isQuickFind:s,style:a,disableCommentMenu:c,disableHoverMenu:d,disableDrag:u,numberedListCounterStore:p,bulletedListFormatStore:m,coverFormat:g,coverAspectFormat:h,coverSizeFormat:f,coverHeight:v,coverWidth:y,colorStyle:void 0,onTextEnter:x,onTextEsc:C,onShiftEnter:b,blockPropertyValueOverlayStore:w,handleOpenPeekPage:k,collectionContextStore:T})})};function Fr(e){let{collectionContextStore:t,groupFormat:o,format:r,schema:i,disabled:l,store:a,blockPropertyValueOverlayStore:c,collectionGalleryViewStore:u,isSingleColumn:p}=e;const m=(0,s().v3)(),g=(0,n.useMemo)((()=>o?[o]:[]),[o]),h=(0,d().O$)(t.permissionScopesStore),f=(0,d().K8)((()=>a.canEdit()&&("collectionTypedView"===t.contextType||h.canEditContent)),[t,h.canEditContent,a]),v=(0,n.useCallback)((e=>{const t=e.blocks;if(t.length>0){const e=t[0],o=e.getBlockTitleStore();P().hc({environment:m,store:e}),M().setSelectionAtEnd({store:o}),(0,Rn().C)({store:e})}}),[m]),y=(0,n.useCallback)((e=>{const o=t.collectionStore(),n=e.getTitleStore();if(!n)return;xt().q4_(n.getValue())?P().Lt({environment:m,store:e}):o&&B().createAndCommit({userAction:"CollectionGalleryView.handleItemTextEsc",environment:m,canUndo:!0,perform:t=>{gt().by({childStore:e,transaction:t})}})}),[t,m]),x=(0,n.useMemo)((()=>p?{position:"absolute",top:6,left:0,right:0,height:4}:{position:"absolute",top:16,bottom:4,width:4,height:"none"}),[p]),{gallery_cover:C,gallery_cover_aspect:b,gallery_cover_size:w}=r,k=!l&&f&&!h.isSyncedCollection,{coverHeight:T,coverWidth:I}=(0,d().K8)((()=>{const{coverHeight:e,coverWidth:t}=u.state;return{coverHeight:e,coverWidth:t}}),[u]),R=(0,n.useMemo)((()=>({format:r,schema:i,onTextEnter:y,onTextEsc:y,onShiftEnter:v,disabled:l,coverFormat:C,coverAspectFormat:b,coverSizeFormat:w,coverHeight:T,coverWidth:I,blockPropertyValueOverlayStore:c,collectionContextStore:t})),[c,t,T,I,b,C,w,l,r,v,y,i]);return(0,S.jsx)(gn,{collectionContextStore:t,groupsPointer:g,format:r,canDrag:k,onSelectableEnter:v,resultProps:R,resultComponent:Vr,canDrop:!0,disabled:l,shouldShowHoverMenu:!1,direction:p?pn.Vertical:pn.Horizontal,belowDropZoneMargin:6,emptyDroppableSize:4,dropzoneGap:10,analyticsName:"gallery",emptyDroppableStyle:x,loadContentCover:C&&"page_content"===C.type})}const Lr=n.memo(Fr);var Or=()=>o(963575),Er=()=>o(710149);function Dr(e){const t=e.minHeight||ps,o=(0,u().IS)((e=>({card:{display:"flex",justifyContent:"center",alignItems:"flex-start",alignSelf:"stretch",borderRadius:4,background:e.largeShimmerColor,minHeight:t}})),[t]);return(0,S.jsx)(Er().A,{style:o.card})}function zr(e){const{hasPartialResults:t}=e;if(!(0,jr().A)(!0,0,100))return null;const o=e.coverHeight??Or().A.card.desktop.medium.height,n=t?void 0:o+40,r=t?1:3,i=C().Hn(r,(e=>(0,S.jsx)(Dr,{minHeight:n},e)));return(0,S.jsx)(S.Fragment,{children:i})}function Kr(e){var t;let{groupFormat:o,store:r,format:i,disabled:l,collectionContextStore:a,schema:c,blockPropertyValueOverlayStore:p,isFullScreen:m,collectionGalleryViewStore:g}=e;const h=(0,s().v3)(),{isMobile:f}=(0,s().Y0)(),v=(0,n.useMemo)((()=>o?[o]:[]),[o]),y=(0,d().K8)((()=>h.WindowSizeStore.state.width<=us),[h.WindowSizeStore]),x=(0,d().K8)((()=>a.groupsStore.anyGroupHasResults()),[a]),C=(0,d().K8)((()=>a.groupsStore.getGroupState(v)),[a,v]),b=(0,d().K8)((()=>g.state.coverHeight),[g]),{reducerResult:w,hasPartialResults:k}=(0,d().K8)((()=>{const e=null==C?void 0:C.reducerResultStore.state;return{reducerResult:e,hasPartialResults:void 0!==e&&(null==e?void 0:e.blockIds.length)>0}}),[C]),T=(0,d().K8)((()=>(0,bn().iv)({collectionContextStore:a,groupsPointer:v,hasPartialResults:k})),[a,v,k]),I=(0,d().K8)((()=>L().XQ({collectionContextStore:a,reducerResult:w,isFullScreen:m})),[a,w,m]),{canEditContent:R,isSyncedCollection:j}=(0,d().K8)((()=>{const e=a.permissionScopesStore.state;return{canEditContent:e.canEditContent,isSyncedCollection:e.isSyncedCollection}}),[a]),A=(0,d().K8)((()=>r.canEdit()&&("collectionTypedView"===a.contextType||R)),[r,a,R]),P=(0,d().O$)(a.isInHomeWidgetStore),M=(0,u().IS)((e=>{const t=i.collection_group_by,n=i.gallery_cover_size,r=f?Fn.fontSize:Vn.fontSize;return{container:{paddingBottom:o?16:void 0},resultsWrapper:{display:"grid",position:"relative",gridTemplateColumns:`repeat(auto-fill, minmax(${y?"100%":`${L().rq(n)}px`}, 1fr))`,gridRowGap:16,gridColumnGap:16,paddingTop:t?1:16,paddingBottom:4,...P?{paddingLeft:8,paddingRight:8}:{}},loadMoreButton:{fontSize:r},loadMoreButtonIcon:{width:r,height:r},renderLoadMoreButtonDivider:{width:"100%",borderTop:o?void 0:`1px solid ${e.tableDividerColor}`,marginTop:4,marginBottom:4}}}),[i.collection_group_by,i.gallery_cover_size,o,P,f,y]);if(!C)return null;const B=void 0!==o,_=!P&&x&&!l&&A&&!j&&(k||!T),V=Boolean(null===(t=i.gallery_properties)||void 0===t||null===(t=t.filter((e=>e.visible)))||void 0===t?void 0:t.length);return(0,S.jsxs)("div",{style:M.container,children:[(0,S.jsxs)("div",{style:M.resultsWrapper,children:[(0,S.jsx)(Lr,{collectionContextStore:a,groupFormat:o,format:i,schema:c,disabled:l,store:r,blockPropertyValueOverlayStore:p,collectionGalleryViewStore:g,isSingleColumn:y}),T&&(0,S.jsx)(zr,{hasGroups:B,hasPartialResults:k,coverHeight:b}),_&&(0,S.jsx)(Gr,{collectionContextStore:a,groupsPointer:v,groupFormat:o,isSingleColumn:y,coverHeight:i.gallery_cover&&b?b:0,isFullScreen:m,hasVisibleProperties:V})]}),I&&(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("div",{style:M.renderLoadMoreButtonDivider}),(0,S.jsx)(ho().Ay,{groupsPointer:v,store:r,collectionContextStore:a,format:i,isFullScreen:m,incrementLimitsInRelatedGroups:!1,style:M.loadMoreButton,iconStyle:M.loadMoreButtonIcon})]})]})}const Hr=n.memo(Kr);function Gr(e){let{groupsPointer:t,groupFormat:o,collectionContextStore:r,isSingleColumn:i,coverHeight:l,isFullScreen:a,hasVisibleProperties:c}=e;const p=(0,s().v3)(),m=(0,k().tz)(),{isMobile:g}=(0,s().Y0)(),h=(0,n.useContext)(Br().n),f=(0,d().K8)((()=>L().fG({collectionContextStore:r,environment:p,intl:m})),[r,p,m]),v=(0,n.useCallback)((e=>{h?h(e):$n().oo({environment:p,url:e})}),[p,h]),y=(0,n.useCallback)((e=>{if(!(0,Ye().EF)(p))return void(0,Ye().QY)(p);const o=r.groupsStore.getGroupState(t);o&&B().createAndCommit({userAction:"CollectionGalleryView.handleAddItemClick",environment:p,canUndo:!0,perform:e=>{const{mainEditorCurrentBlockStore:n}=Le().default.state,i=(0,kn().Q)({environment:p,collectionContextStore:r,groupsPointer:t,shouldCoerce:!0,templateStore:r.defaultPageTemplateStore.state,transaction:e,from:{createBlock:"gallery"},inMemoryRecordCache:p.defaultRecordCache.inMemoryRecordCache});if(!i)return;const l=L().wy({environment:p,store:i.newStore,mainEditorCurrentBlockStore:n,collectionContextStore:r})??(0,Zn().Ay)({store:i.newStore,pageVisitSource:wn().y8.Create});v(l),j().Ey({collectionContextStore:r,resultsStore:o.resultsStore}),Qo().v(p,{from:"gallery_view_add_item_bottom",type:"page",new_page_id:i.newStore.id,creating_block_id:i.newStore.id,...(0,fe().sl)(r)})}})}),[p,r,t,v]),x=(0,u().IS)((e=>{const t=g?Fn.fontSize:Vn.fontSize,o=L().rU({isMobile:g}),n=a&&l&&!i?c?l+o:l:o;return{wrapper:{display:"flex",flexDirection:"column",alignItems:"stretch"},addItemButton:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:g?Fn.fontSize:Vn.fontSize,borderRadius:vs,boxShadow:"dark"===e.mode?`${e.darkDividerColor} 0px 0px 0px 1px`:`${e.regularDividerColor} 0px 0px 0px 1px`,padding:g?"12px 14px 12px 14px":"9px 14px 8px",minHeight:n,height:"100%"},linkExistingButton:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:g?Fn.fontSize:Vn.fontSize,borderRadius:vs,padding:g?"12px 14px 12px 14px":"9px 14px 8px",marginTop:8},buttonContent:{display:"flex",alignItems:"center",marginLeft:-6,color:e.lightIconColor},buttonIcon:{width:t,height:t,marginLeft:i?void 0:-1,marginRight:6,fill:e.lightIconColor}}}),[g,i,l,a,c]);return(0,S.jsxs)("div",{style:x.wrapper,children:[(0,S.jsx)(Rt().A,{onClick:y,onMouseDown:Ce().tr,style:x.addItemButton,children:(0,S.jsxs)("div",{style:x.buttonContent,children:[(0,uo().W)(x.buttonIcon),(0,S.jsx)(Bn,{collectionContextStore:r})]})}),f&&(0,S.jsx)(Kn().O,{collectionContextStore:r,groupFormat:o,renderLinkButton:e=>(0,S.jsx)(Rt().A,{style:x.linkExistingButton,...e,children:(0,S.jsxs)("div",{style:x.buttonContent,children:[(0,zn().H)(x.buttonIcon),(0,S.jsx)(k().sA,{id:"database.findOrCreatePage",defaultMessage:"Link existing"})]})})})]})}var Wr=()=>o(588316),Nr=()=>o(30626),$r=()=>o(863330),Ur=()=>o(797535),qr=()=>o(751086),Yr=()=>o(916260);function Xr(e){const{environment:t,collectionContextStore:o,groupFormat:n,newGroupFormat:r,groupsFormatKey:i,currentGroups:l,transaction:s}=e,a=o.collectionStore();!(0,so().OF)(n.value,r.value)&&a&&(0,qr().a)({environment:t,collectionStore:a,property:n.property,oldValue:n.value,newValue:r.value,preventPublishAppEventsForBlockUpdates:!1,transaction:s});const c=l.map((e=>(0,so().OF)(n.value,e.value)?r:e));(0,Yr().o)({collectionContextStore:o,newGroups:c,groupsFormatKey:i,transaction:s})}function Qr(e){const{newGroupValue:t,groupFormat:o,schema:n,collectionContextStore:r,currentGroups:i,groupsFormatKey:l,collectionStore:s,environment:a}=e,c=n[o.property];if(!c)return;if(!(0,so().Eg)(c))return;const d=o.value;if((0,co().lx)(c)){if(d.type!==c.type)return;if(t.type!==c.type)return;if(void 0===t.value)return;const e=c.options||[],u=t.value,p=e.map((e=>e.value===d.value?{...e,value:u}:e)),m={...c,options:p},g={...n,[o.property]:m},S={...o,value:{...d,value:u}};B().createAndCommit({userAction:"collectionGroupActions.handleCollectionGroupValueChange",environment:a,canUndo:!0,perform:e=>{Xr({environment:a,collectionContextStore:r,groupFormat:o,newGroupFormat:S,currentGroups:i,transaction:e,groupsFormatKey:l}),(0,Ur().I)({environment:a,collectionStore:s,update:{schema:g},transaction:e})}})}else if("person"!==c.type)if((0,so().Vs)(c.type)){if(d.type!==c.type)return;if(t.type!==c.type)return;if(!t.value||"exact"!==t.value.type)return;const e={...o,value:t};B().createAndCommit({userAction:"collectionGroupActions.handleCollectionGroupValueChange",environment:a,canUndo:!0,perform:t=>{Xr({environment:a,collectionContextStore:r,groupFormat:o,newGroupFormat:e,currentGroups:i,groupsFormatKey:l,transaction:t})}})}else"status"===c.type||(0,so()._o)(c.type)||"created_by"===c.type||"last_edited_by"===c.type||"number"===c.type||"checkbox"===c.type||"formula"===c.type||"relation"===c.type||"location"===c.type||(0,b().HB)(c.type);else{if(d.type!==c.type)return;if(t.type!==c.type)return;const e={...o,value:t};B().createAndCommit({userAction:"collectionGroupActions.handleCollectionGroupValueChange",environment:a,canUndo:!0,perform:t=>{Xr({environment:a,collectionContextStore:r,groupFormat:o,newGroupFormat:e,currentGroups:i,groupsFormatKey:l,transaction:t})}})}}var Zr=()=>o(89849),Jr=()=>o(236262),ei=()=>o(161479);const ti=(0,o(583835).Dv)("deleteGroup");var oi=()=>o(357625);var ni=()=>o(939466),ri=()=>o(654062),ii=()=>o(314660),li=()=>o(722872),si=()=>o(575143),ai=()=>o(928600),ci=()=>o(939740),di=()=>o(45552),ui=()=>o(89924),pi=()=>o(893952);const mi="color";const gi=function(e){let{parent:t,groupFormat:o,collectionContextStore:r,groupsFormatKey:i,format:l,query:a,currentGroups:c,groupsLimitStore:u,schema:p}=e;const m=(0,s().v3)(),g=(0,k().tz)(),{device:h}=m,f=(0,Ae().X)("collection_group_reducer_visible"),v=(0,d().K8)((()=>C().oE([fi({environment:m,groupFormat:o,collectionContextStore:r,groupsFormatKey:i,format:l,query:a,currentGroups:c,groupsLimitStore:u,isGroupsReducerV2:f,intl:g}),hi(m,p,o,r)])),[m,o,r,i,l,a,c,u,f,g,p]),y=(0,n.useCallback)((e=>{"string"==typeof e.key&&e.key.includes(mi)||t.close()}),[t]);let x;return x=h.isMobile?{menuType:li().gu.Modal,title:(0,S.jsx)(k().sA,{defaultMessage:"Action",id:"database.collectionGroupActionMenu.title"}),right:(0,S.jsx)(di().DoneMenuText,{}),onClickRight:t.close}:{menuType:li().gu.Popup},(0,S.jsx)(ai().A,{...x,children:(0,S.jsx)(ci().Ay,{type:ci().Oh.Vertical,initialFocus:0,sections:v,onAccept:y})})};async function Si(e,t,o,n,r,i){const l=t.collectionStore();if(!l)return;const s=n.value;if("relation"===s.type&&(0,so().WO)(s.value)){const e=re().Bv.createChildStore(l,{id:s.value.id,table:E().ev});await e.load();const t=e.getAssociatedCollectionStore();await(null==t?void 0:t.load())}B().createAndCommit({userAction:"CollectionGroupActionMenu.handleDelete",environment:e,canUndo:!0,perform:s=>{!function(e){const{environment:t,collectionStore:o,groupsFormatKey:n,property:r,groupFormat:i,currentGroups:l,collectionContextStore:s,transaction:a,intl:c}=e,d=o.getSchema(),u=d[i.property],p=l.filter((e=>!(0,so().OF)(i.value,e.value)));(0,Yr().o)({collectionContextStore:s,newGroups:p,groupsFormatKey:n,transaction:a});const m=i.value;if(u&&(0,co().lx)(u)&&m.type===u.type&&o){const e=(u.options||[]).filter((e=>e.value!==m.value)),n={...u,options:e},r={...d,[i.property]:n};(0,Ur().I)({environment:t,collectionStore:o,update:{schema:r},transaction:a})}const g=t.currentUser.id,S=new Map,h=new Map;o.inMemoryRecordCache.forEachRecord(g,(async e=>{let{model:n}=e;if(n.table!==E().ev)return;const i=re().Bv.createChildStore(o,n.pointer);if(vo().xw({block:n,groupBy:s.getGroupByAndGroupFormats().groupBy,schema:d,property:r,value:m,intl:c,timeZone:(0,yo().P)(),getRecordModel:o.getRecordModel,resultCache:S,regExpCache:h,experimentService:Io().default,collectionFeatureGates:(0,wo().i)()}))if(n.parent_id===o.id)gt().by({childStore:i,transaction:a});else{const e=i.getAssociatedCollectionStore();e&&e.id===o.id&&("page"===i.getType()||"collection_view_page"===i.getType()&&!i.isCollectionViewPageWithContent())&&await X().Af({environment:t,blocks:[i],shouldCheckSuggestEdit:!0})}})),o.isDefaultRecordCache()&&a.postSubmitCallbacks.push((async e=>{const n=await oi().UT(t,ti,{collection:{id:o.id,spaceId:(0,ei().e)(o.pointer.spaceId)},property:r,value:m}).next();if(n.value.error)throw n.value.error}))}({environment:e,collectionStore:l,property:n.property,groupFormat:n,currentGroups:o,groupsFormatKey:r,collectionContextStore:t,transaction:s,intl:i})}}),(0,T().X)({environment:e,collectionContextStore:t,action:"delete_group"})}function hi(e,t,o,n){const r=o.value;if(void 0===r.value)return;const i=t[o.property];if(!i)return;if("select"!==i.type&&"multi_select"!==i.type)return;if(r.type!==i.type)return;const l=(i.options||[]).find((e=>e.value===r.value));if(!l)return;const s=Pn().tS.map((r=>{const i={key:`${mi}_${r}`,render:e=>(0,S.jsx)(pi().A,{...e,color:r,checkState:l.color===r}),action:()=>{!function(e,t,o,n,r){const i=n[o.property];if(!i)return;if(!co().lx(i))return;const l=r.collectionStore();if(!l)return;const s=o.value;if(s.type!==i.type)return;const a=(i.options||[]).map((t=>t.value===s.value?{...t,color:e}:t)),c={...i,options:a},d={...n,[o.property]:c};B().createAndCommit({userAction:"CollectionGroupActionMenu.handleSelectPropertyColorPickerChange",environment:t,canUndo:!0,perform:e=>{(0,Ur().I)({environment:t,collectionStore:l,update:{schema:d},transaction:e})}}),(0,T().X)({environment:t,collectionContextStore:r,action:"group_change_color"})}(r,e,o,t,n)}};return i}));return{key:"collection color section",render:e=>(0,S.jsx)(ui().A,{...e,title:(0,S.jsx)(k().sA,{defaultMessage:"Colors",id:"database.collectionGroupActionMenu.colorSectionTitle"}),topBorder:!0}),items:s}}function fi(e){const{environment:t,groupFormat:o,collectionContextStore:n,groupsFormatKey:r,format:i,query:l,currentGroups:s,groupsLimitStore:a,isGroupsReducerV2:c,intl:d}=e,u=[],p=o.value,m=n.permissionScopesStore.state;("board_columns"===r?void 0===l.aggregations:void 0===i.collection_group_aggregation)?u.push({key:"addAggregation",render:e=>(0,S.jsx)(si().A,{...e,title:(0,S.jsx)(k().sA,{defaultMessage:"Show aggregation",id:"database.collectionGroupActionMenu.addAggregationTitle"}),svg:Zr().h}),action:()=>function(e,t,o,n){const r=n.collectionViewStore();if(r)if("board_columns"===t){const t={...o,aggregations:[so().VR]};B().createAndCommit({userAction:"CollectionGroupActionMenu.handleShowGroupAggregation",environment:e,canUndo:!0,perform:e=>{(0,ri().F)({collectionViewStore:r,update:{query2:t},transaction:e})}})}else B().createAndCommit({userAction:"CollectionGroupActionMenu.handleShowGroupAggregation",environment:e,canUndo:!0,perform:e=>{Nn().zA({stores:[r],update:{collection_group_aggregation:so().VR},transaction:e})}})}(t,r,l,n)}):u.push({key:"removeAggregation",render:e=>(0,S.jsx)(si().A,{...e,title:(0,S.jsx)(k().sA,{defaultMessage:"Hide aggregation",id:"database.collectionGroupActionMenu.removeAggregationTitle"}),svg:ao().e}),action:()=>function(e,t,o,n){const r=n.collectionViewStore();if(r)if("board_columns"===t){const t={...o,aggregations:void 0};B().createAndCommit({userAction:"CollectionGroupActionMenu.handleHideGroupAggregation",environment:e,canUndo:!0,perform:e=>{(0,ii().f)({collectionViewStore:r,update:t,transaction:e})}})}else B().createAndCommit({userAction:"CollectionGroupActionMenu.handleHideGroupAggregation",environment:e,canUndo:!0,perform:e=>{Nn().zA({stores:[r],update:{collection_group_aggregation:void 0},transaction:e})}})}(t,r,l,n)}),(0,so().tx)(o)?u.push({key:"show",render:e=>(0,S.jsx)(si().A,{...e,title:(0,S.jsx)(k().sA,{defaultMessage:"Show group",id:"database.collectionGroupActionMenu.showButtonTitle"}),svg:Zr().h}),action:()=>{c?(0,ni().m)({environment:t,collectionContextStore:n,groupsFormatKey:r,groupFormat:o,action:"toggle_group_visibility",currentGroups:s}):function(e,t,o,n,r,i){const l={...t,hidden:!1},s=(0,No().DF)(r,l,i.state);B().createAndCommit({userAction:"CollectionGroupActionMenu.handleShow",environment:e,canUndo:!0,perform:e=>{(0,Yr().o)({collectionContextStore:o,newGroups:s,groupsFormatKey:n,transaction:e})}}),(0,T().X)({environment:e,collectionContextStore:o,action:"show_group"})}(t,o,n,r,s,a)}}):u.push({key:"hide",render:e=>(0,S.jsx)(si().A,{...e,title:(0,S.jsx)(k().sA,{defaultMessage:"Hide group",id:"database.collectionGroupActionMenu.hideButtonTitle"}),svg:ao().e}),action:()=>{c?(0,ni().m)({environment:t,collectionContextStore:n,groupsFormatKey:r,groupFormat:o,action:"toggle_group_visibility",currentGroups:s}):function(e,t,o,n,r){const i={...t,hidden:!0},l=(0,No().LS)(r,i);B().createAndCommit({userAction:"CollectionGroupActionMenu.handleHide",environment:e,canUndo:!0,perform:e=>{(0,Yr().o)({collectionContextStore:o,newGroups:l,groupsFormatKey:n,transaction:e})}}),(0,T().X)({environment:e,collectionContextStore:o,action:"hide_group"})}(t,o,n,r,s)}}),void 0===p.value||!m.canEditContent||m.isSyncedCollection||"collectionTypedView"===n.contextType||m.isExternallyImportedAndSyncedCollection||u.push({key:"delete",render:e=>(0,S.jsx)(si().A,{...e,title:(0,S.jsx)(k().sA,{defaultMessage:"Delete pages",id:"database.collectionGroupActionMenu.deleteButtonTitle"}),svg:Jr().I}),action:()=>function(e,t,o,n,r,i){Go().ui({message:(0,S.jsx)(k().sA,{defaultMessage:"Are you sure? All pages inside this group will be deleted.",id:"database.collectionGroupActionMenu.deleteDialogMessage"}),showCancel:!0,keepFocus:!1,items:[{label:"Delete",color:"red",onAccept:()=>Si(e,t,o,n,r,i)}]})}(t,n,s,o,r,d)});const g={key:"collection group",render:e=>(0,S.jsx)(ui().A,{...e}),items:u};return g}var vi=()=>o(67657),yi=()=>o(478184),xi=()=>o(722372),Ci=()=>o(553965);function bi(e,t){const{calculating:o,aggregation:n}=e.asyncAggregationStatusStore.state;return n?o&&(0,C().n4)(t,n):o}function wi(e){let{collectionContextStore:t,aggregation:o,children:r}=e;const{isCalculating:i,changingType:l}=(0,d().K8)((()=>({isCalculating:bi(t,o),changingType:t.asyncAggregationStatusStore.state.changingType})),[t,o]),s=function(e,t){const o=(0,n.useRef)(e);return(0,n.useEffect)((()=>{t||void 0===e&&"-"===e||(o.current=e)}),[t,e]),o.current}(r,i);return i?l?(0,S.jsx)(En().A,{}):(0,S.jsx)("span",{style:{opacity:.5},children:s??r}):(0,S.jsx)(S.Fragment,{children:r})}var ki=()=>o(509060);const Ti=(0,k().YK)({propertyAggregation:{id:"collection.aggregation.propertyType",defaultMessage:"{aggregationType} in {propertyName}{calculating, select, true { (Calculating…)} other {}}"},aggregationType:{id:"collection.aggregation.aggregationType",defaultMessage:"{aggregationType}{calculating, select, true { (Calculating…)} other {}}"},aggregationCalculating:{id:"collection.aggregation.calculating",defaultMessage:"Calculating…"}});var Ii=()=>o(760217),Ri=()=>o(406699),ji=()=>o(662971);function Ai(e){let{schema:t,groupFormat:o,format:n,groupAggregationKey:r,collectionContextStore:i,disabled:l,groupsResultStore:a}=e;const c=(0,s().Y0)(),p=(0,d().K8)((()=>n[r]||{aggregator:"count"}),[n,r]),m=(0,d().O$)(a),g=(0,d().K8)((()=>({type:"aggregation",filter:(0,vo().Yy)({schema:t,group:o,groupBy:i.getGroupByAndGroupFormats().groupBy,propertyMapping:void 0,timeZone:(0,yo().P)(),experimentService:Io().default}),aggregation:p})),[i,t,o,p]),h=(0,u().IS)((e=>({button:{fontWeight:w().Wy.medium,color:e.lightTextColor,height:24}})),[]);return(0,S.jsx)(At().A,{renderTooltip:()=>(0,S.jsx)(Di,{schema:t,collectionContextStore:i,aggregation:p}),render:e=>(0,S.jsx)(Ri().Ay,{popupType:c.isMobile?Ri().z7.BottomSheet:Ri().z7.Popup,renderOrigin:n=>(0,S.jsx)(rt().p,{disabled:l,style:h.button,...(0,Ci().A)((0,Ci().A)(e,n),{onClick:Ce().kV}),children:"v2"===(null==m?void 0:m.version)?(0,S.jsx)(Ei,{collectionContextStore:i,schema:t,aggregation:p,groupFormat:o,groupsResultStore:a}):(0,S.jsx)(Oi,{schema:t,collectionContextStore:i,groupFormat:o,aggregation:p,reducer:g})}),disabled:l,render:e=>(0,S.jsx)(Li,{aggregation:p,parent:e,collectionContextStore:i,format:n,groupAggregationKey:r,schema:t})})})}function Pi(e){let{aggregationType:t,isSelected:o,label:n,props:r}=e;const i=xi().cx[t];return(0,S.jsx)(At().A,{placement:Fe().W.Right,delayThreshold:0,render:e=>(0,S.jsx)(Ii().A,{title:n,checkState:o,...(0,Ci().A)(e,r)}),renderTooltip:()=>(0,S.jsxs)("div",{style:{width:140,whiteSpace:"normal"},children:[i&&(0,S.jsx)("img",{src:(0,yi().L)(i),style:{borderRadius:6,width:140,marginTop:4}}),xi().fp[t]]})},r.key)}function Mi(e,t,o,n,r){const i=o.collectionViewStore();i&&(o.isLoadingStore.state||o.loadingDetailsStore.setState({type:"load_aggregation"}),o.isClientModeEnabledStore.state||o.asyncAggregationStatusStore.setState({calculating:!0,aggregation:e,changingType:!0}),B().createAndCommit({userAction:"CollectionGroupAggregation.handleChangeAggregation",environment:t,canUndo:!0,perform:t=>{(0,ri().F)({collectionViewStore:i,update:{format:{...n,[r]:e}},transaction:t})}})),(0,T().X)({environment:t,collectionContextStore:o,action:"change_aggregation"})}function Bi(e,t,o,n,r,i,l){const s=xi().zY[o];return{key:o,render:t=>(0,S.jsx)(Pi,{isSelected:e,aggregationType:o,label:s,props:t}),action:()=>{Mi({aggregator:o,enforceMaxAggregationLimit:t},n,r,i,l)}}}function _i(e,t,o,n,r){const i=e.enforceMaxAggregationLimit??!1,l={...e,enforceMaxAggregationLimit:!i};return{key:"aggregationLimitToggle",render:e=>(0,S.jsx)(ki().A,{on:i,menuListItemProps:e}),action:()=>Mi(l,t,o,n,r)}}function Vi(e,t,o,n,r,i,l,s){const{device:a}=n,c=xi().zY[t],d=C().oE(o.map((o=>function(e,t,o,n,r,i,l,s,a){const c=i[t];if(!c)return;const d=c.name;return{key:`${t}${o}`,render:t=>(0,S.jsx)(Pi,{isSelected:e,aggregationType:o,label:d,props:t}),action:()=>{Mi({aggregator:o,property:t,enforceMaxAggregationLimit:n},r,l,s,a)}}}((null==e?void 0:e.aggregator)===t&&(null==e?void 0:e.property)===o,o,t,e.enforceMaxAggregationLimit??!1,n,r,i,l,s)))),u=d.findIndex((o=>o.key===`${e.property}${t}`));return{key:t+c,render:(e,t)=>(0,S.jsx)(ji().A,{...e,onFocus:t.onFocus,renderOrigin:(e,t)=>(0,S.jsx)(Ii().A,{...e,ref:t,title:c}),renderExtension:(e,o)=>{let n;return n=a.isMobile?{menuType:li().gu.Modal,title:c,right:a.isPhone?(0,S.jsx)(di().DoneMenuText,{}):void 0,onClickRight:o.close,...e}:{menuType:li().gu.Popup,width:200,...e},(0,S.jsx)(ai().A,{...n,children:(0,S.jsx)(ci().Ay,{type:ci().Oh.Vertical,initialFocus:u,sections:[{key:"results",render:e=>(0,S.jsx)(ui().A,{...e}),items:d}],onAccept:t.onAccept})})}}),action:()=>null}}function Fi(e,t,o,n,r,i){const l={};for(const u of vi().VD)l[u]=Bi(e.aggregator===u,e.enforceMaxAggregationLimit??!1,u,t,o,n,r);const s=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,vi().wG)(o)&&!("rollup"===o.type&&"status"===o.target_property_type)}))}(i);if(s.length>0)for(const u of vi().CG)"show_unique"!==u&&(l[u]=Vi(e,u,s,t,i,o,n,r));const a=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,vi().OC)(o)}))}(i);if(a.length>0)for(const u of vi().Sn)l[u]=Vi(e,u,a,t,i,o,n,r);const c=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,vi().fo)(o)}))}(i);if(c.length>0)for(const u of vi().zE)l[u]=Vi(e,u,c,t,i,o,n,r);const d=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,vi().s_)(o)}))}(i);if(d.length>0)for(const u of vi().QO)l[u]=Vi(e,u,d,t,i,o,n,r);return l}function Li(e){let{aggregation:t,parent:o,collectionContextStore:n,format:r,groupAggregationKey:i,schema:l}=e;const a=(0,s().v3)(),{device:c}=a,{actions:d,initialFocus:u}=function(e,t,o,n,r,i){const{device:l}=t,s=[];let a=0,c=0;const d=Fi(e,t,o,n,r,i);let u=0;return Object.entries(vi().Kn).forEach((i=>{let[p,m]=i;const g=[];for(const t of m)d[t]&&(g.push(d[t]),e.aggregator===t&&(a=u,c=g.length-1));const h=[];if("count_aggregations"===p&&h.push({key:"limitToggleSection",render:e=>(0,S.jsx)(ui().A,{...e}),items:[_i(e,t,o,n,r)]}),h.push({key:"aggregations",render:e=>(0,S.jsx)(ui().A,{topBorder:!0,...e}),items:g}),g.length>0){u++;const e=xi().jA[p],t={key:e,render:(t,o)=>(0,S.jsx)(ji().A,{...t,disableDefaultClick:!0,onFocus:o.onFocus,renderOrigin:(t,o)=>(0,S.jsx)(Ii().A,{...t,ref:o,title:e}),renderExtension:(t,n)=>{let r;return r=l.isMobile?{menuType:li().gu.Modal,title:e,right:(0,S.jsx)(di().DoneMenuText,{}),onClickRight:n.close,...t}:{menuType:li().gu.Popup,width:250,...t},(0,S.jsx)(ai().A,{...r,children:(0,S.jsx)(ci().Ay,{type:ci().Oh.Vertical,initialFocus:c,sections:h,onAccept:(e,t,r)=>{n.close(),o.onAccept&&o.onAccept(e,t,r)}})})}}),action:()=>null};s.push(t)}})),{actions:s,initialFocus:a}}(t,a,n,r,i,l);let p;return p=c.isMobile?{menuType:li().gu.Modal,title:(0,S.jsx)(k().sA,{defaultMessage:"Aggregation",id:"database.collectionGroupAggregation.title"}),right:(0,S.jsx)(di().DoneMenuText,{}),onClickRight:o.close}:{menuType:li().gu.Popup,width:200},(0,S.jsx)(ai().A,{...p,children:(0,S.jsx)(ci().Ay,{type:ci().Oh.Vertical,initialFocus:u,sections:[{key:"aggregation section",render:e=>(0,S.jsx)(ui().A,{...e}),items:d}],onAccept:o.close})})}function Oi(e){let{schema:t,collectionContextStore:o,groupFormat:n,aggregation:r,reducer:i}=e;return i?(0,S.jsx)(Wo().A,{id:`group_aggregation:${(0,so().Ix)(n)}`,collectionContextStore:o,reducer:i,groupsPointer:[n],render:e=>{const n=e.state;let i,l;if((0,vi().G9)(r)){const e=t[r.property];!e||"formula"!==e.type&&"number"!==e.type||(i=e.number_format),e&&"date"===e.type&&(l=e.date_format)}return(0,S.jsx)(wi,{aggregation:r,collectionContextStore:o,children:n?(0,xi().rv)({numberFormat:i,dateFormat:l,aggregation:r,userTimeZone:(0,yo().P)(),value:n.aggregationResult,numberPrecision:void 0}):"–"})}}):null}function Ei(e){const t=(0,d().K8)((()=>{var t;const o=e.groupsResultStore.state;if(!o||"v2"!==o.version)return;const n=(0,so().Ix)(e.groupFormat);return null===(t=o.aggregationResults)||void 0===t?void 0:t[n]}),[e.groupFormat,e.groupsResultStore]);let o,n;if((0,vi().G9)(e.aggregation)){const t=e.schema[e.aggregation.property];!t||"formula"!==t.type&&"number"!==t.type||(o=t.number_format),t&&"date"===t.type&&(n=t.date_format)}return(0,S.jsx)(wi,{aggregation:e.aggregation,collectionContextStore:e.collectionContextStore,children:t?(0,xi().rv)({numberFormat:o,dateFormat:n,aggregation:e.aggregation,userTimeZone:(0,yo().P)(),value:t.aggregationResult,numberPrecision:void 0}):"–"})}function Di(e){let{schema:t,collectionContextStore:o,aggregation:n}=e;const r=(0,k().tz)(),i=xi().zY[(0,vi().V1)(n)],l=(0,d().K8)((()=>bi(o,n)),[o,n]);if((0,vi().G9)(n)){const e=t[n.property];if(e){const t=e.name;return(0,S.jsx)(S.Fragment,{children:r.formatMessage(Ti.propertyAggregation,{aggregationType:i,propertyName:t,calculating:l})})}}return(0,S.jsx)(S.Fragment,{children:r.formatMessage(Ti.aggregationType,{aggregationType:i,calculating:l})})}var zi=()=>o(632537),Ki=()=>o(852302);function Hi(e){const{onMount:t,isInPeekRenderer:r,style:i,paddingTop:a,disabled:c,stickyStyle:p,transitionStickyStyle:m,groupFormat:g,collectionContextStore:h,format:f,groupAggregationKey:v,stickyWrapStyle:y}=e,[x,C]=(0,n.useState)(void 0),b=(0,s().v3)(),w=(0,ue().Zp)(),k=(0,n.useRef)(null);(0,n.useEffect)((()=>{null==t||t()}),[t]),(0,n.useEffect)((()=>{const e=h.collectionViewBlockStore();e&&C(new(re().Bv)(b,{table:E().ev,id:e.id}))}),[h,b]);const T=(0,d().K8)((()=>h.groupsStore.getGroupState(g)),[h.groupsStore,g]),I=(0,n.useMemo)((()=>{if((0,so().D1)(g.value)&&(0,so().WO)(g.value.value))return new(re().Bv)(b,g.value.value)}),[b,g.value]),R=(0,d().K8)((()=>Boolean((null==I?void 0:I.isReady())&&!(null!=I&&I.canRead()))),[I]),j=(0,d().K8)((()=>null==T?void 0:T.toggleStateStore.state),[T]),A=(0,d().O$)(h.permissionScopesStore),M=(0,d().K8)((()=>!c&&h.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0})&&!R),[h,c,R]),_=(0,d().O$)(h.isInHomeWidgetStore),V=(0,d().K8)((()=>void 0!==f[v]&&!(null!=w&&w.isPreviewing)),[f,v,w]),F=(0,L().Oz)(h),O=(0,d().K8)((()=>_?"transparent":(null==F?void 0:F.background)||void 0),[F,_]),D=(0,d().O$)(h.isUnlistedViewStore),z=(0,u().IS)((t=>{const o=D?t.surface.elevated:r?t.cardContentBackground:t.contentBackground;return{topLevelDiv:{position:"relative",zIndex:87,width:"100%",background:void 0===O?o:O,fontSize:14,overflow:e.stickyLeft?void 0:"auto",...i},stickyWrapStyle:{display:"flex",alignItems:"center",height:e.height??33,paddingTop:a,...e.stickyLeft&&{position:"sticky",left:e.isFullScreen||e.isRootChild?e.paddingLeft:0},...!j&&{marginBottom:e.toggleClosedMarginBottom},...y}}}),[O,r,j,a,e.height,e.isFullScreen,e.isRootChild,e.paddingLeft,e.stickyLeft,e.toggleClosedMarginBottom,i,y,D]),K=(0,d().K8)((()=>b.WindowSizeStore.state.height),[b.WindowSizeStore]),H=(0,n.useCallback)((()=>{if(!T)return;P().IU({environment:b});const e=!j;if((0,o(294917).J)({environment:b,groupFormat:g,toggleStateStore:T.toggleStateStore,newValue:e,collectionContextStore:h}),!e){const e=k.current,t=null==e?void 0:e.parentElement;t&&l().default.afterNextFlush((()=>{(0,Re().uf)({environment:b,el:t,windowHeight:K,minEdgeDist:50}),h.renderEmitter.emit()}))}}),[h,b,g,T,j,K]),G=(0,n.useCallback)((()=>(0,S.jsx)(sn().A,{isSidebar:!1,open:j??!1,fill:!0,onClick:H,onMouseDown:Ce().tr,style:{flexShrink:0}})),[H,j]),W=(0,n.useCallback)((async e=>{const{droppedStores:t,duplicate:o}=e,n=k.current;if(!(n&&n instanceof Element))return;const r=await me().T.formulas.load();B().createAndCommit({userAction:"CollectionGroupHeader.handleDrop",environment:b,canUndo:!0,perform:e=>Eo({environment:b,collectionContextStore:h,groupsPointer:[g],droppedStores:t,duplicate:o,transaction:e,collapsedGroup:!0,collectionStore:void 0,targetStore:void 0,droppedDirection:void 0,formulasModule:r})})}),[h,b,g]),N=(0,n.useMemo)((()=>({...p,paddingLeft:e.paddingLeft})),[p,e.paddingLeft]);return T&&x?(0,S.jsx)(Ki().g,{stickyAttachPoint:_?"no-stick":"ceiling",stickyStyle:N,transitionStickyStyle:m,nodeRef:k,children:(0,S.jsxs)("div",{style:z.topLevelDiv,ref:k,children:[(0,S.jsx)("div",{style:z.stickyWrapStyle,children:(0,S.jsx)("div",{style:{display:"flex",alignItems:"center",position:e.stickyLeft?"sticky":void 0,left:e.paddingLeft,overflow:"hidden"},children:(0,S.jsxs)(lt().A,{store:x,canDropOnto:!c&&!j,onSelectableDrop:W,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,analyticsName:"board_hidden_group",shouldShowDropZone:!0,groupsPointer:[g],style:{display:"flex",alignItems:"center",height:"100%",overflow:"hidden"},canSelect:!1,children:[G(),(0,S.jsx)($i,{collectionGroupHeaderProps:e}),V&&(0,S.jsx)(Wi,{groupsResultStore:e.groupsResultStore,disabled:e.disabled,format:e.format,schema:e.schema,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,groupAggregationKey:e.groupAggregationKey}),!c&&A.canConfigureBlock&&(0,S.jsx)(Ni,{groupFormat:e.groupFormat,currentGroups:e.currentGroups,format:e.format,schema:e.schema,query:e.query,collectionContextStore:e.collectionContextStore,groupsFormatKey:e.groupsFormatKey,isGroupHoveredStore:e.isGroupHoveredStore}),M&&(0,S.jsx)(Ui,{collectionGroupHeaderProps:e,isGroupHoveredStore:e.isGroupHoveredStore})]})})}),e.children]})}):null}const Gi=n.memo(Hi);function Wi(e){let{disabled:t,format:o,schema:n,collectionContextStore:r,groupFormat:i,groupsResultStore:l,groupAggregationKey:s}=e;const a=(0,d().K8)((()=>r.permissionScopesStore.state.canConfigureBlock),[r]);return(0,S.jsx)(Ai,{groupsResultStore:l,groupFormat:i,disabled:t||!a,groupAggregationKey:s,format:o,schema:n,collectionContextStore:r})}function Ni(e){let{groupFormat:t,currentGroups:o,format:n,schema:r,query:i,collectionContextStore:l,groupsFormatKey:a,isGroupHoveredStore:c}=e;const p=(0,k().tz)(),m=(0,s().Y0)(),g=(0,d().K8)((()=>l.groupsLimitStore),[l]),h=(0,d().O$)(c),[f,v]=(0,Wr().A)(),y=(0,u().IS)((()=>({button:{transition:m.isMobile?void 0:"opacity 100ms ease-in-out",opacity:m.isMobile?void 0:h||v?1:0}})),[m.isMobile,v,h]);return(0,S.jsx)(Ri().Ay,{popupType:m.isMobile?Ri().z7.SlideUp:Ri().z7.Popup,renderOrigin:e=>(0,S.jsx)(jt().A,{ariaLabel:p.formatMessage({id:"actionButtonComponent.ariaLabel",defaultMessage:"Show group options"}),ref:f,icon:Nr()._,style:y.button,...e}),onClick:Ce().kV,render:e=>(0,S.jsx)(gi,{parent:e,groupFormat:t,currentGroups:o,format:n,schema:r,query:i,collectionContextStore:l,groupsFormatKey:a,groupsLimitStore:g})})}function $i(e){let{collectionGroupHeaderProps:t}=e;const o=(0,s().v3)(),{groupFormat:n,schema:r,disabled:i,currentGroups:l,groupBy:a,collectionContextStore:c}=t,u=(0,d().O$)(c.permissionScopesStore);return(0,S.jsx)(zi().A,{groupBy:a,groupFormat:n,currentGroups:l,schema:r,disabled:i||!u.canConfigureCollection||u.isSyncedCollection,isHiddenGroup:!1,onChange:e=>function(e,t,o){const{collectionContextStore:n}=o,r=n.collectionStore();r&&(Qr({...e,environment:t,collectionStore:r,...o}),(0,T().X)({environment:t,collectionContextStore:n,action:"rename_group"}))}(e,o,t),style:{maxWidth:400,lineHeight:"24px"},uncategorizedIconStyle:{marginLeft:2},collectionContextStore:c})}function Ui(e){let{collectionGroupHeaderProps:t,isGroupHoveredStore:o}=e;const n=(0,k().tz)(),r=(0,s().Y0)(),i=(0,s().v3)(),l=(0,d().O$)(o),[a,c]=(0,Wr().A)(),p=(0,u().IS)((()=>({button:{transition:r.isMobile?void 0:"opacity 100ms ease-in-out",opacity:r.isMobile?void 0:l||c?1:0}})),[r.isMobile,c,l]);return(0,S.jsx)(At().A,{renderTooltip:()=>(0,S.jsx)(k().sA,{defaultMessage:"Create new",id:"database.collectionGroupHeader.actions.addNewPage.tooltip"}),render:e=>(0,S.jsx)(jt().A,{ariaLabel:n.formatMessage({id:"collectionGroupHeader.actions.addNewPage.ariaLabel",defaultMessage:"Add new page in group"}),ref:a,icon:$r().plusSmallIcon,onClick:()=>function(e,t){const{groupFormat:o,collectionContextStore:n,isFullScreen:r,onGroupHeaderAddItem:i}=t;n.groupsStore.getGroupState(o)&&(0,Ye().EF)(e)&&(n.searchQueryStore.state&&(0,jn().S)({searchQuery:"",collectionContextStore:n,isFullScreen:r}),B().createAndCommit({userAction:"CollectionGroupHeader.handleAddItemClick",environment:e,canUndo:!0,perform:r=>{const l=(0,kn().Q)({environment:e,collectionContextStore:n,groupsPointer:[o],insertAtIndex:0,shouldCoerce:!0,templateStore:n.defaultPageTemplateStore.state,transaction:r,from:{createBlock:"group_header"},inMemoryRecordCache:e.defaultRecordCache.inMemoryRecordCache});l&&(i(l.newStore,l.coercionSucceeded,t),Qo().v(e,{from:"group_add_item_top",type:"page",new_page_id:l.newStore.id,creating_block_id:l.newStore.id,...(0,fe().sl)(n)}))}}))}(i,t),style:p.button,...e})})}var qi=()=>o(700500),Yi=()=>o(187899);async function Xi(e){const{update:t,collectionContextStore:o,groupsFormatKey:n,collectionStore:r,environment:i,schema:l,groupBy:s}=e,a=l[s.property];if(!a)return;const c="relation"===a.type&&(0,co().zO)(a),d=c&&new(re().md)(i,{table:Co().Vl,id:c});d&&await d.load(),B().createAndCommit({userAction:"collectionGroupActions.handleCollectionAddGroupButtonAccept",environment:i,canUndo:!0,perform:e=>{if(t.newGroups&&((0,Yr().o)({collectionContextStore:o,newGroups:t.newGroups,groupsFormatKey:n,transaction:e}),Yi().RZ({transaction:e,newGroups:t.newGroups,collectionContextStore:o,environment:i})),t.newSchema&&(0,Ur().I)({environment:i,collectionStore:r,update:{schema:t.newSchema},transaction:e}),t.newPage&&"relation"===a.type&&d){const o=(0,xt().x9d)(t.newPage.name),n=Ko().Wv({environment:i,id:t.newPage.id,type:qi().xd.page,spaceId:t.newPage.spaceId,properties:{title:o},inMemoryRecordCache:r.inMemoryRecordCache,transaction:e});gt().X$({parentStore:d,childStore:n,transaction:e});const l=d.getDefaultTemplatePageStore();l&&R().n5({title:{text:o},environment:i,store:re().Bv.createChildStore(d,n.pointer),templateStore:l,isKeyboard:!1,isCreateIn:!1,transaction:e,from:"collection_group_actions"})}}})}var Qi=()=>o(191597);function Zi(e){const{environment:t,format:o,groupsFormatKey:n,collectionContextStore:r,currentGroups:i}=e;if(Io().default.checkGate({gateName:"collection_group_reducer_visible"}))return;const l=o[n]||[];if(!r.permissionScopesStore.state.canConfigureBlock)return;if(0===i.length)return;const s=i.slice(0,No()._9),a=l.slice(0,No()._9);C().n4(s,a)||B().createAndCommit({userAction:"collectionGroupActions.persistFormatGroups",environment:t,canUndo:!1,perform:e=>{(0,Yr().o)({collectionContextStore:r,newGroups:i,groupsFormatKey:n,transaction:e}),e.postSubmitCallbacks.push((()=>{(0,Qi().a)({environment:t,collectionContextStore:r,request_reason:"persist_format_groups"})}))}})}var Ji=()=>o(396671);class el extends p().default{getInitialState(){return!1}}const tl=el;class ol extends p().default{getInitialState(){}}const nl=ol;var rl=()=>o(787812);var il=()=>o(824565);const ll=p().default.createClass(!1,{name:"IsGroupHoveredStore"});function sl(e){let{renderGroup:t,groupFormat:o,groupsDisplayState:r,disabled:i,groupsFormatKey:l,groupAggregationKey:a,groupsResultStore:c,format:u,schema:p,query:m,collectionContextStore:g,onGroupHeaderAddItem:h,renderHeader:v,getGroupStyle:y,stickyLeft:x,paddingLeft:C,isFullScreen:b,index:w,isRootChild:k,isInPeekRenderer:T,groupBy:I,isLast:R}=e;const j=(0,s().v3)();(0,n.useEffect)((()=>{!function(e){const{environment:t,groupFormat:o,collectionContextStore:n}=e,r=n.collectionViewStore();if(!r)return;const i=n.groupsStore.getGroupState(o);if(!i)return;const l=f().A.get({userId:t.currentUser.id,key:(0,rl().i)(r.id,o)});i.toggleStateStore.setState(l??!0)}({environment:j,collectionContextStore:g,groupFormat:o})}),[]);const A=(0,d().uB)(void 0,ll),[P,M,B,_,V]=(0,d().K8)((()=>{const e=g.groupsStore.getGroupState(o),n=e?e.toggleStateStore:null,s=!!n&&n.state?t(o):null,d={groupFormat:o,currentGroups:r.currentGroups,disabled:i,groupsFormatKey:l,groupAggregationKey:a,groupsResultStore:c,format:u,schema:p,query:m,collectionContextStore:g,isFullScreen:b,isInPeekRenderer:T,onGroupHeaderAddItem:h,stickyLeft:x,index:w,paddingLeft:C,isRootChild:k,groupBy:I,isGroupHoveredStore:A},f=v?v(d):(0,S.jsx)(Gi,{...d});return[e,n,y&&n?y({groupFormat:o,index:w,isLast:R,toggleStateStore:n,isFullScreen:b,groupsDisplayState:r}):void 0,s,f]}),[g,o,t,r,i,l,a,c,u,p,m,b,T,h,x,w,C,k,I,A,v,y,R]),F=(0,n.useCallback)((()=>{A.setState(!0)}),[A]),L=(0,n.useCallback)((()=>{A.setState(!1)}),[A]),O=(0,n.useRef)(null);if(!P||!M)return null;const E=0===w;return(0,S.jsx)("div",{style:{width:"100%",position:"relative",...B},onMouseEnter:F,onMouseLeave:L,ref:O,children:(0,S.jsxs)(il().b,{nodeRef:O,isFirst:E,children:[V,_]})})}const al={viewBox:"0 0 16 16",svg:(0,S.jsx)("path",{d:"M4.288 3.663a.625.625 0 0 0-.625.625v6.109a.625.625 0 1 0 1.25 0v-4.6l6.368 6.368c.24.24.63.232.873-.01a.62.62 0 0 0 .01-.874L5.797 4.913h4.601a.625.625 0 1 0 0-1.25z"})},cl=(0,g().wt)("arrowDiagonalUpLeftSmall",al);var dl=()=>o(895876);const ul=n.memo((function(e){const{selectedAggregation:t,parent:o,onChange:r,collectionContextStore:i,schema:l}=e,a=(0,s().v3)(),{isMobile:c}=(0,s().Y0)(),d=c?{menuType:li().gu.Modal,title:(0,S.jsx)(k().sA,{defaultMessage:"Aggregation",id:"database.mobileBoardAggregationMenu.title"}),right:(0,S.jsx)(di().DoneMenuText,{}),onClickRight:o.close}:{menuType:li().gu.Popup,width:200},{sections:u,initialFocus:p}=(0,n.useMemo)((()=>{const{actions:e,initialFocus:o}=function(e,t,o,n,r){const{device:i}=t,l=[];let s=0,a=0;const c=function(e,t,o,n,r){const i={};for(const s of vi().VD)i[s]=hl(e.aggregator===s,e.enforceMaxAggregationLimit??!1,s,o,n,t);const l=Object.keys(r).filter((e=>{const t=r[e];return t&&(0,vi().wG)(t)&&!("rollup"===t.type&&"status"===t.target_property_type)}));if(l.length>0)for(const s of vi().CG)"show_unique"!==s&&(i[s]=Sl(e,s,l,t,r,o,n));return ml.forEach((l=>{let{supportCheck:s,aggregationTypes:a}=l;const c=Object.keys(r).filter((e=>{const t=r[e];return t&&s(t)}));if(c.length>0)for(const d of a)i[d]=Sl(e,d,c,t,r,o,n)})),i}(e,t,o,n,r);let d=0;return Object.entries(vi().Kn).forEach((t=>{let[n,r]=t;const u=[];for(const o of r)c[o]&&(u.push(c[o]),e.aggregator===o&&(s=d,a=u.length-1));const p=[];if("count_aggregations"===n&&p.push({key:"limitToggleSection",render:e=>(0,S.jsx)(ui().A,{...e}),items:[gl(e,o)]}),p.push({key:"aggregations",render:e=>(0,S.jsx)(ui().A,{topBorder:!0,...e}),items:u}),u.length>0){d++;const e=xi().jA[n],t={key:e,render:(t,o)=>(0,S.jsx)(ji().A,{...t,disableDefaultClick:!0,onFocus:o.onFocus,renderOrigin:(t,o)=>(0,S.jsx)(Ii().A,{...t,ref:o,title:e}),renderExtension:(t,n)=>{let r;return r=i.isMobile?{menuType:li().gu.Modal,title:e,right:(0,S.jsx)(di().DoneMenuText,{}),onClickRight:n.close,...t}:{menuType:li().gu.Popup,width:250,...t},(0,S.jsx)(ai().A,{...r,children:(0,S.jsx)(ci().Ay,{type:ci().Oh.Vertical,initialFocus:a,sections:p,onAccept:(e,t,r)=>{n.close(),o.onAccept&&o.onAccept(e,t,r)}})})}}),action:()=>null};l.push(t)}})),{actions:l,initialFocus:s}}(t,a,r,i,l);return{sections:[{key:"aggregation section",render:e=>(0,S.jsx)(ui().A,{...e}),items:e}],initialFocus:o}}),[i,a,r,l,t]);return(0,S.jsx)(ai().A,{...d,children:(0,S.jsx)(ci().Ay,{type:ci().Oh.Vertical,initialFocus:p,sections:u,onAccept:o.close})})})),pl=n.memo((function(e){const{aggregationType:t,isSelected:o,label:r,innerProps:i}=e,l=xi().cx[t],s=(0,u().IS)((()=>({container:{width:140,whiteSpace:"normal"},image:{borderRadius:6,width:140,marginTop:4}})),[]),a=(0,n.useCallback)((e=>(0,S.jsx)(Ii().A,{title:r,checkState:o,...(0,Ci().A)(e,i)})),[o,i,r]),c=(0,n.useCallback)((()=>(0,S.jsxs)("div",{style:s.container,children:[l&&(0,S.jsx)("img",{src:(0,yi().L)(l),style:s.image}),xi().fp[t]]})),[l,s.container,s.image,t]);return(0,S.jsx)(At().A,{placement:Fe().W.Right,delayThreshold:0,render:a,renderTooltip:c})}));const ml=[{supportCheck:vi().OC,aggregationTypes:vi().Sn},{supportCheck:vi().fo,aggregationTypes:vi().zE},{supportCheck:vi().s_,aggregationTypes:vi().QO}];function gl(e,t){const o=e.enforceMaxAggregationLimit??!1,n={...e,enforceMaxAggregationLimit:!o};return{key:"aggregationLimitToggle",render:e=>(0,S.jsx)(ki().A,{on:o,menuListItemProps:e}),action:()=>{t(n)}}}function Sl(e,t,o,n,r,i,l){const{device:s}=n,a=xi().zY[t],c=C().oE(o.map((o=>function(e,t,o,n,r,i,l,s){const a=r[t];if(!a)return;const c=a.name;return{key:`${t}${o}`,render:t=>(0,S.jsx)(pl,{isSelected:e,aggregationType:o,label:c,innerProps:t}),action:()=>{fl({aggregator:o,property:t,enforceMaxAggregationLimit:n},i,l,s)}}}((null==e?void 0:e.aggregator)===t&&(null==e?void 0:e.property)===o,o,t,e.enforceMaxAggregationLimit??!1,r,i,l,n)))),d=c.findIndex((o=>o.key===`${e.property}${t}`));return{key:`${t}${a}`,render:(e,t)=>(0,S.jsx)(ji().A,{...e,onFocus:t.onFocus,renderOrigin:(e,t)=>(0,S.jsx)(Ii().A,{...e,ref:t,title:a}),renderExtension:(e,o)=>{let n;return n=s.isMobile?{menuType:li().gu.Modal,title:a,right:(0,S.jsx)(di().DoneMenuText,{}),onClickRight:o.close,...e}:{menuType:li().gu.Popup,width:200,...e},(0,S.jsx)(ai().A,{...n,children:(0,S.jsx)(ci().Ay,{type:ci().Oh.Vertical,initialFocus:d,sections:[{key:"results",render:e=>(0,S.jsx)(ui().A,{...e}),items:c}],onAccept:(e,n,r)=>{o.close(),t.onAccept&&t.onAccept(e,n,r)}})})}}),action:()=>null}}function hl(e,t,o,n,r,i){const l=xi().zY[o];return{key:o,render:t=>(0,S.jsx)(pl,{isSelected:e,aggregationType:o,label:l,innerProps:t}),action:()=>{fl({aggregator:o,enforceMaxAggregationLimit:t},n,r,i)}}}function fl(e,t,o,n){o.isLoadingStore.state||o.loadingDetailsStore.setState({type:"load_aggregation"}),o.isClientModeEnabledStore.state||o.asyncAggregationStatusStore.setState({calculating:!0,aggregation:e,changingType:!0}),t(e),(0,T().X)({environment:n,collectionContextStore:o,action:"board_change_aggregation"})}const vl=n.memo((function(e){const{aggregation:t,schema:o,groupFormat:r,groupsResultStore:i,collectionContextStore:l,disabled:a,color:c,onChange:p}=e,{isMobile:m}=(0,s().Y0)(),g=(0,d().O$)(i),h=(0,u().IS)((e=>({button:{fontWeight:w().Wy.regular,color:c||e.lightTextColor,paddingTop:4,paddingBottom:4,height:void 0,lineHeight:void 0}})),[c]),f=(0,n.useCallback)((()=>(0,S.jsx)(yl,{aggregation:t,schema:o,collectionContextStore:l})),[t,l,o]),v=(0,n.useCallback)((e=>(0,S.jsx)(Ri().Ay,{popupType:m?Ri().z7.BottomSheet:Ri().z7.Popup,renderOrigin:n=>(0,S.jsx)(rt().p,{disabled:a,style:h.button,...(0,Ci().A)(e,n),children:"v2"===(null==g?void 0:g.version)?(0,S.jsx)(Cl,{schema:o,aggregation:t,collectionContextStore:l,groupFormat:r,groupsResultStore:i}):(0,S.jsx)(xl,{schema:o,aggregation:t,collectionContextStore:l,groupFormat:r})}),disabled:a,render:e=>(0,S.jsx)(ul,{parent:e,selectedAggregation:t,onChange:p,collectionContextStore:l,schema:o})})),[t,l,a,r,null==g?void 0:g.version,m,p,i,o,h.button]);return(0,S.jsx)(At().A,{renderTooltip:f,render:v})}));function yl(e){let{aggregation:t,schema:o,collectionContextStore:n}=e;const r=(0,d().K8)((()=>!!t&&bi(n,t)),[n,t]);if(t){const e=xi().zY[(0,vi().V1)(t)];if((0,vi().G9)(t)){const n=o[t.property];if(n){const t=n.name;return(0,S.jsx)(S.Fragment,{children:yt().A.formatMessage(Ti.propertyAggregation,{aggregationType:e,propertyName:t,calculating:r})})}}return(0,S.jsx)(S.Fragment,{children:yt().A.formatMessage(Ti.aggregationType,{aggregationType:e,calculating:r})})}return(0,S.jsx)(k().sA,{defaultMessage:"Aggregate",id:"database.boardAggregation.tooltip"})}function xl(e){const{schema:t,aggregation:o,collectionContextStore:r,groupFormat:i}=e,l=(0,d().K8)((()=>({type:"aggregation",filter:(0,vo().Yy)({schema:t,group:i,groupBy:r.getGroupByAndGroupFormats().groupBy,propertyMapping:void 0,timeZone:(0,yo().P)(),experimentService:Io().default}),aggregation:o})),[r,o,t,i]),{numberFormat:s,numberPrecision:a}=(0,n.useMemo)((()=>{if(!(0,vi().G9)(o))return{};const e=t[o.property];if(e&&("formula"===e.type||"number"===e.type)){const t=e.number_format,n=e.number_precision;return{numberFormat:t,numberPrecision:(0,vi().FM)(o)?n:void 0}}return{}}),[o,t]),c=(0,n.useMemo)((()=>{if(!(0,vi().G9)(o))return;const e=t[o.property];return e&&"date"===e.type?e.date_format:void 0}),[o,t]),u=(0,n.useCallback)((e=>{const t=e.state;return(0,S.jsx)(wi,{aggregation:o,collectionContextStore:r,children:t?(0,xi().rv)({numberFormat:s,dateFormat:c,aggregation:o,userTimeZone:(0,yo().P)(),value:t.aggregationResult,numberPrecision:a}):"-"})}),[o,r,c,s,a]);return l?(0,S.jsx)(Wo().A,{id:`board:${(0,so().Ix)(i)}`,collectionContextStore:r,reducer:l,groupsPointer:[i],render:u}):null}function Cl(e){const t=(0,d().K8)((()=>{var t;const o=e.groupsResultStore.state;if(!o||"v2"!==o.version)return;const n=(0,so().Ix)(e.groupFormat);return null===(t=o.aggregationResults)||void 0===t?void 0:t[n]}),[e.groupFormat,e.groupsResultStore]);let o,n;if((0,vi().G9)(e.aggregation)){const t=e.schema[e.aggregation.property];!t||"formula"!==t.type&&"number"!==t.type||(o=t.number_format),t&&"date"===t.type&&(n=t.date_format)}return(0,S.jsx)(wi,{aggregation:e.aggregation,collectionContextStore:e.collectionContextStore,children:t?(0,xi().rv)({numberFormat:o,dateFormat:n,aggregation:e.aggregation,userTimeZone:(0,yo().P)(),value:t.aggregationResult,numberPrecision:void 0}):"–"})}function bl(e){return(0,L().rq)(e.board_cover_size)}const wl=function(e){const{hoveredGroupStore:t,groupFormat:o,schema:r,format:i,groupsResultStore:l,collectionContextStore:a,disabled:c,hidden:p,isPopup:m,isInPeekRenderer:g,query:h,currentGroups:f,isFullScreen:v}=e,y=(0,u().DP)(),x=(0,s().v3)(),C=(0,k().tz)(),b=(0,ue().Zp)(),w=(0,d().K8)((()=>!!x.device.isMobile||(0,so().Mn)(t.state,o)),[x,t,o]),T=(0,d().K8)((()=>(0,No().$e)({environment:x,groupFormat:o,schema:r,format:i,theme:y})),[o,r,i,x,y]),I=(0,d().O$)(a.permissionScopesStore),R=(0,n.useMemo)((()=>{if((0,so().D1)(o.value)&&(0,so().WO)(o.value.value))return new(re().Bv)(x,o.value.value)}),[x,o.value]),j=(0,d().K8)((()=>Boolean((null==R?void 0:R.isReady())&&!(null!=R&&R.canRead()))),[R]),A=(0,d().K8)((()=>a.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0})&&!j),[a,j]),P=(0,d().K8)((()=>(0,L().fG)({collectionContextStore:a,environment:x,intl:C})),[a,x,C]),M=(0,d().K8)((()=>{const e=a.collectionStore();return(!(null==e?void 0:e.inMemoryRecordCache.isTemporaryData)||null==b||!b.isPreviewing)&&(h.aggregations&&h.aggregations.length>0)}),[a,h,b]),B=(0,d().K8)((()=>function(e,t,o,n,r,i){const{device:l}=e,s=bl(o),a=Boolean(o.collection_group_by);return{display:"flex",alignItems:"center",fontSize:14,width:s,paddingLeft:ys,paddingRight:ys,marginRight:2*fs,marginBottom:t?4:0,boxSizing:"content-box",flexShrink:0,...n&&{padding:l.isMobile?"6px 16px":"8px 12px 4px",width:"none",minWidth:s},...i&&!t&&{backgroundColor:i.backgroundColor,...a?{borderRadius:vs}:{borderTopLeftRadius:vs,borderTopRightRadius:vs}}}}(x,p,i,m,0,T)),[x,p,i,m,g,T]);return(0,S.jsxs)("div",{style:B,onMouseMove:()=>function(e,t){e.state!==t&&e.setState(t)}(t,o),children:[(0,S.jsx)(Tl,{boardGroupHeaderProps:e}),M&&(0,S.jsx)(Al,{groupsResultStore:l,disabled:c,query:h,schema:r,collectionContextStore:a,groupFormat:o,hidden:p,boardSelectStyle:T}),(0,S.jsx)("div",{style:{flexGrow:1}}),!c&&I.canConfigureBlock&&(0,S.jsx)(Pl,{hidden:p,groupFormat:o,currentGroups:f,format:i,schema:r,query:h,collectionContextStore:a,boardSelectStyle:T,isHovered:w}),A&&(0,S.jsx)(Ml,{format:i,groupFormat:o,collectionContextStore:a,isFullScreen:v,hidden:p,isHovered:w,boardSelectStyle:T}),P&&(0,S.jsx)(Bl,{groupFormat:o,collectionContextStore:a,hidden:p,isHovered:w,boardSelectStyle:T})]})};function kl(e){let{parent:t,groupFormat:o,currentGroups:n,format:r,schema:i,query:l,collectionContextStore:s}=e;const a=s.boardColumnsLimitStore;return(0,S.jsx)(gi,{parent:t,groupFormat:o,currentGroups:n,format:r,query:l,schema:i,collectionContextStore:s,groupsFormatKey:"board_columns",groupsLimitStore:a})}function Tl(e){let{boardGroupHeaderProps:t}=e;const{groupFormat:o,schema:n,disabled:r,currentGroups:i,format:l,groupBy:a,collectionContextStore:c}=t,u=(0,s().v3)(),p=bl(l),m=(0,d().O$)(c.permissionScopesStore);return(0,d().K8)((()=>c.groupsStore.getGroupState(o)),[c,o])?(0,S.jsx)(zi().A,{groupBy:a,groupFormat:o,currentGroups:i,schema:n,disabled:r||!m.canConfigureBlock,isHiddenGroup:!1,onChange:e=>function(e,t,o){const{collectionContextStore:n}=o,r=n.collectionStore();r&&(Qr({...e,environment:t,groupsFormatKey:"board_columns",collectionStore:r,...o}),(0,T().X)({environment:t,collectionContextStore:n,action:"rename_group"}))}(e,u,t),style:{maxWidth:p-70},collectionContextStore:c}):null}function Il(e,t,o){return!t&&o?o.textColor:e.lightTextColor}function Rl(e,t){if(!e)return{transition:"opacity 100ms ease-in-out",opacity:t?1:0}}function jl(e,t,o,n,r,i){const{device:l}=e;if(!(0,Ye().EF)(e))return;const s="collectionTypedView"===n.contextType,a=Boolean(t.collection_group_by);n.searchQueryStore.state&&(0,jn().S)({searchQuery:"",collectionContextStore:n,isFullScreen:r});const c=n.groupsStore.getGroupState(o);if(!c)return;const d=c.resultsStore;B().createAndCommit({userAction:"BoardGroupHeader.handleAddItemClick",environment:e,canUndo:!0,perform:t=>{const r=(0,kn().Q)({environment:e,collectionContextStore:n,groupsPointer:[o],insertAtIndex:0,shouldCoerce:!0,templateStore:n.defaultPageTemplateStore.state,transaction:t,from:{createBlock:"board_group_header"},inMemoryRecordCache:e.defaultRecordCache.inMemoryRecordCache});if(!r)return;const c=r.coercionSucceeded,u=r.newStore;if(l.isMobile){!function(e,t,o){o?o(e):$n().oo({environment:t,url:e})}((0,Zn().Ay)({store:u,pageVisitSource:wn().y8.Create}),e,i)}else if(c&&!a){const t=u.getBlockTitleStore();P().hc({environment:e,store:u}),M().setSelectionAtEnd({store:t}),(0,Rn().C)({store:u})}else In().VU({environment:e,store:u,peekMode:(0,L().hH)(n),showMoveTo:s,resultsStore:d,collectionContextStore:n,pageVisitSource:wn().y8.Create});Qo().v(e,{from:"board_group_add_item_top",type:"page",new_page_id:u.id,creating_block_id:u.id,...(0,fe().sl)(n)})}})}function Al(e){let{disabled:t,query:o,schema:n,collectionContextStore:r,groupFormat:i,hidden:l,boardSelectStyle:a,groupsResultStore:c}=e;const p=(0,u().DP)(),m=(0,s().v3)(),g=o.aggregations?o.aggregations[0]:void 0,h=(0,d().O$)(r.permissionScopesStore);if(!g)return null;const f=Il(p,l,a);return(0,S.jsx)(vl,{groupFormat:i,groupsResultStore:c,disabled:t||!h.canConfigureBlock,aggregation:g,schema:n,collectionContextStore:r,color:f,onChange:e=>function(e,t,o,n){const r=t.collectionViewStore(),i={...o,aggregations:e?[e]:[]};r&&B().createAndCommit({userAction:"BoardGroupHeader.handleAggregationChange",environment:n,canUndo:!0,perform:e=>{(0,ri().F)({collectionViewStore:r,update:{query2:i},transaction:e})}})}(e,r,o,m)})}function Pl(e){let{hidden:t,groupFormat:o,currentGroups:n,format:r,schema:i,query:l,collectionContextStore:a,boardSelectStyle:c,isHovered:d}=e;const p=(0,u().DP)(),m=(0,s().v3)(),{device:h}=m,f=Il(p,t,c),v=Rl(t,d);return(0,S.jsx)(Ri().Ay,{popupType:h.isMobile?Ri().z7.SlideUp:Ri().z7.Popup,renderOrigin:e=>(0,S.jsx)(jt().A,{icon:cr().Y,iconStyle:{width:g().Ev.sm,height:g().Ev.sm,fill:f},style:v,...e}),render:e=>(0,S.jsx)(kl,{parent:e,groupFormat:o,currentGroups:n,format:r,schema:i,query:l,collectionContextStore:a})})}function Ml(e){let{format:t,groupFormat:o,collectionContextStore:r,isFullScreen:i,hidden:l,isHovered:a,boardSelectStyle:c}=e;const p=(0,u().DP)(),m=(0,s().v3)(),h=(0,k().tz)(),f=(0,n.useContext)(Br().n),v=(0,n.useCallback)((()=>jl(m,t,o,r,i,f)),[m,t,o,r,i,f]),y=(0,d().K8)((()=>{var e;return null===(e=r.collectionStore())||void 0===e?void 0:e.getFormat().app_config_uri}),[r]),x=Il(p,l,c),C=Rl(l,a),b=(0,dl().$O)(y),w=h.formatMessage({defaultMessage:"Create new {newItemName}",id:"database.boardView.actions.addNewItem.tooltip"},{newItemName:b});return(0,S.jsx)(At().A,{renderTooltip:()=>w,render:e=>(0,S.jsx)(jt().A,{icon:$r().plusSmallIcon,onClick:v,style:C,iconStyle:{width:g().Ev.sm,height:g().Ev.sm,fill:x},ariaLabel:w,...e})})}function Bl(e){let{groupFormat:t,collectionContextStore:o,hidden:n,isHovered:r,boardSelectStyle:i}=e;const l=(0,u().DP)(),s=(0,k().tz)(),a=(0,d().K8)((()=>{var e;return null===(e=o.collectionStore())||void 0===e?void 0:e.getFormat().app_config_uri}),[o]),c=Il(l,n,i),p=Rl(n,r),m=(0,dl().$O)(a),h=s.formatMessage({defaultMessage:"Link existing {newItemName}",id:"database.boardView.actions.linkExistingItem.tooltip"},{newItemName:m});return(0,S.jsx)(Kn().O,{collectionContextStore:o,groupFormat:t,renderLinkButton:e=>(0,S.jsx)(At().A,{renderTooltip:()=>h,render:t=>(0,S.jsx)(jt().A,{icon:cl,style:p,iconStyle:{width:g().Ev.sm,height:g().Ev.sm,fill:c},...t,...e,ariaLabel:h})})})}var _l=()=>o(668725);const Vl=30,Fl=4,Ll=10;function Ol(e){const{hiddenGroupsVisibleStore:t}=e,o=(0,d().O$)(t);return(0,S.jsx)(rt().p,{onClick:function(){t.setState(!t.state)},onMouseDown:Ce().tr,style:{height:Vl,marginBottom:Fl,...e.style},icon:e=>(0,_l().b)({...e,...o&&{transform:"rotate(180deg)"}}),isLightGray:!0,children:(0,S.jsx)(k().sA,{id:"collectionHiddenGroupsButton.hiddenGroupsButton.text",defaultMessage:"{numberOfHiddenGroups, plural, one {{numberOfHiddenGroups} hidden group} other {{numberOfHiddenGroups} hidden groups}}",values:{numberOfHiddenGroups:e.hiddenGroups.length}})})}function El(e){const t=(0,d().K8)((()=>e.columnsDisplayState.visibleGroups.length*(bl(e.format)+2*ys+2*fs)),[e.columnsDisplayState.visibleGroups,e.format]);return(0,S.jsx)("div",{style:{display:"flex",minWidth:t},children:(0,S.jsx)(Ol,{...e})})}const Dl=30,zl=4,Kl=n.memo((function(e){let{type:t,groupsDisplayState:o,groupsLimitStore:n,schema:r,collectionContextStore:i,style:l}=e;const a=(0,s().v3)(),c=(0,u().DP)(),p=(0,d().O$)(i.normalizedFormatStore),m=(0,d().K8)((()=>(0,bn().Mw)({collectionContextStore:i,isForColumnGroups:"board"===t})),[i,t]),g=(0,d().K8)((()=>"board"===t?(0,No().$e)({environment:a,groupFormat:void 0,schema:r,format:p,theme:c}):void 0),[a,p,r,c,t]),h="v2"===o.version?void 0:Math.min(No().B2,o.total-o.hiddenGroups.length-o.visibleGroups.length),f=(0,u().IS)((e=>({hovered:{background:e.whiteButtonBackground},dots:{width:14,fill:e.mediumTextColor,marginLeft:void 0===h?8:4,marginTop:1,..."default"===t?{marginRight:8}:{}},button:{display:"flex",alignItems:"center",fontSize:14,paddingTop:2,paddingBottom:2,paddingRight:8,color:e.mediumTextColor,fontWeight:w().Wy.medium,..."board"===t?{background:null==g?void 0:g.backgroundColor,paddingLeft:8,height:"100%",marginRight:2*fs,borderRadius:vs,width:void 0===h?"fit-content":90,...l}:{paddingLeft:2,borderRadius:4,height:Dl,marginTop:zl,marginBottom:zl}}})),[null==g?void 0:g.backgroundColor,h,l,t]);return"default"===t?(0,S.jsxs)(rt().p,{onClick:()=>function(e,t,o){o.setState(o.state+No().B2),t.loadingDetailsStore.setState({type:"load_more_groups"}),Hl(e)}(a,i,n),onMouseDown:Ce().tr,disabled:m,hoveredStyle:m?f.hovered:{},style:{...f.button,...l},children:[(0,Nr()._)(f.dots),void 0===h?(0,S.jsx)(k().sA,{id:"database.groups.loadMoreButtonDefault",defaultMessage:"Load more groups"}):(0,S.jsx)(k().sA,{id:"database.groups.loadMoreButtonDefault.text",defaultMessage:"Show {loadMoreAmount, plural, one {{loadMoreAmount} more group} other {{loadMoreAmount} more groups}}",values:{loadMoreAmount:h}}),m&&(0,S.jsx)("div",{style:{marginTop:1,marginLeft:8},children:(0,S.jsx)(En().A,{size:"sm"})})]}):(0,S.jsxs)(rt().p,{onClick:()=>function(e,t,o){o.setState(o.state+No().B2),t.loadingDetailsStore.setState({type:"load_more_columns"}),Hl(e)}(a,i,n),onMouseDown:Ce().tr,disabled:m,hoveredStyle:m?f.hovered:{},style:f.button,children:[(0,S.jsx)("span",{style:{flexGrow:1},children:void 0===h?(0,S.jsx)(k().sA,{id:"database.groups.loadMoreButtonBoard",defaultMessage:"More"}):(0,S.jsx)(k().sA,{id:"database.groups.loadMoreButton.text",defaultMessage:"{loadMoreAmount} more",values:{loadMoreAmount:h}})}),m?(0,S.jsx)("div",{style:{marginLeft:4},children:(0,S.jsx)(En().A,{size:"sm"})}):(0,Nr()._)(f.dots)]})}),mo().A);function Hl(e){ge().vd(e,"collection_load_more_groups")}function Gl(e){const{format:t,isFullScreen:o,paddingLeft:n,isRootChild:r}=e,i=(0,s().v3)(),l=(0,d().K8)((()=>(0,qt().iw)({environment:i,format:t,isFullScreen:o,isRootChild:r})),[i,t,o,r]),a=(0,d().K8)((()=>"collectionTypedView"===e.collectionContextStore.contextType),[e.collectionContextStore]),c=(0,d().K8)((()=>(0,qt().Od)({environment:i,isRootChild:r,isFullScreen:o,format:t})?qt().HV:n),[i,t,o,r,n]);return l||a?null:(0,S.jsx)("div",{style:{width:"100%",height:Ms+_s+Bs,display:"flex"},children:(0,S.jsx)(Fs,{type:"default",groupBy:e.groupBy,currentGroups:e.currentGroups,schema:e.schema,groupsLimitStore:e.groupsLimitStore,collectionContextStore:e.collectionContextStore,onAccept:e.onAccept,parentStore:e.parentStore,style:{position:"sticky",left:e.isFullScreen?c:3,width:"max-content",paddingLeft:4,paddingRight:8}})})}function Wl(e){const{format:t,isFullScreen:o,isRootChild:n,paddingLeft:r,hiddenGroups:i,hiddenGroupsVisibleStore:l,style:a}=e,c=(0,s().v3)(),u=(0,d().K8)((()=>(0,qt().iw)({environment:c,format:t,isFullScreen:o,isRootChild:n})),[c,t,o,n]),p=(0,d().K8)((()=>(0,qt().Od)({environment:c,isRootChild:n,isFullScreen:o,format:t})?qt().HV:r),[c,t,o,n,r]);return u?null:(0,S.jsx)("div",{style:{width:"100%",height:Vl+Fl+Ll,display:"flex"},children:(0,S.jsx)(Ol,{hiddenGroupsVisibleStore:l,hiddenGroups:i,style:{position:"sticky",left:o?p:3,width:"max-content",paddingLeft:4,paddingRight:8,...a}})})}function Nl(e){const{format:t,isFullScreen:o,isRootChild:n}=e,r=(0,s().v3)(),i=(0,d().K8)((()=>(0,qt().iw)({environment:r,format:t,isFullScreen:o,isRootChild:n})),[r,t,o,n]),l=(0,d().K8)((()=>(0,qt().Od)({environment:r,isRootChild:n,isFullScreen:o,format:t})?qt().HV:e.paddingLeft),[r,t,o,n,e.paddingLeft]);return i?null:(0,S.jsx)("div",{style:{width:"100%",height:Dl+2*zl,display:"flex"},children:(0,S.jsx)(Kl,{type:"default",groupsDisplayState:e.groupsDisplayState,groupsLimitStore:e.groupsLimitStore,schema:e.schema,collectionContextStore:e.collectionContextStore,style:{position:"sticky",left:o?l:3,width:"max-content",paddingLeft:4,paddingRight:8}})})}const $l=(0,g().wt)("collectionGroupAccordion",{svg:(0,S.jsx)("path",{d:"M6.741 0a1 1 0 01.875 1.485l-2.742 4.94a1 1 0 01-1.748 0L.384 1.485A1 1 0 011.26 0h5.48z"}),viewBox:"0 0 8 7"});function Ul(e){const{width:t}=e,o=(0,s().v3)(),n=(0,d().K8)((()=>o.WindowSizeStore.state.width<=us),[o]),r=(0,u().IS)((e=>({container:{display:"flex",flexDirection:"column",alignItems:"flexStart",alignSelf:"stretch",paddingBottom:12,height:t},groupContainer:{display:"flex",height:46,alignItems:"center",alignSelf:"stretch"},itemsContainer:{display:"grid",position:"relative",gridTemplateColumns:`repeat(auto-fill, minmax(${n?"100%":`${t}px`}, 1fr))`,gap:16,paddingTop:1,paddingBottom:4,width:"100%",height:"100%"},iconContainer:{display:"flex",width:22,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},icon:{width:8,height:8,flexShrink:0,fill:e.icon.tertiary},groupShimmer:{width:120,height:10,marginLeft:8,borderRadius:12,backgroundColor:e.lightDividerColor}})),[t,n]);return(0,S.jsxs)("div",{style:r.container,children:[(0,S.jsxs)("div",{style:r.groupContainer,children:[(0,S.jsx)("div",{style:r.iconContainer,children:$l(r.icon)}),(0,S.jsx)(Er().A,{style:r.groupShimmer})]}),(0,S.jsxs)("div",{style:r.itemsContainer,children:[(0,S.jsx)(Dr,{}),(0,S.jsx)(Dr,{}),(0,S.jsx)(Dr,{})]})]})}function ql(e){const{isFullScreen:t,galleryCoverSize:o}=e,n=t?2:1,r=(0,L().rq)(o),i=C().Hn(n,(e=>(0,S.jsx)(Ul,{width:r},e)));return(0,S.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:i})}function Yl(){const e=(0,u().IS)((e=>({container:{padding:"8px 0px",width:"100%"},groupContainer:{display:"flex",height:36,paddingRight:0,alignItems:"center",alignSelf:"stretch",gap:8},rowsContainer:{display:"flex",paddingLeft:16,flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},rowContainer:{display:"flex",alignItems:"flex-start",gap:1,alignSelf:"stretch",borderBottom:`1px solid ${e.regularDividerColor}`},lastRowContainer:{display:"flex",alignItems:"flex-start",gap:1,alignSelf:"stretch"},iconContainer:{display:"flex",width:16,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},icon:{width:8,height:8,flexShrink:0,fill:e.icon.tertiary},groupShimmer:{width:120,height:10,borderRadius:12,backgroundColor:e.lightDividerColor},circleShimmer:{width:16,height:16,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmer:{width:100,height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmerShort:{width:60,height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmerLong:{width:200,height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},firstColumn:{display:"flex",width:360,height:34,padding:"7px 8px",alignItems:"center",gap:6},column:{display:"flex",width:200,height:34,padding:"6px 8px",alignItems:"center",gap:6}})),[]);return(0,S.jsxs)("div",{style:e.container,children:[(0,S.jsxs)("div",{style:e.groupContainer,children:[(0,S.jsx)("div",{style:e.iconContainer,children:$l(e.icon)}),(0,S.jsx)(Er().A,{style:e.groupShimmer})]}),(0,S.jsxs)("div",{style:e.rowsContainer,children:[(0,S.jsxs)("div",{style:e.rowContainer,children:[(0,S.jsxs)("div",{style:e.firstColumn,children:[(0,S.jsx)(Er().A,{style:e.circleShimmer}),(0,S.jsx)(Er().A,{style:e.rowShimmerShort})]}),(0,S.jsx)("div",{style:e.column,children:(0,S.jsx)(Er().A,{style:e.rowShimmerShort})}),(0,S.jsx)("div",{style:e.column,children:(0,S.jsx)(Er().A,{style:e.rowShimmerShort})}),(0,S.jsx)("div",{style:e.column,children:(0,S.jsx)(Er().A,{style:e.rowShimmerShort})})]}),(0,S.jsxs)("div",{style:e.rowContainer,children:[(0,S.jsxs)("div",{style:e.firstColumn,children:[(0,S.jsx)(Er().A,{style:e.circleShimmer}),(0,S.jsx)(Er().A,{style:e.rowShimmerLong})]}),(0,S.jsx)("div",{style:e.column,children:(0,S.jsx)(Er().A,{style:e.rowShimmer})}),(0,S.jsx)("div",{style:e.column,children:(0,S.jsx)(Er().A,{style:e.rowShimmer})}),(0,S.jsx)("div",{style:e.column,children:(0,S.jsx)(Er().A,{style:e.rowShimmer})})]}),(0,S.jsxs)("div",{style:e.lastRowContainer,children:[(0,S.jsxs)("div",{style:e.firstColumn,children:[(0,S.jsx)(Er().A,{style:e.circleShimmer}),(0,S.jsx)(Er().A,{style:e.rowShimmerLong})]}),(0,S.jsx)("div",{style:e.column,children:(0,S.jsx)(Er().A,{style:e.rowShimmer})}),(0,S.jsx)("div",{style:e.column,children:(0,S.jsx)(Er().A,{style:e.rowShimmer})}),(0,S.jsx)("div",{style:e.column,children:(0,S.jsx)(Er().A,{style:e.rowShimmer})})]})]})]})}function Xl(e){const{isFullScreen:t}=e,o=t?2:1,n=C().Hn(o,(e=>(0,S.jsx)(Yl,{},e)));return(0,S.jsx)("div",{style:{display:"flex",paddingTop:8,paddingLeft:4,flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch",width:"100%"},children:n})}function Ql(){const e=(0,u().IS)((e=>({rowsContainer:{paddingTop:8},rowContainer:{display:"flex",height:28,alignItems:"center",gap:6,alignSelf:"stretch",flex:"1 0 0"},rowShimmer:{width:"80%",height:10,flexShrink:0,borderRadius:12,marginLeft:12,backgroundColor:e.lightDividerColor},rowShimmerShort:{width:"50%",height:10,flexShrink:0,borderRadius:12,marginLeft:12,backgroundColor:e.lightDividerColor}})),[]);return(0,S.jsxs)("div",{style:e.rowsContainer,children:[(0,S.jsx)("div",{style:e.rowContainer,children:(0,S.jsx)(Er().A,{style:e.rowShimmerShort})}),(0,S.jsx)("div",{style:e.rowContainer,children:(0,S.jsx)(Er().A,{style:e.rowShimmer})})]})}var Zl=()=>o(812119);function Jl(){const e=(0,u().IS)((e=>({container:{display:"flex",padding:"8px 0px",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},groupContainer:{display:"flex",height:36,paddingRight:0,alignItems:"center",alignSelf:"stretch",gap:8},rowsContainer:{display:"flex",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},iconContainer:{display:"flex",width:16,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},icon:{width:8,height:8,flexShrink:0,fill:e.icon.tertiary},groupShimmer:{width:120,height:10,borderRadius:12,backgroundColor:e.lightDividerColor}})),[]),t=(0,Z().Ks)(),o=(0,d().K8)((()=>null==t?void 0:t.isInHomeWidgetStore.state),[t]),n=["50%","30%","40%"].map(((e,t)=>(0,S.jsx)(Zl().J,{widthPercentage:e,isInHomeWidget:o},t)));return(0,S.jsxs)("div",{style:e.container,children:[(0,S.jsxs)("div",{style:e.groupContainer,children:[(0,S.jsx)("div",{style:e.iconContainer,children:$l(e.icon)}),(0,S.jsx)(Er().A,{style:e.groupShimmer})]}),(0,S.jsx)("div",{style:e.rowsContainer,children:n})]})}function es(e){const{isFullScreen:t}=e,o=t?2:1,n=C().Hn(o,(e=>(0,S.jsx)(Jl,{},e)));return(0,S.jsx)("div",{style:{display:"flex",padding:"8px 4px",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},children:n})}function ts(e){const{viewType:t,isFullScreen:o,galleryCoverSize:n}=e;if(!(0,jr().A)(!0,0,100))return null;switch(t){case"table":return(0,S.jsx)(Xl,{isFullScreen:o});case"list":return(0,S.jsx)(es,{isFullScreen:o});case"gallery":return(0,S.jsx)(ql,{isFullScreen:o,galleryCoverSize:n});case"timeline":return(0,S.jsx)(Ql,{});default:return null}}const os=new Set(["dropzone","table"]),ns=new Set(["item","table"]),rs=n.memo((function(e){const{collectionContextStore:t,timelineProps:r}=e,i=(0,s().v3)(),l=(0,Ae().X)("collection_group_reducer_visible"),a=(0,d().K8)((()=>{var e;return null===(e=t.collectionViewStore())||void 0===e?void 0:e.getType()}),[t]),c=(0,d().O$)(t.permissionScopesStore),u=(0,d().O$)(t.normalizedFormatStore),p=null==u?void 0:u.collection_group_by,m=null==u?void 0:u.board_columns_by,g=(0,d().O$)(t.groupsLimitStore),h=(0,d().O$)(t.normalizedSchemaStore),f=(0,d().K8)((()=>t.normalizedQueryStore.state??{}),[t.normalizedQueryStore]),v=(0,d().K8)((()=>{if(p&&u&&(null==r||!r.type||!os.has(null==r?void 0:r.type)))return(0,No().p_)({groupBy:p,schema:h,format:u,groupsFormatKey:so().iA,limit:g,aggregation:u.collection_group_aggregation})}),[p,u,r,h,g]),y=(0,d().uB)(null==r?void 0:r.reducerResultStore,nl),x=(0,d().O$)(y),C=(0,d().uB)(null==r?void 0:r.hiddenGroupsVisibleStore,tl),b=(0,d().O$)(C),[w,k]=(0,Ji().d)({collectionContextStore:t,groupBy:p,groupsFormatKey:so().iA,reducerResult:x,groupsLimit:g}),[T,I]=(0,Ji().d)({collectionContextStore:t,groupBy:p,groupsFormatKey:"board_columns",reducerResult:x,groupsLimit:g,forBoardColumns:!0,groupByColumns:m}),R=n.useCallback((()=>{const e=t.normalizedFormatStore.state;if(""!==t.searchQueryStore.state)return;(0,qo().I6)(t)||Zi({environment:i,format:e,groupsFormatKey:so().iA,collectionContextStore:t,currentGroups:k.state.currentGroups})}),[t,i,k]),j=(0,Gn().U)(R,5e3);(0,n.useEffect)((()=>{if(null==r||!r.type||!os.has(null==r?void 0:r.type))return k.addListener(j),()=>{k.removeListener(j),j.cancel()}}),[k,j,r]);const A=(0,d().K8)((()=>k.state.hiddenGroups.slice(0,No().RP)),[k]),P=(0,d().K8)((()=>!(null!=r&&r.type&&ns.has(null==r?void 0:r.type))&&(0,bn().c_)({collectionContextStore:t,displayState:w})),[t,w,r]),M=(0,d().K8)((()=>{const{visibleGroups:e}=w;return 0===e.length&&!t.shouldShowSpinnerStore.state||e.length>0}),[t,w]),B=(0,d().K8)((()=>(0,No().Zl)(w,e.collectionContextStore,!1)),[w,e.collectionContextStore]),_=(0,d().K8)((()=>!e.disabled&&!c.isLocked&&c.canConfigureBlock&&!P&&p&&(0,so().pP)(p,c.canConfigureCollection)&&"collectionTypedView"!==t.contextType&&!(0,o(443239).u)(p.property)&&M),[M,t,c.canConfigureBlock,c.canConfigureCollection,c.isLocked,e.disabled,p,P]),V=(0,d().K8)((()=>Io().default.getConfigKey("collection_reducer_request_settings","general_debounce_wait_ms")),[]);if(!u)return null;const F=(0,S.jsxs)("div",{style:{position:"relative"},children:[(0,S.jsx)(is,{groups:w.visibleGroups,groupBy:p,groupsDisplayState:w,groupsResultStore:y,format:u,schema:h,query:f,reducerId:e.reducerId,store:e.store,collectionContextStore:e.collectionContextStore,disabled:e.disabled,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,renderGroup:e.renderGroup,getGroupStyle:e.getGroupStyle,renderHeader:e.renderHeader,onGroupHeaderAddItem:e.onGroupHeaderAddItem,timelineProps:r}),P&&(0,S.jsx)(ts,{viewType:a,isFullScreen:e.isFullScreen,galleryCoverSize:u.gallery_cover_size}),B&&(0,S.jsx)(ls,{timelineType:null==r?void 0:r.type,collectionContextStore:e.collectionContextStore,schema:h,format:u,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,groupsDisplayState:w}),A.length>0&&!l&&(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(as,{reducerId:e.reducerId,timelineType:null==r?void 0:r.type,format:u,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,columnsDisplayState:T,hiddenGroups:A,hiddenGroupsVisibleStore:C}),b&&(0,S.jsx)(is,{groups:A,groupBy:p,groupsDisplayState:w,groupsResultStore:y,format:u,schema:h,query:f,reducerId:e.reducerId,store:e.store,collectionContextStore:e.collectionContextStore,disabled:e.disabled,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,renderGroup:e.renderGroup,getGroupStyle:e.getGroupStyle,renderHeader:e.renderHeader,onGroupHeaderAddItem:e.onGroupHeaderAddItem,timelineProps:r})]}),_&&!l&&(0,S.jsx)(ss,{timelineType:null==r?void 0:r.type,store:e.store,collectionContextStore:e.collectionContextStore,schema:h,format:u,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,groupsDisplayState:w,groupBy:p})]});return v?(0,S.jsx)(Wo().A,{id:e.reducerId,reducer:v,collectionContextStore:e.collectionContextStore,resultStore:y,render:()=>F,debounceWait:V}):F}),mo().A);function is(e){const t=(0,d().K8)((()=>e.collectionContextStore.groupsStore.getGroupState),[e.collectionContextStore.groupsStore]),o=(0,d().O$)(e.collectionContextStore.isInPeekRendererStore);return(0,S.jsx)(S.Fragment,{children:e.groups.map(((n,r)=>t&&e.groupBy?(0,S.jsx)(sl,{collectionContextStore:e.collectionContextStore,groupsDisplayState:e.groupsDisplayState,groupFormat:n,groupBy:e.groupBy,groupsResultStore:e.groupsResultStore,disabled:e.disabled,groupsFormatKey:so().iA,groupAggregationKey:so().Ss,format:e.format,schema:e.schema,query:e.query,isInPeekRenderer:o,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,renderGroup:e.renderGroup,renderHeader:e.renderHeader,onGroupHeaderAddItem:e.onGroupHeaderAddItem,getGroupStyle:e.getGroupStyle,index:r,isLast:r===e.groups.length-1},(0,so().Ix)(n)):null))})}function ls(e){return"dropzone"===e.timelineType?null:"item"===e.timelineType?(0,S.jsx)(Nl,{type:"default",schema:e.schema,collectionContextStore:e.collectionContextStore,groupsLimitStore:e.collectionContextStore.groupsLimitStore,groupsDisplayState:e.groupsDisplayState,format:e.format,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft}):(0,S.jsx)("div",{style:{display:"flex"},children:(0,S.jsx)(Kl,{type:"default",schema:e.schema,collectionContextStore:e.collectionContextStore,groupsLimitStore:e.collectionContextStore.groupsLimitStore,groupsDisplayState:e.groupsDisplayState,style:e.stickyLeft?{position:"sticky",left:e.paddingLeft}:void 0})})}function ss(e){const t=(0,s().v3)(),o=(0,d().K8)((()=>e.collectionContextStore.groupsLimitStore),[e.collectionContextStore]),r=n.useCallback(((e,t,o,n,r)=>{const i=o.collectionStore();i&&Xi({update:e,collectionContextStore:o,groupsFormatKey:so().iA,collectionStore:i,environment:t,groupBy:n,schema:r})}),[]);return"dropzone"!==e.timelineType&&e.groupBy?"item"===e.timelineType?(0,S.jsx)(Gl,{type:"default",collectionContextStore:e.collectionContextStore,parentStore:e.store,groupsLimitStore:o,groupBy:e.groupBy,currentGroups:e.groupsDisplayState.currentGroups,schema:e.schema,format:e.format,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,onAccept:o=>{e.groupBy&&r(o,t,e.collectionContextStore,e.groupBy,e.schema)}}):(0,S.jsx)(Fs,{type:"default",collectionContextStore:e.collectionContextStore,parentStore:e.store,groupsLimitStore:o,groupBy:e.groupBy,currentGroups:e.groupsDisplayState.currentGroups,schema:e.schema,paddingLeft:e.paddingLeft,stickyLeft:!0,onAccept:o=>{e.groupBy&&r(o,t,e.collectionContextStore,e.groupBy,e.schema)}}):null}function as(e){return"board_collection_groups"===e.reducerId?(0,S.jsx)(El,{hiddenGroups:e.hiddenGroups,hiddenGroupsVisibleStore:e.hiddenGroupsVisibleStore,format:e.format,columnsDisplayState:e.columnsDisplayState}):"dropzone"===e.timelineType?null:"item"===e.timelineType?(0,S.jsx)(Wl,{hiddenGroups:e.hiddenGroups,hiddenGroupsVisibleStore:e.hiddenGroupsVisibleStore,format:e.format,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,style:{marginTop:Ll}}):(0,S.jsx)("div",{style:{display:"flex"},children:(0,S.jsx)(Ol,{hiddenGroups:e.hiddenGroups,hiddenGroupsVisibleStore:e.hiddenGroupsVisibleStore,style:{marginTop:Ll,...e.stickyLeft?{position:"sticky",left:e.paddingLeft}:{}}})})}const cs=n.memo((function(e){const{collectionContextStore:t,store:o,format:r,disabled:i,schema:l,blockPropertyValueOverlayStore:a,isFullScreen:c,paddingLeft:d,isRootChild:p,collectionGalleryViewStore:m}=e,g=(0,Ae().X)("db_ux_simplification_next"),h=(0,u().DP)(),f=(0,s().v3)(),{isMobile:v}=(0,s().Y0)(),y=(0,n.useCallback)((e=>(0,S.jsx)(ds,{args:e})),[]),x=(0,n.useCallback)((e=>{if(v)Tn().uK({environment:f,store:e,pageVisitSource:wn().y8.Create});else{const o="collectionTypedView"===t.contextType;In().VU({environment:f,store:e,peekMode:L().hH(t),showMoveTo:o,resultsStore:void 0,collectionContextStore:t,pageVisitSource:wn().y8.Create})}}),[t,f,v]),C=(0,n.useCallback)((e=>(0,S.jsx)(Hr,{store:o,format:r,disabled:i,collectionContextStore:t,schema:l,blockPropertyValueOverlayStore:a,isFullScreen:c,collectionGalleryViewStore:m,groupFormat:e})),[o,r,i,t,l,a,c,m]),b=(0,n.useCallback)((e=>g||0===e.index?{}:{borderTop:`1px solid ${h.tableDividerColor}`}),[g,h.tableDividerColor]);return(0,S.jsx)(rs,{reducerId:"gallery_groups",store:o,collectionContextStore:t,disabled:i,isFullScreen:c,isRootChild:p,paddingLeft:d,stickyLeft:!1,renderHeader:y,onGroupHeaderAddItem:x,renderGroup:C,getGroupStyle:b})}));function ds(e){let{args:t}=e;const o=(0,d().O$)(t.collectionContextStore.isInHomeWidgetStore),{stickyStyle:n}=(0,u().IS)((e=>({stickyStyle:{boxShadow:`0 -1px 0 ${e.contentBackground}`}})),[]);return(0,S.jsx)(Gi,{...t,height:o?ft().ag:48,stickyStyle:n})}const us=480,ps=40;function ms(e){const{store:t,format:o,collectionContextStore:r,isFullScreen:i,isPreviewing:l,isRootChild:a,blockPropertyValueOverlayStore:c,disabled:p,schema:m,paddingBottom:g,paddingLeft:h,paddingRight:f,minWidth:v}=e,y=(0,s().v3)(),{isMobile:x}=(0,s().Y0)(),C=(0,n.useRef)(null),b=(0,d().uB)(void 0,Mr);(0,d().O$)(b);const{coverWidth:w,coverHeight:k}=(0,d().O$)(b),T=(0,d().K8)((()=>L().mM(r,i)),[r,i]),I=(0,d().O$)(r.isInHomeWidgetStore),R=(0,d().K8)((()=>!!r.viewsModuleContextStore.getViewModuleType()),[r]),j=(0,n.useCallback)((()=>{if(C.current){const e=C.current.getNode();if(e){const t=e.querySelector(`.${he().E4t}`);if(null!==t&&t instanceof HTMLDivElement)return t.offsetWidth}}return L().rq(o.gallery_cover_size)}),[o.gallery_cover_size]),A=(0,n.useCallback)((e=>{b.setState({coverHeight:k,coverWidth:e||j()})}),[b,k,j]),P=(0,n.useCallback)((()=>j()*(9/16)),[j]),M=(0,n.useCallback)((e=>{b.setState({coverWidth:w,coverHeight:e||P()})}),[b,w,P]),B=(0,n.useCallback)((e=>{var t;const o=r.isLoadingStore.state,n=null===(t=r.groupsStore.getGroupState([]))||void 0===t||null===(t=t.reducerResultStore)||void 0===t?void 0:t.state;e<De().A.incrementScrollOffset&&n&&!o&&null!=n&&n.hasMore&&(0,So().H)({collectionContextStore:r,environment:y,incrementLimitArgs:{isFullScreen:i,currentResultCount:n.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})}),[r,y,i]),_=(0,n.useCallback)((()=>{const e=P(),t=j();k!==e&&M(e),w!==t&&A(t)}),[P,j,k,w,M,A]),V=(0,Gn().Y)(_,100),F=(0,Wn().d)(_,100);(0,n.useEffect)((()=>{A(j()),M()}),[j,M,A,null==o?void 0:o.gallery_cover_size]),(0,n.useEffect)((()=>((0,xe().P4)(window,"resize",F),x&&(0,xe().P4)(window,"orientationchange",V),()=>{(0,xe().Ol)(window,"resize",F),x&&(0,xe().Ol)(window,"orientationchange",V)})),[V,F,x]);const O=(0,u().IS)((()=>({container:{paddingBottom:g,paddingLeft:h,paddingRight:f,minWidth:v}})),[v,g,h,f]),E=o.collection_group_by,D=(0,ue().Zp)();return(0,Ar().A)((e=>(0,S.jsxs)("div",{style:O.container,className:he().wx0,children:[(0,S.jsx)(lt().A,{store:t,shouldShowHalo:!i&&!I&&!l,canSelect:!i&&!R,disablePointerEvents:null==D?void 0:D.disableAllPointerEvents,analyticsName:"gallery",...e,ref:C,children:E?(0,S.jsx)(cs,{blockPropertyValueOverlayStore:c,collectionContextStore:r,collectionGalleryViewStore:b,disabled:p,format:o,isFullScreen:i,isRootChild:a,paddingLeft:h,schema:m,store:t}):(0,S.jsx)(Hr,{blockPropertyValueOverlayStore:c,collectionContextStore:r,collectionGalleryViewStore:b,disabled:p,format:o,groupFormat:void 0,isFullScreen:i,schema:m,store:t})}),!T&&(0,S.jsx)(Cn().A,{onChange:B})]})))}const gs=n.memo(ms);function Ss(e){const t=e.minHeight||ps,o=(0,u().IS)((e=>({card:{display:"flex",justifyContent:"center",alignItems:"flex-start",alignSelf:"stretch",borderRadius:vs,backgroundColor:e.largeShimmerColor,minHeight:t,width:"100%",marginBottom:4}})),[t]);return(0,S.jsx)(Er().A,{style:o.card})}function hs(){return(0,jr().A)(!0,0,100)?(0,S.jsx)(Ss,{}):null}const fs=5,vs=10,ys=7,xs=ys+32;function Cs(e,t){return t?0:e?8:12}const bs=function(e){let{groupsPointer:t,schema:o,format:n,collectionContextStore:r,store:i,disabled:l,blockPropertyValueOverlayStore:a,isFullScreen:c,anyGroupHasResults:p,isInPeekRenderer:m,hoveredGroupStore:g}=e;const h=(0,u().DP)(),f=(0,s().v3)(),v=(0,k().tz)(),{isMobile:y}=(0,s().Y0)(),x=(0,d().K8)((()=>{const e=C().HV(t);return(0,No().$e)({environment:f,groupFormat:e,schema:o,format:n,theme:h})}),[t,o,n,f,h]),b=(0,d().K8)((()=>{const e=r.groupsStore.getGroupState(t);return Boolean(null==e?void 0:e.reducerResultStore.state)}),[t,r]),w=(0,d().K8)((()=>r.groupsStore.getGroupState(t)),[r,t]),T=(0,d().K8)((()=>(0,L().mM)(r,c)),[r,c]),I=(0,d().K8)((()=>null==w?void 0:w.reducerResultStore.state),[w]),R=(0,d().O$)(r.permissionScopesStore),j=(0,d().O$)(r.isInHomeWidgetStore),P=(0,d().K8)((()=>!l&&b&&r.shouldAllowNewItemCreation({overrideAllowForTypedViews:!j})),[l,b,r,j]),M=(0,d().K8)((()=>(0,L().XQ)({reducerResult:I,collectionContextStore:r,isFullScreen:c})),[I,r,c]),_=(0,d().K8)((()=>(0,bn().iv)({collectionContextStore:r,groupsPointer:t,hasPartialResults:p})),[r,t,p]),V=(0,d().K8)((()=>p&&r.shouldShowSpinnerStore.state&&"load_general"===r.loadingDetailsStore.state.type),[r,p]),F=(0,d().K8)((()=>(0,L().fG)({collectionContextStore:r,environment:f,intl:v})),[f,r,v]),O=(0,d().K8)((()=>f.device.isMobile||(0,so().Mn)(g.state,C().HV(t))),[g,t,f]),E=(0,u().IS)((e=>({loadMoreButton:{borderRadius:vs,fontSize:y?16:14,padding:"5px 4px 5px 11px",height:void 0},loadMoreButtonIcon:{width:y?16:14,height:y?16:14}})),[y]);if(!w)return null;const D=function(e){return e?e.board_cover:void 0}(n),z=!l&&!R.isSyncedCollection,K=Boolean(n.collection_group_by),H=!p&&K&&_;return(0,S.jsxs)("div",{style:Ps(n,m,b,x),onMouseDown:e=>function(e,t){const{device:o}=t,{target:n}=e;!o.isMobile&&n instanceof HTMLElement&&(0,Ce().SQ)({event:e,context:Ce().y$.EditorMouseDown,callback:()=>{e.preventDefault(),A().jD({environment:t,target:n,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}(e,f),onClick:Rs,className:he().mVR,onMouseMove:()=>function(e,t){const o=C().HV(e);o&&t.state!==o&&t.setState(o)}(t,g),children:[(0,S.jsx)(gn,{collectionContextStore:r,groupsPointer:t,format:n,canDrag:z,onSelectableEnter:e=>js(e,t,r,c,f),resultProps:{format:n,schema:o,onTextEnter:e=>function(e,t,o,n,r,i){if(!(0,Ye().EF)(i)||!o.collectionStore())return As(e,o,r,t,i);const l=Is(t,o);if(!l)return;const s=l.state.findIndex((t=>t===e))+1;B().createAndCommit({userAction:"BoardGroupResults.handleItemTextEnter",environment:i,canUndo:!0,perform:e=>{An({transaction:e,environment:i,collectionContextStore:o,isFullScreen:n,groupsPointer:t,insertAtIndex:s,from:"board_group_enter_add_item",transient:!0})}})}(e,t,r,c,i,f),onShiftEnter:e=>js(e,t,r,c,f),coverFormat:D,coverAspectFormat:ws(n),coverSizeFormat:ks(n),colorStyle:x,onTextEsc:e=>As(e,r,i,t,f),disabled:l,blockPropertyValueOverlayStore:a,collectionContextStore:r},canDrop:!0,resultComponent:Rr,disabled:l,direction:pn.Vertical,shouldShowHoverMenu:!1,belowDropZoneMargin:2,emptyDroppableSize:K?ys:3,analyticsName:"board",loadContentCover:D&&"page_content"===D.type}),H&&(0,S.jsx)(hs,{}),M&&(0,S.jsx)(ho().Ay,{groupsPointer:t,store:i,collectionContextStore:r,format:n,isFullScreen:c,incrementLimitsInRelatedGroups:!0,style:E.loadMoreButton,iconStyle:E.loadMoreButtonIcon}),P&&(0,S.jsxs)(S.Fragment,{children:[M&&(0,S.jsx)("div",{style:{width:"100%",borderTop:`1px solid ${h.tableDividerColor}`,marginTop:4,marginBottom:4}}),(0,S.jsx)(Dn,{groupsPointer:t,collectionContextStore:r,isFullScreen:c,color:null==x?void 0:x.textColor,shouldShowSpinner:V})]}),F&&(0,S.jsx)(Hn,{groupFormat:C().HV(t),collectionContextStore:r,color:null==x?void 0:x.textColor,isHovered:O}),!T&&(0,S.jsx)(Cn().A,{onChange:e=>function(e,t,o,n,r){const i=t.isLoadingStore.state,l=t.groupsStore.getGroupState(n),s=null==l?void 0:l.reducerResultStore.state;e<De().A.incrementScrollOffset&&!i&&s&&s.hasMore&&((0,So().H)({collectionContextStore:t,environment:r,incrementLimitArgs:{isFullScreen:o,currentResultCount:s.blockIds.length,groupsPointer:n,incrementLimitsInRelatedGroups:!1}}),t.loadingDetailsStore.setState({type:"load_general"}))}(e,r,c,t,f)})]})};function ws(e){return e?e.board_cover_aspect:void 0}function ks(e){return e?e.board_cover_size:void 0}function Ts(e){const t=e.board_cover_size;return(0,L().rq)(t)}function Is(e,t){const o=t.groupsStore.getGroupState(e);return null==o?void 0:o.resultsStore}function Rs(e){(0,Ce().SQ)({event:e,context:Ce().y$.EditorClick,callback:()=>{}})}function js(e,t,o,n,r){const{blocks:i,transaction:l}=e;if(0===i.length)return;const s=i[0];if(!(0,Ye().EF)(r)||!o.collectionStore()||!o.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return;const a=Is(t,o);if(!a)return;An({transaction:l,environment:r,collectionContextStore:o,isFullScreen:n,groupsPointer:t,insertAtIndex:a.state.findIndex((e=>e===s))+1,from:"board_group_enter_add_item",transient:!0})}function As(e,t,o,n,r){const i=t.collectionStore(),l=e.getTitleStore();if(!l)return;if(xt().q4_(l.getValue()))P().Lt({environment:r,store:e});else if(i){const i=Is(n,t);if(!i)return;const l=i.state.findIndex((t=>t===e))-1,s=t.collectionViewStore(),a=t.collectionViewBlockStore();if(s&&a&&go(r,{...(0,fe().sl)(t),block_id:o.id}),B().createAndCommit({userAction:"BoardGroupResults.handleItemTextEsc",environment:r,canUndo:!0,perform:t=>{gt().by({childStore:e,transaction:t})}}),l>=0){const e=i.state[l];P().Lt({environment:r,store:e})}}}function Ps(e,t,o,n){const r=Boolean(e.collection_group_by);return{flex:"none",paddingLeft:ys,paddingRight:ys,paddingBottom:ys,marginRight:2*fs,boxSizing:"content-box",width:Ts(e),height:r?void 0:"max-content",...n&&o&&{backgroundColor:n.backgroundColor,...r?{borderRadius:vs}:{borderBottomLeftRadius:vs,borderBottomRightRadius:vs}}}}const Ms=28,Bs=12,_s=4,Vs=(0,k().YK)({addGroup:{defaultMessage:"Add a group",id:"database.boardView.addGroupButtonTitle"}}),Fs=n.memo((function(e){let{type:t,style:r,groupBy:i,currentGroups:l,schema:a,groupsLimitStore:c,collectionContextStore:p,parentStore:m,onAccept:g,paddingLeft:h,stickyLeft:f}=e;const v=(0,s().v3)(),y=(0,u().DP)(),x=(0,k().tz)(),C=(0,d().uB)(void 0,Oe().A),w=a[i.property],I=(0,d().K8)((()=>(0,No().$e)({environment:v,groupFormat:void 0,schema:a,format:p.normalizedFormatStore.state,theme:y})),[p,v,a,y]),R=(0,u().IS)((e=>({plusIcon:{fill:e.mediumTextColor},iconButton:{width:35,background:null==I?void 0:I.backgroundColor,paddingLeft:10,paddingRight:10,paddingTop:ys,paddingBottom:ys,marginRight:fs,borderRadius:vs,height:"100%",...r}})),[I,r]),j=(0,n.useCallback)((e=>{!function(e){let{schema:t,groupBy:o,currentGroups:n,groupsLimitStore:r,collectionContextStore:i,onAccept:l,environment:s,buttonPopupStore:a,update:c}=e;const{newGroupValue:d}=c,u=t[o.property],p=r.state;if(!u||!(0,so().Eg)(u))return;if((0,T().X)({environment:s,collectionContextStore:i,action:"board_add_group"}),a.reset(),co().lx(u)){if(u.type!==d.type)return;if(void 0===d.value)return;const e=u.options||[],r={id:po().JW(),value:d.value,color:(0,co().Zd)(e)},i=[...e,r],s={...u,options:i},a={...t,[o.property]:s},c={property:o.property,value:d,hidden:!1};return void l({newGroups:(0,No().DF)(n,c,p),newSchema:a})}if("person"===u.type||"relation"===u.type||(0,so().Vs)(u.type)){const e={property:o.property,value:d,hidden:!1};return void l({newGroups:(0,No().DF)(n,e,p),newPage:c.newPage})}if((0,so()._o)(u.type)||"status"===u.type||"number"===u.type||"created_by"===u.type||"last_edited_by"===u.type||"formula"===u.type||"checkbox"===u.type||"location"===u.type)return;(0,b().HB)(u.type)}({schema:a,groupBy:i,currentGroups:l,groupsLimitStore:c,collectionContextStore:p,onAccept:g,environment:v,buttonPopupStore:C,update:e})}),[C,p,l,v,i,c,g,a]),A=(0,n.useCallback)((()=>{!function(e){e.reset()}(C)}),[C]),P=(0,n.useCallback)((()=>(0,S.jsx)(o(330557).p,{groupFormat:void 0,groupBy:i,currentGroups:l,schema:a,onChange:j,onClose:A,parentStore:m})),[l,i,j,A,m,a]);return w&&(0,so().Eg)(w)?(0,S.jsx)(Ri().Ay,{render:P,buttonPopupStore:C,popupType:v.device.isMobile?Ri().z7.SlideUp:Ri().z7.Popup,renderOrigin:e=>"board"===t?(0,S.jsx)(jt().A,{ariaLabel:x.formatMessage(Vs.addGroup),icon:e=>(0,uo().W)({...e,...R.plusIcon}),style:R.iconButton,...e}):(0,S.jsx)(rt().p,{isLightGray:!0,icon:uo().W,style:{display:"flex",height:Ms,marginTop:Bs,marginBottom:_s,width:"max-content",position:f?"sticky":void 0,left:f&&h?h:0,...r},...e,children:x.formatMessage(Vs.addGroup)})}):null}),mo().A);var Ls=()=>o(864943);function Os(e){const{title:t,icon:n,onClick:r}=e,i=(0,s().Y0)();(0,o(388487).A)({capture:!0,preventType:Qt().A.X});const l=(0,u().IS)((e=>({wrapper:{display:"flex",alignItems:"center",justifyContent:"center",marginTop:50,marginBottom:300},phoneButton:{fontSize:16,color:e.lightTextColor,height:i.isPhone?36:void 0},phoneIcon:{width:18,height:18,fill:e.lightIconColor}})),[i.isPhone]);return(0,S.jsx)("div",{style:l.wrapper,className:he().okd,children:i.isPhone?(0,S.jsx)(Ls().A,{size:"lg",icon:n,iconStyle:l.phoneIcon,onClick:r,style:l.phoneButton,children:t}):(0,S.jsx)(rt().p,{isLightGray:!0,icon:n,iconStyle:{width:16,height:16},onClick:r,children:t})})}var Es=()=>o(439264),Ds=()=>o(132389);const zs=n.memo((function(e){let{render:t,collectionContextStore:o,groupsResultStore:n,groupsReducer:r}=e;return r?(0,S.jsx)(Wo().A,{id:"board_columns",reducer:r,collectionContextStore:o,resultStore:n,render:t}):(0,S.jsx)(S.Fragment,{children:t()})})),Ks=16;function Hs(e){const t=(0,u().IS)((()=>({button:{display:"inline",padding:"1px 2px",borderRadius:3,textDecoration:"underline"}})),[]);return(0,S.jsx)(Rt().A,{style:t.button,onClick:e.onClick,children:e.children})}const Gs=function(e){const{title:t,description:o,icon:n,style:r,buttonText:i,buttonOnClick:l}=e,s=(0,jr().A)(!0,300,0),a=(0,u().IS)((e=>({wrapper:{minHeight:250,height:1,display:"flex",alignItems:"center",flexDirection:"column",justifyContent:"center",padding:Ks,...r},title:{fontSize:17,fontWeight:w().Wy.medium,color:e.lightTextColor,textAlign:"center",marginBottom:-2},description:{margin:"0 auto",fontSize:14,color:e.lightTextColor},button:{marginTop:12,fontSize:14,fontWeight:w().Wy.medium,color:e.regularTextColor}})),[r]);return s?(0,S.jsxs)("div",{style:a.wrapper,children:[n,(0,S.jsx)("div",{style:a.title,children:t}),o?(0,S.jsx)("div",{style:a.description,children:o}):void 0,i?(0,S.jsx)(Ls().A,{size:"lg",onClick:l,style:a.button,children:i}):void 0]}):null},Ws=n.memo((function(e){const{collectionContextStore:t,isFullScreen:o,paddingLeft:r,paddingRight:i,paddingBottom:l}=e,s=(0,d().O$)(t.permissionScopesStore),a=t.settingsStore,c=(0,n.useCallback)((()=>{I().Ow({collectionContextStore:t,collectionSettingsStore:a}),I().a2({collectionSettingsStore:a,item:{type:"properties",timelineViewTab:"table"}})}),[t,a]);return(0,S.jsx)(Gs,{title:(0,S.jsx)(k().sA,{defaultMessage:"No group by property",id:"database.boardView.missingSelectPropertyTitle"}),description:s.canConfigureBlock?(0,S.jsx)(k().sA,{defaultMessage:"<opensettingslink>Add a property to group by</opensettingslink> to your database in order to display a Board view.",id:"database.boardView.missingSelectProperty",values:{opensettingslink:e=>(0,S.jsx)(Hs,{onClick:c,children:e})}}):(0,S.jsx)(k().sA,{defaultMessage:"Board views require a property to group by in order to display.",id:"database.boardView.missingSelectPropertyNoPermissions"}),style:{paddingLeft:r,paddingRight:i,paddingBottom:o?void 0:l}})}));function Ns(e){const{height:t,boardCoverSize:o,showGroupHeader:n,areColumnsColored:r}=e,i=e.numBoardColumns||3,l=function(e){const t=2*ys;return(0,L().rq)(e)+t}(o),s=(0,u().IS)((e=>({container:{display:"flex",alignItems:"flex-start",paddingTop:12},groupHeader:{backgroundColor:e.largeShimmerColor,height:16,marginBottom:10,borderRadius:12,width:"50%",opacity:n?1:0},group:{marginTop:r?20:12,marginRight:10,width:"100%",minWidth:l}})),[r,n,l]),a=C().Hn(i,(e=>(0,S.jsxs)("div",{style:s.group,children:[(0,S.jsx)(Er().A,{style:s.groupHeader}),(0,S.jsx)(Ss,{minHeight:t})]},e)));return(0,S.jsx)("div",{style:s.container,children:a})}var $s=()=>o(607517);const Us=n.memo((function(e){let{format:t,schema:o,collectionContextStore:n,store:r,columnsDisplayStateForCurrentGroups:i}=e;const l=(0,s().v3)(),a=(0,d().K8)((()=>n.contextType),[n]);return t.board_columns_by?"collectionTypedView"===a?null:(0,S.jsx)(Fs,{groupBy:t.board_columns_by,schema:o,currentGroups:i,onAccept:e=>function(e,t,o,n,r){const i=t.collectionStore();if(!i)return;const l=n.board_columns_by;if(!l)return;Xi({update:e,collectionContextStore:t,groupsFormatKey:"board_columns",collectionStore:i,schema:o,groupBy:l,environment:r})}(e,n,o,t,l),groupsLimitStore:n.boardColumnsLimitStore,parentStore:r,type:"board",collectionContextStore:n}):null}));var qs=()=>o(183558),Ys=()=>o(312296);function Xs(e,t,o){const{visibleGroups:n}=e,r=t.board_columns_by;if(!r)return!1;if(o.shouldShowSpinnerStore.state)return!1;if(0===n.length)return!1;const i=o.permissionScopesStore.state;return i.canConfigureBlock&&!i.isSyncedCollection&&(0,so().pP)(r,i.canConfigureCollection)}function Qs(e,t,o){return{marginLeft:e,marginRight:t,float:"left",paddingBottom:o}}function Zs(e){return{display:"flex",position:"relative",flexGrow:1,paddingBottom:e}}function Js(e){return{marginTop:4,...e.isLast&&{paddingBottom:12}}}function ea(e,t,o){return{height:"calc(100% + 17px)",...o?{}:{background:e?t.cardContentBackground:t.contentBackground},width:20,marginLeft:-20,marginTop:-17}}function ta(e,t){const o=e.isInHomeWidgetStore.state;return{width:220,flexShrink:0,marginTop:xs+Cs(t,o),marginLeft:12}}const oa=n.memo((function(e){const{collectionContextStore:t,columnsDisplayState:o,groupsResultStore:r,currentGroups:i,disableBoardColorColumns:l,disabled:a,format:c,headerPlaceholderHeight:p,hiddenGroups:m,hiddenGroupsHeaderRef:g,hoveredGroupStore:h,isFullScreen:f,isInPeekRenderer:v,isRootChild:y,paddingLeft:x,paddingRight:C,query:b,schema:w,store:T,visibleGroups:I}=e,R=(0,s().v3)(),j=(0,u().DP)(),A=(0,n.useRef)(null),P=(0,d().K8)((()=>(0,No().K3)({device:R.device,isFullScreen:f,isRootChild:y})),[R.device,f,y]),M=function(e,t,o,n){const r=(0,L().Oz)(t);return(0,d().K8)((()=>{const i=t.isInHomeWidgetStore.state,l=i?"transparent":(null==r?void 0:r.background)||(o?e.cardContentBackground:e.contentBackground),s=Cs(n,i);return{position:"absolute",background:l,height:xs+s,paddingTop:s,zIndex:85,display:"flex",boxShadow:`-3px 0 0 ${l}`,minWidth:"100%"}}),[t,null==r?void 0:r.background,o,e.cardContentBackground,e.contentBackground,n])}(j,t,v,l),B=(0,u().IS)((e=>({stickyHeader:{paddingLeft:x,paddingRight:C},stickyHeaderTransition:{paddingLeft:x},hiddenGroupsTitle:{display:"flex",alignItems:"center",width:220,flexShrink:0,fontSize:14,color:e.lightTextColor,marginLeft:20}})),[x,C]),_=(0,d().O$)(t.permissionScopesStore).canConfigureBlock,V=(0,d().O$)(t.isInHomeWidgetStore),F=(0,n.useCallback)(((e,o)=>(0,S.jsx)(ra,{schema:w,collectionContextStore:t,format:c,query:b,disabled:a,isFullScreen:f,isInPeekRenderer:v,hoveredGroupStore:h,groupFormat:I[o],currentGroups:i,groupsResultStore:r})),[t,i,a,c,h,f,v,b,r,w,I]),O=(0,n.useCallback)((e=>{"v2"!==o.version?(0,$s().r)({environment:R,collectionContextStore:t,isHidden:!1,groupsFormatKey:"board_columns",groupByKey:"board_columns_by",currentGroups:i,newGroupIds:e}):(0,$s().V)({environment:R,collectionContextStore:t,groupByKey:"board_columns_by",groupsFormatKey:"board_columns",newGroupIds:e,currentGroups:void 0})}),[t,o.version,i,R]),E=(0,d().K8)((()=>(0,No().Zl)(o,t,!0)),[t,o]),D=(0,d().K8)((()=>Xs(o,c,t)),[t,o,c]),z=(0,n.useMemo)((()=>"v2"===o.version?o.pinnedGroups.length>0?(0,S.jsxs)("div",{style:B.hiddenGroupsTitle,ref:g,children:[(0,S.jsx)(k().sA,{...No().K0.pinnedGroups}),(0,S.jsx)(Ds().A,{size:4}),(0,S.jsx)(na,{collectionContextStore:t})]}):null:m.length>0?(0,S.jsx)("div",{style:B.hiddenGroupsTitle,ref:g,children:(0,S.jsx)(k().sA,{defaultMessage:"Hidden groups",id:"collection.boardView.hiddenGroups.label"})}):null),[t,o,m.length,g,B.hiddenGroupsTitle]);if(0===I.length&&0===m.length&&"v2"===o.version&&0===o.pinnedGroups.length)return null;const K=I.map((e=>(0,so().Ix)(e)));return c.board_columns_by?(0,S.jsx)(Ki().g,{stickyAttachPoint:V?"no-stick":"ceiling",absoluteHeight:p,nodeRef:A,stickyStyle:B.stickyHeader,transitionStickyStyle:B.stickyHeaderTransition,children:(0,S.jsxs)("div",{style:M,ref:A,children:[P&&(0,S.jsx)("div",{style:ea(v,j,V)}),_?(0,S.jsx)(Es().Ay,{direction:"horizontal",keys:K,renderKey:F,onDrop:O}):K.map(((e,o)=>(0,S.jsx)(ra,{schema:w,collectionContextStore:t,format:c,query:b,disabled:a,isFullScreen:f,isInPeekRenderer:v,hoveredGroupStore:h,groupFormat:I[o],currentGroups:i,groupsResultStore:r},(0,so().Ix)(I[o])))),E&&(0,S.jsx)(Kl,{groupsDisplayState:o,groupsLimitStore:t.boardColumnsLimitStore,type:"board",schema:w,collectionContextStore:t}),D&&(0,S.jsx)(Us,{format:c,schema:w,collectionContextStore:t,store:T,columnsDisplayStateForCurrentGroups:i}),z]})}):null}));function na(e){const t=(0,k().tz)();return(0,S.jsx)(jt().A,{icon:Nr()._,ariaLabel:t.formatMessage(No().K0.pinnedGroups),onClick:()=>{const t=e.collectionContextStore.settingsStore;I().R8({collectionSettingsStore:t,item:{type:"group",groupByKey:"board_columns_by",groupsFormatKey:"board_columns"}})}})}const ra=n.memo((function(e){let{groupFormat:t,currentGroups:o,schema:n,collectionContextStore:r,format:i,query:l,disabled:s,isFullScreen:a,isInPeekRenderer:c,hoveredGroupStore:u,groupsResultStore:p}=e;return(0,d().K8)((()=>r.groupsStore.getGroupState([t])),[r,t])&&i.board_columns_by?(0,S.jsx)(wl,{currentGroups:o,groupFormat:t,query:l,schema:n,format:i,groupBy:i.board_columns_by,collectionContextStore:r,hoveredGroupStore:u,disabled:s,hidden:!1,isPopup:!1,isInPeekRenderer:c,isFullScreen:a,groupsResultStore:p}):null}));class ia extends p().default{constructor(){super("groupsReducerResultStore")}getInitialState(){}}var la=()=>o(419357),sa=()=>o(64e3),aa=()=>o(14235);class ca extends p().default{getInitialState(){return{searchQuery:"",limit:ca.defaultLimit}}}ca.defaultLimit=20,ca.loadMoreScrollOffset=200,ca.loadMoreIncrement=20;const da=ca,ua={display:"flex",alignItems:"center",justifyContent:"flex-start",height:32,padding:4,borderRadius:6},pa=(0,k().YK)({searchPlaceholder:{defaultMessage:"Search for a page…",id:"boardHiddenGroup.searchPlaceholder"}}),ma=n.memo((function(e){const{device:t}=(0,s().v3)(),r=(0,s().v3)(),i=(0,u().DP)(),{groupBy:l,groupFormat:a,disabled:c,format:p,query:m,schema:g,currentGroups:h,collectionContextStore:f,blockPropertyValueOverlayStore:v,isFullScreen:y,hoveredGroupStore:x,isInPeekRenderer:C}=e,b=(0,d().uB)(void 0,ia),w=(0,d().uB)(void 0,Oe().A),k=(0,d().uB)(void 0,da),T=n.useRef(null),I=(0,d().K8)((()=>{var e;return null===(e=m.aggregations)||void 0===e?void 0:e[0]}),[m]),R=(0,d().O$)(f.isInHomeWidgetStore),j=(0,d().K8)((()=>f.collectionViewBlockStore()),[f]),A=(0,n.useMemo)((()=>j?new(re().Bv)(r,{table:E().ev,id:j.id}):null),[r,j]),P=(0,n.useCallback)((()=>(0,S.jsx)(Ta,{groupFormat:a,disabled:c,format:p,collectionContextStore:f,schema:g,blockPropertyValueOverlayStore:v,isFullScreen:y,buttonPopupStore:w})),[v,w,f,c,p,a,y,g]),{searchQuery:M,limit:_}=(0,d().O$)(k),V=(0,d().K8)((()=>{const e=(0,vo().Yy)({schema:g,group:a,groupBy:p.board_columns_by,propertyMapping:void 0,timeZone:(0,yo().P)(),experimentService:Io().default});if(!e)return;return{type:"results",filter:e,limit:_,searchQuery:M,loadContentCover:Boolean(p&&p.board_cover&&"page_content"===p.board_cover.type)}}),[a,g,p,M,_]),F=(0,n.useCallback)((e=>function(e,t,o){o.setState({searchQuery:e.target.value,limit:da.defaultLimit}),xa(t)}(e,r,k)),[r,k]),O=(0,n.useCallback)((()=>function(e,t){t.reset(),xa(e)}(r,k)),[r,k]),D=(0,n.useCallback)((()=>(0,S.jsxs)(n.Fragment,{children:[!t.isMobile&&(0,S.jsx)(wl,{groupBy:l,currentGroups:h,groupFormat:a,query:m,schema:g,format:p,collectionContextStore:f,disabled:c||Boolean(M),hidden:!0,isPopup:!0,isFullScreen:y,hoveredGroupStore:x,isInPeekRenderer:C,groupsResultStore:b},(0,so().Ix)(a)),(0,S.jsx)("div",{style:{margin:t.isMobile?0:"6px 0"},children:(0,S.jsx)(St().A,{capture:!0,render:e=>(0,S.jsx)(la().Ay,{value:M,placeholder:yt().A.formatMessage(pa.searchPlaceholder),autoFocus:!t.isMobile,showClearButton:!0,onChange:F,onClearButtonClick:O,...e})})})]})),[f,h,t.isMobile,c,p,l,a,O,F,x,y,C,m,b,g,M]),z=(0,n.useCallback)((e=>function(e,t,o,n){var r;const i=n.state,l=null===(r=va(t,o))||void 0===r||null===(r=r.state)||void 0===r?void 0:r.blockIds,s=t.isLoadingStore.state;e<da.loadMoreScrollOffset&&!s&&l&&i.limit<=l.length&&n.setState({...i,limit:i.limit+da.loadMoreIncrement})}(e,f,a,k)),[f,a,k]),K=(0,n.useCallback)((e=>(0,S.jsx)("div",{...e,children:(0,Nr()._)({width:18,height:18,color:i.lightTextColor})})),[i.lightTextColor]),H=(0,n.useCallback)((e=>(0,S.jsx)(Ca,{parent:e,groupFormat:a,currentGroups:h,format:p,schema:g,query:m,collectionContextStore:f})),[a,h,p,g,m,f]),G=(0,n.useCallback)((e=>{let o,{selectableEvents:n}=e;return o=t.isMobile?{menuType:li().gu.Modal,title:(0,S.jsx)(zi().A,{groupBy:l,groupFormat:a,currentGroups:h,schema:g,disabled:!0,isHiddenGroup:!0,collectionContextStore:f}),left:(0,S.jsx)(Ri().Ay,{popupType:aa().nl.SlideUp,renderOrigin:K,render:H}),right:(0,S.jsx)(di().DoneMenuText,{}),onClickRight:()=>ka(w),header:D()}:{menuType:li().gu.Popup,header:D(),width:(0,L().rq)(fa(p))+20},V?(0,S.jsxs)(ai().A,{...o,...n,children:[(0,S.jsx)(Wo().A,{id:`board_hidden_group:${(0,so().Ix)(a)}`,reducer:V,groupsPointer:[a],collectionContextStore:f,resultStore:va(f,a),render:P}),(0,S.jsx)(Cn().A,{onChange:z})]}):null}),[t.isMobile,V,a,f,P,z,l,h,g,K,H,D,w,p]),W=(0,n.useCallback)((()=>{if(A)return(0,S.jsx)(o(13679).A,{store:A,isDefaultContainer:!0,droppable:!0,render:G})}),[A,G]),N=(0,n.useCallback)((()=>function(e,t){t.reset(),xa(e)}(r,k)),[r,k]),$=(0,n.useCallback)((async e=>{const{droppedStores:t,duplicate:o}=e,n=T.current;if(!n)return;if(!(n instanceof Element))return;const i=await me().T.formulas.load();B().createAndCommit({userAction:"BoardHiddenGroup.handleDrop",environment:r,canUndo:!0,perform:e=>Eo({environment:r,collectionContextStore:f,groupsPointer:[a],droppedStores:t,duplicate:o,transaction:e,collapsedGroup:!0,collectionStore:void 0,targetStore:void 0,droppedDirection:void 0,formulasModule:i})})}),[f,a,r]),U=(0,n.useCallback)((e=>(0,S.jsx)(ga,{buttonPopupEvents:e,aggregation:I,schema:g,collectionContextStore:f,query:m,groupFormat:a,groupBy:l,currentGroups:h,isInHomeWidget:R,groupsResultStore:b})),[g,f,m,a,l,h,R,I,b]);return A?(0,S.jsx)("div",{ref:T,children:(0,S.jsx)(lt().A,{store:A,canDropOnto:!c,onSelectableDrop:$,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,analyticsName:"board_hidden_group",shouldShowDropZone:!0,children:(0,S.jsx)(Ri().Ay,{popupType:t.isMobile?aa().nl.SlideUp:aa().nl.Popup,renderOrigin:U,render:W,buttonPopupStore:w,onClick:N})})}):null}));function ga(e){let{query:t,aggregation:o,buttonPopupEvents:r,groupFormat:i,groupBy:l,currentGroups:a,schema:c,collectionContextStore:d,isInHomeWidget:p,groupsResultStore:m}=e;const g=(0,s().v3)(),h=(0,u().IS)((e=>({button:{...ua,...p?{fontSize:14}:{}}})),[p]),f=(0,n.useCallback)((e=>function(e,t,o,n){const r=t.collectionViewStore(),i=e?[e]:[],l={...o,aggregations:i};r&&B().createAndCommit({userAction:"BoardHiddenGroup.handleBoardAggregationChange",environment:n,canUndo:!0,perform:e=>{(0,ri().F)({collectionViewStore:r,update:{query2:l},transaction:e})}})}(e,d,t,g)),[d,t,g]);return(0,S.jsxs)(Rt().A,{style:h.button,...r,children:[(0,S.jsx)(zi().A,{groupBy:l,groupFormat:i,currentGroups:a,schema:c,disabled:!0,isHiddenGroup:!0,collectionContextStore:d}),o&&(0,S.jsx)(vl,{groupFormat:i,aggregation:o,schema:c,collectionContextStore:d,disabled:!0,onChange:f,groupsResultStore:m})]},(0,so().Ix)(i))}function Sa(e){return e?e.board_cover:void 0}function ha(e){return e?e.board_cover_aspect:void 0}function fa(e){return e?e.board_cover_size:void 0}function va(e,t){const o=e.groupsStore.getGroupState(t);return null==o?void 0:o.reducerResultStore}function ya(e,t){const o=e.groupsStore.getGroupState(t);return null==o?void 0:o.resultsStore}function xa(e){ie().default.state.stores.length>0&&P().IU({environment:e})}function Ca(e){let{parent:t,groupFormat:o,currentGroups:n,format:r,schema:i,query:l,collectionContextStore:s}=e;const a=(0,d().K8)((()=>s.collectionStore()),[s]),c=s.boardColumnsLimitStore;return a?(0,S.jsx)(gi,{parent:t,groupFormat:o,currentGroups:n,format:r,schema:i,query:l,collectionContextStore:s,groupsFormatKey:"board_columns",groupsLimitStore:c}):null}function ba(e,t,o,n,r){const{blocks:i,transaction:l}=e,s=o.groupsStore.getGroupState(t);if(!s)return;const a=s.resultsStore;if(i.length>0&&a.state.length>0){const e=i[0];if(!(0,Ye().EF)(r)||!o.collectionStore()||!o.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return;An({transaction:l,environment:r,collectionContextStore:o,isFullScreen:n,groupsPointer:[t],insertAtIndex:a.state.findIndex((t=>t===e))+1,from:"board_group_enter_add_item",transient:!0})}}function wa(e,t,o,n){const r=t.collectionStore(),i=e.getTitleStore();if(xt().q4_(null==i?void 0:i.getValue()))return void P().Lt({environment:n,store:e});if(!r)return;const l=ya(t,o);if(!l)return;const s=l.state.findIndex((t=>t===e))-1,a=t.collectionViewStore(),c=t.collectionViewBlockStore();if(a&&c&&go(n,{...(0,fe().sl)(t),block_id:e.id}),B().createAndCommit({userAction:"BoardHiddenGroup.handleBoardItemTextEsc",environment:n,canUndo:!0,perform:t=>{gt().by({childStore:e,transaction:t})}}),s>=0){const e=l.state[s];P().Lt({environment:n,store:e})}}function ka(e){e.setState({open:!1})}function Ta(e){let{groupFormat:t,disabled:o,format:r,collectionContextStore:i,schema:l,blockPropertyValueOverlayStore:a,isFullScreen:c,buttonPopupStore:u}=e;const p=(0,s().v3)(),m=(0,n.useCallback)((()=>ka(u)),[u]),g=(0,n.useCallback)((e=>ba(e,t,i,c,p)),[t,i,c,p]),{device:h}=p,f=(0,d().K8)((()=>{var e;return null===(e=va(i,t))||void 0===e?void 0:e.state}),[i,t]),v=(0,d().K8)((()=>{var e;return null===(e=ya(i,t))||void 0===e?void 0:e.state}),[i,t]),y=(0,d().K8)((()=>Ue().default.isSidePeekOpen()),[]);return f&&v?0===v.length?(0,S.jsx)(ui().A,{children:(0,S.jsx)(sa().A,{title:(0,S.jsx)(k().sA,{defaultMessage:"No results",id:"database.boardView.searchResults.noResults.label"})})}):(0,S.jsx)("div",{style:{padding:h.isMobile?"8px 16px":"6px 14px 8px"},children:(0,S.jsx)(gn,{collectionContextStore:i,groupsPointer:[t],format:r,canDrag:!o,onSelectableEnter:g,disableRequest:!0,resultProps:{format:r,schema:l,disabled:o,coverFormat:Sa(r),coverAspectFormat:ha(r),coverSizeFormat:fa(r),colorStyle:void 0,blockPropertyValueOverlayStore:a,onTextEnter:e=>function(e,t,o,n,r){const i=ya(t,n);if(!i)return;if(!(0,Ye().EF)(r)||!t.collectionStore())return wa(e,t,n,r);const l=i.state.findIndex((t=>t===e))+1;B().createAndCommit({userAction:"BoardGroupResults.handleItemTextEnter",environment:r,canUndo:!0,perform:e=>{An({transaction:e,environment:r,collectionContextStore:t,isFullScreen:o,groupsPointer:[n],insertAtIndex:l,from:"board_group_enter_add_item",transient:!0})}})}(e,i,c,t,p),onTextEsc:e=>wa(e,i,t,p),onShiftEnter:e=>ba(e,t,i,c,p),collectionContextStore:i},resultComponent:Rr,handleOpenPeekPage:y?void 0:m,canDrop:!0,disabled:o,shouldShowHoverMenu:!1,direction:pn.Vertical,belowDropZoneMargin:2,emptyDroppableSize:4,analyticsName:"board"})}):(0,S.jsx)(ui().A,{children:(0,S.jsx)(sa().A,{title:(0,S.jsx)(En().A,{})})})}const Ia=ma,Ra=n.memo(n.forwardRef((function(e,t){const{collectionContextStore:o,disabled:r,disableBoardColorColumns:i,hiddenGroups:l,store:a,format:c,query:u,schema:p,isFullScreen:m,isInPeekRenderer:g,blockPropertyValueOverlayStore:h,columnsDisplayStateForCurrentGroups:f,hoveredGroupStore:v}=e,y=(0,s().v3)(),x=(0,s().Y0)(),C=(0,je().bx)(a,r),b=(0,d().K8)((()=>C&&!x.isMobile&&!o.permissionScopesStore.state.isLocked&&o.permissionScopesStore.state.canEditContent),[C,o,x]),w=(0,n.useMemo)((()=>l.slice(0,No().RP)),[l]),k=(0,n.useMemo)((()=>w.map((e=>(0,so().Ix)(e)))),[w]),T=(0,d().O$)(o.permissionScopesStore),I=(0,n.useCallback)((e=>{if(c.board_columns_by)return(0,S.jsx)(Ia,{query:u,schema:p,format:c,groupFormat:e,groupBy:c.board_columns_by,currentGroups:f,collectionContextStore:o,disabled:r||!C||!T.canEditContent&&"collectionTypedView"!==o.contextType,blockPropertyValueOverlayStore:h,isFullScreen:m,hoveredGroupStore:v,isInPeekRenderer:g},(0,so().Ix)(e))}),[h,C,o,f,r,c,v,m,g,T.canEditContent,u,p]),R=(0,n.useCallback)(((e,t)=>I(w[t])),[w,I]),j=(0,n.useCallback)((e=>(0,$s().r)({environment:y,collectionContextStore:o,isHidden:!0,groupsFormatKey:"board_columns",groupByKey:"board_columns_by",currentGroups:f,newGroupIds:e})),[o,f,y]),A=(0,d().K8)((()=>ta(o,i)),[o,i]);return(0,S.jsx)("div",{style:A,ref:t,children:w.length>0&&(b?(0,S.jsx)(Es().Ay,{direction:"vertical",keys:k,renderKey:R,onDrop:j}):(0,S.jsx)("div",{children:w.map(I)}))})})));const ja=n.memo(n.forwardRef((function(e,t){const{collectionContextStore:o,disableBoardColorColumns:n,columnsDisplayState:r,disabled:i}=e,l=(0,d().K8)((()=>ta(o,n)),[o,n]),s=r.pinnedGroups;return(0,S.jsx)("div",{ref:t,style:l,children:s.map((e=>(0,S.jsx)(Aa,{groupFormat:e,collectionContextStore:o,columnsDisplayState:r,disabled:i},(0,so().Ix)(e))))})})));function Aa(e){const{groupFormat:t,collectionContextStore:r,columnsDisplayState:i,disabled:l}=e,a=(0,s().v3)(),c=(0,k().tz)(),u=n.useRef(null),p=(0,d().O$)(r.normalizedFormatStore),m=(0,d().O$)(r.normalizedSchemaStore),[g,h]=n.useState(!1),f=(0,d().K8)((()=>{const e=r.collectionViewBlockStore();return e?new(re().Bv)(a,{table:E().ev,id:e.id}):null}),[a,r]),v=n.useCallback((async e=>{const{droppedStores:t,duplicate:o,groupFormat:n}=e,i=u.current;if(!i)return;if(!(i instanceof Element))return;const l=await me().T.formulas.load();B().createAndCommit({userAction:"BoardPinnedGroup.handleDrop",environment:a,canUndo:!0,perform:e=>Eo({environment:a,collectionContextStore:r,groupsPointer:[n],droppedStores:t,duplicate:o,transaction:e,collapsedGroup:!0,collectionStore:void 0,targetStore:void 0,droppedDirection:void 0,formulasModule:l})})}),[r,a]),y=n.useCallback((()=>{(0,ni().m)({environment:a,collectionContextStore:r,groupsFormatKey:"board_columns",groupFormat:t,currentGroups:i.currentGroups,action:"toggle_group_pin"})}),[a,r,t,i]),x=p.board_columns_by;if(!x)return null;if(!f)return null;const C={onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1)};return(0,S.jsx)("div",{ref:u,children:(0,S.jsxs)(lt().A,{analyticsName:"board_pinned_group",store:f,canDropOnto:!l,shouldShowDropZone:!0,dropzoneMustBeWithinHorizontalBound:!0,dropzoneShouldNeverUseOrigin:!0,onSelectableDrop:async e=>{await v({...e,groupFormat:t})},style:{display:"flex",alignItems:"center"},children:[(0,S.jsx)(zi().A,{collectionContextStore:r,currentGroups:i.currentGroups,groupBy:x,groupFormat:t,schema:m,disabled:!0,isHiddenGroup:!1}),(0,S.jsx)(At().A,{renderTooltip:e=>(0,S.jsx)(k().sA,{...e,...No().K0.unpinGroup}),render:e=>(0,S.jsx)(jt().A,{...(0,Ci().A)(e,C),ariaLabel:c.formatMessage(No().K0.unpinGroup),icon:g?o(573812)._:o(68207).S,iconStyle:{width:16,height:16},onClick:y})})]})},(0,so().Ix)(t))}const Pa=n.memo((function(e){let{args:t,collectionContextStore:o,isInPeekRenderer:n,format:r,setSubgroupsMounted:i,columnsDisplayStateStore:l}=e;const s=(0,d().O$)(o.isInHomeWidgetStore),a=(0,d().K8)((()=>function(e,t){return t.state.visibleGroups.length*(bl(e)+2*ys+2*fs)}(r,l)),[r,l]),{stickyStyle:c}=(0,u().IS)((e=>s?{stickyStyle:{}}:{stickyStyle:{background:n?e.cardContentBackground:e.contentBackground,boxShadow:`0 1px 0 ${n?e.cardContentBackground:e.contentBackground}`}}),[s,n]);return(0,S.jsx)(Gi,{...t,height:s?ft().ag:36,stickyStyle:c,style:{...t.style,minWidth:a},onMount:i})})),Ma=p().default.createClass(void 0,{name:"GroupsReducerResultStore"}),Ba=p().default.createClass(void 0,{name:"HoveredGroupStore"}),_a=n.memo((function(e){const{store:t,format:r,schema:i,collectionContextStore:a,isFullScreen:c,isPreviewing:p,paddingLeft:m,paddingRight:g,paddingBottom:h,disabled:f,query:v,blockPropertyValueOverlayStore:y,isInPeekRenderer:x,isRootChild:b}=e,w=(0,s().v3)(),T=(0,u().DP)(),R=(0,k().tz)(),j=(0,n.useRef)(null),P=(0,n.useRef)(null),M=(0,n.useRef)(0),_=(0,n.useRef)(null),V=(0,d().uB)(void 0,Ma),F=(0,d().O$)(V),O=(0,d().uB)(void 0,Ba),[E,D]=(0,n.useState)(!1),z=(0,d().r6)((()=>{var e,t;const o=a.collectionViewStore();if(!o)return[void 0,void 0];return[null==o||null===(e=o.getFormatStore())||void 0===e?void 0:e.getKeyStore("collection_group_by").getValue(),null==o||null===(t=o.getFormatStore())||void 0===t?void 0:t.getKeyStore("board_columns_by").getValue()]}),[a],{useDeepEqual:!0}),K=(0,d().K8)((()=>{const e=r.board_columns_by;if(e)return(0,so().oH)({schema:i,groupBy:e})}),[r.board_columns_by,i],{useDeepEqual:!0}),H=(0,d().O$)(a.boardColumnsLimitStore),G=(0,d().K8)((()=>!Boolean((0,No().$e)({environment:w,groupFormat:void 0,schema:i,format:r,theme:T}))),[w,r,i,T]),[W,N]=(0,Ji().d)({collectionContextStore:a,groupBy:r.board_columns_by,groupsFormatKey:"board_columns",reducerResult:F,groupsLimit:H}),$=(0,d().K8)((()=>{var e;const{visibleGroups:t}=W,o=r.collection_group_by,n=a.collectionViewBlockStore(),l=V.state;if("v2"===(null==l?void 0:l.version))return a.groupsStore.anyGroupHasResults();const s=void 0!==n?(0,No().ck)({groupBy:o,schema:i,formatGroups:r.collection_groups||[],schemaGroups:K,reducerResults:null==l?void 0:l.results,getRecordModel:n.getRecordModel,getRecordRole:n.getRecordRole,relativeVariableResult:a.relativeVariableStore.state,viewAppConfigUri:null===(e=a.collectionViewStore())||void 0===e?void 0:e.getFormat().app_config_uri,allowedCollectionStores:a.collectionStoresStore.state}):[];if(0===s.length){if(void 0!==o)return!1;for(const e of t){const t=a.groupsStore.getGroupState(e);if(null!=t&&t.reducerResultStore.state)return!0}}else for(const r of s)for(const e of t){const t=[r,e],o=a.groupsStore.getGroupState(t);if(null!=o&&o.reducerResultStore.state)return!0}return!1}),[a,W,r,V,i,K]),U=(0,d().K8)((()=>{var e;const t=r.board_columns_by;if(t)return(0,No().p_)({groupBy:t,schema:i,format:r,groupsFormatKey:"board_columns",limit:a.boardColumnsLimitStore.state,aggregation:null===(e=v.aggregations)||void 0===e?void 0:e.at(0)})}),[a,r,v,i]),q=(0,je().bx)(t,f),Y=(0,d().K8)((()=>{const e=a.permissionScopesStore.state;return q&&("collectionTypedView"===a.contextType||e.canEditContent)}),[q,a]);(0,n.useEffect)((()=>{const e=a.collectionStore();e&&(!r.board_columns_by&&t.isDefined()&&e.isDefined()&&function(e,t,o,n){const r=e.collectionStore(),i=e.permissionScopesStore.state;if(!r||!r.isDefined())return;const l=e.collectionViewStore();l&&i.canConfigureBlock&&B().createAndCommit({userAction:"Board.updateOrCreateColumnsByProperty",environment:n,canUndo:!0,perform:s=>{let a,c=L().In(t);if(!c&&i.canConfigureCollection&&(c=(0,qs().Ay)(),a={[c]:{name:o.formatMessage({id:"collection.boardView.selectProperty.defaultName",defaultMessage:"Status"}),type:"select",options:[]}}),!c)return;const d=(a||t)[c];d&&(0,so().Eg)(d)&&(Nn().zA({stores:[l],update:{board_columns_by:(0,so().V0)({property:c,propertySchema:d,isCollectionTypedView:"collectionTypedView"===e.contextType})},transaction:s}),Ko().zv({store:l,data:{type:"board"},transaction:s}),a&&(0,Ys().F)({environment:n,collectionStore:r,update:a,transaction:s}))}})}(a,i,R,w),l().default.afterNextFlush((()=>{if(!P.current||!j.current)return;let e=0;if(j.current){const t=P.current.getBoundingClientRect().left;e=j.current.getBoundingClientRect().left-t+8}const t=e+M.current;M.current=t,P.current.style.left=`${t}px`})))}),[a,w,r.board_columns_by,R,i,t]);const X=(0,n.useMemo)((()=>C().sg((()=>function(e,t,o,n){Zi({environment:e,format:t,groupsFormatKey:"board_columns",collectionContextStore:o,currentGroups:n.state.currentGroups})}(w,r,a,N)),5e3)),[a,N,w,r]);(0,n.useEffect)((()=>(N.addListener(X),()=>{N.removeListener(X),X.cancel()})),[N,X]),(0,n.useEffect)((()=>{const e=()=>D(!1);return z.addListener(e),()=>z.removeListener(e)}),[z]);const Q=(0,n.useCallback)((()=>O.setState(void 0)),[O]),Z=(0,n.useCallback)((e=>{const o=W.visibleGroups;return(0,S.jsx)("div",{style:Es().Z0,children:o.map(((n,l)=>{const s=l===o.length-1,d=e?[e,n]:[n],u=0!==W.hiddenGroups.length;return a.groupsStore.getGroupState(d)?(0,S.jsx)(bs,{store:t,hoveredGroupStore:O,query:v,schema:i,format:r,groupsPointer:d,collectionContextStore:a,isFullScreen:c,isInPeekRenderer:x,disabled:f||!Y,isLast:s&&!u,blockPropertyValueOverlayStore:y,anyGroupHasResults:$},(0,so().Hm)(d)):null}))})}),[$,y,Y,a,W.hiddenGroups.length,W.visibleGroups,f,r,O,c,x,v,i,t]),J=(0,n.useCallback)((()=>{D(!0)}),[D]),ee=(0,n.useCallback)((e=>(0,S.jsx)(Pa,{collectionContextStore:a,isInPeekRenderer:x,format:r,setSubgroupsMounted:J,columnsDisplayStateStore:N,args:e})),[a,N,r,x,J]),te=(0,n.useCallback)((e=>function(e,t,o){const{device:n}=o;if(n.isMobile)Tn().uK({environment:o,store:e,pageVisitSource:wn().y8.Create});else{const n="collectionTypedView"===t.contextType;In().VU({environment:o,store:e,peekMode:L().hH(t),showMoveTo:n,resultsStore:void 0,collectionContextStore:t,pageVisitSource:wn().y8.Create})}}(e,a,w)),[a,w]),oe=$,ne=E,re=(0,d().O$)(a.shouldShowSpinnerStore)&&!ne&&!oe,ie=(0,d().O$)(a.isInHomeWidgetStore),le=(0,d().K8)((()=>!!a.viewsModuleContextStore.getViewModuleType()),[a]),{visibleGroups:se,hiddenGroups:ae}=W,ce=(0,d().K8)((()=>"v2"===W.version?r.board_columns||[]:W.currentGroups),[W.currentGroups,W.version,r.board_columns]),de=r.collection_group_by,pe=c?480:ie?220:360,me=xs+Cs(G,ie),ge=(0,n.useMemo)((()=>"v2"===W.version?W.pinnedGroups.length>0?(0,S.jsx)(ja,{ref:P,collectionContextStore:a,disableBoardColorColumns:G,columnsDisplayState:W,disabled:f}):(0,S.jsx)(Ds().A,{size:64}):ae.length>0?(0,S.jsx)(Ra,{ref:P,collectionContextStore:a,store:t,disabled:f,hiddenGroups:ae,disableBoardColorColumns:G,format:r,schema:i,query:v,blockPropertyValueOverlayStore:y,isFullScreen:c,isInPeekRenderer:x,columnsDisplayStateForCurrentGroups:W.currentGroups,hoveredGroupStore:O}):null),[y,a,W,G,f,r,ae,O,c,x,v,i,t]),Se=(0,ue().Zp)(),fe=(0,n.useCallback)((()=>{I().R8({collectionSettingsStore:a.settingsStore,item:{type:"group",groupByKey:"board_columns_by",groupsFormatKey:"board_columns"}})}),[a]),ve=(0,n.useCallback)((()=>"v2"===W.version&&0===W.visibleGroups.length&&0===W.pinnedGroups.length?(0,S.jsx)(Os,{onClick:fe,icon:ao().e,title:(0,S.jsx)(k().sA,{id:"board.emptyState.button",defaultMessage:"All groups are hidden"})}):(0,Ar().A)((e=>(0,S.jsx)("div",{style:Qs(m,g,se.length>0?me:0),className:he().okd,...e,ref:_,children:(0,S.jsx)(il().b,{nodeRef:_,children:(0,S.jsxs)(lt().A,{style:Zs(h),store:t,shouldShowHalo:!c&&!ie&&!p,canSelect:!c&&!le,disablePointerEvents:null==Se?void 0:Se.disableAllPointerEvents,onMouseDown:e=>function(e,t){const{device:o}=t,{target:n}=e;!o.isMobile&&0===e.button&&n instanceof HTMLElement&&(0,Ce().SQ)({event:e,context:Ce().y$.EditorMouseDown,callback:()=>{e.preventDefault(),A().jD({environment:t,target:n,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}(e,w),analyticsName:"board",onMouseLeave:Q,children:[(!re||!ie)&&(0,S.jsx)(oa,{collectionContextStore:a,columnsDisplayState:W,currentGroups:ce,disableBoardColorColumns:G,disabled:f,groupsResultStore:V,format:r,headerPlaceholderHeight:me,hiddenGroups:ae,hiddenGroupsHeaderRef:P,hoveredGroupStore:O,isFullScreen:c,isInPeekRenderer:x,isRootChild:b,paddingLeft:m,paddingRight:g,query:v,schema:i,store:t,visibleGroups:se}),re&&(0,S.jsx)(Ns,{height:pe,numBoardColumns:se.length,boardCoverSize:r.board_cover_size,areColumnsColored:!G,showGroupHeader:0===se.length}),se.length>0&&(0,S.jsx)("div",{style:{display:"flex",flexDirection:"column",position:"relative",top:me},children:de?(0,S.jsx)(rs,{reducerId:o(381891).bq,store:t,collectionContextStore:a,disabled:f,isFullScreen:c,isRootChild:b,paddingLeft:m,stickyLeft:!w.device.isMobile,renderGroup:Z,getGroupStyle:Js,renderHeader:ee,onGroupHeaderAddItem:te}):Z(void 0)}),(0,No().Zl)(W,a,!0)&&(0,S.jsx)("div",{style:{width:90,marginLeft:fs,marginRight:fs,pointerEvents:"none"}}),Xs(W,r,a)&&(0,S.jsx)("div",{style:{width:35,marginLeft:fs,marginRight:fs,pointerEvents:"none"}}),ge]})})})))),[a,W,ce,G,f,w,r,de,fe,V,Q,me,ae,O,c,ie,x,p,b,le,te,h,m,g,Se,v,Z,ee,i,pe,re,ge,t,se]);return r.board_columns_by?(0,S.jsx)(zs,{collectionContextStore:a,groupsResultStore:V,groupsReducer:U,render:ve}):(0,S.jsx)(Ws,{collectionContextStore:a,isFullScreen:c,paddingLeft:m,paddingRight:g,paddingBottom:h})}));var Va=()=>o(604995),Fa=()=>o(636740),La=()=>o(397248),Oa=()=>o(833880),Ea=()=>o(253021),Da=()=>o(747671),za=()=>o(597777);function Ka(e){const{blockPropertyValueOverlayStore:t,calendarBy:r,calendarViewRange:i,canEditCalendar:l,collectionContextStore:s,columnIndex:a,currentlyViewedMonth:c,endOfDay:d,format:p,items:m,query:g,sortedResultsStore:h,schema:f,shouldShowShimmer:v,startOfDay:y}=e,x=(0,Va().vY)({firstDate:y,secondDate:c}),C=(0,Va().c_)(y),b=!x&&!C&&"week"!==i,w=(0,u().IS)((e=>({button:{width:"100%",height:44,borderRadius:6},dayNumber:{height:28,color:b?e.lightTextColor:C?e.white:void 0,...C?{width:28,lineHeight:"28px",borderRadius:"100%",textAlign:"center",background:Pn().Ay.red,marginLeft:"auto",marginRight:"auto"}:{display:"flex",alignItems:"center",justifyContent:"center"}},eventDot:{width:8,height:8,background:e.mediumIconColor,borderRadius:"100%",marginTop:2,marginLeft:"auto",marginRight:"auto"}})),[C,b]),k=(0,n.useMemo)((()=>m.find((e=>(0,za().m6)(y,d,e.start,e.end?e.end:void 0)))),[m,y,d]),T=(0,Va().wN)(y),I=(0,n.useCallback)((e=>(0,S.jsxs)(Rt().A,{style:w.button,...e,children:[(0,S.jsx)("div",{style:w.dayNumber,className:v?`notion-shimmer-calendar-transition notion-shimmer-text animation-delay-${a}`:"notion-shimmer-calendar-transition",children:T}),k&&(0,S.jsx)("div",{style:w.eventDot})]})),[w,v,a,T,k]),R=(0,n.useCallback)((e=>(0,S.jsx)(o(824622).iq,{collectionContextStore:s,initialStartOfDay:y,format:p,schema:f,query:g,calendarBy:r,disabled:!l,onDismiss:e.close,blockPropertyValueOverlayStore:t,resultsStore:h})),[s,y,p,f,g,r,l,t,h]);return(0,S.jsx)(Ri().Ay,{popupType:Ri().z7.SlideUp,renderOrigin:I,render:R},T.toString())}const Ha=(0,n.memo)(Ka);function Ga(e){const{blockPropertyValueOverlayStore:t,calendarBy:o,calendarViewRange:r,canEditCalendar:i,collectionContextStore:l,currentlyViewedMonth:s,format:a,items:c,query:d,sortedResultsStore:p,schema:m,shouldShowShimmer:g,showWeekends:h,startOfWeek:f}=e,v=(0,u().IS)((e=>({container:{display:"flex",boxShadow:`0 -1px 0 ${e.tableDividerColor}`,paddingTop:8,paddingBottom:8,fontSize:14}})),[]),y=h?7:5,x=(0,n.useMemo)((()=>[...Array(y).keys()].map((e=>{const t=(0,Va().K1)({date:f,daysToAdd:e});return{startOfDay:t,endOfDay:(0,Va().P9)(t)}}))),[y,f]);return(0,S.jsx)("div",{style:v.container,children:x.map(((e,n)=>(0,S.jsx)(Ha,{blockPropertyValueOverlayStore:t,calendarBy:o,canEditCalendar:i,collectionContextStore:l,columnIndex:n,currentlyViewedMonth:s,endOfDay:e.endOfDay,format:a,items:c,query:d,sortedResultsStore:p,schema:m,shouldShowShimmer:g,startOfDay:e.startOfDay,calendarViewRange:r},e.startOfDay.toString())))},f.toString())}const Wa=(0,n.memo)(Ga);var Na=()=>o(751735),$a=()=>o(465364);const Ua=30,qa=(0,k().YK)({addItemLabel:{defaultMessage:"Add an item",id:"database.calendarView.addItemButtonTooltip"},linkExistingLabel:{defaultMessage:"Link an existing item",id:"database.calendarView.linkExistingButtonTooltip"},linkExistingCompleteToast:{defaultMessage:"{pageTitle} linked and {numUpdates, plural, one {{numUpdates} property} other {{numUpdates} properties}} updated",id:"database.calendarView.linkExistingToast"}});function Ya(e){const{blockStore:t,calendarStore:r,collectionContextStore:i,columnIndex:l,startOfDay:a,canEditCalendar:c,isInHomeWidget:p,isInPeekRenderer:m,isTypedMsvCollection:g,currentlyViewedMonth:h,calendarBy:f,propertySchema:v,calendarViewRange:y,shouldShowShimmer:x}=e,C=(0,s().v3)(),b=(0,k().tz)(),w=(0,n.useContext)(Br().n),{mainEditorCurrentBlockStore:T}=(0,d().O$)(Le().default),I=(0,d().K8)((()=>i.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0})),[i]),{dayStoreMap:R,isDragging:A,hoveredDay:P}=(0,d().K8)((()=>({dayStoreMap:r.state.dayStoreMap,isDragging:r.state.isDragging,hoveredDay:r.state.isDragging?void 0:r.state.hoveredDay})),[r]),{pointer:M,userId:_,inMemoryRecordCache:V}=(0,d().K8)((()=>t),[t]),F=(0,n.useMemo)((()=>{const e=R.get(a);if(e)return e;const t=new(o(148832).B)(C,M,{userId:_,inMemoryRecordCache:V});return R.set(a,t),t}),[R,C,V,M,a,_]),O=(0,Va().vY)({firstDate:a,secondDate:h}),E=(0,Va().c_)(a),D=(0,Va().sm)(a),z="date"===v.type,K=!O&&!E&&"week"!==y,H=!A&&P===a&&(z||E)&&I&&c,G=(0,n.useMemo)((()=>1!==(0,Va().wN)(a)||E?(0,Va().wN)(a):`${new Intl.DateTimeFormat(b.locale,{month:"short",day:"numeric"}).format(new Date(a))} `),[b.locale,E,a]),W=(0,n.useCallback)((e=>{w?w(e):$n().oo({environment:C,url:e})}),[C,w]),N=(0,n.useCallback)((()=>{const{performResult:e}=B().createAndCommit({userAction:"Calendar.createBlockInDay",environment:C,canUndo:!0,perform:e=>{const t=(0,kn().Q)({environment:C,collectionContextStore:i,groupsPointer:[],insertAtIndex:0,shouldCoerce:!0,templateStore:i.defaultPageTemplateStore.state,transaction:e,from:{createBlock:"calendar"},inMemoryRecordCache:C.defaultRecordCache.inMemoryRecordCache});if(!t)return;const o=t.newStore.getAssociatedCollectionStore(),n=(null==o?void 0:o.getMappedProperty(f))??f;$a().D5({type:"timestamp",environment:C,store:t.newStore,propertyId:n,timestampMs:a,transaction:e});const r=L().wy({environment:C,store:t.newStore,mainEditorCurrentBlockStore:T,collectionContextStore:i,showMoveTo:g})??(0,Zn().Ay)({store:t.newStore,pageVisitSource:wn().y8.Create});return W(r),j().Ey({collectionContextStore:i,resultsStore:void 0}),t.newStore}});return e}),[f,i,C,g,T,W,a]),$=(0,n.useCallback)(((e,t,n)=>{const r=t.getAssociatedCollectionStore(),i=(null==r?void 0:r.getMappedProperty(f))??f;if($a().D5({type:"timestamp",environment:C,store:t,propertyId:i,timestampMs:a,transaction:e}),n){var l;const e=Object.keys(n).length+(i in n?0:1),r=(null===(l=t.getModel())||void 0===l?void 0:l.getRenderTitleWithEmojiOrPlaceholder({getRecordModel:t.getRecordModel,userTimeZone:(0,yo().P)(),intl:b}))||"",s=r.length>53?`${r.slice(0,50)}…`:r;o(436572).rL({item:{label:b.formatMessage(qa.linkExistingCompleteToast,{pageTitle:s,numUpdates:e})},undoFunc:()=>{}})}}),[f,C,a,b]),U=(0,n.useCallback)((e=>{B().createAndCommit({userAction:"Calendar.renderDay",environment:C,canUndo:!0,perform:t=>{const o=i.collectionStore();if(!o&&"collectionTypedView"!==i.contextType)return;const n=Pe().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");Pe().default.DO_NOT_USE_measureAfterNextFlushLegacy(n,{environment:C,getData:()=>fe().tv({collectionContextStore:i,is_native_drop:!1,is_empty:!1})}),$a().M9({...e,environment:C,startOfDay:a,calendarBy:f,collectionStore:o,collectionContextStore:i,transaction:t})}})}),[f,i,C,a]),q=(0,n.useCallback)((()=>{if(c&&(0,Ye().EF)(C)&&I){const e=N();Qo().v(C,{type:"page",from:"calendar_day_double_click",new_page_id:null==e?void 0:e.id,creating_block_id:null==e?void 0:e.id,...(0,fe().sl)(i)})}}),[c,C,I,N,i]),Y=(0,u().IS)((e=>{const t=(()=>{if(D)return p?(0,Na().X4)(e.tableHomeDividerColor,.05):m?e.cardSidebarBackground:e.surface.wash})(),o=K?e.lightTextColor:E?e.white:void 0;return{selectable:{position:"relative",flexGrow:1,flexShrink:0,flexBasis:0,borderRight:`1px solid ${e.tableDividerColor}`,borderBottom:`1px solid ${e.tableDividerColor}`,cursor:"default",background:t},dayNumber:{position:"absolute",fontSize:14,top:4,height:24,lineHeight:"24px",color:o,...E?{right:4,width:24,borderRadius:"100%",textAlign:"center",background:e.calendarTodayBackground}:{right:10,textAlign:"right",transition:"color 100ms ease-out"}}}}),[p,m,E,D,K]),X=(0,ue().Zp)();return(0,S.jsxs)(lt().A,{style:Y.selectable,store:F,canDropOnto:c&&z,onSelectableDrop:U,onDoubleClick:q,analyticsName:"calendar_day",shouldShowDropZone:!0,children:[H&&!(null!=X&&X.disablePageLinks)&&(0,S.jsx)(Xa,{collectionContextStore:i,createBlockFunc:N,updateBlockDayProperty:$}),(0,S.jsx)("div",{style:Y.dayNumber,className:x?`${he().yWO} notion-shimmer-text animation-delay-${l} notion-shimmer-calendar-transition`:`${he().yWO} notion-shimmer-calendar-transition`,children:G})]},a.toString())}function Xa(e){let{collectionContextStore:t,createBlockFunc:o,updateBlockDayProperty:r}=e;const i=(0,s().v3)(),l=(0,k().tz)(),a=(0,d().K8)((()=>L().fG({collectionContextStore:t,environment:i,intl:l})),[t,i,l]),c=(0,n.useCallback)((()=>{if((0,Ye().EF)(i)){const e=o();Qo().v(i,{type:"page",from:"calendar_day_add_button",new_page_id:null==e?void 0:e.id,creating_block_id:null==e?void 0:e.id,...(0,fe().sl)(t)})}else(0,Ye().QY)(i)}),[i,o,t]),p=(0,u().IS)((e=>({iconToolbar:{position:"absolute",display:"flex",top:6,left:6,padding:2,borderRadius:8,background:e.popoverBackground,boxShadow:e.shadowMD},iconButton:{width:20,height:20}})),[]),m=(0,n.useCallback)(((e,t)=>(0,S.jsx)(jt().A,{ariaLabel:l.formatMessage(qa.addItemLabel),icon:uo().W,style:p.iconButton,onClick:c,...(0,Ci().A)(e,{onMouseDown:Ce().tr})})),[c,l,p.iconButton]);return(0,S.jsxs)("div",{style:p.iconToolbar,children:[(0,S.jsx)(At().A,{renderTooltip:()=>l.formatMessage(qa.addItemLabel),render:m}),a?(0,S.jsx)(At().A,{renderTooltip:()=>l.formatMessage(qa.linkExistingLabel),render:e=>(0,S.jsx)(Kn().O,{collectionContextStore:t,renderLinkButton:t=>(0,S.jsx)(jt().A,{ariaLabel:l.formatMessage(qa.linkExistingLabel),icon:zn().H,style:p.iconButton,...t,...(0,Ci().A)(e,{onMouseDown:Ce().tr})}),onAddOrLink:r})}):null]})}const Qa=(0,n.memo)(Ya);var Za=()=>o(869190),Ja=()=>o(425497),ec=()=>o(603820),tc=()=>o(16006),oc=()=>o(338931),nc=()=>o(771989);const rc=2,ic=3;function lc(e,t){const{store:o,collectionContextStore:r,handleOpenPeekPage:i}=e,l=(0,s().v3)(),a=(0,n.useRef)(null),c=(0,n.useCallback)((()=>{const e=function(e){const{environment:t,store:o,collectionContextStore:n}=e,{mainEditorCurrentBlockStore:r}=Le().default.state;return L().wy({environment:t,store:o,mainEditorCurrentBlockStore:r,collectionContextStore:n,fullyQualified:!1})}({environment:l,store:o,collectionContextStore:r});e&&(i(),$n().oo({environment:l,url:e}))}),[r,l,i,o]),u=(0,n.useMemo)((()=>({store:o,renderedType:"page",getNode:()=>a.current,getBlockStore:()=>o,activate:c})),[c,o]);(0,d().K8)((()=>{r.onItemMount(o)}),[r,o]);const p=(0,S.jsx)("div",{ref:a,children:(0,S.jsx)(ac,{...e})});return(0,je().NW)(o,t,u,p)}const sc=n.forwardRef(lc);function ac(e){const{store:t,row:o,schema:n,format:r,disabled:i,calendarBy:l,showWeekends:a,collectionContextStore:c,includeTime:u,handleOpenPeekPage:p,blockPropertyValueOverlayStore:m,calendarStore:g}=e,h=(0,s().v3)(),{value:f}=(0,ne().fJ)(me().T.formulas),v=n[l],y=(0,d().K8)((()=>!i&&"date"===(null==v?void 0:v.type)&&!c.permissionScopesStore.state.isSyncedCollection),[c.permissionScopesStore,i,null==v?void 0:v.type]),{start:x,end:b,startOfWeek:w,endOfWeek:k,startColumn:T,columnCount:I}=(0,oc().Gj)({startUnixTimestampMS:e.start,endUnixTimestampMS:e.end,startOfWeekUnixTimestampMS:e.startOfWeek,endOfWeekUnixTimestampMS:e.endOfWeek}),R=(0,d().K8)((()=>{const e=r.calendar_properties?r.calendar_properties.filter((e=>e.visible&&"title"!==e.property)).map((e=>e.property)):[],o=e.filter((e=>(0,_n().T)({block:t.getModel(),property:e,schema:n,getRecordModel:t.getRecordModel,userId:h.currentUser.id,userTimeZone:(0,yo().P)(),intl:yt().A.getIntl(),experimentService:Io().default,collectionFeatureGates:(0,wo().i)(),formulasModule:f})));return o.concat(C().R9(e,o))}),[h.currentUser.id,r.calendar_properties,n,t,f]),j=(0,d().K8)((()=>(0,te().jz)({collectionContextStore:c})),[c]);if(!v||!co().$L(v))return null;const A=R.length+(j?1:0),P=x<w,M=void 0!==b&&b>k;return(0,S.jsxs)(cc,{store:t,row:o,numRows:A,columnCount:I,startIsBeforeStartOfWeek:P,endIsAfterEndOfWeek:M,startColumn:T,disabled:i,isEditableDate:y,calendarBy:l,showWeekends:a,handleOpenPeekPage:p,children:[j&&(0,S.jsx)("span",{style:{paddingRight:4,paddingLeft:8,maxWidth:"100%",overflowX:"hidden",textOverflow:"ellipsis"},children:(0,S.jsx)(Yn().n,{blockStore:t,collectionContextStore:c})}),(0,S.jsx)(mc,{store:t,collectionContextStore:c,disabled:i,start:x,startOfWeek:w,end:b,endOfWeek:k,includeTime:u,propertySchema:v}),(0,S.jsx)(Sc,{store:t,sortedProperties:R,startIsBeforeStartOfWeek:P,disabled:i,blockPropertyValueOverlayStore:m}),y&&(0,S.jsx)(hc,{store:t,start:x,startOfWeek:w,end:b,endOfWeek:k,calendarBy:l,calendarStore:g})]})}function cc(e){const{store:t,children:o,columnCount:r,row:i,numRows:l,startColumn:a,disabled:c,isEditableDate:p,calendarBy:m,showWeekends:g,handleOpenPeekPage:h,startIsBeforeStartOfWeek:f,endIsAfterEndOfWeek:v}=e,y=(0,s().v3)(),x=(0,Z().ET)(),C=(0,ue().Zp)(),b=(0,d().K8)((()=>L().NM(t)),[t]),w=(0,d().K8)((()=>(0,Yo().W)(y,t.id)),[y,t.id]),k=pc(l,(0,d().K8)((()=>{var e;return null===(e=x.collectionViewStore())||void 0===e?void 0:e.getFormat()}),[x])),T=Ua+k*i,I=(0,d().uB)(void 0,nc().A),R=(0,d().K8)((()=>Ke().A.state?!0===I.state.dragging:Xo().A.state.hoveredStore===t),[t,I]),j=g?7:5,A=(0,u().IS)((e=>({selectable:{position:"absolute",paddingTop:3,paddingBottom:3,paddingLeft:f?0:6,paddingRight:v?0:6,width:v?`calc(100% / ${j} * ${r} - 1px)`:`calc(100% / ${j} * ${r})`,left:`calc(100% / ${j} * ${a})`,height:k,top:T},haloStyle:{...L().wh(e,b),borderRadius:6,marginTop:2,marginBottom:2,marginLeft:f?0:5,marginRight:v?0:5},linkBoxStyle:{height:"100%",background:e.calendarItemBackground,borderTopLeftRadius:6,borderTopRightRadius:6,borderBottomLeftRadius:6,borderBottomRightRadius:6,boxShadow:e.shadowSM,...v&&{borderTopRightRadius:0,borderBottomRightRadius:0},...f&&{borderTopLeftRadius:0,borderBottomLeftRadius:0},...w&&{opacity:.5}},linkBoxHoveredStyle:{opacity:w?.5:1,background:e.calendarItemHoveredBackground},linkBoxInnerStyle:{display:"flex",position:"relative",paddingTop:2,paddingBottom:2,height:"100%",alignItems:"flex-start",flexDirection:"column"}})),[r,v,k,j,b,a,f,T,w]),P=(0,n.useCallback)((e=>{const o=t.getAssociatedCollectionStore();return o?$a().jo({environment:y,collectionStore:o,collectionContextStore:x,store:t,insertStores:e.insertStores,calendarBy:m,transaction:e.transaction}):[]}),[m,x,y,t]),M=(0,n.useCallback)((e=>{const{transaction:o}=e;t.getAssociatedCollectionStore()&&gt().by({childStore:t,transaction:o})}),[t]),[B,_]=(0,d().K8)((()=>{const{mainEditorCurrentBlockStore:e}=Le().default.state,o=L().wy({environment:y,store:t,mainEditorCurrentBlockStore:e,collectionContextStore:x,fullyQualified:!1});return[(0,Zn().Ay)({store:t,fullyQualified:!1,pageVisitSource:wn().y8.LinkInPage}),o]}),[y,x,t]),V=(0,d().O$)(x.isInHomeWidgetStore);return(0,S.jsx)(lt().A,{store:t,style:A.selectable,canSelect:!c,shouldShowHalo:!(V||null!=C&&C.isPreviewing),shouldForceRenderSelectionHalo:b,haloStyle:A.haloStyle,canTriggerContextMenu:!c,showBlockMenuInput:!0,canDrag:p,onInsertAbove:P,onInsertBelow:P,onRemove:M,canInsertAbove:p,canInsertBelow:p,analyticsName:"calendar",shouldShowDropZone:!0,className:he().E4t,draggableStore:I,children:(0,S.jsx)(Qn().A,{style:A.linkBoxStyle,hoveredStyle:A.linkBoxHoveredStyle,pressedStyle:A.linkBoxHoveredStyle,innerStyle:A.linkBoxInnerStyle,onClick:h,href:B,metaHref:_,hovered:R,children:o})},t.id)}const dc=24,uc=36;function pc(e,t){var o;return((null==t?void 0:t.table_wrap)||!0===(null==t||null===(o=t.calendar_properties)||void 0===o||null===(o=o.find((e=>"title"===e.property)))||void 0===o?void 0:o.wrap)?uc:dc)+e*Ja().CL+2*rc+2*ic}function mc(e){const{store:t,collectionContextStore:o,disabled:i,start:l,startOfWeek:a,end:c,endOfWeek:p,includeTime:m,propertySchema:g}=e,h=(0,s().v3)(),f=l<a,v=c&&c>p,y=(0,d().K8)((()=>(0,te().Kk)({collectionContextStore:o,blockStore:t})),[o,t]),x="time_format"in g?g.time_format:za().CE,[C,b,k]=(0,d().K8)((()=>[t.getIcon(),t.isEmptyPage(),t.hasError()]),[t]),T=(0,n.useCallback)((e=>{const o=t.getIconStore();o&&B().createAndCommit({userAction:"CalendarItem.handleRecordIconChange",environment:h,canUndo:!0,perform:t=>{Ko().KY({store:o,value:e,transaction:t})}})}),[h,t]),I=(0,d().K8)((()=>{var e,t,n;const r=null===(e=o.collectionViewStore())||void 0===e?void 0:e.getFormat().calendar_properties;return(null===(t=o.collectionViewStore())||void 0===t?void 0:t.getFormat().table_wrap)||!0===(null==r||null===(n=r.find((e=>"title"===e.property)))||void 0===n?void 0:n.wrap)}),[o]),R=(0,u().IS)((e=>({titleContainer:{paddingLeft:6,paddingRight:6,overflow:"hidden",...f&&{paddingLeft:12},...v&&{paddingRight:11},width:"100%",...I?{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:"17px",height:uc,paddingTop:2}:{height:dc,whiteSpace:"nowrap"},overflowWrap:"break-word",textOverflow:"ellipsis",fontSize:14,fontWeight:w().Wy.semibold},recordIconStyle:{display:"inline",float:"left",marginRight:3,paddingTop:I?2:4},iconWarningStyle:{display:"inline",float:"left",marginLeft:1,marginRight:5,width:10,height:16,paddingTop:I?2:4,fill:e.accentColors.orange[500]},subitemCountIndicatorContainer:{display:"flex",alignItems:"center",float:"right",paddingTop:I?2:4},timeStyle:{color:e.mediumTextColor,float:"right",fontSize:10,marginLeft:4,height:14,paddingTop:I?2:4},subitemsWrapperStyle:{paddingRight:0,paddingLeft:4}})),[v,f,I]),j=m&&c&&r().IX.fromDateTimes(a,p).contains(c)&&l.day!==c.day,A=(0,d().K8)((()=>o.shouldShowPageIcon()&&(void 0!==C||!b)&&!k),[o,C,b,k]);return(0,S.jsxs)("div",{style:R.titleContainer,children:[A&&(i?(0,S.jsx)(xr().A,{disabled:!0,icon:C,isEmptyPage:b,size:14,style:R.recordIconStyle}):(0,S.jsx)(xr().A,{disabled:!1,store:t,bucket:"secure",icon:C,isEmptyPage:b,size:14,style:R.recordIconStyle,onChange:T})),k&&(0,yr().Q)(R.iconWarningStyle),(0,S.jsx)(gc,{store:t,titlePropertyIsWrapped:I}),y&&(0,S.jsx)("div",{style:R.subitemCountIndicatorContainer,children:(0,S.jsx)(Xn().W,{blockStore:t,collectionContextStore:o,wrapperStyle:R.subitemsWrapperStyle})}),m&&r().IX.fromDateTimes(a,p).contains(l)&&(0,S.jsxs)("div",{style:R.timeStyle,children:[(0,Za().PS)({dateTime:l,humanReadable:!1,timeFormat:x}),j&&(0,S.jsxs)("span",{children:[" → ",(0,Za().PS)({dateTime:c,humanReadable:!1,timeFormat:x})]})]}),(0,S.jsx)(tc().A,{store:t,shouldWrap:I})]})}function gc(e){const{store:t,titlePropertyIsWrapped:o}=e,n=(0,u().IS)((e=>({discussionIndicatorStyle:{display:"flex",alignItems:"center",color:e.lightTextColor,fontSize:12,flexShrink:0},discussionIndicatorContainerStyle:{float:"right",marginLeft:4,marginTop:o?-2:1}})),[o]);return(0,S.jsx)(Un().g,{store:t,iconStyle:n.discussionIndicatorStyle,buttonStyle:n.discussionIndicatorContainerStyle,size:12})}function Sc(e){const{store:t,sortedProperties:o,startIsBeforeStartOfWeek:n,disabled:r,blockPropertyValueOverlayStore:i}=e,l=(0,Z().ET)(),s=(0,d().K8)((()=>l.permissionScopesStore.state.isLocked||!l.permissionScopesStore.state.canEditContent),[l.permissionScopesStore]),[a,c]=(0,d().K8)((()=>[L().Dj({store:t,collectionContextStore:l}),l.collectionViewStore()]),[t,l]);return a?(0,S.jsx)("div",{style:{paddingLeft:6,paddingRight:6,overflow:"hidden",width:"100%",...n&&{paddingLeft:12}},children:o.map((e=>(0,S.jsx)(hr().m,{store:t,property:e,disabled:r,locked:s,format:Tt().j.Calendar,tableWrap:!1,blockPropertyValueOverlayStore:i,collectionStore:a,collectionViewStore:c},e)))}):null}function hc(e){const{store:t,calendarStore:o,start:r,startOfWeek:i,end:l,endOfWeek:a,calendarBy:c}=e,d=(0,s().v3)(),p=(0,u().IS)((()=>({leftDragHandle:{position:"absolute",top:0,left:-4,height:"100%",width:12,cursor:"col-resize"},rightDragHandle:{position:"absolute",top:0,right:-4,height:"100%",width:12,cursor:"col-resize"}})),[]),m=(0,n.useCallback)((e=>{$a().GB({calendarStore:o,x:e.currentX,y:e.currentY,calendarBy:c})}),[o,c]),g=(0,n.useCallback)((()=>{B().createAndCommit({userAction:"CalendarItem.handleDraggableDragEnd",environment:d,canUndo:!0,perform:e=>{$a().eW({environment:d,transaction:e,calendarStore:o,calendarBy:c})}})}),[c,o,d]),h=(0,n.useCallback)((()=>{$a().Pt({calendarStore:o})}),[o]),f=r>=i&&(0,S.jsx)(ec().A,{render:e=>(0,S.jsx)("div",{style:p.leftDragHandle,...e}),onDraggableDragStart:()=>{$a().v7({calendarStore:o,targetStore:t,direction:Da().Q.Left})},onDraggableDragMove:m,onDraggableDragEnd:g,onDraggableDragCancel:h}),v=(!l||l&&l<a)&&(0,S.jsx)(ec().A,{render:e=>(0,S.jsx)("div",{style:p.rightDragHandle,...e}),onDraggableDragStart:e=>{$a().v7({calendarStore:o,targetStore:t,direction:Da().Q.Right})},onDraggableDragMove:m,onDraggableDragEnd:g,onDraggableDragCancel:h});return(0,S.jsxs)(S.Fragment,{children:[f,v]})}function fc(e){const{blockPropertyValueOverlayStore:t,blockStore:o,calendarBy:r,calendarStore:i,calendarViewRange:l,canEditCalendar:a,collectionContextStore:c,collectionViewStore:p,currentlyViewedMonth:m,endOfWeek:g,format:h,isInHomeWidget:f,isInPeekRenderer:v,isTypedMsvCollection:y,items:x,propertySchema:C,schema:b,shouldShowShimmer:w,showWeekends:k,sortedResultsStore:T,startOfWeek:I}=e,R=(0,s().v3)(),{isDragging:A,targetStore:P,temporaryValue:M}=(0,d().K8)((()=>{const{isDragging:e}=i.state;return{isDragging:e,targetStore:e?i.state.targetStore:void 0,temporaryValue:e?i.state.temporaryValue:void 0}}),[i]),{targetStoreCollectionStoreSchema:B,targetStoreCollectionStoreCalendarBy:_}=(0,d().K8)((()=>{const e=null==P?void 0:P.getAssociatedCollectionStore();return{targetStoreCollectionStoreSchema:null==e?void 0:e.getSchema(),targetStoreCollectionStoreCalendarBy:null==e?void 0:e.getMappedProperty(r)}}),[P,r]),V=(0,n.useCallback)((()=>{Pe().default.DO_NOT_USE_markLegacy("collections.open_item_page_lag"),j().Ey({collectionContextStore:c,resultsStore:T});const e=c.normalizedFormatStore.state.collection_peek_mode,t=e||on().C9.calendar;Zo().bn(R,{is_peek:!0,from:"calendar",peek_mode:t})}),[c,R,T]),F=k?7:5,L=(0,n.useMemo)((()=>{const e=[];x.forEach((o=>{const n=re().Bv.createChildStore(p,{table:E().ev,id:o.id});A&&P===n&&M||e.push((0,S.jsx)(vc,{blockPropertyValueOverlayStore:t,calendarBy:r,calendarStore:i,collectionContextStore:c,endOfWeek:g,format:h,handleOpenPeekPage:V,item:o,schema:b,showWeekends:k,startOfWeek:I,store:n},o.id))}));const o=A&&M&&(0,Va().uo)(M,(0,yo().P)());if(A&&M&&o&&(0,za().m6)(I,g,o.start,o.end)&&P&&null!=P&&P.id){const n=x.find((e=>e.id===P.id));e.push((0,S.jsx)(vc,{blockPropertyValueOverlayStore:t,calendarBy:_??r,calendarStore:i,collectionContextStore:c,endOfWeek:g,format:h,handleOpenPeekPage:V,schema:B??b,showWeekends:k,startOfWeek:I,store:P,item:{id:P.id,start:o.start,end:o.end,row:n?n.row:0,includeTime:"datetime"===M.type||"datetimerange"===M.type}},P.id))}return e}),[t,r,i,c,p,g,h,V,A,x,b,k,I,P,_,B,M]),O=(0,n.useMemo)((()=>Math.max(0,...x.map((e=>e.row)))),[x]),D=(0,d().K8)((()=>(0,te().jz)({collectionContextStore:c})),[c]),z=(0,u().IS)((()=>{const e=(h.calendar_properties?h.calendar_properties.filter((e=>e.visible&&"title"!==e.property)).map((e=>e.property)):[]).length+(D?1:0),t="week"===l?372:124,o=pc(e,h);return{container:{position:"relative",display:"flex",height:Math.max((O+1)*o+Ua+4,t)}}}),[l,h,O,D]);return(0,S.jsxs)("div",{style:z.container,children:[[...Array(F).keys()].map((e=>{const t=(0,Va().K1)({date:I,daysToAdd:e});return(0,S.jsx)(Qa,{blockStore:o,calendarStore:i,collectionContextStore:c,columnIndex:e,startOfDay:t,calendarBy:r,currentlyViewedMonth:m,canEditCalendar:a,isInHomeWidget:f,isInPeekRenderer:v,isTypedMsvCollection:y,propertySchema:C,calendarViewRange:l,shouldShowShimmer:w},e)})),L]},I.toString())}function vc(e){const{blockPropertyValueOverlayStore:t,calendarBy:o,calendarStore:n,collectionContextStore:r,endOfWeek:i,format:l,handleOpenPeekPage:s,item:a,schema:c,showWeekends:u,startOfWeek:p,store:m}=e,{canEdit:g,collectionStore:h}=(0,d().K8)((()=>({canEdit:m.canEdit(),collectionStore:m.getAssociatedCollectionStore()})),[m]),{collectionStoreSchema:f,collectionStoreCalendarBy:v}=(0,d().K8)((()=>({collectionStoreSchema:null==h?void 0:h.getSchema(),collectionStoreCalendarBy:null==h?void 0:h.getMappedProperty(o)})),[h,o]);return h?(0,S.jsx)(sc,{collectionContextStore:r,store:m,startOfWeek:p,endOfWeek:i,showWeekends:u,start:a.start,end:a.end,row:a.row,includeTime:a.includeTime,format:l,schema:f??c,calendarBy:v??o,disabled:!g,calendarStore:n,blockPropertyValueOverlayStore:t,handleOpenPeekPage:s},m.id):null}const yc=(0,n.memo)(fc);function xc(e){const{blockPropertyValueOverlayStore:t,blockStore:o,calendarStore:n,canEditCalendar:r,collectionContextStore:i,currentlyViewedMonth:l,format:a,isInHomeWidget:c,isInPeekRenderer:p,isTypedMsvCollection:m,query:g,resultStore:h,schema:f,sortedResultsStore:v,weeks:y}=e,{isPhone:x}=(0,s().Y0)(),C=(0,d().K8)((()=>{var e,t;return(void 0===(null===(e=h.getState())||void 0===e?void 0:e.blockIds)||0===(null===(t=h.getState())||void 0===t?void 0:t.blockIds.length))&&(0,bn().iv)({collectionContextStore:i,groupsPointer:[],hasPartialResults:!1})}),[i,h]),{collectionViewStore:b,calendarViewRange:w,showWeekends:k}=(0,d().K8)((()=>{const e=i.collectionViewStore(),t=null==e?void 0:e.getFormatStore();return{collectionViewStore:e,calendarViewRange:(null==t?void 0:t.getKeyStore("calendar_view_range").getValue())??"month",showWeekends:(null==t?void 0:t.getKeyStore("calendar_show_weekends").getValue())??!0}}),[i]);var T;y&&y.length>0&&(null===(T=i.databaseItemsVisibleTracker)||void 0===T||T.handleItemsRenderStart());const I=(0,u().IS)((e=>({container:x?{}:{boxShadow:`-1px 0 0 ${e.tableDividerColor}`,marginTop:1,overflow:"hidden"}})),[x]),{calendar_by:R}=g;if(!R)return null;const j=f[R];return j&&b?(0,S.jsx)("div",{style:I.container,children:y&&y.map((e=>x?(0,S.jsx)(Wa,{blockPropertyValueOverlayStore:t,calendarBy:R,calendarViewRange:w,canEditCalendar:r,collectionContextStore:i,currentlyViewedMonth:l,format:a,items:e.items,query:g,schema:f,shouldShowShimmer:C,showWeekends:k,sortedResultsStore:v,startOfWeek:e.start},e.start):(0,S.jsx)(yc,{blockPropertyValueOverlayStore:t,blockStore:o,calendarBy:R,calendarStore:n,calendarViewRange:w,canEditCalendar:r,collectionContextStore:i,collectionViewStore:b,currentlyViewedMonth:l,endOfWeek:e.end,format:a,isInHomeWidget:c,isInPeekRenderer:p,isTypedMsvCollection:m,items:e.items,propertySchema:j,schema:f,shouldShowShimmer:C,showWeekends:k,sortedResultsStore:v,startOfWeek:e.start},e.start)))}):null}const Cc=(0,n.memo)(xc);var bc=()=>o(662303),wc=()=>o(380048),kc=()=>o(742117),Tc=()=>o(583238),Ic=()=>o(543906),Rc=()=>o(40970),jc=()=>o(465425),Ac=()=>o(131448),Pc=()=>o(53137),Mc=()=>o(404141),Bc=()=>o(645200),_c=()=>o(320260),Vc=()=>o(953006);const Fc=(0,k().YK)({defaultTitle:{id:"openInNotionCalendarOnboardingTooltip.header",defaultMessage:"Get Notion Calendar"},defaultContent:{id:"openInNotionCalendarOnboardingTooltip.content",defaultMessage:"View any Notion database with calendar and timeline views with your Google Calendar events"},connectCalendarTitle:{id:"openInNotionCalendarOnboardingTooltip.connectCalendarTitle",defaultMessage:"Connect Calendar"},successTitle:{id:"openInNotionCalendarOnboardingTooltip.success.header",defaultMessage:"Successfully connected"},successContent:{id:"openInNotionCalendarOnboardingTooltip.success.content",defaultMessage:"You can now view any database with calendar and timeline views in Notion Calendar"}});function Lc(e){let{variant:t,origin:o,onCloseClick:n,onConnectCalendarClick:r}=e;const i=(0,u().IS)((e=>({tooltip:{width:233},content:{opacity:1},contentInner:{display:"flex",flexDirection:"column",gap:14},contentMessage:{opacity:.8,color:e.text.contrastPrimary},footer:{display:"flex",alignItems:"center",gap:12},primaryButton:{display:"flex",alignItems:"center",height:24,padding:"0 12px",marginLeft:"auto",borderRadius:4,background:"#FFF",color:"#1D1B16",fontSize:12,fontWeight:500,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},primaryButtonHover:{background:"rgba(255,255,255,0.9)"},primaryButtonPressed:{background:"rgba(255,255,255,0.8)"}})),[]);return(0,S.jsx)(Vc().k,{origin:o,placementToOrigin:"bottom",header:(0,S.jsx)(k().sA,{..."success"===t?Fc.successTitle:Fc.defaultTitle}),content:(0,S.jsxs)("div",{style:i.contentInner,children:[(0,S.jsx)("div",{style:i.contentMessage,children:(0,S.jsx)(k().sA,{..."success"===t?Fc.successContent:Fc.defaultContent})}),"default"===t&&(0,S.jsx)("div",{style:i.footer,children:(0,S.jsx)(Rt().A,{style:i.primaryButton,hoveredStyle:i.primaryButtonHover,pressedStyle:i.primaryButtonPressed,onClick:r,children:(0,S.jsx)(k().sA,{...Fc.connectCalendarTitle})})})]}),contentStyle:i.content,onCloseClick:n,shouldDismissUponOutsideClick:!1,enableMouseCapture:!1,pointerPosition:"33%",style:{...i.tooltip}})}function Oc(e){let{collectionContextStore:t}=e;const o=(0,n.useRef)(null),[r,i]=(0,n.useState)(!1),l=(0,s().v3)(),a=(0,d().K8)((()=>Le().default.state.currentSpaceStore),[]),c=(0,d().K8)((()=>(0,Tc().mX)()),[]),p=(0,d().K8)((()=>Ac().default.isVisible("open_in_calendar_tooltip")),[]),m=(0,d().K8)((()=>{const e=Mc().A.state.open||t.settingsStore.state.open,o=t.isFullScreenStore.state,n=Ue().default.state.open;return o&&!e&&!n&&Pc().A.state.loaded}),[t]);(0,Ic().A)((()=>{jc().HH(l,"open_in_calendar_tooltip")}),m);const g=(0,n.useCallback)((()=>{const e=t.collectionViewStore(),o=t.collectionStore(),n=null==o?void 0:o.getParentBlockStore();e&&o&&n&&a&&(Rc().tC(l,{is_calendar_connected:c,collection_id:o.id,collection_view_id:e.id,collection_view_block_id:n.id}),Bc().Op({environment:l,collectionViewStore:e,spaceStore:a,from:"openInCalendarButton"}))}),[l,t,a,c]),h=(0,n.useCallback)((()=>{jc().a(l,"open_in_calendar_tooltip")}),[l]),f=(0,n.useCallback)((()=>{i(!0),g()}),[g]),v=(0,u().IS)((e=>({button:{marginRight:8,paddingRight:12,fontSize:14,fontWeight:500,height:26},calendarIcon:{marginLeft:4},calendarIconSvg:{fill:e.timelineRed}})),[]);return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(Ls().A,{size:"lg",ref:o,style:v.button,iconStyle:v.calendarIconSvg,icon:e=>(0,S.jsx)(_c().y,{style:{...e,...v.calendarIcon}}),onClick:g,children:(0,S.jsx)(k().sA,{id:"openInNotionCalendarButton.label",defaultMessage:"Open in Calendar"})}),p&&(0,S.jsx)(Lc,{variant:r||c?"success":"default",origin:o,onCloseClick:h,onConnectCalendarClick:f})]})}function Ec(e){const t=(0,s().v3)(),o=(0,ue().Zp)();return!(0,d().K8)((()=>(0,Tc().JF)({environment:t,collectionContextType:e.collectionContextStore.contextType,spaceStore:Le().default.state.currentSpaceStore})),[t,e.collectionContextStore])||null!=o&&o.disablePageLinks?null:(0,S.jsx)(Oc,{...e})}const Dc=(0,k().YK)({previousMonthButtonAriaLabel:{id:"database.calendarViewHeader.previousMonthButton.ariaLabel",defaultMessage:"Previous Month"},nextMonthButtonAriaLabel:{id:"database.calendarViewHeader.nextMonthButton.ariaLabel",defaultMessage:"Next Month"},todayButtonLabel:{id:"database.calendarViewHeader.todayButton.label",defaultMessage:"Today"}});function zc(e){const{currentlyViewedMonth:t,calendarViewRange:o,setNewCalendarStart:r,isInHomeWidget:i,dateRangeStart:l,isInPeekRenderer:a,stickyStyle:c,collectionContextStore:p,weeks:m,startOfWeek:g}=e,h=(0,k().tz)(),{isPhone:f,isMobile:v}=(0,s().Y0)(),y=(0,n.useRef)(null),x=(0,L().Oz)(p),C=(0,d().K8)((()=>{const e=p.collectionViewStore(),t=null==e?void 0:e.getFormatStore();return(null==t?void 0:t.getKeyStore("calendar_show_weekends").getValue())??!0}),[p]),b=(0,n.useMemo)((()=>{const e=(0,Za().W_)(t,"month_year_long",bc().locale);if("month"===o)return e;if(!m||void 0===m[0])return"";const n=m[0];if((0,Va().vY)({firstDate:n.start,secondDate:n.end}))return e;return`${(0,Za().W_)(n.start,(0,Va().St)({firstDate:n.start,secondDate:n.end})?"month_short":"month_year_short",bc().locale)} - ${(0,Za().W_)(n.end,"month_year_short",bc().locale)}`}),[t,o,m]),T=(0,n.useCallback)((()=>{const e="month"===o?(0,Va().mK)((0,Va().Mw)(Date.now()),g):(0,Va().mK)(Date.now(),g);r(e,o)}),[o,r,g]),I=(0,n.useCallback)((e=>{const t=(0,Va().to)(l,g);if("month"===o){const n="left"===e?-1:1,i=(0,Va().mK)((0,Va().Mw)((0,Va().AQ)({date:t,monthsToAdd:n})),g);r(i,o)}else{const t="left"===e?-7:7,n=(0,Va().mK)((0,Va().K1)({date:l,daysToAdd:t}),g);r(n,o)}}),[l,g,o,r]),R=(0,u().IS)((e=>{const t=f?e.contentBackground:(null==x?void 0:x.background)||(a?e.cardContentBackground:e.contentBackground);return{container:i?{}:{position:"absolute",left:0,right:0,zIndex:85,background:t},monthSwitcher:{display:"flex",height:42,alignItems:"center",marginBottom:2},monthHeader:{fontWeight:w().Wy.semibold,marginLeft:8,marginRight:8,lineHeight:1,fontSize:f?16:14},spacer:{flexGrow:1},weekdayNamesContainer:{display:"flex",marginTop:f?8:0,boxShadow:`0 1px 0 ${e.tableDividerColor}`},weekdayName:{flexGrow:1,flexBasis:0,textAlign:"center",fontSize:12,color:e.lightTextColor,height:24}}}),[x,i,a,f]),j=C?(0,Za().zI)(g,bc().locale):(0,Za().rj)(bc().locale);return(0,S.jsx)(Ki().g,{stickyAttachPoint:i?"no-stick":"ceiling",nodeRef:y,stickyStyle:c,transitionStickyStyle:c,absoluteHeight:98,children:(0,S.jsxs)("div",{style:R.container,ref:y,children:[(0,S.jsxs)("div",{style:R.monthSwitcher,children:[(0,S.jsx)("div",{style:R.monthHeader,children:b}),(0,S.jsx)("div",{style:R.spacer}),(0,S.jsx)(Ec,{collectionContextStore:p}),(0,S.jsx)(jt().A,{ariaLabel:h.formatMessage(Dc.previousMonthButtonAriaLabel),mobileFeedback:v,icon:wc().I,onClick:()=>I("left")}),(0,S.jsx)(rt().p,{size:"sm",onClick:T,children:(0,S.jsx)(k().sA,{...Dc.todayButtonLabel})}),(0,S.jsx)(jt().A,{ariaLabel:h.formatMessage(Dc.nextMonthButtonAriaLabel),mobileFeedback:v,icon:kc().V,onClick:()=>I("right")})]}),(0,S.jsx)("div",{style:R.weekdayNamesContainer,className:he().VO,children:j.map((e=>{let[t,o]=e;return(0,S.jsx)("div",{style:R.weekdayName,children:o},t)}))})]})})}const Kc=(0,n.memo)(zc),Hc=n.memo((function(e){const{blockPropertyValueOverlayStore:t,collectionContextStore:r,store:i,format:l,query:m,schema:g,isFullScreen:h,isInPeekRenderer:f,isPreviewing:v,maxHeight:y,minWidth:x,paddingBottom:b,paddingLeft:w,paddingRight:T}=e,I=(0,k().tz)(),R=(0,s().v3)(),{isPhone:j,isMobile:M}=(0,s().Y0)(),_=R.currentUser.id,{value:V}=(0,ne().fJ)(me().T.formulas),F=(0,n.useRef)(null),O=(0,n.useRef)(null),D=(0,o(93583).A)(O,F),z=(0,d().uB)(void 0,Da().a),K=(0,d().uB)(void 0,p().default),H=(0,je().bx)(i,!1),G=(0,d().K8)((()=>Ke().A.state),[]),W=(0,d().K8)((()=>Se().XX.state),[]),N=(0,d().K8)((()=>r.collectionViewStore()),[r]),$=(0,d().K8)((()=>r.collectionStore()),[r]),U=null==N?void 0:N.id,q=(0,d().O$)(r.isLoadingStore),Y=(0,d().K8)((()=>"collectionTypedView"===r.contextType),[r]),X=(0,d().O$)(r.isInHomeWidgetStore),Q=(0,d().K8)((()=>!!r.viewsModuleContextStore.getViewModuleType()),[r]),Z=(0,d().O$)(r.dateRangeStartStore),J=(0,d().O$)(r.dateRangeEndStore),ee=(0,d().O$)(r.permissionScopesStore),{calendarStoreState:te,dayStoreMap:oe,startingMonth:ie,hoveredDay:le}=(0,d().K8)((()=>({calendarStoreState:z.state,dayStoreMap:z.state.dayStoreMap,startingMonth:z.state.startingMonth,hoveredDay:z.state.isDragging?void 0:z.state.hoveredDay})),[z]),se=(0,d().K8)((()=>H&&(ee.canEditContent||Y)),[H,ee.canEditContent,Y]),ae=(0,d().K8)((()=>{var e;return(null==N||null===(e=N.getFormatStore())||void 0===e?void 0:e.getKeyStore("calendar_view_range").getValue())??"month"}),[N]),ce=(0,d().K8)((()=>h&&!M&&"month"===ae),[h,M,ae]),de=(0,d().K8)((()=>ce||!Z?ie:(0,Va().Mw)((0,Va().to)(Z,W))),[ce,Z,ie,W]),pe=(0,d().K8)((()=>(0,Oa().j2)({collectionContextStore:r})),[r],{useDeepEqual:!0}),ge=(0,d().K8)((()=>{if(!N)return[];const e=K.state;if(!e||!e.blockIds)return[];const t=e.blockIds.map((e=>re().Bv.createChildStore(N,{id:e,table:E().ev})))||[];return(0,Oa().oq)({collectionContextStore:r,results:t,getRecordValue:i.getRecordValue,intl:I,formulasModule:V})}),[N,K,r,i.getRecordValue,I,V],{useDeepEqual:!0}),fe=(0,d().r6)((()=>N&&ge&&(null==ge?void 0:ge.flatMap((e=>e.items.map((e=>re().Bv.createChildStore(N,{table:E().ev,id:e.id}))))))||[]),[N,ge],{useDeepEqual:!0,debugName:"sortedResultsStore"});(0,d().O$)(fe);const[ve,ye]=(0,n.useState)();(0,n.useEffect)((()=>{var e;null!==(e=F.current)&&void 0!==e&&e.parentElement&&ye((0,Re().NM)(F.current.parentElement))}),[]);const be=(0,n.useCallback)(((e,t)=>{const o=(0,Va().to)(e,W);let n;"month"===t?(n=ce?(0,Va().to)((0,Va().AQ)({date:o,monthsToAdd:1}),W):(0,Va().to)((0,Va().Xf)(o),W),ve&&ce&&(ve.scrollTop=0)):n=o,(0,Fa().r)({dateRangeStart:e,dateRangeEnd:n,collectionContextStore:r}),z.update((t=>({...t,startingMonth:(0,Va().Mw)((0,Va().to)(e,W))}))),N&&(0,Ea().LQ)({newCalendarStart:e,newCalendarEnd:n,collectionViewId:N.id,currentUserId:_})}),[W,r,z,N,ce,ve,_]),we=(0,n.useCallback)((()=>{$&&$.isDefined()&&N&&ee.canConfigureBlock&&B().createAndCommit({userAction:"Calendar.updateOrCreateCalendarProperty",environment:R,canUndo:!0,perform:e=>{let t,o=L().zv(g);if(!o&&ee.canConfigureCollection){o=(0,qs().Ay)();t={[o]:{name:I.formatMessage({id:"database.calendarView.dateProperty.defaultName",defaultMessage:"Date"}),type:"date"}}}o&&((0,ii().f)({collectionViewStore:N,update:{calendar_by:o},transaction:e}),Ko().zv({store:N,data:{type:"calendar"},transaction:e}),t&&(0,Ys().F)({environment:R,collectionStore:$,update:t,transaction:e}))}})}),[$,N,R,I,ee.canConfigureBlock,ee.canConfigureCollection,g]),ke=(0,n.useCallback)((e=>{if(!N||!U)return;const t=(0,Ea().dI)({collectionViewId:U,currentUserId:_}),o=e.state,n=(0,Va().mK)(t,o),r=(0,Va().mK)(new Date((0,Va().to)(t,o)).getDate()>7?(0,Va().Mw)(t):t,o),i="month"===ae?r:n;z.update((e=>({...e,startingMonth:r.valueOf()}))),be(i,ae)}),[N,U,_,ae,z,be]),Te=(0,n.useCallback)((()=>{if(!O.current||!ce)return;const e=C().Ul(Array.from(oe.entries()).map((e=>{let[t,o]=e;return{store:o,timestamp:t}})),(e=>{let{timestamp:t}=e;return t})),t=O.current.getBoundingClientRect(),n=e.find((e=>{let{store:n}=e;const r=o(695625).T.getRectFromStore(n);if(!r)return;const i=(null==ve?void 0:ve.scrollTop)??0,l=r.top<=t.top+i,s=r.bottom>=t.top+i;return l&&s}));if(n){const e=(0,Va().Mw)((0,Va().K1)({date:(0,Va().to)(n.timestamp,W),daysToAdd:1}));e!==ie&&z.update((t=>({...t,startingMonth:e})))}}),[z,oe,ce,W,ie,null==ve?void 0:ve.scrollTop]),Ie=(0,Wn().d)(Te,100),Ae=(0,n.useCallback)((e=>{if(e<De().A.incrementScrollOffset&&!q&&ce){const e=(0,Va().to)((0,Va().AQ)({date:J,monthsToAdd:2}),W);(0,Fa().r)({dateRangeStart:Z,dateRangeEnd:e,collectionContextStore:r})}}),[r,J,Z,q,ce,W]),Pe=(0,n.useCallback)((e=>{const{target:t}=e;!j&&t instanceof HTMLElement&&(0,Ce().SQ)({event:e,context:Ce().y$.EditorMouseDown,callback:()=>{e.preventDefault(),A().jD({environment:R,target:t,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[i],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!1})}})}),[R,j,i]),Me=(0,n.useCallback)((e=>{if(!G&&(0,Oa().kc)(te)){const t=function(e,t){P().AP();const{selectableRectMap:n}=o(666710).default.state,r=Array.from(oe.keys()),i=Array.from(oe.values());for(const[o,l]of n.entries())if(l&&La().ux(l,e,t)&&i.indexOf(o.props.store)>=0)return r.find((e=>oe.get(e)===o.props.store))}(e.clientX,e.clientY);le!==t&&z.update((e=>({...e,hoveredDay:t})))}}),[z,te,oe,le,G]),Be=(0,Wn().d)(Me,100);(0,a().l)((()=>{ke(Se().XX),Se().XX.addListener(ke)})),(0,c().X)((()=>{Se().XX.removeListener(ke)})),(0,n.useEffect)((()=>{G&&(0,Oa().kc)(te)&&z.update((e=>({...e,hoveredDay:void 0}))),m.calendar_by||we()}),[z,te,G,m.calendar_by,we]),(0,n.useEffect)((()=>{const e=F.current,t=null==e?void 0:e.parentElement,o=ve;return t&&(xe().P4(t,"mousemove",Be),o&&xe().P4(o,"scroll",Ie)),()=>{t&&xe().Ol(t,"mousemove",Be),o&&xe().Ol(o,"scroll",Ie)}}),[Be,Ie,ve]);const _e=(0,u().IS)((()=>({scroller:{height:"calc(100% - 66px)",maxHeight:y?y-(j?74:66):"inherit",paddingBottom:16,maskImage:"none",WebkitMaskImage:"none",...X?{paddingTop:12}:{}},scrollOffset:X?{height:"100%",maxHeight:"inherit"}:{},selectable:{position:"relative",paddingLeft:1,...X&&{height:"100%",maxHeight:"inherit"}},container:{paddingBottom:b,paddingLeft:w,paddingRight:T,minWidth:x,...X&&{height:"100%",maxHeight:"inherit"}},sticky:{paddingLeft:w,paddingRight:T,minWidth:x}})),[X,j,y,x,b,w,T]),Ve=(0,ue().Zp)(),Fe=(0,n.useCallback)((()=>(0,Ar().A)((e=>(0,S.jsx)(il().b,{nodeRef:O,children:(0,S.jsx)(Cn().A,{onChange:Ae,style:_e.scrollOffset,children:(0,S.jsx)("div",{ref:D,style:_e.container,className:he().G1r,children:(0,S.jsxs)(lt().A,{store:i,onMouseDown:Pe,style:_e.selectable,shouldShowHalo:!h&&!X&&!v,canSelect:!h&&!Q,analyticsName:"calendar",disablePointerEvents:null==Ve?void 0:Ve.disableAllPointerEvents,...e,children:[!(null!=Ve&&Ve.disableAllPointerEvents)&&(0,S.jsx)(Kc,{collectionContextStore:r,weeks:ge,startOfWeek:W,dateRangeStart:Z,currentlyViewedMonth:de,setNewCalendarStart:be,calendarViewRange:ae,isInHomeWidget:X,isInPeekRenderer:f,stickyStyle:_e.sticky}),X?(0,S.jsx)(Jt,{style:_e.scroller,children:(0,S.jsx)(Cc,{blockPropertyValueOverlayStore:t,collectionContextStore:r,blockStore:i,calendarStore:z,resultStore:K,sortedResultsStore:fe,format:l,query:m,schema:g,weeks:ge,isInPeekRenderer:f,currentlyViewedMonth:de,canEditCalendar:se,isInHomeWidget:X,isTypedMsvCollection:Y})}):(0,S.jsx)(Cc,{blockPropertyValueOverlayStore:t,collectionContextStore:r,blockStore:i,calendarStore:z,resultStore:K,sortedResultsStore:fe,format:l,query:m,schema:g,weeks:ge,isInPeekRenderer:f,currentlyViewedMonth:de,canEditCalendar:se,isInHomeWidget:X,isTypedMsvCollection:Y})]})})})})))),[t,i,z,ae,se,r,de,Z,l,Pe,Ae,h,X,f,v,Q,Y,D,Ve,m,K,g,be,fe,W,_e.container,_e.scrollOffset,_e.scroller,_e.selectable,_e.sticky,ge]),{calendar_by:Le}=m;if(!Le)return(0,S.jsx)(Gc,{collectionContextStore:r,isFullScreen:h,paddingBottom:b,paddingLeft:w,paddingRight:T});const Oe=g[Le];return Oe&&co().$L(Oe)?pe?(0,S.jsx)(Wo().A,{id:"calendar_results",resultStore:K,collectionContextStore:r,reducer:pe,render:Fe}):null:(0,S.jsx)(Gc,{collectionContextStore:r,isFullScreen:h,paddingBottom:b,paddingLeft:w,paddingRight:T})}));function Gc(e){const{collectionContextStore:t,isFullScreen:o,paddingBottom:n,paddingLeft:r,paddingRight:i}=e,l=t.settingsStore,s=(0,d().K8)((()=>t.permissionScopesStore.state.canConfigureBlock),[t]),a=(0,u().IS)((()=>({container:{paddingLeft:r,paddingRight:i,paddingBottom:o?void 0:n}})),[o,n,r,i]);return(0,S.jsx)(Gs,{style:a.container,title:(0,S.jsx)(k().sA,{defaultMessage:"No date property",id:"database.calendarView.missingDatePropertyTitle"}),description:s?(0,S.jsx)(k().sA,{defaultMessage:"<opensettingslink>Add a date property</opensettingslink> to your database in order to display a Calendar view.",id:"database.calendarView.missingDateProperty",values:{opensettingslink:e=>(0,S.jsx)(Hs,{onClick:()=>{I().Ow({collectionContextStore:t,collectionSettingsStore:l}),I().a2({collectionSettingsStore:l,item:{type:"properties",timelineViewTab:"table"}})},children:e})}}):(0,S.jsx)(k().sA,{defaultMessage:"Calendar views require a date property in order to display.",id:"database.calendarView.missingDatePropertyNoPermissions"})})}var Wc=()=>o(714574),Nc=()=>o(996494);function $c(e,t){return(0,nr().B2)(t[e])}function Uc(e){const{environment:t,store:o,collectionContextStore:n}=e,{mainEditorCurrentBlockStore:r}=Le().default.state;return L().wy({environment:t,store:o,mainEditorCurrentBlockStore:r,collectionContextStore:n,fullyQualified:!1})}function qc(e,t,o,n,r,i){return t.isDefined()?n.filter((n=>{const l="title"!==n&&r;return!dt().r8({property:n,schema:o,block:t.getModel(),getRecordModel:t.getRecordModel,userId:e.currentUser.id,userTimeZone:(0,yo().P)(),intl:yt().A.getIntl(),experimentService:Io().default,collectionFeatureGates:(0,wo().i)(),formulasModule:i})||l})):[]}function Yc(e,t,o,n,r,i,l){const s=t.state,a=s.isOpen?s.property:"title",c=qc(e,o,n,r,i,l),d=c.findIndex((e=>e===a)),u=C().Uk(c,((e,t)=>t<d&&$c(e,n)));return u||(i?"title":function(e,t){return C().Uk(e,(e=>$c(e,t)))}(c,n))}function Xc(e,t,o,n,r,i,l){const s=t.state,a=s.isOpen?s.property:"title",c=qc(e,o,n,r,i,l),d=c.findIndex((e=>e===a)),u=c.find(((e,t)=>t>d&&$c(e,n)));return u||(i?"title":function(e,t){return e.find((e=>$c(e,t)))}(c,n))}function Qc(e){(0,Wc().P)({store:e})}function Zc(e,t,o,n,r){if("title"===e){Jo().VN({environment:r,blockPropertyValueOverlayStore:o});const e=t.getBlockTitleStore();P().hc({environment:r,store:t}),(0,Rn().C)({store:t}),M().setSelectionAtEnd({store:e})}else e?(Jo().VN({environment:r,blockPropertyValueOverlayStore:o}),Jo().ho({environment:r,blockPropertyValueOverlayStore:o,store:t,property:e,format:Tt().j.ListView,collectionContextStore:n})):Jo().VN({environment:r,blockPropertyValueOverlayStore:o});Qc(t)}function Jc(e,t,o){Jo().VN({environment:e,blockPropertyValueOverlayStore:t}),P().Lt({environment:e,store:o}),Qc(o)}function ed(e){const{environment:t,newStore:o,previousStore:n}=e;P().hc({environment:t,store:o}),(0,Rn().C)({store:o}),Nc().A.setState({store:o,editMode:"new",previousStore:n})}var td=()=>o(551619);function od(e){const t=(0,s().v3)(),{store:o,collectionContextStore:r,disabled:i,groupsPointer:l,collectionStore:a,subitemPath:c,indentLevel:p,onSubitemCreate:m}=e,g=(0,d().K8)((()=>{var e;return"timeline"===(null===(e=r.collectionViewStore())||void 0===e?void 0:e.getType())}),[r]),h=(0,d().K8)((()=>{var e;return"title"===(null===(e=r.collectionViewStore())||void 0===e?void 0:e.getFormat().table_subitem_toggle_column)}),[r]),f=(0,td().Sm)(o),v=(0,d().K8)((()=>(0,_().si)({columnIndex:0,titleColumnIndex:0,indentLevel:p,isSubitemToggleOnTitleColumn:h})),[p,h]),y=(0,u().IS)((t=>({newRowButton:{display:"flex",alignItems:"center",height:32,width:"100%",paddingLeft:v,fontSize:14,lineHeight:w().K_.UIRegular.desktop,borderBottom:`1px solid ${t.tableDividerColor}`,left:0,right:0,...g&&{borderTop:"none"},...e.styles},newRowContainer:{display:"inline-flex",alignItems:"center",position:"sticky",left:v+8,color:t.lightTextColor},newIcon:{width:14,height:14,marginLeft:-1,marginRight:6,fill:t.lightIconColor},newText:{color:t.lightTextColor}})),[v,g,e.styles]),x=(0,d().K8)((()=>{const e=r.permissionScopesStore.state,t=a.isSyncedCollection();return!i&&e.canEditContent&&!t}),[r,i,a]),C=(0,n.useCallback)((e=>{B().createAndCommit({userAction:"CollectionNestedCreateSubitemButton.handleClick",environment:t,canUndo:!0,perform:n=>{const i=(0,tn().u)({environment:t,collectionContextStore:r,groupsPointer:l,store:o,before:!1,collectionStore:a,transaction:n,subitemPath:c,subitemInsertDirection:"into",from:"cvb_new_subitem",event:e});i&&m(i)}}),function(e,t){ge().vd(e,"create_subitem",t)}(t,{...(0,fe().sl)(r)})}),[r,t,l,a,o,c,m]);return!x||f?null:(0,S.jsx)(Rt().A,{onClick:C,onMouseDown:Ce().tr,style:y.newRowButton,children:(0,S.jsxs)("span",{style:y.newRowContainer,children:[(0,uo().W)(y.newIcon),(0,S.jsx)("span",{style:y.newText,children:(0,S.jsx)(k().sA,{defaultMessage:"New sub-item",id:"database.tableView.nest.addSubitem"})})]})})}var nd=()=>o(442277);function rd(e){let{property:t,propertyIndex:o,showProperties:r,blockPropertyValueOverlayStore:i,store:l,schema:a,collectionContextStore:c,disabled:u,isEditing:p,mouseIsEntered:m}=e;const g=(0,s().v3)(),h=(0,n.useCallback)((async()=>async function(e,t,o,n,r,i,l){Zc(Yc(e,t,o,n,r,l,await me().T.formulas.load()),o,t,i,e)}(g,i,l,a,r,c,p)),[g,i,l,a,r,c,p]),f=(0,n.useCallback)((async()=>async function(e,t,o,n,r,i,l){Zc(Xc(e,t,o,n,r,l,await me().T.formulas.load()),o,t,i,e)}(g,i,l,a,r,c,p)),[g,i,l,a,r,c,p]),v=(0,d().K8)((()=>L().Dj({store:l,collectionContextStore:c})),[l,c]),y=(0,d().K8)((()=>c.collectionViewStore()),[c]),x=(0,d().K8)((()=>{const e=c.isInHomeWidgetStore.state,o=c.isUnlistedViewStore.state&&c.isInlineViewStore.state;return"title"===t&&m&&!e&&!o}),[c,m,t]),C=(0,d().K8)((()=>l.canEdit()),[l]),b=(0,d().K8)((()=>p||c.isInHomeWidgetStore.state),[p,c]),w=(0,d().K8)((()=>c.permissionScopesStore.state.isLocked||!c.permissionScopesStore.state.canEditContent),[c]);return v?(0,S.jsx)(hr().m,{store:l,property:t,propertyIndex:o,disabled:u||!C,locked:w,format:Tt().j.ListView,tableWrap:!1,blockPropertyValueOverlayStore:i,collectionStore:v,collectionViewStore:y,forceMouseEntered:x,showIfEmpty:b,onBgClick:()=>Jc(g,i,l),onEnter:()=>Jc(g,i,l),onEsc:()=>Jc(g,i,l),onTab:f,onUntab:h,onClick:()=>Qc(l)},t):null}function id(e){let{collectionContextStore:t,toggleButton:o,subitemPath:n}=e;const r=(0,d().O$)(t.currentSubitemFormatStoreForUiDisplayStore),i=(null==n?void 0:n.length)??0;if(!r)return null;const l=Math.max((i-1)*te().yy,0)+te().Pi;return o?(0,S.jsxs)("div",{style:{paddingTop:4,display:"flex"},children:[(0,S.jsx)("div",{style:{width:l}}),o]}):(0,S.jsx)("div",{style:{minWidth:l+te().yy}})}const ld=n.memo(n.forwardRef((function(e,t){const o=(0,k().tz)(),{store:r,schema:i,blockPropertyValueOverlayStore:l,handleOpenPeekPage:a,collectionContextStore:p,onShiftEnter:m,toggleButton:g,subitemPath:h,showProperties:f,disabled:v}=e,y=(0,s().v3)(),{isMobile:x,isPhone:C}=(0,s().Y0)(),b=(0,n.useRef)(null),w=(0,n.useRef)(null),[T,I]=(0,n.useState)(!1),[R,j]=(0,n.useState)(!1),[A,P]=(0,n.useState)(!1),B=(0,d().uB)(void 0,ht().A),_=(0,d().K8)((()=>{const e=nn().A.state;return Boolean(e.isActive&&e.store.id===r.id)}),[r.id]),V=(0,d().K8)((()=>{const e=Nc().A.state;return e.store&&e.store.id===r.id?e.editMode:void 0}),[r.id]),F=(0,Wn().d)((()=>{Ke().A.state||B.setState({...B.state,mouseEntered:!0})}),100),L=(0,Gn().Y)((()=>{B.setState({...B.state,mouseEntered:!1})}),100),O=(0,d().K8)((()=>B.state.mouseEntered),[B]),E=(0,Wn().d)((()=>{P(!0)}),100),D=(0,Wn().d)((()=>{j(!0)}),100),z=(0,d().K8)((()=>ie().default.state.stores.length>0&&ie().default.state.stores[0].id===r.id),[r.id]),K=(0,n.useCallback)((()=>{const e=Uc({environment:y,store:r,collectionContextStore:p});e&&(a(),$n().oo({environment:y,url:e}))}),[y,a,r,p]),H=(0,d().K8)((()=>r.getBlockTitleStore()),[r]),G=(0,d().K8)((()=>function(e){return(0,Zn().Ay)({store:e,fullyQualified:!1,pageVisitSource:wn().y8.LinkInPage})}(r)),[r]),W=(0,d().K8)((()=>Uc({environment:y,store:r,collectionContextStore:p})),[y,r,p]),N=(0,d().K8)((()=>f.map((e=>r.getPropertyValue(e)))),[f,r]),$=(0,n.useCallback)((()=>{!function(e,t){Qc(e),t()}(r,a)}),[r,a]),U=(0,n.useCallback)((()=>{w.current&&I(w.current.scrollWidth>w.current.clientWidth)}),[]),q=(0,Wn().d)(U,100),Y=(0,u().IS)((e=>{return{container:{display:"flex",position:"relative"},linkBox:{position:"relative",...(t=_?"multi":"single",{display:"flex",flexGrow:1,textDecoration:"none",overflow:"hidden",borderRadius:6,..."single"===t?{height:30}:{minHeight:30}})},mobileLinkBox:{flexGrow:1,textDecoration:"none",overflow:"hidden",borderBottom:`1px solid ${e.tableDividerColor}`},linkBoxInner:{display:"flex",alignItems:"center",paddingLeft:4,userSelect:_?void 0:"none",WebkitUserSelect:_?void 0:"none"},mobileLinkBoxInner:{paddingLeft:4,paddingRight:4,paddingBottom:4,paddingTop:4},propertiesWithTitleContainer:{display:"flex",alignItems:"center"},propertiesAfterTitleContainer:{display:"flex",alignItems:"center",paddingLeft:x?0:6,paddingBottom:x?0:4},hoveredStyle:{background:_?"transparent":e.buttonHoveredBackground},pressedStyle:{background:_?"transparent":e.buttonPressedBackground},overflowButtonArea:{position:"absolute",right:-28,top:"50%",transform:"translateY(-50%)",width:28,height:"100%",cursor:"pointer"},overflowButton:{position:"absolute",right:0,top:"50%",transform:"translateY(-50%)",display:"flex",width:20,height:20,borderRadius:4,justifyContent:"center",alignItems:"center",isolation:"isolate",zIndex:2,backdropFilter:"blur(8px)",background:e.buttonBackground,transition:"none",paddingLeft:2,paddingRight:0},overflowIcon:{width:12,height:12,fill:e.lightIconColor,marginLeft:-2}};var t}),[_,x]);(0,n.useEffect)((()=>{_&&"new"===V&&M().setSelectionAtEnd({store:H})}),[_,V,H]),(0,n.useEffect)((()=>(window.addEventListener("resize",q),()=>window.removeEventListener("resize",q))),[q]),(0,n.useEffect)((()=>{q()}),[q,N]),(0,c().X)((()=>{Nc().A.reset(),nn().A.reset()}));const X=(0,n.useMemo)((()=>f.indexOf("title")),[f]),Z=C&&f.length>0,J=(0,S.jsx)(id,{collectionContextStore:p,toggleButton:g,subitemPath:h}),ee=(e,t)=>(0,S.jsx)(rd,{blockPropertyValueOverlayStore:l,collectionContextStore:p,disabled:v,isEditing:_,mouseIsEntered:O,property:e,propertyIndex:t,showProperties:f,schema:i,store:r},e);let te;if(Z){const[e,t]=[f.slice(0,X+1),f.slice(X+1)];te=(0,S.jsxs)("div",{style:Y.container,dir:"ltr",ref:b,children:[J,(0,S.jsxs)(Qn().A,{ref:w,href:G,metaHref:W,external:!1,style:Y.mobileLinkBox,innerStyle:Y.mobileLinkBoxInner,children:[(0,S.jsx)("div",{style:Y.propertiesWithTitleContainer,children:e.map(ee)}),t.length>0&&(0,S.jsx)("div",{style:Y.propertiesAfterTitleContainer,children:t.map(ee)})]})]})}else{const e=o.formatMessage({id:"collectionList.overflow.tooltip",defaultMessage:"See all properties"});te=(0,S.jsx)(Q().A,{debugName:"CollectionListViewItem",capture:z,onShiftEnter:m,children:(0,S.jsxs)("div",{style:Y.container,dir:"ltr",ref:b,onMouseEnter:D,onMouseLeave:()=>j(!1),children:[J,(0,S.jsx)(Qn().A,{ref:w,href:G,metaHref:W,altHref:W,onClick:$,external:!1,style:Y.linkBox,innerStyle:Y.linkBoxInner,hoveredStyle:Y.hoveredStyle,pressedStyle:Y.pressedStyle,onMouseEnter:F,onMouseMove:F,onMouseLeave:L,children:f.map(ee)}),T&&(0,S.jsx)("div",{style:Y.overflowButtonArea,children:(A||R)&&(0,S.jsx)(At().A,{renderTooltip:()=>e,placement:Fe().W.Bottom,render:t=>(0,S.jsx)(jt().A,{icon:nd().B,iconStyle:Y.overflowIcon,ariaLabel:e,style:Y.overflowButton,onClick:K,onMouseEnter:E,onMouseLeave:()=>P(!1),...t})})})]})})}return(0,je().NW)(r,t,(0,n.useMemo)((()=>({renderedType:"page",getBlockStore:()=>r,getNode:()=>b.current,activate:K})),[r,K]),te)})));function sd(){return{marginTop:1,marginBottom:1}}const ad=n.memo((function(e){let{groupFormat:t,store:o,format:r,disabled:i,collectionContextStore:l,schema:a,blockPropertyValueOverlayStore:c}=e;const u=(0,s().v3)(),p=(0,n.useMemo)((()=>t?[t]:[]),[t]),m=(0,n.useMemo)((()=>(r.list_properties?r.list_properties:[]).filter((e=>e.visible)).map((e=>{let{property:t}=e;return t}))),[r]),{permissionScopes:g}=(0,d().K8)((()=>({permissionScopes:l.permissionScopesStore.state})),[l]),h=(0,d().K8)((()=>l.groupsStore.getGroupState(p)),[p,l]),f=(0,d().K8)((()=>!i&&o.canEdit()&&g.canEditContent&&!g.isSyncedCollection),[i,o,g]),v=(0,n.useCallback)((()=>{if(!h)return;const e=l.collectionStore();if(!e||!l.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return;const t=ie().default.state.stores[0];if(!t)return;const o=l.subitemTreeStore.state,n=(0,bo().Qe)(o.children,(e=>e.value.store===t));if(!n)return;const r=n?(0,te().kY)(n.map((e=>e.value.store))):"",i=l.subitemExpandedStore.state.get(r),s=Boolean(null==i?void 0:i.isExpanded);B().createAndCommit({userAction:"CollectionListView.onItemShiftEnter",environment:u,canUndo:!0,perform:o=>{const r=(0,tn().u)({environment:u,collectionContextStore:l,groupsPointer:h.groupsPointer,store:t,before:!1,collectionStore:e,transaction:o,subitemPath:n,subitemInsertDirection:s?"into":"below",from:"list_selection_overlay_shift_enter"});r&&ed({environment:u,newStore:r,previousStore:t})}}),(0,or().u)(u,"list_item_edit_mode_enter",{...(0,fe().sl)(l),block_id:t.id,from:"shiftEnter",view_type:"list"})}),[l,u,h]),y=(0,n.useCallback)(((e,t)=>{ed({environment:u,newStore:t,previousStore:e})}),[u]),x=(0,n.useMemo)((()=>({blockPropertyValueOverlayStore:c,collectionContextStore:l,disabled:i,onShiftEnter:v,schema:a,showProperties:m,collectionViewBlockStore:o})),[c,l,i,v,a,m,o]),C=(0,n.useCallback)((e=>{const{store:t,parentStore:o,subitemPath:n,indentLevel:r}=e;if(o)return(0,S.jsx)(od,{store:t,collectionStore:o,subitemPath:n,indentLevel:r,collectionContextStore:l,disabled:i,groupsPointer:p,styles:{borderBottom:void 0,borderTop:void 0},onSubitemCreate:e=>{(0,Rn().C)({store:e,transient:!1}),Nc().A.setState({store:e,editMode:"new",previousStore:void 0})}})}),[l,i,p]);return h?(0,S.jsx)(gn,{collectionContextStore:l,groupsPointer:p,format:r,canDrag:f,resultProps:x,canDrop:!0,resultComponent:ld,disabled:i,shouldShowHoverMenu:!0,direction:pn.Vertical,analyticsName:"list",getItemSelectableStyle:sd,emptyDroppableSize:0,onSelectableInsertRow:y,nestedCreateSubitemButton:C}):null}));const cd=n.memo((function(e){const{store:t,format:o,paddingBottom:r,paddingLeft:i,paddingRight:l,isFullScreen:a,isPreviewing:c,isRootChild:p,minWidth:m,disabled:g,collectionContextStore:h}=e,f=(0,s().v3)(),{isMobile:v}=(0,s().Y0)(),y=(0,u().DP)(),x=(0,d().K8)((()=>L().mM(h,a)),[h,a]),C=(0,d().K8)((()=>null==h?void 0:h.isInHomeWidgetStore.state),[h]),b=(0,d().K8)((()=>"collectionSystemView"===(null==h?void 0:h.contextType)),[h]),w=(0,d().K8)((()=>!!h.viewsModuleContextStore.getViewModuleType()),[h]),k=o.collection_group_by,T=(0,n.useCallback)(((e,t,o)=>{if(v)Tn().uK({environment:f,store:e,pageVisitSource:wn().y8.Create});else if(t)ed({environment:f,newStore:e,previousStore:void 0});else{const{groupFormat:t}=o,n=t?[t]:[],r=h.groupsStore.getGroupState(n),i="collectionTypedView"===h.contextType;In().VU({environment:f,store:e,peekMode:L().hH(h),showMoveTo:i,resultsStore:null==r?void 0:r.resultsStore,collectionContextStore:h,pageVisitSource:wn().y8.Create})}}),[h,f,v]),I=(0,n.useCallback)((e=>0===e.index?{}:{borderTop:`1px solid ${y.tableDividerColor}`}),[y]),R=(0,n.useCallback)((o=>(0,S.jsx)(rs,{reducerId:"list_groups",store:t,collectionContextStore:h,disabled:g,isFullScreen:a,isRootChild:p,paddingLeft:i,stickyLeft:!1,renderGroup:t=>(0,S.jsx)(ud,{...e,groupFormat:t}),getGroupStyle:I,renderHeader:e=>(0,S.jsx)(dd,{args:e}),onGroupHeaderAddItem:T})),[h,g,I,T,a,p,i,e,t]),j=(0,n.useCallback)((e=>{const t=h.isLoadingStore.state,o=h.groupsStore.getGroupState([]);if(!o)return;if("collectionSystemView"===h.contextType)return;const n=o.reducerResultStore.state;e<De().A.incrementScrollOffset&&n&&!t&&n.hasMore&&(0,So().H)({collectionContextStore:h,environment:f,incrementLimitArgs:{isFullScreen:a,currentResultCount:n.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})}),[h,f,a]),A=(0,u().IS)((()=>({container:{paddingBottom:C?0:r,paddingLeft:i,paddingRight:l,minWidth:m},selectable:{display:"flex",flexDirection:"column",paddingTop:k||C||b?void 0:4,paddingBottom:4}})),[r,i,l,m,k,C,b]),P=(0,ue().Zp)();return(0,Ar().A)((o=>(0,S.jsxs)("div",{style:A.container,className:he()._OD,children:[(0,S.jsx)(lt().A,{store:t,shouldShowHalo:!a&&!C&&!c,canSelect:!a&&!w,disablePointerEvents:null==P?void 0:P.disableAllPointerEvents,analyticsName:"list",style:A.selectable,...o,children:k?R(k):(0,S.jsx)(ud,{...e,groupFormat:k})}),!x&&(0,S.jsx)(Cn().A,{onChange:j})]})))}));function dd(e){const{args:t}=e,{collectionContextStore:o}=t,n=(0,d().O$)(o.isInHomeWidgetStore),{stickyStyle:r}=(0,u().IS)((e=>({stickyStyle:{boxShadow:`0 -1px 0 ${e.contentBackground}`}})),[]);return(0,S.jsx)(Gi,{...t,height:n?ft().ag:48,stickyStyle:r})}const ud=n.memo((function(e){const{store:t,format:r,schema:i,disabled:l,groupFormat:a,isFullScreen:c,collectionContextStore:p,blockPropertyValueOverlayStore:m}=e,{isMobile:g}=(0,s().Y0)(),h=void 0!==a,f=(0,n.useMemo)((()=>a?[a]:[]),[a]),v=(0,d().K8)((()=>p.groupsStore.getGroupState(f)),[p,f]),y=(0,d().K8)((()=>null==v?void 0:v.reducerResultStore.state),[v]),x=(0,d().K8)((()=>p.groupsStore.anyGroupHasResults()),[p]),{canEditContent:C,isSyncedCollection:b}=(0,d().K8)((()=>{const e=p.permissionScopesStore.state;return{canEditContent:e.canEditContent,isSyncedCollection:e.isSyncedCollection}}),[p]),w=(0,d().K8)((()=>"collectionTypedView"===p.contextType),[p]),k=(0,d().O$)(p.isInHomeWidgetStore),T=(0,d().K8)((()=>x&&!l&&t.canEdit()&&(C||w)&&!b),[x,l,t,C,w,b]),I=(0,d().K8)((()=>""!==p.searchQueryStore.state),[p]),R=(0,d().K8)((()=>void 0!==y&&(null==y?void 0:y.blockIds.length)>0),[y]),j=(0,d().K8)((()=>(0,bn().iv)({collectionContextStore:p,groupsPointer:f,hasPartialResults:R})),[p,f,R]),A=(0,d().K8)((()=>L().XQ({collectionContextStore:p,reducerResult:y,isFullScreen:c})),[p,y,c]),P=(0,u().IS)((e=>({container:{paddingBottom:a?k?8:16:void 0},groupLoadMoreButton:{fontSize:16,marginTop:g?4:void 0,paddingLeft:3},groupLoadMoreIcon:{width:16,height:16,marginRight:8},spacer:{width:"100%",borderTop:a||k?void 0:`1px solid ${e.tableDividerColor}`,marginTop:4,marginBottom:4}})),[a,k,g]);return v?(0,S.jsxs)("div",{style:P.container,children:[(0,S.jsx)(ad,{groupFormat:a,store:t,format:r,disabled:l,collectionContextStore:p,schema:i,blockPropertyValueOverlayStore:m}),j&&(0,S.jsx)(o(286993).c,{isFullScreen:c,hasGroups:h,hasPartialResults:R,hasSearchQuery:I,overrideNumShimmerRows:k&&!R?6:void 0}),T&&(0,S.jsxs)(S.Fragment,{children:[A&&(0,S.jsx)("div",{style:P.spacer}),(0,S.jsx)(pd,{collectionContextStore:p,isFullScreen:c,groupState:v,groupFormat:a})]}),A&&(0,S.jsx)(ho().Ay,{groupsPointer:f,store:t,collectionContextStore:p,format:r,isFullScreen:c,incrementLimitsInRelatedGroups:!1,style:P.groupLoadMoreButton,iconStyle:P.groupLoadMoreIcon})]}):null})),pd=n.memo((function(e){const{groupState:t,groupFormat:o,collectionContextStore:r,isFullScreen:i}=e,l=(0,s().v3)(),a=(0,k().tz)(),{isMobile:c}=(0,s().Y0)(),p=(0,d().O$)(r.isInHomeWidgetStore),m=(0,d().K8)((()=>L().fG({collectionContextStore:r,environment:l,intl:a})),[r,l,a]),g=(0,n.useCallback)((()=>{if(!(0,Ye().EF)(l))return void(0,Ye().QY)(l);const e=r.currentSubitemFormatStoreForUiDisplayStore.state;B().createAndCommit({userAction:"CollectionListView.handleAddItemClick",environment:l,canUndo:!0,perform:o=>{!function(e){var t;const{transaction:o,environment:n,results:r,collectionContextStore:i,isFullScreen:l,groupsPointer:s,insertAtIndex:a,from:c}=e;i.searchQueryStore.state&&(0,jn().S)({searchQuery:"",collectionContextStore:i,isFullScreen:l});const d=null===(t=i.groupsStore.getGroupState(s))||void 0===t?void 0:t.resultsStore;if(!d)return;let u;a>0&&(u=r[a]);const p=(0,kn().Q)({environment:n,collectionContextStore:i,groupsPointer:s,insertAtIndex:a,shouldCoerce:!0,templateStore:i.defaultPageTemplateStore.state,transaction:o,from:{createBlock:c},inMemoryRecordCache:n.defaultRecordCache.inMemoryRecordCache});if(!p)return;const m=p.coercionSucceeded,g=p.newStore;n.device.isMobile?Tn().uK({environment:n,store:g,pageVisitSource:wn().y8.Create}):m?ed({environment:n,newStore:g,previousStore:u}):In().VU({environment:n,store:g,peekMode:(0,L().hH)(i),resultsStore:d,collectionContextStore:i,pageVisitSource:wn().y8.Create}),Qo().v(n,{from:c,type:"page",new_page_id:g.id,creating_block_id:g.id,...(0,fe().sl)(i)})}({transaction:o,environment:l,results:t.resultsStore.state,collectionContextStore:r,isFullScreen:i,groupsPointer:t.groupsPointer,insertAtIndex:t.resultsStore.state.length,from:e?"list_view_add_parent_item_bottom":"list_view_add_item_bottom"})}})}),[l,t,r,i]),h=(0,u().IS)((e=>({button:{display:"flex",alignItems:"center",height:(0,_().sG)({isMobile:c}),borderRadius:6,fontSize:p?14:16,color:e.lightTextColor,paddingLeft:4,paddingRight:12},icon:{width:p?12:16,height:p?12:16,marginLeft:p?10:3,marginRight:p?6:8,fill:e.lightIconColor},buttonContainer:{display:"flex"}})),[p,c]);return m?(0,S.jsxs)("div",{style:h.buttonContainer,children:[(0,S.jsxs)(Rt().A,{onClick:g,onMouseDown:Ce().tr,style:h.button,children:[(0,uo().W)(h.icon),(0,S.jsx)(Bn,{collectionContextStore:r})]}),(0,S.jsx)(Kn().O,{collectionContextStore:r,groupFormat:o,renderLinkButton:e=>(0,S.jsxs)(Rt().A,{style:h.button,...e,children:[(0,zn().H)(h.icon),(0,S.jsx)(k().sA,{id:"database.findOrCreatePage",defaultMessage:"Link existing"})]})})]}):(0,S.jsxs)(Rt().A,{onClick:g,onMouseDown:Ce().tr,style:h.button,children:[(0,uo().W)(h.icon),(0,S.jsx)(Bn,{collectionContextStore:r})]})}));class md extends p().default{getInitialState(){return{}}getCurrentFormat(e){return this.state.temporaryFormat?this.state.temporaryFormat:e}getCurrentProperties(e,t){return this.getCurrentFormat(t)[e]||[]}}const gd=md;var Sd=()=>o(675592);const hd=n.memo((function(e){let{collectionContextStore:t,tableProperties:r,paddingLeft:i,paddingRight:l,children:a}=e;const c=(0,s().v3)(),{isPhone:u}=(0,s().Y0)(),[p,m]=(0,n.useState)(!0),g=(0,n.useRef)(null),h=(0,n.useMemo)((()=>r.filter((e=>e.visible))),[r]),f=(0,d().K8)((()=>{var e;const o=null===(e=t.virtualizedModule.getHorizontalScrollerRefStore())||void 0===e||null===(e=e.state)||void 0===e?void 0:e.current;return o?(g.current=o.getStore().state.elementRef.current,g.current):null}),[t]),v=(0,d().K8)((()=>{const e=t.frozoneStore.state.frozenIndex;return void 0===e?0:e+1}),[t]),y=(0,d().K8)((()=>h.map((e=>(0,_().oe)({environment:c,propertyFormat:e})))),[c,h]);(0,n.useEffect)((()=>{t.virtualizedModule.setVirtualizedColumnsEnabled(p)}),[p,t]);const x=(0,n.useCallback)((e=>{let t=e.width-i-l,o=0;for(let n=0;n<y.length;n++){if(t-=y[n]??0,t<=0){o=n;break}}y.length-1-o<=5?m(!1):m(!0)}),[i,l,y]);(0,o(188709).tK)(g,x);const C=(0,n.useCallback)((e=>e+v>y.length-1?35:y[e+v]??35),[y,v]),b=(0,fo().Te)({enabled:p,count:h.length,estimateSize:C,scrollMargin:i,getScrollElement:()=>f,getItemKey:e=>h[e].property||e,scrollPaddingStart:i,scrollPaddingEnd:l,overscan:u?2:1,horizontal:!0}),w=b.getVirtualItems(),[k,T]=(0,n.useMemo)((()=>w.length>0?[w[0].start-i,b.getTotalSize()-w[w.length-1].end]:[0,0]),[w,b,i]),I=0===w.length?0:v+w[0].index,R=0===w.length?0:w[w.length-1].index+1,{propertiesInRange:j,propertiesInRangeIndices:A}=(0,n.useMemo)((()=>0===w.length?{propertiesInRange:[],propertiesInRangeIndices:[]}:{propertiesInRange:h.slice(I,R),propertiesInRangeIndices:Array.from({length:R-I},((e,t)=>I+t))}),[w.length,R,I,h]),P=(0,n.useMemo)((()=>({propertiesInRange:j,propertiesInRangeIndices:A,beforeWidth:k,afterWidth:T})),[T,k,j,A]);return(0,S.jsx)(Sd().Pr.Provider,{value:b,children:(0,S.jsx)(Sd().Z6.Provider,{value:p,children:(0,S.jsx)(Sd().Wm.Provider,{value:P,children:a})})})}));var fd=()=>o(651124),vd=()=>o(124311),yd=()=>o(316369),xd=()=>o(969197);const Cd={display:"flex",width:32,height:"100%",alignItems:"center",justifyContent:"center"};function bd(e){(0,Ce().SQ)({event:e,context:Ce().y$.EditorMouseDown,callback:()=>{}})}function wd(e,t){return!e&&t}var kd=()=>o(421107),Td=()=>o(831194);const Id=n.memo((function(e){const{disabled:t,property:r,schema:i,collectionContextStore:l,groupFormat:a,propertyFormat:c,isHovered:p,aggregation:m,onChange:g}=e,h=(0,s().v3)(),f=(0,k().tz)(),{isMobile:v}=(0,s().Y0)(),[y,x]=(0,n.useState)(void 0),b=(0,n.useMemo)((()=>Boolean((null==c?void 0:c.width)&&c.width<100)),[c]),w=(0,d().K8)((()=>bi(l,m)),[l,m]),I=(0,d().K8)((()=>{if(!m)return;return{type:"aggregation",filter:a?(0,vo().Yy)({schema:i,propertyMapping:void 0,groupBy:l.getGroupByAndGroupFormats().groupBy,group:a,timeZone:(0,yo().P)(),experimentService:Io().default}):void 0,aggregation:m}}),[i,a,m,l]),R=(0,n.useCallback)(((e,t)=>{if(e){const o={aggregator:e,property:r,enforceMaxAggregationLimit:t};g(r,o),x(o),(0,T().X)({environment:h,collectionContextStore:l,action:"table_change_aggregation"})}else g(r,void 0),(0,T().X)({environment:h,collectionContextStore:l,action:"table_remove_aggregation"})}),[h,g,r,l]),j=(0,u().IS)((()=>({buttonStyle:{display:"flex",alignItems:"center",justifyContent:"flex-end",width:"100%",height:32,paddingRight:8,overflow:"hidden",whiteSpace:"nowrap",userSelect:"auto",WebkitUserSelect:"auto",transition:"background 0.2s ease"}})),[]);(0,n.useEffect)((()=>{y&&!bi(l,y)&&(0,C().n4)(m,y)&&x(void 0)}),[w,y,l,m]);const A=(0,n.useMemo)((()=>b&&null!=m&&m.aggregator?xi().zY[(0,vi().V1)(m)]:void 0),[b,m]),P=(0,n.useMemo)((()=>{const e=null==I?void 0:I.aggregation;if(!e)return"";let t=`${e.aggregator}`;return"object"==typeof e.aggregator&&"operator"in e.aggregator&&(t=`${e.aggregator.operator}:${e.aggregator.groupName}`),`table:${(0,so().Ix)(a)}:${r}:${t}`}),[a,r,null==I?void 0:I.aggregation]),M=(0,n.useCallback)((e=>I?(0,S.jsx)(Wo().A,{id:P,collectionContextStore:l,reducer:I,groupsPointer:a?[a]:void 0,render:o=>(0,S.jsx)(At().A,{alignment:b?Fe().C.Center:Fe().C.End,disableTooltip:!w&&!A,renderTooltip:()=>w?f.formatMessage(Ti.aggregationCalculating):A,render:n=>(0,S.jsx)(Rt().A,{disabled:t,style:j.buttonStyle,...(0,Ci().A)(n,e),children:(0,S.jsx)(Rd,{resultStore:o,aggregation:m,schema:i,property:r,hideLabelText:b})})})}):(0,S.jsx)(Rt().A,{disabled:t,style:j.buttonStyle,...e,children:(0,S.jsx)(jd,{disabled:t,isHovered:p,hideLabelText:b})})),[I,P,l,a,t,j.buttonStyle,p,b,w,A,f,m,i,r]),B=(0,n.useCallback)((e=>{let{close:t}=e;return(0,S.jsx)(o(195071).A,{currentAggregation:m,property:r,schema:i,onChange:R,onClose:t,source:"tableAggregation"})}),[R,m,r,i]);return(0,S.jsx)(Ri().Ay,{popupType:v?Ri().z7.SlideUp:Ri().z7.Popup,disabled:t,renderOrigin:M,render:B})})),Rd=n.memo((function(e){const{aggregation:t,resultStore:r,schema:i,property:l,hideLabelText:a}=e,c=(0,Z().ET)(),{isMobile:p}=(0,s().Y0)(),m=(0,u().IS)((e=>({valueStyle:{display:"flex",alignItems:"center",height:"100%"},aggregationTypeNameStyle:{fontSize:p?12:10,textTransform:"uppercase",letterSpacing:1,color:e.mediumTextColor,marginTop:p?0:2,marginRight:4,userSelect:"none",WebkitUserSelect:"none"}})),[p]),g=(0,d().O$)(r),h=(0,n.useMemo)((()=>{if(!t)return;let e=xi().SE[(0,vi().V1)(t)];return(0,vi().ET)(t.aggregator)&&(e=t.aggregator.groupName in Td().OR?Td().OR[t.aggregator.groupName]:t.aggregator.groupName),e}),[t]),{numberFormat:f,numberPrecision:v}=(0,d().K8)((()=>{const e=i[l];if(!e)return{};if(e&&("formula"===e.type||"number"===e.type)){const o=e.number_format,n=e.number_precision;return{numberFormat:o,numberPrecision:t?(0,xi().zI)(t.aggregator,n):n}}if("rollup"===e.type&&e.relation_property&&e.target_property&&"number"===e.target_property_type&&void 0!==i[e.relation_property]){var n;const r=i[e.relation_property],l=(0,o(685889).pg)(c,r),s=null==l||null===(n=l.getModel())||void 0===n?void 0:n.getNormalizedSchema(),a=null==s?void 0:s[e.target_property];if("number"===(null==a?void 0:a.type)){const e=a.number_format,o=a.number_precision;return{numberFormat:e,numberPrecision:t?(0,xi().zI)(t.aggregator,o):o}}}return{}}),[i,l,t,c]);if(!h)return null;const y=(0,S.jsx)("span",{style:m.valueStyle,children:t&&(0,S.jsx)(wi,{aggregation:t,collectionContextStore:c,children:g?(0,xi().rv)({numberFormat:f,dateFormat:void 0,aggregation:t,userTimeZone:(0,yo().P)(),value:g.aggregationResult,numberPrecision:v}):void 0})},"value");return a?y:(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("span",{style:m.aggregationTypeNameStyle,children:h},"type"),y]})})),jd=n.memo((function(e){const{disabled:t,isHovered:n,hideLabelText:r}=e,{isMobile:i}=(0,s().Y0)(),l=(0,u().IS)((e=>({placeholderWrapper:{display:"flex",alignItems:"center"},placeholderText:{color:e.lightTextColor},chevronIcon:{width:10,marginLeft:r?1:4,marginTop:1,fill:e.lightIconColor},summationIcon:{width:12,marginTop:1,fill:e.lightIconColor}})),[r]);return t||!n&&!i?null:(0,S.jsx)(It().A,{animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},style:l.placeholderWrapper,children:(0,S.jsxs)("div",{style:l.placeholderWrapper,children:[r?(0,S.jsx)("span",{style:l.placeholderText,children:(0,o(514503).n)(l.summationIcon)},"placeholder"):(0,S.jsx)("span",{style:l.placeholderText,children:(0,S.jsx)(k().sA,{defaultMessage:"Calculate",id:"database.tableView.aggregationPlaceholder"})},"placeholder"),(0,_l().b)(l.chevronIcon)]})})})),Ad=n.memo((function(e){let{collectionContextStore:t,disabled:o,groupFormat:r,isFullScreen:i,isInPeekRenderer:l,query:a,schema:c,showPropertyFormats:p,showRightActionsSpacer:m,style:g,paddingLeft:h,paddingRight:f,onMouseEnter:v,onMouseLeave:y,disableSticky:x}=e;const C=(0,s().v3)(),{isPhone:b,isMobile:w}=(0,s().Y0)(),k=(0,u().DP)(),[T,I]=(0,n.useState)(!1),R=(0,d().K8)((()=>t.frozoneStore.state.frozenIndex),[t.frozoneStore]),{unfrozenIndexAddendum:j,frozenPropertyFormats:A,unfrozenPropertyFormats:P}=(0,d().K8)((()=>{const e=p;let t=[],o=e;const n=(0,L().qi)(R);return void 0!==R&&(t=e.slice(0,n),o=e.slice(n)),{unfrozenIndexAddendum:n,frozenPropertyFormats:t,unfrozenPropertyFormats:o}}),[R,p]),M=(0,d().O$)(t.isInHomeWidgetStore),B=(0,L().Oz)(t),V=(0,d().K8)((()=>{const e=M?void 0:(null==B?void 0:B.background)||(l?k.cardContentBackground:k.contentBackground);return{borderTop:`1px solid ${k.tableDividerColor}`,display:"flex",background:e,zIndex:85,fontSize:14,height:(0,_().sG)({isMobile:w})+(i&&!r?Ee().A.state:0),minWidth:"100%",clipPath:"polygon(0% -20%, 100% -20%, 100% 100%, 0% 100%)",left:0,boxSizing:"border-box",...g}}),[i,l,g,k,M,w,r,null==B?void 0:B.background]),F=(0,d().K8)((()=>void 0!==R&&(0,_().wy)({environment:C,collectionContextStore:t,isPhone:b,theme:k})),[R,C,t,b,k]),O=(0,d().K8)((()=>{var e;return((null==a||null===(e=a.aggregations)||void 0===e?void 0:e.length)??0)>0}),[null==a?void 0:a.aggregations]),E=(0,n.useCallback)((()=>{I(!0),null==v||v()}),[I,v]),D=(0,n.useCallback)((()=>{I(!1),null==y||y()}),[I,y]),z=(0,n.useCallback)((e=>{(0,Ce().SQ)({event:e,context:Ce().y$.EditorMouseDown,callback:()=>{}})}),[]),K=(0,u().IS)((()=>({stickyStyle:{paddingLeft:h,paddingRight:f,fontVariantNumeric:"lining-nums tabular-nums"},container:{display:"flex",paddingRight:!o&&m?32:0},innerContainer:{display:"flex"}})),[o,h,f,m]),H=(0,n.useCallback)(((e,n)=>(0,S.jsx)(Pd,{propertyFormat:e,groupFormat:r,disabled:o,mouseEntered:T,collectionContextStore:t,schema:c,query:a},e.property)),[t,o,r,T,a,c]),G=!M&&(O||i),W=(0,n.useRef)(null),N=(0,S.jsx)(nt().s,{allowSelectionWithin:!1,style:V,onMouseMove:E,onMouseLeave:D,onMouseDown:z,ref:W,children:(0,S.jsx)("div",{style:K.container,children:(0,S.jsxs)("div",{style:K.innerContainer,children:[void 0!==R&&(0,S.jsx)("div",{style:{...F,display:"flex"},children:A.map(H)}),P.map(((e,t)=>H(e,t+j)))]})})});return G?(0,S.jsx)(Ki().g,{stickyAttachPoint:x?"no-stick":"floor",stickyStyle:K.stickyStyle,nodeRef:W,children:N}):N})),Pd=n.memo((function(e){var t;let{propertyFormat:o,groupFormat:r,disabled:i,mouseEntered:l,collectionContextStore:a,query:c,schema:p}=e;const m=(0,s().v3)(),g=(0,u().IS)((()=>({wrapper:{display:"flex",width:o.width}})),[o.width]),h=(0,n.useCallback)(((e,t)=>{const o=a.collectionViewStore();if(!o)return;let n=c.aggregations?[...c.aggregations]:[];const r=(c.aggregations||[]).findIndex((t=>t.property===e));n=r<0?C().oE([...n,t]):C().oE(n.map(((e,o)=>r===o?t:e)));const i={...c,aggregations:n};!a.isClientModeEnabledStore.state&&t&&a.asyncAggregationStatusStore.setState({calculating:!0,aggregation:t,changingType:!0}),B().createAndCommit({userAction:"TableAggregationRow.handleTableAggregationChange",environment:m,canUndo:!0,perform:e=>{(0,ri().F)({collectionViewStore:o,update:{query2:i},transaction:e})}})}),[a,c,m]),f=(0,d().K8)((()=>!i&&!!l),[l,i]);return(0,S.jsx)("div",{style:g.wrapper,children:(0,S.jsx)(Id,{groupFormat:r,propertyFormat:o,disabled:i,isHovered:f,aggregation:null===(t=c.aggregations)||void 0===t?void 0:t.find((e=>e.property===o.property)),property:o.property,collectionContextStore:a,schema:p,onChange:h})})})),Md=n.memo(n.forwardRef((function(e,t){const{collectionContextStore:o,handleAddRowClick:r,numberOfBlankRows:i,isBlockPropertyValueOverlayOpen:l,hideDefaultButtonText:a}=e,{isMobile:c}=(0,s().Y0)(),[p,m]=(0,n.useState)(0),g=(0,d().O$)(o.isInHomeWidgetStore),h=(0,u().IS)((e=>{const t=g?e.tableHomeDividerColor:e.tableDividerColor,{button:o,buttonInner:n,icon:r}=(0,_().BJ)({theme:e,isMobile:c,hideTextWithTransition:a,hideTextWithoutTransition:l});return{button:{...o,transition:"background 0.2s ease",borderBottom:`1px solid ${t}`},buttonInner:n,icon:r}}),[g,c,a,l]);return(0,S.jsxs)("div",{onMouseLeave:()=>m(0),ref:t,children:[(0,S.jsx)(Rt().A,{className:he().$0P,onClick:r,onMouseDown:Ce().tr,style:h.button,onMouseEnter:()=>m(0),children:(0,S.jsxs)("span",{style:{...h.buttonInner,opacity:0!==p||a?0:1},children:[(0,uo().W)(h.icon),(0,S.jsx)(Bn,{collectionContextStore:o})]})},"add-row-button-default"),Array.from({length:i}).map(((e,t)=>{const n=t+1,l=n===i,s=p===n?1:0;return(0,S.jsx)(Rt().A,{className:he().Mbm,onClick:r,onMouseDown:Ce().tr,style:{...h.button,...l&&{borderBottom:"none"}},onMouseEnter:()=>m(n),children:(0,S.jsxs)("span",{style:{...h.buttonInner,opacity:s},children:[(0,uo().W)(h.icon),(0,S.jsx)(Bn,{collectionContextStore:o})]})},n)}))]})}))),Bd={viewBox:"0 0 16 16",svg:(0,S.jsx)("path",{d:"M2.4 3.7a.7.7 0 1 0 0 1.4h11.2a.7.7 0 1 0 0-1.4zm9.5 3.594H4.1a.7.7 0 1 0 0 1.4h7.8a.7.7 0 1 0 0-1.4M5.8 10.9a.7.7 0 1 0 0 1.4h4.4a.7.7 0 1 0 0-1.4z"})},_d=(0,g().wt)("filterSmall",Bd);var Vd=()=>o(914701);const Fd=n.memo((function(e){const{collectionContextStore:t,handleAddRowClick:o,hasFilter:n,hasMultipleGroups:r,shouldShowAddRowButton:i}=e,l=(0,Ae().X)("db_ux_empty_states"),{isMobile:a}=(0,s().Y0)(),c=(0,d().O$)(t.isInHomeWidgetStore),p=(0,u().IS)((e=>{const t=c?e.tableHomeDividerColor:e.tableDividerColor,{button:o,buttonInner:n}=(0,_().BJ)({theme:e,isMobile:a});return{button:{...o,borderBottom:`1px solid ${t}`},buttonInner:n}}),[c,a]);return l&&n?(0,S.jsx)(Ld,{collectionContextStore:t,handleAddRowClick:o,hasMultipleGroups:r}):(0,S.jsx)(Rt().A,{className:he().Mbm,onClick:o,onMouseDown:Ce().tr,disabled:!i,style:p.button,children:i?(0,S.jsx)("span",{style:p.buttonInner,children:n?(0,S.jsx)(k().sA,{defaultMessage:"No filter results. Click to add a row.",id:"database.tableView.emptyTablePlaceholderWithFilters"}):(0,S.jsx)(k().sA,{defaultMessage:"Empty. Click to add a row.",id:"database.tableView.emptyTablePlaceholder"})}):(0,S.jsx)("span",{style:p.buttonInner,children:n?(0,S.jsx)(k().sA,{defaultMessage:"No filter results.",id:"database.tableView.cannotEdit.emptyTablePlaceholderWithFilters"}):(0,S.jsx)(k().sA,{defaultMessage:"Empty.",id:"database.tableView.cannotEdit.emptyTablePlaceholder"})})})})),Ld=n.memo((function(e){const{collectionContextStore:t,handleAddRowClick:o,hasMultipleGroups:r}=e,i=(0,s().v3)(),{isMobile:l}=(0,s().Y0)(),a=(0,n.useCallback)((()=>{var e;const o=null===(e=t.collectionViewStore())||void 0===e?void 0:e.id;o&&((0,Vd().E)({userId:i.currentUser.id,collectionViewId:o,isOpen:!0}),t.filtersBarOpenStore.setState(!0))}),[t,i]),c=(0,u().IS)((e=>{const{buttonInner:t}=(0,_().BJ)({theme:e,isMobile:l});return{container:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:l?r?108:216:r?72:144,gap:4},iconStyle:{width:16,fill:t.color},buttonInner:t,menuButton:{width:"auto",color:"inherit"}}}),[r,l]),d=(0,n.useCallback)((e=>(0,S.jsx)(rt().p,{...e,icon:_d,iconStyle:c.iconStyle,children:(0,S.jsx)("span",{style:c.buttonInner,children:(0,S.jsx)(k().sA,{defaultMessage:"No filter results",id:"database.tableView.cannotEdit.emptyTablePlaceholderWithFiltersNew"})})})),[c]),p=(0,n.useCallback)((e=>(0,S.jsx)(ai().A,{menuType:li().gu.Popup,children:(0,S.jsx)(ci().Ay,{initialFocus:0,type:ci().Oh.Vertical,sections:[{key:"empty-filter-results",render:e=>(0,S.jsx)(ui().A,{...e,hideTitle:!0}),items:[{key:"edit-filter",render:t=>(0,S.jsx)(Ii().A,{...t,title:(0,S.jsx)(k().sA,{defaultMessage:"Edit filter",id:"database.tableView.emptyTablePlaceholderWithFilters.editFilter"}),icon:(0,S.jsx)(pr().I,{icon:ur,size:"sm"}),buttonStyle:{...c.menuButton,marginTop:4},onClick:()=>{a(),e.close()}}),action:()=>{}},{key:"add-row",render:e=>(0,S.jsx)(Ii().A,{...e,title:(0,S.jsx)(k().sA,{defaultMessage:"Create a new page",id:"database.tableView.emptyTablePlaceholderWithFilters.addRow"}),icon:(0,S.jsx)(pr().I,{icon:$r().plusSmallIcon,size:"sm"}),buttonStyle:{...c.menuButton,marginBottom:4},onClick:o}),action:()=>{}}]}]})})),[o,a,c.menuButton]);return(0,S.jsx)("div",{style:c.container,className:he().Mbm,children:(0,S.jsx)(Ri().Ay,{popupType:Ri().z7.Popup,placementToOrigin:Ri().sx.Top,alignmentToOrigin:Ri().yP.Center,renderOrigin:d,render:p})})}));var Od=()=>o(404779);const Ed=n.memo((function(e){const{collectionContextStore:t}=e,r=(0,s().v3)(),i=(0,u().IS)((e=>({button:{display:"flex",justifyContent:"flex-start",width:32},icon:{width:12,fill:e.mediumIconColor}})),[]),l=(0,n.useCallback)((()=>{t.collectionStore()&&(M().clear({environment:r}),P().IU({environment:r}),(0,Od().y)(),(0,T().X)({environment:r,collectionContextStore:t,action:"click_new_property"}),I().R8({collectionSettingsStore:t.settingsStore,item:{type:"propertyType",onAccept:(e,n,i,l)=>{o(36629).nZ({environment:r,collectionContextStore:t,propertyType:e,isSuggestedProperty:n,propertyName:i,selectOptions:l,from:"table"})}}}))}),[t,r]);return(0,S.jsx)(Rt().A,{className:he().LcC,style:i.button,onMouseDown:bd,onClick:l,children:(0,S.jsx)("div",{style:Cd,children:(0,uo().W)(i.icon)})})}));function Dd(e){let{collectionContextStore:t}=e;const o=(0,s().v3)(),r=(0,u().IS)((e=>({dotsIcon:{width:12,fill:e.mediumIconColor},button:{display:"flex",justifyContent:"flex-start",flexGrow:1,width:32}})),[]),i=(0,n.useCallback)((()=>{I().Ow({collectionContextStore:t,collectionSettingsStore:t.settingsStore}),(0,T().X)({environment:o,collectionContextStore:t,action:"click_table_header_dot_menu"}),I().a2({collectionSettingsStore:t.settingsStore,item:{type:"properties",timelineViewTab:"timeline"}})}),[t,o]);return(0,S.jsx)(Rt().A,{style:r.button,onMouseDown:bd,onClick:i,className:he().LcC,children:(0,S.jsx)("div",{style:Cd,children:(0,Nr()._)(r.dotsIcon)})})}var zd=()=>o(444570),Kd=()=>o(871399);const Hd=2,Gd=3;function Wd(e){const{isCollectionViewBlockSelected:t,passesFilter:o,isScrolled:r,isCheckbox:i,isShimmerRow:l}=e,s=(0,n.useCallback)((e=>"dark"===e.mode?"transparent":o&&!t?`linear-gradient(to right, ${(0,Na().X4)(Pn().CM[e.mode].gray,.15)},${(0,Na().X4)(Pn().CM[e.mode].gray,.1)},  transparent)`:`linear-gradient(to right, ${(0,Na().X4)(Pn().CM[e.mode].gray,.35)},${(0,Na().X4)(Pn().CM[e.mode].gray,.2)},  transparent)`),[o,t]),a=(0,u().IS)((e=>({border:{position:"absolute",right:0,width:Hd,height:l?35:"100%",background:o&&!t||"dark"===e.mode?e.tableDividerColor:e.tableFrozenFilterDividerColor},shadow:{position:"absolute",top:0,right:-Gd,width:Gd,height:l?34:"100%",background:s(e)}})),[l,o,t,s]);return(0,S.jsxs)("div",{style:{display:"flex",flexDirection:"row",height:"100%"},children:[i?null:(0,S.jsx)("div",{style:a.border}),(0,S.jsx)(It().A,{visible:!0,animate:{opacity:r?1:0},children:(0,S.jsx)("div",{style:a.shadow})})]})}function Nd(e){const{checkedState:t,onClick:o,checkboxType:r,collectionContextStore:i,isBlockHovered:l,passesFilter:a,disabled:c,frozoneProps:p}=e,m=(0,s().v3)(),g=(0,d().uB)(void 0,ht().A),h=(0,zd().Jj)(),f=(0,d().K8)((()=>h&&Kd().default.state.isOpen&&Kd().default.state.isPlusButtonVisible),[h]),v=(0,d().K8)((()=>g.state.mouseEntered),[g]),y=(0,n.useRef)(null);(0,n.useEffect)((()=>{y.current&&(y.current.indeterminate="indeterminate"===t)}),[t]);const x=(0,d().K8)((()=>To().Ay.state.isDragging),[]),C=(0,n.useCallback)((e=>{if(c)return;o(e);const t=(0,fe().sl)(i)||{};ge().vd(m,"collection_multi_select_checkbox_clicked",{...t,checkbox_type:r})}),[c,r,i,m,o]),b=(0,d().K8)((()=>f?0:!1===t&&!v||x?l?.6:null!=p&&p.shouldShowStickyMultiSelectColumn?.4:0:1),[t,v,x,l,null==p?void 0:p.shouldShowStickyMultiSelectColumn,f]),w=(0,u().IS)((e=>({multiSelectCheckbox:{background:null!=p&&p.isScrolled?null==p?void 0:p.frozenStyles.background:void 0,borderBottom:e.tableDividerColor,height:"100%"},multiSelectCheckboxInner:{background:null!=p&&p.isCollectionViewBlockSelected?Pn().Ay.blueWithAlpha(.14):void 0,height:"100%"},checkBoxInput:{width:Ut().S8,height:Ut().S8,cursor:c?void 0:"pointer",accentColor:e.fill.uiBlue,position:"relative",right:2}})),[c,null==p?void 0:p.frozenStyles.background,null==p?void 0:p.isCollectionViewBlockSelected,null==p?void 0:p.isScrolled]),k=null!=p&&p.shouldShowStickyMultiSelectColumn?b>0?1:0:b;return(0,S.jsxs)(It().A,{animate:{opacity:k},style:w.multiSelectCheckbox,onMouseEnter:()=>g.enter(),onMouseLeave:()=>g.exit(),children:[(0,S.jsx)("div",{style:w.multiSelectCheckboxInner,children:(0,S.jsx)("label",{style:{height:"100%",alignItems:"flex-start",justifyContent:"center",display:"flex",cursor:c?void 0:"pointer",zIndex:1},onClick:Ce().kV,onMouseDown:Ce().tr,children:(0,S.jsx)("div",{style:{width:`${Ut().tG}px`,height:`${Ut().tG}px`,display:"flex",justifyContent:"center",alignItems:"center"},children:(0,S.jsx)("input",{type:"checkbox",style:w.checkBoxInput,ref:y,checked:!0===t,onChange:C,disabled:c})})})}),(null==p?void 0:p.shouldFreezeMultiSelectColumn)&&(0,S.jsx)(Wd,{isCollectionViewBlockSelected:null==p?void 0:p.isCollectionViewBlockSelected,passesFilter:a,isCheckbox:!0,isScrolled:!0})]})}function $d(e){const{groupsPointer:t,collectionContextStore:o,hasMoreReducerResults:r,frozoneProps:i}=e,l=(0,s().v3)(),a=(0,n.useCallback)((()=>(0,te().v2)(t[0],o).filter((e=>e.canEdit()))),[o,t]),c=(0,d().K8)((()=>0===a().length),[a]),{checkedState:p,allVisibleItemsChecked:m}=(0,d().K8)((()=>{const e=a(),t=e.length;if(0===t)return{checkedState:!1,allVisibleItemsChecked:!0};const o=ie().default.state.stores.filter((t=>e.includes(t))).length;let n;return n=0!==o&&(o===t&&!r||"indeterminate"),{checkedState:n,allVisibleItemsChecked:o===t}}),[a,r]),g=(0,n.useCallback)((e=>{var t;const n=a(),r=ie().default.state.stores,i=(0,_().ut)({collectionViewBlockId:null===(t=o.collectionViewBlockStore())||void 0===t?void 0:t.id})?[]:r;!1===p||"indeterminate"===p&&!m?P().td({environment:l,stores:C().KC(i,n)}):(!0===p||"indeterminate"===p&&m)&&P().td({environment:l,stores:C().FF(i,...n)}),e.stopPropagation(),e.preventDefault()}),[p,o,l,a,m]),h=(0,d().K8)((()=>(0,L().f5)({environment:l,collectionContextStore:o})),[l,o]),f=(0,u().IS)((()=>({wrapper:{...null==i?void 0:i.frozenStyles,...-1===(null==i?void 0:i.frozenIndex)&&{background:void 0}},checkboxContainer:h?{position:"absolute",left:-Ut().Fh,background:-1===(null==i?void 0:i.frozenIndex)||null==i?void 0:i.frozenStyles.background}:{display:"contents"}})),[null==i?void 0:i.frozenIndex,null==i?void 0:i.frozenStyles,h]);return(0,S.jsx)("div",{style:f.wrapper,children:(0,S.jsx)("div",{style:f.checkboxContainer,children:(0,S.jsx)(Nd,{passesFilter:!0,checkedState:p,onClick:g,checkboxType:"group",collectionContextStore:o,frozoneProps:i?{...i,isCollectionViewBlockSelected:!1}:void 0,disabled:c})})})}var Ud=()=>o(37250),qd=()=>o(285176),Yd=()=>o(782473);function Xd(e){const{origin:t,propertyType:o}=e,n=(0,s().v3)();return(0,S.jsx)(Vc().k,{origin:t,placementToOrigin:"bottom",header:function(){switch(o){case"owner":return(0,S.jsx)(k().sA,{id:"WikiPropertiesOnboardingTooltip.header.ownerProperty",defaultMessage:"Owner"});case"verification":return(0,S.jsx)(k().sA,{id:"WikiPropertiesOnboardingTooltip.header.verificationProperty",defaultMessage:"Verification"});case"tags":return(0,S.jsx)(k().sA,{id:"WikiPropertiesOnboardingTooltip.header.tagsProperty",defaultMessage:"Add tags and more"});default:(0,b().HB)(o)}}(),content:function(){switch(o){case"owner":return(0,S.jsx)(k().sA,{defaultMessage:"Owners are responsible for keeping the page updated. By default, the owner is the page creator",id:"WikiPropertiesOnboardingTooltip.content.ownerProperty",values:{bold:e=>(0,S.jsx)("span",{style:{fontWeight:w().Wy.semibold},children:e})}});case"verification":return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(k().sA,{defaultMessage:"Page owners can mark a page as verified or expired, to help viewers understand whether they can trust the content",id:"WikiPropertiesOnboardingTooltip.content.verificationProperty"}),(0,S.jsx)(qd().o,{href:(0,Yt().xS)("guides.wikis"),style:{color:Pn().Ay.uiLightGray}})]});case"tags":return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(k().sA,{defaultMessage:"Customize your wiki with tags or other database properties",id:"WikiPropertiesOnboardingTooltip.content.tagsProperty"}),(0,S.jsx)(qd().o,{href:(0,Yt().xS)("guides.databaseProperties"),style:{color:Pn().Ay.uiLightGray}})]});default:(0,b().HB)(o)}}(),numSteps:3,currStepIndex:function(){switch(o){case"owner":return 0;case"verification":return 1;case"tags":return 2;default:(0,b().HB)(o)}}(),onCloseClick:()=>{Ud().ZP(n)},onPrimaryButtonClick:()=>Ud().A6(n),onBackButtonClick:()=>Ud().Jz(n),enableMouseCapture:!0,shouldDismissUponOutsideClick:!0,pointerLength:Yd().gO,pointerOffset:Yd().j$,style:{width:Yd().Sw}})}var Qd=()=>o(790748),Zd=()=>o(912720);const Jd=new(ne().O2)("TableHeaderCellMenu",(()=>Promise.all([o.e(23806),o.e(63077),o.e(95794),o.e(46414),o.e(8184),o.e(28271),o.e(17254),o.e(47779)]).then(o.bind(o,79024)))),eu=(0,ne()._h)(Jd,(e=>e.TableHeaderCellMenu));var tu=()=>o(840094),ou=()=>o(913687),nu=()=>o(452862),ru=()=>o(964447),iu=()=>o(673730),lu=()=>o(806401),su=()=>o(377586);const au=(0,k().YK)({relation:{defaultMessage:"This relation links to another workspace. Cross-workspace features are limited, so syncing may break and filtering, sorting, and search will not work.",id:"collection.tableHeaderCell.crossSpaceRelationError.message"},formula:{defaultMessage:"This formula links to another workspace. Cross-workspace features are limited, so syncing may break and filtering, sorting, and search will not work.",id:"collection.tableHeaderCell.crossSpaceFormulaError.message"},linkedView:{defaultMessage:"This view references content from another workspace. Cross-workspace functionality is limited, so some content may not sync correctly.",id:"collection.tableHeaderCell.crossSpaceLinkedViewError.message"}}),cu=n.memo((function(e){let{type:t}=e;const r=(0,s().v3)(),i=(0,k().tz)(),l=(0,n.useRef)(null),a=(0,u().IS)((e=>({icon:{fill:e.icon.orangePrimary},text:{width:300,color:e.text.secondary,padding:"12px 16px",fontSize:14},footer:{display:"flex",flexDirection:"row",justifyContent:"space-between",borderTop:`1px solid ${e.stroke.secondary}`},button:{width:"auto"},dismissButton:{color:e.text.uiBluePrimary},learnMoreButton:{color:e.text.secondary},learnMoreIcon:{width:14,height:14,marginRight:0}})),[]),c=(0,Yt().xS)("guides.duplicateToSpace"),d=(0,n.useCallback)((()=>(0,S.jsxs)(ai().A,{menuType:li().gu.Popup,children:[(0,S.jsx)(ui().A,{style:a.text,children:i.formatMessage(au[t])}),(0,S.jsx)(ci().Ay,{type:ci().Oh.Vertical,initialFocus:void 0,sections:[{key:"footer",items:[{key:"dismiss",action:()=>{var e;null===(e=l.current)||void 0===e||e.setOpen(!1)},render:e=>(0,S.jsx)(Ii().A,{...e,title:(0,S.jsx)(k().sA,{defaultMessage:"Dismiss",id:"collection.tableHeaderCell.crossSpaceRelationError.dismiss"}),buttonStyle:{...a.button,...a.dismissButton}})},{key:"learn-more",action:e=>{var t,o,n;null===(t=(o=e.event).preventDefault)||void 0===t||t.call(o),null===(n=l.current)||void 0===n||n.setOpen(!1),$n().oo({environment:r,url:c,openInNew:"tab"})},render:e=>(0,S.jsx)(Ii().A,{...e,title:(0,S.jsx)(k().sA,{defaultMessage:"Learn more",id:"collection.tableHeaderCell.crossSpaceRelationError.learnMore"}),icon:(0,o(133033).$)(),desktopIconStyle:a.learnMoreIcon,buttonStyle:{...a.button,...a.learnMoreButton},href:c,external:!0})}],render:e=>(0,S.jsx)(ui().A,{...e,style:a.footer})}]})]})),[a,i,r,c,t]),p=(0,n.useCallback)((e=>(0,S.jsx)(jt().A,{icon:yr().Q,iconStyle:a.icon,ariaLabel:i.formatMessage(au[t]),...e})),[a,i,t]);return(0,S.jsx)(Ri().Ay,{popupType:su().n.Popup,render:d,renderOrigin:p,ref:l})})),du=n.memo((function(e){const{allowHidingTitle:t,collectionContextStore:r,columnIndex:i,disableCellRightBorder:l,disabled:a,format:c,formatKey:p,isLast:m,paddingTop:g,property:h,renderSpacer:f,schema:v,width:y,collectionViewBlockStore:x}=e,C=(0,n.useRef)(null);(0,Qd().b)(o(344482).A,(()=>({collectionContextStore:r,property:h,getNode:()=>C.current})),[r,h]);const w=(0,s().v3)(),{isMobile:k}=(0,s().Y0)(),{value:T}=(0,ne().fJ)(me().T.formulas),{value:I}=(0,ne().fJ)(me().T.formulaConstants),{value:R}=(0,ne().fJ)(me().T.formulaPermissions),[j,A]=(0,n.useState)(!1),B=(0,d().O$)(r.permissionScopesStore),_=(0,d().uB)(void 0,Oe().A),V=(0,d().K8)((()=>o(792415).A.state.publicPageData),[]),{isRightMostFrozenColumn:F,isScrolled:L}=(0,d().K8)((()=>{const{frozenIndex:e,isScrolled:t}=r.frozoneStore.state;return{isRightMostFrozenColumn:e===i,isScrolled:t}}),[r.frozoneStore,i]),O=v[h],E=(0,d().K8)((()=>{var e;if("relation"!==(null==O?void 0:O.type))return!1;const t=null===(e=r.collectionStore())||void 0===e?void 0:e.getSpaceId();return(0,co().o2)(t,O)}),[r,O]),[{value:D}]=(0,$o().Yb)((async()=>{var e;if("formula"!==(null==O?void 0:O.type))return!1;const t=r.collectionStore(),n=null===(e=r.collectionStore())||void 0===e?void 0:e.pointer;if(!(t&&n&&T&&I&&R))return!1;const i=(0,wo().i)(),l=(0,o(502856).MC)({collectionFeatureGates:i,experimentService:Io().default,getRecordModel:t.getRecordModel,loadRecordModel:t.loadRecordModel}),s={type:"block",collection:n},a={kind:I.FormulaContextValueKind.ThisRow,type:s},c={sourceProperty:h,valueTypes:[a],handleDataRequest:l,publicPageDataCollection:{id:null==V?void 0:V.collectionId,schema:null==V?void 0:V.collectionSchema},spaceId:t.getSpaceId(),featureGates:i};return!(await R.hasAccessToProperty({collectionPointer:n,collectionSchema:v,context:c,propertyId:h,hasAccessFn:R.hasSameSpaceAccess}))}),[r,O,h,v,T,I,R,V]),z=(0,Ae().X)("collections_xws"),K=E&&z,H=D&&z,G=(0,lu().D)(O),W=(0,n.useCallback)((()=>{M().clear({environment:w}),P().IU({environment:w}),(0,Od().y)()}),[w]),N=(0,n.useCallback)((e=>{k||(e.preventDefault(),(0,Ce().SQ)({event:e,context:Ce().y$.EditorContextMenu,callback:()=>{W(),_.setState({open:!0})}}))}),[k,W,_]),$=(0,n.useCallback)((e=>{A(e)}),[A]),U=(0,u().IS)((e=>({container:{display:"flex",flexShrink:0,overflow:"hidden",fontSize:14,padding:0,width:y,borderRight:l?void 0:`1px solid ${e.tableDividerColor}`},button:{display:"flex",alignItems:"center",width:"100%",height:"100%",paddingLeft:8,paddingRight:8,paddingTop:g},property:{fontSize:14,flex:"1 1 auto"},enabledIcon:{width:20,height:20,marginLeft:4}})),[y,l,g]),q=(0,n.useCallback)((e=>O?(0,S.jsx)(uu,{propertySchema:O,tooltipEvents:e,propertyId:h,collectionViewBlockStore:x}):null),[O,h,x]),Y=(0,n.useCallback)(((e,t)=>{var n;return O?(0,S.jsxs)(Rt().A,{style:U.button,disabled:a,...(0,Ci().A)(e,t),children:[f&&f(m),(0,S.jsx)(Pt().Ay,{propertySchema:O,showIcon:!0,badge:(0,S.jsxs)(S.Fragment,{children:["relation"===O.type&&G&&(0,S.jsx)(nu().z,{style:U.enabledIcon}),"button"===O.type&&(0,b().O9)(O.automation_id)&&(0,S.jsx)(gu,{propertyId:h,propertySchema:O,automationId:O.automation_id,collectionViewBlockStore:x}),!(null===(n=O.description)||void 0===n||!n.length)&&!k&&(0,S.jsx)(o(769068).g,{setIsHovered:$}),(0,S.jsx)(Pt().Jv,{propertySchema:O})]}),style:U.property,property:h}),K&&(0,S.jsx)(cu,{type:"relation"}),H&&(0,S.jsx)(cu,{type:"formula"}),F&&(0,S.jsx)(Wd,{isCollectionViewBlockSelected:!1,passesFilter:!0,isScrolled:Boolean(L)})]}):null}),[O,U.button,U.enabledIcon,U.property,a,f,m,G,h,x,k,$,K,H,F,L]),X=(0,n.useCallback)((e=>O?(0,S.jsx)(At().A,{disableTooltip:K||H,delayThreshold:j?0:500,placement:Fe().W.Right,renderTooltip:q,render:t=>Y(t,e)}):null),[O,K,H,q,j,Y]),Q=(0,n.useCallback)((e=>(0,S.jsx)(eu,{allowHidingTitle:t,collectionContextStore:r,columnIndex:i,format:c,formatKey:p,parent:e,property:h,schema:v})),[t,r,i,c,p,h,v]);return O?(0,S.jsxs)("div",{ref:C,style:U.container,className:he().P2l,onContextMenu:N,children:[(0,S.jsx)(ru().dT,{origin:C,store:r}),(0,S.jsx)(Ri().Ay,{popupType:k?aa().nl.BottomSheet:aa().nl.Popup,bottomSheetInitialState:"half",disabled:!B.canConfigureBlock,originGap:1,alignmentToOrigin:Ri().yP.Start,buttonPopupStore:_,renderOrigin:X,render:Q,onClick:W})]}):null}));function uu(e){const{propertyId:t,propertySchema:o,tooltipEvents:n,collectionViewBlockStore:r}=e,i=(0,u().IS)((e=>({description:{color:e.text.contrastSecondary},sharingEnabledTooltip:{marginTop:8,color:e.text.contrastSecondary},aiUpdate:{color:e.text.contrastSecondary}})),[]),l=(0,d().K8)((()=>(0,co().$M)(o)&&(0,co().om)(o)),[o]),s=(0,lu().D)(o),a=(0,d().K8)((()=>r.getCollectionStore()),[r]);return(0,S.jsxs)("div",{...n,style:iu().Q$,children:[(0,S.jsx)("div",{children:o.name}),void 0!==(null==o?void 0:o.description)&&o.description.length>0?(0,S.jsx)("div",{style:i.description,children:o.description}):null,a&&"relation"===o.type&&s&&(0,S.jsx)(nu().F,{propertySchema:o,collectionStore:a,style:i.sharingEnabledTooltip}),l&&l.auto_update_on_edit&&(0,S.jsx)("div",{style:i.aiUpdate,children:(0,S.jsx)(k().sA,{...ou().A.keptUpToDateWithNotionAITooltip})}),"button"===o.type&&(0,b().O9)(o.automation_id)&&(0,S.jsx)(mu,{propertyId:t,propertySchema:o,automationId:o.automation_id,collectionViewBlockStore:r})]})}function pu(e){const{automationId:t,collectionViewBlockStore:o,propertyId:n,propertySchema:r,collectionContextStore:i}=e,l=(0,d().K8)((()=>o.getSpaceId()),[o]),s=re().dn.createChildStore(o,{id:t,table:Zd().yB,spaceId:l});return(0,tu().cN)({automationStore:s,propertyId:n,propertySchema:r,collectionContextStore:i})}function mu(e){const{automationId:t,collectionViewBlockStore:o,propertyId:n,propertySchema:r}=e,i=(0,u().IS)((e=>({wrap:{color:e.text.contrastSecondary}})),[]);return pu({automationId:t,collectionViewBlockStore:o,propertyId:n,propertySchema:r,collectionContextStore:(0,Z().ET)()})?(0,S.jsx)("div",{style:i.wrap,children:(0,S.jsx)(k().sA,{...ou().A.buttonPropertyErrorTooltip})}):null}function gu(e){const{automationId:t,collectionViewBlockStore:o,propertyId:n,propertySchema:r}=e,i=(0,u().IS)((e=>({icon:{width:14,height:14,marginLeft:5,fill:e.mediumIconColor}})),[]);return pu({automationId:t,collectionViewBlockStore:o,propertyId:n,propertySchema:r,collectionContextStore:(0,Z().ET)()})?(0,yr().Q)(i.icon):null}var Su=()=>o(708685);const hu={position:"absolute",right:0,width:0,flexGrow:0,zIndex:1},fu=n.memo((function(e){let{leftFormat:t,height:r,onTemporaryResize:i,onAccept:l,onCancel:a,propertySchema:c,resultStore:d}=e;const u=(0,n.useRef)(void 0),{isPhone:p}=(0,s().Y0)(),[m,g]=(0,n.useState)(!1),[h,f]=(0,n.useState)(!1),v=!p&&(h||m),y=(0,n.useCallback)((e=>{const o=u.current;if(!o||!o.width)return;const n=Math.max(o.width+e.diffX,Cu(c,t,o.width,e.optionKey));return{...o,width:n}}),[t,c]),x=(0,n.useCallback)((e=>{e.preventDefault(),u.current=t,f(!0)}),[t]),b=(0,n.useCallback)((e=>{const t=y(e);t&&i(t)}),[y,i]),w=(0,n.useCallback)((e=>{const t=y(e);t&&l(t),f(!1)}),[y,l]),k=(0,n.useCallback)((()=>{a(),u.current=void 0,f(!1)}),[a]),T=(0,n.useCallback)((e=>{const n=d.state?d.state.blockIds:[],r=C().oE(n.map((e=>{const n=o(57618).A.findBlockPropertyValueByBlockId(e,t.property),r=null==n?void 0:n.getNode();if(r)return function(e){const t=e.cloneNode(!0);let o=!1;"relative"===(null==e?void 0:e.style.position)&&(e.style.position="unset",o=!0);const n=getComputedStyle(e);for(let l=0;l<n.length;l++){const e=n[l],o=n.getPropertyValue(e);t.style[e]=o}o&&(e.style.position="relative");t.id="notion-table-view-cell-shadow",t.style.top="0px",t.style.left="0px",t.style.pointerEvents="none",t.style.width="auto",t.style.opacity="0",t.style.display="flex",t.style.position="absolute";const r=t.querySelectorAll("*");for(const l of r)l.style&&(l.style.pointerEvents="none",l.style.width="auto");document.body.appendChild(t);const i=t.getBoundingClientRect();return t.remove(),null!=i&&i.width?Math.ceil(i.width)+1:void 0}(r)})));if(t.width){const e={...t,width:Math.min(800,Math.max(Math.max(...r),Cu(c,t,t.width)))};l(e)}}),[t,l,c,d]),I=(0,n.useCallback)((e=>(0,S.jsx)("div",{style:v?wu(r):bu(r),onDoubleClick:T,...e})),[T,r,v]);return(0,S.jsx)("div",{style:hu,onMouseMove:()=>g(!0),onMouseLeave:()=>g(!1),children:(0,S.jsx)(ec().A,{onDraggableDragStart:x,onDraggableDragMove:b,onDraggableDragEnd:w,onDraggableDragCancel:k,disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,render:I})})}));const vu=32,yu=64,xu=100;function Cu(e,t,o){if(arguments.length>3&&void 0!==arguments[3]&&arguments[3])return vu;const n=function(e,t){var o;if("checkbox"===(null==e?void 0:e.type))return vu;if("status"===(null==e?void 0:e.type)&&"checkbox"===t.statusShowAs)return vu;if(("number"===(null==e?void 0:e.type)||"formula"===(null==e?void 0:e.type)&&"number"===(0,Su().getFormulaPropertySchemaResultType)(e))&&"ring"===(null==e||null===(o=e.show_as)||void 0===o?void 0:o.type))return vu;if("auto_increment_id"===(null==e?void 0:e.type))return yu;return xu}(e,t);return o&&o<n?vu:n}function bu(e){return{width:5,marginLeft:-3,marginTop:-1,height:e,transition:"background 200ms ease-out",background:Pn().Ay.blueWithAlpha(0),cursor:"col-resize"}}function wu(e){return{...bu(e),background:Pn().Ay.blueWithAlpha(.8)}}const ku=n.memo((function(e){let{store:t,collectionContextStore:r,schema:i,query:l,disabled:a,formatKey:c,disableCellRightBorder:p,renderSpacer:m,allowHidingTitle:g,paddingTop:h,showRightActions:f,showPropertyFormats:v,resultStore:y,format:x,tableStore:C,height:b,groupsPointer:w,property:k,index:I,isLast:R}=e;const j=(0,s().v3)(),{isMobile:A,isPhone:P}=(0,s().Y0)(),M=(0,n.useRef)(null),V=(0,d().K8)((()=>C.getCurrentFormat(x)),[x,C]),F=v[I],{wikiOnboardingPhase:L,showWikiTooltip:O}=(0,d().K8)((()=>{var e,n,l,s;const a=Ud().WH(),c="notion://wiki_collection"===(null===(e=r.collectionStore())||void 0===e?void 0:e.getFormatStore().getKeyStore("app_config_uri").getValue())&&t.isCollectionViewPageWithContent()&&t.id===(null===(n=r.collectionViewBlockStore())||void 0===n?void 0:n.id),d=c&&("notion://wiki/owner_property"===k||k===o(931075)._e.Owner)&&"owner"===a,u=c&&"verification"===(null===(l=i[k])||void 0===l?void 0:l.type)&&"verification"===a,p=c&&"multi_select"===(null===(s=i[k])||void 0===s?void 0:s.type)&&"tags"===a;return{wikiOnboardingPhase:a,showWikiTooltip:!A&&(d||u||p)}}),[r,A,k,i,t]),E=(0,d().K8)((()=>p||R&&!wd(a,f)),[p,a,R,f]),D=(0,d().K8)((()=>(0,_().oe)({environment:j,propertyFormat:F})),[j,F]),z=(0,n.useCallback)((e=>{const t=C.getCurrentFormat(V),o=C.getCurrentProperties(c,t).map((t=>t.property===e.property?e:t)),n={...t,[c]:o};C.setState({...C.state,temporaryFormat:n})}),[C,c,V]),K=(0,n.useCallback)((e=>{const t=r.collectionViewStore();if(!t)return;const o=C.getCurrentFormat(V),n=C.getCurrentProperties(c,V).map((t=>t.property===e.property?e:t)),i={...o,[c]:n};B().createAndCommit({userAction:"TableHeaderRow.handleColumnResizeAccept",environment:j,canUndo:!0,perform:e=>{(0,ri().F)({collectionViewStore:t,update:{format:i},transaction:e})}}),C.setState({...C.state,temporaryFormat:void 0}),(0,T().X)({environment:j,collectionContextStore:r,action:"table_resize_columns"})}),[r,j,V,c,C]),H=(0,n.useCallback)((()=>{C.setState({...C.state,temporaryFormat:void 0})}),[C]),G=(0,u().IS)((()=>({container:{display:"flex",position:"relative"}})),[]);return(0,S.jsxs)("div",{style:G.container,ref:O?M:null,children:[O&&(0,S.jsx)(Xd,{origin:M,propertyType:L}),F&&D&&(0,S.jsx)(du,{format:V,schema:i,query:l,property:k,width:D,collectionViewBlockStore:t,collectionContextStore:r,disabled:a,formatKey:c,isLast:R,disableCellRightBorder:E,allowHidingTitle:g,renderSpacer:m,paddingTop:h,columnIndex:I,groupsPointer:w}),!a&&!P&&(0,S.jsx)(fu,{leftFormat:F,onTemporaryResize:z,onAccept:K,onCancel:H,height:b,propertySchema:i[k],resultStore:y})]},k)})),Tu=p().default.createClass(void 0,{name:"ReducerResultStore"}),Iu=n.memo((function(e){let{allowHidingTitle:t,children:o,collectionContextStore:r,disableCellRightBorder:i,disabled:l,disableHorizontalEdgeScroll:a,disableTopBorder:c,format:p,formatKey:m,frozoneProps:g,groupFormat:h,hasMoreReducerResults:f,height:v,isInHomeWidget:y,isInPeekRenderer:x,minWidth:C,paddingLeft:b,paddingRight:w,paddingTop:k,query:T,renderSpacer:I,resultStore:R,schema:j,showHoverActionsStore:A,showPropertyFormats:P,showRightActions:M,store:B,tableStore:_}=e;const V=(0,s().v3)(),F=(0,n.useRef)(null),O=(0,Ae().X)("db_ux_simplification_next"),E=(0,d().K8)((()=>(0,L().f5)({environment:V,collectionContextStore:r})),[r,V]),D=(0,d().uB)(R,Tu),z=(0,n.useMemo)((()=>h?[h]:[]),[h]),K=(0,n.useMemo)((()=>wd(l,M)),[l,M]),H=(0,d().K8)((()=>!!A&&A.state),[A]),G=(0,d().K8)((()=>{var e;return null===(e=r.collectionViewStore())||void 0===e?void 0:e.getType()}),[r]),W=(0,d().O$)(r.isUnlistedViewStore),N=(0,L().Oz)(r),$=(0,u().IS)((e=>{const t=y?e.tableHomeDividerColor:e.tableDividerColor,o=y?"transparent":W?e.surface.elevated:x?e.cardContentBackground:(null==N?void 0:N.background)||e.contentBackground;return{flex:{display:"flex"},headerRow:{display:"flex",background:o,zIndex:87,height:v,color:e.mediumTextColor,boxShadow:`-3px 0 0 ${o}, inset 0 -1px 0 ${t}${c?"":`, inset 0 1px 0 ${t}`}`,minWidth:C,left:"timeline"===G?void 0:0,right:"timeline"===G?void 0:0,position:"relative",boxSizing:"border-box"},stickyStyle:{paddingLeft:b+(O?24:0),paddingRight:w,minWidth:C,background:o,borderRight:"timeline"===G?`1px solid ${e.tableDividerColor}`:void 0,"--timeline-box-shadow":"timeline"===G?"0px":void 0},transitionStickyStyle:{paddingLeft:O?24:0,..."timeline"===G?{borderRight:void 0}:{}}}}),[y,W,null==N?void 0:N.background,x,v,c,C,G,b,O,w]);return(0,S.jsx)(Ki().g,{stickyAttachPoint:y?"no-stick":"ceiling",absoluteHeight:v,nodeRef:F,stickyStyle:$.stickyStyle,transitionStickyStyle:$.transitionStickyStyle,children:(0,S.jsxs)("div",{className:he().FYj,style:$.headerRow,dir:"ltr",ref:F,children:[E&&(0,S.jsx)($d,{groupsPointer:z,collectionContextStore:r,frozoneProps:g,hasMoreReducerResults:!!f}),(0,S.jsx)(Ru,{showRightActions:M,store:B,collectionContextStore:r,schema:j,query:T,disabled:l,formatKey:m,disableCellRightBorder:i,renderSpacer:I,allowHidingTitle:t,paddingTop:k,frozoneProps:g,disableTopBorder:c,backgroundColor:$.headerRow.background,disableHorizontalEdgeScroll:a,showPropertyFormats:P,format:p,height:v,tableStore:_,groupsPointer:z,resultStore:D}),(0,S.jsxs)(It().A,{visible:K,animate:{opacity:H?1:0},style:$.flex,children:[(0,S.jsx)(Ed,{collectionContextStore:r}),(0,S.jsx)(Dd,{collectionContextStore:r})]}),o]})})})),Ru=n.memo((function(e){let{allowHidingTitle:t,backgroundColor:r,collectionContextStore:i,disableCellRightBorder:l,disableHorizontalEdgeScroll:a,disableTopBorder:c,disabled:p,format:m,formatKey:g,frozoneProps:h,groupsPointer:f,height:v,paddingTop:y,query:x,renderSpacer:b,resultStore:w,schema:k,showPropertyFormats:I,showRightActions:R,store:j,tableStore:A}=e;const P=(0,s().v3)(),{canConfigureBlock:M}=(0,d().O$)(i.permissionScopesStore),_=(0,d().O$)(i.isInHomeWidgetStore),{frozenIndex:V,unfrozenIndexAddendum:F,stickyLeft:O}=(0,n.useMemo)((()=>{const e=null==h?void 0:h.frozenIndex;return{frozenIndex:e,unfrozenIndexAddendum:(0,L().qi)(e),stickyLeft:null==h?void 0:h.frozenStyles.left}}),[null==h?void 0:h.frozenIndex,null==h?void 0:h.frozenStyles.left]),{showProperties:E,frozenShowProperties:D,unfrozenShowProperties:z}=(0,n.useMemo)((()=>{const e=I.map((e=>e.property)),[t,o]=[e.slice(0,F),e.slice(F)];return{showProperties:e,frozenShowProperties:t,unfrozenShowProperties:o}}),[I,F]),K=(0,n.useCallback)((e=>{const t=i.collectionViewStore();if(!t)return;const o=A.getCurrentFormat(m),n=C().Ul(A.getCurrentProperties(g,m),(t=>{const o=e.indexOf(t.property);return o>=0?o:1/0})),r={...o,[g]:n};B().createAndCommit({userAction:"TableHeaderRow.handleColumnReorder",environment:P,canUndo:!0,perform:e=>{(0,ri().F)({collectionViewStore:t,update:{format:r},transaction:e})}}),(0,T().X)({environment:P,collectionContextStore:i,action:"table_reorder_columns"})}),[i,P,m,g,A]),H=(0,u().IS)((e=>{const t=_?e.tableHomeDividerColor:e.tableDividerColor;return{flex:{display:"flex"},frozenStyle:{display:"flex",...null==h?void 0:h.frozenStyles,left:_?Ut().hj:O??0,boxShadow:`-3px 0 0 ${r}, inset 0 -1px 0 ${t}${c?"":`, inset 0 1px 0 ${t}`}`}}}),[r,c,null==h?void 0:h.frozenStyles,_,O]),G=(0,n.useMemo)((()=>({frozen:D,unfrozen:z})),[D,z]),W=(0,n.useMemo)((()=>({frozen:H.frozenStyle,unfrozen:{display:"flex"}})),[H.frozenStyle]),N=(0,n.useCallback)(((e,o,n)=>(0,S.jsx)(ku,{collectionContextStore:i,store:j,schema:k,query:x,disabled:p,format:m,formatKey:g,allowHidingTitle:t,showPropertyFormats:I,resultStore:w,showRightActions:R,disableCellRightBorder:l,renderSpacer:b,paddingTop:y,tableStore:A,groupsPointer:f,height:v,property:e,index:o,isLast:n},e)),[t,i,l,p,m,g,f,v,y,x,b,w,k,I,R,j,A]);return p||!M?(0,S.jsxs)("div",{style:Es().Z0,children:[(0,S.jsx)("div",{style:H.frozenStyle,children:D.map(((e,t)=>N(e,t,t===E.length-1)))}),z.map(((e,t)=>N(e,t+F,t===E.length-1)))]}):(0,L().Eh)(V)?(0,S.jsx)(o(809595).A,{style:H.flex,direction:"horizontal",keys:E,sectionedKeys:G,sectionStyles:W,renderKey:N,onDrop:K,disableHorizontalEdgeScroll:a}):(0,S.jsx)(Es().Ay,{direction:"horizontal",keys:E,renderKey:N,onDrop:K,disableHorizontalEdgeScroll:a})}));function ju(e){const{children:t,isCollectionViewBlockSelected:o,passesFilter:n,shouldFreeze:r}=e,i=(0,u().IS)((()=>({container:{display:"flex",background:o&&n?Pn().Ay.blueWithAlpha(.14):void 0}})),[o,n]);return r?(0,S.jsx)(It().A,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:i.container,children:t},"halo"):(0,S.jsx)(S.Fragment,{children:t})}function Au(e){let{store:t,collectionContextStore:o,children:n,anyWrapping:r}=e;return(0,Sd().DV)()&&r?(0,S.jsx)(Pu,{store:t,collectionContextStore:o,children:n}):(0,S.jsx)("div",{style:{display:"flex"},children:n})}function Pu(e){let{store:t,collectionContextStore:o,children:r}=e;const i=(0,n.useRef)(null),l=o.virtualizedModule.getBlockHeightsCache(),s=(0,d().K8)((()=>{var e;return(null===(e=l.getBlockHeightStore(t.id))||void 0===e?void 0:e.state)??void 0}),[l,t]);(0,n.useLayoutEffect)((()=>{l.expandHeightToTallestCached(t.id)}),[l,t]);const a=(0,u().IS)((()=>({row:{display:"flex",...s?{height:Math.max(s,Ja().tt),overflowY:"clip"}:{}}})),[s]);return(0,S.jsx)("div",{ref:i,style:a.row,children:r})}const Mu=n.memo((function(e){const{store:t,passesFilter:o,canEdit:r,frozoneProps:i}=e,l=(0,Z().ET)(),a=(0,s().v3)(),c=(0,d().K8)((()=>ie().default.state.stores.includes(t)),[t]),u=(0,d().K8)((()=>{var e;return Kd().default.state.isOpen&&(null===(e=Kd().default.state.currentStore)||void 0===e?void 0:e.id)===t.id}),[t]),p=(0,n.useCallback)((e=>{var o;(0,_().ut)({collectionViewBlockId:null===(o=l.collectionViewBlockStore())||void 0===o?void 0:o.id})?P().td({environment:a,stores:[t]}):P().Lt({environment:a,store:t,selectMode:P().gj()?P().SB.MULTI_SELECT_FROM_BOUNDARY:P().SB.TOGGLE}),e.stopPropagation()}),[l,a,t]);return(0,S.jsx)(Nd,{checkedState:c,onClick:p,checkboxType:"single_row",collectionContextStore:l,isBlockHovered:u,frozoneProps:i,passesFilter:o,disabled:!r})}));const Bu=function(e){const{toggleButton:t,subitemPath:o,shouldShowMultiSelectCheckbox:n,propertyIndex:r}=e,i=(null==o?void 0:o.length)??0,l=Math.max((i-1)*te().yy,0)+te().Pi;return t?(0,S.jsxs)("div",{style:{paddingTop:4,display:"flex",...0===r&&n?{marginLeft:-8,marginRight:0,gap:4}:{}},children:[(0,S.jsx)("div",{style:{width:l}}),t]}):(0,S.jsx)("div",{style:{minWidth:l+te().yy,...0===r&&n?{marginLeft:-8,marginRight:4}:{}}})},_u=n.memo((function(e){const{propertyFormat:t,index:r,canEdit:i,isLastColumn:l,isRightMostFrozenColumn:a,store:c,schema:p,disabled:m,disableCellBorderRight:g,disableLastCellBorderRight:h,subitemPath:f,onShiftEnter:v,tableWrap:y,subitemFormat:x,forceMouseEntered:b,shouldCaptureKeyboard:w,isLocked:k,toggleButton:T,onPropertyClick:I,titleColumnIndex:R,isSubitemToggleOnTitleColumn:j,onPropertyTab:A,onPropertyUntab:P,onPropertyEnter:M,onPropertyEsc:B,onPropertyBgClick:V,onPropertyContextMenu:F,collectionViewStore:L,collectionStore:O,blockPropertyValueOverlayStore:E,shouldSetCellHeight:D,onOpenProperty:z,disableHorizontalEdgeScroll:K,handleOpenPeekPage:H,groupFormat:G,rowIndex:W,isCollectionViewBlockSelected:N,passesFilter:$,isScrolled:U,shouldShowMultiSelectCheckbox:q,isInHomeWidget:Y,normalizedTableSelection:X}=e,{property:J,wrap:ee}=t,te=(0,s().v3)(),oe=(0,d().K8)((()=>(0,_().oe)({environment:te,propertyFormat:t})),[te,t]),ne=(0,Z().ET)(),re=(null==f?void 0:f.length)??0,ie=x&&(0,_().BC)({columnIndex:r,titleColumnIndex:R,isSubitemToggleOnTitleColumn:j}),le=(0,n.useMemo)((()=>{if(void 0!==oe){if(ie){const e=(0,_().si)({columnIndex:r,indentLevel:re,titleColumnIndex:R,isSubitemToggleOnTitleColumn:j});return oe-e}return oe}}),[re,r,j,ie,R,oe]),se=(0,n.useMemo)((()=>ie?(0,S.jsx)(Bu,{subitemFormat:x,toggleButton:T,subitemPath:f,shouldShowMultiSelectCheckbox:q,propertyIndex:r}):void 0),[ie,x,f,T,q,r]),ae=(0,n.useCallback)((()=>I(c,J,p)),[I,J,p,c]),ce=m||!i,de=(0,d().K8)((()=>{const e=ne.collectionViewBlockStore();if(!e)return!1;const t=kd().A.state;if(!t.isActive||!(0,kd().g)(t.selectionKey,{collectionViewBlockStore:e,groupFormat:G})||!X)return!1;const o=X,{start:n,end:i}=o,l=W===n.row||W===i.row||C().r4(W,n.row,i.row),s=r===n.col||r===i.col||C().r4(r,n.col,i.col);return l&&s}),[ne,G,r,X,W]),ue=(0,d().K8)((()=>{const e=kd().A.state,t=ne.collectionViewBlockStore();if(!t)return!1;if(!e.isActive||!(0,kd().g)(e.selectionKey,{collectionViewBlockStore:t,groupFormat:G})||!X)return!1;const o=X,{start:n}=o;return W===n.row&&r===n.col}),[ne,G,r,X,W]),pe=(0,d().K8)((()=>{const e=ne.frozoneStore.state.frozenIndex;return void 0!==e&&r<=e}),[ne,r]),me=(0,Sd().DV)(),ge=(0,o(736230).V)({collectionContextStore:ne,blockId:c.id,property:J,featureEnabled:me}),Se=(0,u().IS)((e=>{const t=Y?e.tableHomeDividerColor:e.tableDividerColor,o=N?e.tableFrozenSelectedDividerColor:t;return{tableCell:{display:"flex",width:oe||void 0,height:ge?void 0:"100%",position:"relative",borderRight:g||a||l&&h?"none":`1px solid ${pe?o:t}`},tableSelectionOverlay:{background:de?Pn().Ay.blueWithAlpha(.07):void 0,borderRadius:ue?3:void 0,boxShadow:ue?e.collectionTableOutlineBlueInputBoxShadow:void 0,position:"absolute",pointerEvents:"none",top:0,height:"100%",zIndex:84,width:"100%",left:0},propertyValueContainer:{display:"flex",overflowX:"clip",height:"100%",width:le||void 0}}}),[Y,N,oe,ge,g,a,l,h,pe,de,ue,le]),fe=(0,S.jsxs)(Q().A,{debugName:"TableRow",capture:w,onShiftEnter:v,children:[(0,S.jsx)(hr().m,{collectionStore:O,store:c,property:J,disabled:ce,locked:k,width:le,format:Tt().j.Table,forceMouseEntered:b,tableWrap:Boolean(y||ee),isLast:l,indentLevel:0===r&&f?f.length:void 0,onTab:A,onUntab:P,onEnter:M,onClick:ae,onEsc:B,onBgClick:V,onContextMenu:F,collectionViewStore:L,shouldSetCellHeight:D,onOpenProperty:z,blockPropertyValueOverlayStore:E,disableHorizontalEdgeScroll:K,handleOpenPeekPage:H,propertyIndex:r,shouldShowMultiSelectCheckbox:q},J),a&&(0,S.jsx)(Wd,{isCollectionViewBlockSelected:N,passesFilter:$,isScrolled:U})]}),ve=(0,n.useRef)(null);return(0,S.jsxs)("div",{ref:ve,className:he().WvK,"data-row-index":W,"data-col-index":r,style:Se.tableCell,children:[se,(0,S.jsx)("div",{style:Se.propertyValueContainer,children:fe}),de&&(0,S.jsx)("div",{style:Se.tableSelectionOverlay})]})})),Vu=n.memo((function(e){const{blockPropertyValueOverlayStore:t,propertyFormats:o,propertyFormatsMap:n,visiblePropertiesLength:r,store:i,tableWrap:l,shouldSetCellHeight:s,indexAddendum:a,frozoneProps:c,normalizedTableSelection:u,canEdit:p,isInHomeWidget:m,...g}=e,h=(0,Z().ET)(),f=(0,d().K8)((()=>h.collectionViewStore()),[h]),v=(0,d().K8)((()=>L().Dj({store:i,collectionContextStore:h})),[i,h]),y=(0,d().K8)((()=>!t.state.isOpen&&ie().default.state.stores.length>0&&ie().default.state.stores[0].id===i.id),[i.id,t]),x=(0,d().O$)(h.currentSubitemFormatStoreForUiDisplayStore),C=(0,d().K8)((()=>"title"===(null==f?void 0:f.getFormatStore().getKeyStore("table_subitem_toggle_column").getValue())),[f]),b=(0,d().K8)((()=>h.frozoneStore.state.frozenIndex),[h]),w=(0,d().K8)((()=>{if(!p)return;if(m)return;if(h.isInlineViewStore.state&&h.isUnlistedViewStore.state)return;const e=Kd().default.state;return Boolean(e.isOpen&&e.currentStore===i)}),[p,h,m,i]),k=r??o.length;return(0,S.jsx)(S.Fragment,{children:o.map(((e,o)=>{const r=(null==n?void 0:n[o])??o+(a??0);return(0,S.jsx)(_u,{index:r,store:i,propertyFormat:e,isLastColumn:r===k-1,isRightMostFrozenColumn:b===r,collectionViewStore:f,collectionStore:v,tableWrap:l,shouldSetCellHeight:s,forceMouseEntered:"title"===e.property?w:void 0,shouldCaptureKeyboard:y,subitemFormat:x,isSubitemToggleOnTitleColumn:C,blockPropertyValueOverlayStore:t,isScrolled:(null==c?void 0:c.isScrolled)??!1,normalizedTableSelection:u,canEdit:p,isInHomeWidget:m,...g},e.property)}))})})),Fu=n.memo((function(e){let{propertyFormats:t,...o}=e;const{propertiesInRange:n,propertiesInRangeIndices:r,beforeWidth:i,afterWidth:l}=(0,Sd().UB)();return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("div",{style:{width:`${i}px`}}),(0,S.jsx)(Vu,{...o,propertyFormats:n,propertyFormatsMap:r}),(0,S.jsx)("div",{style:{width:`${l}px`}})]})})),Lu=n.memo(n.forwardRef((function(e,t){const{disabled:o,store:r,groupFormat:i,collectionContextStore:l,propertyFormats:a,frozoneProps:c,passesFilter:p,shouldShowMultiSelectCheckbox:m,isLast:g,isInHomeWidget:h,isCollectionViewBlockSelected:f,allRows:v,isInEphemeralView:y,normalizedTableSelection:x,unfrozenIndexAddendum:C,frozenPropertyFormats:b,unfrozenPropertyFormats:w,tableWrap:k,shouldSetCellHeight:T,isNonEditable:I,shouldShowRightActionSpacer:R,...j}=e,{handleOpenPeekPage:A}=e,P=(0,n.useRef)(null),M=(0,s().v3)(),B=(0,d().K8)((()=>!o&&r.canEdit()),[o,r]),_=(0,n.useMemo)((()=>v.findIndex((e=>e===r))),[v,r]),V=null==c?void 0:c.frozenIndex,F=void 0!==V,O=(0,d().K8)((()=>{const e=kd().A.state,t=l.collectionViewBlockStore();if(!t)return!1;if(!e.isActive||!(0,kd().g)(e.selectionKey,{collectionViewBlockStore:t,groupFormat:i})||!x)return!1;const o=x,{start:n}=o;return void 0!==V&&_===n.row&&n.col<=V}),[i,l,x,V,_]),E=(0,n.useMemo)((()=>F?{...null==c?void 0:c.frozenStyles,...O?{zIndex:86}:{zIndex:85},...-1===V?{background:void 0}:{},...h?{left:Ut().hj}:{}}:{}),[F,null==c?void 0:c.frozenStyles,O,V,h]),D=(0,u().IS)((e=>{const t=h?e.tableHomeDividerColor:e.tableDividerColor;return{tableViewRowStyle:{display:"flex",...g&&h?{}:{borderBottom:`1px solid ${t}`},width:"100%"},checkboxContainer:{position:"absolute",left:-Ut().Fh,...-1!==(null==c?void 0:c.frozenIndex)&&{background:null==c?void 0:c.frozenStyles.background,height:"100%"}}}}),[null==c?void 0:c.frozenIndex,null==c?void 0:c.frozenStyles.background,h,g]),z=(0,n.useCallback)((()=>{const{mainEditorCurrentBlockStore:e}=Le().default.state,t=L().wy({environment:M,store:r,mainEditorCurrentBlockStore:e,collectionContextStore:l,fullyQualified:!1,overridePeekMode:y?"center_peek":void 0});t&&(A(),$n().oo({environment:M,url:t}))}),[l,M,A,y,r]),K=(0,Sd().DV)(),H=k||a.some((e=>e.wrap)),G=(0,S.jsxs)(n.Fragment,{children:[(0,S.jsx)("div",{className:he().Eo4,style:D.tableViewRowStyle,dir:"ltr",ref:P,children:(0,S.jsx)(_r().c,{store:r,step:"demo_collection_record",children:(0,S.jsxs)(Au,{collectionContextStore:l,store:r,anyWrapping:H,children:[(0,S.jsx)("div",{style:E,children:(0,S.jsx)(ju,{isCollectionViewBlockSelected:f,passesFilter:Boolean(p),shouldFreeze:-1!==V,children:(0,S.jsxs)(S.Fragment,{children:[m&&(0,S.jsx)(It().A,{animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},config:{timingFunction:"ease-out"},children:(0,S.jsx)("div",{style:D.checkboxContainer,children:(0,S.jsx)(Mu,{store:r,passesFilter:Boolean(p),frozoneProps:c,canEdit:B})})}),(0,S.jsx)(Vu,{store:r,canEdit:B,propertyFormats:b,visiblePropertiesLength:b.length,shouldSetCellHeight:T,indexAddendum:0,rowIndex:_,disabled:o,groupFormat:i,tableWrap:k,isLocked:I,isCollectionViewBlockSelected:f,passesFilter:Boolean(p),shouldShowMultiSelectCheckbox:m,frozoneProps:c,normalizedTableSelection:x,isInHomeWidget:h,...j})]})})}),K?(0,S.jsx)(Fu,{store:r,canEdit:B,propertyFormats:w,visiblePropertiesLength:w.length,shouldSetCellHeight:T,indexAddendum:C,rowIndex:_,disabled:o,groupFormat:i,tableWrap:k,isLocked:I,isCollectionViewBlockSelected:f,passesFilter:!0,shouldShowMultiSelectCheckbox:m,frozoneProps:c,normalizedTableSelection:x,isInHomeWidget:h,...j}):(0,S.jsx)(Vu,{store:r,canEdit:B,propertyFormats:w,visiblePropertiesLength:w.length,shouldSetCellHeight:T,indexAddendum:C,rowIndex:_,disabled:o,groupFormat:i,tableWrap:k,isLocked:I,isCollectionViewBlockSelected:f,passesFilter:!0,shouldShowMultiSelectCheckbox:m,frozoneProps:c,normalizedTableSelection:x,isInHomeWidget:h,...j})]})})}),R?(0,S.jsx)("div",{style:{...D.tableViewRowStyle,display:"flex",justifyContent:"flex-start",flexGrow:1,width:64}}):null]});return(0,je().NW)(r,t,(0,n.useMemo)((()=>({renderedType:"table_row",getNode:()=>P.current,getBlockStore:()=>r,activate:z})),[z,r]),G)})));const Ou=function(e){const{frozenColumnRepositionStore:t,frozenIndex:o,maxFrozenIndex:r,xForFirstCellInRow:i,showPropertyFormats:l,frozenSectionWidth:a}=e,c=(0,s().v3)(),p=(0,Z().Ks)(),m=(0,n.useRef)(null),g=(0,n.useRef)(null),[h,f]=n.useState({x:0,y:0,width:0,maxY:0,isEntered:!1,isMouseDown:!1}),[v,y]=n.useState(0),[x,b]=n.useState(0),T=(0,d().K8)((()=>t.state.isRepositioning||h.isMouseDown),[t,h.isMouseDown]),I=(0,d().K8)((()=>t.state.newFrozenIndex),[t]),R=(0,d().K8)((()=>!!p&&(0,L().f5)({environment:c,collectionContextStore:p})),[c,p]),j=(0,d().K8)((()=>null==p?void 0:p.frozoneStore.state.isScrolled),[p]),A=(0,d().K8)((()=>!j&&-1===o&&R?-4:0),[o,j,R]),P=(0,d().K8)((()=>h.isEntered||T),[h.isEntered,T]),M=(0,d().K8)((()=>t.state.newFrozenColumnXPosition),[t]),B=(0,n.useContext)(pe().R),V=null==B?void 0:B.horizontalScroller,F=(0,n.useCallback)((()=>{var e,t,o;if(!V||!m.current)return 0;const n=(null===(e=m.current.getBoundingClientRect())||void 0===e?void 0:e.top)??0,r=null===(t=V.getNode())||void 0===t?void 0:t.getElementsByClassName(he().FYj);return(r&&r.length>0?null===(o=r[0].getBoundingClientRect())||void 0===o?void 0:o.top:0)-n}),[V]),O=(0,n.useCallback)((()=>{var e,t,o,n,r;if(!V||!m.current)return 0;const i=(null===(e=m.current)||void 0===e||null===(e=e.getBoundingClientRect())||void 0===e?void 0:e.bottom)??0,l=null===(t=V.getNode())||void 0===t?void 0:t.getElementsByClassName(he().Eo4),s=l&&l.length>0?null===(o=l[l.length-1].getBoundingClientRect())||void 0===o?void 0:o.bottom:0,a=null===(n=V.getNode())||void 0===n?void 0:n.getElementsByClassName(he().Mbm),c=a&&a.length>0?null===(r=a[a.length-1].getBoundingClientRect())||void 0===r?void 0:r.bottom:0;return Math.max(s,c)-i}),[V]),E=(0,d().K8)((()=>{var e;const t=null===(e=m.current)||void 0===e?void 0:e.getBoundingClientRect();return t&&void 0!==a?new DOMRect(t.x+a+h.x+10,t.y+h.y+10,3,3):void 0}),[a,h]),D=(0,d().K8)((()=>{const e=(null==p?void 0:p.frozoneStore.state.scrollerLeftOffset)??0,t=(0,Ve().kf)(c),o=Math.max(t-e,0);return p&&(0,_().QP)(c,p)?o:0}),[p,c]),z=(0,d().K8)((()=>p&&(0,L().f5)({environment:c,collectionContextStore:p})),[p,c]),K=(0,n.useCallback)((e=>{if(void 0===o||void 0===r||void 0===a||null===m.current||null===g.current)return;const n=m.current.getBoundingClientRect(),s=e.clientX-n.x;if(null==p||p.frozoneStore.setState({...null==p?void 0:p.frozoneStore.state,tryShowHiddenFrozenColumn:s<42}),!P)return;const c=F();y(c);const d=O();b(d);const u=2+a,S=Math.max(s-u,-u),h=e.clientY-n.y-14,v=n.bottom-n.top-14+d,x=T?c:-14,C=Math.max(Math.min(h,v),x);if(f((e=>({...e,x:T?S:0,y:C}))),T){const e=l,n=g.current.getBoundingClientRect();let c=s,d=i,u=-1,p=d,m=Math.abs(d-c);for(let t=0;t<e.length&&!(t>r);t++){const r=e[t];d+=(null==r?void 0:r.width)??0,j&&t===o+1&&(c-=n.x);const i=Math.abs(d-c);i<m&&(m=i,p=d,u=t)}t.setState({...t.state,newFrozenIndex:u,newFrozenColumnXPosition:p-a-1})}}),[o,r,a,null==p?void 0:p.frozoneStore,P,F,O,T,l,i,t,j]);(0,n.useEffect)((()=>{const e=C().nF((e=>{K(e)}),25);return window.addEventListener("mousemove",e),()=>{window.removeEventListener("mousemove",e)}}),[K]);const H=(0,n.useCallback)((e=>{T||(K(e.nativeEvent),f((e=>({...e,isEntered:!0,isMouseDown:!1}))))}),[T,K]),G=(0,n.useCallback)((e=>{T||f((e=>({...e,isEntered:!1,isMouseDown:!1})))}),[T]),W=(0,n.useCallback)((e=>{f((e=>({...e,isMouseDown:!0})))}),[]),N=(0,n.useCallback)((e=>{T&&f((e=>({...e,isEntered:!0})))}),[T]),$=(0,n.useCallback)((e=>{f((e=>({...e,isEntered:!1,isMouseDown:!1})))}),[]),U=(0,n.useCallback)((e=>{T&&f((e=>({...e,x:0,isEntered:!1,isMouseDown:!1})))}),[T]),q=(0,u().IS)((e=>{const t=void 0!==I&&void 0!==o&&I<=o;return{repositionerContainer:{zIndex:87,display:"flex",position:"absolute",width:"100%",height:"100%",cursor:T?"grabbing":"grab",pointerEvents:T?void 0:"none"},repositionerOutsideStickyWrapper:{display:"flex",width:"calc(100% - 64px)",height:"100%"},repositionerInsideStickyWrapper:{position:"sticky",left:D+(z?Ut().Fh:0),height:"100%"},tooltipContainer:{position:"absolute",left:-1!==a||j?a??0:5,zIndex:30,height:"100%"},tooltipOrigin:{position:"absolute",left:-3,top:0,width:8,pointerEvents:"auto",cursor:T?"grabbing":"grab",height:"100%"},tooltipColumn:{position:"absolute",left:T?h.x-1:-1,top:T?v:0,width:2,height:T?`calc(100% + ${x-v}px`:"100%",background:"dark"===e.mode?e.accentColors.gray[500]:e.accentColors.gray[200]},ghostColumnBase:{position:"absolute",top:T?v:0,width:1,height:T?`calc(100% + ${x-v}px`:"100%",background:e.accentColors.uiBlue[300]},frozenGhostColumn:{left:M,opacity:T&&t?1:0},unfrozenGhostColumn:{left:(a??0)+(M??0),opacity:P&&T&&!t?1:0},tooltipDraggable:{position:"absolute",left:T?h.x-2:-2,top:h.y,width:4,height:28,background:e.accentColors.uiBlue[600],borderRadius:4},tooltipText:{color:e.text.contrastSecondary,maxWidth:200,...w().RC}}}),[I,o,T,D,z,a,j,h.x,h.y,v,x,M,P]);return(0,S.jsx)("div",{className:he().FZs,style:q.repositionerContainer,onMouseEnter:N,onMouseLeave:$,onMouseUp:U,children:(0,S.jsxs)("div",{style:q.repositionerOutsideStickyWrapper,ref:g,children:[(0,S.jsx)("div",{style:q.repositionerInsideStickyWrapper,ref:m,children:(0,S.jsx)(At().A,{renderTooltip:()=>T&&void 0!==I&&I!==o?(0,S.jsx)(k().sA,{id:"tableView.selectionOverlay.repositioner.dynamicTooltip",defaultMessage:"Freeze {numColumns} {numColumns, select, 1 {column} other {columns}}",values:{numColumns:I+1}}):(0,S.jsx)(k().sA,{id:"tableView.selectionOverlay.repositioner.tooltip",defaultMessage:"Drag horizontally to freeze columns"}),delayThreshold:300,forceVisibleState:T||void 0,placement:Fe().W.Right,originRect:E,render:e=>(0,S.jsxs)(It().A,{animate:{translateX:A,opacity:P?1:0},...e,style:q.tooltipContainer,children:[(0,S.jsx)("div",{style:q.tooltipOrigin,onMouseEnter:H,onMouseLeave:G,onMouseDown:W}),(0,S.jsx)("div",{style:{...q.ghostColumnBase,...q.frozenGhostColumn}}),(0,S.jsx)("div",{style:q.tooltipColumn}),(0,S.jsx)("div",{style:q.tooltipDraggable})]})})}),(0,S.jsx)("div",{style:{...q.ghostColumnBase,...q.unfrozenGhostColumn}})]})})},Eu={tableSelectionOverlayActions:new(ne().O2)("tableSelectionOverlayActions",(async()=>await o.e(95496).then(o.bind(o,339016)))),tableSelectionOverlayPropertyActions:new(ne().O2)("tableSelectionOverlayPropertyActions",(async()=>await o.e(40589).then(o.bind(o,233035))))};var Du=()=>o(556148);class zu extends p().default{getInitialState(){}}const Ku=zu;class Hu extends p().default{getInitialState(){return{isRepositioning:!1,newFrozenIndex:void 0,newFrozenColumnXPosition:void 0}}}const Gu=Hu,Wu=new Set(["rollup","formula","verification"]);function Nu(e){var t;const{dragAndFillStore:o,frozenIndex:r,rowsWrapRect:i,schema:l,selection:a,selectionStartRectStore:c,showPropertyFormats:p}=e,m=(0,s().v3)(),g=(0,Z().ET)(),h=(0,d().O$)(o),f=(0,d().K8)((()=>{const e=(null==h?void 0:h.start)||a.start;return p[e.col]}),[h,a,p]),v=f?null===(t=l[f.property])||void 0===t?void 0:t.type:void 0,y=(0,d().O$)(c),x=(0,d().K8)((()=>void 0!==r&&a.start.col<=r),[r,a]),C=(0,d().K8)((()=>g.isInHomeWidgetStore.state),[g]),b=(0,d().K8)((()=>(0,L().f5)({environment:m,collectionContextStore:g})),[g,m]),T=(0,u().IS)((e=>{const t=x?91:85,o=x?"sticky":void 0;let n=0;C?n=Ut().hj:b&&(n=Ut().Fh);return{dragAndFillContainer:{zIndex:t,display:"flex",position:"relative"},dragAndFillOutsideStickyWrapper:{display:"flex",width:"calc(100% - 64px)"},dragAndFillInsideStickyWrapper:{position:o,left:n},tooltipContainer:y?{position:"absolute",left:y.left+y.width-6-(b?Ut().Fh:0)}:{},tooltipOrigin:{position:"absolute",left:0,top:y?y.bottom-7:void 0,width:10,height:15,pointerEvents:"auto",cursor:"ns-resize"},tooltipCircle:{position:"absolute",left:0,top:y?y.bottom-5:void 0,width:9,height:9,border:`2px solid ${Pn().Ay.blueWithAlpha(.57)}`,transform:h?"scale(1.3)":void 0,transition:"transform 0.2s ease",background:e.contentBackground,borderRadius:"50%",cursor:"ns-resize"},tooltipText:{color:e.text.contrastSecondary,maxWidth:200,...w().RC}}}),[x,C,b,y,h]),I=(0,n.useMemo)((()=>{if(y&&i)return new DOMRect(y.x+i.x+y.width-4,y.y+i.y+y.height-4,7,7)}),[y,i]),R=(0,n.useCallback)((()=>(0,S.jsx)(k().sA,{id:"tableView.selectionOverlay.dragAndFill.tooltip",defaultMessage:"Drag vertically to fill value"})),[]),j=(0,n.useCallback)((e=>(0,S.jsx)("div",{...e,className:he().yle,style:T.dragAndFillContainer,children:(0,S.jsx)("div",{style:T.dragAndFillOutsideStickyWrapper,children:(0,S.jsx)("div",{style:T.dragAndFillInsideStickyWrapper,children:(0,S.jsxs)("div",{style:T.tooltipContainer,children:[(0,S.jsx)("div",{style:T.tooltipOrigin}),(0,S.jsx)("div",{style:T.tooltipCircle})]})})})})),[T]);return y?!v||(0,co().F_)(v)||Wu.has(v)?null:(0,S.jsx)(At().A,{renderTooltip:R,delayThreshold:300,forceVisibleState:!!h||void 0,originRect:I,placement:Fe().W.Right,render:j}):null}const $u=n.memo((function(e){const{groupFormat:t}=e,r=(0,s().v3)(),i=(0,n.useContext)(Br().n),l=(0,n.useRef)(null),a=(0,n.useRef)(void 0),c=(0,Ae().X)("improved_drag_and_fill"),{value:u}=(0,ne().fJ)(J().g),{value:p}=(0,ne().fJ)(ee().S),{value:m}=(0,ne().fJ)(me().T.formulas),g=(0,n.useMemo)((()=>Eu.tableSelectionOverlayActions.load()),[]),h=(0,d().uB)(void 0,Ku),f=(0,d().uB)(void 0,Gu),v=(0,d().r6)((()=>(0,te().v2)(t,e.collectionContextStore)),[t,e.collectionContextStore]),y=(0,d().K8)((()=>(0,L().f5)({environment:r,collectionContextStore:e.collectionContextStore})),[r,e.collectionContextStore]),x=(0,d().K8)((()=>e.collectionContextStore.normalizedSchemaStore.state),[e.collectionContextStore]),C=(0,d().r6)((()=>{const n=e.collectionContextStore.collectionViewBlockStore();if(!n)return;const r=kd().A.state;if(!r.isActive||!(0,kd().g)(r.selectionKey,{collectionViewBlockStore:n,groupFormat:t}))return;const i=(0,_().yR)(r.selection,e.showPropertyFormats.length,v.state.length);return o(4319).kn(v.state[i.start.row]),i}),[e.collectionContextStore,e.showPropertyFormats.length,t,v]),b=(0,d().O$)(C),w=(0,d().K8)((()=>{const e=C.state;return e&&e.start.col===e.end.col&&e.start.row===e.end.row}),[C]),k=(0,d().K8)((()=>{const e=C.state;return e&&e.start.row===e.end.row}),[C]),T=c?k:w,I=(0,d().r6)((()=>{const t=C.state;if(!t)return;if(!l.current)return;const o=t.start,n=e.showPropertyFormats,i=v.state[o.row],s=(0,Du().Xw)(i,l.current);if(!s)return;const a=l.current.getBoundingClientRect(),c=s.height,d=s.top-a.top-1,u=n[o.col].width||0,p=c+1;let m=(0,Du().$u)(e.collectionContextStore,r);for(let e=0;e<o.col;e++){const t=n[e];t.width&&(m+=t.width)}return new DOMRect(m-1,d,u+1,p)}),[v,r,C,e.collectionContextStore,e.showPropertyFormats]),R=(0,d().r6)((()=>{const t=C.state;if(!t||!k)return;if(!l.current)return;const o=t.end,n=e.showPropertyFormats,i=v.state[o.row],s=(0,Du().Xw)(i,l.current);if(!s)return;const a=l.current.getBoundingClientRect(),c=s.height,d=s.top-a.top-1,u=n[o.col].width||0,p=c+1;let m=(0,Du().$u)(e.collectionContextStore,r);for(let e=0;e<o.col;e++){const t=n[e];t.width&&(m+=t.width)}return new DOMRect(m-1,d,u+1,p)}),[v,r,k,C,e.collectionContextStore,e.showPropertyFormats]),j=c?R:I,A=(0,d().r6)((()=>e.collectionContextStore.frozoneStore.state.frozenIndex),[e.collectionContextStore]),P=(0,d().K8)((()=>{const t=e.collectionContextStore,o=t.collectionViewStore(),n=t.frozoneStore.state.scrollerWidth;return null==o?void 0:o.getTableMaxFrozenColumnIndex(n,t.normalizedFormatStore.state)}),[e.collectionContextStore]),M=(0,d().r6)((()=>{const t=A.state;if(void 0!==t){let o=(0,Du().$u)(e.collectionContextStore,r);const n=e.showPropertyFormats;for(let e=0;e<=t&&!(e>=n.length);e++){const t=n[e];t.width&&(o+=t.width)}return o-1-(y?Ut().Fh:0)}}),[A,y,e.collectionContextStore,e.showPropertyFormats,r]),B=(0,d().K8)((()=>(0,Du().$u)(e.collectionContextStore,r)-(y?Ut().Fh:0)),[e.collectionContextStore,r,y]),V=(0,d().K8)((()=>{let t=!1;const o=(0,Du().yA)(e.collectionContextStore,e.groupFormat),n=o.length,r=ie().default.state.stores.filter((e=>o.includes(e))).length;return t=0!==n&&0!==r&&(r===n||"indeterminate"),void 0!==A.state&&!h.state&&!t&&!kd().A.state.isActive&&void 0===e.tableStore.state.temporaryFormat&&e.collectionContextStore.permissionScopesStore.state.canConfigureBlock}),[h,A,e.collectionContextStore,e.groupFormat,e.tableStore]);(0,n.useEffect)((()=>{l.current&&(a.current=new MutationObserver((()=>{I.recompute()})),a.current.observe(l.current,{attributes:!0,childList:!0,characterData:!0,subtree:!0}));const e=a.current;return()=>{e&&e.disconnect()}}),[I]);const F=(0,n.useCallback)((async t=>{(await g).handleDirection({shortcutOrKeyboardEvent:t,direction:Du().Dp.Left,environment:r,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:C.state,allRows:v.state,frozenSectionWidth:M.state,frozenIndex:A.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})}),[g,r,e.collectionContextStore,e.groupFormat,e.showPropertyFormats,e.disableHorizontalEdgeScroll,C,v,M,A]),O=(0,n.useCallback)((async t=>{(await g).handleDirection({shortcutOrKeyboardEvent:t,direction:Du().Dp.Right,environment:r,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:C.state,allRows:v.state,frozenSectionWidth:M.state,frozenIndex:A.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})}),[g,v,r,A,M,C,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats]),E=(0,n.useCallback)((async t=>{(await g).handleDirection({shortcutOrKeyboardEvent:t,direction:Du().Dp.Up,environment:r,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:C.state,allRows:v.state,frozenSectionWidth:M.state,frozenIndex:A.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})}),[g,v,r,A,M,C,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats]),D=(0,n.useCallback)((async t=>{(await g).handleDirection({shortcutOrKeyboardEvent:t,direction:Du().Dp.Down,environment:r,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:C.state,allRows:v.state,frozenSectionWidth:M.state,frozenIndex:A.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})}),[g,v,r,A,M,C,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats]),z=(0,n.useCallback)((async t=>{(await g).handleEnter({shortcutEvent:t,environment:r,schema:x,showPropertyFormats:e.showPropertyFormats,disabled:e.disabled,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,collectionContextStore:e.collectionContextStore,normalizedTableSelection:C.state,allRows:v.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})}),[g,v,r,C,e.blockPropertyValueOverlayStore,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.disabled,e.showPropertyFormats,x]),K=(0,n.useCallback)((async t=>{t.preventDefault();(await g).handleDirection({shortcutOrKeyboardEvent:t,direction:Du().Dp.Right,environment:r,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:C.state,allRows:v.state,frozenSectionWidth:M.state,frozenIndex:A.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})}),[g,v,r,A,M,C,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats]),H=(0,n.useCallback)((async t=>{t.preventDefault();(await g).handleDirection({shortcutOrKeyboardEvent:t,direction:Du().Dp.Left,environment:r,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:C.state,allRows:v.state,frozenSectionWidth:M.state,frozenIndex:A.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})}),[g,v,r,A,M,C,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats]),G=(0,n.useCallback)((async e=>{(await g).handleEsc({keyboardEvent:e,environment:r,normalizedTableSelection:C.state,allRows:v.state})}),[v,r,C,g]),W=(0,n.useCallback)((async()=>{(await g).handleDelete({environment:r,collectionContextStore:e.collectionContextStore,disabled:e.disabled,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:C.state,allRows:v.state})}),[v,r,C,e.collectionContextStore,e.disabled,e.showPropertyFormats,g]),N=(0,n.useCallback)((async t=>{(await g).handleCut({clipboardEvent:t,environment:r,collectionContextStore:e.collectionContextStore,disabled:e.disabled,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:C.state,allRows:v.state,formulasModule:m})}),[g,r,e.collectionContextStore,e.disabled,e.groupFormat,e.showPropertyFormats,C,v,m]),$=(0,n.useCallback)((async t=>{(await g).handleCopy({clipboardEvent:t,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,allRows:v.state,formulasModule:m,normalizedTableSelection:C.state})}),[g,e.collectionContextStore,e.groupFormat,e.showPropertyFormats,v,m,C]),q=(0,n.useCallback)((async t=>{const o=await g,n=await U().R.clipboardActions.load();o.handlePaste({clipboardEvent:t,environment:r,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,schema:x,showPropertyFormats:e.showPropertyFormats,markdownLinkifyIt:u,tinyMceMicrosoftWordPasteFilter:p,disabled:e.disabled,allRows:v.state,clipboardActions:n,normalizedTableSelection:C.state})}),[g,v,r,u,C,e.collectionContextStore,e.disabled,e.groupFormat,e.showPropertyFormats,x,p]),Y=(0,n.useCallback)((async()=>{(await g).handleCommandEnter({environment:r,collectionContextStore:e.collectionContextStore,normalizedTableSelection:C.state,allRows:v.state,overrideLinkClick:i})}),[v,r,C,i,e.collectionContextStore,g]),X=(0,n.useCallback)((async()=>{(await g).handleShiftEnter({environment:r,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:C.state,allRows:v.state,selectionStartRectStore:I,frozenSectionWidth:M.state,frozenIndex:A.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})}),[g,v,r,A,M,C,e.blockPropertyValueOverlayStore,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats,I]),Z=(0,n.useCallback)((async()=>{(await g).handleCommandShiftEnter({environment:r,normalizedTableSelection:C.state,allRows:v.state})}),[g,v,r,C]),oe=(0,n.useCallback)((async t=>{(await g).handleDuplicate({keyboardEvent:t,environment:r,disabled:e.disabled,schema:x,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:C.state,allRows:v.state})}),[g,v,r,C,x,e.disabled,e.showPropertyFormats]),re=(0,n.useCallback)((async t=>{(await g).handleKeypress({keyboardEvent:t,environment:r,schema:x,showPropertyFormats:e.showPropertyFormats,disabled:e.disabled,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,collectionContextStore:e.collectionContextStore,normalizedTableSelection:C.state,allRows:v.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})}),[g,v,r,C,e.blockPropertyValueOverlayStore,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.disabled,e.showPropertyFormats,x]),le=(0,n.useCallback)((async e=>{(await g).handleMoveTo({shortcutOrKeyboardEvent:e,environment:r,normalizedTableSelection:C.state,allRows:v.state})}),[g,v,r,C]),se=(0,n.useCallback)((async t=>{(await g).handleDragStart({dragEvent:t,environment:r,collectionContextStore:e.collectionContextStore,showPropertyFormats:e.showPropertyFormats,paddingLeft:e.paddingLeft,disabled:e.disabled,dragAndFillStore:h,frozenColumnRepositionStore:f,frozenIndex:A.state,allRows:v.state,normalizedTableSelection:C.state})}),[g,v,h,r,f,A,C,e.collectionContextStore,e.showPropertyFormats,e.disabled,e.paddingLeft]),ae=(0,n.useCallback)((async t=>{(await g).handleDragMove({dragEvent:t,environment:r,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,dragAndFillStore:h,frozenColumnRepositionStore:f,normalizedTableSelection:C.state,allRows:v.state,selectionStartRectStore:I})}),[g,v,h,r,f,C,e.collectionContextStore,e.groupFormat,e.showPropertyFormats,I]),ce=(0,n.useCallback)((async()=>{(await g).handleDragEnd({environment:r,collectionContextStore:e.collectionContextStore,showPropertyFormats:e.showPropertyFormats,schema:x,dragAndFillStore:h,frozenColumnRepositionStore:f,normalizedTableSelection:C.state,allRows:v.state})}),[g,v,h,r,f,C,e.collectionContextStore,e.showPropertyFormats,x]),de=(0,n.useCallback)((async()=>{(await g).handleDragCancel({dragAndFillStore:h,frozenColumnRepositionStore:f})}),[h,f,g]);return(0,S.jsx)(Q().A,{debugName:"TableSelectionOverlay",capture:void 0!==b,onLeft:F,onRight:O,onUp:E,onDown:D,onEnter:z,onTab:K,onUntab:H,onEsc:G,onDelete:W,onBackspace:W,onCut:N,onCopy:$,onPaste:q,onCommandEnter:Y,onShiftEnter:X,onCommandShiftEnter:Z,onDuplicate:oe,onKeypress:re,onMoveTo:le,children:(0,S.jsx)(ec().A,{disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll,onDraggableDragStart:se,onDraggableDragMove:ae,onDraggableDragEnd:ce,onDraggableDragCancel:de,render:t=>{var o;return(0,S.jsxs)("div",{ref:l,style:{position:"relative",minWidth:e.minWidth,isolation:"auto"},...t,children:[(0,Du().Gd)(Boolean(e.disableHorizontalEdgeScroll),e.collectionContextStore)&&b&&(T||h.state)?(0,S.jsx)(Nu,{dragAndFillStore:h,frozenIndex:A.state,rowsWrapRect:null===(o=l.current)||void 0===o?void 0:o.getBoundingClientRect(),schema:x,selection:b,selectionStartRectStore:j,showPropertyFormats:e.showPropertyFormats}):null,V&&(0,S.jsx)(Ou,{frozenColumnRepositionStore:f,xForFirstCellInRow:B,maxFrozenIndex:P,showPropertyFormats:e.showPropertyFormats,frozenIndex:A.state,frozenSectionWidth:M.state}),(0,S.jsx)(Uu,{...e,allRowsStore:v,selectionStartRectStore:I,normalizedTableSelectionStore:C,frozenSectionWidthStore:M,frozenIndexStore:A})]})}})})}),mo().A),Uu=n.memo((function(e){const t=(0,s().v3)(),o=(0,n.useMemo)((()=>Eu.tableSelectionOverlayActions.load()),[]),r=(0,n.useMemo)((()=>Eu.tableSelectionOverlayPropertyActions.load()),[]),i=(0,n.useMemo)((()=>({onPropertyTab:async()=>{(await r).handlePropertyTabOrUntab({type:"tab",environment:t,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,showPropertyFormats:e.showPropertyFormats,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,allRows:e.allRowsStore.state,selectionStartRectStore:e.selectionStartRectStore,normalizedTableSelection:e.normalizedTableSelectionStore.state,frozenSectionWidth:e.frozenSectionWidthStore.state,frozenIndex:e.frozenIndexStore.state})},onPropertyUntab:async()=>{(await r).handlePropertyTabOrUntab({type:"untab",environment:t,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,showPropertyFormats:e.showPropertyFormats,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,allRows:e.allRowsStore.state,selectionStartRectStore:e.selectionStartRectStore,normalizedTableSelection:e.normalizedTableSelectionStore.state,frozenSectionWidth:e.frozenSectionWidthStore.state,frozenIndex:e.frozenIndexStore.state})},onPropertyEnter:async()=>{(await r).handlePropertyEnter({environment:t,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,showPropertyFormats:e.showPropertyFormats,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,allRows:e.allRowsStore.state,selectionStartRectStore:e.selectionStartRectStore,normalizedTableSelection:e.normalizedTableSelectionStore.state,frozenSectionWidth:e.frozenSectionWidthStore.state,frozenIndex:e.frozenIndexStore.state})},onPropertyClick:async(o,n,i)=>{(await r).handlePropertyClick({store:o,property:n,schema:i,environment:t,showPropertyFormats:e.showPropertyFormats,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,allRows:e.allRowsStore.state,selectionStartRectStore:e.selectionStartRectStore})},onPropertyEsc:async()=>{(await r).handlePropertyEsc({environment:t,collectionContextStore:e.collectionContextStore,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,showPropertyFormats:e.showPropertyFormats,groupFormat:e.groupFormat,allRows:e.allRowsStore.state,selectionStartRectStore:e.selectionStartRectStore,normalizedTableSelection:e.normalizedTableSelectionStore.state,frozenSectionWidth:e.frozenSectionWidthStore.state,frozenIndex:e.frozenIndexStore.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})},onPropertyBgClick:async()=>{(await r).handlePropertyBgClick(t,e.blockPropertyValueOverlayStore,e.showPropertyFormats,e.collectionContextStore,e.groupFormat,e.allRowsStore.state,e.selectionStartRectStore,e.normalizedTableSelectionStore.state,e.frozenSectionWidthStore.state,e.frozenIndexStore.state,e.disableHorizontalEdgeScroll)},onPropertyContextMenu:async o=>{(await r).handlePropertyContextMenu({mouseEvent:o,environment:t,collectionContextStore:e.collectionContextStore,allRows:e.allRowsStore.state,normalizedTableSelection:e.normalizedTableSelectionStore.state})},onOpenProperty:async o=>{(await r).handlePropertyOpenProperty({openProperty:o,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,disableHorizontalEdgeScroll:Boolean(e.disableHorizontalEdgeScroll),collectionContextStore:e.collectionContextStore,environment:t})},onSelectableEnter:async n=>{(await o).handleRowSelectableEnter({onEnterArgs:n,environment:t,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,allRows:e.allRowsStore.state,selectionStartRectStore:e.selectionStartRectStore})}})),[o,r,t,e.allRowsStore,e.blockPropertyValueOverlayStore,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.frozenIndexStore,e.frozenSectionWidthStore,e.groupFormat,e.normalizedTableSelectionStore,e.selectionStartRectStore,e.showPropertyFormats]);return(0,S.jsx)(S.Fragment,{children:e.render(i)})}),mo().A);function qu(e){const{isFullScreen:t,hasGroups:o,propertyWidths:n,hasPartialResults:r,hasSearchQuery:i,frozoneProps:l}=e,a=(0,s().v3)(),c=(0,u().DP)(),p=(0,s().Y0)().isPhone,m=(0,Z().Ks)(),g=(0,jr().A)(!0,0,100),h=(0,d().K8)((()=>Boolean(null==m?void 0:m.normalizedFormatStore.state.hide_table_vertical_lines)),[m]),f=l.isScrolled,v=l.frozenIndex,y=void 0!==v,x=(0,d().K8)((()=>{if(!m)return!1;const e=m.collectionViewBlockStore();return!!e&&(0,xd().d1)(e)}),[m]),C=(0,d().K8)((()=>m?(0,_().wy)({environment:a,collectionContextStore:m,isPhone:p,theme:c}):{}),[m,a,p,c]),b=(0,d().K8)((()=>Boolean(null==m?void 0:m.isInHomeWidgetStore.state)),[null==m?void 0:m.isInHomeWidgetStore]),w=(0,u().IS)((e=>{let t="0x 16px";return y?t=void 0:b&&(t=0),{container:{display:"flex",flexDirection:"row",alignItems:"flex-start"},rowsContainer:{display:"flex",flexDirection:"column",alignItems:"flex-start",width:"100%"},frozenColumnsContainer:{display:"flex",flexDirection:"row",...C,...-1===v?{background:void 0}:{}},multiselectCheckbox:{display:"flex",flexDirection:"row",pointerEvents:"none",cursor:"pointer",...C},rowContainer:{display:"flex",alignItems:"flex-start",padding:t,borderBottom:`1px solid ${e.tableDividerColor}`,width:"100%"},rowShimmer:{height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor,marginLeft:y?0:8},column:{display:"flex",height:32,padding:"0px 8px",alignItems:"center",borderRight:h?void 0:`1px solid ${e.tableDividerColor}`}}}),[y,b,C,v,h]);if(!g||!m)return null;const k=n.map(((e,t)=>(0,S.jsx)("div",{style:{...w.column,width:e},children:(0,S.jsx)(Er().A,{style:{...w.rowShimmer,width:.6*(e-16)}})},t)));let T=null,I=[];if(y&&void 0!==v){const e=k.slice(0,v+1);T=(0,S.jsxs)("div",{style:w.frozenColumnsContainer,children:[(0,S.jsx)(ju,{isCollectionViewBlockSelected:x,passesFilter:!0,shouldFreeze:-1!==v,children:e}),e.length>0?(0,S.jsx)(Wd,{isCollectionViewBlockSelected:x,passesFilter:!0,isShimmerRow:!0,isScrolled:f}):null]}),I=k.slice(v+1,k.length)}else I=k;let R=1;o||r||i||(R=t?10:3);const j=[...Array(R)].map(((e,t)=>(0,S.jsxs)("div",{style:w.rowContainer,children:[T,I]},t)));return(0,S.jsx)("div",{style:w.container,children:(0,S.jsx)("div",{style:w.rowsContainer,children:j})})}const Yu=n.memo((function(e){const{blockPropertyValueOverlayStore:t,collectionContextStore:r,disabled:i,format:l,groupFormat:a,isFullScreen:c,isInPeekRenderer:p,minWidth:m,paddingBottom:g,paddingLeft:h,paddingRight:f,query:v,schema:y,showHoverActionsStore:x,store:C,tableStore:b}=e,w=(0,Ae().X)("db_ux_simplification_next"),T=(0,Ae().X)("db_ux_empty_states"),I=(0,s().v3)(),{isMobile:R,isPhone:j}=(0,s().Y0)(),A=(0,k().tz)(),P=(0,u().DP)(),M=(0,n.useContext)(Br().n),V=(0,ue().Zp)(),F=(0,n.useMemo)((()=>a?[a]:[]),[a]),{groupState:O,groupCount:E}=(0,d().K8)((()=>({groupState:r.groupsStore.getGroupState(F),groupCount:r.groupsStore.getAllGroupStates().length})),[r.groupsStore,F]),{reducerResult:D,isReady:z,hasPartialResults:K,pageCount:H}=(0,d().K8)((()=>{const e=null==O?void 0:O.reducerResultStore.state;return{reducerResult:e,isReady:void 0!==e,hasPartialResults:void 0!==e&&e.blockIds.length>0,pageCount:(null==e?void 0:e.blockIds.length)||0}}),[O]),G=(0,d().K8)((()=>(0,bn().Kk)({collectionContextStore:r,groupsPointer:F})),[r,F]),W=(0,d().O$)(r.permissionScopesStore),N=(0,je().bx)(e.store,e.disabled),$=(0,d().K8)((()=>!!N&&(!W.isSyncedCollection&&W.canEditContent)),[N,W]),{showPropertyFormats:U,titleColumnIndex:q,propertyWidths:Y,totalPropertyWidth:X}=(0,d().K8)((()=>{const e=(0,_().GW)(l,b).filter((e=>e.visible)),t=R?e.slice(0,20):e,o=t.findIndex((e=>{let{property:t}=e;return"title"===t})),n=t.map((e=>{let{width:t}=e;return t||fd().kp}));return{showPropertyFormats:t,titleColumnIndex:o,propertyWidths:n,totalPropertyWidth:t.reduce(((e,t)=>e+(t.width||0)),0)}}),[R,l,b],{useDeepEqual:!0}),Q=(0,d().K8)((()=>(0,_().Ty)(l,b)),[l,b]),Z=(0,d().K8)((()=>X+(W.canEditContent?32:0)),[X,W]),J=(0,d().K8)((()=>"collectionTypedView"===r.contextType),[r]),ee=(0,d().O$)(r.isInHomeWidgetStore),oe=(0,d().O$)(r.isUnlistedViewStore),ne=(0,d().K8)((()=>oe&&r.isInlineViewStore.state),[r,oe]),re=(0,d().K8)((()=>(0,Se().sj)(C.id)),[C]),le=(0,d().K8)((()=>L().fG({collectionContextStore:r,environment:I,intl:A})),[r,I,A]),se=(0,d().K8)((()=>(0,bn().iv)({collectionContextStore:r,groupsPointer:F,hasPartialResults:K})),[r,F,K]),ae=(0,d().K8)((()=>{const e=Boolean(r.currentCombinatorFilterStore.state),t=r.currentPropertyFiltersStore.state.length>0;return e||t}),[r]),ce=z&&!se&&0===H,de=(0,d().K8)((()=>z&&!ee&&($||J)&&!!r.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0})&&(!T||!(ae&&ce))),[z,ee,$,J,r,T,ae,ce]),pe=(0,d().K8)((()=>!(oe||null!=V&&V.hideTableAggregationRow||T&&ae&&ce)),[oe,V,ae,ce,T]),me=(0,d().K8)((()=>L().XQ({collectionContextStore:r,reducerResult:D,isFullScreen:c})),[r,c,D]),ge=Boolean(a),ve=(0,d().K8)((()=>z&&!se&&!(c&&H>0)&&H<2&&de&&!ae&&!ge&&"on"===Io().default.getEligibleGroup({experimentId:"packaging_db_empty_states"})),[c,H,z,se,de,ae,ge]),ye=(0,d().K8)((()=>r.viewIsFlushToTopbar()),[r]),xe=(0,d().K8)((()=>Boolean(r.normalizedFormatStore.state.hide_table_vertical_lines)),[r]),be=(0,d().K8)((()=>{const e=(0,te().v2)(F[0],r);return ie().default.state.stores.filter((t=>e.includes(t))).length>0}),[F,r]),we=(0,d().K8)((()=>{const{isScrolled:e,frozenIndex:t,tryShowHiddenFrozenColumn:o}=r.frozoneStore.state;if(void 0===t)return{isScrolled:!1,frozenIndex:void 0,frozenStyles:{},shouldFreezeMultiSelectColumn:!1,shouldShowStickyMultiSelectColumn:!1,isCollectionViewBlockSelected:!1};const n={...(0,_().wy)({environment:I,collectionContextStore:r,isPhone:j,theme:P}),display:"flex",...e&&-1===t&&{height:"calc(100% - 1px)",borderBottom:`1px solid ${P.tableDividerColor}`}},i=Boolean(e&&-1===t),l=Boolean(i&&(o||be)),s=r.collectionViewBlockStore(),a=!!s&&(0,xd().d1)(s);return{isScrolled:Boolean(e),frozenIndex:t,frozenStyles:n,shouldFreezeMultiSelectColumn:i,shouldShowStickyMultiSelectColumn:l,isCollectionViewBlockSelected:a}}),[be,r,I,j,P],{useDeepEqual:!0}),ke=(0,d().K8)((()=>""!==r.searchQueryStore.state),[r]),Te=(0,d().K8)((()=>{const e=r.collectionViewStore();return $&&R&&!(null!=e&&e.isSyncedCollection())}),[$,r,R]),Ie=(0,d().O$)(r.defaultPageTemplateStore),Re=(0,d().K8)((()=>{var e,o;const n=null===(e=r.collectionStore())||void 0===e?void 0:e.id;return(t.state.isOpen&&(null===(o=t.state.collectionContextStore)||void 0===o||null===(o=o.collectionStore())||void 0===o?void 0:o.id))===n}),[t,r]),[Pe,Me]=(0,n.useState)(!1),Be=(0,n.useCallback)((()=>{Me(!0)}),[]),_e=(0,n.useCallback)((()=>{Me(!1)}),[]),Ve=(0,n.useCallback)((()=>{if(!O)return;const e=r.collectionStore();if(!e||!r.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return;const o=ie().default.state.stores[0];if(!o)return;const n=r.subitemTreeStore.state,i=(0,bo().Qe)(n.children,(e=>e.value.store===o));if(!i)return;const l=i?(0,te().kY)(i.map((e=>e.value.store))):"",s=r.subitemExpandedStore.state.get(l);Boolean(null==s?void 0:s.isExpanded)&&B().createAndCommit({userAction:"TableGroupResults.onItemShiftEnter",environment:I,canUndo:!0,perform:n=>{const l=(0,tn().u)({environment:I,collectionContextStore:r,groupsPointer:O.groupsPointer,store:o,before:!1,collectionStore:e,transaction:n,subitemPath:i,subitemInsertDirection:"into",from:"table_group_results_shift_enter"});if(l&&t){const e=()=>{Jo().ho({isNewBlock:!0,environment:I,blockPropertyValueOverlayStore:t,store:l,property:"title",format:Tt().j.Table,collectionContextStore:r})};r.registerCallbackForItemMounted(l,e)}}})}),[t,r,I,O]),Fe=(0,n.useCallback)((e=>{const n=new(o(838256).aD)(I,"handleAddRowClick");if(!(0,Ye().EF)(I)||!O)return n.fail("invalid_state"),void(0,Ye().QY)(I);r.searchQueryStore.state&&(0,jn().S)({searchQuery:"",collectionContextStore:r,isFullScreen:c}),B().createAndCommit({userAction:"TableGroupResults.handleAddRowClick",environment:I,canUndo:!0,perform:e=>{const o=(0,kn().Q)({environment:I,collectionContextStore:r,groupsPointer:a?[a]:[],shouldCoerce:!0,templateStore:Ie,transaction:e,from:{createBlock:"table_group_results"},tracker:n,inMemoryRecordCache:I.defaultRecordCache.inMemoryRecordCache});if(!o)return;const i=o.newStore;if(R){const e=(0,Zn().Ay)({store:i,fullyQualified:!1,pageVisitSource:wn().y8.Create});M?M(e):$n().oo({environment:I,url:e})}else{if(o.coercionSucceeded){const o=()=>{Jo().ho({isNewBlock:!0,environment:I,blockPropertyValueOverlayStore:t,store:i,property:"title",format:Tt().j.Table,collectionContextStore:r})};r.registerCallbackForItemMounted(i,o),e.postSubmitCallbacks.push((async e=>{if(!e)return r.virtualizedModule.waitToScrollToBlock(F,i)}))}else In().VU({environment:I,store:i,peekMode:L().hH(r),resultsStore:O.resultsStore,collectionContextStore:r,pageVisitSource:wn().y8.Create});const n=r.currentSubitemFormatStoreForCollectionStore.state;Qo().v(I,{from:n?"table_add_parent_item_bottom":"table_add_item_bottom",type:"page",new_page_id:i.id,creating_block_id:i.id,...(0,fe().sl)(r)})}}})}),[I,O,r,c,a,Ie,R,M,t,F]),Le=(0,n.useCallback)((e=>{O&&((0,Ce().kV)(e),D&&(0,So().H)({collectionContextStore:r,environment:I,incrementLimitArgs:{isFullScreen:c,currentResultCount:D.blockIds.length,groupsPointer:O.groupsPointer,incrementLimitsInRelatedGroups:!1}}),(0,vd().K)(I))}),[r,I,O,c,D]),Oe=(0,L().Oz)(r),Ee=(0,u().IS)((e=>{const{button:t,buttonInner:o,icon:n}=(0,_().BJ)({theme:e,isMobile:R,hideTextWithTransition:ve&&Pe,hideTextWithoutTransition:ve&&Re});return{wrapper:w&&F.length>0?{marginLeft:24}:{},iconStyle:n,viewAllButton:{borderTop:`1px solid ${e.tableDividerColor}`,paddingTop:6,paddingBottom:6},loadMoreButton:{...t,borderBottom:`1px solid ${e.tableDividerColor}`,whiteSpace:"break-spaces"},loadMoreButtonHovered:{...G?{background:e.whiteButtonBackground}:{}},loadMoreButtonInner:o,text:{color:e.lightTextColor,flexGrow:1},addRowButton:{...t,background:(null==Oe?void 0:Oe.background)||(p?e.cardContentBackground:e.contentBackground)},addRowButtonInner:o,linkExistingButton:{marginLeft:12,paddingLeft:6,paddingRight:6,borderRadius:6},linkExistingButtonInner:{display:"flex",alignItems:"center",fontSize:14,height:26},linkExistingIcon:{width:14,height:14,marginLeft:1,marginRight:5,fill:e.lightIconColor},aggregationRow:{...(!z||ee)&&{opacity:0,pointerEvents:"none",left:0,right:0}},spinner:{marginTop:1,marginLeft:8,marginRight:8}}}),[R,ve,Pe,Re,w,F.length,G,null==Oe?void 0:Oe.background,p,z,ee]),De=(0,n.useCallback)((e=>(0,S.jsx)(Xu,{args:e,store:C,collectionContextStore:r,collectionViewFormat:Q,blockPropertyValueOverlayStore:t,groupFormat:a,groupsPointer:F,propertyFormats:U,schema:y,canDrag:Te,disabled:i,titleColumnIndex:q,onShiftEnter:Ve,frozoneProps:we,isInHomeWidget:ee,isFullScreen:c,isInEphemeralView:ne})),[C,r,Q,t,a,F,U,y,Te,i,q,Ve,we,ee,c,ne]);return O?(0,S.jsxs)("div",{style:Ee.wrapper,children:[(0,S.jsx)(Iu,{store:C,format:Q,groupFormat:a,schema:y,query:v,collectionContextStore:r,isInPeekRenderer:p,minWidth:m,paddingBottom:g,paddingLeft:h,paddingRight:f,blockPropertyValueOverlayStore:t,resultStore:O.reducerResultStore,showPropertyFormats:U,showRightActions:W.canConfigureCollection&&W.canConfigureBlock&&!ne&&!re,showHoverActionsStore:x,allowHidingTitle:!1,tableStore:b,formatKey:"table_properties",disabled:i||!W.canConfigureBlock,disableTopBorder:!ye||ge||w,disableCellRightBorder:!ye||ge||xe||w,height:Ut().sH,frozoneProps:we,isInHomeWidget:ee,hasMoreReducerResults:!(null==D||!D.hasMore)}),(0,S.jsx)($u,{store:C,collectionContextStore:r,minWidth:m,blockPropertyValueOverlayStore:t,showPropertyFormats:U,disabled:!$,groupFormat:a,tableStore:b,paddingLeft:h,render:De}),se&&(0,S.jsx)(qu,{isFullScreen:c,hasGroups:void 0!==a,propertyWidths:Y,hasPartialResults:K,hasSearchQuery:ke,frozoneProps:we}),ce&&!ve&&(0,S.jsx)(Fd,{collectionContextStore:r,shouldShowAddRowButton:de,hasFilter:ae,handleAddRowClick:Fe,hasMultipleGroups:E>1}),ve&&(0,S.jsx)(Md,{collectionContextStore:r,handleAddRowClick:Fe,numberOfBlankRows:2-H,hideDefaultButtonText:Pe,isBlockPropertyValueOverlayOpen:Re}),(0,S.jsx)("div",{style:{width:Z}}),me&&(ee?(0,S.jsx)(ho().Ay,{groupsPointer:F,store:C,collectionContextStore:r,format:l,isFullScreen:c,incrementLimitsInRelatedGroups:!1,style:Ee.viewAllButton}):(0,S.jsx)(Rt().A,{onMouseDown:Ce().tr,onClick:Le,disabled:G,hoveredStyle:Ee.loadMoreButtonHovered,style:Ee.loadMoreButton,children:(0,S.jsxs)("span",{style:Ee.loadMoreButtonInner,children:[(0,Uo().P)(Ee.iconStyle),(0,S.jsx)("div",{style:Ee.text,children:(0,S.jsx)(k().sA,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})}),G?(0,S.jsx)("div",{style:Ee.spinner,children:(0,S.jsx)(En().A,{size:"sm"})}):$&&(0,S.jsx)(yd().w,{collectionContextStore:r,format:l})]})})),de&&!ve&&(0,S.jsx)(Rt().A,{onClick:Fe,onMouseDown:Ce().tr,style:Ee.addRowButton,className:he().$0P,children:(0,S.jsxs)("span",{style:Ee.addRowButtonInner,children:[(0,uo().W)(Ee.iconStyle),(0,S.jsx)(Bn,{collectionContextStore:r}),le&&(0,S.jsx)(Kn().O,{collectionContextStore:r,groupFormat:a,renderLinkButton:e=>(0,S.jsx)(Rt().A,{style:Ee.linkExistingButton,...e,children:(0,S.jsxs)("span",{style:Ee.linkExistingButtonInner,children:[(0,zn().H)(Ee.linkExistingIcon),(0,S.jsx)(k().sA,{id:"database.findOrCreatePage",defaultMessage:"Link existing"})]})})})]})}),pe&&(0,S.jsx)(Ad,{collectionContextStore:r,disabled:i||!W.canConfigureBlock,groupFormat:a,isFullScreen:c,isInPeekRenderer:p,onMouseEnter:Be,onMouseLeave:_e,paddingLeft:h,paddingRight:f,query:v,schema:y,showPropertyFormats:U,showRightActionsSpacer:W.canConfigureCollection,style:Ee.aggregationRow})]}):null})),Xu=n.memo((function(e){const{args:t,blockPropertyValueOverlayStore:o,canDrag:r,collectionContextStore:i,collectionViewFormat:l,disabled:a,frozoneProps:c,groupFormat:p,groupsPointer:m,isFullScreen:g,isInHomeWidget:h,onShiftEnter:f,propertyFormats:v,schema:y,store:x,titleColumnIndex:C,isInEphemeralView:b}=e,w=(0,s().v3)(),k=(0,d().K8)((()=>Boolean(i.normalizedFormatStore.state.hide_table_vertical_lines)),[i.normalizedFormatStore]),T=(0,d().K8)((()=>L().f5({environment:w,collectionContextStore:i})),[i,w]),I=(0,d().K8)((()=>x.isNonEditableState()),[x]),R=(0,u().IS)((()=>({itemSelectableHalo:{borderRadius:3,zIndex:86},itemSelectableStyle:{display:"flex",height:"calc(100% + 2px)"}})),[]),j=(0,n.useCallback)((()=>R.itemSelectableStyle),[R]),A=(0,n.useCallback)((e=>{const{store:t,parentStore:n,subitemPath:r,indentLevel:l}=e;if(n)return(0,S.jsx)(od,{store:t,collectionStore:n,subitemPath:r,indentLevel:l,collectionContextStore:i,disabled:a,groupsPointer:m,onSubitemCreate:e=>{if(o){const t=()=>{Jo().ho({isNewBlock:!0,environment:w,blockPropertyValueOverlayStore:o,store:e,property:"title",format:Tt().j.Table,collectionContextStore:i})};i.registerCallbackForItemMounted(e,t)}}})}),[o,i,a,w,m]),P=(0,d().K8)((()=>{const e=i.collectionViewBlockStore();return!(!e||i.isFullScreenStore.state)&&(0,xd().d1)(e)}),[i]),M=(0,d().K8)((()=>(0,te().v2)(p,i)),[p,i]),B=(0,d().K8)((()=>{const e=kd().A.state;if(e.isActive)return(0,_().yR)(e.selection,v.length,M.length)}),[M.length,v.length]),V=null==c?void 0:c.frozenIndex,F=(0,d().K8)((()=>L().qi(V)),[V]),[O,E]=(0,n.useMemo)((()=>void 0!==V?[v.slice(0,V+1),v.slice(V+1)]:[[],v]),[V,v]),D=(0,d().K8)((()=>{var e;return Boolean(null===(e=i.collectionViewStore())||void 0===e?void 0:e.getFormatStore().getKeyStore("table_wrap").getValue())}),[i]),z=(0,d().K8)((()=>{var e;return Boolean("timeline"===(null===(e=i.collectionViewStore())||void 0===e?void 0:e.getType())||!D&&!v.some((e=>e.wrap)))}),[i,v,D]),K=(0,d().K8)((()=>{const e=i.permissionScopesStore.state;return e.isLocked||!e.canConfigureCollection||!e.canConfigureBlock}),[i.permissionScopesStore]),H=(0,d().K8)((()=>{var e;return!h&&"timeline"!==(null===(e=i.collectionViewStore())||void 0===e?void 0:e.getType())}),[i,h]),G=(0,n.useMemo)((()=>({schema:y,collectionContextStore:i,propertyFormats:v,onPropertyTab:t.onPropertyTab,onPropertyUntab:t.onPropertyUntab,onPropertyEnter:t.onPropertyEnter,onPropertyClick:t.onPropertyClick,onPropertyEsc:t.onPropertyEsc,onPropertyBgClick:t.onPropertyBgClick,onPropertyContextMenu:t.onPropertyContextMenu,onOpenProperty:t.onOpenProperty,disabled:a,blockPropertyValueOverlayStore:o,disableCellBorderRight:k,disableHorizontalEdgeScroll:!1,disableLastCellBorderRight:I,disableTableWrap:!1,onShiftEnter:f,titleColumnIndex:C,groupFormat:p,frozoneProps:c,shouldShowMultiSelectCheckbox:T,isInHomeWidget:h,isCollectionViewBlockSelected:P,allRows:M,isInEphemeralView:b,normalizedTableSelection:B,unfrozenIndexAddendum:F,frozenPropertyFormats:O,unfrozenPropertyFormats:E,tableWrap:D,shouldSetCellHeight:z,isNonEditable:K,shouldShowRightActionSpacer:H})),[t.onOpenProperty,t.onPropertyBgClick,t.onPropertyClick,t.onPropertyContextMenu,t.onPropertyEnter,t.onPropertyEsc,t.onPropertyTab,t.onPropertyUntab,o,i,a,k,f,v,y,C,p,c,T,I,h,P,M,b,B,F,O,E,D,z,K,H]),W=(0,Ae().X)("collections_virtualize_grouped_tables"),N=g&&(W||0===m.length);return(0,S.jsx)(gn,{collectionContextStore:i,groupsPointer:m,format:l,canDrag:r,resultProps:G,canDrop:!0,resultComponent:Lu,disabled:a,direction:pn.Vertical,getItemSelectableStyle:j,itemSelectableHaloStyle:R.itemSelectableHalo,shouldShowHoverMenu:!0,analyticsName:"table",emptyDroppableSize:0,touchDragOnly:!0,onSelectableEnter:t.onSelectableEnter,blockPropertyValueOverlayStore:o,titleColumnIndex:C,nestedCreateSubitemButton:A,virtualizeResults:N,useGroupCompatibleVirtualizer:W})}),mo().A),Qu=n.memo((function(e){const{store:t,paddingBottom:o,paddingLeft:r,paddingRight:i,collectionContextStore:l,format:a,schema:c,disabled:p,isFullScreen:m,isRootChild:g,isInPeekRenderer:h,isPreviewing:f,query:v,showHoverActionsStore:y,blockPropertyValueOverlayStore:x,minWidth:C,placementStore:b}=e,w=(0,s().v3)(),k=(0,d().uB)(void 0,gd),T=(0,n.useRef)(null),I=(0,Ae().X)("db_ux_simplification_next"),R=(0,Ae().X)("collections_column_virtualization"),j=a.collection_group_by,A=m&&!j,P=(0,d().K8)((()=>(0,_().GW)(a,k)),[a,k]),M=(0,d().K8)((()=>(0,L().mM)(l,m)),[l,m]),B=(0,d().K8)((()=>l.isInHomeWidgetStore.state),[l.isInHomeWidgetStore]),V=(0,d().K8)((()=>!!l.viewsModuleContextStore.getViewModuleType()),[l]),F=(0,d().K8)((()=>{const e=l.settingsStore.state.open,t="sidebar"===b.state;return e&&t}),[l.settingsStore,b]),O=n.useCallback((e=>{const t=l.isLoadingStore.state,o=l.groupsStore.getGroupState([]),n=null==o?void 0:o.reducerResultStore.state;e<De().A.incrementScrollOffset&&n&&!t&&n.hasMore&&(l.infiniteScrollLongTaskObserver.observe(),(0,So().H)({collectionContextStore:l,environment:w,incrementLimitArgs:{isFullScreen:m,currentResultCount:n.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}}))}),[l,w,m]),E=(0,u().IS)((()=>({selectable:{position:"relative",marginRight:F?$t().vE:void 0},container:{position:"relative",float:"left",minWidth:"100%",WebkitUserSelect:"none",fontVariantNumeric:"lining-nums tabular-nums",paddingBottom:o,paddingLeft:r,paddingRight:i,marginTop:I?4:0}})),[o,r,i,F,I]),D=(0,ue().Zp)();return(0,Ar().A)((e=>{const n=(0,S.jsx)(lt().A,{store:t,shouldShowHalo:!m&&!B&&!f,canSelect:!m&&!V,disablePointerEvents:null==D?void 0:D.disableAllPointerEvents,analyticsName:"table",style:E.selectable,...e,children:j?(0,S.jsx)(Zu,{collectionContextStore:l,store:t,format:a,schema:c,query:v,isFullScreen:m,isRootChild:g,isInPeekRenderer:h,paddingLeft:r,paddingBottom:o,paddingRight:i,minWidth:C,tableStore:k,showHoverActionsStore:y,blockPropertyValueOverlayStore:x,disabled:p}):(0,S.jsx)(ep,{collectionContextStore:l,store:t,format:a,schema:c,query:v,isFullScreen:m,isInPeekRenderer:h,paddingLeft:r,paddingRight:i,paddingBottom:o,minWidth:C,tableStore:k,showHoverActionsStore:y,blockPropertyValueOverlayStore:x,disabled:p,groupFormat:void 0})});return(0,S.jsx)("div",{className:he().EOV,style:E.container,ref:T,children:(0,S.jsxs)(un.Provider,{value:T,children:[j?R?(0,S.jsx)(hd,{collectionContextStore:l,tableProperties:P,paddingLeft:r,paddingRight:i,children:n}):n:(0,S.jsx)(il().b,{nodeRef:T,children:R?(0,S.jsx)(hd,{collectionContextStore:l,tableProperties:P,paddingLeft:r,paddingRight:i,children:n}):n}),!M&&!A&&(0,S.jsx)(Cn().A,{onChange:e=>O(e)})]})})}))})),Zu=n.memo((function(e){let{collectionContextStore:t,store:o,format:r,schema:i,query:l,disabled:a,isFullScreen:c,paddingLeft:d,paddingRight:p,isRootChild:m,isInPeekRenderer:g,showHoverActionsStore:h,blockPropertyValueOverlayStore:f,minWidth:v,paddingBottom:y,tableStore:x}=e;const C=(0,s().v3)(),b=(0,u().IS)((e=>({groupDivider:{borderTop:`1px solid ${e.tableDividerColor}`}})),[]),w=(0,Ae().X)("db_ux_simplification_next"),k=(0,n.useCallback)(((e,t)=>w&&0===e.index?{marginTop:4}:w||t.isInHomeWidgetStore.state?{}:0!==e.index||t.viewIsFlushToTopbar()?e.index>0&&t.shouldShowSpinnerStore.state?{}:b.groupDivider:{}),[w,b.groupDivider]),T=(0,n.useCallback)(((e,o)=>{if(C.device.isMobile)Tn().uK({environment:C,store:e,pageVisitSource:wn().y8.Create});else{const{groupFormat:n}=o,r=n?[n]:[],i=t.groupsStore.getGroupState(r),l="collectionTypedView"===t.contextType;In().VU({environment:C,store:e,peekMode:(0,L().hH)(t),showMoveTo:l,resultsStore:null==i?void 0:i.resultsStore,collectionContextStore:t,pageVisitSource:wn().y8.Create})}}),[t,C]);return(0,S.jsx)(rs,{reducerId:"table_groups",store:o,collectionContextStore:t,disabled:a,isFullScreen:c,isRootChild:m,paddingLeft:d,stickyLeft:!0,renderGroup:e=>(0,S.jsx)(ep,{store:o,format:r,schema:i,query:l,collectionContextStore:t,showHoverActionsStore:h,isFullScreen:c,isInPeekRenderer:g,disabled:a,blockPropertyValueOverlayStore:f,minWidth:v,paddingBottom:y,paddingLeft:d,paddingRight:p,tableStore:x,groupFormat:e}),getGroupStyle:e=>k(e,t),renderHeader:e=>(0,S.jsx)(Ju,{args:e,isInPeekRenderer:g}),onGroupHeaderAddItem:(e,t,o)=>{T(e,o)}})})),Ju=n.memo((function(e){let{args:t,isInPeekRenderer:o}=e;const{collectionContextStore:n}=t,r=(0,d().O$)(n.isInHomeWidgetStore),i=(0,u().IS)((e=>({stickyStyle:{boxShadow:`0 -1px 0 ${o?e.cardContentBackground:e.contentBackground}`}})),[o]);return(0,S.jsx)(Gi,{...t,height:r?ft().ag:Ut().n1,paddingTop:0,toggleClosedMarginBottom:8,stickyStyle:i.stickyStyle})})),ep=n.memo((function(e){let{groupFormat:t,store:o,format:n,schema:r,query:i,collectionContextStore:l,showHoverActionsStore:s,isFullScreen:a,isInPeekRenderer:c,disabled:u,blockPropertyValueOverlayStore:p,minWidth:m,paddingBottom:g,paddingLeft:h,paddingRight:f,tableStore:v}=e;const y=(0,d().uB)(v,gd);return(0,d().K8)((()=>l.groupsStore.getGroupState(t?[t]:[])),[l,t])?(0,S.jsx)(Yu,{tableStore:y,groupFormat:t,store:o,format:n,schema:r,query:i,collectionContextStore:l,showHoverActionsStore:s,isFullScreen:a,isInPeekRenderer:c,disabled:u,blockPropertyValueOverlayStore:p,minWidth:m,paddingBottom:g,paddingLeft:h,paddingRight:f}):null}));var tp=()=>o(717989),op=()=>o(839106);class np extends p().default{constructor(){super("hiddenGroupsVisibleStore")}getInitialState(){return!1}}class rp extends p().default{getInitialState(){return new Set}}class ip extends(()=>o(959180))().A{constructor(){super(...arguments),this.itemsRefStore=new rp}findCollectionTimelineViewItems(e){return this.getMembersByDOMOrder({filter:t=>e.uiContains(t.props.store)})}register(e){const t=super.register(e);return this.itemsRefStore.state.has(e)||this.itemsRefStore.setState(new Set(this.itemsRefStore.state).add(e)),t}unregister(e){if(super.unregister(e),this.itemsRefStore.state.has(e)){const t=new Set(this.itemsRefStore.state);t.delete(e),this.itemsRefStore.setState(t)}}getItemsRefStore(){return this.itemsRefStore}}const lp=new ip;(0,o(604341).exposeDebugValue)("GlobalCollectionTimelineViewItemRegistry",lp);var sp=()=>o(396182),ap=()=>o(931121),cp=()=>o(259464);const dp=15,up=33,pp=12,mp={position:"absolute",left:0,top:0,zIndex:86,width:"100%",height:"100%",pointerEvents:"none"};function gp(e){const{startItemPosition:t,value:o}=e;return t&&o?(o&&t&&o.left<=t.left&&(o.right<t.left?o.left=o.right:(o.left=t.left+pp,o.top=o.top-dp)),o):o}function Sp(e){const{startItem:t,endItem:o,endRelationPointer:r,timelineState:i,disabled:a,isFullScreen:c,isRootChild:p,relationType:m,isUserDrawnTemp:g,isNewSubitemPlaceholder:h,renderEmitter:f}=e,v=(0,Z().ET)(),y=(0,s().v3)(),x=(0,sp().I)(),[C,b]=(0,n.useState)(!1),w=(0,u().DP)(),[k,T]=(0,n.useState)(null),[I,R]=(0,n.useState)(null),j=(0,n.useCallback)((e=>{T(e.state)}),[]),A=(0,n.useCallback)((e=>{R(e.state)}),[]),P=(0,n.useCallback)((()=>{l().default.afterNextFlush((()=>{x()}))}),[x]);(0,n.useEffect)((()=>(T(t.stores.nodeStore.state),R(o?o.stores.nodeStore.state:null),t.stores.nodeStore.addListener(j),null==o||o.stores.nodeStore.addListener(A),null==f||f.addListener(P),v.filtersBarOpenStore.addListener(P),()=>{t.stores.nodeStore.removeListener(j),null==o||o.stores.nodeStore.removeListener(A),null==f||f.removeListener(P),v.filtersBarOpenStore.removeListener(P)})),[t,o,f,j,A,P,v.filtersBarOpenStore]);const M=(0,d().K8)((()=>To().Ay.state.isDragging&&To().Ay.state.draggedStores.includes(t.props.store)),[t]),B=(0,d().K8)((()=>o&&To().Ay.state.isDragging&&To().Ay.state.draggedStores.includes(o.props.store)),[o]),_=(0,d().K8)((()=>{const e=To().Ay.state;return e.isDragging?e.currentY-e.startY:0}),[]),V=k&&k.getBoundingClientRect().y+(M?_:0),F=(0,d().K8)((()=>{const e=t.itemPositionStore.state;return V&&e?{left:e.left,right:"subitem"===m?e.left+pp:e.right,top:"subitem"===m?V+dp:V}:void 0}),[m,t.itemPositionStore,V]),L=I&&I.getBoundingClientRect().y+(B?_:0),O=(0,d().K8)((()=>{const e=L&&null!=o&&o.itemPositionStore.state?{...o.itemPositionStore.state,top:L}:void 0;return"subitem"===m?gp({startItemPosition:t.itemPositionStore.state,value:e}):e}),[o,L,m,t.itemPositionStore]),E=(0,d().O$)(t.dateValueStore),D=(0,d().K8)((()=>null==o?void 0:o.dateValueStore.state),[o]),z=(0,d().K8)((()=>void 0!==i.dragStateStore.state),[i]),K=(0,d().K8)((()=>void 0!==i.drawStateStore.state),[i]),H=(0,d().O$)(i.hoveredItemStore),G=C&&!z&&!K,W=(0,n.useCallback)((()=>{r&&!a&&tp().cd({dependency:{store:t.props.store,relationPointer:r},collectionContextStore:v,environment:y,timelineState:i,isFullScreen:c,isRootChild:p})}),[t,a,r,v,y,i,c,p]),N=(0,n.useCallback)((()=>{b(!0)}),[b]),$=(0,n.useCallback)((()=>{b(!1)}),[b]),U=(0,n.useCallback)((e=>{if(O)return(0,S.jsx)(hp,{topOffset:e,endPosition:O,handleCloseButtonClick:W})}),[O,W]),q=(0,d().O$)(v.permissionScopesStore),Y=H===t.props.store,X=o&&H===o.props.store,Q=Y||X||G||"subitem"===m?1:.7;let J;const ee=(0,d().K8)((()=>t.props.store.canEdit()),[t.props.store]),te=(0,d().K8)((()=>"subitem"!==m&&(ee&&("collectionTypedView"===v.contextType||q.canEditContent))),[m,ee,v,q.canEditContent]);"subitem"===m?J=w.collectionUnsetDependencyArrow:E&&D&&(J=E<=D?w.collectionValidDependencyArrow:w.collectionInvalidDependencyArrow);const oe=(0,u().IS)((()=>({svgStyle:{zIndex:"dependency"===m&&(G||X)?86:83}})),[m,G,X]);return F?g?(0,S.jsx)(fp,{startPosition:F,timelineState:i}):h?(0,S.jsx)(vp,{startPosition:F,timelineState:i}):t!==o&&O?(0,S.jsx)(yp,{startPosition:F,endPosition:O,strokeOpacity:Q,strokeColorOverride:J,svgStyle:oe.svgStyle,cornerRadiusOverride:"subitem"===m?8:void 0,relationType:m,handleMouseMove:N,handleMouseLeave:$,renderChildren:te&&G?U:void 0}):null:null}function hp(e){const{topOffset:t,endPosition:o,handleCloseButtonClick:n}=e,r=(0,u().IS)((e=>({icon:{background:e.white,borderRadius:5,fill:e.accentColors.red[500],height:14,width:14}})),[]);return(0,S.jsx)(S.Fragment,{children:(0,S.jsx)("foreignObject",{width:16,height:16,x:o.left-16,y:o.top-t+8,style:{cursor:"pointer",pointerEvents:"all"},onClick:n,children:(0,ap().J)(r.icon)})})}function fp(e){const{startPosition:t,timelineState:o}=e,n=(0,d().K8)((()=>{const e=o.drawStateStore.state;if(!e||void 0===e.xOffsetPx||void 0===e.yOffsetPx)return;return{left:t.right+e.xOffsetPx+18,top:t.top+e.yOffsetPx}}),[t,o.drawStateStore]);return n?(0,S.jsx)(yp,{startPosition:t,endPosition:n,strokeOpacity:1,relationType:"dependency"}):null}function vp(e){var t;const{startPosition:o,timelineState:n}=e,r=(0,u().DP)(),i=(0,d().O$)(n.dateRangePlaceholderStore),l=(0,d().K8)((()=>null!=i&&i.active?i.date:void 0),[i]),s=null!=i&&i.active?null===(t=i.newTimelineItemProps)||void 0===t?void 0:t.subitemPath:void 0,a=s?s[s.length-1].children.length:0,c=o.top+a*up+dp+5,p=(0,d().K8)((()=>{const e=(0,qt().BD)({timelineState:n,dateValue:l,placeholderDate:l,subitemPlaceholderDate:void 0}),t=c&&e?{...e,top:c}:void 0;return gp({startItemPosition:o,value:t})}),[l,c,o,n]);return p?(0,S.jsx)(yp,{startPosition:o,endPosition:p,strokeOpacity:1,strokeColorOverride:r.collectionUnsetDependencyArrow,relationType:"subitem"}):null}function yp(e){const{startPosition:t,endPosition:o,strokeColorOverride:r,cornerRadiusOverride:i,strokeOpacity:l,relationType:s,svgStyle:a,handleMouseMove:c,handleMouseLeave:p}=e,m=(0,Z().ET)(),g=(0,u().DP)(),[h,f]=(0,n.useState)(0),v=t.right,y=t.top+dp-h,x=o.left-3,C=o.top+dp-h,b=(0,d().K8)((()=>{if(r)return r;return(0,qt().tH)(m)&&t.right&&o.left?t.right<o.left?g.collectionValidDependencyArrow:g.collectionInvalidDependencyArrow:g.collectionUnsetDependencyArrow}),[m,o.left,t.right,r,g]);return(0,S.jsx)("svg",{style:{...mp,...a},ref:e=>{e&&f(e.getBoundingClientRect().top)},children:(0,S.jsx)(cp().A,{startPoint:{x:v,y},endPoint:{x,y:C},style:{stroke:b,strokeWidth:qt().cC,strokeOpacity:l},useRightAngles:"subitem"===s,showArrowHead:"dependency"===s&&!e.renderChildren,cornerRadiusOverride:i,handleMouseMove:c,handleMouseLeave:p,children:e.renderChildren&&e.renderChildren(h)})})}function xp(e){const{timelineState:t,disabled:o,isReady:r,isFullScreen:i,isRootChild:l,renderEmitter:s}=e,a=(0,Z().ET)(),c=(0,n.useCallback)((()=>{t.drawStateStore.setState(void 0)}),[t.drawStateStore]),u=(0,d().K8)((()=>a.collectionViewBlockStore()),[a]),p=(0,d().K8)((()=>a.settingsStore.state.open),[a]);if((0,n.useEffect)((()=>{var e;!p&&null!==(e=t.drawStateStore.state)&&void 0!==e&&e.tryToCompleteDrawnArrow&&c()}),[p,t.drawStateStore,c]),!r||!u)return null;const m=lp.findCollectionTimelineViewItems(u);return(0,S.jsx)(S.Fragment,{children:m.map((e=>{const{store:r,groupFormat:a}=e.props,c=null==a?void 0:a.value,d=c?(0,so().AC)(c):"noGroup";return(0,S.jsxs)(n.Fragment,{children:[(0,S.jsx)(Cp,{startItem:e,timelineState:t,disabled:o,isFullScreen:i,isRootChild:l,renderEmitter:s,relationType:"dependency"},`${r.id}-${d}-${r.key}-dependency`),(0,S.jsx)(Cp,{startItem:e,timelineState:t,disabled:o,isFullScreen:i,isRootChild:l,renderEmitter:s,relationType:"subitem"},`${r.id}-${d}-${r.key}-subitem`)]},`${r.id}-${d}-${r.key}`)}))})}function Cp(e){const{startItem:t,timelineState:o,disabled:r,isFullScreen:i,isRootChild:l,relationType:s,renderEmitter:a}=e,{store:c,schema:u}=t.props,p=(0,Z().ET)(),m=(0,d().K8)((()=>"dependency"===s?o.drawStateStore.state:void 0),[o.drawStateStore,s]),g=(0,d().K8)((()=>(null==m?void 0:m.startStore)===c),[c,m]),h=(0,d().K8)((()=>g&&!(null!=m&&m.tryToCompleteDrawnArrow)),[m,g]),f=(0,d().K8)((()=>"dependency"===s?g&&m?m.temporaryDependencyRelationPointers:(0,qt().GW)(p,c,u):"subitem"===s?(0,qt().s0)(p,c,u):[]),[s,g,m,p,c,u]),v=(0,d().K8)((()=>p.collectionViewBlockStore()),[p]),y=(0,d().K8)((()=>{var e;const n=o.dateRangePlaceholderStore.state;if("subitem"!==s||null==n||!n.active||!n.newTimelineItemProps)return;const r=n.newTimelineItemProps.subitemPath;return(r?null===(e=r[r.length-1])||void 0===e?void 0:e.value.store:void 0)===t.props.store?n:void 0}),[s,t.props.store,o.dateRangePlaceholderStore]),x=(0,d().K8)((()=>[...lp.getItemsRefStore().state]),[]);return v?(0,S.jsxs)(S.Fragment,{children:[f.map((e=>{if(c.id===e.id)return null;const d=x.filter((t=>t.props.store.id===e.id));return(0,S.jsx)(n.Fragment,{children:d.map((n=>{const c=n.props.store,d=n.props.groupFormat;return(0,S.jsx)(Sp,{startItem:t,endItem:n,endRelationPointer:e,timelineState:o,disabled:r,isFullScreen:i,isRootChild:l,renderEmitter:a,relationType:s},`${c.id}-${null==d?void 0:d.value.value}-${c.key}`)}))},e.id)})),"dependency"===s&&h&&(0,S.jsx)(Sp,{isUserDrawnTemp:!0,startItem:t,endItem:void 0,endRelationPointer:void 0,timelineState:o,disabled:!1,isFullScreen:i,isRootChild:l,relationType:"dependency"}),"subitem"===s&&y&&(0,S.jsx)(Sp,{isNewSubitemPlaceholder:!0,startItem:t,endItem:void 0,endRelationPointer:void 0,timelineState:o,disabled:!1,isFullScreen:i,isRootChild:l,relationType:"subitem"})]}):null}const bp=n.memo((function(e){const{zoomLevel:t,onChange:o}=e,r=(0,s().Y0)(),i=(0,u().IS)((e=>({icon:{width:10,marginLeft:4,fill:e.mediumIconColor}})),[]),l=(0,n.useMemo)((()=>(0,_l().b)(i.icon)),[i.icon]),a=(0,n.useCallback)((e=>(0,S.jsxs)(rt().p,{size:"sm",isGray:!0,...e,children:[(0,S.jsx)(wp,{zoomLevel:t}),l]})),[l,t]),c=(0,n.useCallback)((e=>(0,S.jsx)(kp,{parent:e,zoomLevel:t,onChange:o})),[t,o]);return(0,S.jsx)(Ri().Ay,{popupType:r.isMobile?aa().nl.SlideUp:aa().nl.Popup,originGap:8,renderOrigin:a,render:c})})),wp=n.memo((function(e){const{zoomLevel:t}=e;return"hours"===t?(0,S.jsx)(k().sA,{id:"database.timelineView.zoomLevel.hours",defaultMessage:"Hours"}):"day"===t?(0,S.jsx)(k().sA,{id:"database.timelineView.zoomLevel.day",defaultMessage:"Day"}):"week"===t?(0,S.jsx)(k().sA,{id:"database.timelineView.zoomLevel.week",defaultMessage:"Week"}):"bi_week"===t?(0,S.jsx)(k().sA,{id:"database.timelineView.zoomLevel.biWeek",defaultMessage:"Bi-week"}):"month"===t?(0,S.jsx)(k().sA,{id:"database.timelineView.zoomLevel.month",defaultMessage:"Month"}):"quarter"===t?(0,S.jsx)(k().sA,{id:"database.timelineView.zoomLevel.quarter",defaultMessage:"Quarter"}):"year"===t?(0,S.jsx)(k().sA,{id:"database.timelineView.zoomLevel.year",defaultMessage:"Year"}):"5_years"===t?(0,S.jsx)(k().sA,{id:"database.timelineView.zoomLevel.years",defaultMessage:"5 Years"}):void(0,b().HB)(t)})),kp=n.memo((function(e){const{zoomLevel:t,onChange:o,parent:r}=e,{isMobile:i}=(0,s().Y0)(),l=(0,n.useMemo)((()=>[{key:"calendar by section",render:e=>(0,S.jsx)(ui().A,{...e}),items:fd().Ui.map((e=>{const t={key:e,render:t=>(0,S.jsx)(Ii().A,{...t,title:(0,S.jsx)(wp,{zoomLevel:e})}),action:()=>{o(e),r.close()}};return t}))}]),[o,r]),a=(0,n.useCallback)((e=>{const o=i?{menuType:li().gu.Modal,title:(0,S.jsx)(k().sA,{defaultMessage:"Select a zoom level",id:"database.timelineView.mobileTimelineZoomPicker.title"}),right:(0,S.jsx)(di().DoneMenuText,{}),onClickRight:r.close,...e}:{menuType:li().gu.Popup,width:180,...e};return(0,S.jsx)(ai().A,{...o,children:(0,S.jsx)(ci().Ay,{type:ci().Oh.Vertical,sections:l,initialFocus:fd().Ui.indexOf(t)})})}),[i,r.close,l,t]);return(0,S.jsx)(it().A,{capture:!0,allowEsc:!0,render:a})})),Tp=6,Ip=qt().tp+qt().lH,Rp=n.memo((function(e){let{timelineState:t,scrollerLeftOffset:i,paddingLeft:l,showTable:a,isFullScreen:c,isRootChild:p,isReady:m,collectionContextStore:g,isInPeekRenderer:h,format:f,paddingRight:v}=e;const y=(0,u().DP)(),x=(0,s().v3)(),C=(0,d().K8)((()=>{const e=t.zoomLevelStore.state,{primaryDisplayUnit:o,secondaryDisplayUnit:n}=qt().eM[e],s=t.scrollLeftStore.state,{startTimestamp:d}=t.currentRangeStore.state;if(void 0!==s){const t=d+(0,qt().C1)(e,s+i+(!a&&c?l:0));return(0,qt().DY)(r().c9.fromMillis(t),o).startOf(n).valueOf()}}),[t,i,l,a,c]),b=(0,s().Y0)(),T=(0,d().O$)(t.zoomLevelStore),I=(0,d().K8)((()=>t.outerSizeObserver.rect.state.width),[t]),{secondaryDisplayUnit:R}=qt().eM[T],j=(0,d().K8)((()=>(0,qt().DG)({environment:x,isFullScreen:c,isRootChild:p})),[x,c,p]),A=(0,d().O$)(g.permissionScopesStore),P=!a&&j&&A.canConfigureBlock,M=(0,L().Oz)(g),_=(null==M?void 0:M.background)||(h?y.cardContentBackground:y.contentBackground),V=h?y.cardContentBackgroundTransparent:y.contentBackgroundTransparent,F=(0,u().IS)((()=>({secondaryDisplayUnit:{position:"absolute",top:1,left:"calc(-1 * var(--sticky-horizontal-offset, 0px))",paddingLeft:c&&!a?i+l:i,display:"flex",alignItems:"center",height:Ip,paddingTop:Tp+(b.isMobile?2:0),background:_,fontSize:14,fontWeight:w().Wy.medium},outerContainer:{position:"sticky",left:0,width:I,zIndex:2,height:0},controlBarRight:{position:"absolute",top:1,right:"var(--sticky-horizontal-offset, 0px)",paddingRight:v,display:"flex",alignItems:"center",height:Ip,paddingTop:Tp+1,background:_},hideTableIcon:{paddingLeft:4,paddingRight:4,marginLeft:2,marginRight:4,marginTop:b.isIOS?0:1,height:22,fill:y.lightIconColor}})),[_,b.isIOS,b.isMobile,c,I,l,v,i,a,y.lightIconColor]),O=(0,n.useRef)(null),E=(0,n.useCallback)((e=>{tp().k3({timelineState:t,environment:x,zoomLevel:e,centerTimestamp:(0,qt().o$)(t)}),(0,op().z2)(x,(0,op().ZR)({environment:x,collectionContextStore:g,timelineState:t,isFullScreen:c,isRootChild:p}))}),[t,x,g,c,p]);return(0,S.jsx)(Ki().g,{stickyAttachPoint:"ceiling",nodeRef:O,noPlaceholder:!0,children:(0,S.jsxs)("div",{style:F.outerContainer,ref:O,children:[C&&(0,S.jsxs)("div",{style:F.secondaryDisplayUnit,children:[P&&(0,S.jsx)(At().A,{render:e=>(0,S.jsx)(rt().p,{size:"sm",onClick:()=>function(e,t,o,n,r,i){const l=n.collectionViewStore();if(!l)return;B().createAndCommit({userAction:"CollectionTimelineViewControlBar.handleShowTableClick",environment:e,canUndo:!0,perform:e=>{const o=(0,qt().iH)(t,!0);Nn().zA({stores:[l],update:o,transaction:e})}}),(0,op().VD)(e,{...(0,op().ZR)({environment:e,collectionContextStore:n,timelineState:o,isFullScreen:r,isRootChild:i}),show:!0})}(x,f,t,g,c,p),style:F.hideTableIcon,...e,children:(0,o(996624).a)({width:14})}),renderTooltip:()=>(0,S.jsx)(k().sA,{id:"database.timelineView.controlHeader.showTableButton.title",defaultMessage:"Show table"})}),(0,S.jsx)("span",{style:{paddingLeft:P||b.isPhone?0:c||a?16:2},children:(0,qt().Kx)(C,R)}),!m&&!a&&(0,S.jsx)(jp,{}),(0,S.jsx)("div",{style:{width:30,marginRight:-30,height:"100%",backgroundImage:`linear-gradient(to right, ${_} 20%, ${V} 100%)`}})]}),(0,S.jsxs)("div",{style:F.controlBarRight,children:[(0,S.jsx)("div",{style:{width:30,marginLeft:-30,height:"100%",backgroundImage:`linear-gradient(to left, ${_} 20%, ${V} 100%)`}}),(0,S.jsx)(Ec,{collectionContextStore:g}),(0,S.jsx)(bp,{zoomLevel:T,onChange:E}),(0,S.jsx)(rt().p,{size:"sm",isGray:!0,onClick:()=>function(e,t,o,n,r,i,l){const s=t.zoomLevelStore.state,a=t.outerSizeObserver.rect.state.width,c=(0,qt().Ho)({environment:e,paddingLeft:o,format:n,isFullScreen:r,isRootChild:i}),d=(a-c)/2,u=(0,qt().o$)(t),p=u-(0,qt().C1)(s,d);tp().k3({timelineState:t,environment:e,zoomLevel:s,centerTimestamp:p}),(0,op().i6)(e,{...(0,op().ZR)({environment:e,collectionContextStore:l,timelineState:t,isFullScreen:r,isRootChild:i}),type:"left"})}(x,t,l,f,c,p,g),style:{marginLeft:4,paddingLeft:4,paddingRight:4},children:(0,wc().I)({width:12,fill:y.mediumIconColor})}),(0,S.jsx)(rt().p,{size:"sm",onClick:()=>function(e,t,o,n,r,i,l){const s=t.zoomLevelStore.state,a=(0,qt().uW)({timestamp:Date.now(),environment:e,timelineState:t,paddingLeft:o,format:n});tp().k3({timelineState:t,environment:e,zoomLevel:s,centerTimestamp:a}),(0,op().AP)(e,{...(0,op().ZR)({environment:e,collectionContextStore:r,timelineState:t,isFullScreen:i,isRootChild:l})})}(x,t,l,f,g,c,p),children:(0,S.jsx)(k().sA,{id:"database.timelineView.controlHeader.todayButton.title",defaultMessage:"Today"})}),(0,S.jsx)(rt().p,{size:"sm",isGray:!0,onClick:()=>function(e,t,o,n,r,i,l){const s=t.zoomLevelStore.state,a=t.outerSizeObserver.rect.state.width,c=(0,qt().Ho)({environment:e,paddingLeft:o,format:n,isFullScreen:r,isRootChild:i}),d=(a-c)/2,u=(0,qt().o$)(t),p=u+(0,qt().C1)(s,d);tp().k3({timelineState:t,environment:e,zoomLevel:s,centerTimestamp:p}),(0,op().i6)(e,{...(0,op().ZR)({environment:e,collectionContextStore:l,timelineState:t,isFullScreen:r,isRootChild:i}),type:"right"})}(x,t,l,f,c,p,g),style:{paddingLeft:4,paddingRight:4},children:(0,kc().V)({width:12,fill:y.mediumIconColor})})]})]})})}));function jp(){return(0,jr().A)(!0,400,0)?(0,S.jsx)(En().A,{style:{marginLeft:8,marginTop:1}}):null}var Ap=()=>o(496506),Pp=()=>o(402390);function Mp(e){const{shouldShowShimmer:t,children:o}=e,n=(0,jr().A)(t,0,100)?"notion-shimmer-timeline-transition notion-shimmer-timeline":"notion-shimmer-timeline-transition";return(0,S.jsx)("div",{className:n,style:{height:"100%"},children:o})}const Bp=4,_p=22,Vp=110,Fp=7,Lp=22,Op=12,Ep=4,Dp=32;function zp(e){var t;const{collectionContextStore:o,isInPeekRenderer:i,timelineState:l,query:a,schema:c}=e,p=(0,s().Y0)(),m=(0,k().tz)(),g=(0,Ae().X)("db_ux_simplification_next"),h=(0,n.useRef)(null),{value:f}=(0,ne().fJ)(me().T.formulas),v=(0,sp().I)(),y=(0,n.useCallback)((()=>{0===(new Date).getSeconds()&&v()}),[v]);(0,n.useEffect)((()=>{const e=setInterval(y,1e3);return()=>clearInterval(e)}),[y]);const{primaryDisplayUnit:x,activeRangeType:b}=(0,d().K8)((()=>{const e=l.zoomLevelStore.state;return qt().eM[e]}),[l]),w=(0,qt().LH)(x),T=r().c9.now(),I=w?T.startOf("minute"):T.startOf("day"),R=T.startOf("minute"),j=(0,d().K8)((()=>!o.groupsStore.anyGroupHasNonEmptyResults()&&(0,bn().iv)({collectionContextStore:o,groupsPointer:[],hasPartialResults:!1})),[o]),A=(0,d().K8)((()=>o.viewIsFlushToTopbar()),[o]),P=new(Ap().default)((()=>{const e=o.collectionStore();if(!e)return;const t=l.dragStateStore.state,n=l.zoomLevelStore.state,r=l.hoveredItemStore.state,i=l.dateRangePlaceholderStore.state,{activeRangeType:s}=qt().eM[n];if(!s)return;let d;if(t)d=t.temporaryValues.map((e=>(0,qt().yl)(e,"day")));else if(i.active)d=[(0,qt().yl)(i.date,"day")];else{const{stores:t}=ie().default.state,n=t.filter((t=>t.getAssociatedCollectionId()===e.id)),i=C().sb(C().oE([...n,r]));d=C().oE(i.map((e=>{const t=(0,qt().GM)({store:e,query:a,schema:c,userId:o.getCurrentUserId(),intl:m,formulasModule:f});if(t)return(0,qt().yl)(t,"day")})))}const u=C().wq(d,(e=>{let{start:t}=e;return t.valueOf()})),p=C().Sk(d,(e=>{let{end:t}=e;return t.valueOf()}));return u&&p?{start:u.start.valueOf(),end:p.end.valueOf()}:void 0}),{debugName:"activeRangeStore"}),M=null===(t=(0,L().Oz)(o))||void 0===t?void 0:t.background,B=(0,u().IS)((e=>({wrapper:{position:"absolute",left:0,top:0,width:"100%",background:M||(i?e.cardContentBackground:e.contentBackground),boxSizing:"border-box",boxShadow:A&&!g?`inset 0 var(--timeline-box-shadow, 1px) 0 0 ${e.tableDividerColor}`:void 0},controlBar:{height:Ip,position:"relative",overflow:"hidden"},primaryTimeBar:{height:Dp,boxShadow:`inset 0 -1px 0 0 ${e.tableDividerColor}`,boxSizing:"border-box",position:"relative",overflow:"hidden"},stickyStyle:{outline:void 0,"--timeline-box-shadow":"0px"},transitionStickyStyle:{display:"none"}})),[M,g,i,A]);return(0,S.jsx)(Ki().g,{stickyAttachPoint:"ceiling",nodeRef:h,stickyStyle:B.stickyStyle,transitionStickyStyle:B.transitionStickyStyle,noPlaceholder:!0,children:(0,S.jsxs)("div",{style:B.wrapper,ref:h,children:[(0,S.jsx)("div",{style:B.controlBar,children:!p.isPhone&&(0,S.jsx)(Xp,{timelineState:l})}),(0,S.jsxs)("div",{style:B.primaryTimeBar,children:[(0,S.jsx)(Mp,{shouldShowShimmer:j,children:(0,S.jsx)(Yp,{timelineState:l,nowTimeStartOfPrimaryDisplayUnit:I})}),"highlight_days"===b&&(0,S.jsx)(Zp,{timelineState:l,activeRangeStore:P}),(0,S.jsx)(Qp,{timelineState:l,time:I}),"display_range"===b&&(0,S.jsx)(Zp,{timelineState:l,activeRangeStore:P})]}),(0,S.jsx)(Np,{timelineState:l,time:R})]})})}function Kp(e){const{time:t,isNowIndicator:o,timelineState:n}=e,r=n.zoomLevelStore.state,{startTimestamp:i}=n.currentRangeStore.state,{primaryDisplayUnit:l,primaryDisplayUnitAlignment:s}=qt().eM[r],a=(0,qt().DY)(t,l),c=(0,qt().Vz)(t,l),d=(0,qt().w0)(r,a.valueOf()-i),u=(0,qt().w0)(r,t.valueOf()-i),p=(0,qt().w0)(r,c.valueOf()-i)-d,m=o?Ep:0;return{left:("range_start"===s?u-p/2:u)-m,width:p+2*m}}function Hp(e){return{color:e.regularTextColor,fontSize:Op}}function Gp(e){return{background:e.timelineRed,width:Lp,height:Lp,borderRadius:Lp/2,position:"absolute",left:`calc(50% - ${Lp/2}px)`,top:`calc(50% - ${Lp/2}px)`}}function Wp(e){const{time:t,accent:o,timelineState:r}=e,i=(0,d().O$)(r.zoomLevelStore),{left:l,width:s}=(0,d().K8)((()=>Kp({time:t,isNowIndicator:!1,timelineState:r})),[t,r]),a=(0,u().IS)((e=>({container:{position:"absolute",top:0,left:l,width:s,height:Dp-4,display:"flex",alignItems:"start",lineHeight:Dp-4+"px"},text:{fontSize:Op,margin:"0 auto"},singleColor:{color:o?e.regularTextColor:e.lightTextColor},twoColorDarker:{color:o?e.regularTextColor:e.mediumTextColor},twoColorLighter:{color:o?e.mediumTextColor:e.lightTextColor}})),[o,l,s]),c=(0,n.useMemo)((()=>{const{primaryDisplayUnit:t}=qt().eM[i],o=e.time.setLocale(bc().locale),n=(0,qt().IW)(),r=o.toFormat("t").startsWith(o.toFormat("a"));if("fifteen_minutes"===t){if(n)return(0,S.jsx)("span",{style:a.singleColor,children:o.toFormat("H:mm")});{const e=(0,S.jsx)("span",{style:{...a.twoColorDarker,paddingRight:r?void 0:3},children:o.toFormat("h:mm")}),t=(0,S.jsx)("span",{style:{...a.twoColorLighter,paddingRight:r?3:void 0},children:o.toFormat("a")});return r?(0,S.jsxs)(S.Fragment,{children:[t,e]}):(0,S.jsxs)(S.Fragment,{children:[e,t]})}}if("hour"===t){if(n)return(0,S.jsx)("span",{style:a.singleColor,children:o.toFormat("H:mm")});{const e=(0,S.jsx)("span",{style:{...a.twoColorDarker,paddingRight:r?void 0:3},children:o.toFormat("h")}),t=(0,S.jsx)("span",{style:{...a.twoColorLighter,paddingRight:r?3:void 0},children:o.toFormat("a")});return r?(0,S.jsxs)(S.Fragment,{children:[t,e]}):(0,S.jsxs)(S.Fragment,{children:[e,t]})}}return"day"===t||"week"===t?"week"===i||"bi_week"===i?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("span",{style:{...a.twoColorLighter,paddingRight:3},children:o.toFormat("ccccc")}),(0,S.jsx)("span",{style:{...a.twoColorDarker,padding:"2px 7px"},children:o.toFormat("d")})]}):(0,S.jsx)("span",{style:a.singleColor,children:o.toFormat("d")}):"month"===t?(0,S.jsx)("span",{style:a.singleColor,children:o.toFormat("M")}):void(0,b().HB)(t)}),[i,e.time,a.singleColor,a.twoColorDarker,a.twoColorLighter]);return(0,S.jsx)("div",{style:a.container,children:(0,S.jsx)("div",{style:a.text,children:c})})}function Np(e){const{time:t,timelineState:o}=e,r=(0,d().O$)(o.zoomLevelStore),{startTimestamp:i}=(0,d().O$)(o.currentRangeStore),l=(0,n.useMemo)((()=>Math.floor((0,qt().w0)(r,t.valueOf()-i))),[r,t,i]),s=(0,u().IS)((e=>({container:{position:"absolute",left:l-Fp/2+.5,top:Math.floor(Dp+Ip-Fp/2+.5),width:Fp,height:Fp,background:e.timelineRed,borderRadius:"100%"}})),[l]);return(0,S.jsx)("div",{style:s.container})}function $p(e){const{time:t,timelineState:o,intl:r}=e,{isMobile:i}=(0,s().Y0)(),l=(0,d().O$)(o.zoomLevelStore),{startTimestamp:a}=(0,d().O$)(o.currentRangeStore),c=(0,n.useMemo)((()=>(0,qt().w0)(l,t.valueOf()-a)),[l,t,a]),p=(0,n.useMemo)((()=>{const{secondaryDisplayUnit:e}=qt().eM[l];return(0,qt().u7)((0,Pp().H)(r),t.valueOf(),e)}),[l,r,t]),m=(0,u().IS)((e=>({container:{position:"absolute",top:0,left:c,height:Dp,color:e.regularTextColor,fontSize:14,fontWeight:w().Wy.medium,verticalAlign:"middle",paddingTop:Tp+(i?2:7),display:"flex",alignItems:"center"}})),[i,c]);return(0,S.jsx)("div",{style:m.container,children:p},c)}function Up(e){let{start:t,end:o,rangeWidth:n}=e;const r=(0,u().DP)();return t&&o?n>=Vp?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("div",{style:Hp(r),children:(0,Za().W_)(t.valueOf(),"month_day",bc().locale)}),(0,S.jsx)("div",{style:{flexGrow:1}}),(0,S.jsx)("div",{style:Hp(r),children:(0,Za().W_)(o.valueOf(),"month_day",bc().locale)})]}):(0,S.jsxs)("div",{style:Hp(r),children:[(0,Za().W_)(t.valueOf(),"month_day",bc().locale)," – ",t.month===o.month?(0,Za().W_)(o.valueOf(),"day",bc().locale):(0,Za().W_)(o.valueOf(),"month_day",bc().locale)]}):(0,S.jsx)("div",{style:Hp(r),children:(0,Za().W_)(t.valueOf(),"month_day",bc().locale)})}function qp(e,t,o,n){const r=e.setLocale(bc().locale),i=(0,qt().LH)(o),l=(0,qt().IW)();return i?l?(0,S.jsx)("span",{style:{color:n.timelineRed},children:r.toFormat("H:mm")}):(0,S.jsx)("span",{style:{color:n.timelineRed,paddingRight:3},children:r.toFormat("t")}):"week"===t||"bi_week"===t?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("span",{style:{color:n.lightTextColor,paddingRight:3},children:r.toFormat("ccccc")}),(0,S.jsxs)("div",{style:{position:"relative"},children:[(0,S.jsx)("div",{style:Gp(n)}),(0,S.jsx)("span",{style:{position:"relative",color:"white",padding:"2px 7px"},children:r.toFormat("d")})]})]}):(0,S.jsxs)("div",{style:{position:"relative"},children:[(0,S.jsx)("div",{style:Gp(n)}),(0,S.jsx)("span",{style:{position:"relative",color:"white",padding:"2px 7px"},children:r.toFormat("d")})]})}function Yp(e){let{nowTimeStartOfPrimaryDisplayUnit:t,timelineState:o}=e;const n=(0,d().O$)(o.zoomLevelStore),{startTimestamp:i,endTimestamp:l}=(0,d().O$)(o.currentRangeStore),s=qt().eM[n],{primaryDisplayUnit:a,hidePrimaryIndicatorIntersectionOffset:c}=s,u=c||0,p=(0,d().K8)((()=>Kp({time:t,isNowIndicator:!0,timelineState:o})),[t,o]),m=p.left+u,g=p.left+p.width-u,h=[];let f=(0,qt().DY)(r().c9.fromMillis(i),a);const v=(0,d().K8)((()=>Kp({time:f,isNowIndicator:!1,timelineState:o})),[f,o]);for(;f.valueOf()<l;){const e=v.left+u,t=v.left+v.width-u;void 0!==c&&(m>=e&&m<=t||g>=e&&g<=t)||h.push((0,S.jsx)(Wp,{timelineState:o,time:f,accent:!1},f.valueOf()));const n=(0,qt().Vz)(f,a);f=n}return(0,S.jsx)(S.Fragment,{children:h})}function Xp(e){let{timelineState:t}=e;const o=(0,k().tz)(),n=(0,d().O$)(t.zoomLevelStore),{startTimestamp:i,endTimestamp:l}=(0,d().O$)(t.currentRangeStore),s=qt().eM[n],{primaryDisplayUnit:a,secondaryDisplayUnit:c}=s,u=[];let p=(0,qt().DY)(r().c9.fromMillis(i),c);for(;p.valueOf()<l;){u.push((0,S.jsx)($p,{timelineState:t,intl:o,time:p},p.valueOf()));const e=(0,qt().Vz)(p,c);p=(0,qt().zj)(e,a)}return(0,S.jsx)(S.Fragment,{children:u})}function Qp(e){let{time:t,timelineState:o}=e;const n=(0,u().DP)(),r=(0,d().O$)(o.zoomLevelStore),{primaryDisplayUnit:i}=qt().eM[r],{left:l,width:s}=(0,d().K8)((()=>Kp({time:t,isNowIndicator:!0,timelineState:o})),[t,o]);return(0,S.jsx)("div",{style:{position:"absolute",top:0,left:l,width:s,height:Dp-4,display:"flex",alignItems:"center",fontWeight:500},children:(0,S.jsx)("div",{style:{fontSize:Op,margin:"0 auto",display:"flex"},children:qp(t,r,i,n)})},l)}function Zp(e){let{timelineState:t,activeRangeStore:o}=e;const n=(0,u().DP)(),i=(0,d().O$)(t.zoomLevelStore),{startTimestamp:l,endTimestamp:s}=(0,d().O$)(t.currentRangeStore),a=qt().eM[i],{activeRangeType:c}=a,p=(0,d().O$)(o);if(p){const e=(0,qt().DY)(r().c9.fromMillis(p.start),"day"),o=(0,qt().w0)(i,e.valueOf()-l);if("highlight_days"===c){const a=[];let c=r().c9.fromMillis(Math.max(e.valueOf(),(0,qt().DY)(r().c9.fromMillis(l),"day").valueOf()));for(;c.valueOf()<p.end&&c.valueOf()<s;){a.push(c);c=(0,qt().Vz)(c,"day")}const d=(0,qt().w0)(i,c.valueOf()-l)-o+2*Bp,u=a.map(((e,o)=>(0,S.jsx)(Wp,{timelineState:t,time:e,accent:0===o||o===a.length-1},`${e.toString()}-${o}`)));return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("div",{style:{position:"absolute",top:0,left:o-Bp,width:d,marginTop:(Dp-_p)/2-2,height:_p,background:n.timelineDarkerBackground,borderRadius:_p/2}}),u]})}{const t=(0,qt().DY)(r().c9.fromMillis(p.end),"day"),s=(0,qt().NB)(r().c9.fromMillis(p.end),"day"),a=(0,qt().w0)(i,t.valueOf()-l)-o+2*Bp;return(0,S.jsx)("div",{style:{display:"flex",alignItems:"center",position:"absolute",top:0,left:o-Bp,minWidth:a,marginTop:(Dp-_p)/2-2,height:_p,background:n.timelineDarkerBackground,borderRadius:_p/2,paddingLeft:6,paddingRight:6},children:(0,S.jsx)(Up,{start:e,end:e.valueOf()!==s.valueOf()?s:void 0,rangeWidth:a})})}}return null}function Jp(e){let{collectionContextStore:t,isFullScreen:o,paddingBottom:n}=e;const r=(0,d().K8)((()=>t.permissionScopesStore.state.canConfigureBlock),[t]),i=t.settingsStore;return(0,S.jsx)(Gs,{title:(0,S.jsx)(k().sA,{defaultMessage:"No date property",id:"database.timelineView.missingDatePropertyTitle"}),description:r?(0,S.jsx)(k().sA,{defaultMessage:"<opensettingslink>Add a date property</opensettingslink> to your database in order to display a Timeline view.",id:"database.timelineView.missingDateProperty",values:{opensettingslink:e=>(0,S.jsx)(Hs,{onClick:()=>{I().Ow({collectionContextStore:t,collectionSettingsStore:i}),I().a2({collectionSettingsStore:i,item:{type:"properties",timelineViewTab:"timeline"}})},children:e})}}):(0,S.jsx)(k().sA,{defaultMessage:"Timeline views require a date property in order to display.",id:"database.timelineView.missingDatePropertyNoPermissions"}),style:{paddingBottom:o?void 0:n}})}function em(e){let{timelineState:t}=e;const o=(0,sp().I)(),r=(0,n.useCallback)((()=>{0===(new Date).getSeconds()&&o()}),[o]);(0,n.useEffect)((()=>{const e=setInterval(r,1e3);return()=>clearInterval(e)}),[r]);const i=(0,d().O$)(t.zoomLevelStore),{startTimestamp:l,endTimestamp:s}=(0,d().O$)(t.currentRangeStore);return(0,S.jsxs)("div",{style:{position:"absolute",width:"100%",height:"100%",overflow:"hidden",cursor:"default"},children:[(0,S.jsx)(im,{zoomLevel:i,startTimestamp:l,endTimestamp:s}),(0,S.jsx)(lm,{zoomLevel:i,startTimestamp:l,endTimestamp:s}),(0,S.jsx)(rm,{zoomLevel:i,startTimestamp:l})]})}const tm=n.memo(em,mo().A),om=n.memo((function(e){let{start:t,zoomLevel:o,startTimestamp:n}=e;const r=(0,u().IS)((e=>{const r=t.plus({day:2}).startOf("day"),i=(0,qt().w0)(o,t.valueOf()-n);return{weekendIndicator:{position:"absolute",left:i,width:(0,qt().w0)(o,r.valueOf()-n)-i,height:"100%",background:e.timelineDarkerBackground}}}),[t,n,o]);return(0,S.jsx)("div",{style:r.weekendIndicator},t.valueOf())}),mo().A),nm=n.memo((function(e){let{time:t,zoomLevel:o,startTimestamp:n}=e;const r=(0,u().IS)((e=>({verticalDivider:{position:"absolute",left:(0,qt().w0)(o,t-n),height:"100%",borderRight:`1px solid ${e.regularDividerColor}`}})),[n,t,o]);return(0,S.jsx)("div",{style:r.verticalDivider},t)}),mo().A),rm=n.memo((function(e){let{zoomLevel:t,startTimestamp:o}=e;const n=(0,u().IS)((e=>{const n=r().c9.now().startOf("minute");return{nowVerticalDivider:{position:"absolute",left:Math.floor((0,qt().w0)(t,n.valueOf()-o)),height:"100%",borderRight:`1px solid ${e.timelineRed}`}}}),[o,t]);return(0,S.jsx)("div",{style:n.nowVerticalDivider})}),mo().A),im=n.memo((function(e){let{zoomLevel:t,startTimestamp:o,endTimestamp:n}=e;const{showWeekendIndicators:i}=qt().eM[t];if(!i)return null;let l=(0,qt().DY)(r().c9.fromMillis(o),"day");const s=[];for(;l.valueOf()<n;)6===l.weekday&&s.push((0,S.jsx)(om,{start:l,zoomLevel:t,startTimestamp:o},l.valueOf())),l=(0,qt().Vz)(l,"day");return(0,S.jsx)(S.Fragment,{children:s})}),mo().A),lm=n.memo((function(e){let{zoomLevel:t,startTimestamp:o,endTimestamp:n}=e;const{verticalDividerUnit:i}=qt().eM[t];if(!i)return null;const l=[];let s=(0,qt().DY)(r().c9.fromMillis(o),i);for(;s.valueOf()<n;)l.push((0,S.jsx)(nm,{time:s.valueOf(),zoomLevel:t,startTimestamp:o},s.valueOf())),s=(0,qt().Vz)(s,i);return(0,S.jsx)(S.Fragment,{children:l})}),mo().A);var sm=()=>o(74513);function am(e){let{collectionContextStore:t,isFullScreen:o,disabled:r,format:i,hiddenGroupsVisibleStore:l,showTable:s,canEditCollectionTimeline:a}=e;return(0,n.useCallback)((e=>{const{groupFormat:n,groupsDisplayState:c}=e,d=i.collection_group_by,u=t.groupsStore.getGroupState(n),p=Boolean(n&&!(null!=u&&u.toggleStateStore.state)),{currentGroups:m,visibleGroups:g,hiddenGroups:S}=c,h=function(e,t,o,n){if(!e)return!0;const r=o.indexOf(e);return!t&&!o.find(((e,t)=>{if(t<r){const t=n.groupsStore.getGroupState([e]);return null==t?void 0:t.toggleStateStore.state}return!1}))}(n,p,m,t),f=null==u?void 0:u.reducerResultStore.state,v=L().XQ({collectionContextStore:t,reducerResult:f,isFullScreen:o}),y=n===S[S.length-1],x=n===g[g.length-1],C=(0,No().Zl)(c,t,!1),b=l.state?y:x,w=t.permissionScopesStore.state,k=b&&!r&&w.canConfigureBlock&&d&&(0,so().pP)(d,w.canConfigureCollection),T=f&&0===f.blockIds.length;return{groupHeader:Boolean(n&&(!s||!h)),tableHeaderRow:Boolean(s&&!p&&!h),tableAggregationRow:Boolean(s&&!p),addItemRow:Boolean(a&&!p),hiddenGroupsButton:Boolean(x&&S.length>0),groupsLoadMoreButton:Boolean(x&&C),loadMoreButton:Boolean(!p&&v),tableEmptyRow:Boolean(s&&!p&&T),extraGroupMarginBottom:Boolean(s&&p),addGroupButton:Boolean(k)}}),[a,t,r,i.collection_group_by,l,o,s])}const cm=function(e){let{store:t,collectionContextStore:o,groupFormat:n}=e;const r=(0,s().v3)(),i=(0,d().K8)((()=>dm(t)),[t]),{value:l}=(0,ne().fJ)(me().T.formulas);return(0,S.jsx)(lt().A,{store:t,style:{width:"100%",height:sm().V+1},canDropBelow:!0,canNativeDropBelow:!0,shouldShowDropZone:!0,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,canInsertAbove:!0,canInsertBelow:!0,onInsertBelow:i?um(i,r,t,o,n):void 0,onInsertAbove:i?pm(i,r,t,o,n):void 0,onSelectableDrop:e=>function(e,t,o,n,r,i){const{droppedDirection:l,droppedStores:s,duplicate:a}=e,c=dm(o);if(!c)return;const d=n.subitemTreeStore.state,u=(0,bo().Qe)(d.children,(e=>e.value.store===o)),p=Pe().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");Pe().default.DO_NOT_USE_measureAfterNextFlushLegacy(p,{environment:t,getData:()=>fe().tv({collectionContextStore:n,is_native_drop:!1,is_empty:!1})});const m="collectionTypedView"===n.contextType;B().createAndCommit({userAction:"CollectionTimelineViewDroppableRow.handleDrop",environment:t,canUndo:!0,perform:e=>{Eo({environment:t,collectionStore:m?void 0:c,targetStore:o,droppedDirection:l,collectionContextStore:n,groupsPointer:r?[r]:[],droppedStores:s,duplicate:a,transaction:e,subitemPath:u,collapsedGroup:!1,formulasModule:i})}})}(e,r,t,o,n,l),onNativeDrop:e=>function(e,t,o,n,r,i){const{files:l,droppedDirection:s}=e,a=dm(r);if(!a)return;const c=o.collectionViewBlockStore(),d=Pe().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");Pe().default.DO_NOT_USE_measureAfterNextFlushLegacy(d,{environment:t,getData:()=>fe().tv({collectionContextStore:o,is_native_drop:!0,is_empty:!1})}),c&&B().createAndCommit({userAction:"CollectionTimelineViewDroppableRow.handleNativeDrop",environment:t,canUndo:!0,perform:e=>{Ho({environment:t,collectionStore:a,targetStore:c,droppedDirection:s,collectionContextStore:o,groupsPointer:n?[n]:[],files:l,transaction:e,formulasModule:i})}})}(e,r,o,n,t,l),onRemove:e=>function(e,t){const{transaction:o}=e,n=dm(t);if(!n)return;gt().by({childStore:t,transaction:o})}(e,t),analyticsName:"timeline"},t.id)};function dm(e){return e.getAssociatedCollectionStore()}function um(e,t,o,n,r){return i=>{const{insertStores:l,transaction:s}=i,a="collectionTypedView"===n.contextType;return(0,en().D)({environment:t,collectionStore:a?void 0:e,collectionContextStore:n,groupsPointer:r?[r]:[],insertStores:l,store:o,before:!1,transaction:s})}}function pm(e,t,o,n,r){return i=>{const{insertStores:l,transaction:s}=i,a="collectionTypedView"===n.contextType;return(0,en().D)({environment:t,collectionStore:a?void 0:e,collectionContextStore:n,groupsPointer:r?[r]:[],insertStores:l,store:o,before:!0,transaction:s})}}function mm(e){let{store:t,groupFormat:o,collectionContextStore:r,canEdit:i,disabled:l,format:a}=e;const c=(0,s().v3)(),{value:u}=(0,ne().fJ)(me().T.formulas),[p]=(0,n.useState)((()=>new(re().Bv)(c,t.pointer))),m=(0,d().K8)((()=>r.groupsStore.getGroupState(o)),[r,o]),g=(0,d().O$)(r.permissionScopesStore),h=(0,d().K8)((()=>r.collectionViewStore()),[r]),f=(0,d().K8)((()=>i&&g.canEditContent&&!g.isSyncedCollection&&c.device.isMobile&&!(null!=h&&h.isSyncedCollection())),[i,h,c,g]),v=(0,n.useMemo)((()=>{if(p)return(0,S.jsx)(lt().A,{store:p,shouldShowDropZone:i,canDropBelow:i,canNativeDropBelow:i,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,onSelectableDrop:e=>function(e,t,o,n,r){const{droppedDirection:i,droppedStores:l,duplicate:s}=e,a=o.collectionStore();if(!a)return;const c=o.groupsStore.getGroupState(t);if(!c)return;const d=o.collectionViewBlockStore(),u=Pe().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");Pe().default.DO_NOT_USE_measureAfterNextFlushLegacy(u,{environment:n,getData:()=>fe().tv({collectionContextStore:o,is_native_drop:!1,is_empty:!0})}),d&&B().createAndCommit({userAction:"TimelineDropzoneSelectableGroupResults.handleEmptyDroppableDrop",environment:n,canUndo:!0,perform:e=>{Eo({environment:n,collectionStore:a,targetStore:d,droppedDirection:i,collectionContextStore:o,groupsPointer:c.groupsPointer,droppedStores:l,duplicate:s,transaction:e,collapsedGroup:!1,formulasModule:r})}})}(e,o,r,c,u),onNativeDrop:e=>function(e,t,o,n,r){const{files:i,droppedDirection:l}=e,s=t.collectionStore();if(!s)return;const a=t.collectionViewBlockStore(),c=Pe().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");Pe().default.DO_NOT_USE_measureAfterNextFlushLegacy(c,{environment:n,getData:()=>fe().tv({collectionContextStore:t,is_native_drop:!0,is_empty:!0})}),a&&B().createAndCommit({userAction:"TimelineDropzoneSelectableGroupResults.handleEmptyDroppableNativeDrop",environment:n,canUndo:!0,perform:e=>{Ho({environment:n,collectionStore:s,targetStore:a,droppedDirection:l,collectionContextStore:t,groupsPointer:o?[o]:[],files:i,transaction:e,formulasModule:r})}})}(e,r,o,c,u),analyticsName:"timeline",style:{width:"100%"}})}),[i,r,c,o,p,u]);return m?(0,S.jsxs)(S.Fragment,{children:[v,(0,S.jsx)(gn,{collectionContextStore:r,groupsPointer:m.groupsPointer,format:a,canDrag:f,disableRequest:!0,resultProps:{groupFormat:o,collectionContextStore:r,isLast:!1,handleOpenPeekPage:C().lQ},canDrop:!0,resultComponent:cm,disabled:l,direction:pn.Vertical,shouldShowHoverMenu:!1,analyticsName:"timeline",emptyDroppableSize:0,touchDragOnly:!0,disableSelectable:!0,nestedCreateSubitemButton:Sm})]}):null}const gm=n.memo(mm,mo().A);function Sm(e){return(0,S.jsx)("div",{style:{width:"100%",height:sm().V+1}})}const hm=n.memo((function(e){let{store:t,collectionContextStore:o,disabled:r,isFullScreen:i,isRootChild:l,paddingLeft:a,onGroupHeaderAddItem:c,format:d,groupsReducerResultStore:u,hiddenGroupsVisibleStore:p,canEditCollectionTimeline:m,showTable:g}=e;const h=(0,n.useMemo)((()=>({type:"dropzone",reducerResultStore:u,hiddenGroupsVisibleStore:p})),[u,p]),f=(0,n.useCallback)((()=>null),[]),v=function(e){let{collectionContextStore:t,isFullScreen:o,disabled:r,format:i,hiddenGroupsVisibleStore:l,showTable:a,canEditCollectionTimeline:c}=e;const d=(0,s().Y0)(),u=am({collectionContextStore:t,isFullScreen:o,disabled:r,format:i,hiddenGroupsVisibleStore:l,showTable:a,canEditCollectionTimeline:c});return(0,n.useCallback)((e=>{if(!e)return{paddingTop:0,paddingBottom:0};const t=u(e),o=(0,_().sG)({isMobile:d.isMobile})-1;let n=0,r=0;return t.groupHeader&&(n+=qt().tp+qt().lH-1),t.tableHeaderRow&&(n+=qt().MR),t.tableEmptyRow&&(n+=o),t.addItemRow&&(r+=sm().V),t.loadMoreButton&&(r+=ho().LA),t.tableAggregationRow&&(r+=o-1),t.addItemRow||(r-=1),t.hiddenGroupsButton&&(r+=Vl+Fl+Ll),t.groupsLoadMoreButton&&(r+=Dl+2*zl),t.addGroupButton&&(r+=Ms+_s+Bs),{paddingTop:n,paddingBottom:r}}),[d,u])}({collectionContextStore:o,isFullScreen:i,disabled:r,format:d,hiddenGroupsVisibleStore:p,showTable:g,canEditCollectionTimeline:m}),y=(0,n.useCallback)((e=>(0,S.jsx)(gm,{store:t,groupFormat:e,collectionContextStore:o,canEdit:m,format:d,disabled:r&&m})),[o,t,d,r,m]);return d.collection_group_by?(0,S.jsx)(rs,{reducerId:"timeline_groups",store:t,collectionContextStore:o,disabled:r,isFullScreen:i,isRootChild:l,paddingLeft:a,stickyLeft:!1,renderGroup:y,getGroupStyle:v,renderHeader:f,onGroupHeaderAddItem:c,timelineProps:h}):(0,S.jsx)("div",{style:v(void 0),children:y(void 0)})}));function fm(e){let{timelineState:t,...o}=e;const{collectionContextStore:n,isFullScreen:r,paddingLeft:i,isInPeekRenderer:l}=o,s=(0,d().O$)(n.isInHomeWidgetStore),a=(0,d().K8)((()=>t.outerSizeObserver.rect.state.width),[t]),c=(0,u().IS)((e=>({outerDiv:{position:"sticky",left:0,width:a,height:qt().tp,zIndex:87},headerStyle:{width:"100%",height:"100%",paddingLeft:r?i:32,zIndex:void 0,transition:"background 200ms ease-in-out, border 200ms  ease-in-out",background:"transparent",borderBottom:"1px solid transparent"},stickyStyle:{...s?{}:{background:e.contentBackground,boxShadow:`0 -1px 0 ${e.tableDividerColor}`}}})),[r,s,a,i]);return(0,S.jsx)("div",{style:c.outerDiv,children:(0,S.jsx)(Gi,{...o,style:c.headerStyle,stickyStyle:c.stickyStyle,preventToggleBackground:l})})}const vm=new(ne().O2)("TimelineItemDateRange",(async()=>await o.e(11922).then(o.bind(o,117686)))),ym=(0,ne()._h)(vm,(e=>e.TimelineItemDateRange));var xm=function(e){return e[e.Hidden=0]="Hidden",e[e.VisibleInItem=1]="VisibleInItem",e[e.VisibleOutOfItem=2]="VisibleOutOfItem",e[e.NotDefined=3]="NotDefined",e}(xm||{});function Cm(e){let{store:t,type:r,timelineState:i,scrollerLeftOffset:l,paddingLeft:a,format:c,itemPositionStore:p,dateValueStore:m,isDraggingViaTimelineItemStore:g,collectionContextStore:h,isFullScreen:f,isInPeekRenderer:v,isRootChild:y}=e;const x=(0,s().v3)(),C=(0,n.useRef)(xm.NotDefined),b=(0,n.useRef)(null),w=(0,n.useRef)(null),[k,T]=(0,n.useState)(!1),I="left"===r?o(881915).X:o(653252).O,R=(0,d().O$)(i.outerSizeObserver.rect),j=(0,d().r6)((()=>{const e=p.state;if(e){const{left:t,right:o}=e;if(g.state)return xm.Hidden;const n=i.scrollLeftStore.state;if(void 0!==n){if("left"===r){const e=n+l;if(e-o>0)return xm.VisibleOutOfItem;if(e-t>0)return xm.VisibleInItem}else{const e=n+R.width;if(t-e>0)return xm.VisibleOutOfItem;if(o-e>0)return xm.VisibleInItem}return xm.Hidden}}return xm.NotDefined}),[g,p,R,l,i,r]),A=(0,u().IS)((e=>({arrow:{display:"flex",alignItems:"center",width:16,height:16,flexShrink:0,pointerEvents:"auto",background:k?e.regularIconColor:e.mediumIconColor,borderRadius:4,border:`1px solid ${e.contentBackground}`,..."left"===r&&{marginLeft:8,marginRight:4},..."right"===r&&{marginRight:8,marginLeft:4}},icon:{height:6,fill:v?e.cardContentBackground:e.contentBackground},wrap:{position:"sticky",left:"left"===r?l:R.width-220,width:220,height:Ut().sH-6,marginTop:2,display:"flex",alignItems:"center",cursor:"pointer",flexDirection:"right"===r?"row-reverse":void 0,whiteSpace:"nowrap",textOverflow:"ellipsis"}})),[k,v,R,l,r]);(0,n.useLayoutEffect)((()=>{M()}),[]),(0,n.useEffect)((()=>(j.addListener(M),()=>{j.removeListener(M)})),[]),(0,n.useEffect)((()=>{j.enqueueRecompute()}));const M=(0,n.useCallback)((()=>{const e=b.current,t=w.current;if(e&&t){const o=j.state,n=o===xm.VisibleInItem||o===xm.VisibleOutOfItem;e.style.opacity=""+(n?1:0),e.style.transform=`scale(${n?1:.3})`,t.style.pointerEvents=o===xm.VisibleOutOfItem?"":"none";C.current!==xm.NotDefined&&o!==xm.NotDefined&&!e.style.transition&&(e.style.transition="transform 160ms ease-in-out, opacity 160ms ease-in-out"),C.current=o}}),[j]),B=(0,n.useCallback)((()=>{const e=m.state,o=i.zoomLevelStore.state,{snapUnit:n}=qt().eM[o],l=(0,qt().C1)(o,200);if(e)if("left"===r){const{start:t}=(0,qt().yl)(e,n),r=(0,qt().zb)({timestamp:t.valueOf(),environment:x,timelineState:i,paddingLeft:a,format:c})-l;tp().k3({timelineState:i,environment:x,zoomLevel:o,centerTimestamp:r})}else{const{end:t}=(0,qt().yl)(e,n),r=(0,qt()._r)({timestamp:t.valueOf(),timelineState:i})+l;tp().k3({timelineState:i,environment:x,zoomLevel:o,centerTimestamp:r})}T(!1),P().Lt({environment:x,store:t}),(0,op().iT)(x,{...(0,op().ZR)({environment:x,collectionContextStore:h,timelineState:i,isFullScreen:f,isRootChild:y}),type:r})}),[h,m,x,c,f,y,a,t,i,r]),_=(0,n.useCallback)((()=>{x.device.isPhone||Ke().A.state||T(!0)}),[x]),V=(0,n.useCallback)((()=>{x.device.isPhone||T(!1)}),[x]);return(0,S.jsxs)("div",{style:A.wrap,onMouseOver:_,onMouseOut:V,onMouseDown:Ce().tr,onClick:B,ref:w,children:[(0,S.jsx)("div",{style:A.arrow,ref:b,children:I(A.icon)}),k&&(0,S.jsx)(wm,{dateValueStore:m,timelineState:i,isInPeekRenderer:v})]})}const bm=n.memo(Cm,mo().A);function wm(e){let{dateValueStore:t,timelineState:o,isInPeekRenderer:n}=e;const r=(0,u().IS)((e=>({dateRange:{fontSize:12,paddingLeft:4,paddingRight:4,borderRadius:4,background:n?e.peekTimelineBackground:e.timelineBackground,pointerEvents:"none"}})),[n]),i=(0,d().O$)(t),l=(0,d().O$)(o.zoomLevelStore);return i?(0,S.jsx)("span",{style:r.dateRange,children:(0,qt().tX)(i,l)}):null}class km extends p().default{getInitialState(){return null}}function Tm(e){let{store:t,timelineState:o,scrollerLeftOffset:i,paddingLeft:l,format:a,query:c,schema:p,blockPropertyValueOverlayStore:m,disabled:g,showProperties:h,collectionContextStore:f,isFullScreen:v,isRootChild:y,toggleButton:x,groupFormat:C,subitemPath:b,isInPeekRenderer:w,handleOpenPeekPage:k}=e;const T=(0,s().v3)(),{value:I}=(0,ne().fJ)(me().T.formulas),R=(0,n.useRef)(null),[j]=(0,n.useState)((()=>t.clone())),P=(0,n.useRef)(null),M=(0,d().K8)((()=>{const e=o.dateRangePlaceholderStore.state;if(e.active&&e.store===t&&!e.newTimelineItemProps&&(0,so().Mn)(e.groupFormat,C))return e.date}),[C,t,o]),_=(0,d().r6)((()=>{const e=o.dragStateStore.state;if(M)return M;if(e){const o=e.stores.indexOf(t);if(o>=0)return e.temporaryValues[o]}return Im(t,c,p,T,I)}),[T,M,c,p,t,o,I],{useDeepEqual:!0}),V=(0,d().O$)(_),F=(0,d().K8)((()=>{const e=(0,bo().dC)(b);if(!e||Boolean(V))return;const t=e.value.store,o=lp.findCollectionTimelineViewItems(t);if(o.length>0){return o[0].dateValueStore.state}}),[V,b]),O=(0,d().r6)((()=>(0,qt().BD)({timelineState:o,dateValue:V,placeholderDate:M,subitemPlaceholderDate:F})),[V,M,F,o]),E=(0,d().uB)(void 0,km);(0,Qd().b)(lp,(()=>({getNode:()=>R.current,props:{store:t,groupFormat:C,schema:p},stores:{nodeStore:E},dateValueStore:_,itemPositionStore:O})),[t,R,_,C,p,O,E]);const D=(0,d().O$)(O),z=(0,d().K8)((()=>{var e;return null===(e=f.groupsStore.getGroupState(C))||void 0===e?void 0:e.reducerResultStore}),[C,f]),K=(0,ue().Zp)(),H=Boolean(D&&!D.isPlaceholder&&!(null!=K&&K.disableAllPointerEvents)),G=(0,d().r6)((()=>{const e=o.dragStateStore.state,n=To().Ay.state;return Boolean(e&&e.stores.includes(t)&&n.isDragging&&n.draggedStores.includes(t))}),[t,o]);(0,d().O$)(G);const W=(0,d().K8)((()=>t.getAssociatedCollectionStore()),[t]),N=(0,n.useCallback)((e=>{const n=o.dateRangePlaceholderStore.state,r=f.groupsStore.getGroupState(C);if(r)if(n.active){const{date:e}=n;B().createAndCommit({userAction:"CollectionTimelineViewItem.handleClick",environment:T,canUndo:!0,perform:o=>{tp().Xt({environment:T,store:t,query:c,schema:p,date:e,transaction:o})}}),o.dateRangePlaceholderStore.setState({active:!1})}else{const{horizontalScroller:n}=o,i=o.scrollLeftStore.state,l=O.state,s=P.current;if(!n||void 0===i||!l||!s)return;const a=n.getBoundingClientRect(),c=i+(e.clientX-a.left),d=P.current;if(!d)return;const u=d.lastElementChild;if(!u)return;const p=i+(u.getBoundingClientRect().right-a.left);c>l.right&&c<=p&&(0,Ce().SQ)({event:e,context:Ce().y$.EditorClick,callback:()=>{(0,we().Zm)()||In().VU({environment:T,store:t,openInNew:xe().Vr(e),peekMode:(0,L().hH)(f),resultsStore:r.resultsStore,collectionContextStore:f,pageVisitSource:wn().y8.PeekOpen})}})}}),[f,T,C,O,c,p,t,o]),$=(0,n.useCallback)((()=>{o.dateRangePlaceholderStore.setState({active:!1})}),[o]),U=(0,n.useCallback)((e=>{const{target:t}=e;!T.device.isMobile&&t instanceof HTMLElement&&(0,Ce().SQ)({event:e,context:Ce().y$.EditorMouseDown,callback:()=>{e.preventDefault(),A().jD({environment:T,target:t,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}),[T]),q=(0,n.useCallback)((e=>{const n=o.dragStateStore.state,i=o.drawStateStore.state,{horizontalScroller:l}=o,s=o.scrollLeftStore.state,a=o.zoomLevelStore.state,d=o.currentRangeStore.state,{snapUnit:u,getDateRangePlaceholderDuration:m}=qt().eM[a];if(!i&&Ke().A.state||n||Im(t,c,p,T,I)||!l||void 0===s||g)return;const S=l.getBoundingClientRect(),h=s+(e.clientX-S.left),f=(0,qt().C1)(a,h),v=r().c9.fromMillis(d.startTimestamp+f),y=(0,qt().DY)(v,u),x=(0,qt().DY)(m(v),u),b=(0,Va().p6)(y.valueOf(),(0,yo().P)()),w=(0,qt().oJ)({startValue:b,snapUnit:u,desiredStart:y,desiredEnd:x});o.dateRangePlaceholderStore.setState({active:!0,store:t,parentStore:W,groupFormat:C,date:w,newTimelineItemProps:void 0,existingTimelineItemProps:{query:c,schema:p}})}),[T,o,t,C,g,c,p,W,I]),Y=(0,n.useCallback)((e=>{E.setState(e)}),[E]),X=(0,u().IS)((()=>({scrollArrows:{display:"flex",height:0,position:"relative",zIndex:86},dateRange:{display:"flex",height:sm().V+1,width:"100%",cursor:"default",isolation:"auto"}})),[]);if(!z)return null;const Q=Boolean(D);return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)("div",{ref:R,style:X.scrollArrows,children:[H&&(0,S.jsx)(bm,{store:t,type:"left",timelineState:o,scrollerLeftOffset:i,itemPositionStore:O,dateValueStore:_,paddingLeft:l,format:a,isDraggingViaTimelineItemStore:G,collectionContextStore:f,isFullScreen:v,isInPeekRenderer:w,isRootChild:y}),H&&(0,S.jsx)(bm,{store:t,type:"right",timelineState:o,scrollerLeftOffset:i,itemPositionStore:O,dateValueStore:_,paddingLeft:l,format:a,isDraggingViaTimelineItemStore:G,collectionContextStore:f,isInPeekRenderer:w,isFullScreen:v,isRootChild:y})]}),(0,S.jsx)("div",{style:X.dateRange,onMouseDown:U,onMouseMove:q,onMouseLeave:$,onClick:N,className:he().ZLF,ref:Y,children:Q&&(0,S.jsx)(ym,{store:t,parentStore:W,toggleButton:x,clonedStore:j,itemPositionStore:O,dateValueStore:_,query:c,schema:p,timelineState:o,blockPropertyValueOverlayStore:m,disabled:g,showProperties:h,scrollerLeftOffset:i,isDraggingViaTimelineItemStore:G,collectionContextStore:f,isFullScreen:v,isInPeekRenderer:w,isRootChild:y,intl:yt().A.getIntl(),propertiesWrapElementRef:P,resultStore:z,handleOpenPeekPage:k})})]})}function Im(e,t,o,n,r){return(0,qt().GM)({store:e,query:t,schema:o,userId:n.currentUser.id,intl:yt().A.getIntl(),formulasModule:r})}function Rm(e){const{store:t,parentStore:o,timelineState:i,scrollerLeftOffset:l,query:a,schema:c,blockPropertyValueOverlayStore:p,disabled:m,showProperties:g,collectionContextStore:h,isFullScreen:f,isRootChild:v,toggleButton:y,groupFormat:x,canEditTimelineItems:C,subitemPath:b,paddingLeft:w,showTable:k}=e,T=(0,s().v3)(),[I,R]=(0,n.useState)(),j=(0,u().IS)((()=>({container:{display:"flex",height:(0,_().sG)({isMobile:T.device.isMobile})+1,width:"100%",cursor:"default",isolation:"auto"}})),[T.device]);(0,n.useEffect)((()=>{R(null==t?void 0:t.clone())}),[t]);const P=(0,d().K8)((()=>{var e;return null===(e=h.groupsStore.getGroupState(x))||void 0===e?void 0:e.reducerResultStore}),[h.groupsStore,x]),M=(0,d().K8)((()=>{const e=i.dateRangePlaceholderStore.state;if(e.active&&e.store===t&&e.newTimelineItemProps&&e.parentStore===o&&(0,so().Mn)(e.groupFormat,x))return e.date}),[x,o,t,i.dateRangePlaceholderStore]),V=(0,d().K8)((()=>M),[M],{useDeepEqual:!0}),F=(0,d().K8)((()=>(0,qt().BD)({timelineState:i,dateValue:V,placeholderDate:M,subitemPlaceholderDate:void 0})),[V,M,i]),L=(0,d().K8)((()=>Boolean(F)),[F]),O=(0,d().K8)((()=>!h.isInHomeWidgetStore.state&&!t&&!L&&h.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0})),[h,L,t]),E=(0,d().K8)((()=>h.isInPeekRendererStore.state),[h.isInPeekRendererStore]),D=(0,n.useMemo)((()=>new(Ap().default)((()=>F),{debugName:"itemPositionStore"})),[F]),z=(0,n.useMemo)((()=>new(Ap().default)((()=>V),{debugName:"dateValueStore"})),[V]),K=(0,n.useMemo)((()=>new(Ap().default)((()=>!1),{debugName:"isDraggingViaTimelineItemStore"})),[]);return P?(0,S.jsxs)("div",{style:j.container,onMouseDown:e=>function(e,t){const{target:o}=e;if(t.device.isMobile||!(o instanceof HTMLElement))return;(0,Ce().SQ)({event:e,context:Ce().y$.EditorMouseDown,callback:()=>{e.preventDefault(),A().jD({environment:t,target:o,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}(e,T),onMouseMove:e=>function(e,t,o,n,i,l,s,a,c,d,u,p){var m;const g=t.drawStateStore.state,S=t.dragStateStore.state,{horizontalScroller:h}=t,f=t.scrollLeftStore.state,v=t.zoomLevelStore.state,y=t.currentRangeStore.state,{snapUnit:x,getDateRangePlaceholderDuration:C}=qt().eM[v];if(!g&&Ke().A.state||S||!h||void 0===f||i)return;const b=null===(m=d.groupsStore.getGroupState(n))||void 0===m?void 0:m.resultsStore;if(!b)return;const w=h.getBoundingClientRect(),k=f+(e.clientX-w.left),T=(0,qt().C1)(v,k),I=r().c9.fromMillis(y.startTimestamp+T),R=(0,qt().DY)(I,x),j=(0,qt().DY)(C(I),x),A=(0,Va().p6)(R.valueOf(),(0,yo().P)()),P=(0,qt().oJ)({startValue:A,snapUnit:x,desiredStart:R,desiredEnd:j});t.dateRangePlaceholderStore.setState({active:!0,store:o,parentStore:u,groupFormat:n,date:P,newTimelineItemProps:{query:l,schema:s,resultsStore:b,isFullScreen:a,canEditTimelineItems:c,subitemPath:p},existingTimelineItemProps:void 0})}(e,i,t,x,m,a,c,f,C,h,o,b),onMouseLeave:()=>function(e){e.dateRangePlaceholderStore.setState({active:!1})}(i),onClick:e=>function(e,t,o,n,r,i,l,s,a,c,d,u){const p=r.dateRangePlaceholderStore.state;if(p.active){const{date:e}=p,m=u?u.length>0?"timeline_add_subitem_bottom":"timeline_add_parent_item_bottom":"timeline_add_item_bottom";if(!(0,Ye().EF)(t))return void(0,Ye().QY)(t);B().createAndCommit({userAction:"CollectionTimelineViewItem.handleClick",environment:t,canUndo:!0,perform:r=>{const p=tp().dO({environment:t,transaction:r,date:e,store:c,parentStore:d,query:o,schema:n,isFullScreen:i,groupFormat:l,canEditTimelineItems:s,collectionContextStore:a,subitemPath:u,from:m});Qo().v(t,{from:m,type:"page",new_page_id:null==p?void 0:p.id,creating_block_id:null==p?void 0:p.id,...(0,fe().sl)(a)})}}),r.dateRangePlaceholderStore.setState({active:!1})}}(0,T,a,c,i,f,x,C,h,t,o,b),className:he().ZLF,children:[L&&(0,S.jsx)(ym,{store:o?void 0:t,parentStore:o,toggleButton:y,clonedStore:I,itemPositionStore:D,dateValueStore:z,query:a,schema:c,timelineState:i,blockPropertyValueOverlayStore:p,disabled:m,showProperties:g,scrollerLeftOffset:l,isDraggingViaTimelineItemStore:K,collectionContextStore:h,isFullScreen:f,isInPeekRenderer:E,isRootChild:v,intl:yt().A.getIntl(),resultStore:P,handleOpenPeekPage:Am}),O&&(0,S.jsx)(_m,{parentStore:o,collectionContextStore:h,paddingLeft:w,isFullScreen:f,showTable:k})]}):null}const jm=n.memo(Rm);function Am(){}function Pm(e){let{isMobile:t}=e;return{display:"flex",alignItems:"center",paddingBottom:2,fontSize:14,height:(0,_().sG)({isMobile:t}),lineHeight:w().K_.UIRegular.desktop}}function Mm(e,t,o){return{position:"sticky",left:t&&!o?e+8:8,display:"flex",alignItems:"center"}}function Bm(e){return{width:14,height:14,marginLeft:-1,marginRight:6,fill:e.mediumIconColor}}function _m(e){let{parentStore:t,collectionContextStore:o,paddingLeft:n,isFullScreen:r,showTable:i}=e;const l=(0,u().DP)(),{isMobile:a}=(0,s().Y0)(),c=(0,d().O$)(o.currentSubitemFormatStoreForUiDisplayStore),p=(0,d().K8)((()=>{var e;return c&&t?null===(e=t.getSchema()[c.property])||void 0===e?void 0:e.name:""}),[c,t]);return(0,S.jsx)("div",{style:Mm(n,r,i),children:(0,S.jsxs)("div",{style:Pm({isMobile:a}),children:[(0,uo().W)(Bm(l)),(0,S.jsx)("span",{style:{color:l.mediumTextColor},children:t&&p?(0,S.jsx)(k().sA,{defaultMessage:"New page in {propertyName}",id:"database.timelineView.nest.addSubitemWithPropertyName",values:{propertyName:p}}):(0,S.jsx)(k().sA,{defaultMessage:"New",id:"database.timelineView.item.addRowButton"})})]})})}function Vm(e){const{store:t,parentStore:o,subitemPath:n,timelineState:r,disabled:i,query:l,format:s,schema:a,collectionContextStore:c,blockPropertyValueOverlayStore:u,isFullScreen:p,isRootChild:m,groupFormat:g,paddingLeft:h,showTimelineProperties:f,scrollerLeftOffset:v,showTable:y,canEditTimelineItems:x,isInPeekRenderer:C,isReady:b,canEdit:w}=e,k=(0,d().K8)((()=>c.groupsStore.getGroupState(g)),[c,g]),T=(0,d().O$)(c.permissionScopesStore),I=(0,d().K8)((()=>"collectionTypedView"===c.contextType),[c]);return(0,d().O$)(c.isInHomeWidgetStore)||!k||!b||!w&&!I||T.isSyncedCollection?null:(0,S.jsx)(jm,{store:t,disabled:i||!T.canEditContent&&!I,timelineState:r,schema:a,query:l,format:s,scrollerLeftOffset:v,paddingLeft:h,showProperties:f,blockPropertyValueOverlayStore:u,collectionContextStore:c,isFullScreen:p,showTable:y,isRootChild:m,groupFormat:g,canEditTimelineItems:x,isInPeekRenderer:C,parentStore:o,subitemPath:n})}const Fm=function(e){const{collectionContextStore:t,schema:o,groupFormat:n,query:r,showTable:i,store:l,format:a,isFullScreen:c,paddingLeft:u,isInPeekRenderer:p,timelineState:m,blockPropertyValueOverlayStore:g,isRootChild:h,isReady:f,canEdit:v,disabled:y,scrollerLeftOffset:x}=e,b=(0,s().v3)(),w=(0,d().K8)((()=>{if(!r.timeline_by)return null;const e=t.groupsStore.getGroupState(n);if(!e)return null;const l=e.currentLimit.state,s=C().oE([n&&(0,vo().K8)({schema:o,propertyMapping:void 0,groupBy:t.getGroupByAndGroupFormats().groupBy,group:n,timeZone:(0,yo().P)(),experimentService:Io().default}),!i&&{property:r.timeline_by,filter:{operator:"is_not_empty"}}]);return{type:"results",filter:s.length>0?{operator:"and",filters:s}:void 0,limit:l}}),[t,o,n,r,i]),k=(0,d().K8)((()=>t.groupsStore.getGroupState(n)),[t,n]),T=n?[n]:[],I=(0,d().K8)((()=>null==k?void 0:k.reducerResultStore.state),[null==k?void 0:k.reducerResultStore]),R=(0,d().K8)((()=>L().XQ({collectionContextStore:t,reducerResult:I,isFullScreen:c})),[t,I,c]),j=(0,d().K8)((()=>L().Cn({query:r,schema:o})),[r,o]),A=(0,d().K8)((()=>(a.timeline_properties||[]).filter((e=>{let{visible:t}=e;return t})).map((e=>{let{property:t}=e;return t}))),[a]);return k?(0,S.jsxs)(S.Fragment,{children:[w&&(0,S.jsx)(Wo().A,{id:T.length>0?`results:${(0,so().Hm)(T)}`:"timeline_results",reducer:w,groupsPointer:T,collectionContextStore:t,resultStore:k.reducerResultStore}),(0,S.jsx)(Om,{groupFormat:n,format:a,collectionContextStore:t,store:l,schema:o,query:r,isInPeekRenderer:p,timelineState:m,blockPropertyValueOverlayStore:g,showTimelineProperties:A,paddingLeft:u,isFullScreen:c,isRootChild:h,isReady:f,canEdit:v,canEditTimelineItems:j,disabled:y,showTable:i,scrollerLeftOffset:x}),R&&(0,S.jsx)("div",{style:{width:"100%"},children:i?(0,S.jsx)("div",{style:{height:ho().LA}}):(0,S.jsx)(ho().Ay,{style:{position:"sticky",left:c?u:3,width:"max-content",height:ho().LA},groupsPointer:T,store:l,collectionContextStore:t,format:a,isFullScreen:c,incrementLimitsInRelatedGroups:!1})}),(0,S.jsx)(Vm,{...e,store:void 0,indentLevel:0,handleOpenPeekPage:()=>Lm(t,n,b),canEditTimelineItems:j,showTimelineProperties:A})]}):null};function Lm(e,t,o){const n=e.groupsStore.getGroupState(t);if(!n)return;Pe().default.DO_NOT_USE_markLegacy("collections.open_item_page_lag");const r=e.collectionViewStore();j().Ey({collectionContextStore:e,resultsStore:n.resultsStore});const i=null==r?void 0:r.getFormat().collection_peek_mode,l=i||on().C9.timeline;Zo().bn(o,{is_peek:!0,from:"timeline",peek_mode:l})}function Om(e){const t=(0,s().v3)(),{groupFormat:o,format:n,collectionContextStore:r,disabled:i,query:l,schema:a,blockPropertyValueOverlayStore:c,isFullScreen:u,isRootChild:p,showTable:m,canEditTimelineItems:g,scrollerLeftOffset:h,timelineState:f,paddingLeft:v,showTimelineProperties:y,isInPeekRenderer:x}=e,C=(0,d().K8)((()=>{const e=r.permissionScopesStore.state;return{disabled:i||!("collectionTypedView"===r.contextType||e.canEditContent),timelineState:f,schema:a,query:l,format:n,scrollerLeftOffset:h,paddingLeft:v,showProperties:y,blockPropertyValueOverlayStore:c,collectionContextStore:r,isFullScreen:u,showTable:m,isRootChild:p,groupFormat:o,canEditTimelineItems:g,isInPeekRenderer:x,handleOpenPeekPage:()=>Lm(r,o,t),isLast:!1}}),[r,o,n,t,i,l,a,c,u,p,m,g,h,f,v,y,x]),b=(0,d().K8)((()=>r.groupsStore.getGroupState(o)),[r,o]);return b?(0,S.jsx)(gn,{disableSelectable:!0,collectionContextStore:r,groupsPointer:b.groupsPointer,format:n,canDrag:!1,disableRequest:!0,resultProps:C,canDrop:!1,resultComponent:Tm,disabled:!0,direction:pn.Vertical,shouldShowHoverMenu:!1,analyticsName:"timeline",emptyDroppableSize:0,nestedCreateSubitemButton:o=>function(e,t,o){return(0,S.jsx)(Vm,{...o,store:e.store,indentLevel:e.indentLevel,parentStore:e.parentStore,subitemPath:e.subitemPath,handleOpenPeekPage:()=>Lm(o.collectionContextStore,o.groupFormat,t),canEditTimelineItems:o.canEditTimelineItems,showTimelineProperties:o.showTimelineProperties})}(o,t,e)}):null}const Em=n.memo((function(e){let{store:t,collectionContextStore:o,timelineState:r,disabled:i,isFullScreen:l,isInPeekRenderer:a,paddingLeft:c,isRootChild:p,format:m,schema:g,query:h,showTable:f,groupsReducerResultStore:v,hiddenGroupsVisibleStore:y,canEditCollectionTimeline:x,isReady:C,blockPropertyValueOverlayStore:b,tableStore:w,scrollerLeftOffset:k,onGroupHeaderAddItem:T}=e;const I=(0,n.useMemo)((()=>({type:"item",reducerResultStore:v,hiddenGroupsVisibleStore:y})),[v,y]),R=(0,n.useCallback)((e=>{if(!f)return(0,S.jsx)(fm,{timelineState:r,...e})}),[f,r]),j=(0,d().K8)((()=>(0,_().Ty)(m,w)),[m,w]),A=(0,n.useCallback)((e=>(0,S.jsx)(Fm,{store:t,groupFormat:e,schema:g,query:h,isInPeekRenderer:a,timelineState:r,collectionContextStore:o,blockPropertyValueOverlayStore:b,paddingLeft:c,format:j,isFullScreen:l,isRootChild:p,isReady:C,canEdit:x,disabled:i,showTable:f,scrollerLeftOffset:k})),[b,x,o,j,i,l,a,C,p,c,h,g,k,f,t,r]),P=function(e){let{collectionContextStore:t,isFullScreen:o,disabled:r,format:i,hiddenGroupsVisibleStore:l,showTable:a,canEditCollectionTimeline:c}=e;const{isMobile:d}=(0,s().Y0)(),p=(0,u().DP)(),m=am({collectionContextStore:t,isFullScreen:o,disabled:r,format:i,hiddenGroupsVisibleStore:l,showTable:a,canEditCollectionTimeline:c});return(0,n.useCallback)((e=>{const t=m(e),o=(0,_().sG)({isMobile:d});let n=0,r=0;return t.groupHeader&&a&&(n+=qt().tp+qt().lH),t.tableHeaderRow&&(n+=qt().MR-1),t.tableAggregationRow&&(r+=o),t.addItemRow||(r+=1),t.tableEmptyRow&&(r+=o),t.hiddenGroupsButton&&a&&(r+=Vl+Fl+Ll),t.groupsLoadMoreButton&&a&&(r+=Dl+2*zl),t.addGroupButton&&a&&(r+=Ms+_s+Bs),{paddingTop:n,paddingBottom:r,minHeight:qt().tp,boxShadow:e.index>0&&(!a||t.tableHeaderRow)?`inset 0 -1px 0 ${p.tableDividerColor}`:void 0}}),[d,m,a,p.tableDividerColor])}({collectionContextStore:o,isFullScreen:l,disabled:i,format:m,hiddenGroupsVisibleStore:y,showTable:f,canEditCollectionTimeline:x});return m.collection_group_by?(0,S.jsx)(Ki().l,{children:(0,S.jsx)(rs,{reducerId:"timeline_groups",store:t,collectionContextStore:o,disabled:i,isFullScreen:l,isRootChild:p,paddingLeft:c,stickyLeft:!1,renderGroup:A,getGroupStyle:P,renderHeader:R,onGroupHeaderAddItem:T,timelineProps:I})}):A()}));const Dm=function(e){let{isGrouped:t,format:n,collectionContextStore:r,isFullScreen:i,isRootChild:l,timelineState:a}=e;const c=(0,u().DP)(),d=(0,s().v3)(),{device:p}=d;return(0,S.jsx)(At().A,{render:e=>(0,S.jsx)(rt().p,{size:"sm",onClick:()=>function(e,t,o,n,r,i){const l=o.collectionViewStore();if(!l)return;B().createAndCommit({userAction:"CollectionTimelineViewHideTableButton.handleHideTableClick",environment:e,canUndo:!0,perform:e=>{const o=(0,qt().iH)(t,!1);Nn().zA({stores:[l],update:o,transaction:e})}}),(0,op().VD)(e,{...(0,op().ZR)({environment:e,collectionContextStore:o,timelineState:i,isFullScreen:n,isRootChild:r}),show:!1})}(d,n,r,i,l,a),style:{position:"absolute",top:t?p.isIOS?3:4:p.isIOS?7:8,right:t?6:8,zIndex:84,fill:c.lightIconColor},...e,children:(0,o(420767).B)({width:14})}),renderTooltip:()=>(0,S.jsx)(k().sA,{id:"database.timelineView.tableGroupResults.hideTableButton.title",defaultMessage:"Hide table"})})};function zm(){const e=(0,u().IS)((e=>({rowContainer:{display:"flex",height:34,padding:"7px 0px",alignItems:"center",gap:6,alignSelf:"stretch",flex:"1 0 0",borderBottom:`1px solid ${e.regularDividerColor}`},rowShimmer:{width:"80%",height:10,flexShrink:0,borderRadius:12,marginLeft:12,backgroundColor:e.lightDividerColor}})),[]);return(0,S.jsx)("div",{style:e.rowContainer,children:(0,S.jsx)(Er().A,{style:e.rowShimmer})})}const Km=function(e){let{showTablePropertyFormatsStore:t,groupFormat:o,isFullScreen:r,collectionContextStore:i,blockPropertyValueOverlayStore:l,isReady:s,store:a,disabled:c,format:u,schema:p,isInPeekRenderer:m,query:g,showHoverActionsStore:h,paddingBottom:f,tableStore:v,timelineState:y,isRootChild:x,canEdit:C,paddingLeft:b,paddingRight:w}=e;const k=(0,d().K8)((()=>t.state.findIndex((e=>"title"===e.property))),[t]),T=(0,n.useMemo)((()=>o?[o]:[]),[o]),I=(0,d().K8)((()=>i.groupsStore.getGroupState(T)),[i,T]),R=(0,d().K8)((()=>null==I?void 0:I.reducerResultStore.state),[I]),j=(0,d().K8)((()=>(0,L().XQ)({collectionContextStore:i,reducerResult:R,isFullScreen:r})),[i,R,r]),A=(0,d().O$)(i.shouldShowSpinnerStore),P=(0,d().O$)(i.permissionScopesStore),M=(0,d().O$)(t),B=(0,d().O$)(i.isInHomeWidgetStore),_=(0,d().K8)((()=>function(e,t,o){const n=e.permissionScopesStore.state,r="collectionTypedView"===e.contextType;return Boolean(!e.isInHomeWidgetStore.state&&t&&(o||r)&&!n.isSyncedCollection)}(i,s,C)),[i,s,C]);if(!I)return null;const V=s&&0===(null==R?void 0:R.blockIds.length)&&!A;return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(Wm,{store:a,format:u,schema:p,query:g,collectionContextStore:i,disabled:c,paddingBottom:f,isInPeekRenderer:m,blockPropertyValueOverlayStore:l,tableStore:v,showTablePropertyFormats:M,timelineState:y,isFullScreen:r,isRootChild:x,groupFormat:o,isInHomeWidget:B,paddingLeft:b,paddingRight:w}),V&&(0,S.jsx)(qm,{collectionContextStore:i,isFullScreen:r,groupFormat:o,blockPropertyValueOverlayStore:l,canEdit:C}),(0,S.jsx)(eg,{store:a,schema:p,query:g,collectionContextStore:i,blockPropertyValueOverlayStore:l,showTablePropertyFormatsStore:t,canEdit:C,format:u,tableStore:v,paddingLeft:b,disabled:c,groupFormat:o,titleColumnIndex:k,groupsPointer:T}),A&&(0,S.jsx)(zm,{}),j&&(0,S.jsx)(Xm,{collectionContextStore:i,format:u,canEdit:C,groupFormat:o,isFullScreen:r,groupsPointer:T}),_&&(0,S.jsx)(Ym,{collectionContextStore:i,isFullScreen:r,groupFormat:o,blockPropertyValueOverlayStore:l,isInPeekRenderer:m}),(0,S.jsx)(Ad,{groupFormat:o,style:Gm(s,o,r,b),disabled:c||!P.canConfigureBlock,schema:p,query:g,collectionContextStore:i,isInPeekRenderer:m,isFullScreen:r,showPropertyFormats:M,showRightActionsSpacer:!1,paddingLeft:b,paddingRight:w,disableSticky:!0})]})};function Hm(){}function Gm(e,t,o,n){return{...!e&&{opacity:0,pointerEvents:"none"},...!o&&!t&&{position:"sticky",left:n},...o&&!t&&{left:n}}}function Wm(e){let{groupFormat:t,store:o,format:n,schema:r,query:i,collectionContextStore:l,disabled:s,paddingBottom:a,isInPeekRenderer:c,blockPropertyValueOverlayStore:u,tableStore:p,showTablePropertyFormats:m,timelineState:g,isFullScreen:h,isRootChild:f,isInHomeWidget:v,paddingLeft:y,paddingRight:x}=e;const C=(0,d().K8)((()=>l.groupsStore.getGroupState(t)),[l,t]),b=(0,d().O$)(l.permissionScopesStore),w=(0,d().K8)((()=>l.viewIsFlushToTopbar()),[l]);if(!C)return null;const k=Boolean(t);return(0,S.jsx)(Iu,{store:o,format:n,schema:r,query:i,collectionContextStore:l,isInPeekRenderer:c,minWidth:void 0,paddingBottom:a,blockPropertyValueOverlayStore:u,showPropertyFormats:m,showRightActions:!1,allowHidingTitle:!0,tableStore:p,formatKey:"timeline_table_properties",disabled:s||!b.canConfigureBlock,disableHorizontalEdgeScroll:!0,height:(0,qt().Zk)(k),paddingTop:k?0:qt().jI-qt().MR,disableTopBorder:!w||k,disableCellRightBorder:!0,groupFormat:t,isInHomeWidget:v,hasMoreReducerResults:!1,paddingLeft:y,paddingRight:x,children:!k&&b.canConfigureBlock&&(0,S.jsx)(Dm,{isGrouped:!1,format:n,collectionContextStore:l,timelineState:g,isFullScreen:h,isRootChild:f})})}function Nm(e,t,o){return{display:"flex",alignItems:"center",height:(0,_().sG)({isMobile:o}),width:"100%",paddingLeft:8,fontSize:14,lineHeight:w().K_.UIRegular.desktop,background:e?t.cardContentBackground:t.contentBackground}}function $m(e){return{width:14,height:14,marginLeft:-1,marginRight:6,fill:e.lightIconColor}}function Um(e,t,o,n,r,i){const{device:l}=e,s=n?[n]:[],a=t.groupsStore.getGroupState(s);if(!(0,Ye().EF)(e)||!a)return;t.searchQueryStore.state&&(0,jn().S)({searchQuery:"",collectionContextStore:t,isFullScreen:o});const c=t.currentSubitemFormatStoreForCollectionStore.state;B().createAndCommit({userAction:"TimelineTableGroupResults.handleAddRowClick",environment:e,canUndo:!0,perform:o=>{const s=(0,kn().Q)({environment:e,collectionContextStore:t,groupsPointer:n?[n]:[],shouldCoerce:!0,templateStore:t.defaultPageTemplateStore.state,transaction:o,from:{createBlock:"timeline_table_group_results"},inMemoryRecordCache:e.defaultRecordCache.inMemoryRecordCache});if(s){if(l.isMobile){!function(e,t,o){o?o(e):$n().oo({environment:t,url:e})}((0,Zn().Ay)({store:s.newStore,fullyQualified:!1,pageVisitSource:wn().y8.Create}),e,i)}else if(s.coercionSucceeded){const o=()=>{Jo().ho({environment:e,blockPropertyValueOverlayStore:r,store:s.newStore,property:"title",format:Tt().j.Table,collectionContextStore:t,disableHorizontalEdgeScroll:!0})};t.registerCallbackForItemMounted(s.newStore,o)}else{const o=n?[n]:[],r=t.groupsStore.getGroupState(o);In().VU({environment:e,store:s.newStore,peekMode:(0,L().hH)(t),resultsStore:null==r?void 0:r.resultsStore,collectionContextStore:t,pageVisitSource:wn().y8.Create})}Qo().v(e,{from:c?"timeline_add_parent_item_bottom":"timeline_add_item_bottom",type:"page",new_page_id:s.newStore.id,creating_block_id:s.newStore.id,...(0,fe().sl)(t)})}}})}function qm(e){let{collectionContextStore:t,isFullScreen:o,groupFormat:r,blockPropertyValueOverlayStore:i,canEdit:l}=e;const a=(0,u().DP)(),c=(0,s().v3)(),d=(0,n.useContext)(Br().n),p=(0,n.useCallback)((()=>Um(c,t,o,r,i,d)),[c,t,o,r,i,d]);return(0,S.jsx)(Rt().A,{onClick:p,onMouseDown:Ce().tr,disabled:!l,style:{display:"flex",alignItems:"center",height:(0,_().sG)({isMobile:c.device.isMobile}),width:"100%",paddingLeft:8,fontSize:14,lineHeight:w().K_.UIRegular.desktop,background:a.contentBackground,left:0,right:0,borderBottom:`1px solid ${a.tableDividerColor}`},children:l?(0,S.jsx)("span",{style:{color:a.lightTextColor},children:(0,S.jsx)(k().sA,{defaultMessage:"Empty. Click to add a row.",id:"database.timelineView.emptyTablePlaceholder"})}):(0,S.jsx)("span",{style:{color:a.lightTextColor},children:(0,S.jsx)(k().sA,{defaultMessage:"Empty.",id:"database.timelineView.cannotEdit.emptyTablePlaceholder"})})})}function Ym(e){let{collectionContextStore:t,isFullScreen:o,groupFormat:r,blockPropertyValueOverlayStore:i,isInPeekRenderer:l}=e;const a=(0,u().DP)(),c=(0,s().v3)(),d=(0,n.useContext)(Br().n),p=(0,n.useCallback)((()=>Um(c,t,o,r,i,d)),[c,t,o,r,i,d]);return(0,S.jsxs)(Rt().A,{onClick:p,style:Nm(l,a,c.device.isMobile),className:he().$0P,onMouseDown:Ce().tr,children:[(0,uo().W)($m(a)),(0,S.jsx)("span",{style:{color:a.lightTextColor},children:(0,S.jsx)(k().sA,{defaultMessage:"New",id:"database.timelineView.addRowButton"})})]})}function Xm(e){let{groupsPointer:t,collectionContextStore:o,format:n,canEdit:r,groupFormat:i,isFullScreen:l}=e;const a=(0,u().DP)(),c=(0,s().v3)(),p=(0,d().K8)((()=>o.groupsStore.getGroupState(t)),[o,t]),m=(0,d().K8)((()=>(0,bn().Kk)({collectionContextStore:o,groupsPointer:t})),[o,t]);return p?(0,S.jsxs)(Rt().A,{onMouseDown:Ce().tr,onClick:e=>function(e,t,o,n,r){const i=t.groupsStore.getGroupState(o);if(!i)return;const l=i.reducerResultStore.state;(0,Ce().kV)(e),P().IU({environment:r}),l&&(0,So().H)({collectionContextStore:t,environment:r,incrementLimitArgs:{isFullScreen:n,currentResultCount:l.blockIds.length,groupsPointer:i.groupsPointer,incrementLimitsInRelatedGroups:!1}}),(0,vd().K)(r)}(e,o,i,l,c),disabled:m,hoveredStyle:m?{background:a.whiteButtonBackground}:{},style:{display:"flex",alignItems:"center",height:ho().LA,width:"100%",paddingLeft:8,paddingBottom:2,fontSize:14,lineHeight:w().K_.UIRegular.desktop,boxShadow:`0 -1px 0 ${a.tableDividerColor}`,borderBottom:`1px solid ${a.tableDividerColor}`,whiteSpace:"break-spaces"},children:[(0,Uo().P)($m(a)),(0,S.jsx)("span",{style:{color:a.lightTextColor,flexGrow:1},children:(0,S.jsx)(k().sA,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})}),m?(0,S.jsx)("div",{style:{marginTop:1,marginLeft:8,marginRight:8},children:(0,S.jsx)(En().A,{size:"sm"})}):r&&(0,S.jsx)(yd().w,{collectionContextStore:o,format:n})]}):null}function Qm(e){const t=(0,s().v3)(),{isMobile:o}=(0,s().Y0)(),{store:n,parentStore:r,subitemPath:i,indentLevel:l,groupsPointer:a,collectionContextStore:c,disabled:d,blockPropertyValueOverlayStore:u}=e;return r?(0,S.jsx)(od,{store:n,collectionStore:r,subitemPath:i,indentLevel:l,collectionContextStore:c,disabled:d,groupsPointer:a,onSubitemCreate:e=>function(e,t,o,n){if(o){const r=()=>{Jo().ho({isNewBlock:!0,environment:n,blockPropertyValueOverlayStore:o,store:e,property:"title",format:Tt().j.Table,collectionContextStore:t,disableHorizontalEdgeScroll:!0})};t.registerCallbackForItemMounted(e,r)}}(e,c,u,t),styles:{height:(0,_().sG)({isMobile:o})+1}}):null}const Zm=[];function Jm(e){let{args:t,schema:o,disabled:n,collectionContextStore:r,blockPropertyValueOverlayStore:i,showTablePropertyFormatsStore:l,canEdit:a,format:c,groupFormat:p,titleColumnIndex:m}=e;(0,u().DP)();const g=(0,s().Y0)(),h=(0,d().K8)((()=>r.collectionViewStore()),[r]),{groupsPointer:f}=t,v=(0,d().K8)((()=>r.groupsStore.getGroupState(f)),[r,f]),y=(0,d().O$)(l),x=(0,d().K8)((()=>!a&&g.isMobile&&!(null!=h&&h.isSyncedCollection())),[a,g,h]),C=(0,d().O$)(r.isInHomeWidgetStore),b=(0,d().K8)((()=>{const e=r.collectionViewBlockStore();return!(!e||r.isFullScreenStore.state)&&(0,xd().d1)(e)}),[r]),w=(0,d().K8)((()=>(0,te().v2)(p,r)),[p,r]),k=(0,d().K8)((()=>r.isUnlistedViewStore.state&&r.isInlineViewStore.state),[r]),T=(0,d().K8)((()=>{const e=kd().A.state;if(e.isActive)return(0,_().yR)(e.selection,y.length,w.length)}),[w,y]),I=Zm,R=y,j=(0,d().K8)((()=>{const e=r.permissionScopesStore.state;return e.isLocked||!e.canConfigureCollection||!e.canConfigureBlock}),[r.permissionScopesStore]);if(!h||!v)return null;return(0,S.jsx)(gn,{collectionContextStore:r,groupsPointer:f,disableRequest:!0,format:c,canDrag:x,resultProps:{schema:o,collectionContextStore:r,propertyFormats:y,onPropertyTab:t.onPropertyTab,onPropertyUntab:t.onPropertyUntab,onPropertyEnter:t.onPropertyEnter,onPropertyClick:t.onPropertyClick,onPropertyEsc:t.onPropertyEsc,onPropertyBgClick:t.onPropertyBgClick,onPropertyContextMenu:t.onPropertyContextMenu,onOpenProperty:t.onOpenProperty,disabled:n,blockPropertyValueOverlayStore:i,showRightActionsSpacer:!1,disableHorizontalEdgeScroll:!0,disableCellBorderRight:!1,disableLastCellBorderRight:!0,onShiftEnter:Hm,titleColumnIndex:m,groupFormat:p,shouldShowMultiSelectCheckbox:!1,isInHomeWidget:C,isCollectionViewBlockSelected:b,allRows:w,isInEphemeralView:k,normalizedTableSelection:T,unfrozenIndexAddendum:0,frozenPropertyFormats:I,unfrozenPropertyFormats:R,tableWrap:!1,shouldSetCellHeight:!0,isNonEditable:j,shouldShowRightActionSpacer:!1},resultComponent:Lu,canDrop:!1,disabled:n,direction:pn.Vertical,getItemSelectableStyle:()=>({display:"flex",width:"fit-content",height:33}),shouldShowHoverMenu:!0,analyticsName:"timeline",emptyDroppableSize:0,onSelectableEnter:t.onSelectableEnter,disableScrollToRevealHorizontal:!0,blockPropertyValueOverlayStore:i,titleColumnIndex:m,nestedCreateSubitemButton:e=>{let{store:t,parentStore:o,subitemPath:l,indentLevel:s}=e;return(0,S.jsx)(Qm,{collectionContextStore:r,disabled:n,blockPropertyValueOverlayStore:i,store:t,parentStore:o,subitemPath:l,indentLevel:s,groupsPointer:f})}})}function eg(e){let{groupFormat:t,groupsPointer:o,store:r,schema:i,query:l,collectionContextStore:s,blockPropertyValueOverlayStore:a,showTablePropertyFormatsStore:c,canEdit:u,format:p,tableStore:m,paddingLeft:g,disabled:h,titleColumnIndex:f}=e;const v=(0,d().K8)((()=>s.collectionViewStore()),[s]),y=(0,d().K8)((()=>s.groupsStore.getGroupState(t)),[s,t]),x=(0,d().O$)(c),C=(0,n.useCallback)((e=>(0,S.jsx)(Jm,{schema:i,disabled:h,collectionContextStore:s,blockPropertyValueOverlayStore:a,showTablePropertyFormatsStore:c,canEdit:u,format:p,groupFormat:t,titleColumnIndex:f,args:{...e,groupsPointer:o}})),[i,h,s,a,c,u,p,t,f,o]);return v&&y?(0,S.jsx)($u,{store:r,collectionContextStore:s,minWidth:void 0,blockPropertyValueOverlayStore:a,showPropertyFormats:x,disabled:!u,disableHorizontalEdgeScroll:!0,groupFormat:t,render:C,tableStore:m,paddingLeft:g}):null}const tg=n.memo((function(e){let{store:t,tableStore:r,collectionContextStore:i,timelineState:l,format:s,schema:a,query:c,isFullScreen:p,groupBy:m,paddingLeft:g,paddingRight:h,paddingBottom:f,scrollerLeftOffset:v,isInPeekRenderer:y,isInHomeWidget:x,computedOuterHeight:C,showHoverActionsStore:b,blockPropertyValueOverlayStore:w,isRootChild:k,isReady:T,disabled:I,canEditCollectionTimeline:R,viewIsFlushToTopbar:j,groupsReducerResultStore:A,hiddenGroupsVisibleStore:P,onGroupHeaderAddItem:M}=e;const B=(0,Ae().X)("db_ux_simplification_next"),V=(0,n.useRef)(null),F=(0,d().r6)((()=>{const e=(0,_().Ty)(s,r);return(e&&e.timeline_table_properties?e.timeline_table_properties:[]).filter((e=>e.visible))}),[s,r],{useDeepEqual:!0});(0,d().O$)(F);const L=(0,d().K8)((()=>F.state.reduce(((e,t)=>e+(t.width||0)),0)),[F]),O=(0,u().IS)((e=>({selectable:{whiteSpace:"nowrap",...x?{}:{background:y?e.cardContentBackground:e.contentBackground},paddingLeft:g,boxSizing:"border-box",borderRight:`1px solid ${e.tableDividerColor}`,boxShadow:e.timelineTableBoxShadow,clipPath:"polygon(0% 0%, 120% 0%, 120% 100%, 0% 100%)",width:L+g,height:x?"100%":C},tableGroupHeaderSticky:{borderRight:`1px solid ${e.tableDividerColor}`,"--timeline-box-shadow":"0px"},tableGroupHeaderTransition:{borderRight:void 0},tableGroupHeader:{boxShadow:B?void 0:`inset 0 var(--timeline-box-shadow, 1px) 0 ${e.tableDividerColor}`}})),[x,y,g,L,C,B]),E=(0,d().K8)((()=>(0,_().Ty)(s,r)),[s,r]),D=(0,n.useCallback)((e=>(0,S.jsx)(Km,{store:t,groupFormat:e,schema:a,query:c,isInPeekRenderer:y,timelineState:l,collectionContextStore:i,blockPropertyValueOverlayStore:w,showTablePropertyFormatsStore:F,showHoverActionsStore:b,tableStore:r,paddingLeft:g,paddingRight:h,paddingBottom:f,format:E,isFullScreen:p,isRootChild:k,isReady:T,canEdit:R,disabled:I&&R})),[w,R,i,I,E,p,y,T,k,f,g,h,c,a,b,F,t,r,l]),z=(0,n.useCallback)((e=>{const t=i.permissionScopesStore.state;return(0,S.jsx)(Gi,{...e,height:qt().tp,paddingTop:qt().lH,stickyStyle:O.tableGroupHeaderSticky,transitionStickyStyle:O.tableGroupHeaderTransition,style:0!==e.index||j?O.tableGroupHeader:{},stickyWrapStyle:{marginBottom:qt().lH},children:0===e.index&&t.canConfigureBlock&&(0,S.jsx)(Dm,{isGrouped:!0,format:s,collectionContextStore:i,timelineState:l,isFullScreen:p,isRootChild:k})})}),[i,s,p,k,O.tableGroupHeader,O.tableGroupHeaderSticky,O.tableGroupHeaderTransition,l,j]),K=(0,n.useCallback)((()=>({})),[]),H=(0,n.useCallback)((()=>(0,S.jsx)(rs,{reducerId:"timeline_groups",store:t,collectionContextStore:i,disabled:I,isFullScreen:p,isRootChild:k,paddingLeft:g,stickyLeft:!1,renderGroup:D,getGroupStyle:K,renderHeader:z,onGroupHeaderAddItem:M,timelineProps:{type:"table",reducerResultStore:A,hiddenGroupsVisibleStore:P}})),[i,I,K,A,P,p,k,M,g,z,D,t]);return(0,S.jsx)("div",{style:{position:"sticky",left:0,height:0,width:L,zIndex:3},children:(0,S.jsx)(lt().A,{style:O.selectable,store:t,shouldShowHalo:!1,canSelect:!p,analyticsName:"timeline",children:(0,S.jsx)(o(725976).q,{name:"timeline-side-table",stickyHorizontally:!0,horizontalWidthLimiter:v,children:m?H():(0,S.jsx)(il().b,{nodeRef:V,children:(0,S.jsx)("div",{ref:V,children:D(void 0)})})})})})})),og=n.memo(n.forwardRef((function(e,t){let{store:r,collectionContextStore:i,query:l,schema:p,format:m,paddingLeft:g,paddingRight:h,isFullScreen:f,isPreviewing:v,isRootChild:y,disabled:x,isInPeekRenderer:C,paddingBottom:b,showHoverActionsStore:w,blockPropertyValueOverlayStore:T}=e;const I=function(e){let{isFullScreen:t,isRootChild:o}=e;const[r]=(0,n.useState)((()=>(0,qt().o8)({isFullScreen:t,isRootChild:o})));return r}({isFullScreen:f,isRootChild:y}),R=(0,s().v3)(),j=(0,s().Y0)();(0,a().l)((()=>{const e=i.collectionViewStore();e&&tp().n_({timelineState:I,environment:R,collectionViewStore:e,collectionContextStore:i}),(0,op().iH)(R,(0,op().ZR)({environment:R,collectionContextStore:i,timelineState:I,isFullScreen:f,isRootChild:y}))})),function(e){let{collectionContextStore:t,query:o,schema:r,environment:i}=e;(0,n.useEffect)((()=>{const e=t.collectionStore();if(e&&!o.timeline_by&&e.isDefined()){const e=t.permissionScopesStore.state,o=t.collectionStore();if(!o||!o.isDefined())return;const n=t.collectionViewStore();if(!n||!e.canConfigureBlock)return;const l=(0,k().YK)({date:{id:"database.timelineView.dateProperty.defaultName",defaultMessage:"Date"}});B().createAndCommit({userAction:"CollectionTimelineView.updateOrCreateTimelineProperty",environment:i,canUndo:!0,perform:t=>{let s,a=L().HG(r);if(!a&&e.canConfigureCollection){a=(0,qs().Ay)();s={[a]:{name:yt().A.formatMessage(l.date),type:"date"}}}a&&((0,ii().f)({collectionViewStore:n,update:{timeline_by:a},transaction:t}),Ko().zv({store:n,data:{type:"timeline"},transaction:t}),s&&(0,Ys().F)({environment:i,collectionStore:o,update:s,transaction:t}))}})}}),[o,t,r,i])}({collectionContextStore:i,query:l,schema:p,environment:R}),function(e){(0,n.useEffect)((()=>{const t=()=>{Ke().A.state&&e.hoveredItemStore.setState(void 0)};return Ke().A.addListener(t),()=>{Ke().A.removeListener(t)}}),[e])}(I),function(e){let{environment:t,collectionContextStore:o,timelineState:r,isFullScreen:i,isRootChild:l}=e;(0,n.useEffect)((()=>{const e=r.drawStateStore.state;if(null!=e&&e.tryToCompleteDrawnArrow){(0,qt().tH)(o)&&B().createAndCommit({userAction:"TimelineItemDependencyDrawHandle.completeUserDrawnArrow",environment:t,canUndo:!0,perform:e=>{tp().sd({timelineState:r,environment:t,transaction:e,collectionContextStore:o,isFullScreen:i,isRootChild:l})}})}}))}({environment:R,collectionContextStore:i,timelineState:I,isFullScreen:f,isRootChild:y}),(0,c().X)((()=>{I.destroyed=!0,I.outerSizeObserver.destroy(),I.timelineSizeObserver.destroy(),I.horizontalScroller&&(I.horizontalScroller.scrollLeft=0,(0,xe().Ol)(I.horizontalScroller,"scroll",F))}));const A=(0,d().uB)(void 0,gd),P=(0,d().uB)(void 0,np),M=(0,d().uB)(void 0,ia),_=(0,n.useCallback)((()=>{const{horizontalScroller:e,outerSizeObserver:t}=I;if(!e)return;const o=I.zoomLevelStore.state,{startTimestamp:n,endTimestamp:r}=I.currentRangeStore.state,i=e.scrollLeft,l=t.rect.state.width,s=(0,qt().w0)(o,r-n),a=(0,qt().o$)(I);if(i<qt().XK){const e=-(0,qt().C1)(o,qt().E6);I.currentRangeStore.setState({startTimestamp:n+e,endTimestamp:r+e}),tp().k3({timelineState:I,environment:R,zoomLevel:o,centerTimestamp:a})}else if(i+l>s-qt().XK){const e=(0,qt().C1)(o,qt().E6);I.currentRangeStore.setState({startTimestamp:n+e,endTimestamp:r+e}),tp().k3({timelineState:I,environment:R,zoomLevel:o,centerTimestamp:a})}}),[I,R]),V=(0,Gn().U)(_,200),F=(0,n.useCallback)((()=>{const{horizontalScroller:e,savePreference:t}=I;if(!e)return;const o=e.scrollLeft,n=I.scrollLeftStore.state;R.device.isIOS&&void 0!==n&&0===o&&n>qt().XK?e.scrollLeft=n:(t&&t(),I.scrollLeftStore.setState(o),(0,qt().nS)(R)?V():_())}),[I,R,V,_]),O=(0,n.useCallback)((()=>{const{startTimestamp:e,endTimestamp:t}=I.currentRangeStore.state;tp().bu({timelineState:I,centerTimestamp:(e+t)/2})}),[I]),E=(0,n.useRef)(null),D=(0,n.useCallback)((e=>{if(e){E.current=e;const{outerSizeObserver:t}=I;t.observe(e);const o=(0,Re().T8)(e);o&&(I.horizontalScroller=o,(0,xe().P4)(o,"scroll",F),O())}}),[F,O,I]),z=(0,d().K8)((()=>i.viewIsFlushToTopbar()),[i]),K=(0,n.useRef)(null),H=(0,d().K8)((()=>{const e=I.zoomLevelStore.state,{startTimestamp:t,endTimestamp:o}=I.currentRangeStore.state;return(0,qt().w0)(e,o-t)}),[I]),G=(0,d().K8)((()=>!v&&(0,qt().Od)({environment:R,isRootChild:y,isFullScreen:f,format:m})?qt().HV:g),[v,y,f,m,g,R]),W=(0,d().K8)((()=>(0,qt().Ho)({environment:R,paddingLeft:G,format:m,isFullScreen:f,isRootChild:y})),[R,m,f,y,G]);(0,Qd().b)(o(297727).A,(()=>({getNode:()=>K.current,customizeEdgeScrollRect(e){const t=W;return La().z8.from({top:e.top,height:e.height,left:e.left+t,width:e.width-t})}})),[W]),(0,n.useImperativeHandle)(t,(()=>({addBlockToView(e){let{store:t,transaction:o}=e;const n=t.getAssociatedCollectionStore()??i.collectionStore();if(n)return tp().$N({environment:R,store:t,timelineState:I,query:l,collectionStore:n,collectionContextStore:i,groupFormat:void 0,transaction:o})}})));const N=(0,d().K8)((()=>(0,qt().iw)({environment:R,format:m,isFullScreen:f,isRootChild:y})),[R,m,f,y]),$=(0,d().K8)((()=>i.groupsStore.anyGroupHasResults()),[i]),U=(0,d().O$)(i.isInHomeWidgetStore),q=(0,d().K8)((()=>!!i.viewsModuleContextStore.getViewModuleType()),[i]),Y=(0,ue().Zp)(),X=(0,d().K8)((()=>L().mM(i,f)),[i,f]),Q=(0,d().K8)((()=>{const{timelineSizeObserver:e}=I;return(e.rect.state.height||120)+b+(f?0:72)+(!f&&N?28:0)+(f&&j.isMobile?72:0)}),[I,b,f,N,j.isMobile]),Z=function(e,t){const o=(0,je().bx)(e,!1);return(0,d().K8)((()=>{const e=t.permissionScopesStore.state;return o&&e.canEditContent&&!e.isSyncedCollection}),[o,t])}(r,i),J=(0,n.useCallback)((e=>{if(e){const{timelineSizeObserver:t}=I;t.observe(e)}}),[I]),ee=(0,n.useCallback)(((e,t,o)=>{if(R.device.isMobile)Tn().uK({environment:R,store:e,pageVisitSource:wn().y8.Create});else{const{groupFormat:t}=o,n=t?[t]:[],r=i.groupsStore.getGroupState(n),l="collectionTypedView"===i.contextType;In().VU({environment:R,store:e,peekMode:L().hH(i),showMoveTo:l,resultsStore:null==r?void 0:r.resultsStore,collectionContextStore:i,pageVisitSource:wn().y8.Create})}}),[R,i]),te=(0,n.useCallback)((e=>{const t=i.isLoadingStore.state,o=i.groupsStore.getGroupState([]);if(!o)return;const n=o.reducerResultStore.state;e<De().A.incrementScrollOffset&&n&&!t&&n.hasMore&&(0,So().H)({collectionContextStore:i,environment:R,incrementLimitArgs:{isFullScreen:f,currentResultCount:n.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})}),[i,R,f]),oe=(0,u().IS)((e=>({container:{position:"relative",float:"left",minWidth:"100%",width:H,...U?{}:{background:C?e.peekTimelineBackground:e.timelineBackground},...!f&&!N&&!U&&{borderBottom:`1px solid ${e.tableDividerColor}`},...(!$||U)&&{minHeight:150},...f&&{paddingBottom:b},height:U?"100%":Q}})),[Q,f,U,C,$,b,H,N]),{timeline_by:ne}=l;if(!ne)return(0,S.jsx)(Jp,{collectionContextStore:i,isFullScreen:f,paddingBottom:b});const re=p[ne];return re&&co().$L(re)?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("div",{ref:D}),!z&&!v&&(0,S.jsx)("div",{style:{height:4}}),(0,Ar().A)((e=>(0,S.jsx)(il().b,{nodeRef:K,width:H,clipLeftExtra:W||(f?0:G),children:(0,S.jsx)("div",{style:oe.container,className:he().dBr,ref:K,...e,children:(0,S.jsxs)(lt().A,{store:r,analyticsName:"timeline",shouldShowHalo:!f&&!U&&!v,canSelect:!f&&!q,disablePointerEvents:null==Y?void 0:Y.disableAllPointerEvents,style:U?{height:"100%"}:{},children:[(0,S.jsx)(tm,{timelineState:I}),(0,S.jsxs)("div",{style:{position:"absolute",width:"100%",zIndex:0,top:qt().jI},ref:J,children:[(0,S.jsx)(Em,{store:r,schema:p,query:l,showTable:N,collectionContextStore:i,timelineState:I,disabled:x,isFullScreen:f,isRootChild:y,isInPeekRenderer:C,paddingLeft:G,groupsReducerResultStore:M,hiddenGroupsVisibleStore:P,format:m,canEditCollectionTimeline:Z,isReady:$,blockPropertyValueOverlayStore:T,tableStore:A,scrollerLeftOffset:W,onGroupHeaderAddItem:ee}),(0,S.jsx)(xp,{timelineState:I,disabled:x,isReady:$,renderEmitter:i.renderEmitter,isFullScreen:f,isRootChild:y})]}),(0,S.jsx)(zp,{isInPeekRenderer:C,timelineState:I,query:l,schema:p,scrollerLeftOffset:W,collectionContextStore:i,showTable:N}),!(null!=Y&&Y.disableAllPointerEvents)&&(0,S.jsx)(Rp,{timelineState:I,isInPeekRenderer:C,paddingLeft:G,paddingRight:!f&&y?8:h,format:m,scrollerLeftOffset:W,isFullScreen:f,isRootChild:y,showTable:N,collectionContextStore:i,isReady:$}),N&&(0,S.jsx)(tg,{store:r,collectionContextStore:i,groupBy:m.collection_group_by,paddingLeft:G,disabled:x,isFullScreen:f,isRootChild:y,format:m,schema:p,query:l,tableStore:A,scrollerLeftOffset:W,isInPeekRenderer:C,paddingRight:h,paddingBottom:b,isInHomeWidget:U,computedOuterHeight:Q,timelineState:I,showHoverActionsStore:w,blockPropertyValueOverlayStore:T,viewIsFlushToTopbar:z,isReady:$,canEditCollectionTimeline:Z,groupsReducerResultStore:M,hiddenGroupsVisibleStore:P,onGroupHeaderAddItem:ee}),(0,S.jsx)("div",{style:{paddingTop:qt().jI,pointerEvents:"none"},children:(0,S.jsx)(hm,{store:r,collectionContextStore:i,disabled:x,isFullScreen:f,paddingLeft:G,isRootChild:y,format:m,groupsReducerResultStore:M,hiddenGroupsVisibleStore:P,canEditCollectionTimeline:Z,onGroupHeaderAddItem:ee,showTable:N})}),!X&&(0,S.jsx)(Cn().A,{onChange:te})]})})})))]}):(0,S.jsx)(Jp,{collectionContextStore:i,isFullScreen:f,paddingBottom:b})})));const ng=new(ne().O2)("CollectionChartView",(async()=>await Promise.all([o.e(62475),o.e(3151),o.e(98629),o.e(42838),o.e(27634),o.e(28721),o.e(3720),o.e(88372),o.e(22)]).then(o.bind(o,265924)))),rg=(0,ne()._h)(ng,(e=>e.CollectionChartView)),ig=new(ne().O2)("CollectionFormEditorView",(async()=>await Promise.all([o.e(44711),o.e(53321),o.e(63077),o.e(95794),o.e(46414),o.e(28271),o.e(17254),o.e(5396),o.e(47762),o.e(21682),o.e(23133)]).then(o.bind(o,766911)))),lg=(0,ne()._h)(ig,(e=>e.CollectionFormEditorView));var sg=()=>o(572088);const ag={CollectionMapView:new(ne().O2)("CollectionMapView",(async()=>await Promise.all([o.e(83700),o.e(51680)]).then(o.bind(o,19537))))},cg=(0,ne()._h)(ag.CollectionMapView,(e=>e.CollectionMapView));var dg=()=>o(370873),ug=()=>o(750660);const pg=new(ne().O2)("CollectionTasksEmptyStateModal",(async()=>await Promise.all([o.e(23806),o.e(1440),o.e(47536)]).then(o.bind(o,201440)))),mg=(0,ne()._h)(pg,(e=>e.CollectionTasksEmptyStateModal));var gg=()=>o(162674),Sg=()=>o(610101),hg=()=>o(920773);const fg=32,vg="noWritableDbs";function yg(e){const{collectionContextStore:t,onAddTaskClick:o,from:r}=e,i=(0,s().v3)(),l=(0,n.useRef)(null),a=(0,d().O$)(t.isInHomeWidgetStore),c=(0,d().K8)((()=>t.collectionStoresStore.state.length>0),[t.collectionStoresStore]),p=(0,d().K8)((()=>{const e=t.collectionStoresStore.state;return Boolean(e.find((e=>e.canEdit()||e.canEditCollection()||e.canEditContentOnly())))}),[t.collectionStoresStore]),m=(0,d().K8)((()=>(0,L().h6)(t)),[t]),g=(0,d().K8)((()=>!t.isFullScreenStore.state),[t]),h=(0,n.useCallback)((e=>{var t;const n=null===(t=l.current)||void 0===t?void 0:t.getBoundingClientRect();n&&ug().qL({environment:i,originRect:n,moveToContext:"aggregated_type",overrideDatabaseType:"notion://tasks_collection",onAccept:()=>{o(e)}})}),[i,o]),f=(0,u().IS)((e=>({container:{width:"100%",height:g?"calc(100% - 4px)":void 0,paddingTop:g?32:120,paddingBottom:32,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",fontSize:14,color:e.lightTextColor},desktopInner:{width:800,minWidth:800,padding:fg},icon:(0,_e().Xx)(e)})),[g]),v=(0,n.useMemo)((()=>c?(0,S.jsx)(At().A,{disableTooltip:p,placement:Fe().W.Bottom,renderTooltip:()=>(0,S.jsx)(k().sA,{defaultMessage:"You do not have permissions{br}to edit the source databases",id:"tasksEmptyState.addTask.tooltip.noWritableDbs",values:{br:(0,S.jsx)("br",{})}}),render:e=>(0,S.jsx)(hg().p,{...e,isBlue:!0,ref:l,disabled:!p,disabledFeedback:!p,onClick:e=>{(0,gg().bS)({environment:i,from:r}),h(e)},icon:e=>(0,uo().W)(e),children:m})}):(0,S.jsx)(hg().p,{isBlue:!0,onClick:()=>{(0,gg().bS)({environment:i,from:r}),Sg().A.setState(!0)},children:(0,S.jsx)(k().sA,{defaultMessage:"Don't see your tasks?",id:"tasksEmptyState.noDatabases.title"})})),[c,p,m,i,r,h]);return a&&!c?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(mg,{from:r}),(0,S.jsx)(Me().Ww,{feature:"tasks",onSetup:()=>{(0,gg().bS)({environment:i,from:r}),Sg().A.setState(!0)}})]}):(0,S.jsxs)("div",{style:f.container,children:[(0,S.jsx)(mg,{from:r}),(0,dg().p)(f.icon),(0,S.jsx)(Ds().A,{size:16}),p?(0,S.jsx)(k().sA,{defaultMessage:"No matching tasks.",id:"tasksEmptyState.noMatchingTasks.title"}):(0,S.jsx)(k().sA,{defaultMessage:"See all tasks assigned to you here.",id:"tasksEmptyState.noTasks.title"}),(0,S.jsx)(Ds().A,{size:16}),v]})}var xg=()=>o(222299);const Cg=new(ne().O2)("views-main-builder-modules",(()=>Promise.all([o.e(44711),o.e(53321),o.e(63077),o.e(95794),o.e(46414),o.e(28271),o.e(17254),o.e(5396),o.e(47762),o.e(21682),o.e(70605)]).then(o.bind(o,984318)))),bg=(0,ne()._h)(Cg,(e=>e.ViewsMainBuilderModules));var wg=()=>o(778781),kg=()=>o(548821),Tg=()=>o(729923),Ig=()=>o(9768);const Rg=n.memo((function(e){const{modules:t,store:n,collectionStore:r,context:i,disabled:l,templatePickerMenuListStore:a,pageLayoutRef:c,collectionContextStore:u,editorContentContainerRef:p}=e,m=(0,s().v3)(),g=(0,d().K8)((()=>r.getSchema()),[r]),h=(0,d().K8)((()=>(0,o(577814).A)({environment:m,store:n,pageViewBlockStore:void 0})),[m,n]),f=(0,S.jsx)(S.Fragment,{children:t.map((e=>(0,S.jsx)(jg,{module:e,store:n,context:i,disabled:l,collectionSchema:g,collectionStore:r,modules:t,templatePickerMenuListStore:a,pageLayoutRef:c,pageDiscussionsRenderState:h,editorContentContainerRef:p},e.id)))});return u?(0,S.jsx)(Z().RI,{value:u,children:f}):f}));function jg(e){let{module:t,store:r,context:i,disabled:l,collectionSchema:a,collectionStore:c,modules:u,templatePickerMenuListStore:p,pageLayoutRef:m,pageDiscussionsRenderState:g,editorContentContainerRef:h}=e;const f=(0,s().v3)(),v=(0,Ig().Br)({layoutModule:t,area:"views_main_tab_modules",collectionSchema:a,collectionStore:c,pageMainModules:u,showDetailsPanelToggleButtonBelowTitle:!1}),y=(0,Ig().Jh)({layoutModule:t,area:"views_main_tab_modules",collectionSchema:a,collectionStore:c,showDetailsPanelToggleButtonBelowTitle:!1,modules:u}),x=(0,d().K8)((()=>!(0,o(864994).g)({environment:f,layoutArea:"views_main_tab_modules",moduleType:t.type,pageViewBlockContext:i})),[f,t.type,i]);return(0,o(120997).p)(t,"views_main_tab_modules")?(0,wg().gx)(t)?(0,S.jsx)(o(483832).v,{context:i,disabled:l,propertyId:t.propertyId,store:r,pageModule:t,wrapper:y,stackPropertyLabelAndValue:x},`${t.id}-${r.id}`):(0,wg().i_)(t)?(0,S.jsx)(n.Fragment,{children:(0,S.jsx)(o(781141).h,{context:i,disabled:l,store:r,wrapper:y,layoutModule:t,customization:{neverShowPropertiesElsewhereInLayout:!0,stackPropertyLabelAndValue:x,disableContainerPadding:!0,disableLastRowBottomPadding:x},showDefaultTitle:!0})},`${t.id}-${r.id}`):"editor"===t.type?(0,S.jsx)(Tg().p,{context:i,disabled:l,handlePlaceholderWrapClick:e=>xg().YB(e,r,f),pageBlockStore:r,pathToBlockId:t.pathToBlockId,templatePickerMenuListStore:p,pageViewBlockAccessor:()=>(null==m?void 0:m.current)??null,editorWrapper:i===kg().Rr.DraftPostInInlineComposer?void 0:y,ref:h}):"relationsGroup"===t.type?(0,S.jsx)(o(996262).z,{pageStore:r,wrapper:y,disabled:l,context:i,showDefaultTitle:v}):"deleted_property"===t.type?null:"discussions"===t.type?(0,S.jsx)(o(257502).d,{store:r,wrapper:y,showDefaultTitle:v,discussionLocation:"page_discussion",pageDiscussionsRenderState:g}):void(0,b().HB)(t):null}var Ag=()=>o(817942);const Pg=n.memo((function(e){const{store:t,canEdit:r,templatePickerMenuListStore:i,collectionStore:l,collectionViewStore:a,isFullScreen:c,editorContentContainerRef:u}=e,p=(0,s().v3)(),m=(0,n.useRef)(null),g=(0,d().K8)((()=>t.isNonEditableState()),[t]),h=(0,Xt().g)(),f=(0,Z().ET)(),v=(0,o(933951).s)({pageStore:t,collectionStore:l,pageViewBlockStore:void 0}),{layoutTabModules:y,viewsMainTabId:x}=(0,d().K8)((()=>{const e=null==v?void 0:v.views_main_tab_modules;if(!e)return{layoutTabModules:void 0,viewsMainTabId:void 0};const t=null==a?void 0:a.getFormat().page_layout_pointer;if(!t)return{layoutTabModules:void 0,viewsMainTabId:void 0};return{layoutTabModules:e[t.views_main_tab_id],viewsMainTabId:t.views_main_tab_id}}),[a,v]),C=(0,td().n$)(),b=(0,d().K8)((()=>(0,Te().cq)(t)?kg().Rr.PeekView:f.isFullScreenStore.state?kg().Rr.CollectionPageViewFullScreen:kg().Rr.CollectionPageView),[f,t]),w=(0,je().VE)(t),k=(0,d().K8)((()=>{const e=o(129522).K.findBlockFromStore(t);if(e)return"collectionContextStore"in e?e.collectionContextStore:void 0}),[t]),T=(0,d().K8)((()=>(0,o(87181).NS)(w,t,b,p)),[w,t,b,p]),I=!r||g||h,R=h&&x?(0,S.jsx)("div",{style:{paddingTop:24,paddingRight:4},children:(0,S.jsx)(bg,{viewsMainTabId:x,pageLayoutType:T})}):y&&l?(0,S.jsx)(Ag().Mx,{ref:m,type:T,style:{justifyContent:"center",paddingTop:24,paddingBottom:c?C:void 0},children:(0,S.jsx)(Rg,{context:b,modules:y,store:t,disabled:I,collectionStore:l,templatePickerMenuListStore:i,pageLayoutRef:m,collectionContextStore:k,editorContentContainerRef:u})}):(0,S.jsx)(Ag().Mx,{ref:m,type:T,style:{justifyContent:"center",paddingTop:24,paddingBottom:c?C:void 0},children:(0,S.jsx)(Tg().p,{context:b,disabled:I,handlePlaceholderWrapClick:e=>xg().YB(e,t,p),pageBlockStore:t,templatePickerMenuListStore:i,pageViewBlockAccessor:()=>m.current,ref:u})});return!h||R||x?R:(0,S.jsx)("div",{inert:"true",style:{userSelect:"none"},children:R})}));var Mg=()=>o(938090);function Bg(e){let{store:t,collectionStore:r,collectionViewStore:i,isDisabled:l,isFullScreen:a,isInPeekRenderer:c,isPreviewing:p,isRootChild:m,paddingLeft:g,paddingRight:h,paddingBottom:f,headerSizeObserver:v,viewType:y,timelineViewRef:x,showHoverActionsStore:C,handleAddItemClick:b,isPlaceholderExternalCollection:w,isEmptyMyTasks:k,isInFrameWhenSidePeekOpen:T,query:I,schema:R,format:j,isCustomDbEmptyState:A,maxHeight:P,placementStore:M,templatePickerMenuListStore:B,editorContentContainerRef:_}=e;const V=(0,Z().ET)(),[F,L,O]=(0,d().K8)((()=>[Boolean(V.hasSingleCollection()),"collectionSystemView"===V.contextType,V.isInHomeWidgetStore.state]),[V]),E=(0,d().K8)((()=>"chat"===y||"custom"===y),[y]),D=!(0,je().bx)(t,L||l);(0,n.useEffect)((()=>{"rendered"!==Le().default.state.renderPhase&&Le().default.setState({...Le().default.state,renderPhase:"rendered"})}),[]);const z=function(e){let{isFullScreen:t,viewType:o,isInFrameWhenSidePeekOpen:n,isInHomeWidget:r,isInPeekRenderer:i,isPreviewing:l,isRootChild:a,store:c}=e;const u=(0,s().v3)();return(0,d().K8)((()=>{const{device:e}=u,s=e.isPhone,d=("gallery"===o||("calendar"===o||"list"===o)&&t)&&n,p=(0,Ve().zo)(u,i),m=Ue().default.state;return r||l?void 0:t||a?s?`calc(100% - ${2*(0,Se().F8)(u)}px - ${p}px)`:i?`calc(100% - ${2*Ue().PeekModePadding.horizontal[m.mode]}px - ${p}px)`:n?(0,Ve().Uh)(u)+(d?(0,Ve().Ql)(u):0):t?`calc(100% - ${2*(0,Se().Ws)(u)}px - ${p}px)`:(0,ke().Ck)(c,void 0,u)?`calc(100% - ${2*(0,Se().F8)(u)}px - ${p}px)`:ke().x6-2*(0,Se().F8)(u)-p:`calc(100% - ${p}px)`}),[u,o,t,n,i,r,l,a,c])}({isFullScreen:a,viewType:y,isInFrameWhenSidePeekOpen:T,isInHomeWidget:O,isInPeekRenderer:c,isPreviewing:p,isRootChild:m,store:t}),K=c?o(77238).A:o(205682).A,[H,G,W]=(0,d().K8)((()=>[null==r?void 0:r.isReady(),null==r?void 0:r.isDefined(),null==r?void 0:r.canRead()]),[r]),N=(0,u().IS)((e=>({container:{display:"flex",alignItems:"flex-start",paddingLeft:g,paddingRight:h,paddingTop:8},shimmer:{backgroundColor:e.largeShimmerColor,height:48,marginBottom:10,width:"100%"}})),[g,h]);if(F&&!E){if(!r)return(0,S.jsx)(Lg,{viewType:y,isFullScreen:a,paddingLeft:g,paddingRight:h,paddingBottom:f});if(!H)return(0,S.jsx)("div",{style:N.container,children:(0,S.jsx)(Er().A,{emphasized:!1,style:N.shimmer})});if(!G)return W?(0,S.jsx)(Lg,{viewType:y,isFullScreen:a,paddingLeft:g,paddingRight:h,paddingBottom:f}):(0,S.jsx)(Mg().P2,{collectionStore:r,paddingLeft:g,paddingRight:h,isFullScreen:a})}return w?(0,S.jsx)(Og,{isFullScreen:a,paddingLeft:g,paddingRight:h,paddingBottom:f}):k&&"calendar"!==y?(0,S.jsx)(yg,{collectionContextStore:V,onAddTaskClick:b,from:O?"home_tile_tasks":"home_tasks"}):A?(0,S.jsx)(Me().Y8,{collectionContextStore:V,onAddItemClick:b,from:O?"home_tile_custom_db":"home_custom_db"}):"table"===y?(0,S.jsx)(Qu,{schema:R,format:j,query:I,store:t,collectionContextStore:V,showHoverActionsStore:C,isFullScreen:a,isInPeekRenderer:c,isPreviewing:p,paddingLeft:g,paddingRight:h,minWidth:z,paddingBottom:f,disabled:D,blockPropertyValueOverlayStore:K,isRootChild:m,placementStore:M},i.id):"board"===y?(0,S.jsx)(_a,{schema:R,format:j,query:I,store:t,collectionContextStore:V,isFullScreen:a,isInPeekRenderer:c,isPreviewing:p,paddingLeft:g,paddingRight:h,paddingBottom:f,disabled:D,blockPropertyValueOverlayStore:K,isRootChild:m},i.id):"page"===y?(0,S.jsx)(_g,{store:t,collectionViewStore:i,disabled:D,templatePickerMenuListStore:B,isFullScreen:a,editorContentContainerRef:_}):"calendar"===y?(0,S.jsx)(Hc,{schema:R,format:j,query:I,store:t,collectionContextStore:V,isFullScreen:a,isInPeekRenderer:c,isPreviewing:p,paddingLeft:g,paddingRight:h,maxHeight:P,minWidth:z,paddingBottom:f,disabled:D,blockPropertyValueOverlayStore:K,isRootChild:m},i.id):"list"===y?(0,S.jsx)(cd,{schema:R,format:j,query:I,store:t,collectionContextStore:V,isFullScreen:a,isInPeekRenderer:c,isPreviewing:p,paddingLeft:g,paddingRight:T&&!O?24:h,minWidth:z,paddingBottom:f,disabled:D,blockPropertyValueOverlayStore:K,isRootChild:m},i.id):"gallery"===y?(0,S.jsx)(gs,{schema:R,format:j,query:I,store:t,collectionContextStore:V,isFullScreen:a,isInPeekRenderer:c,isPreviewing:p,paddingLeft:g,paddingRight:h,minWidth:z,paddingBottom:f,disabled:D,blockPropertyValueOverlayStore:K,isRootChild:m},i.id):"timeline"===y?(0,S.jsx)(og,{schema:R,format:j,query:I,store:t,collectionContextStore:V,isFullScreen:a,isRootChild:m,isInPeekRenderer:c,isPreviewing:p,minWidth:z,paddingBottom:f,disabled:D,blockPropertyValueOverlayStore:K,showHoverActionsStore:C,ref:x,paddingLeft:g,paddingRight:h},i.id):"form_editor"===y?(0,S.jsx)(Vg,{collectionViewStore:i,collectionContextStore:V,headerSizeObserver:v,paddingLeft:g,paddingRight:h},i.id):"chart"===y?(0,S.jsx)(Fg,{collectionViewStore:i,isPreviewing:p,paddingLeft:g,paddingRight:h,headerSizeObserver:v,collectionContextStore:V}):"feed"===y?(0,S.jsx)(o(732430).XQ,{collectionViewStore:i,collectionContextStore:V,paddingLeft:g,paddingRight:h}):"map"===y?(0,S.jsx)(cg,{collectionContextStore:V,paddingLeft:g,paddingRight:h,query:I,format:j,schema:R,store:t,renderGroupResults:e=>(0,S.jsx)(gn,{disabled:!1,canDrag:!1,canDrop:!1,direction:pn.Vertical,collectionContextStore:V,format:j,groupsPointer:[],shouldShowHoverMenu:!1,emptyDroppableSize:0,analyticsName:"map",...e})}):"chat"===y?(0,S.jsx)(Xe().Q1,{collectionViewStore:i,collectionContextStore:V,paddingLeft:g,paddingRight:h}):"custom"===y?(0,S.jsx)(Xe().bl,{store:t,collectionViewStore:i,collectionContextStore:V,paddingLeft:g,paddingRight:h}):null}function _g(e){let{store:t,collectionViewStore:o,disabled:n,templatePickerMenuListStore:r,isFullScreen:i,editorContentContainerRef:l}=e;const s=(0,Z().ET)(),a=(0,d().K8)((()=>{let e,n=o.getFormat().page_pointer;const r=s.viewsModuleContextStore;if(!n&&"viewsMain"===(null==r?void 0:r.getViewModuleType())){const t=r.currentPageStore();t&&(n=t.pointer,e=t)}if(n)return e??=t.id===n.id?t:re().Bv.createChildStore(t,{table:n.table,id:n.id,spaceId:n.spaceId}),e.isPageBlock()||e.isCollectionView()?e:void 0}),[s.viewsModuleContextStore,o,t]),{collectionStore:c}=(0,d().K8)((()=>({collectionStore:s.collectionStore()})),[s]);return a?(0,S.jsx)(Pg,{canEdit:!n,disabled:n,store:a,collectionViewStore:o,templatePickerMenuListStore:r,collectionStore:c,isFullScreen:i,editorContentContainerRef:l}):null}function Vg(e){let{collectionViewStore:t,collectionContextStore:o,headerSizeObserver:n,paddingLeft:r,paddingRight:i}=e;const l=(0,s().Y0)(),a=(0,u().IS)((e=>({disabledBuilderWrapper:{minHeight:void 0,height:void 0,marginTop:120-Ks,marginBottom:120-Ks,padding:0,paddingLeft:r,paddingRight:i},disabledBuilderTitle:{fontSize:14,fontWeight:w().Wy.regular},disabledBuilderIcon:{fill:e.lightIconColor,height:72,margin:"0 auto"}})),[r,i]),c=(0,d().K8)((()=>n.rect.state.width),[n]),p=(0,d().K8)((()=>ze().A.state.online),[]);return l.isMobile?(0,S.jsx)(Gs,{style:a.disabledBuilderWrapper,title:(0,S.jsx)("span",{style:a.disabledBuilderTitle,children:(0,S.jsx)(k().sA,{id:"formsInner.disabledBuilder.title",defaultMessage:"Forms can only be edited on desktop"})}),icon:io(a.disabledBuilderIcon)}):p?(0,S.jsx)(lg,{collectionContextStore:o,headingWidth:c,paddingLeft:r,paddingRight:i},t.id):(0,S.jsx)(Gs,{style:a.disabledBuilderWrapper,title:(0,S.jsx)(k().sA,{id:"formsInner.offlineBuilder.title",defaultMessage:"Please go online to edit your form"}),icon:(0,lo().h)(a.disabledBuilderIcon)})}function Fg(e){let{collectionViewStore:t,isPreviewing:o,paddingLeft:n,paddingRight:r,headerSizeObserver:i,collectionContextStore:l}=e;const s=(0,d().K8)((()=>i.rect.state.width),[i]);return(0,S.jsx)(rg,{collectionContextStore:l,isPreviewing:o,headingWidth:s,paddingLeft:n,paddingRight:r},t.id)}function Lg(e){let{viewType:t,isFullScreen:o,paddingLeft:r,paddingRight:i,paddingBottom:l}=e;const a=(0,s().v3)(),c=(0,Z().ET)(),p=(0,d().O$)(c.permissionScopesStore),m=(0,u().DP)(),g=(0,n.useMemo)((()=>({style:{paddingLeft:r,paddingRight:i,paddingBottom:o?void 0:l},icon:ro({height:48,fill:m.lightIconColor,margin:"0 auto"})})),[o,l,r,i,m.lightIconColor]),h=(0,n.useCallback)((()=>{!function(e,t){var o;const n=e.settingsStore,r=(null===(o=e.collectionViewBlockStore())||void 0===o?void 0:o.getCollectionViewStores())??[],i=e.collectionViewStore(),l=1===r.length&&r[0].id===(null==i?void 0:i.id)&&void 0===r[0].getCollectionStore();I().Ow({collectionContextStore:e,collectionSettingsStore:n}),I().R8({collectionSettingsStore:n,item:l?{type:"createViewSource",existingCollectionStore:void 0,createdCollectionRecordPointerMap:void 0}:{type:"linkToDatabase",existingCollectionStore:void 0}}),(0,T().X)({environment:t,collectionContextStore:e,action:"click_select_data_source"})}(c,a)}),[c,a]);return p.canConfigureBlock?(0,S.jsx)(Gs,{title:t?(0,S.jsx)(k().sA,{defaultMessage:"New {viewType}",id:"database.viewSettings.createView.newViewType",values:{viewType:ft().to[t].toLocaleLowerCase()}}):(0,S.jsx)(k().sA,{defaultMessage:"New view",id:"database.viewSettings.createView.newView"}),buttonText:(0,S.jsx)(k().sA,{defaultMessage:"Link a database",id:"collectionViewBlock.linkDatabase"}),buttonOnClick:h,...g}):(0,S.jsx)(Gs,{title:(0,S.jsx)(k().sA,{defaultMessage:"No data source",id:"collectionViewBlock.noSourcePlaceholder.title"}),description:(0,S.jsx)(k().sA,{defaultMessage:"This block is not connected to any data source.",id:"collectionViewBlock.noSourcePlaceholder.description"}),...g})}function Og(e){let{isFullScreen:t,paddingLeft:o,paddingRight:n,paddingBottom:r}=e;const i=(0,u().DP)(),l=(0,Z().ET)(),[a,c,p]=(0,d().K8)((()=>[l.permissionScopesStore.state,l.settingsStore,l.collectionStore()]),[l]),m=(0,d().K8)((()=>c.state.open),[c]),g=(0,d().K8)((()=>{if(p)return p.getIcon()}),[p]),{isMobileBrowser:h}=(0,s().Y0)(),f=(0,d().K8)((()=>{if(p)return p.getFormat().integration_id}),[p]),v=(0,d().K8)((()=>{if(!p)return!1;const e=p.getFormat().integration_id,t=Pc().A.integrations.state.find((t=>t.id===e));return!(!e||!t)&&(0,sg().jw)(e).length>0}),[p]),y=(0,d().K8)((()=>Pc().A.integrations.state.find((e=>e.id===f))),[f]);if(!y)return null;const x=!(h&&!v);return(0,S.jsx)("div",{style:{paddingLeft:o,paddingRight:n,paddingTop:8,paddingBottom:t?void 0:r,height:250,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,S.jsxs)("div",{style:{paddingRight:m?$t().vE:void 0,display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,S.jsx)(xr().A,{icon:g,size:48,disabled:!0,isEmptyPage:!1}),(0,S.jsx)("div",{style:{fontSize:17,fontWeight:w().Wy.medium,color:i.lightTextColor,textAlign:"center",marginBottom:-2},children:(0,S.jsx)(k().sA,{defaultMessage:"{integrationName}",id:"collectionViewBlock.setExternalSource.title",values:{integrationName:y.name}})}),a.canConfigureBlock&&(0,S.jsx)("div",{style:{margin:"0 auto",width:"max-content",fontSize:14,textAlign:"center",color:i.lightTextColor},children:x&&(0,S.jsx)(k().sA,{defaultMessage:"<button>Link to {integrationName}</button> to continue",id:"collectionViewBlock.setExternalSourceButton.title",values:{integrationName:y.name,button:e=>(0,S.jsx)(Rt().A,{style:{display:"inline",padding:"1px 2px",borderRadius:4,textDecoration:"underline"},onClick:()=>{I().Ho({collectionSettingsStore:c})},children:e})}})})]})})}const Eg=n.memo(Bg);var Dg=()=>o(300089),zg=()=>o(638013),Kg=()=>o(430923),Hg=()=>o(556048),Gg=()=>o(42425);function Wg(e){const{origin:t}=e,o=(0,s().v3)();return(0,S.jsx)(Vc().k,{origin:t,placementToOrigin:"bottom",header:(0,S.jsx)(k().sA,{id:"WikiHomeOnboardingTooltip.header",defaultMessage:"Welcome to your new wiki!"}),content:(0,S.jsx)(k().sA,{defaultMessage:"Viewers will have the same reading experience as before, but editors have new features to keep content up to date",id:"WikiHomeOnboardingTooltip.content"}),onCloseClick:()=>{Ud().A6(o)},enableMouseCapture:!0,shouldDismissUponOutsideClick:!0,pointerPosition:"18%",pointerLength:Yd().gO,pointerOffset:Yd().Nu,style:{width:Yd().Sw}})}function Ng(e){const{origin:t}=e,o=(0,s().v3)();return(0,S.jsx)(Vc().k,{origin:t,placementToOrigin:"right",header:(0,S.jsx)(k().sA,{id:"WikiViewsOnboardingTooltip.header",defaultMessage:"New views"}),content:(0,S.jsx)(k().sA,{defaultMessage:"The <bold>All pages</bold> and <bold>Pages I own</bold> views will give you an overview of pages in your wiki",id:"WikiViewsOnboardingTooltip.content",values:{bold:e=>(0,S.jsx)("span",{style:{fontWeight:w().Wy.semibold},children:e})}}),onCloseClick:()=>{Ud().A6(o)},pointerPosition:"50%",pointerLength:Yd().gO,pointerOffset:Yd().j$,enableMouseCapture:!0,shouldDismissUponOutsideClick:!0,style:{width:Yd().Sw}})}let $g;class Ug{constructor(e){this.style=void 0,this.lastResult=void 0,this.style=e.style}measure(e){var t;if(e===(null===(t=this.lastResult)||void 0===t?void 0:t.text))return this.lastResult.rect;$g||($g=document.createElement("div"),$g.style.position="absolute",$g.style.left="0",$g.style.top="0",$g.style.pointerEvents="none",$g.style.opacity="0",document.body.appendChild($g)),C().uk(this.style,((e,t)=>{$g&&($g.style[t]=e)})),$g.textContent=e;const o=$g.getBoundingClientRect();return this.lastResult={text:e,rect:o},o}}const qg={ConfigureViewsMainModuleAddNewViewButtonWrapper:new(ne().O2)("ConfigureViewsMainModuleAddNewViewButtonWrapper",(async()=>await Promise.all([o.e(23806),o.e(36192),o.e(44711),o.e(53321),o.e(62475),o.e(3151),o.e(98629),o.e(63077),o.e(95794),o.e(46414),o.e(8184),o.e(99353),o.e(52681),o.e(24587),o.e(14518),o.e(17713),o.e(28271),o.e(17254),o.e(4422),o.e(67435),o.e(48315),o.e(847),o.e(5887),o.e(70769),o.e(97965),o.e(83210),o.e(26090),o.e(82472),o.e(10596),o.e(99346),o.e(28721),o.e(6463),o.e(5396),o.e(1440),o.e(34576),o.e(89109),o.e(67064),o.e(3720),o.e(97996),o.e(14267),o.e(10861)]).then(o.bind(o,546418))))},Yg=(0,ne()._h)(qg.ConfigureViewsMainModuleAddNewViewButtonWrapper,(e=>e.ConfigureViewsMainModuleAddNewViewButtonWrapper));var Xg=()=>o(448801);function Qg(e){const{collectionViewBlockStore:t,newViewIds:o,transaction:n}=e,r=t.getCollectionViewStores(),{beforeOps:i}=(0,Xg().i)(r.map((e=>e.id)).slice(0,o.length),o);C().jJ(i,((e,r)=>{const i=re().pS.createChildStore(t,{table:x().Gy,id:r,spaceId:t.getSpaceId()});if(e)Ro().nc({parentStore:t.getCollectionViewsStore(),insertStore:i,beforeStore:re().pS.createChildStore(t,{table:x().Gy,id:e,spaceId:t.getSpaceId()}),transaction:n});else{const e=C().HV(o.filter((e=>e!==r)));Ro().WH({parentStore:t.getCollectionViewsStore(),insertStore:i,afterStore:e?re().pS.createChildStore(t,{table:x().Gy,id:e,spaceId:t.getSpaceId()}):void 0,transaction:n})}}))}var Zg=()=>o(745266),Jg=()=>o(274652),eS=()=>o(180762),tS=()=>o(612740),oS=()=>o(921855),nS=()=>o(31902),rS=()=>o(955363),iS=()=>o(859384),lS=()=>o(764781),sS=()=>o(167170),aS=()=>o(742852),cS=()=>o(735790),dS=()=>o(313892),uS=()=>o(447934),pS=()=>o(400851),mS=()=>o(239529),gS=()=>o(101662);function SS(e){let{collectionViewStore:t,collectionContextStore:o,onClose:r}=e;const i=(0,s().v3)(),l=(0,s().Y0)(),a=(0,k().tz)(),c=(0,ue().Zp)(),u=(0,d().K8)((()=>function(e){var t;let{collectionViewStore:o,collectionContextStore:n,onClose:r,environment:i,intl:l,previewContext:s}=e;const a=n.permissionScopesStore.state,c=n.collectionViewStore(),d=n.collectionViewBlockStore();if(!c||!d)return[];const u=(0,Be().Nh)(d.id),p=(0,Se().sj)(d.id),m=c.id===o.id,g=o.getAppConfigUri(),h=!g||(0,dS().$h)(g),f=n.collectionStore(),v=Boolean((null==f||null===(t=f.getParentBlockStore())||void 0===t?void 0:t.id)===d.id),y=void 0!==f||"page"===o.getType(),x=v&&n.isFullScreenStore.state,C=o.getType(),b=n.viewsModuleContextStore,w=void 0!==b.state,R=a.canConfigureBlock&&y&&!w,j=!p&&"form_editor"!==C&&"page"!==C&&y&&a.canConfigureBlock,A=d.getCollectionViewIds().length>1,P=n.isEditableHomeCollectionStore.state,M=!p&&(A||P)&&"page"!==C&&a.canConfigureBlock,_=f&&!x&&!w&&!(null!=s&&s.disablePageLinks),V=!w&&y&&!(null!=s&&s.disablePageLinks),F=b.currentPageStore(),L=null==F?void 0:F.getAssociatedCollectionStore(),O=F&&!b.isInLayoutBuilder()&&(0,pS().Y)({environment:i,blockStore:F,from:"viewsModule"}),E=n.isFullScreenStore.state,D=Boolean(d.getCollectionPointerIfSingleSource()),z=!u&&a.canConfigureBlock&&(!E||!D)&&!(null!=s&&s.hideViewBlockSource)&&!("page"===C&&void 0===o.getFormat().page_pointer),K=[];K.push([]),O&&F&&L&&K[0].push({key:"configure_layout",render:e=>(0,S.jsx)(Ii().A,{...e,title:(0,S.jsx)(k().sA,{defaultMessage:"Customize layout",id:"pageProperties.editProperty.customizeLayout.label"}),icon:(0,S.jsx)(pr().I,{icon:sS()._})}),action:()=>{L&&F&&(0,uS().nh)({environment:i,blockStore:F,collectionStore:L,from:"collection_view_action_menu",initialSelectedModuleType:"viewsMain"})}});if(R){if(K[0].push({key:"rename",render:e=>(0,S.jsx)(At().A,{placement:Fe().W.Left,disableTooltip:h,render:t=>(0,S.jsx)(Ii().A,{...e,disabled:!h,disabledFeedback:!0,title:(0,S.jsx)(k().sA,{defaultMessage:"Rename",id:"database.viewSettings.viewActionMenu.rename"}),icon:(0,S.jsx)(pr().I,{icon:iS().M}),...t}),renderTooltip:()=>(0,S.jsx)(k().sA,{id:"database.viewSettings.viewActionMenu.cannotRename",defaultMessage:"This view can’t be renamed."})}),action:()=>{(0,T().X)({environment:i,collectionContextStore:n,action:"view_action_menu_rename"}),null==r||r(!0),m||(0,eS().t)({environment:i,collectionContextStore:n,collectionViewId:o.id,isFullScreen:E,isRootChild:n.isRootChildStore.state,isInPeekRenderer:n.isInPeekRendererStore.state}),I().Ow({collectionContextStore:n,collectionSettingsStore:n.settingsStore,selectViewNameInitial:!0})}}),"page"===C)return K;K[0].push({key:"edit",render:e=>(0,S.jsx)(Ii().A,{...e,title:(0,S.jsx)(k().sA,{defaultMessage:"Edit view",id:"database.viewSettings.viewActionMenu.editView"}),icon:(0,S.jsx)(pr().I,{icon:cS().M})}),action:()=>{(0,T().X)({environment:i,collectionContextStore:n,action:"view_action_menu_edit"}),null==r||r(!0),m||(0,eS().t)({environment:i,collectionContextStore:n,collectionViewId:o.id,isFullScreen:n.isFullScreenStore.state,isRootChild:n.isRootChildStore.state,isInPeekRenderer:n.isInPeekRendererStore.state}),I().Ow({collectionContextStore:n,collectionSettingsStore:n.settingsStore})}})}K.push([]),V&&K[1].push({key:"copyLink",render:e=>(0,S.jsx)(Ii().A,{...e,title:(0,S.jsx)(k().sA,{defaultMessage:"Copy link to view",id:"database.viewSettings.viewActionMenu.copyLink"}),icon:(0,S.jsx)(pr().I,{icon:aS().w})}),action:async()=>{(0,T().X)({environment:i,collectionContextStore:n,action:"view_action_menu_copy_link"}),await I().GH({environment:i,collectionContextStore:n,collectionViewStore:o}),null==r||r(!1)}});_&&K[1].push({key:"openSourceDb",render:e=>(0,S.jsx)(At().A,{placement:Fe().W.Right,render:t=>(0,S.jsx)(Ii().A,{title:v?(0,S.jsx)(k().sA,{defaultMessage:"Open as full page",id:"database.viewSettings.viewActionMenu.openAsFullPage"}):(0,S.jsx)(k().sA,{defaultMessage:"Open source database",id:"database.viewSettings.viewActionMenu.openSourceDb"}),icon:(0,S.jsx)(pr().I,{icon:rS().N}),...(0,Ci().A)(e,t)}),renderTooltip:()=>(0,S.jsx)(hS,{collectionStore:f})}),action:e=>{(0,mS().q)({environment:i,collectionContextStore:n,event:e.event})}});if(z){const e=n.normalizedFormatStore.state.hide_linked_collection_name;K[1].push({key:"showDatabaseTitle",render:t=>(0,S.jsx)(Ii().A,{...t,title:e?(0,S.jsx)(k().sA,{defaultMessage:"Show database title",id:"database.viewSettings.viewActionMenu.showDatabaseTitle"}):(0,S.jsx)(k().sA,{defaultMessage:"Hide database title",id:"database.viewSettings.viewActionMenu.hideDatabaseTitle"}),icon:(0,S.jsx)(pr().I,{icon:Zr().h})}),action:()=>{const t=!e;(0,T().X)({environment:i,collectionContextStore:n,action:t?"click_source_hide_title":"click_source_show_title"}),B().createAndCommit({userAction:"CollectionViewActionMenu.getMenuSections",environment:i,canUndo:!0,perform:e=>{Nn().zA({stores:[o],update:{hide_linked_collection_name:t},transaction:e})}}),null==r||r(!1)}})}K.push([]),j&&K[2].push({key:"duplicate",render:e=>(0,S.jsx)(Ii().A,{...e,title:(0,S.jsx)(k().sA,{defaultMessage:"Duplicate",id:"database.viewSettings.viewActionMenu.duplicate"}),icon:(0,S.jsx)(pr().I,{icon:lS().V})}),action:()=>{(0,T().X)({environment:i,collectionContextStore:n,action:"view_action_menu_duplicate"}),I().vr({environment:i,collectionContextStore:n,collectionViewStore:o,collectionSettingsStore:n.settingsStore,intl:l,from:"view_action_menu_duplicate"}),null==r||r(!0)}});M&&K[2].push({key:"delete",render:e=>(0,S.jsx)(Ii().A,{...e,title:(0,S.jsx)(k().sA,{defaultMessage:"Delete",id:"database.viewSettings.viewActionMenu.delete"}),icon:(0,S.jsx)(pr().I,{icon:Jr().I}),isRedOnHover:!0}),action:async()=>{(0,T().X)({environment:i,collectionContextStore:n,action:"view_action_menu_delete"});const e="form_editor"===(null==o?void 0:o.getType())?o.getFormBlockStore():void 0;await I().nl({environment:i,collectionContextStore:n,collectionViewStore:o,collectionSettingsStore:n.settingsStore,additionalBlocksToDelete:e?[e]:void 0,from:"view_action_menu"})&&(null==r||r(!1))}});return K}({collectionViewStore:t,collectionContextStore:o,onClose:r,environment:i,intl:a,previewContext:c})),[o,t,i,a,r,c]),p=u.flatMap((e=>e)).length>0;return{renderMenu:(0,n.useCallback)((()=>{if(!p)return null;const e=l.isMobile?{menuType:li().gu.Modal,title:(0,S.jsx)(k().sA,{defaultMessage:"View options",id:"database.viewSettings.viewActionMenu.title"})}:{menuType:li().gu.Popup,width:220};return(0,S.jsx)(ai().A,{...e,children:(0,S.jsx)(ci().Ay,{type:ci().Oh.Vertical,initialFocus:void 0,sections:C().oE(u.map(((e,t)=>{if(e.length>0)return{key:t,render:e=>(0,S.jsx)(ui().A,{...e,topBorder:0!==t}),items:e}})))})})}),[p,l.isMobile,u]),hasMenuItems:p}}function hS(e){const{collectionStore:t}=e,o=(0,k().tz)(),n=(0,d().K8)((()=>{var e;const n=t.getNameStore();return(0,oS().r4)(n.getValue(),n)||(null===(e=t.getModel())||void 0===e?void 0:e.getEmptyTitlePlaceholder({intl:o}))||o.formatMessage(gS().k.titlePlaceholder)}),[t,o]);return(0,S.jsx)(k().sA,{id:"database.viewSettings.viewActionMenu.openDbTooltip",defaultMessage:"Opens “{dbName}”",values:{dbName:n}})}function fS(e){const{collectionContextStore:t,collectionViewStore:o,menuListItemProps:r,onClose:i}=e,{device:l}=(0,s().v3)(),a=(0,u().IS)((e=>({tooltipMessage:{color:e.text.contrastSecondary}})),[]),c=(0,k().tz)(),p=(0,d().uB)(void 0,Oe().A),[m,h,f,v,y,x]=(0,d().K8)((()=>[o.getName(),o.getType(),o.getFormat().collection_view_icon,o.getFormat().description,o.getCollectionStore(),t.permissionScopesStore.state.canConfigureBlock]),[o,t]),C=(0,d().K8)((()=>null!=y&&y.isDefined()?(0,oS().r4)(y.getName(),y)||y.getModel().getEmptyTitlePlaceholder({intl:c}):(0,tS().L)(c)),[y,c]),b=(0,n.useCallback)((e=>{p.setState({open:!1}),e&&i()}),[p,i]),{renderMenu:w}=SS({collectionViewStore:o,collectionContextStore:t,onClose:b});return void 0===h?null:(0,S.jsx)(At().A,{renderTooltip:e=>(0,S.jsxs)("div",{...e,style:iu().Q$,children:[(0,S.jsx)("div",{children:(0,L().OO)({collectionViewName:m,collectionViewType:h})}),void 0!==y&&(0,S.jsx)("div",{style:a.tooltipMessage,children:v||(0,S.jsx)(k().sA,{defaultMessage:"{viewType, select, Table {Table view of {collection}} Board {Board view of {collection}} Timeline {Timeline view of {collection}} Calendar {Calendar view of {collection}} List {List view of {collection}} Gallery {Gallery view of {collection}} Form {Form} Chart {Chart view of {collection}} other {collection}}",id:"collectionTabBar.viewTab.tooltip",values:{viewType:ft().to[h],collection:C}})})]}),placement:Fe().W.Left,render:e=>(0,S.jsx)(Ii().A,{title:(0,S.jsx)(nS().A,{collectionViewType:h,collectionViewName:m}),icon:(0,S.jsx)(Zg().h,{color:"regular",viewIcon:f,viewType:h}),showDragHandle:!l.isMobile&&x,right:x?(0,S.jsx)(Ri().Ay,{popupType:l.isMobile?Ri().z7.BottomSheet:Ri().z7.Popup,renderOrigin:e=>(0,S.jsx)(jt().A,{icon:cr().Y,iconStyle:{width:g().Ev.sm,height:g().Ev.sm},ariaLabel:c.formatMessage({id:"collectionViewSelectItem.viewSettings.ariaLabel",defaultMessage:"Database view settings"}),...e}),render:w,buttonPopupStore:p}):null,rightStyle:{marginRight:8},...(0,Ci().A)(e,r)})})}function vS(e){const{collectionContextStore:t,onAddViewClick:r,onClose:i,onViewClick:l}=e,a=(0,k().tz)(),c=(0,s().Y0)(),[u,p]=n.useState(0),[m,g]=n.useState(""),[h,f]=(0,o(857437).$)(),v=(0,d().uB)(void 0,o(970585).A),y=(0,d().K8)((()=>{var e;return!(c.isMobile||null!==(e=t.collectionViewBlockStore())&&void 0!==e&&e.isCollectionViewPageWithContent())}),[t,c.isMobile]),x=(0,d().K8)((()=>{var e;return((null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewStores())||[]).filter((e=>(0,L().As)(e,m)))}),[t,m]),C=(0,d().K8)((()=>t.permissionScopesStore.state.canConfigureBlock),[t]),b=(0,d().K8)((()=>(0,L().NB)(t,c)),[t,c]),w=n.useCallback((e=>{g(e.target.value),v.setState({...v.state,focus:{section:0,indexLocal:0,indexGlobal:0,footerFocused:!1}})}),[v]);n.useEffect((()=>{var e,o;const n=null===(e=t.collectionViewStore())||void 0===e?void 0:e.id,r=((null===(o=t.collectionViewBlockStore())||void 0===o?void 0:o.getCollectionViewStores())||[]).findIndex((e=>e.id===n));r>=0&&p(r)}),[t]);const T=!c.isMobile&&C;return(0,S.jsx)(it().A,{capture:!0,allowEsc:!0,render:e=>{let n;return n=c.isPhone?{menuType:li().gu.Modal,title:(0,S.jsx)(xS,{collectionContextStore:t}),right:(0,S.jsx)(di().DoneMenuText,{}),onClickRight:i}:{menuType:li().gu.Popup,minWidth:290,maxWidth:320,maxHeight:"50vh"},(0,S.jsxs)(ai().A,{...n,...e,header:y?(0,S.jsx)(la().Ay,{value:m,focus:!0,style:{marginTop:8,marginBottom:4},textWrapperStyle:{marginLeft:8,marginRight:8},onChange:w,placeholder:a.formatMessage({defaultMessage:"Search for a view...",id:"collectionViewSelect.viewSearch.label"}),...h}):null,footer:T&&(0,S.jsxs)(ui().A,{topBorder:!0,children:[(0,S.jsx)(kS,{collectionContextStore:t,onClose:i,onAddViewClick:r}),b?null:(0,S.jsx)(o(94778).A,{collectionContextStore:t,onClose:i,focused:!1,isCompact:!0})]}),children:[(0,S.jsx)(CS,{collectionContextStore:t,filteredViewStores:x,isDraggable:T&&""===m,menuListStore:v,initialMenuListFocus:u,onClose:i,onViewClick:l,comboboxProps:f}),m&&0===x.length&&(0,S.jsx)(o(736767).A,{caption:(0,S.jsx)(k().sA,{defaultMessage:"No results",id:"database.collectionViewSelect.noResultsTitle"})}),c.isMobile?(0,S.jsx)(kS,{collectionContextStore:t,onClose:i,onAddViewClick:r}):null]})}})}const yS=n.memo(vS);function xS(e){let{collectionContextStore:t}=e;const o=(0,d().K8)((()=>{var e;return(null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewStores())||[]}),[t]);return(0,S.jsx)(k().sA,{defaultMessage:"{numberOfViews, plural, one {{numberOfViews} view} other {{numberOfViews} views}}",id:"database.mobileSelectViewMenu.title",values:{numberOfViews:o.length}})}function CS(e){const{collectionContextStore:t,onViewClick:o,onClose:r}=e,i=(0,s().v3)(),l=n.useCallback(((e,n)=>{const l=t.collectionViewStore(),s=xe().Vr(e);l&&o({currentCollectionViewStore:l,newCollectionViewStore:n,openInNew:s});const a=t.isFullScreenStore.state,c=t.isRootChildStore.state,d=t.isInPeekRendererStore.state;(0,eS().t)({environment:i,collectionContextStore:t,collectionViewId:n.id,openInNew:s,isFullScreen:a,isRootChild:c,isInPeekRenderer:d}),(0,T().X)({environment:i,collectionContextStore:t,action:"click_view_in_dropdown",new_view_type:n.getType(),new_view_id:n.id}),s||r()}),[t,i,o,r]);if(0===e.filteredViewStores.length)return null;const a={key:"views",render:t=>(0,S.jsx)(bS,{menuListSectionProps:t,collectionContextStore:e.collectionContextStore,filteredViewStores:e.filteredViewStores,isDraggable:e.isDraggable,menuListStore:e.menuListStore}),items:e.filteredViewStores.map((t=>({key:t.id,render:o=>(0,S.jsx)(wS,{collectionContextStore:e.collectionContextStore,onClose:e.onClose,collectionViewStore:t,props:o}),action:e=>{let{event:o}=e;l(o,t)}})))};return(0,S.jsx)(ci().Ay,{type:ci().Oh.Vertical,initialFocus:e.initialMenuListFocus,sections:[a],store:e.menuListStore,comboboxProps:e.comboboxProps})}function bS(e){const t=(0,s().v3)(),o=(0,d().K8)((()=>e.filteredViewStores.map((e=>e.id))),[e.filteredViewStores]),r=n.useCallback(((o,n)=>{const r=e.collectionContextStore.collectionViewBlockStore();r&&(B().createAndCommit({userAction:"CollectionViewSelect2.handleViewsDrop",environment:t,canUndo:!0,perform:e=>{Qg({collectionViewBlockStore:r,newViewIds:o,transaction:e})}}),e.menuListStore.reset())}),[t,e.collectionContextStore,e.menuListStore]);return e.isDraggable?(0,S.jsx)(ui().A,{...e.menuListSectionProps,children:(0,S.jsx)(Es().Ay,{direction:"vertical",keys:o,renderKey:t=>e.menuListSectionProps.children[o.indexOf(t)],onDrop:r})}):(0,S.jsx)(ui().A,{...e.menuListSectionProps})}function wS(e){let{collectionViewStore:t,props:o,collectionContextStore:n,onClose:r}=e;return(0,S.jsx)(fS,{collectionContextStore:n,collectionViewStore:t,onClose:r,menuListItemProps:o})}function kS(e){const t=(0,s().v3)(),o=(0,d().K8)((()=>{var t;if(!e.collectionContextStore.permissionScopesStore.state.canConfigureBlock)return!1;return!(0,Se().sj)((null===(t=e.collectionContextStore)||void 0===t||null===(t=t.collectionViewBlockStore())||void 0===t?void 0:t.id)??"")}),[e.collectionContextStore]),n=(0,d().K8)((()=>"viewsMain"===e.collectionContextStore.viewsModuleContextStore.getViewModuleType()),[e.collectionContextStore]);if(!o)return null;const r=(0,S.jsx)(k().sA,{defaultMessage:"New view",id:"database.collectionViewSelect.newViewButtonTitle"});return n?(0,S.jsx)(Yg,{renderOrigin:e=>(0,S.jsx)(Jg().A,{onClick:()=>{e.onClick()},title:r,focused:!1}),onClose:e.onClose}):(0,S.jsx)(Ri().Ay,{popupType:t.device.isMobile?aa().nl.SlideUp:aa().nl.Popup,alignmentToOrigin:Ri().yP.Center,placementToOrigin:Ri().sx.Right,renderOrigin:e=>(0,S.jsx)(Jg().A,{...e,title:r,focused:!1}),render:t=>(0,S.jsx)(Kg().y7,{collectionContextStore:e.collectionContextStore,onClose:()=>{e.onClose(),t.close()},showNewViewItems:!1})})}var TS=()=>o(374562),IS=()=>o(522827),RS=()=>o(115512);const jS=n.memo((function(e){var t,r;let{collectionViewStore:i,collectionContextStore:l,hideUnderline:a,onViewClick:c,disabled:p,variant:m="default"}=e;const g=(0,s().v3)(),h=(0,s().Y0)(),f=(0,u().DP)(),[v,y]=(0,n.useState)(!1),x=(0,o(937199).v$)(),C=(0,ue().Zp)(),[b,k]=(0,d().K8)((()=>{var e;return[l.viewsModuleContextStore.isInLayoutBuilder(),null===(e=l.viewsModuleContextStore.getViewsModule())||void 0===e?void 0:e.id]}),[l.viewsModuleContextStore]),R=(0,n.useCallback)((()=>{y(!1)}),[]),{renderMenu:j,hasMenuItems:A}=SS({collectionViewStore:i,collectionContextStore:l,onClose:R}),P=(0,n.useCallback)((()=>{!A||null!=C&&C.disableAllPointerEvents||y(!0)}),[C,A]),M=(0,n.useCallback)((e=>{e.preventDefault(),(0,Ce().SQ)({event:e,context:Ce().y$.EditorContextMenu,callback:P})}),[P]),B=(0,n.useCallback)((e=>{const t=l.collectionViewStore();if(!t)return;const o=l.viewsModuleContextStore.state?void 0:xe().Vr(e);if(c({currentCollectionViewStore:t,newCollectionViewStore:i,openInNew:o}),t.id===i.id?P():(0,eS().t)({environment:g,collectionContextStore:l,collectionViewId:i.id,openInNew:o,isFullScreen:l.isFullScreenStore.state,isRootChild:l.isRootChildStore.state,isInPeekRenderer:l.isInPeekRendererStore.state}),b&&x){var n;const e=null===(n=l.viewsModuleContextStore.getViewsModule())||void 0===n?void 0:n.id;e&&(x.setModuleSelection({type:"existing_module",moduleId:e,isDragging:!1}),I().Ow({collectionContextStore:l,collectionSettingsStore:l.settingsStore,closeOnEscape:!1}))}(0,T().X)({environment:g,collectionContextStore:l,action:"click_view_tab",new_view_type:i.getType(),new_view_id:i.id})}),[l,c,P,i,b,x,g]),{currentViewStore:_,collectionViewBlockStore:V}=(0,d().K8)((()=>({currentViewStore:l.collectionViewStore(),collectionViewBlockStore:l.collectionViewBlockStore()})),[l]),{isDefinedCollectionViewStore:F,viewIcon:O,viewType:E}=(0,d().K8)((()=>({isDefinedCollectionViewStore:null==i?void 0:i.isDefined(),viewIcon:null==i?void 0:i.getFormat().collection_view_icon,viewType:null==i?void 0:i.getType()})),[i]),D=(null===(t=(0,L().Oz)(l))||void 0===t?void 0:t.background)??"none",z=(0,n.useRef)(null),K=(0,d().K8)((()=>{var e,t;return!((null==V?void 0:V.getSpaceId())!==(null===(e=Le().default.state.currentSpaceStore)||void 0===e?void 0:e.id))&&i.getFormat().app_config_uri===at().Lu&&"sprint_board"===(null===(t=Le().default.state.mainEditorCurrentBlockStore)||void 0===t?void 0:t.getFormat().special_page_for_pm_launch)}),[i,V]),H=(0,d().K8)((()=>{var e;return!0===(null===(e=Le().default.state.mainEditorCurrentBlockStore)||void 0===e?void 0:e.getFormat().is_asana_imported_project)&&l.isInPeekRendererStore.state}),[l]),G=(0,d().K8)((()=>{var e;const t=null===(e=l.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewStores();return t&&t.length>1}),[l]),W=(null==_?void 0:_.id)===i.id,N="pills"!==m&&!a&&W&&G,$=W&&b&&"existing_module"===(null==x||null===(r=x.currentModuleSelection)||void 0===r?void 0:r.type)&&x.currentModuleSelection.moduleId===k;return F&&_&&V?(0,S.jsx)(aa().Ay,{popupType:h.isMobile?aa().nl.BottomSheet:aa().nl.Popup,alignmentToOrigin:Fe().C.Start,open:v,render:j,onDismiss:R,trapFocus:!0,origin:(0,S.jsxs)("div",{className:he().f_$,style:{display:"flex",alignItems:"center",background:b?void 0:D,height:"100%",...N&&{borderBottom:`2px solid ${f.regularTextColor}`,paddingTop:2},..."pills"===m?{marginRight:1}:void 0},onContextMenu:M,children:[K&&(0,S.jsx)(qn().U7,{origin:z}),H&&(0,S.jsx)(ru().gO,{origin:z,store:l}),(0,S.jsx)(AS,{collectionViewStore:i,render:e=>(0,S.jsxs)(rt().p,{"aria-selected":W,role:"tab",ref:z,size:"pills"===m?"lg":"md",style:{display:"flex",alignItems:"center",fontSize:14,fontWeight:w().Wy.medium,color:W?f.regularTextColor:f.mediumTextColor,maxWidth:BS,..."pills"===m?{borderRadius:20,padding:"6px 12px 6px 10px"}:{},...b?$?(0,RS().nl)({width:3,color:f.stroke.uiBluePrimary}):(0,RS().nl)({width:1.5,color:f.stroke.uiBlueSecondary}):void 0,...b?{marginRight:4,transition:"box-shadow 0.3s"}:void 0},hovered:b?W&&!$:"pills"===m?v||W:v,hoveredStyle:b?{...(0,RS().nl)({width:3,color:f.stroke.uiBlueSecondary}),background:"none"}:void 0,pressedStyle:b?{...(0,RS().nl)({width:3,color:f.stroke.uiBluePrimary}),background:"none"}:void 0,onClick:B,disabled:p,...e,children:[(0,S.jsx)(Zg().h,{color:W?"regular":"light",viewIcon:O,viewType:E,style:{marginRight:6}}),(0,S.jsx)("span",{style:{...w().RC,marginTop:1},children:(0,S.jsx)(MS,{collectionContextStore:l,collectionViewStore:i})})]},i.id)})]})}):null}));function AS(e){const t=(0,u().DP)(),{collectionViewStore:o,render:n}=e,r=(0,Z().ET)(),i=(0,d().K8)((()=>{var e;const t=null===(e=o.getParentBlockStore())||void 0===e?void 0:e.id;return!!t&&((0,Se().sj)(t)&&r.isInHomeWidgetStore.state)}),[r.isInHomeWidgetStore,o]),[l,s]=(0,d().K8)((()=>{const e=o.getName(),t=o.getType(),n=(0,L().OO)({collectionViewName:e,collectionViewType:t});if(!t)return[n,void 0];const r=o.getFormat().description;if(r)return[n,r];const i=o.getCollectionStore(),l=null==i?void 0:i.getName();if(i&&l){var s,a;if((null==i||null===(s=i.getParentBlockStore())||void 0===s?void 0:s.id)===(null===(a=o.getParentBlockStore())||void 0===a?void 0:a.id))return[n,(0,S.jsx)(k().sA,{defaultMessage:"{viewType, select, Table {Table view of {collection}} Board {Board view of {collection}} Timeline {Timeline view of {collection}} Calendar {Calendar view of {collection}} List {List view of {collection}} Gallery {Gallery view of {collection}} Form {Form} Chart {Chart view of {collection}} other {collection}}",id:"collectionTabBar.viewTab.tooltip",values:{viewType:ft().to[t],collection:(0,oS().r4)(l,i)}},"viewTab.tooltip.2")]}return[n,(0,S.jsx)(k().sA,{id:"collectionTabBar.viewTab.tooltip.default",defaultMessage:"{viewType} view",values:{viewType:ft().to[t]}},"viewTab.tooltip.2")]}),[o]);return l?(0,S.jsx)(At().A,{placement:i?Fe().W.Top:Fe().W.Bottom,originGap:i?0:void 0,alignment:Fe().C.Start,delayThreshold:500,style:i?{marginBottom:-5,marginLeft:8}:{},render:e=>i?(0,S.jsx)("div",{style:{marginLeft:-8},children:n(e)}):n(e),renderTooltip:e=>i?(0,S.jsx)(k().sA,{id:"collectionTabBar.myTasksWidget.tooltip",defaultMessage:"See all your tasks in one place"}):(0,S.jsxs)("div",{...e,style:iu().Q$,children:[l,(0,S.jsx)("div",{style:{color:t.text.contrastSecondary},children:s})]})}):null}function PS(e,t,o){var n;const r=e.collectionStore();if(!r)return t.getName();const i=r.getPropertyMapping(),l=t.getName(),s=null==i?void 0:i[at().yx.TaskToSprintRelation];if(!o||!s||l!==yt().A.formatMessage(TS().DZ.tasksCurrentSprintV2ViewName))return t.getName();const a=o[s];if(!a||"relation"!==a.type||!a.collection_pointer)return t.getName();const c=null===(n=(0,IS().ax)(e,"current",a.collection_pointer,r))||void 0===n?void 0:n.getBlockTitleStore().getValue();return c?`${yt().A.formatMessage(TS().DZ.tasksCurrentSprintV2ViewNamePrefix)}: ${c[0]}`:t.getName()}function MS(e){const{collectionViewStore:t,collectionContextStore:o}=e,[n,r]=(0,d().K8)((()=>{const e=o.settingsStore.state;return[e.open,C().HV(e.stack)]}),[o.settingsStore]),i=(0,d().K8)((()=>o.viewsModuleContextStore.state),[o.viewsModuleContextStore]),l=(0,d().K8)((()=>o.collectionViewStore()),[o]),s=(0,d().K8)((()=>t.getCollectionStore()),[t]),a=(0,d().K8)((()=>{if(t.isDefined()){return(null==t?void 0:t.getFormatStore().getKeyStore("app_config_uri").getValue())===at().Lu&&null!=s&&s.isDefined()?{name:PS(o,t,s.getSchema()),type:t.getType()}:{name:t.getName(),type:t.getType()}}}),[t,s,o]),c=n&&r&&("duplicateExistingView"===r.type||"createView"===r.type);return!a||(null==l?void 0:l.id)===t.id&&c&&!i?(0,S.jsx)(k().sA,{defaultMessage:"New view",id:"collectionTabBar.newViewPlaceholder.title"}):(0,S.jsx)(nS().A,{collectionViewName:a.name,collectionViewType:a.type})}const BS=220,_S={default:{MOBILE_FORM_VIEW_TAB_MAX_WIDTH:120,MORE_BUTTON_MAX_WIDTH:100,ADD_VIEW_BUTTON_MAX_WIDTH:105,VIEW_TAB_PADDING:40},pills:{MOBILE_FORM_VIEW_TAB_MAX_WIDTH:120,MORE_BUTTON_MAX_WIDTH:100,ADD_VIEW_BUTTON_MAX_WIDTH:105,VIEW_TAB_PADDING:52}},VS=n.memo((function(e){const{collectionContextStore:t,showHoverActionsStore:r,isPlaceholderExternalCollection:i,showOnlyCurrentView:l,onViewClick:a,disabled:c,variant:p="default"}=e,m=(0,s().v3)(),g=(0,s().WS)(),h=(0,u().DP)(),f=(0,Ae().X)("db_ux_simplification_next"),v=(0,n.useRef)(null),y=(0,n.useRef)(null),x=(0,n.useRef)(new(qe().E)({throttleMs:50})),C=(0,n.useRef)(new Map),b=(0,d().O$)(r),I=(0,ue().Zp)(),R=(0,n.useRef)(null),{MOBILE_FORM_VIEW_TAB_MAX_WIDTH:j,MORE_BUTTON_MAX_WIDTH:A,ADD_VIEW_BUTTON_MAX_WIDTH:P,VIEW_TAB_PADDING:M}=(0,n.useMemo)((()=>_S[p]),[p]),{permissionScopes:_,isFullScreen:V,isInHomeWidget:F,isInCollectionViewPageWithContent:O,isEditingViewsModuleInPageBuilder:E}=(0,d().K8)((()=>{var e;return{permissionScopes:t.permissionScopesStore.state,isFullScreen:t.isFullScreenStore.state,isInHomeWidget:t.isInHomeWidgetStore.state,isInCollectionViewPageWithContent:null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.isCollectionViewPageWithContent(),isEditingViewsModuleInPageBuilder:t.viewsModuleContextStore.isInLayoutBuilder()}}),[t]),D=(0,d().K8)((()=>{var e;return l?[]:(null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewStores())??[]}),[t,l]),z=(0,d().K8)((()=>Boolean(Ge().Ay.state.showOnboardingTour&&"database-views-and-filters-tooltip"===(0,o(739135).gt)(Le().default.state.currentUserSettingsStore,"jira-sync-onboarding"))),[]);(0,n.useEffect)((()=>{const e=x.current;return()=>{e.destroy()}}),[x]);const K=(0,n.useCallback)((e=>{let t=C.current.get(e.id);t||(t=new Ug({style:{fontSize:`${w().J.UIRegular.desktop}px`,fontWeight:w().Wy.medium}}),C.current.set(e.id,t));const o=(0,L().OO)({collectionViewName:e.getName(),collectionViewType:e.getType()}),n=t.measure(o);return Math.min(M+n.width,BS)}),[M]),H=(0,d().K8)((()=>function(e,t,o,n){var r;if("collectionSettings"===e.contextType)return!1;if(n||t||null!=o&&o.disableAllPointerEvents)return!1;if(!e.permissionScopesStore.state.canConfigureBlock)return!1;const i=null===(r=e.collectionViewBlockStore())||void 0===r?void 0:r.id;if(i&&(0,Se().sj)(i))return!1;return!0}(t,i,I,l)),[t,i,I,l]),G=(0,d().K8)((()=>{const e=t.collectionViewStore();if(!e)return;if("collectionSettings"===t.contextType)return[];const o=Math.max(A,H?P:0);let n=x.current.rect.state.width-o;const r=[],i=K(e);if(!(i<n))return r;r.push(e),n-=i;for(const t of D){if(t.id===e.id)continue;const o=K(t);if(!(o<n))break;r.push(t),n-=o}const l=r.filter((t=>t.id!==e.id)),s=D.findIndex((t=>t.id===e.id));return l.splice(s,0,e),l}),[t,A,H,P,K,D]),W=(0,d().K8)((()=>"collectionSettings"===t.contextType),[t]),N=(0,n.useMemo)((()=>{const e=(null==G?void 0:G.length)||0,t=D.length-e,o=G&&(0===e||1===e&&D.length>1)||g||O||F,n=W?"allTabsVisible":o?"dropdown":t>0?"someTabsNotVisible":"allTabsVisible";return{showMoreViewsButton:"someTabsNotVisible"===n||"dropdown"===n,showAddViewButton:H&&"allTabsVisible"===n,addViewButtonAnimatedIn:V||b||E,viewSelectState:n,moreViewsCount:t}}),[G,D,g,O,F,H,V,b,E,W]),$=(0,n.useCallback)((e=>{e&&x.current.observe(e)}),[x]),U=(0,n.useMemo)((()=>{if(G&&"dropdown"!==N.viewSelectState)return!_.canConfigureBlock||null!=I&&I.disableAllPointerEvents?G.map(((e,o)=>{const r=n.createRef();return 0===o&&z?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("div",{ref:r,style:{boxShadow:zg().p.outlineBlueInputBoxShadow.light,borderRadius:6},children:(0,S.jsx)(jS,{collectionContextStore:t,collectionViewStore:e,onViewClick:a,disabled:c,hideUnderline:l,variant:p},e.id)}),(0,S.jsx)(Hg().dM,{origin:r})]}):(0,S.jsx)(jS,{collectionContextStore:t,collectionViewStore:e,onViewClick:a,disabled:c,hideUnderline:l,variant:p},e.id)})):(0,S.jsx)(Es().Ay,{direction:"horizontal",keys:G.map((e=>e.id)),style:{height:"100%"},disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,renderKey:(e,o)=>{const r=G.find((t=>t.id===e));if(r){const e=n.createRef();return 0===o&&z?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("div",{ref:e,style:{boxShadow:zg().p.outlineBlueInputBoxShadow.light,borderRadius:6},children:(0,S.jsx)(jS,{collectionContextStore:t,collectionViewStore:r,onViewClick:a,disabled:c,hideUnderline:l,variant:p},r.id)}),(0,S.jsx)(Hg().dM,{origin:e})]}):(0,S.jsx)(jS,{collectionContextStore:t,collectionViewStore:r,onViewClick:a,disabled:c,hideUnderline:l,variant:p})}},onDrop:e=>function(e,t,o){const n=o.collectionViewBlockStore();if(!n)return;B().createAndCommit({userAction:"CollectionViewTabBar.handleViewTabsDrop",environment:t,canUndo:!0,perform:t=>{Qg({collectionViewBlockStore:n,newViewIds:e,transaction:t})}})}(e,m,t)})}),[G,N.viewSelectState,_.canConfigureBlock,t,a,c,I,l,m,z,p]),q=(0,n.useCallback)((e=>{const{device:o}=m,n=t.collectionViewStore();if(null!=n&&n.isDefined()){if("dropdown"===N.viewSelectState){var r;const i=n.getType(),l=n.getFormat().collection_view_icon,s=c||F,a="page"===n.getType()&&(null===(r=t.collectionStore())||void 0===r?void 0:r.getFormat().app_config_uri)===at().pW;return(0,S.jsxs)(S.Fragment,{children:[!o.isMobile&&a&&"home"===Ud().WH()&&(0,S.jsx)(Wg,{origin:v}),(0,S.jsx)(AS,{collectionViewStore:n,render:r=>(0,S.jsxs)(rt().p,{ref:v,style:{display:"flex",alignItems:"center",fontSize:s?w().J.UISmall.desktop:w().J.UIRegular.desktop,fontWeight:w().Wy.semibold,color:s?h.mediumTextColor:h.regularTextColor,maxWidth:"form_editor"===i&&o.isMobile?j:BS,paddingRight:s?0:void 0,..."pills"===p?{borderRadius:20}:void 0},hovered:"pills"===p||void 0,size:"pills"===p?"lg":"md",disabled:c,...(0,Ci().A)(e,r),children:[(0,S.jsx)(Zg().h,{color:s?"lightGray":"regular",viewType:i,viewIcon:l,style:{marginRight:s?8:6,marginLeft:s?0:5},size:s?14:void 0}),(0,S.jsx)("span",{style:{...w().RC,marginRight:6,marginTop:1},children:(0,S.jsx)(MS,{collectionContextStore:t,collectionViewStore:n})}),!c&&(0,_l().b)({marginTop:2,width:10,height:10,fill:h.lightIconColor,marginRight:10})]})})]})}return"someTabsNotVisible"===N.viewSelectState?(0,S.jsx)(rt().p,{style:{display:"flex",alignItems:"center",fontSize:w().J.UIRegular.desktop,color:h.mediumTextColor,..."pills"===p?{borderRadius:13,height:26}:{}},size:"pills"===p?"lg":"md",...e,children:(0,S.jsx)("span",{style:{marginTop:1},children:(0,S.jsx)(k().sA,{defaultMessage:"{moreViewsCount} more…",id:"collectionTabBar.showMoreViews.title",values:{moreViewsCount:N.moreViewsCount}})})}):void 0}}),[j,t,c,m,F,N.moreViewsCount,N.viewSelectState,h.lightIconColor,h.mediumTextColor,h.regularTextColor,p]),Y=(0,n.useCallback)((e=>{var n;const{device:r}=m,i=(null===(n=t.collectionStore())||void 0===n?void 0:n.getFormat().app_config_uri)===at().pW;return(0,S.jsxs)(S.Fragment,{children:[!r.isMobile&&"views"===Ud().WH()&&i&&(0,S.jsx)(Ng,{origin:y}),(0,S.jsx)("div",{ref:y,children:(0,S.jsx)(yS,{collectionContextStore:t,onClose:e.close,onViewClick:a,onAddViewClick:e=>function(e,t,n){B().createAndCommit({userAction:e,environment:t,canUndo:!0,perform:e=>{(0,o(423938).Z)({environment:t,collectionContextStore:n,newViewType:"table",transaction:e})}}),(0,o(154017).b)({environment:t,collectionContextStore:n,view_type:"table"})}(e,m,t)})})]})}),[t,m,a]),X=(0,n.useCallback)((e=>{(0,Ce().SQ)({event:e,context:Ce().y$.EditorMouseDown,callback:()=>{e.preventDefault()}})}),[]);return(0,S.jsx)(Qe().lC,{collectionContextStore:t,step:"views",containerRef:R,children:(0,S.jsx)("div",{role:"tablist",style:{display:"flex",alignItems:"center",height:"100%",...f?{marginLeft:-4,marginTop:-3}:{},flexGrow:1,overflow:"hidden",...E?{paddingLeft:2}:{}},ref:$,children:(0,S.jsxs)("div",{ref:R,style:{display:"flex",alignItems:"center",flexShrink:1,height:"100%"},children:[U,N.showMoreViewsButton&&(0,S.jsx)("div",{onMouseDown:X,children:(0,S.jsx)(Ri().Ay,{alignmentToOrigin:Gg().C1.Start,originGap:4,popupType:g?aa().nl.SlideUp:aa().nl.Popup,render:e=>Y(e),renderOrigin:q,onClick:()=>function(e,t){(0,T().X)({environment:e,collectionContextStore:t,action:"click_views_dropdown"})}(m,t)})}),(0,S.jsx)(FS,{renderState:N,collectionContextStore:t,preventRectangularSelection:X,variant:p,theme:h})]})})})}));function FS(e){let{renderState:t,collectionContextStore:o,preventRectangularSelection:n,variant:r,theme:i}=e;const l=(0,k().tz)(),s=(0,d().K8)((()=>"viewsMain"===o.viewsModuleContextStore.getViewModuleType()),[o]);if(!t.showAddViewButton)return null;let a=null;return a=s?(0,S.jsx)(Yg,{renderOrigin:e=>(0,S.jsx)(jt().A,{ariaLabel:l.formatMessage({id:"collectionViewTabBar.addView",defaultMessage:"Add view"}),className:he().Tel,icon:$r().plusSmallIcon,...e,style:{..."pills"===r?{height:28,width:28,borderRadius:"100%"}:void 0,background:i.tint.uiBlue},hoveredStyle:{color:i.text.uiBluePrimary,background:i.tint.uiBlueHover},pressedStyle:{color:i.text.uiBluePrimary,background:i.tint.uiBluePressed},iconStyle:{fill:i.icon.uiBluePrimary,height:16,width:16}})}):(0,S.jsx)(Ri().Ay,{popupType:Ri().z7.Popup,alignmentToOrigin:Gg().C1.Start,originGap:4,render:e=>(0,S.jsx)(Kg().y7,{collectionContextStore:o,onClose:e.close,showNewViewItems:!0}),renderOrigin:e=>(0,S.jsx)(jt().A,{ariaLabel:l.formatMessage({id:"collectionViewTabBar.addView",defaultMessage:"Add view"}),className:he().Tel,icon:$r().plusSmallIcon,...e,style:{..."pills"===r?{height:28,width:28,borderRadius:"100%"}:void 0},iconStyle:{height:16,width:16}})},"suggested-views"),(0,S.jsx)(It().A,{visible:t.addViewButtonAnimatedIn,animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},onMouseDown:n,children:a})}var LS=()=>o(10323),OS=()=>o(867201),ES=()=>o(21140);function DS(e){const{collectionContextStore:t}=e,o=(0,d().K8)((()=>{const e=t.collectionViewStore(),o=null==e?void 0:e.getParentBlockStore();return o&&o.pathIsDead()}),[t]),{parentBlockStore:n,isParentCollectionDead:r}=(0,d().K8)((()=>{const e=t.collectionStore(),o=null==e?void 0:e.getParentBlockStore(),n=o&&(null==o?void 0:o.pathIsDead());return{parentBlockStore:o,isParentCollectionDead:n}}),[t]);return n&&(!o&&r)?(0,S.jsx)(zS,{parentBlockStore:n}):null}function zS(e){let{parentBlockStore:t}=e;const o=(0,s().v3)(),{isMobile:r}=(0,s().Y0)(),i=r?ES().wt:ES().Ye,l=(0,u().IS)((e=>({layoutComponent:{color:e.text.secondary,background:e.accentColors.gray[30],padding:"16px 16px 16px 12px",borderRadius:4,fontSize:14},trashIcon:{width:24,height:24,flexShrink:0,marginRight:10,padding:2},viewCollectionButton:{fontWeight:w().Wy.semibold},arrowIcon:{width:16,height:16,flexShrink:0,padding:2,marginLeft:4}})),[]),a=(0,n.useCallback)((()=>{(0,ge().vd)(o,"view_deleted_database_from_deleted_collection_view_banner"),OS().Y({environment:o,store:t,pageVisitSource:wn().y8.LinkInPage})}),[o,t]);return(0,S.jsxs)(i,{style:l.layoutComponent,alignItems:"center",justifyContent:r?"":"space-between",children:[(0,S.jsxs)(ES().Ye,{alignItems:"center",children:[(0,ut().I)(l.trashIcon),(0,S.jsx)(k().sA,{id:"collectionViewBlock.deletedContainerBanner.collectionInTrash",defaultMessage:"The original database has been deleted and cannot be edited"})]}),(0,S.jsxs)(rt().p,{style:l.viewCollectionButton,onClick:a,isLightGray:!0,children:[(0,S.jsx)(k().sA,{id:"collectionViewBlock.deletedContainerBanner.collection.viewCollectionButton",defaultMessage:"View database"}),(0,nd().B)(l.arrowIcon)]})]})}const KS=n.memo(DS);var HS=()=>o(650829),GS=()=>o(726483),WS=()=>o(559378),NS=()=>o(99042);function $S(){const e=(0,Z().Ks)(),t=(0,d().K8)((()=>Boolean(null==e?void 0:e.shouldShowSpinnerStore.state)),[null==e?void 0:e.shouldShowSpinnerStore]);return(0,jr().A)(t,500,100)?(0,S.jsx)("div",{style:{display:"flex",alignItems:"center",flexDirection:"column",marginRight:4},children:(0,S.jsx)(En().A,{style:{width:14,height:14}})}):null}const US=n.memo($S);var qS=()=>o(344417);var YS=()=>o(623580);const XS=(0,k().YK)({searchLabel:{defaultMessage:"Search",id:"database.searchButton.tooltip"},searchInputPlaceholder:{defaultMessage:"Type to search...",id:"database.searchInputPlaceholder"}}),QS=n.memo((function(e){let{collectionContextStore:t,isFullScreen:o,currentViewType:r,topbarIconButtonStyle:i}=e;const l=(0,s().v3)(),a=(0,d().O$)(t.searchOpenStore),c=(0,d().K8)((()=>0===t.collectionStoresStore.state.length),[t]),p=(0,d().O$)(t.searchQueryStore),m=(0,u().IS)((e=>({iconButton:{width:g().Ev.sm,height:g().Ev.sm,fill:e.mediumIconColor},input:{fontSize:14,lineHeight:1,paddingRight:4,color:e.regularTextColor,marginBottom:1},ignoreArea:{display:"flex",alignItems:"center",overflow:"hidden"}})),[]),h=(0,n.useCallback)((()=>{ie().default.reset(),le().default.reset(),kd().A.reset()}),[]),f=(0,n.useCallback)((()=>{t.searchQueryStore.setState(""),t.searchOpenStore.setState(!1)}),[t]),v=(0,n.useCallback)((()=>{t.searchQueryStore.state||f()}),[t,f]),y=(0,n.useCallback)((e=>{27===e.keyCode&&f()}),[f]),x=(0,n.useCallback)((()=>{t.searchOpenStore.update((e=>!e)),(0,T().X)({environment:l,collectionContextStore:t,action:"click_topbar_search"})}),[t,l]),C=(0,n.useCallback)((e=>{(0,jn().S)({searchQuery:e.target.value,collectionContextStore:t,isFullScreen:Boolean(o)}),function(e,t){ge().vd(e,"collection_search",t)}(l,{view_type:r})}),[t,r,l,o]),b=(0,Gn().Y)(C,250);return(0,S.jsx)(At().A,{renderTooltip:()=>yt().A.formatMessage(XS.searchLabel),render:e=>(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(jt().A,{...e,icon:qS().u,iconStyle:m.iconButton,style:i,disabled:c,onClick:x,ariaLabel:yt().A.formatMessage(XS.searchLabel)}),(0,S.jsx)(It().A,{visible:a,animate:{width:150,opacity:1},initial:{width:0,opacity:0},exit:{width:0,opacity:0},children:(0,S.jsx)(it().A,{capture:a,allowEsc:!0,render:e=>(0,S.jsx)("div",{...e,style:m.ignoreArea,children:(0,S.jsx)(YS().A,{style:m.input,right:(0,S.jsx)(HS().LazyAssistantCollectionSearchInputButton,{collectionContextStore:t}),format:YS().C.Transparent,value:p,onChange:b,placeholder:yt().A.formatMessage(XS.searchInputPlaceholder),focusInitial:a,showClearButton:!0,onFocus:h,onBlur:v,onCancel:f,onClick:Ce().kV,onClearButtonClick:f,onKeyDown:y})})})})]})})}),mo().A);const ZS={CollectionViewAddItemButtonTooltip:new(ne().O2)("CollectionViewAddItemButtonTooltip",(async()=>Promise.all([o.e(23806),o.e(75134),o.e(43965)]).then(o.bind(o,290334))))},JS=(0,ne()._h)(ZS.CollectionViewAddItemButtonTooltip,(e=>e.CollectionViewAddItemButtonTooltip)),eh=n.memo((function(e){let{store:t,settingsHeaderSizeObserver:r,handleAddItemClick:i,isTooltipVisible:l,collectionModel:a}=e;const c=(0,s().v3)(),{isMobile:p}=(0,s().Y0)(),m=(0,n.useRef)(null),g=(0,Z().ET)(),h=(0,d().K8)((()=>g.isMultiSourceView),[g]),f=(0,d().K8)((()=>(0,L().h6)(g)),[g]),v=(0,d().uB)(void 0,Oe().A),y=(0,d().K8)((()=>r.rect.state.width<=qh),[r]),x=(0,d().K8)((()=>{if(!g.isMultiSourceView)return;const e=g.collectionStoresStore.state;if(!e)return"loading";if(0===e.length)return"noDbs";const t=Boolean(e.find((e=>e.canEdit()||e.canEditCollection()||e.canEditContentOnly())));return t?void 0:vg}),[g]),C=!p&&y,b=h,w=(0,u().IS)((e=>({buttonWrapper:{position:"relative",marginLeft:C?4:6},buttonStyle:{fontSize:14,height:28},mainButtonStyle:C?{width:28}:{},iconStyle:C?{width:15,marginRight:0}:{},offlineMessage:{fontSize:14,color:e.mediumTextColor,width:280,padding:8}})),[C]),I=(0,n.useCallback)((()=>{l&&((0,o(51367).Sq)(c,{callout_key:"collection_add_item_button_tooltip",dismiss_type:"tooltip_dismiss",placement_key:"Tooltip"}),(0,jc().a)(c,"collection_add_item_button_tooltip"))}),[c,l]),j=(0,n.useCallback)((()=>{(0,T().X)({environment:c,collectionContextStore:g,action:"click_topbar_templates_dropdown"}),I()}),[g,c,I]),A=(0,d().K8)((()=>{const e=g.collectionStore();if(!e)return null;if(ze().A.state.online){const n=g.permissionScopesStore.state,r=e=>{R().Ur({userAction:"CollectionViewBlock.handleTemplateEmptyPageClick",collectionViewBlockStore:t,collectionContextStore:g,environment:c,shouldCoerce:!1,from:{createBlock:"cvb_template_empty_page"},templateStore:void 0,useCrdt:!0}),v.reset()},i=e=>{R().Ur({environment:c,collectionContextStore:g,collectionViewBlockStore:t,templateStore:e.templateStore,useCrdt:e.useCrdt,isKeyboard:e.isKeyboard,from:{createBlock:"cvb_template",initCollection:"collection_view_block"},shouldCoerce:!0}),v.reset()},l=()=>{v.reset()};return(0,S.jsx)(o(975318).A,{isOverlay:!0,collectionStore:e,canConfigureCollection:n.canConfigureCollection,onEmptyPageClick:r,onEmptyEnter:r,onTemplateClick:i,onCancelClick:l,locked:t.isNonEditableState()})}return(0,S.jsx)("div",{style:w.offlineMessage,children:(0,S.jsx)(k().sA,{defaultMessage:"Please go online to use a template.",id:"collectionViewBlock.actionBar.offlineTemplatePicker.message"})})}),[g,c,t,w.offlineMessage,v]),P=(0,n.useCallback)((e=>{var t;const o=null===(t=m.current)||void 0===t?void 0:t.getBoundingClientRect();o&&ug().qL({environment:c,originRect:o,moveToContext:"aggregated_type",overrideDatabaseType:"notion://tasks_collection",onAccept:()=>{i(e)}})}),[c,i]),M=(0,n.useCallback)((e=>(0,S.jsx)(o(430102).A,{ref:m,title:C?null:f,icon:C?o(464699).b:void 0,color:"blue",onClick:e=>{h?P(e):i(e),I()},mainButtonTooltip:x===vg?(0,S.jsx)(k().sA,{defaultMessage:"You do not have permissions{br}to edit the source databases",id:"collectionViewBlock.addItem.tooltip.noWritableDbs",values:{br:(0,S.jsx)("br",{})}}):C?f:null,onDropdownClick:e.onClick,style:w.buttonStyle,mainButtonStyle:w.mainButtonStyle,iconStyle:w.iconStyle,className:he().kel,disabled:Boolean(x),disableDropdown:b})),[f,b,I,i,h,x,P,C,w.buttonStyle,w.iconStyle,w.mainButtonStyle]),B=(0,n.useRef)(null),_=(0,n.useCallback)((e=>l?(0,S.jsx)(JS,{collectionModel:a,onDismiss:I,children:M(e)}):(0,S.jsx)(Qe().lC,{collectionContextStore:g,containerRef:B,step:"new_page",children:M(e)})),[g,a,I,l,M]);return(0,S.jsx)(Ri().Ay,{popupType:p?su().n.SlideUp:su().n.Popup,placementToOrigin:Ri().sx.Bottom,alignmentToOrigin:Ri().yP.Start,render:()=>A,originGap:4,onClick:j,renderOrigin:e=>(0,S.jsx)("div",{style:w.buttonWrapper,ref:B,children:_(e)}),buttonPopupStore:v})})),th={viewBox:"0 0 16 16",svg:(0,S.jsx)("path",{d:"M9.332 1.38a.575.575 0 0 0-.662.204l-4.936 6.84a.575.575 0 0 0 .466.911h2.398l-.315 4.32a.575.575 0 0 0 1.039.378l4.944-6.832a.575.575 0 0 0-.466-.912H9.401l.309-4.328a.575.575 0 0 0-.378-.582M7.216 8.185H5.324l3.095-4.289-.209 2.927a.575.575 0 0 0 .574.616h1.89l-3.097 4.28.212-2.917a.575.575 0 0 0-.573-.617"})},oh=(0,g().wt)("lightningSmall",th);var nh=()=>o(940371),rh=()=>o(766558);function ih(){const e=(0,s().v3)(),t=(0,Z().ET)(),o=(0,d().K8)((()=>t.settingsStore.state.open&&GS()._T({tab:(0,nh().S)(t.settingsStore)})),[t]),r=(0,d().O$)(t.isInHomeWidgetStore),i=(0,d().K8)((()=>t.aliveAutomationCountStore.state>0),[t]),l=(0,d().K8)((()=>t.collectionViewBlockStore()),[t]),a=(0,d().K8)((()=>{var e;return null===(e=Le().default.getState().mainEditorCurrentBlockStore)||void 0===e?void 0:e.pathIsDead()}),[]),c=(0,d().K8)((()=>{const e=t.collectionStore(),o=null==e?void 0:e.getParentBlockStore();return null==o?void 0:o.pathIsDead()}),[t]),p=(0,d().K8)((()=>null==l?void 0:l.isLocked()),[l]),m=(0,n.useMemo)((()=>(c||a)&&!i),[i,a,c]),h=(0,u().IS)((e=>({buttonStyle:(0,rh().j)({theme:e,isInHomeWidget:r}),iconStyle:{width:g().Ev.sm,height:g().Ev.sm,fill:i?e.icon.uiBluePrimary:e.mediumIconColor}})),[i,r]),f=(0,d().K8)((()=>GS().rc({collectionStore:t.collectionStore()})),[t]),v=(0,n.useCallback)((o=>{(0,Ce().SQ)({event:o,context:Ce().y$.CollectionAutomationSettingsClick,callback:()=>{const o=t.settingsStore,n=o.state.open,r=(0,nh().S)(o);n&&"automationSettings"===(null==r?void 0:r.type)?I().os({collectionSettingsStore:o}):i||p||a||c||!f?(I().Ow({collectionContextStore:t,collectionSettingsStore:o}),I().R8({collectionSettingsStore:o,item:{source:"collection_thunderbolt_icon",type:"automationSettings"}})):I().js({environment:e,collectionSettingsStore:o,collectionContextStore:t})}})}),[e,t,i,p,a,c,f]);return(0,S.jsx)(At().A,{renderTooltip:()=>m?yt().A.formatMessage(lh.disableAutomationsSettingsButtonTooltip):yt().A.formatMessage(lh.openAutomationsSettingsButtonTooltip),render:e=>(0,S.jsx)(jt().A,{ariaLabel:m?yt().A.formatMessage(lh.disableAutomationsSettingsButtonAriaLabel):yt().A.formatMessage(lh.openAutomationsSettingsButtonAriaLabel),className:he().Jnf,icon:oh,style:h.buttonStyle,iconStyle:h.iconStyle,hovered:o,onClick:v,disabled:m,...e})})}const lh=(0,k().YK)({openAutomationsSettingsButtonTooltip:{defaultMessage:"Create and view automations",id:"database.collectionViewBlock.openAutomationsSettingsButton.tooltip"},openAutomationsSettingsButtonAriaLabel:{defaultMessage:"Create and view automations",id:"database.collectionViewBlock.openAutomationsSettingsButton.ariaLabel"},disableAutomationsSettingsButtonTooltip:{defaultMessage:"Can’t add automations to databases in the trash",id:"database.collectionViewBlock.disableAutomationsSettingsButton.tooltip"},disableAutomationsSettingsButtonAriaLabel:{defaultMessage:"Can’t add automations to databases in the trash",id:"database.collectionViewBlock.disableAutomationsSettingsButton.ariaLabel"}}),sh=n.memo(ih);var ah=()=>o(59400),ch=()=>o(525432);const dh=(0,k().YK)({filterLabel:{defaultMessage:"Filter",id:"collectionViewBlock.action.filter.title"}}),uh=n.memo((function(e){const{createFilterSettingsStore:t}=e,o=(0,s().v3)(),{isMobile:r,isPhone:i}=(0,s().Y0)(),l=(0,Z().ET)(),a=(0,d().K8)((()=>t.state.open),[t]),c=(0,d().O$)(l.isInHomeWidgetStore),p=(0,d().K8)((()=>(0,qo().N1)({collectionContextStore:l,applySubitemFilter:!1,filterOutHideSubitemsQuickFilter:!1}).length>0),[l]),m=(0,d().K8)((()=>(0,qo().I6)(l)),[l]),h=yt().A.formatMessage(dh.filterLabel),f=(0,n.useCallback)((()=>{var e;const n=null===(e=l.collectionViewStore())||void 0===e?void 0:e.id,r=l.permissionScopesStore.state,s=l.isUnlistedViewStore.state&&l.isInlineViewStore.state,a=r.canConfigureBlock||s?l.currentCombinatorFilterStore.state:void 0,d=l.currentPropertyFiltersStore.state,u=l.filtersBarOpenStore.state;n&&!i&&((0,Vd().E)({userId:o.currentUser.id,collectionViewId:n,isOpen:!u}),l.filtersBarOpenStore.setState(u)),c||s?u||d.length>0||a?I().R8({collectionSettingsStore:l.settingsStore,item:{type:"filters"}}):(I().R8({collectionSettingsStore:l.settingsStore,item:{type:"createFilter"}}),Yi().Ms(l)):u||d.length>0||a?l.filtersBarOpenStore.setState(!u):(I().R8({collectionSettingsStore:t,item:{type:"createFilter"}}),Yi().Ms(l)),(0,T().X)({environment:o,collectionContextStore:l,action:"click_topbar_filter"})}),[l,t,o,c,i]),v=(0,n.useCallback)((()=>{I().os({collectionSettingsStore:t})}),[t]),y=(0,u().IS)((e=>({buttonStyle:(0,rh().j)({theme:e,isInHomeWidget:c}),iconStyle:{width:g().Ev.sm,height:g().Ev.sm,fill:p?e.icon.uiBluePrimary:e.mediumIconColor},tempFilterIndicator:{position:"absolute",top:3,right:2,background:"dark"===e.mode?e.accentColors.orange[500]:e.accentColors.orange[300],border:`1px solid ${e.contentBackground}`,width:9,height:9,borderRadius:9},iconContainer:{position:"relative"}})),[c,p]),x=(0,n.useCallback)((()=>h),[h]),C=(0,n.useCallback)((()=>(0,S.jsx)(ah().m$,{context:ch().Bd.TopbarFilterPopup,collectionContextStore:l,collectionSettingsStore:t,hideDesktopHeader:!0})),[l,t]);return(0,S.jsx)(aa().Ay,{popupType:r?Ri().z7.SlideUp:Ri().z7.Popup,open:a,placementToOrigin:to().UV.Bottom,alignmentToOrigin:to().MY.Start,origin:(0,S.jsx)(At().A,{renderTooltip:x,render:e=>(0,S.jsxs)("div",{style:y.iconContainer,children:[(0,S.jsx)(jt().A,{...e,ariaLabel:h,icon:_d,iconStyle:y.iconStyle,style:y.buttonStyle,onClick:f}),m&&(0,S.jsx)("div",{style:y.tempFilterIndicator})]})}),onDismiss:v,originGap:4,render:C})})),ph={viewBox:"0 0 16 16",svg:(0,S.jsx)("path",{d:"M8.912 2.463a.625.625 0 1 0 0 1.25h2.491L8.358 6.758a.625.625 0 1 0 .884.884l3.045-3.045v2.49a.625.625 0 1 0 1.25 0v-4a.625.625 0 0 0-.625-.624zM7.64 8.36a.625.625 0 0 0-.885 0l-3.042 3.043V8.912a.625.625 0 1 0-1.25 0v4c0 .345.28.625.625.625h4a.625.625 0 0 0 0-1.25H4.597l3.042-3.043a.625.625 0 0 0 0-.883"})},mh=(0,g().wt)("arrowExpandDiagonalBottomLeftToTopRightSmall",ph);const gh=(0,k().YK)({openFullscreenPageButtonTooltip:{id:"database.collectionViewBlock.openFullscreenPageButton.tooltip",defaultMessage:"Open as full page"}});function Sh(e){let{store:t,viewType:o}=e;const r=(0,s().v3)(),i=(0,Z().ET)(),l=(0,d().K8)((()=>(0,Zn().Ay)({store:t,fullyQualified:!1,pageVisitSource:wn().y8.Expand,demoSettingsStore:WS().A})),[t]),a=(0,u().DP)(),c=(0,d().K8)((()=>{const e=i.isInHomeWidgetStore.state;return(0,rh().j)({theme:a,isInHomeWidget:e})}),[i,a]),p=(0,n.useCallback)((()=>function(e,t){ge().vd(e,"open_collection_as_page",t)}(r,{view_type:o})),[r,o]),m=yt().A.formatMessage(gh.openFullscreenPageButtonTooltip);return(0,S.jsx)(At().A,{renderTooltip:()=>m,render:e=>(0,S.jsx)(jt().A,{ariaLabel:m,href:l,onClick:p,icon:mh,style:c,iconStyle:{width:g().Ev.sm,height:g().Ev.sm},...e})})}const hh=n.memo(Sh);var fh=()=>o(787626);var vh=()=>o(415651);class yh extends p().default{getInitialState(){return{query:"",limit:20}}}const xh=yh;var Ch=()=>o(305390);const bh=(0,k().YK)({searchPlaceholder:{defaultMessage:"Search for a page…",id:"collectionNoDateMenu.searchPlaceholder"}}),wh=p().default.createClass(void 0,{name:"ResultStore"});function kh(e){let{collectionViewBlockStore:t,collectionViewType:r,property:i,collectionContextStore:l,onClose:a,onAddPage:c}=e;const u=(0,s().v3)(),p=(0,s().Y0)(),m=(0,d().uB)(void 0,xh),g=(0,d().uB)(void 0,wh),h=(0,d().K8)((()=>m.state.query),[m]),f=(0,d().O$)(g),v=(0,d().K8)((()=>{const{query:e,limit:t}=m.state;return{type:"results",filter:{operator:"and",filters:[{property:i,filter:{operator:"is_empty"}}]},limit:t,searchQuery:e}}),[i,m]),y=(0,n.useCallback)((e=>{m.setState({query:e.target.value,limit:Rh})}),[m]),x=(0,n.useCallback)((e=>{const t=m.state.limit,o=l.isLoadingStore.state;e<Ih&&f&&f.hasMore&&!o&&m.setState({...m.state,limit:t+Rh})}),[l,f,m]),C=(0,n.useCallback)((()=>{let e;return e="calendar"===r?p.isMobile?(0,S.jsx)(k().sA,{defaultMessage:"Click to add date.",id:"collectionNoDateMenu.addResultToCalendar.prompt.basic"}):(0,S.jsx)(k().sA,{defaultMessage:"Click or drag to calendar to add date.",id:"collectionNoDateMenu.addResultToCalendar.prompt"}):(0,S.jsx)(k().sA,{defaultMessage:"Click to add to the timeline",id:"collectionNoDateMenu.addResultToTimeline.prompt"}),f?f&&0===f.blockIds.length?(0,S.jsx)(ui().A,{title:e,children:(0,S.jsx)(sa().A,{title:(0,S.jsx)(k().sA,{defaultMessage:"No results",id:"collectionNoDateMenu.noResults.title"})})}):(0,S.jsx)(ci().Ay,{type:ci().Oh.Vertical,sections:[{key:"results",render:t=>(0,S.jsx)(ui().A,{...t,title:e}),items:Ph(f.blockIds,l,t,i,c,u,r)}],initialFocus:h?0:void 0}):(0,S.jsx)(ui().A,{children:(0,S.jsx)(Ah,{})})}),[t,r,f,l,i,c,u,h,p.isMobile]);return(0,S.jsxs)(o(170356).Pq,{title:void 0,onCancel:a,desktopWidth:320,children:[(0,S.jsx)(ui().A,{isInput:!0,children:(0,S.jsx)(la().Ay,{placeholder:yt().A.formatMessage(bh.searchPlaceholder),focus:!p.isMobile||void 0,focusAfterAnimation:!0,value:h,onChange:y})}),(0,S.jsx)(Wo().A,{id:"no_date_results",reducer:v,collectionContextStore:l,render:C,resultStore:g}),(0,S.jsx)(Cn().A,{onChange:x})]})}const Th=n.memo(kh,mo().A),Ih=200,Rh=20;function jh(e){let{props:t,store:o,disabled:r,url:i,collectionViewType:l}=e;const a=(0,s().v3)(),c=(0,s().Y0)(),d=n.useRef(null),u=(0,S.jsx)(Ch().A,{...t,ref:d,store:o,hidePath:!0,disabled:r,right:void 0!==i?(0,S.jsx)(rt().p,{size:"sm",href:i,disabled:r,onClick:()=>{!function(e){ge().vd(e,"collection_no_date_menu_view")}(a)},children:(0,S.jsx)(k().sA,{defaultMessage:"Open",id:"collectionNoDateMenu.view.button.label"})},o.id):void 0,dontShrinkRight:!0});return"calendar"!==l||c.isMobile?u:(0,S.jsx)(lt().A,{canSelect:!1,canDrag:!r,canEditText:!1,store:o,shouldShowDropZone:!0,getGhostElement:()=>function(e){if(e.current){return[vh().up(e.current)]}return[]}(d),analyticsName:"calendar_no_date_item",children:u})}function Ah(){return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(Er().A,{style:{display:"flex",height:16,marginTop:4,marginLeft:12,marginRight:12,borderRadius:12,width:"50%"}}),(0,S.jsx)(Er().A,{style:{display:"flex",height:16,marginTop:6,marginLeft:12,marginRight:12,marginBottom:6,borderRadius:12,width:"75%"}})]})}function Ph(e,t,o,n,r,i,l){const s=e.map((e=>re().Bv.createChildStore(o,{table:E().ev,id:e}))).filter((e=>!(0,fh().b)(e.getPropertyStore(n).getValue()))).map((e=>{const{mainEditorCurrentBlockStore:o}=Le().default.state;if(!o)return;const n=(0,L().wy)({environment:i,store:e,mainEditorCurrentBlockStore:o,collectionContextStore:t,fullyQualified:!1}),s={key:e.id,render:t=>(0,S.jsx)(jh,{props:t,store:e,disabled:!e.canEdit(),url:n,collectionViewType:l}),action:()=>{e.canEdit()&&(r(e),function(e){ge().vd(e,"collection_no_date_menu_add")}(i))}};return s}));return C().oE(s)}function Mh(e){let{noDateTotal:t,noDateProperty:o,collectionViewType:r,timelineViewRef:i}=e;const l=(0,s().v3)(),{isMobile:a}=(0,s().Y0)(),c=(0,Z().ET)(),p=(0,d().K8)((()=>c.collectionViewBlockStore()),[c]),m=(0,n.useCallback)((()=>{(0,T().X)({environment:l,collectionContextStore:c,action:"click_topbar_no_date"})}),[c,l]),g=(0,u().IS)((e=>({buttonStyle:(0,rh().y)({theme:e})})),[]),h=(0,n.useCallback)((e=>{const t=e.getAssociatedCollectionStore(),o=null==i?void 0:i.current;if(!t)return;const{performResult:n}=B().createAndCommit({userAction:"CollectionViewBlock.insertedStore",environment:l,canUndo:!0,perform:n=>"calendar"===r?(0,$a().$N)({environment:l,store:e,collectionStore:t,collectionContextStore:c,startDayOfWeek:Se().XX.state,transaction:n}):o?o.addBlockToView({store:e,transaction:n}):void 0});n&&P().td({environment:l,stores:[n]})}),[c,r,l,i]),f=(0,n.useCallback)((e=>p?(0,S.jsx)(Th,{collectionViewBlockStore:p,property:o,onClose:e.close,onAddPage:h,collectionViewType:r,collectionContextStore:c}):null),[c,p,r,o,h]);return(0,S.jsx)(Ri().Ay,{popupType:a?su().n.SlideUp:su().n.Popup,placementToOrigin:Ri().sx.Bottom,alignmentToOrigin:Ri().yP.Start,originGap:4,render:f,onClick:m,renderOrigin:e=>(0,S.jsx)(rt().p,{isGray:!0,style:g.buttonStyle,...e,children:(0,S.jsx)(k().sA,{defaultMessage:"No date ({noDateTotal})",id:"collectionViewBlock.action.noDateButton.noProperty.label",values:{noDateTotal:t>=vi().iY?vi().iY-1+"+":t}})})})}const Bh=n.memo(Mh),_h={viewBox:"0 0 16 16",svg:(0,S.jsx)("path",{d:"M11.349 2.672a.625.625 0 0 0-.884 0L7.666 5.471a.625.625 0 1 0 .884.883l1.732-1.73v8.262a.625.625 0 1 0 1.25 0V4.623l1.73 1.731a.625.625 0 0 0 .885-.883zM5.093 2.49a.625.625 0 0 0-.625.624v8.263l-1.73-1.731a.625.625 0 1 0-.885.883l2.798 2.799c.244.244.64.244.884 0l2.798-2.798a.625.625 0 0 0-.883-.884l-1.732 1.73V3.115a.625.625 0 0 0-.625-.625"})},Vh=(0,g().wt)("arrowUpDownSmall",_h),Fh=(0,k().YK)({sortLabel:{defaultMessage:"Sort",id:"collectionViewBlock.action.sort.title"}});function Lh(e){let{createSortSettingsStore:t}=e;const o=(0,Z().ET)(),{isMobile:r}=(0,s().Y0)(),i=(0,s().v3)(),l=(0,d().K8)((()=>t.state.open),[t]),a=(0,d().K8)((()=>o.currentSortsStore.state.length>0),[o]),c=(0,d().K8)((()=>(0,qo().gv)(o)),[o]),p=(0,d().O$)(o.isInHomeWidgetStore),m=(0,n.useCallback)((()=>{const e=o.permissionScopesStore.state.canConfigureBlock?o.currentCombinatorFilterStore.state:void 0,n=o.currentPropertyFiltersStore.state,r=o.filtersBarOpenStore.state,l=a||r||n.length>0||e;p&&I().R8({collectionSettingsStore:o.settingsStore,item:{type:a?"sort":"createSort"}}),l?p||(o.filtersBarOpenStore.setState(!r),a?I().R8({collectionSettingsStore:o.filterBarSortSettingsStore,item:{type:"sort"}}):I().R8({collectionSettingsStore:t,item:{type:"createSort"}})):p||I().R8({collectionSettingsStore:t,item:{type:"createSort"}}),(0,T().X)({environment:i,collectionContextStore:o,action:"click_topbar_sort"})}),[o,t,i,a,p]),h=(0,n.useCallback)((()=>{I().os({collectionSettingsStore:t})}),[t]),f=yt().A.formatMessage(Fh.sortLabel),v=(0,u().IS)((e=>({iconStyle:{width:g().Ev.sm,height:g().Ev.sm,fill:a?e.icon.uiBluePrimary:e.mediumIconColor,transform:"rotate(180deg)"},buttonStyle:(0,rh().j)({theme:e,isInHomeWidget:p}),tempSortIndicator:{position:"absolute",top:3,right:2,background:"dark"===e.mode?e.accentColors.orange[500]:e.accentColors.orange[300],border:`1px solid ${e.contentBackground}`,width:9,height:9,borderRadius:9}})),[a,p]);return(0,S.jsx)(aa().Ay,{popupType:r?Ri().z7.SlideUp:Ri().z7.Popup,placementToOrigin:to().UV.Bottom,alignmentToOrigin:to().MY.Start,open:l,origin:(0,S.jsx)(At().A,{renderTooltip:()=>f,render:e=>(0,S.jsxs)("div",{style:{position:"relative"},children:[(0,S.jsx)(jt().A,{...e,ariaLabel:f,icon:Vh,iconStyle:v.iconStyle,style:v.buttonStyle,onClick:m}),c&&(0,S.jsx)("div",{style:v.tempSortIndicator})]})}),onDismiss:h,originGap:4,render:()=>(0,S.jsx)(ah().m$,{context:ch().Bd.TopbarSortPopup,collectionContextStore:o,collectionSettingsStore:t,hideDesktopHeader:!0}),trapFocus:!0})}const Oh=n.memo(Lh);function Eh(){const e=(0,s().v3)(),t=(0,Z().ET)(),r=(0,d().K8)((()=>{var e;return null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.id}),[t]),i=(0,u().IS)((e=>({button:{display:"flex",alignItems:"center",fontSize:14,fontWeight:w().Wy.medium,color:e.mediumTextColor},searchIcon:{width:g().Ev.sm,height:g().Ev.sm,fill:e.mediumIconColor,marginRight:6}})),[]),l=(0,n.useCallback)((()=>{o(260488).su({environment:e,analyticsFrom:"wiki-home-collection-view"}),r&&o(250484).Ay.updateFilters({ancestors:[r]})}),[e,r]);return r?(0,S.jsxs)(rt().p,{style:i.button,onClick:l,children:[(0,qS().u)(i.searchIcon),(0,S.jsx)(k().sA,{defaultMessage:"Search",id:"database.collectionViewBlock.pageView.search"})]}):null}const Dh=n.memo(Eh);function zh(e){let{showHoverActionsStore:t,isFullScreen:r,store:i,currentViewType:l,collectionContextStore:a,isPlaceholderExternalCollection:c,settingsHeaderSizeObserver:m,createFilterSettingsStore:g,createSortSettingsStore:h,isInHomeWidget:f,handleAddItemClick:v,headerSizeObserver:y,timelineViewRef:x,allowedActions:C}=e;const b=(0,s().v3)(),w=(0,u().DP)(),{isPhone:k,isMobile:T}=(0,s().Y0)(),I=(0,o(792485).S)(),R=(0,d().K8)((()=>a.collectionViewStore()),[a]),j=(0,d().K8)((()=>"view"===o(411671).A.getMode(b,i).permission),[b,i]),A=(0,d().K8)((()=>(0,Yt().w6)(b)),[b]),P=(0,d().K8)((()=>(void 0!==a.collectionStore()||"collectionTypedView"===a.contextType)&&!c&&m.rect.state.width>=qh),[a,c,m]),M=(0,d().K8)((()=>({blockId:WS().A.getCurrentStepBlockId(),subStep:WS().A.getCurrentStepSubStep()??""})),[]),B=(0,d().K8)((()=>{const e=I&&I.publicEditModeStore.state.hasPublicPermission;return!(!WS().A.isActiveDemo()||!e)&&(!T&&M.blockId===i.id)}),[M.blockId,T,I,i.id]),_=(0,d().K8)((()=>!!B||t.state),[B,t]),V=(0,d().K8)((()=>{const e=y.rect.state;return!T&&e.width>0&&e.width<400}),[T,y.rect]),F=(0,n.useCallback)((e=>{(0,Ce().SQ)({event:e,context:Ce().y$.EditorMouseDown,callback:()=>{e.preventDefault()}})}),[]),{isUnlisted:L,isUnlistedFromSemanticQuery:O}=(0,d().K8)((()=>{const e=null==R?void 0:R.getUnlistedStatus(),t=!0===(null==e?void 0:e.isUnlisted);return{isUnlisted:t,isUnlistedFromSemanticQuery:t&&!0===(null==e?void 0:e.isUnlistedFromSemanticQuery)}}),[R]),E=(0,d().K8)((()=>{if(V||r||k||L||!i.canEditCollection())return null;const e=m.rect.state.width<=qh;return(0,S.jsx)(o(99600).A,{store:i,isInlineCollection:!0,hideText:e,buttonStyle:{marginLeft:4}})}),[r,k,L,m.rect,V,i]),D=(0,d().K8)((()=>{const e=m.rect.state.width<=qh;return(0,S.jsx)(Hg().GL,{store:i,v2:!0,hideText:e})}),[m.rect,i]),z=(0,d().K8)((()=>{var e,t;if(!C||C.includes("noDate"))return"timeline"===l?null===(e=a.normalizedQueryStore.state)||void 0===e?void 0:e.timeline_by:"calendar"===l?null===(t=a.normalizedQueryStore.state)||void 0===t?void 0:t.calendar_by:void 0}),[C,a.normalizedQueryStore,l]),K=(0,d().uB)(void 0,p().default),H=(0,d().K8)((()=>{if(z)return{type:"aggregation",aggregation:{property:z,aggregator:"empty",enforceMaxAggregationLimit:!0}}}),[z]),G=(0,d().K8)((()=>{if(H){const e=K.state;return e&&"aggregation"===e.type&&"number"===e.aggregationResult.type&&e.aggregationResult.value?e.aggregationResult.value:0}}),[H,K]),W=(0,d().K8)((()=>{if(!z||!G||!P||V||"calendar"!==l&&"timeline"!==l)return null;const e=a.permissionScopesStore.state,t=a.collectionStore();return"collectionTypedView"===a.contextType||t&&e.canEditContent?(0,S.jsx)(Bh,{noDateTotal:G,noDateProperty:z,collectionViewType:l,timelineViewRef:x}):null}),[a,l,z,G,P,V,x]),N=(0,n.useMemo)((()=>!P||"page"===l||"form_editor"===l||C&&!C.includes("filter")?null:B&&"filter"===M.subStep?(0,S.jsx)(NS().F,{subStep:"filter",step:"demo_collection",children:(0,S.jsx)(uh,{createFilterSettingsStore:g})}):(0,S.jsx)(uh,{createFilterSettingsStore:g})),[P,l,C,B,M.subStep,g]),$=(0,d().K8)((()=>{if(!P||"page"===l||"form_editor"===l||C&&!C.includes("sort"))return null;if("chart"===l){var e,t;const o=null===(e=a.collectionViewStore())||void 0===e?void 0:e.getChartConfig();if("placeholder"===(null==o?void 0:o.type)||"results-advanced"!==(null==o||null===(t=o.chartFormat)||void 0===t?void 0:t.mainSort))return null}return B&&"sort"===M.subStep?(0,S.jsx)(NS().F,{subStep:"sort",step:"demo_collection",children:(0,S.jsx)(Oh,{createSortSettingsStore:h})}):(0,S.jsx)(Oh,{createSortSettingsStore:h})}),[P,l,C,B,h,a,M]),U=(0,d().K8)((()=>!P||"chart"===l||"page"===l||c||!(0,GS().aS)(a)||j||C&&!C.includes("automations")?null:B&&"automations"===M.subStep?(0,S.jsx)(NS().F,{subStep:"automations",step:"demo_collection",children:(0,S.jsx)(sh,{})}):(0,S.jsx)(sh,{})),[a,l,c,P,C,M,B,j]),q=(0,d().K8)((()=>{return!P||"form_editor"===l||"chart"===l||V||C&&!C.includes("search")||c?null:"page"===l?null!==(e=a.collectionViewBlockStore())&&void 0!==e&&e.isCollectionViewPageWithContent()?(0,S.jsx)(Dh,{}):null:(0,S.jsx)(QS,{collectionContextStore:a,isFullScreen:Boolean(r),currentViewType:l,topbarIconButtonStyle:(0,rh().j)({theme:w,isInHomeWidget:Boolean(f)})});var e}),[a,l,r,f,c,P,V,w,C]),Y=(0,d().K8)((()=>{var e;return!P||C&&!C.includes("ai")||c||null!=a&&null!==(e=a.collectionStore())&&void 0!==e&&e.isSyncedCollection()?null:(0,S.jsx)(HS().LazyAssistantCollectionViewButton,{collectionContextStore:a})}),[a,c,P,C]),X=(0,n.useMemo)((()=>r||j||C&&!C.includes("fullScreen")?null:(0,S.jsx)(hh,{store:i,viewType:l})),[r,i,l,C,j]),Q=(0,d().K8)((()=>j||C&&!C.includes("viewSettings")||c?null:B&&"settings"===M.subStep?(0,S.jsx)(NS().F,{subStep:"settings",step:"demo_collection",children:(0,S.jsx)(Mg().XA,{collectionContextStore:a,style:(0,rh().j)({theme:w,isInHomeWidget:Boolean(f)})})}):(0,S.jsx)("div",{style:{position:"relative"},children:(0,S.jsx)(Mg().XA,{collectionContextStore:a,style:(0,rh().j)({theme:w,isInHomeWidget:Boolean(f)})})})),[a,f,c,w,C,B,M,j]),Z=(0,d().K8)((()=>!A&&P&&null!=C&&C.includes("saveOrOpenOverflow")?(0,S.jsx)(Mg().fV,{collectionContextStore:a,shouldHideSaveViewOption:O}):null),[P,C,a,O,A]),J=(0,d().K8)((()=>{var e,t;if("page"===l||"form_editor"===l||c||!a.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0})||C&&!C.includes("addItem"))return null;const n=Ac().default.isVisible("collection_add_item_button_tooltip")&&!(null===(e=a.collectionStore())||void 0===e||!e.getWorkflowTemplateId())&&(null==a?void 0:a.isEmptyStore.state)&&!(0,o(338907).Tl)();return(0,S.jsx)(eh,{store:i,settingsHeaderSizeObserver:m,handleAddItemClick:v,isTooltipVisible:n,collectionModel:null===(t=a.collectionStore())||void 0===t?void 0:t.getModel()})}),[l,c,a,C,i,m,v]),ee=(0,d().K8)((()=>{var e;return(null===(e=i.inMemoryRecordCache)||void 0===e?void 0:e.isTemporaryData)??!1}),[i]),te=(0,n.useMemo)((()=>"form_editor"!==l||C&&!C.includes("formActionButtons")||ee?null:(0,S.jsx)(o(171559).Pe,{showCompactDesktopHeader:V,collectionContextStore:a})),[l,C,V,a,ee]),oe=(0,d().K8)((()=>null!=C&&C.includes("closeCollectionViewInModal")&&a.isUnlistedViewStore.state?(0,S.jsx)(Mg().YL,{}):null),[C,a]),ne=(0,d().K8)((()=>{const e=a.collectionViewStore(),t=a.collectionStore();return!(!e||!t)&&t.getSpaceId()!==e.getSpaceId()}),[a]),re=(0,d().K8)((()=>ne&&Io().default.checkGate({gateName:"collections_xws"})),[ne]);return k?(0,S.jsxs)(It().A,{visible:_,animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},style:{display:"flex",alignItems:"center"},children:[(0,S.jsx)(US,{}),re&&(0,S.jsx)(cu,{type:"linkedView"}),X,Q,J,te,Z]}):(0,S.jsxs)(It().A,{visible:_,animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},style:{display:"flex",alignItems:"center"},onMouseDown:F,children:[(0,S.jsx)(US,{}),re&&(0,S.jsx)(cu,{type:"linkedView"}),E,D,H&&(0,S.jsx)(Wo().A,{id:"no_date_count",collectionContextStore:a,reducer:H,resultStore:K}),W,N,$,U,Y,q,X,Q,Z,J,te,oe]})}const Kh=n.memo(zh);function Hh(e){const{currentViewType:t,store:r,isFullScreen:i,hideViewTabBar:l,collectionViewHeaderText:s,headerActionsBehavior:a,allowedActions:c,isInHomeWidget:m,isMyTasksPage:g,isHomeCustomDbPage:h,showHoverActionsStore:f,headerSizeObserver:v,isPlaceholderExternalCollection:x,handleEditorMouseDown:C,handleHeaderMouseMove:b,handleHeaderMouseLeave:w,handleHeaderMount:k,handleSettingsHeaderMount:T,leftRightPaddingStore:R,headerHeightStore:j,canEdit:A,contentSizeObserver:P,settingsHeaderSizeObserver:M,viewSettingsPlacementStore:B,showOnlyCurrentView:_,switchViewMetric:V,handleAddItemClick:F,timelineViewRef:O,createFilterSettingsStore:E,filterBarCreateFilterSettingsStore:D,headerWrapStyle:z,headerRef:K,headerStyleOverrides:H}=e,G=(0,Ae().X)("db_ux_simplification_next"),W=(0,Z().ET)(),N=(0,ue().Zp)(),$=(0,d().uB)(void 0,p().default),U=(0,d().K8)((()=>{if(g){return{type:"results",filter:{operator:"and",filters:[]},limit:1}}}),[g]),q=(0,d().uB)(void 0,p().default),Y=(0,d().K8)((()=>{if(h)return{type:"results",filter:{operator:"and",filters:[]},limit:1}}),[h]),X=(0,d().uB)(void 0,Oe().A),Q=(0,d().uB)(void 0,p().default.createClass({open:!1,stack:[]},{name:"createSortSettingsStore"})),J=(0,d().K8)((()=>{const e=W.viewIsFlushToTopbar();return("timeline"===t||"table"===t)&&e||m||W.isUnlistedViewStore.state||G}),[W,t,G,m]),ee=(0,d().K8)((()=>R.state),[R]),te=(0,d().K8)((()=>j.state),[j]),oe=(0,d().K8)((()=>{var e;return null===(e=W.viewsModuleContextStore)||void 0===e?void 0:e.isInLayoutBuilder()}),[W.viewsModuleContextStore]),ne=(0,u().IS)((e=>{let t;return t=J?{}:oe?{boxShadow:`0 0.5px 0 ${e.stroke.uiBlueSecondary}`,marginBottom:.5}:{boxShadow:`0 1px 0 ${e.tableDividerColor}`,marginBottom:1},{headerPositioningStyle:{left:null==ee?void 0:ee.paddingLeft,paddingLeft:m?_e().Fq:void 0,width:"100%"},headerStyle:{display:"flex",alignItems:"center",height:te,...t,left:null==ee?void 0:ee.paddingLeft,paddingLeft:m?_e().Fq:void 0,width:"100%",marginTop:G?2:void 0,...H},selectableStyle:{position:"relative"}}}),[te,H,J,G,m,oe,null==ee?void 0:ee.paddingLeft]),re=(0,d().K8)((()=>r.isNonEditableState()),[r]),ie=(0,d().K8)((()=>{var e;return G||"viewsMain"===(null===(e=W.viewsModuleContextStore)||void 0===e?void 0:e.getViewModuleType())}),[W.viewsModuleContextStore,G]),le=(0,d().K8)((()=>{var e,t,o;return!x&&!(null!=N&&N.hideViewBlockSource)&&W.shouldShowSourceStore.state&&!W.isUnlistedViewStore.state&&(null===(e=W.collectionStore())||void 0===e?void 0:e.canRead())&&"custom"!==(null===(t=W.collectionViewStore())||void 0===t?void 0:t.getType())&&"chat"!==(null===(o=W.collectionViewStore())||void 0===o?void 0:o.getType())}),[W,N,x]),se=(0,n.useCallback)((e=>{let{currentCollectionViewStore:t,newCollectionViewStore:o,openInNew:n}=e;if(t.id!==o.id&&!n){const e=t.getType(),n=o.getType();if(e&&n){var r;if(V)V.current={from:e,to:n,metric:Pe().default.DO_NOT_USE_markLegacy("collections.switch_view_lag"),sizeHintAtStart:null===(r=W.remoteResultStore.state)||void 0===r?void 0:r.sizeHint};"form_editor"===e&&W.isClientModeEnabledStore.setState(!1),"form_editor"===n&&I().os({collectionSettingsStore:W.settingsStore})}}}),[W.isClientModeEnabledStore,W.remoteResultStore,W.settingsStore,V]),ae=(0,n.useMemo)((()=>"hidden"===a?null:(0,S.jsx)(Kh,{showHoverActionsStore:f,isFullScreen:i,store:r,currentViewType:t,collectionContextStore:W,isPlaceholderExternalCollection:x,settingsHeaderSizeObserver:M,createFilterSettingsStore:E,createSortSettingsStore:Q,isInHomeWidget:m,handleAddItemClick:F,headerSizeObserver:v,timelineViewRef:O,allowedActions:c})),[a,f,i,r,t,W,x,M,E,Q,m,F,v,O,c]),ce=(0,n.useMemo)((()=>{if(!l)return(0,S.jsx)(VS,{collectionContextStore:W,showHoverActionsStore:f,isPlaceholderExternalCollection:x,showOnlyCurrentView:_??!1,onViewClick:se,disabled:g,variant:ie?"pills":"default"})}),[l,W,f,x,_,se,g,ie]);return(0,S.jsxs)(nt().s,{allowSelectionWithin:!0,style:z,onMouseDown:C,onMouseMove:b,onMouseLeave:w,ref:(0,y().Px)(k,K),children:[i&&(0,S.jsx)(no,{currentViewType:t,headerSizeObserver:v,contentSizeObserver:P,settingsHeaderSizeObserver:M,headerHeightStore:j,viewSettingsPlacementStore:B,store:r,leftRightPaddingStore:R,isInHomeWidget:m,headerRef:K}),ee&&(0,S.jsxs)(lt().A,{store:r,shouldShowCopyLinkButton:re,analyticsName:(0,L().LI)(t),style:ne.selectableStyle,shouldShowHalo:!(i||m||null!=N&&N.isPreviewing),children:[(0,S.jsxs)("div",{style:ne.headerStyle,ref:T,children:[ce,s,ae]}),U&&(0,S.jsx)(Wo().A,{id:"tasks_results",collectionContextStore:W,reducer:U,resultStore:$}),Y&&(0,S.jsx)(Wo().A,{id:"custom_db_results",collectionContextStore:W,reducer:Y,resultStore:q})]}),(0,S.jsxs)("div",{style:ne.headerPositioningStyle,dir:"ltr",children:[le&&(0,S.jsx)(o(872735).A,{store:r,collectionContextStore:W,isFullScreen:i,showHoverActionsStore:f,canEdit:A}),(0,S.jsx)(KS,{collectionContextStore:W}),(0,S.jsx)(Gh,{collectionContextStore:W,showHoverActionsStore:f,filterBarCreateFilterSettingsStore:D,saveControlMoreActionsButtonPopupStore:X,currentViewType:t,isInHomeWidget:m})]})]})}function Gh(e){let{collectionContextStore:t,showHoverActionsStore:o,filterBarCreateFilterSettingsStore:n,saveControlMoreActionsButtonPopupStore:r,currentViewType:i,isInHomeWidget:l}=e;const a=(0,s().v3)(),c=(0,s().WS)(),u=(0,d().K8)((()=>(0,Yt().J9)(a)),[a]),p=(0,d().O$)(t.filtersBarOpenStore),m=(0,d().O$)(t.shouldShowSourceStore),g=(0,d().O$)(t.completeSprintButtonContextStore),h=m?8:12;return"page"===i||"form_editor"===i||"feed"===i&&u||l?null:p?(0,S.jsx)(Dg().N9,{collectionContextStore:t,showHoverActionsStore:o,createFilterSettingsStore:n,saveControlMoreActionsButtonPopupStore:r}):g?(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",paddingBottom:c?12:8,paddingTop:h},children:[(0,S.jsx)("div",{style:{flex:1}}),(0,S.jsx)(LS().A,{collectionContextStore:t})]}):null}var Wh=()=>o(736316);class Nh extends p().default{getInitialState(){return{stage:"NOT_TRACKING"}}}function $h(e,t,o,r,i){const a=(0,s().v3)(),c=(0,d().uB)(void 0,Nh),u=(0,n.useRef)(0),p=(0,n.useRef)(t),m=(0,n.useRef)(),g=(0,n.useRef)(void 0),S=(0,n.useRef)(void 0),h=(0,n.useRef)(!0),f=(0,n.useRef)(!1),v=(0,n.useCallback)((()=>{"NOT_TRACKING"===c.state.stage&&(c.setState({stage:"COUNTING_VISIBLE_ITEMS",source:"INITIAL"}),g.current=performance.now())}),[c]),y=(0,n.useCallback)((e=>{"NOT_TRACKING"===c.state.stage&&(c.setState({stage:"COUNTING_VISIBLE_ITEMS",source:"NAVIGATION"}),e&&(m.current=e))}),[c]),x=(0,n.useCallback)((()=>{if(o.current)return;const t=c.state.stage;if("COUNTING_VISIBLE_ITEMS"===t){if(u.current++,1===u.current){const e=performance.now();l().default.afterNextFlush((()=>{"COUNTING_VISIBLE_ITEMS"===c.state.stage&&c.setState({stage:"SHOULD_TRACK",endTime:e,source:c.state.source})}))}}else"NOT_TRACKING"===t&&h.current&&(h.current=!1,Pe().default.DO_NOT_USE_measureFromPageOriginLegacy({metricName:"missed_database_items_visible",endTime:performance.now()},{environment:a,data:fe().ax({environment:a,collectionContextStore:e,visibleItemsCount:1,wasInitialRenderEmpty:f.current,isPrewarmedTab:(0,be().isPrewarmedTabInitialRender)(a),cvbLoadingStateOnInitialRender:i})}))}),[e,o,a,c,i]),C=(0,n.useCallback)((()=>{S.current||(S.current=performance.now())}),[]),w=(0,n.useCallback)((t=>{t.state&&"COUNTING_VISIBLE_ITEMS"===c.state.stage&&(f.current=!0,e.isEmptyStore.removeListener(w),x())}),[e.isEmptyStore,x,c]),k=(0,n.useCallback)((t=>{if(!o.current&&"SHOULD_TRACK"===t.state.stage){const o=(0,be().isPrewarmedTabInitialRender)(a),s=o?He().A.state.prewarmedTabAppStartTimeOverride:void 0,c=fe().ax({environment:a,collectionContextStore:e,visibleItemsCount:u.current||0,wasInitialRenderEmpty:f.current,isPrewarmedTab:o,cvbLoadingStateOnInitialRender:i});if("INITIAL"===t.state.source){var n,l;const i=(0,Ie().A)(null===(n=e.collectionViewStore())||void 0===n?void 0:n.id),d=null===(l=a.prefetchCache)||void 0===l?void 0:l.getPrefetchAnalytic(i),u={cvbBlockRenderStart:p.current,cvbBlockRenderMount:g.current,itemsStart:S.current,itemsVisible:t.state.endTime},m=function(e){const{subMetricsTimes:t}=e,{cvbBlockRenderStart:o,cvbBlockRenderMount:n,itemsStart:r,itemsVisible:i}=t,l={"collections.await_page_chunk_end_to_cvb_start":void 0,"collections.cvb_start_to_cvb_mount":void 0,"collections.cvb_mount_to_items_start":void 0,"collections.items_start_to_items_visible":void 0},{await_page_chunk_start_to_await_page_chunk_end:s}=He().A.state.subMetricsStore.state,a=t=>{let{startTime:o,endTime:n}=t;if(e.isPrewarmedTab){if(n<=e.prewarmedTabNavigationStart)return 0;if(o<e.prewarmedTabNavigationStart&&n>e.prewarmedTabNavigationStart)return n-e.prewarmedTabNavigationStart}return n-o};return o&&s&&(l["collections.await_page_chunk_end_to_cvb_start"]=a({startTime:s.endTime,endTime:o}),(0,Wh().f)({name:"collections.await_page_chunk_end_to_cvb_start",startTime:s.endTime,endTime:o})),o&&n&&(l["collections.cvb_start_to_cvb_mount"]=a({startTime:o,endTime:n}),(0,Wh().f)({name:"collections.cvb_start_to_cvb_mount",startTime:o,endTime:n})),n&&r&&(l["collections.cvb_mount_to_items_start"]=a({startTime:n,endTime:r}),(0,Wh().f)({name:"collections.cvb_mount_to_items_start",startTime:n,endTime:r})),r&&i&&(l["collections.items_start_to_items_visible"]=a({startTime:r,endTime:i}),(0,Wh().f)({name:"collections.items_start_to_items_visible",startTime:r,endTime:i})),l}(o&&"number"==typeof s?{subMetricsTimes:u,isPrewarmedTab:!0,prewarmedTabNavigationStart:s}:{subMetricsTimes:u,isPrewarmedTab:!1}),h={...c,sub_metrics:m,initial_render_timings:e.timingTracker.getMetrics(u),includes_page_origin_to_app_start:!0};r&&Pe().default.measureFromPageOrigin({metricName:"initial_database_items_visible",endTime:t.state.endTime},{environment:a,data:h,shouldSendIfStatsigNotInitialized:!0}),p.current&&(Pe().default.DO_NOT_USE_measureLegacy({metricName:"collections.initial_mount_to_items_visible",startTime:p.current,endTime:t.state.endTime},{environment:a,data:h,shouldSendIfStatsigNotInitialized:!0}),"hit-match"===(null==d?void 0:d.type)&&void 0!==d.finishedTimeMs&&d.finishedTimeMs>p.current&&Pe().default.DO_NOT_USE_measureLegacy({metricName:"collections.initial_mount_waiting_for_api",startTime:p.current,endTime:d.finishedTimeMs},{environment:a,data:c}))}else if("NAVIGATION"===t.state.source){if(m.current){const e={...c,wasm_sqlite_initialized:He().A.state.metricDataStore.state.wasm_sqlite_initialized,...Ne().A.getDatabaseNavigationMetrics(m.current)};Pe().default.DO_NOT_USE_measureLegacy({metricName:"collections.navigation_items_visible",startTime:m.current,endTime:t.state.endTime},{environment:a,data:e})}p.current&&Pe().default.DO_NOT_USE_measureLegacy({metricName:"collections.navigation_mount_to_items_visible",startTime:p.current,endTime:t.state.endTime},{environment:a,data:c})}else(0,b().ub)(t.state.source);t.setState({stage:"COMPLETED"}),u.current=0}}),[e,o,a,r,i]);return(0,n.useEffect)((()=>(c.addListener(k),()=>{c.removeListener(k)})),[k,c]),(0,n.useEffect)((()=>(e.isEmptyStore.addListener(w),()=>{e.isEmptyStore.removeListener(w)})),[e.isEmptyStore,w]),{handleInitialDatabaseRender:v,handleNavigationDatabaseRender:y,handleItemMount:x,handleItemsRenderStart:C}}function Uh(e){const{collectionContextStore:t,collectionViewBlockRenderStartTime:o,didDelayOffscreenRenderRef:n,mountedBeforeInitialPageRender:r,cvbLoadingStateOnInitialRender:i}=e,{handleInitialDatabaseRender:l,handleNavigationDatabaseRender:s,handleItemMount:a,handleItemsRenderStart:c}=$h(t,o,n,r,i);return t.databaseItemsVisibleTracker||(t.databaseItemsVisibleTracker={handleInitialDatabaseRender:l,handleNavigationDatabaseRender:s,handleItemMount:a,handleItemsRenderStart:c}),null}const qh=480,Yh=n.memo(n.forwardRef((function(e,t){const{store:g,isFullScreen:h,viewsModuleContext:w,overrideViewType:k,headerActionsBehavior:E="default",overridePaddingLeft:D,overridePaddingRight:z,fullWidth:K,headerText:H,hideViewTabBar:G,headerAllowedActions:W,maxHeight:N,disabled:$,forceLocalQueryCollection:U=!1,isUnlistedView:q,viewId:Y,onMount:X,setCollectionContextStore:Q,showOnlyCurrentView:J,additionalCollectionViewInnerHorizontalPadding:ee,templatePickerMenuListStore:te,mountedBeforeInitialPageRender:oe,cvbLoadingStateOnInitialRender:ie,editorContentContainerRef:le}=e,ae=(0,u().DP)(),ce=(0,s().WS)(),Le=(0,n.useRef)(null),Xe=(0,s().v3)(),Ze=(0,ue().Zp)(),Je=(null==Ze?void 0:Ze.isPreviewing)??!1,et=(0,n.useMemo)((()=>new(De().A)(Xe,Ze)),[Xe,Ze]),tt=(0,n.useContext)(pe().R),{didDelayOffscreenRenderRef:rt}=function(e){let{collectionContextStore:t,isFullScreen:r,rootRef:i}=e;const l=(0,n.useRef)(r),s=(0,n.useRef)(!1),a=(0,d().K8)((()=>o(735372).Ay.isOpen()),[]);return(0,n.useEffect)((()=>{if(!i.current)return;if(l.current)return;if(a)return l.current=!0,void t.shouldDelayRenderStore.setState(!1);if(!i.current.parentElement)return;const e=new IntersectionObserver((o=>{const n=!o.reduce(((e,t)=>t.time>e.time?t:e),o[0]).isIntersecting;n?s.current=!0:(l.current=!0,e.disconnect()),t.shouldDelayRenderStore.setState(n)}));return e.observe(i.current.parentElement),()=>e.disconnect()}),[t,a,i]),{didDelayOffscreenRenderRef:s}}({collectionContextStore:et,isFullScreen:h,rootRef:Le}),at=(0,d().uB)(void 0,o(505776).A),ct=(0,n.useMemo)((()=>new(qe().E)),[]),dt=(0,n.useMemo)((()=>new(qe().E)),[]),ut=(0,n.useMemo)((()=>new(qe().E)),[]),pt=(0,n.useRef)(null),mt=(0,n.useRef)(),gt=(0,n.useRef)(null),[St]=(0,n.useState)((()=>performance.now())),ht=(0,n.useRef)(new Map),ft=(0,n.useRef)(),vt=(0,n.useMemo)((()=>new ot(et,Xe)),[et,Xe]),yt=(0,n.useRef)(),xt=(0,n.useRef)(),Ct=(0,d().K8)((()=>et.collectionStore()),[et]),[bt,wt]=(0,n.useState)(!1),[kt,Tt]=(0,n.useState)(!1),[It,Rt]=(0,n.useState)(!1),jt=(0,d().uB)(void 0,p().default.createClass({open:!1,stack:[]},{name:"createFilterSettingsStore"})),At=(0,d().uB)(void 0,p().default.createClass({open:!1,stack:[]},{name:"filterBarCreateFilterSettingsStore"})),Pt=(0,d().uB)(void 0,p().default.createClass({open:!1,stack:[]},{name:"createSortSettingsStore"})),Mt=(0,d().uB)(void 0,p().default.createClass(void 0,{name:"viewSettingsPlacementStore"})),Bt=(0,d().uB)(void 0,Oe().A);(0,o(265793).b)(et);const _t=(0,n.useCallback)((()=>{var e;return k??(null===(e=et.collectionViewStore())||void 0===e?void 0:e.getType())}),[k,et]),Vt=(0,d().r6)((()=>(0,Te().cq)(g)),[g]),Ft=(0,d().O$)(Vt),Lt=(0,d().O$)(et.isInHomeWidgetStore),{isViewModule:Ot}=(0,d().K8)((()=>({isViewModule:!!et.viewsModuleContextStore.getViewModuleType()})),[et]),Et=(0,d().K8)((()=>(0,L().RX)(g)),[g]),Dt=(0,d().r6)((()=>{const e=(0,Ve().Uh)(Xe)-ke().x6;if(Et&&!h&&!(0,ke().Ck)(g,void 0,Xe)&&e>0&&!Lt)return e/2}),[Xe,Et,h,g,Lt]),zt=(0,d().O$)(Dt),Kt=(0,d().K8)((()=>{var e;return(null===(e=pt.current)||void 0===e?void 0:e.getStore().state.elementRef)??{current:null}}),[pt]),Ht=(0,n.useCallback)((e=>{var t,o;if(et.isInHomeWidgetStore.state)return;const n=et.normalizedFormatStore.state,r=null===(t=Kt.current)||void 0===t?void 0:t.clientWidth;et.frozoneStore.setState({isScrolled:!1,scrollerWidth:r,scrollerLeftOffset:(null==pt||null===(o=pt.current)||void 0===o||null===(o=o.getClientRect())||void 0===o?void 0:o.left)??0,scrollerLeftPadding:Dt.state,frozenIndex:null==e?void 0:e.getTableFrozenColumnIndex(r,n),tryShowHiddenFrozenColumn:!1})}),[et,Kt,Dt]),Gt=(0,d().K8)((()=>g.isRootOrDirectChild()),[g]),Wt=(0,d().K8)((()=>(0,de().dC)(Xe,g)),[Xe,g]),$t=(0,d().r6)((()=>{const e=_t(),t=(0,L().l0)({environment:Xe,store:g,isFullScreen:h,sizeObserver:ct,viewType:e,collectionContextStore:et});return t&&void 0!==D&&(t.paddingLeft=D),t&&void 0!==z&&(t.paddingRight=z),t&&Gt&&Wt&&(0,ke().Ck)(g,void 0,Xe)&&"page"!==e&&(t.paddingRight+=de().Qb),t}),[Xe,g,h,ct,_t,et,D,z,Gt,Wt]);(0,d().O$)($t);const Ut=(0,d().K8)((()=>{var e,t;const o=ee??0;return{paddingLeft:((null===(e=$t.state)||void 0===e?void 0:e.paddingLeft)??0)+o,paddingRight:((null===(t=$t.state)||void 0===t?void 0:t.paddingRight)??0)+o}}),[$t,ee]),qt=(0,n.useCallback)((e=>{const t=e.target;null!==t&&t instanceof HTMLElement&&(0,o(819121).p)(t)&&Rt(!0)}),[Rt]),Yt=(0,n.useCallback)((()=>{Rt(!1)}),[Rt]),Xt=(0,n.useCallback)((()=>{Ke().A.state||wt(!0)}),[wt]),Qt=(0,n.useCallback)((()=>{wt(!1)}),[wt]),Zt=(0,n.useCallback)((()=>{var e,t;if(Lt)return;const o=null===(e=pt.current)||void 0===e||null===(e=e.getNode())||void 0===e?void 0:e.getBoundingClientRect().width,n=et.frozoneStore.state.scrollerWidth,r=null===(t=pt.current)||void 0===t||null===(t=t.getNode())||void 0===t?void 0:t.getBoundingClientRect().left,i=et.frozoneStore.state.scrollerLeftOffset;if(o===n&&r===i)return;const l=et.collectionViewStore(),s=et.normalizedFormatStore.state;et.frozoneStore.update((e=>({...e,scrollerWidth:o,scrollerLeftOffset:r,scrollerLeftPadding:Dt.state,frozenIndex:null==l?void 0:l.getTableFrozenColumnIndex(o,s),tryShowHiddenFrozenColumn:!1})))}),[et,pt,Dt,Lt]),Jt=(0,n.useCallback)((()=>{var e,t;const o=null===(e=pt.current)||void 0===e||null===(e=e.getNode())||void 0===e?void 0:e.scrollLeft,n=null===(t=$t.state)||void 0===t?void 0:t.paddingLeft;if(void 0===o||void 0===n)return;const r=o>n;r!==et.frozoneStore.state.isScrolled&&(et.frozoneStore.setState({...et.frozoneStore.state,isScrolled:r}),Zt())}),[et,Zt,$t]),to=(0,n.useRef)(!1);!function(e){let{environment:t,collectionContextStore:o}=e;const r=(0,n.useCallback)((e=>{e.state.online||(0,V().M)(t,o,{src:"initial_load"})}),[t,o]);(0,a().l)((()=>{ze().A.state.online&&ze().A.addListener(r)})),(0,c().X)((()=>{ze().A.removeListener(r)}))}({environment:Xe,collectionContextStore:et}),(0,d().K8)((()=>{var e;const t=et.collectionViewStore(),n=et.collectionStore(),r=Xe.currentUser.id,i=null==t?void 0:t.id,l=null==n?void 0:n.id,s=g.getCollectionViewStores(),a=s.map((e=>e.id)),c=null!==(e=s[0])&&void 0!==e&&e.isDefined()?s[0]:void 0,d=g.id,u=f().A.get({userId:r,key:(0,ye().H6)(d)});let p;const m=e=>!!q||(!!a.includes(e)||"collectionSettings"===et.contextType);if(Y&&m(Y)?p=Y:t&&m(t.id)?p=t.id:u&&m(u)?p=u:c&&m(c.id)&&(p=c.id),p){const e=re().pS.createChildStore(t??g,{table:x().Gy,id:p});if(e.isDefined()){p!==u&&f().A.set({userId:r,key:(0,ye().H6)(d),value:p});const t=e.getCollectionStore();e&&(!to.current||p!==i||t&&t.id!==l)&&(to.current=!0,et.forceLocalQueryCollection=U,(0,o(559102).d)({environment:Xe,collectionViewBlockStore:g,collectionViewStore:e,collectionStore:t,collectionContextStore:et,isFullScreen:h??!1,isRootChild:g.isRootOrDirectChild(),isInPeekRenderer:Ft,viewsModuleContext:w}))}}}),[g,et,Xe,h,Ft,w,U,q,Y]),(0,d().K8)((()=>{void 0===et.frozoneStore.state.frozenIndex&&et.collectionViewStore()&&Ht(et.collectionViewStore())}),[et,Ht]);const oo=(0,n.useRef)(!1);(0,n.useEffect)((()=>(oo.current=!0,()=>{oo.current=!1})),[]);const ro=(0,n.useRef)(!0);(0,n.useEffect)((()=>{if(ro.current){const e=_t();e&&(i().A.withListenerIgnored((()=>{const t=et.collectionStore(),o=et.collectionViewStore(),n=null==o?void 0:o.getChartType(),r=null==o?void 0:o.getChartPlaceholderType();(0,ge().vd)(Xe,"database_visit",{collection_id:null==t?void 0:t.id,collection_view_id:null==o?void 0:o.id,collection_view_block_id:g.id,type:e,is_full_screen:h,is_peek:Vt.state,peek_mode:Ue().default.state.mode,database_visit_id:et.visitSessionId,chart_type:"placeholder"===n?r:n,is_chart_placeholder:"placeholder"===n})})),ro.current=!1)}}),[]);const{value:io}=(0,ne().fJ)(me().T.formulas);(0,n.useEffect)((()=>{(0,b().O9)(io)&&et.formulasCodeStore.setState(io)}),[io,et.formulasCodeStore]),(0,n.useEffect)((()=>{i().A.withListenerIgnored((()=>{const e=et.collectionViewStore();if(e&&"collectionTypedView"===et.contextType){const t=et.databaseType,o=_t();t&&o&&(0,ge().WU)(Xe,"type_aggregated_database_visit",`type_aggregated_database_visit-${t}`,60,{collection_view_id:e.id,collection_view_block_id:g.id,type:o,databaseType:t,is_my_tasks:(0,Be().NY)("myTasks")===g.id})}}))}),[]),(0,n.useEffect)((()=>{const e=Pe().default.DO_NOT_USE_markLegacy("collections.collection_view_block_render");Pe().default.DO_NOT_USE_measureAfterNextFlushLegacy(e,{environment:Xe,getData:()=>({...(0,fe().kz)(et),is_first_render:ro.current})})})),xt.current&&i().A.withListenerIgnored((()=>{if(!xt.current)return;const{from:e,to:t,metric:o,sizeHintAtStart:n}=xt.current;Pe().default.DO_NOT_USE_measureAfterNextFlushLegacy(o,{environment:Xe,getData:()=>{const o=(0,fe().kz)(et),{view_type:r,row_count_category:i,...l}=o;return{from:e,to:t,did_trigger_fetch:et.isLoadingStore.state,row_count_category:(0,fe().Cu)(n),...l}}}),xt.current=void 0})),(0,n.useEffect)((()=>{const e=()=>{if(!et.isLoadedStore.state||!oo.current||et.wasCreatedThisSessionStore.state||et.didFireLoadEventsStore.state)return;et.didFireLoadEventsStore.setState(!0);const e=Xe.RouterStore.state;let t;"page"===e.route.name&&(t=e.route.mobileData);const n=et.isFullScreenStore.state;if(n){var i;const e=null===(i=et.collectionViewStore())||void 0===i?void 0:i.getType();if(!He().A.state.initialRenderCompleted&&oe){var l;o(915086).setInitialRenderCompleted(),r().oh.hackyOffsetParsesCorrectly()||(0,ge().vd)(Xe,"luxon_hacky_offset_parses_correctly_false");const i=()=>{var n,r;const i=(0,fe().kz)(et),l=et.collectionViewStore(),s=null==l?void 0:l.id,a=(0,Ie().A)(s),c=et.requestBackend;return{...i,is_push:(null===(n=t)||void 0===n?void 0:n.isPush)??!1,collectionViewType:e,initial_route:Xe.RouterStore.state.initialRoute.name,prefetchCache:null===(r=Xe.prefetchCache)||void 0===r||null===(r=r.getPrefetchAnalytic(a))||void 0===r?void 0:r.type,cvb_loading_state:ie,wasm_sqlite_initialized:He().A.state.metricDataStore.state.wasm_sqlite_initialized,is_mobile_background_launch:(0,o(248566).A)(),collection_request_backend:c,sub_metrics:be().getSubMetricsAndMetricDataForTracking({isPrewarmedTab:!1}).sub_metrics,includes_page_origin_to_app_start:!0}};Pe().default.measureFromPageOriginAfterNextFlush("initial_database_render",{environment:Xe,getData:i,shouldSendIfStatsigNotInitialized:!0});const c=Mg().H6.CollectionViewBlock.getLoadingMetrics();var s,a;if(null!=c&&c.startedAt)Pe().default.DO_NOT_USE_measureLegacy({metricName:"collection_view_block_bundle_load_and_parse",startTime:c.startedAt,endTime:c.resolvedAt},{environment:Xe,data:{did_prefetch:"hit-match"===(null===(s=Xe.prefetchCache)||void 0===s||null===(s=s.getPrefetchAnalytic((0,Ie().A)(null===(a=et.collectionViewStore())||void 0===a?void 0:a.id)))||void 0===s?void 0:s.type),is_full_screen:n}});null===(l=et.databaseItemsVisibleTracker)||void 0===l||l.handleInitialDatabaseRender()}else{var c;const t=Ne().A.popTimings(),o=()=>({...(0,fe().kz)(et),wasm_sqlite_initialized:He().A.state.metricDataStore.state.wasm_sqlite_initialized,collectionViewType:e,...Ne().A.getDatabaseNavigationMetrics(null==t?void 0:t.navigationStart)});t&&Pe().default.DO_NOT_USE_measureAfterNextFlushLegacy({metricName:"navigation_database_render",startTime:t.navigationStart},{environment:Xe,getData:o}),We().A.state.isMeasuring&&We().A.update((e=>({...e,isMeasuring:!1}))),null===(c=et.databaseItemsVisibleTracker)||void 0===c||c.handleNavigationDatabaseRender(null==t?void 0:t.navigationStart)}}else{var d,u;if(oe)null===(d=et.databaseItemsVisibleTracker)||void 0===d||d.handleInitialDatabaseRender();else null===(u=et.databaseItemsVisibleTracker)||void 0===u||u.handleNavigationDatabaseRender()}};return et.isLoadedStore.addListener(e),e(),()=>{et.isLoadedStore.removeListener(e)}}),[et,Xe,oe,ie]),(0,d().K8)((()=>{for(const t of g.getCollectionViewStores())t.getValue();const e=et.collectionStore();if(e){e.getTemplatePageStores().map((e=>e.getValue()))}}),[g,et]),(0,n.useEffect)((()=>{const e=()=>!Ue().default.isCenterPeekOpen()&&$e().A.state.isVisible,t=()=>{e()&&vt.maybeProcessQueuedCollectionEmit("page_show")},o=()=>{e()&&vt.maybeProcessQueuedCollectionEmit("exit_peek")};return $e().A.addListener(t),Ue().default.addListener(o),()=>{$e().A.removeListener(t),Ue().default.removeListener(o)}}),[vt]),(0,n.useEffect)((()=>{const e=e=>{o(42120).bE({environment:Xe,sprintSettingsContext:e.state})};return et.sprintSettingsContextStore.addListener(e),()=>{et.sprintSettingsContextStore.removeListener(e)}}),[et,Xe]),(0,n.useEffect)((()=>{const e=async e=>{if(e.state){const e=et.collectionViewBlockStore(),t=et.collectionViewStore(),o=et.collectionStore();if(!e||!t||!o)return;await(0,V().M)(Xe,et,{src:"relative_variables_stale",queuedTimestamp:Date.now()})}};return et.relativeVariablesAreStaleStore.addListener(e),()=>{et.relativeVariablesAreStaleStore.removeListener(e)}}),[et,Xe,U]);const{contextType:lo,databaseType:so,remoteCollectionIds:ao}=(0,d().K8)((()=>({contextType:et.contextType,databaseType:et.databaseType,remoteCollectionIds:et.remoteCollectionIdsStore.state})),[et]);(0,n.useEffect)((()=>{if(ft.current)return;if("collectionTypedView"!==lo||!so)return;const e=new(st().C)(Xe,(0,v().aW)({spaceId:g.getSpaceId(),databaseType:so}),((e,t)=>{vt.handleCollectionEmit({src:"msg",passThroughData:t,shouldQueueCollectionEmit:Qh(g),isCollectionTypeChange:!0})}));e.subscribe(),ft.current=e;const t=ft.current;return()=>{t.unsubscribe()}}),[et,Xe,vt,g,lo,so]),(0,n.useEffect)((()=>{null==Q||Q(et)}),[Q,et]),(0,n.useEffect)((()=>{null==X||X(_t())}),[]),(0,d().K8)((()=>{var e;const t=et.frozoneStore.state.scrollerWidth,o=null===(e=et.collectionViewStore())||void 0===e?void 0:e.getTableFrozenColumnIndex(t,et.normalizedFormatStore.state);void 0===o||et.isInHomeWidgetStore.state||et.frozoneStore.setState({...et.frozoneStore.state,frozenIndex:o})}),[et]),(0,n.useEffect)((()=>{const e=e=>{const t=Array.from(ht.current.keys()??[]),o=C().R9(t,e),n=C().R9(e,t);for(const i of o){var r;null===(r=ht.current.get(i))||void 0===r||r.unsubscribe(),ht.current.delete(i)}for(const i of n){const e=new(st().C)(Xe,(0,v().eG)(i),((e,t)=>{vt.handleCollectionEmit({src:"msg",passThroughData:t,shouldQueueCollectionEmit:Qh(g),isCollectionTypeChange:!1})}));e.subscribe(),ht.current.set(i,e)}};if(Ct)e([Ct.id]);else if("collectionTypedView"===lo){e(ao??[]);const t=t=>{e(t.state)};return et.remoteCollectionIdsStore.addListener(t),()=>{et.remoteCollectionIdsStore.removeListener(t)}}}),[et.remoteCollectionIdsStore,vt,Ct,lo,Xe,ao,g]),(0,n.useEffect)((()=>{const e=ht.current;return()=>{if(e)for(const t of e.values())t.unsubscribe()}}),[]);const co=(0,n.useMemo)((()=>({onFocus:qt,onBlur:Yt,onMouseMove:Xt,onMouseLeave:Qt})),[qt,Yt,Xt,Qt]);(0,n.useEffect)((()=>{var e;const t=null===(e=pt.current)||void 0===e?void 0:e.getNode();return t&&(0,xe().P4)(t,"scroll",Jt),()=>{t&&(0,xe().Ol)(t,"scroll",Jt)}}),[Jt]),(0,n.useEffect)((()=>()=>{(0,o(436371).u)({collectionContextStore:et})}),[et]),(0,n.useEffect)((()=>()=>{ct.destroy(),dt.destroy(),ut.destroy()}),[ct,dt,ut]),(0,n.useEffect)((()=>()=>{var e;null==mt||null===(e=mt.current)||void 0===e||e.disconnect()}),[]),(0,o(892008).L)({collectionContextStore:et,isFullScreen:Boolean(h),wasCreatedThisSessionStore:et.wasCreatedThisSessionStore,environment:Xe,didDelayOffscreenRenderRef:rt}),(0,n.useEffect)((()=>{var e;const t=null===(e=et.collectionStore())||void 0===e?void 0:e.getFormat();if(!t)return;const o=et.settingsStore;"Jira"===t.external_collection_type&&t.synced_collection_external_url&&Ge().Ay.state.defaultExternalCollectionSetting&&(I().eM({collectionSettingsStore:o,source:Ge().Ay.state.defaultExternalCollectionSetting}),Ge().Ay.setState({...Ge().Ay.state,open:!1,defaultExternalCollectionSetting:void 0}))}),[et]);const uo=(0,d().r6)((()=>{var e;const t=null==Ct?void 0:Ct.isSyncedCollection(),o=!0===(null==Ct||null===(e=Ct.getFormat().sync_state)||void 0===e?void 0:e.syncing),n=Xe.device.isMobile;return Boolean(t&&o&&!n)}),[Ct,Xe]);(0,d().O$)(uo),(0,n.useEffect)((()=>{const e=async t=>{const n=await o(449506).callApi({eventName:"getExternalCollectionSyncState",environment:Xe,data:t});if("success"===n.type&&n.data.result){const o=n.data.result,r=et.numberChildrenReceivedStore,i=et.numberChildrenUnfurledStore;r.setState(o.numberChildrenReceived),i.setState(o.numberChildrenUnfurled),i.state/r.state<1&&(yt.current=setTimeout((async()=>{await e(t)}),1e4))}},t=async()=>{if(uo){const t=et.collectionStore(),o=null==t?void 0:t.getFormat().uri,n=null==t?void 0:t.getFormat().bot_id,r=null==t?void 0:t.id;if(!o||!n||!r)return;await e({uri:o,botId:n,collectionId:r})}};return uo.addListener(t),()=>{uo.removeListener(t),clearTimeout(yt.current)}}),[uo,et,Xe]);const po=(0,d().K8)((()=>et.collectionViewStore()),[et]),mo=(0,d().K8)((()=>{const e=_t();return"collectionSettings"===et.contextType?0:h?"timeline"===e?96:180:"timeline"===e||"gallery"===e?0:q?16:Ee().A.state}),[h,_t,q,et]),go=$||Boolean(null==Ze?void 0:Ze.disableAllPointerEvents),So=(0,je().bx)(g,go),ho=(0,d().K8)((()=>!!Ct&&(0,m().Qu)(Ct.getValue())),[Ct]),fo=(0,d().K8)((()=>(0,Se().sj)(g.id)),[g]),vo=(0,d().K8)((()=>(0,Se().Wu)(g.id)),[g]),yo=(0,d().K8)((()=>!!fo&&et.isEmptyStore.state),[fo,et]),xo=(0,d().K8)((()=>!!vo&&et.isEmptyStore.state),[vo,et]),Co=(0,d().K8)((()=>Lt&&fo&&0===et.collectionStoresStore.state.length&&et.isLoadedStore.state),[Lt,fo,et]),bo=(0,d().K8)((()=>Lt&&vo&&0===et.collectionStoresStore.state.length&&g.getCollectionViewStores().length<=1),[Lt,vo,et,g]),wo=(0,Ae().X)("workflow_container"),ko=(0,d().K8)((()=>wo&&g.isReady()&&0===g.getCollectionViewStores().length&&"collectionSettings"!==et.contextType),[wo,g,et]),To=(0,d().r6)((()=>{if(!Gt||!Wt||!(0,ke().Ck)(g,void 0,Xe)||g.isCollectionViewPageWithContent())return{marginLeft:void 0,marginRight:void 0};return{marginLeft:void 0,marginRight:-(de().Qb/2)}}),[Xe,Gt,Wt,g]);(0,d().O$)(To);const Io=(0,d().r6)((()=>{var e;if(Co||bo)return 0;const t="viewsMain"===(null===(e=et.viewsModuleContextStore)||void 0===e?void 0:e.getViewModuleType());return H||"hidden"!==E||!G?t?ve().WK:q||et.isInHomeWidgetStore.state?ve().nh:ve().Lq:0}),[Co,bo,et,H,E,G,q]);(0,d().O$)(Io);const Ro=(0,Ae().X)("db_ux_inline_db"),jo=(0,d().r6)((()=>{if(bt||kt||It||h)return!0;if("always_show"===E)return!0;if(Xe.device.isMobile)return!0;if("form_editor"===_t())return!0;if(et.settingsStore.state.open)return!0;if(et.searchOpenStore.state)return!0;if(Pt.state.open)return!0;if(jt.state.open)return!0;if(At.state.open)return!0;if(et.filterBarSortSettingsStore.state.open)return!0;if(Array.from(et.filterBarItemSettingsStoreMap.values()).some((e=>e.state.open)))return!0;return!!Bt.state.open||!!Ro}),[Xe.device,bt,kt,It,h,E,_t,et,Pt,jt,At,Bt,Ro]);(0,d().O$)(jo);const Ao=(0,n.useCallback)((e=>{if(!et.collectionViewBlockStore()||!(0,Ye().EF)(Xe))return;const t=et.isMultiSourceView;R().Ur({userAction:"CollectionViewBlock.handleAddItemClick",environment:Xe,collectionContextStore:et,collectionViewBlockStore:g,shouldCoerce:!0,templateStore:et.defaultPageTemplateStore.state,useCrdt:!0,showMoveTo:t,peekModeOverride:Lt?"center_peek":void 0,from:{createBlock:"cvb_add_item"}}),(0,T().X)({environment:Xe,collectionContextStore:et,action:"click_topbar_new_item"})}),[et,Xe,g,Lt]),Po=(0,n.useCallback)((e=>{const{device:t}=Xe,{target:o}=e;if(!po||t.isMobile||!(o instanceof HTMLElement))return;const n=_t();n&&0===e.button&&"form_editor"!==n&&(0,Ce().SQ)({event:e,context:Ce().y$.EditorMouseDown,callback:()=>{e.preventDefault(),A().jD({environment:Xe,target:o,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:"board"===n||"table"===n})}})}),[Xe,po,_t]),Mo=(0,n.useCallback)(((e,t)=>{(0,Ce().SQ)({event:e,context:Ce().y$.EditorClick,callback:()=>{if(Vt.state||j().Cx(Xe),"page"===t&&!(0,we().Zm)()){const{clientX:t,clientY:o,target:n}=e;l().default.afterNextFlush((()=>{B().createAndCommit({userAction:"CollectionViewBlock.PageView.click",environment:Xe,canUndo:!0,perform:e=>{M().editNearestBlockOrInsertIfAtBottomOfPage(Xe,{x:t,y:o,target:n instanceof Element?n:void 0},e)}})}))}}})}),[Xe,Vt]),Bo=(0,n.useMemo)((()=>C().sg(Zt,100)),[Zt]),_o=(0,n.useCallback)((()=>{Ke().A.state||Tt(!0)}),[Tt]),Vo=(0,n.useCallback)((()=>{Tt(!1)}),[Tt]),Fo=(0,n.useCallback)((e=>{e&&ct.observe(e)}),[ct]),Lo=(0,n.useCallback)((e=>{e&&ut.observe(e)}),[ut]),Oo=(0,n.useCallback)((e=>{e&&dt.observe(e)}),[dt]),Eo=(0,n.useCallback)((e=>{var t,o;const n=null==e||null===(t=e.getNode())||void 0===t?void 0:t.classList.contains(he().Dkd);pt.current=n?e:(null==tt?void 0:tt.horizontalScroller)||null;const r=et.collectionViewStore();Ht(r);const i=null===(o=pt.current)||void 0===o?void 0:o.getNode();"undefined"!=typeof ResizeObserver&&i&&(mt.current=new ResizeObserver(Bo),mt.current.observe(i)),pt.current?et.virtualizedModule.setHorizontalScrollerRefStore(pt):et.virtualizedModule.setHorizontalScrollerRefStore(void 0)}),[et,Bo,Ht,tt]),Do=(0,d().K8)((()=>{if("form_editor"!==_t()&&et.settingsStore.state.open&&"sidebar"===Mt.state&&!0!==o(184701).b.state.visible)return(0,S.jsx)("div",{style:{...$t.state,...To.state,borderTop:`1px solid ${ae.tableDividerColor}`,height:12}})}),[et,To,$t,ae,Mt,_t]),zo=(0,d().K8)((()=>{const e=null==Ct?void 0:Ct.getValue();return Boolean(e&&(0,m().SJ)(e))}),[Ct]),Ko=(0,d().K8)((()=>{var e;if(_t())return(0,_().B2)({blockStore:g,isFullScreen:Boolean(h),environment:Xe,collectionContextStore:et})?0:-((null===(e=$t.state)||void 0===e?void 0:e.paddingLeft)??0)}),[_t,g,h,$t,Xe,et]),[Ho,Go,Wo]=(0,d().K8)((()=>[et.normalizedSchemaStore.state,et.normalizedQueryStore.state,et.normalizedFormatStore.state]),[et]),No=(0,d().K8)((()=>{if("collectionTypedView"===et.contextType)return E;if("collectionSystemView"===et.contextType){const e=et.collectionViewStore(),t=null==e?void 0:e.getCollectionSource();return(0,o(737658).TR)(t)?"default":"hidden"}return!Ct||Ct&&!1===Ct.canRead()||!Ct.isDefined()?"hidden":E??"default"}),[et,Ct,E]),$o=(0,n.useRef)(null),Uo=(0,d().K8)((()=>{var e,t;const o=_t(),n=Et&&!Ue().default.isSidePeekOpeningStore.state&&!q,r=n?h?{paddingLeft:(null==$t||null===(e=$t.state)||void 0===e?void 0:e.paddingLeft)??0,paddingRight:16}:{paddingLeft:0,paddingRight:((null==$t||null===(t=$t.state)||void 0===t?void 0:t.paddingRight)??0)+16}:null==$t?void 0:$t.state,i=(0,Ve().Uh)(Xe),l=(0,ke().Ck)(g,void 0,Xe)||h?i:Math.min(ke().x6,i);return{headerWrapper:{minHeight:Io.state,paddingLeft:null==r?void 0:r.paddingLeft,paddingRight:null==r?void 0:r.paddingRight,width:K,position:"relative",left:-((null==r?void 0:r.paddingLeft)??0),flexShrink:0,...(h||Je||n)&&{position:"sticky",zIndex:86,left:0,width:!Et||!r||h||Je||q?void 0:l-r.paddingLeft/2},...g.isNonEditableState()&&{cursor:"default"},...To.state},content:{flexGrow:1,flexShrink:0,display:"flex",flexDirection:"column",position:"relative",...To.state,...!h&&!Je&&{...zt&&{marginLeft:-zt},maxHeight:N?N-Io.state:"inherit",...Lt&&et.isEditableHomeCollectionStore.state?(0,_e().V$)({isPhone:ce,theme:ae}):{},width:K,left:Ko}},contentInner:h||Je?{..."custom"===o&&{height:"100%"}}:{position:"relative",...Lt?{height:"100%",maxHeight:"inherit"}:{},..."custom"===o&&{height:"100%"}}}}),[et.isEditableHomeCollectionStore,Ko,Xe,K,Io,Je,h,Et,Lt,ce,q,To,$t,N,zt,g,ae,_t]),qo=(0,d().K8)((()=>{var e;if(ko)return(0,S.jsx)(Xh,{store:g});const t=_t();if(!(po&&Ho&&Go&&Wo&&t))return null;if(zo)return(0,S.jsx)(Z().RI,{value:et,children:(0,S.jsx)(nt().s,{allowSelectionWithin:!0,style:Uo.headerWrapper,onMouseDown:Po,onMouseMove:_o,onMouseLeave:Vo,onClick:Mo,ref:(0,y().Px)(Fo,Le),children:(0,S.jsx)(lt().A,{store:g,shouldShowHoverMenu:!0,analyticsName:(0,L().LI)(t),shouldShowHalo:!h&&!Je&&!Lt,canSelect:!(h||Je||Lt||Ot),children:(0,S.jsx)(o(361873).A,{store:g,style:{width:"auto"},disabled:!1})})})});if(bo)return(0,S.jsx)(Z().RI,{value:et,children:(0,S.jsx)("div",{ref:Le,...co,style:{display:"contents"},children:(0,S.jsxs)("div",{style:(0,_e().V$)({isPhone:ce,theme:ae}),ref:$o,children:[(0,S.jsx)("div",{style:{position:"relative"},children:(0,S.jsx)(no,{currentViewType:t,headerSizeObserver:ct,contentSizeObserver:ut,settingsHeaderSizeObserver:dt,headerHeightStore:Io,viewSettingsPlacementStore:Mt,store:g,leftRightPaddingStore:$t,isInHomeWidget:Lt,placementToOrigin:Fe().W.Right,alignmentToOrigin:Fe().C.Center,headerRef:$o})}),(0,S.jsx)(Me().Ww,{feature:"custom_db",onSetup:e=>{I().Ow({collectionContextStore:et,collectionSettingsStore:et.settingsStore,hideSettingsHeader:!0,ref:e,initialStack:[{type:"linkToDatabase",existingCollectionStore:Ct}]})}})]})})});const n=(0,S.jsx)(Eg,{store:g,collectionStore:Ct,collectionViewStore:po,viewType:t,isDisabled:go,isFullScreen:Boolean(h),isInPeekRenderer:Ft,isPreviewing:Je,isRootChild:Gt,paddingLeft:Ut.paddingLeft,paddingRight:Ut.paddingRight,paddingBottom:mo,headerSizeObserver:ct,timelineViewRef:gt,showHoverActionsStore:jo,handleAddItemClick:Ao,isPlaceholderExternalCollection:ho,isEmptyMyTasks:yo,isInFrameWhenSidePeekOpen:Et,query:Go,schema:Ho,format:Wo,isCustomDbEmptyState:bo,maxHeight:N,placementStore:Mt,templatePickerMenuListStore:te,editorContentContainerRef:le}),r=Co?n:(0,S.jsx)(eo,{store:g,paddingLeft:zt,isPreviewing:Je,isFullScreen:Boolean(h),currentViewType:t,isInPeek:Ft,isInHomeWidget:Lt,isUnlistedView:q,viewSettingsPlacementStore:Mt,format:Wo,isMyTasksEmpty:yo,isHomeCustomDbEmpty:xo,isInFrameWhenSidePeekOpen:Et,handleEditorMouseDown:Po,isRootOrDirectChild:Gt,leftRightPaddingStore:$t,paddingBottom:mo,handleHorizontalScrollerMount:Eo,handleEditorClick:Mo,children:n}),i=h?(0,y().Px)(Lo,Le):Lo,l=(0,S.jsx)("div",{style:Uo.contentInner,children:r}),s="page"===t&&Ot?(0,S.jsx)("div",{style:Uo.content,children:l}):"page"===t?(0,S.jsx)(o(261237).c,{disabled:!1,displayName:"CollectionViewPageContent",ref:i,style:Uo.content,children:l}):(0,S.jsx)(nt().s,{ref:i,allowSelectionWithin:!0,style:Uo.content,children:l});return(0,S.jsx)(Z().RI,{value:et,children:(0,S.jsx)(o(532564).Z,{value:at,children:(0,S.jsxs)("div",{ref:Le,...co,style:{display:"contents"},children:[h?void 0:(0,S.jsx)("div",{style:{position:"relative"},children:(0,S.jsx)(no,{currentViewType:t,headerSizeObserver:ct,contentSizeObserver:ut,settingsHeaderSizeObserver:dt,headerHeightStore:Io,viewSettingsPlacementStore:Mt,store:g,leftRightPaddingStore:$t,isInHomeWidget:Lt,headerRef:$o})}),(0,S.jsx)(se,{}),(0,S.jsx)(Nt,{isFullScreen:Boolean(h),leftRightPaddingStore:$t,leftRightMarginStore:To,overrideViewType:k}),(0,S.jsx)(Hh,{currentViewType:t,store:g,headerWrapStyle:Uo.headerWrapper,headerActionsBehavior:No,allowedActions:W,hideViewTabBar:G??!1,showHoverActionsStore:jo,headerSizeObserver:ct,isFullScreen:Boolean(h),isInHomeWidget:Lt,isMyTasksPage:fo,isHomeCustomDbPage:vo,isPlaceholderExternalCollection:ho,collectionViewHeaderText:H,handleEditorMouseDown:Po,handleHeaderMouseMove:_o,handleHeaderMouseLeave:Vo,handleHeaderMount:Fo,handleSettingsHeaderMount:Oo,leftRightPaddingStore:$t,headerHeightStore:Io,canEdit:So,viewSettingsPlacementStore:Mt,contentSizeObserver:ut,settingsHeaderSizeObserver:dt,handleAddItemClick:Ao,timelineViewRef:gt,filterBarCreateFilterSettingsStore:At,createFilterSettingsStore:jt,switchViewMetric:xt,showOnlyCurrentView:Boolean(J),headerRef:$o,headerStyleOverrides:{...q&&{paddingLeft:24,paddingRight:24,paddingTop:12}}}),"form_editor"===t?(0,S.jsx)(it().A,{capture:!0,allowSearch:!0,allowEsc:!0,allowUndo:!0,allowOpenLinkMenu:!0,allowBackspace:!0,allowMenuList:!0,render:e=>(0,S.jsx)("div",{...e,children:s})}):s,Do,(0,S.jsx)(Qe().DG,{collectionContextStore:et,paddingLeft:null===(e=$t.state)||void 0===e?void 0:e.paddingLeft}),(0,S.jsx)(Uh,{collectionContextStore:et,collectionViewBlockRenderStartTime:St,didDelayOffscreenRenderRef:rt,mountedBeforeInitialPageRender:oe,cvbLoadingStateOnInitialRender:ie})]})})})}),[Uo,_t,po,Ho,Go,Wo,zo,bo,g,Ct,go,h,Ft,Je,Gt,Ut.paddingLeft,Ut.paddingRight,mo,ct,jo,Ao,ho,yo,Et,N,Mt,te,Co,zt,Lt,q,xo,Po,$t,Eo,Mo,To,Lo,Io,et,ce,ae,at,co,ut,dt,k,No,W,G,fo,vo,H,_o,Vo,Fo,Oo,So,At,jt,J,Do,St,rt,oe,Ot,ko,le,ie]);return(0,je().NW)(g,t,(0,d().K8)((()=>({renderedType:"collection_view_page"===g.getType()?"collection_view_page":"collection_view",getBlockStore:()=>g,getNode:()=>Le.current,collectionContextStore:et,resetLeftScrollAfterFlush:()=>{l().default.afterNextFlush((()=>{var e;const t=null===(e=pt.current)||void 0===e?void 0:e.getNode();if(t){t.scrollLeft=0;const e=(0,Re().T8)(t);e&&(e.scrollLeft=0)}}))},handleCreated:()=>function(e,t){P().IU({environment:e}),l().default.afterNextFlush((()=>{const n=t.collectionStore(),r=t.collectionViewBlockStore(),i=t.settingsStore;if(!r)return;const l=r.getCollectionViewSourceCollectionStore();if(n&&(0,m().Qu)(n.getValue()))I().Ho({collectionSettingsStore:i});else if(l){(0,o(359454).P)({environment:e,collectionContextStore:t});const n=t.collectionViewStore();"form_editor"!==(null==n?void 0:n.getType())&&(I().Ow({collectionContextStore:t,collectionSettingsStore:i}),I().R8({collectionSettingsStore:i,item:{type:"createViewSource",existingCollectionStore:l,createdCollectionRecordPointerMap:void 0}}),"chart"===(null==n?void 0:n.getType())&&t.isCreatingNewChartCollectionStore.setState(!0))}else if(n){const l=null==t?void 0:t.collectionViewStore();l?(!function(e){const{collectionStore:t,collectionViewStore:o,collectionViewBlockStore:n,collectionContextStore:r,environment:i}=e,l=null==o?void 0:o.id,s=l?(0,F().v)(l):void 0,a=L().Mf({collectionStore:t,sourceCollectionViewBlockStore:n,currentCollectionViewBlockStore:n,currentCollectionViewStore:o,constraints:(0,F().v)(o.id)}).find((e=>{var t;return e.id===(null==s||null===(t=s.viewPointer)||void 0===t?void 0:t.id)}));a&&(0,O().U)({viewToDuplicateStore:a,collectionContextStore:r,collectionViewStore:o,environment:i})}({collectionStore:n,collectionViewStore:l,collectionViewBlockStore:r,collectionContextStore:t,environment:e}),I().Ow({collectionContextStore:t,collectionSettingsStore:i}),I().R8({collectionSettingsStore:i,item:{type:"duplicateExistingView"}})):(0,o(424599).M)({environment:e,collectionStore:n,collectionContextStore:t,collectionSettingsStore:i})}else{const e=null==t?void 0:t.collectionViewStore();let o;var s;if(e)o=null===(s=(0,F().v)(e.id))||void 0===s?void 0:s.viewSettingsStack;I().Ow({collectionContextStore:t,collectionSettingsStore:i,initialStack:o})}}))}(Xe,et)})),[g,et,Xe]),qo)})));function Xh(e){const{store:t}=e,r=(0,s().v3)(),i=(0,u().DP)(),l=(0,d().K8)((()=>t.canEdit()&&!t.isLocked()),[t]);return(0,n.useEffect)((()=>{"rendered"!==Le().default.state.renderPhase&&Le().default.setState({...Le().default.state,renderPhase:"rendered"})}),[]),(0,S.jsxs)("div",{style:{marginLeft:96,marginRight:96,marginBottom:180,borderTop:`1px solid ${i.accentColors.gray[100]}`,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:12,paddingTop:180},children:[h({width:48,height:48,color:i.accentColors.gray[200]}),l?(0,S.jsx)(rt().p,{style:{paddingLeft:12,paddingRight:12,paddingTop:8,paddingBottom:8,fontWeight:w().Wy.medium,fontSize:16,lineHeight:1.2,borderRadius:8,border:`1px solid ${i.accentColors.gray[100]}`},size:"lg",onClick:async()=>{(await Xe().oQ.workflowNavigationActions.load()).openWorkflowEditor({environment:r,navigationState:{type:"configure"}})},children:(0,S.jsx)(k().sA,{id:"CollectionViewBlock.workflowContainerSetup",defaultMessage:"Continue setup"})}):(0,S.jsx)("div",{style:{padding:8},children:(0,S.jsx)(o(554509).D,{styleName:"UIRegular-14px/Medium",colorName:"tertiary",children:(0,S.jsx)(k().sA,{id:"CollectionViewBlock.workflowContainerEmptyState",defaultMessage:"Empty app"})})})]})}function Qh(e){var t;return!$e().A.state.isVisible||!(!Ue().default.isCenterPeekOpen()||null!==(t=Ue().default.peekTargetStore.state)&&void 0!==t&&t.uiContains(e))}const Zh=Yh;class Jh extends n.Component{componentDidCatch(e){throw o(449412).lE("collections"),e}render(){const{collectionViewBlockRef:e,...t}=this.props;return(0,S.jsx)(Zh,{...t,ref:e})}}const ef=n.forwardRef(((e,t)=>(0,S.jsx)(Jh,{...e,collectionViewBlockRef:t})))},380048:(e,t,o)=>{o.d(t,{I:()=>r});o(296540);var n=o(474848);const r=(0,o(340498).wt)("chevronLeft",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M3.61816 8.06445C3.61816 8.29688 3.70703 8.49512 3.8916 8.67285L9.22363 13.8887C9.36719 14.0391 9.55859 14.1143 9.77734 14.1143C10.2217 14.1143 10.5703 13.7725 10.5703 13.3213C10.5703 13.1025 10.4814 12.9043 10.3311 12.7539L5.52539 8.06445L10.3311 3.375C10.4814 3.21777 10.5703 3.01953 10.5703 2.80078C10.5703 2.35645 10.2217 2.01465 9.77734 2.01465C9.55859 2.01465 9.36719 2.08984 9.22363 2.24023L3.8916 7.45605C3.70703 7.63379 3.625 7.83203 3.61816 8.06445Z"})})},381828:(e,t,o)=>{o.d(t,{K:()=>r});o(296540);var n=o(474848);const r=(0,o(340498).wt)("calendarDate31",{viewBox:"0 0 20 20",svg:(0,n.jsxs)("g",{children:[(0,n.jsx)("path",{d:"M7.565 10.164c0-.753-.429-1.246-1.104-1.246-.649 0-.87.467-.87 1.207v.13c-.077.013-.142.026-.22.026-.468 0-.805-.39-.805-1.052 0-1.012.935-1.908 2.713-1.908 1.584 0 2.596.805 2.596 2.116 0 .987-.843 1.636-1.674 1.804 1.558.17 2.207 1.052 2.207 2.13 0 1.843-1.39 2.803-3.531 2.803h-.052c-1.61 0-2.74-.662-2.74-1.687 0-.584.442-1.052 1.104-1.052.052 0 .104.013.156.013.13 1.052.857 1.48 1.584 1.48.7 0 1.194-.428 1.194-1.077v-.026c0-1.013-.87-1.117-2.181-1.246l-.208-1.22c1.22-.144 1.83-.494 1.83-1.195zm4.95 4.66v-6.05c-1.298.286-1.583-.285-1.44-.856.779-.13 2.804-.597 3.57-.818v7.776l1.415.286c0 .506-.299.805-.831.805-.442 0-1.467-.026-1.96-.026-.766 0-2.168.026-2.168.026a.851.851 0 01-.052-.299c0-.246.104-.493.441-.584l1.026-.26z"}),(0,n.jsx)("path",{d:"M16.664 0H3.334A3.333 3.333 0 000 3.334v13.332A3.333 3.333 0 003.334 20h13.332A3.333 3.333 0 0020 16.666V3.334A3.333 3.333 0 0016.666 0h-.002zm-.525 17.932H3.861a1.797 1.797 0 01-1.797-1.797V5.485h15.872v10.652c0 .993-.804 1.797-1.797 1.797v-.002z"})]})})},425981:(e,t,o)=>{o.d(t,{C:()=>r});var n=()=>o(941541);class r{constructor(e,t,o){this.listener=void 0,this.didEmit=void 0,this.lastValue=void 0,this.handleEmit=(e,t,o)=>{let n=!0;this.didEmit||(this.didEmit=!0,n=!1),this.lastValue===t?n=!1:this.lastValue=t,n&&this.onEmit(t,o)},this.environment=e,this.listenerEventKey=t,this.onEmit=o,this.didEmit=!1,this.lastValue=void 0}subscribe(){this.listener=n().Ay.addListener(this.listenerEventKey,void 0,this.handleEmit,void 0,this.environment)}unsubscribe(){this.listener&&n().Ay.removeListener(this.listener,this.environment)}}},430923:(e,t,o)=>{o.d(t,{DV:()=>s,l7:()=>l,y7:()=>i});var n=()=>o(645873);const r={CollectionNewViewsPopupComponent:new(n().O2)("CollectionNewViewsPopupComponent",(async()=>await Promise.all([o.e(23806),o.e(96346),o.e(36192),o.e(90409),o.e(63077),o.e(74562),o.e(95794),o.e(46414),o.e(8184),o.e(99353),o.e(52681),o.e(38664),o.e(24587),o.e(14518),o.e(17713),o.e(28271),o.e(17254),o.e(67435),o.e(34576),o.e(62620)]).then(o.bind(o,93709)))),CollectionLinkExistingModal:new(n().O2)("CollectionLinkExistingModal",(async()=>await Promise.all([o.e(23806),o.e(96346),o.e(36192),o.e(44711),o.e(53321),o.e(90825),o.e(90409),o.e(63077),o.e(74562),o.e(95794),o.e(46414),o.e(8184),o.e(99353),o.e(52681),o.e(38664),o.e(24587),o.e(14518),o.e(17713),o.e(28271),o.e(17254),o.e(4422),o.e(67435),o.e(5887),o.e(70769),o.e(97965),o.e(83210),o.e(26090),o.e(10596),o.e(99346),o.e(5287)]).then(o.bind(o,901226)))),ModalOverlayCollectionView:new(n().O2)("ModalOverlayCollectionView",(async()=>await Promise.all([o.e(84856),o.e(32413)]).then(o.bind(o,956436))))},i=(0,n()._h)(r.CollectionNewViewsPopupComponent,(e=>e.CollectionNewViewsPopupComponent)),l=(0,n()._h)(r.CollectionLinkExistingModal,(e=>e.CollectionLinkExistingModal)),s=(0,n()._h)(r.ModalOverlayCollectionView,(e=>e.ModalOverlayCollectionView))},442277:(e,t,o)=>{o.d(t,{B:()=>r});o(296540);var n=o(474848);const r=(0,o(340498).wt)("arrowRightSmaller",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M15.383 8.352a.877.877 0 01-.274.64l-5.156 5.14a.864.864 0 01-.617.266.831.831 0 01-.602-.234.795.795 0 01-.234-.586c0-.12.02-.232.063-.336a.912.912 0 01.187-.273l1.75-1.766 2.914-2.656.274.5-2.711.156H1.484c-.26 0-.471-.078-.632-.234a.851.851 0 01-.235-.617c0-.256.078-.461.235-.618a.856.856 0 01.632-.242h9.493l2.71.164-.273.508L10.5 5.5 8.75 3.727a.946.946 0 01-.188-.266.917.917 0 01-.062-.344c0-.234.078-.43.234-.586a.831.831 0 01.602-.234.79.79 0 01.328.07c.104.047.203.117.297.211l5.148 5.133a.877.877 0 01.274.64z"})})},455425:(e,t,o)=>{o.d(t,{A:()=>r});class n extends(()=>o(757695))().default{getInitialState(){return{justUnlocked:!1}}}const r=n},505776:(e,t,o)=>{o.d(t,{A:()=>r});class n extends(()=>o(757695))().default{constructor(){super(...arguments),this.updatePreviewState=e=>{this.update((t=>({...t,previewCanvasState:e(t.previewCanvasState)})))}}getInitialState(){return{chart:void 0,responsiveChartOptions:void 0,previewCanvasState:void 0,exportBackgroundColor:"gradient"}}}const r=n},545040:(e,t,o)=>{o.d(t,{z:()=>i});var n=()=>o(645873);const r=new(n().O2)("CollectionItemCover",(async()=>{const{CollectionItemCover:e}=await Promise.all([o.e(23806),o.e(79883)]).then(o.bind(o,513439));return{CollectionItemCover:e}})),i=(0,n()._h)(r,(e=>e.CollectionItemCover))},556148:(e,t,o)=>{o.d(t,{$u:()=>p,Dp:()=>a,Gd:()=>c,Hh:()=>h,Hl:()=>d,RT:()=>m,Xw:()=>S,Yg:()=>g,yA:()=>u});o(898992),o(672577),o(581454);var n=()=>o(519839),r=()=>o(38337),i=()=>o(405417),l=()=>o(695625),s=()=>o(236030);let a=function(e){return e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Up=2]="Up",e[e.Down=3]="Down",e}({});function c(e,t){const o=t.permissionScopesStore.state;return!e&&o.canEditContent}function d(e,t){let o=e;for(;null!==o;){if(o.classList.contains(t))return o;o=o.parentElement}}function u(e,t){const o=t?[t]:[];return(0,i().v2)(o[0],e)}function p(e,t){return(0,n().f5)({environment:t,collectionContextStore:e})?s().Fh:0}function m(e){let t=e;for(;null!==t&&!t.classList.contains(r().WvK);)t=t.parentElement;if(null===t)return;return{col:parseInt(t.getAttribute("data-col-index")??"0"),row:parseInt(t.getAttribute("data-row-index")??"0")}}function g(e,t,o,n){return{col:o.findIndex((e=>e.property===t)),row:n.findIndex((t=>e===t))}}function S(e,t){if(!t)return;const o=l().T.findSelectablesFromStore(e).map((e=>e.getNode())).find((e=>t.contains(e)));return o?o.getBoundingClientRect():void 0}function h(e){const t=e.state;return!t.isOpen||0===t.additionalStores.length}},643381:(e,t,o)=>{o.d(t,{l:()=>r});o(296540);var n=o(474848);const r=(0,o(340498).wt)("repeat",{viewBox:"0 0 16 14",svg:(0,n.jsx)("path",{d:"M1.185 7.317a.689.689 0 00.697-.704v-.601c0-1.19.806-1.942 2.064-1.942H9.23v1.573c0 .328.199.52.527.52a.66.66 0 00.403-.144l2.68-2.236c.253-.212.26-.547 0-.765L10.16.782A.62.62 0 009.757.64c-.328 0-.527.184-.527.52v1.53H4.05C1.875 2.69.48 3.9.48 5.875v.738c0 .397.308.704.705.704zm13.624-.649a.689.689 0 00-.698.704v.608c0 1.19-.806 1.942-2.064 1.942H6.763V8.35c0-.329-.199-.52-.527-.52a.66.66 0 00-.403.144l-2.68 2.242c-.26.212-.26.547 0 .759l2.68 2.242a.66.66 0 00.403.143c.328 0 .527-.191.527-.52v-1.544h5.181c2.174 0 3.569-1.21 3.569-3.179v-.745a.695.695 0 00-.704-.704z"})})},644187:(e,t,o)=>{o.d(t,{K:()=>r});o(296540);const n={viewBox:"0 0 20 20",svg:(0,o(474848).jsx)("path",{d:"M5.612 4.08A1.895 1.895 0 0 0 3.971 5.81l-.005.092.001 9.439-.864.053h-.035a.883.883 0 0 1-.571-.245.921.921 0 0 1-.28-.646V4.137c0-.88.683-1.61 1.562-1.665l10.187-.651a.755.755 0 0 1 .786.551.826.826 0 0 1 .03.175v.943l-9.133.583-.037.007Zm12.172 12.67a.779.779 0 0 1-.617.747c-.006 0-.013.003-.02.003l-11.045.681h-.034a.883.883 0 0 1-.571-.245.921.921 0 0 1-.28-.647l-.001-.03V6.072l.001-.047a.777.777 0 0 1 .67-.709c.01 0 .018-.003.027-.003l11.052-.706a.755.755 0 0 1 .786.551.824.824 0 0 1 .03.175l.002 11.418Zm-1.248-8.726a.388.388 0 0 0-.418-.393l-9.213.563c-.23.012-.439.177-.439.436v7.533c-.01.484.31.61.673.583L16 16.221l.002-.001c.466-.018.534-.374.534-.65V8.024Zm-7.35 2.458c-.429.026-.574.353-.573.856v.089c-.051.012-.094.023-.146.026-.309.02-.531-.232-.532-.682 0-.689.616-1.336 1.79-1.41 1.045-.064 1.714.441 1.715 1.333 0 .67-.556 1.147-1.104 1.296 1.028.05 1.458.624 1.459 1.357.001 1.254-.915 1.964-2.329 2.052l-.034.002c-1.063.066-1.809-.338-1.81-1.035 0-.397.29-.733.728-.76.035-.003.068.004.103.002.087.71.567.97 1.046.941.463-.029.788-.34.788-.782v-.018c0-.688-.575-.723-1.44-.757l-.138-.822c.805-.147 1.207-.41 1.207-.887 0-.512-.284-.83-.73-.801Zm3.864-.339c-.857.248-1.045-.129-.952-.523.514-.12 1.85-.521 2.356-.703l.006 5.289.934.136c0 .344-.197.56-.548.581-.291.018-.968.043-1.294.063-.505.031-1.43.107-1.43.107a.572.572 0 0 1-.035-.201c0-.168.068-.34.29-.416l.677-.219-.004-4.114Z"})},r=(0,o(340498).wt)("calendarDate31",n)},645099:(e,t,o)=>{o.d(t,{Ay:()=>S,LA:()=>g});o(296540);var n=()=>o(56366),r=()=>o(584262),i=()=>o(959013),l=()=>o(124311),s=()=>o(114641),a=()=>o(857783),c=()=>o(778417),d=()=>o(186445),u=()=>o(753199),p=()=>o(704152),m=o(474848);const g=33;const S=function(e){const{style:t,iconStyle:g,store:S,format:f,collectionContextStore:v,groupsPointer:y,incrementLimitsInRelatedGroups:x,isFullScreen:C}=e,b=(0,o(484714).v3)(),w=(0,n().K8)((()=>v.groupsStore.getGroupState(y)),[v,y]),k=(0,n().K8)((()=>(0,o(325383).Kk)({collectionContextStore:v,groupsPointer:y})),[v,y]),T=(0,n().O$)(v.isInHomeWidgetStore),I=(0,o(401497).IS)((e=>({homeContainer:{display:"flex",alignItems:"center",justifyContent:"center"},button:{display:"flex",alignItems:"center",justifyContent:"center",height:30,borderRadius:6,whiteSpace:"break-spaces",fontSize:14,...T?{textAlign:"center",width:"fit-content",marginLeft:12,marginBottom:0,padding:4}:{},...t},loadingContainer:{marginTop:1,marginLeft:8,marginRight:8},icon:{...h(e),...g},text:{color:e.lightTextColor,width:"100%",fontSize:T?14:void 0},hoveredStyle:{...k?{background:e.whiteButtonBackground}:{}}})),[T,t,k,g]),R=(0,n().K8)((()=>S.canEdit()),[S]);return w?T?(0,m.jsx)("div",{style:I.homeContainer,children:(0,m.jsx)(p().A,{onClick:e=>function(e,t,o){const n=e.metaKey||e.ctrlKey?"tab":void 0,i=(0,d().sj)(o.id)?r().y8.PersonalHomeTileTasks:r().y8.PersonalHomeTileCustomDb;a().uK({environment:t,store:o,pageVisitSource:i,openInNew:n})}(e,b,S),onMouseDown:u().tr,style:I.button,children:(0,m.jsx)("div",{style:I.text,children:(0,m.jsx)(i().sA,{id:"database.viewAllButtonTitle",defaultMessage:"View all"})})})}):(0,m.jsxs)(p().A,{onClick:e=>function(e,t,o,n,r,i){const a=o.groupsStore.getGroupState(n);if(!a)return;const d=a.reducerResultStore.state;(0,u().kV)(e),c().IU({environment:t}),d&&(0,s().H)({collectionContextStore:o,environment:t,incrementLimitArgs:{isFullScreen:i,currentResultCount:d.blockIds.length,groupsPointer:a.groupsPointer,incrementLimitsInRelatedGroups:r}});(0,l().K)(t)}(e,b,v,y,x,C),onMouseDown:u().tr,disabled:k,hoveredStyle:I.hoveredStyle,style:I.button,children:[(0,o(158359).P)(I.icon),(0,m.jsx)("div",{style:I.text,children:(0,m.jsx)(i().sA,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})}),k?(0,m.jsx)("div",{style:I.loadingContainer,children:(0,m.jsx)(o(331542).A,{size:"sm"})}):R&&(0,m.jsx)(o(316369).w,{collectionContextStore:v,format:f})]}):null};function h(e){return{width:14,height:14,marginLeft:4,marginRight:6,fill:e.lightIconColor}}},653252:(e,t,o)=>{o.d(t,{O:()=>r});o(296540);var n=o(474848);const r=(0,o(340498).wt)("collectionTimelineArrowRight",{viewBox:"0 0 9 7",svg:(0,n.jsx)("path",{d:"M9 3.4979C9 3.29214 8.90602 3.06959 8.7628 2.93521L5.88066 0.239352C5.71507 0.0839835 5.51368 3.13148e-07 5.32123 2.96324e-07C4.82894 2.53287e-07 4.51119 0.314937 4.51119 0.722256C4.51119 0.961608 4.62755 1.13797 4.77971 1.27654L5.80905 2.22975L6.43113 2.77145L5.52263 2.72945L0.863749 2.72945C0.344604 2.72945 -6.62078e-07 3.03599 -7.02459e-07 3.4979C-7.4284e-07 3.95981 0.344604 4.26635 0.863749 4.26635L5.52263 4.26635L6.43113 4.22436L5.80905 4.76605L4.77971 5.72346C4.62755 5.86623 4.51119 6.03839 4.51119 6.27774C4.51119 6.68506 4.82894 7 5.32123 7C5.51367 7 5.71507 6.91602 5.88513 6.76065L8.7628 4.06059C8.90602 3.92622 9 3.70366 9 3.4979Z"})})},735790:(e,t,o)=>{o.d(t,{M:()=>i});o(296540);var n=o(474848);const r={viewBox:"0 0 20 20",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M3 7.375h6.829a2.501 2.501 0 0 0 4.842 0H17a.625.625 0 1 0 0-1.25h-2.329a2.501 2.501 0 0 0-4.842 0H3a.625.625 0 1 0 0 1.25M12.25 5.5a1.25 1.25 0 1 1 0 2.5 1.25 1.25 0 0 1 0-2.5"}),(0,n.jsx)("path",{fillRule:"evenodd",d:"M7.75 15.75a2.5 2.5 0 0 0 2.421-1.875H17a.625.625 0 1 0 0-1.25h-6.829a2.5 2.5 0 0 0-4.842 0H3a.625.625 0 1 0 0 1.25h2.329A2.5 2.5 0 0 0 7.75 15.75m0-1.25a1.25 1.25 0 1 0 0-2.5 1.25 1.25 0 0 0 0 2.5",clipRule:"evenodd"})]})},i=(0,o(340498).wt)("sliders",r)},766558:(e,t,o)=>{o.d(t,{j:()=>r,y:()=>i});var n=()=>o(284371);function r(e){const{theme:t,isInHomeWidget:o}=e;return{display:"flex",alignItems:"center",fontSize:14,padding:6,...o?{height:24,width:24,color:t.lightTextColor,fill:t.lightIconColor}:{height:28,width:28,color:t.mediumIconColor,fill:t.mediumIconColor},fontWeight:n().Wy.regular,lineHeight:1,borderRadius:6}}function i(e){const{theme:t}=e;return{display:"flex",alignItems:"center",fontSize:14,height:28,padding:6,color:t.mediumIconColor,fontWeight:n().Wy.regular,lineHeight:1,borderRadius:6}}},782473:(e,t,o)=>{o.d(t,{Nu:()=>l,Sw:()=>n,gO:()=>r,j$:()=>i});const n=220,r=24,i=-7,l=-3},812119:(e,t,o)=>{o.d(t,{J:()=>l});o(296540);var n=()=>o(401497),r=()=>o(710149),i=o(474848);function l(e){const{widthPercentage:t,isInHomeWidget:o}=e,l=(0,n().IS)((e=>({rowContainer:{display:"flex",height:30,alignItems:"center",gap:1,alignSelf:"stretch"},circleShimmer:{width:o?12:16,height:o?12:16,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmer:{width:t||"35%",height:10,flexShrink:0,borderRadius:12,marginLeft:2,backgroundColor:e.lightDividerColor},column:{display:"flex",height:34,padding:"7px 0px",alignItems:"center",gap:6,flex:"1 0 0"}})),[t,o]);return(0,i.jsx)("div",{style:l.rowContainer,children:(0,i.jsxs)("div",{style:l.column,children:[(0,i.jsx)(r().A,{style:l.circleShimmer}),(0,i.jsx)(r().A,{style:l.rowShimmer})]})})}},833880:(e,t,o)=>{o.d(t,{S4:()=>y,Sn:()=>h,j2:()=>S,kc:()=>g,oq:()=>v});o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(354520),o(803949),o(581454);var n=()=>o(244641),r=()=>o(410486),i=()=>o(597777),l=()=>o(604995),s=()=>o(416504),a=()=>o(792071),c=()=>o(496603),d=()=>o(186445),u=()=>o(338931),p=()=>o(909470),m=()=>o(508496);(0,o(959013).YK)({week:{defaultMessage:"Week",id:"calendar.viewRanges.week"},month:{defaultMessage:"Month",id:"calendar.viewRanges.month"}});function g(e){return!1===e.isDragging}function S(e){const{collectionContextStore:t}=e,o=t.collectionViewStore();if(!o)return;const n=t.normalizedSchemaStore.state,r=o.getQuery(n);if(!r||!r.calendar_by)return;const i=t.dateRangeStartStore.state,a=t.dateRangeEndStore.state,c=(0,l().p6)(i,(0,s().P)()),d=(0,l().p6)(a,(0,s().P)());return f({calendarBy:r.calendar_by,dateRangeStartDate:c,dateRangeEndDate:d})}function h(e){const{collectionContextStore:t,startOfDay:o}=e,r=t.collectionViewStore();if(!r)return;const i=t.normalizedSchemaStore.state,a=r.getQuery(i);if(!a||!a.calendar_by)return;const c=n().c9.fromMillis(o).endOf("day").valueOf(),d=(0,l().p6)(o,(0,s().P)()),u=(0,l().p6)(c,(0,s().P)());return f({calendarBy:a.calendar_by,dateRangeStartDate:d,dateRangeEndDate:u})}function f(e){const{dateRangeStartDate:t,dateRangeEndDate:o,calendarBy:n}=e;return{type:"results",filter:{operator:"and",filters:[{property:n,filter:{operator:"date_is_on_or_after",use_end:!0,value:{type:"exact",value:t}}},{property:n,filter:{operator:"date_is_on_or_before",value:{type:"exact",value:o}}}]},limit:5e3}}function v(e){var t;const{collectionContextStore:o,results:n,getRecordValue:r,intl:a,formulasModule:p}=e,m=o.collectionViewStore(),g=o.normalizedQueryStore.state,S=o.normalizedSchemaStore.state,h=g?g.calendar_by:void 0,f=o.dateRangeStartStore.state,v=o.dateRangeEndStore.state,C=(null===(t=o.collectionViewStore())||void 0===t?void 0:t.getFormat().calendar_show_weekends)??!0,b=d().XX.state,w=(0,s().P)(),k=o.getCurrentUserId();if(!(m&&g&&h&&S))return;const T=new Map,I=new Map,R=c().oE(n.map((e=>y({blockStore:e,calendarBy:h,schema:S,getRecordValue:r,userId:k,intl:a,resultCache:T,regExpCache:I,formulasModule:p})))),j={};n.forEach(((e,t)=>{j[e.id]=t}));0===(g.sort||[]).length&&R.sort(((e,t)=>{const o=e.start.valueOf(),n=t.start.valueOf();if(o===n){return j[e.id]-j[t.id]}return o-n}));const A=C?(0,l().iB)(f,b,w):(0,l().J0)(f,b,w),P=C?(0,l().hp)(v,b,w):(0,l().EK)(v,b,w);let M=A;const B=[];do{const e=C?(0,l().hp)(M.valueOf(),b,w):(0,l().EK)(M.valueOf(),b,w),t={},o=R.filter((t=>(0,i().m6)(M.valueOf(),e.valueOf(),t.start.valueOf(),t.end?t.end.valueOf():void 0))).map((o=>{const{id:n,start:r,end:i,includeTime:l,timeZone:s}=o,{startColumn:a,columnCount:c}=(0,u().Gj)({startUnixTimestampMS:r.valueOf(),endUnixTimestampMS:i?i.valueOf():void 0,startOfWeekUnixTimestampMS:M.valueOf(),endOfWeekUnixTimestampMS:e.valueOf()}),d=x(a,c,t);return{id:n,start:r.valueOf(),end:i?i.valueOf():void 0,row:d,includeTime:l,timeZone:s}}));B.push({start:M.valueOf(),end:e.valueOf(),items:o}),M=C?(0,l().iB)(M.plus({week:1}).plus({hour:25}).valueOf(),b,w):(0,l().J0)(M.plus({week:1}).plus({hour:25}).valueOf(),b,w)}while(M<P);return B}function y(e){const{blockStore:t,calendarBy:o,schema:n,getRecordValue:i,intl:c,userId:d,resultCache:u,regExpCache:g,formulasModule:S}=e,h=t.getAssociatedCollectionStore(),f=t.getModel();if(!f)return;const v=(0,r().d2)({property:o,schema:n,block:f,getRecordModel:a().b4_.fromGetRecordValueFn(i),propertyMapping:null==h?void 0:h.getPropertyMapping(),collectionRequestContext:{userId:d,userTimeZone:(0,s().P)(),depth:0,intl:c,visitedProperties:new Set,resultCache:u,regExpCache:g,experimentService:m().default,collectionFeatureGates:(0,p().i)()},formulasModule:S}).next().value;if("date"!==(null==v?void 0:v.type))return;const y=v.value;if(!y)return;const x=(0,l().AA)(y,(0,s().P)());if(!x)return;return{id:f.id,start:x.start,end:x.end,includeTime:"datetime"===y.type||"datetimerange"===y.type,timeZone:"datetime"===y.type||"datetimerange"===y.type?y.time_zone:void 0}}function x(e,t,o){let n=0;for(;;){let r=!1;for(let i=0;i<t;i++)C(o,e+i,n)&&(r=!0);if(!r)break;n++}for(let r=0;r<t;r++)b(o,e+r,n);return n}function C(e,t,o){return Boolean(e[o]&&e[o][t])}function b(e,t,o){e[o]||(e[o]={}),e[o][t]=!0}},845094:(e,t,o)=>{o.d(t,{DG:()=>l,lC:()=>i});var n=()=>o(645873);const r={postInstallTourTooltip:new(n().O2)("workflowTemplateTourTooltip",(()=>o.e(99013).then(o.bind(o,901175)))),onboardingPills:new(n().O2)("onboardingPills",(()=>o.e(96431).then(o.bind(o,191294))))},i=(0,n()._h)(r.postInstallTourTooltip,(e=>e.WorkflowTemplateTourTooltip)),l=(0,n()._h)(r.onboardingPills,(e=>e.PostInstallPills))},860118:(e,t,o)=>{o.d(t,{T:()=>r});var n=()=>o(713998);function r(e){const{block:t,property:o,schema:r,getRecordModel:i,userId:l,userTimeZone:s,intl:a,experimentService:c,collectionFeatureGates:d,formulasModule:u}=e;if(!t)return!1;if("title"===o)return!1;const p=r[o];return!(!p||"checkbox"!==p.type)||(!(!p||"button"!==p.type)||(!(!p||"status"!==p.type)||!n().r8({property:o,schema:r,block:t,getRecordModel:i,userId:l,userTimeZone:s,intl:a,experimentService:c,collectionFeatureGates:d,formulasModule:u})))}},881915:(e,t,o)=>{o.d(t,{X:()=>r});o(296540);var n=o(474848);const r=(0,o(340498).wt)("collectionTimelineArrowLeft",{viewBox:"0 0 9 7",svg:(0,n.jsx)("path",{d:"M0 3.5021C0 3.70786 0.0939831 3.93041 0.237195 4.06479L3.11934 6.76065C3.28493 6.91602 3.48633 7 3.67877 7C4.17106 7 4.48881 6.68506 4.48881 6.27774C4.48881 6.03839 4.37245 5.86203 4.22029 5.72345L3.19095 4.77025L2.56887 4.22855L3.47737 4.27055L8.13625 4.27055C8.6554 4.27055 9 3.96401 9 3.5021C9 3.04019 8.6554 2.73365 8.13625 2.73365L3.47737 2.73365L2.56887 2.77564L3.19095 2.23395L4.22029 1.27654C4.37245 1.13377 4.48881 0.961608 4.48881 0.722255C4.48881 0.314937 4.17106 0 3.67877 0C3.48633 0 3.28493 0.0839832 3.11487 0.239352L0.237195 2.93941C0.0939831 3.07378 0 3.29634 0 3.5021Z"})})},888325:(e,t,o)=>{function n(e){return`${e.table}:${e.id}`}o.d(t,{_:()=>n})},996624:(e,t,o)=>{o.d(t,{a:()=>r});o(296540);var n=o(474848);const r=(0,o(340498).wt)("doubleChevronRight",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M2.25781 14.1211C2.47656 14.1211 2.66797 14.0391 2.81836 13.8887L8.14355 8.67969C8.32812 8.49512 8.41699 8.29688 8.41699 8.06445C8.41699 7.8252 8.32812 7.62012 8.14355 7.44922L2.81836 2.24023C2.66797 2.08984 2.4834 2.00781 2.25781 2.00781C1.81348 2.00781 1.46484 2.35645 1.46484 2.80078C1.46484 3.0127 1.55371 3.21777 1.7041 3.375L6.50977 8.05762L1.7041 12.7539C1.55371 12.9043 1.46484 13.1094 1.46484 13.3281C1.46484 13.7725 1.81348 14.1211 2.25781 14.1211ZM8.36914 14.1211C8.58789 14.1211 8.77246 14.0391 8.92285 13.8887L14.2549 8.67969C14.4395 8.49512 14.5283 8.29688 14.5283 8.06445C14.5283 7.8252 14.4326 7.62012 14.2549 7.44922L8.92285 2.24023C8.77246 2.08984 8.58789 2.00781 8.36914 2.00781C7.9248 2.00781 7.56934 2.35645 7.56934 2.80078C7.56934 3.0127 7.66504 3.21777 7.81543 3.375L12.6211 8.05762L7.81543 12.7539C7.66504 12.9043 7.56934 13.1094 7.56934 13.3281C7.56934 13.7725 7.9248 14.1211 8.36914 14.1211Z"})})}}]);