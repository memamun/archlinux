"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[51466],{3031:(e,n,t)=>{t.r(n),t.d(n,{RemoveAddOnModal:()=>V});t(16280);var r=t(296540),o=()=>t(662303),i=()=>t(484714),u=()=>t(56366),c=()=>t(869190),s=()=>t(206267),a=()=>t(762433),d=()=>t(47273),l=()=>t(323063),f=()=>t(786508),p=()=>t(166386),y=()=>t(959013),g=()=>t(496603),v=()=>t(252105),m=()=>t(436572),h=()=>t(58293),b=()=>t(224701),w=()=>t(749356),_=()=>t(807778),I=()=>t(972418),S=()=>t(231127),x=()=>t(129476),A=()=>t(30265),O=t(474848);function V(e){let{currentPeriodEnd:n,isOpen:t,onClose:g}=e;const S=(0,i().v3)(),[V,C]=r.useState("survey"),[j,T]=r.useState({reasons:[],reasonOther:void 0,reasonOtherTools:void 0}),[B,R]=r.useState(void 0),[M]=r.useState(s().JW());(0,r.useEffect)((()=>v().u4(S,{name:"churn_survey",args:{churnType:"ai",reasons:j.reasons,reasonOther:j.reasonOther,reasonOtherTools:j.reasonOtherTools,stage:V,churnSurveyId:M}})),[S,V,j,M]);const k=(0,h().r)(),q=Boolean((0,u().K8)((()=>null==k?void 0:k.canAdmin()),[k])),D=(0,I().lh)({spaceId:null==k?void 0:k.id}),$=(0,u().K8)((()=>(0,a().Rz)(D)),[D]),F=(0,a().qd)({billingData:D,canUpdateBilling:q}),Q=n?(0,c().W_)(n,"long",o().locale):void 0,U=r.useCallback((()=>{v().u4(S,{name:"churn_survey_close",args:{churnSurveyId:M}}),g()}),[M,S,g]);return(0,O.jsx)(A().W,{step:V,isOpen:t,onClose:U,children:(()=>{switch(V){case"survey":return(0,O.jsx)(x().lU,{options:E(),onSubmit:async e=>{v().u4(S,{name:"churn_survey_submitted",args:{churnType:"ai",reasons:e.reasons,reasonOther:e.customTextByReason.other??void 0,reasonOtherTools:e.customTextByReason.using_another_ai_service??void 0,stage:V,churnSurveyId:M}}),T((n=>({...n,reasons:e.reasons,reasonOther:e.customTextByReason.other??void 0,reasonOtherTools:e.customTextByReason.using_another_ai_service??void 0})));const n=await w().z6(S,{spaceId:null==k?void 0:k.id,offerCampaign:"ai_fifty_percent_downgrade"}),t=(0,f().RS)(n);return t&&(0,p().J5)(t)?(R(t),void C("offer")):C("downgrade")}});case"offer":return B?(0,O.jsx)(x().hL,{currentProduct:"ai",secondaryButtonMessage:(0,O.jsx)(y().sA,{id:"removeAddOnModal.cancelAnyway",defaultMessage:"Cancel anyway"}),newProduct:"free",coupon:B,onSubmit:async e=>{if(e){v().u4(S,{name:"offer_accepted",args:{coupon:B}});const e=null==k?void 0:k.id;if($&&e&&F&&(0,p().J5)(B))return(0,_().S7)()?await w().VY({environment:S,spaceId:e,offerCampaign:"ai_fifty_percent_downgrade",entrypoint:"ai_downgrade_flow"}):await w().Qm(S,{customerId:$,coupon:B,offerType:"add_on_downgrade_flow"}),U(),void m().D6({label:(0,O.jsx)(y().sA,{id:"applyCoupon.success",defaultMessage:"Coupon successfully applied"})})}C("downgrade")}}):void C("downgrade");case"downgrade":return(0,O.jsx)(x().kv,{title:(0,O.jsx)(y().sA,{id:"addOnCancellationStep.cancellation.title",defaultMessage:"Remove AI at the end of your billing period?"}),description:Q?(0,O.jsx)(y().sA,{id:"addOnCancellationStep.cancellation.description",defaultMessage:"If you continue with the downgrade, you will continue to enjoy Notion AI until the end of your billing period on <bold>{periodEnd}</bold>. You can resubscribe anytime.",values:{periodEnd:Q,bold:e=>(0,O.jsx)("b",{children:e})}}):null,onSubmit:async()=>{if(v().u4(S,{name:"continue_downgrade_button_clicked"}),D&&k){const e=(0,a().lQ)(D),n=(0,l().gL)(e,"ai");await(0,b().nV)({environment:S,spaceStore:k,from:"billing_page",desiredState:n})}C("confirmation")}});case"confirmation":if(D){const e=(0,a().lQ)(D);if(Boolean((0,d().yp)(e,"ai")))throw new Error("Notion AI is not cancelled or scheduled to be cancelled")}return(0,O.jsx)(x().Qe,{title:(0,O.jsx)(y().sA,{id:"downgradeFlow.confirmationStep.ai.title",defaultMessage:"Notion AI has been removed"}),formattedPeriodEndDate:Q})}})()})}function E(){return[...(0,g().k4)([S().V.tooExpensive,S().V.missingFeatures,S().V.upgradedByMistake,S().V.tooDifficult,S().V.notUsingEnough,S().V.qualityOfResults,S().V.usingAnotherAiService,S().V.dataSecurity]),S().V.other]}},47273:(e,n,t)=>{t.d(n,{DS:()=>o,Fe:()=>a,GB:()=>u,Gf:()=>l,V_:()=>d,j1:()=>s,j8:()=>i,yp:()=>f,yw:()=>c});var r=()=>t(762433);function o(e){return(0,r().Fq)({subscription:e})}function i(e){return(0,r().Ry)({subscription:e})}function u(e){let{subscriptionState:n,logFunction:t,spaceId:o}=e;return(0,r().yB)({billingData:{subscription:n},logFunction:t,spaceId:o})}function c(e){return(0,r().q8)({subscription:e})}function s(e){return(0,r().V9)({subscription:e})}function a(e){return(0,r().d$)({subscription:e})}function d(e){return(0,r().ji)({subscription:e})}function l(e){return(0,r().AI)({subscription:e})}function f(e,n){return(0,r().KH)({subscription:e},n)}},323063:(e,n,t)=>{t.d(n,{HO:()=>f,V5:()=>c,Vr:()=>s,gL:()=>a,qq:()=>l,vH:()=>d,z2:()=>p});t(16280),t(898992),t(354520),t(672577),t(581454),t(737550);var r=()=>t(720665),o=()=>t(762433),i=()=>t(47273),u=()=>t(979340);function c(e,n){return f(e.items,n.items).some((e=>{let[n,t]=e;return function(e,n){if(!e)return!1;if(!n)return!0;const t=o().xp(e),r=o().xp(n);if(!t||!r)return!1;return u().o3[t]>u().o3[r]}(n,t)}))}function s(e,n,t){let{trialEnd:r,items:o}=n;const i=o.map((n=>{const r=n.price.product,o=n.price.unitAmount.currencyCode,i=function(e,n){let{interval:t,product:r,currency:o}=n;const i=e.find((e=>e.product===r&&e.billingInterval===t&&e.unitAmount.currencyValue.currencyCode===o));return y(i,`Unable to find price with interval: ${t}, product: ${r}, currency: ${o}`)}(e,{interval:t,product:r,currency:o});return{...n,price:i}}));return{trialEnd:r,items:i}}function a(e,n){const t=e.items.filter((e=>o().IE(e)!==n));return{...e,items:t}}function d(e,n){const t=e.items.filter((e=>o().IE(e)!==o().IE(n)));return{...e,items:t.concat([n])}}function l(e,n,t){const{product:r,interval:i,currency:u}=t,c=function(e){if("personal_free"===e||"team_free"===e)return"free";return e}(r),s=n.items.filter((e=>o().IE(e)!==o().Mr(c))),a=function(e,n){let{interval:t,product:r,currency:o}=n;const i=e.find((e=>e.price.product===r&&e.price.billingInterval===t&&e.price.unitAmount.currencyValue.currencyCode===o));return y(i,`Unable to find price with interval: ${t}, product: ${r}, currency: ${o}`)}(e,{interval:i,product:c,currency:u});return{...n,items:s.concat([a])}}function f(e,n){return(0,r().Z4)(e,(e=>o().IE(e)),n,(e=>o().IE(e)))}function p(e){const{prices:n,billingData:t,product:r}=e,u=o().Ry(t),c=o().lQ(t),s=i().yw(c),a=o().q8(t),d=s??a;return n.find((e=>e.product===r&&e.billingInterval===d&&e.unitAmount.currencyValue.currencyCode===u))}function y(e,n){if(null==e)throw new Error(n);return e}}}]);