"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[72365],{81119:(e,t,s)=>{s.d(t,{B:()=>m});s(296540);var o=()=>s(56366),i=()=>s(534177),n=()=>s(146594),r=()=>s(737230),a=()=>s(548821),l=()=>s(386208),d=()=>s(891919),c=()=>s(310830),u=s(474848);function m(e){const{navigableBlockStore:t,timeViewed:s}=e,m=(0,o().K8)((()=>r().Ay.getTabForNewCommentsSidebar()),[]);switch(m){case r().UL.ForYou:return(0,u.jsx)(d().N,{navigableBlockStore:t});case r().UL.Comments:return(0,u.jsx)(l().R,{timeViewed:s,location:"sidebar"});case r().UL.Updates:case r().UL.Analytics:return(0,u.jsx)(c().f,{enablePageAnalytics:!0});case r().UL.Info:return(0,u.jsx)(n().H,{store:t,context:a().Rr.Frame,disabled:!1,shownAs:"sidebar"});default:return(0,i().ub)(m),null}}},119987:(e,t,s)=>{s.d(t,{ze:()=>v});var o=s(296540),i=()=>s(484714),n=()=>s(56366),r=()=>s(401497),a=()=>s(175947),l=()=>s(959013),d=()=>s(284371),c=()=>s(171347),u=()=>s(987017),m=()=>s(38337),p=()=>s(737230),g=()=>s(891919),f=()=>s(750420),y=s(474848);function v(e){const t=(0,i().v3)(),{navigableBlockStore:s,inPeekView:l,noTopMargin:c}=e,g=(0,n().K8)((()=>p().Ay.getTabForNewCommentsSidebar()),[]),v=(0,o.useCallback)((e=>p().Ay.setState({...p().Ay.getState(),...p().Ay.createUpdateForNewCommentsSidebar(e)})),[]),h=(0,r().IS)((e=>({updatesHeaderStyle:{position:"relative",pointerEvents:"auto",marginTop:c?0:a().ek(t.device.isElectronMac),paddingTop:4,width:"100%",background:l?e.popoverBackground:e.contentBackground,padding:"12px 12px 12px 16px",borderBottom:`1px solid ${e.regularDividerColor}`},getNotifiedFor:{paddingBottom:14},label:{fontSize:14,color:e.regularTextColor,fontWeight:d().Wy.medium}})),[c,t.device.isElectronMac,l]);return(0,y.jsx)("div",{style:{...h.updatesHeaderStyle},className:m().Kbf,children:(0,y.jsx)(u().Ay,{tabs:[(0,y.jsx)(x,{navigableBlockStore:s},"forYou"),(0,y.jsx)(S,{},"comments"),(0,y.jsx)(f().HX,{},"updates"),(0,y.jsx)(f().f2,{},"analytics")],selectedIndex:g,onChange:v,style:{...h.label,padding:0,boxShadow:"none"},tabStyle:{padding:"12px 0"},idPrefix:f().Oi})})}function x(e){const{navigableBlockStore:t}=e,s=(0,i().v3)(),o=(0,n().K8)((()=>s.currentUser.id),[s]),r=(0,g().P)({navigableBlockStore:t,currentUserId:o});return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(l().sA,{id:"updateSidebar.header.forYouLabel",defaultMessage:"For You"}),(0,y.jsx)(c().A,{count:r.length,color:c().g.Red})]})}function S(){return(0,y.jsx)(l().sA,{id:"updateSidebar.header.commentsLabel",defaultMessage:"Comments"})}},123021:(e,t,s)=>{s.d(t,{O:()=>A});s(898992),s(672577),s(581454);var o=s(296540),i=()=>s(484714),n=()=>s(56366),r=()=>s(401497),a=()=>s(709687),l=()=>s(668725),d=()=>s(284371),c=()=>s(416726),u=()=>s(848259),m=()=>s(452558),p=()=>s(493823),g=()=>s(406699),f=()=>s(928600),y=()=>s(89924),v=()=>s(722872),x=()=>s(553965),S=()=>s(538075),h=()=>s(518773),b=s(474848);function A(e){var t;const{blockStore:s,from:A,buttonPopupStore:j}=e,C=e.moreProminentStyling??!1,M=(0,i().v3)(),k=(0,n().K8)((()=>s.isPageBlock()),[s]),w=(0,n().K8)((()=>s.getFollowSettingsKey()),[s]),I=(0,o.useCallback)((()=>{u().zP({environment:M,pageId:s.pointer.id,isCurrentlyFollowing:(0,h().A)(w).following,from:A})}),[s.pointer.id,M,w,A]),T=(0,n().K8)((()=>S().H8({followSettingsKey:w,environment:M,blockStore:s,from:A})),[w,M,s,A]),B=(0,r().IS)((e=>({buttonContainer:{display:"flex",alignItems:"center",color:e.mediumTextColor,padding:C?"4px 10px":4,borderRadius:4,marginRight:C?0:4,fontSize:d().J.UIRegular.desktop},bellIcon:{width:14,height:14,marginRight:4},chevronIcon:{marginLeft:4,width:10,height:10},spacer:{flexGrow:1},footerLabel:{padding:12,backgroundColor:e.sidebarSecondaryBackground,boxShadow:`0 -1px 0 ${e.regularDividerColor}`,marginTop:1}})),[C]),D=null===(t=T.find((e=>S().I7({key:e.action.analyticsName,userSelectedKey:w}))))||void 0===t?void 0:t.title;return k?(0,b.jsx)(g().Ay,{popupType:g().z7.Popup,alignmentToOrigin:g().yP.End,placementToOrigin:g().sx.Bottom,sameWidthAsOrigin:C,buttonPopupStore:j,render:e=>(0,b.jsx)(f().A,{menuType:v().gu.Popup,minWidth:290,maxHeight:"50vh",children:(0,b.jsx)(m().A,{context:{blocks:[],environment:M,publicEditMode:void 0},sections:[(0,c().gy)({key:"in-app-notifications-section",render:e=>(0,b.jsx)(y().A,{...e}),actions:T.map((e=>e.action))})],initialFocus:void 0,onAccept:()=>e.close()})}),renderOrigin:e=>(0,b.jsxs)(p().p,{...(0,x().A)(e,{onClick:I}),style:B.buttonContainer,children:[(0,a().r)(B.bellIcon),D,C&&(0,b.jsx)("div",{style:B.spacer}),(0,l().b)(B.chevronIcon)]})}):null}},128973:(e,t,s)=>{s.d(t,{P:()=>c});s(898992),s(737550),s(296540);var o=()=>s(56366),i=()=>s(401497),n=()=>s(284371),r=()=>s(94953),a=()=>s(89924),l=()=>s(372154),d=s(474848);function c(e){const{firstItemId:t,ignoreFirstItemState:s}=e,c=(0,o().K8)((()=>{var e;return!s&&(Boolean(t)&&(null===(e=r().A.state)||void 0===e?void 0:e.discussionIds.some((e=>e===t))))}),[t,s]),u=(0,o().K8)((()=>!s&&(l().A.state.open&&l().A.state.discussionIds&&l().A.state.discussionIds.some((e=>e===t)))),[t,s]),m=(0,i().IS)((t=>({hoveredStyle:{background:"sidebar"===e.location?t.hoveredDiscussionBackground:void 0},pressedStyle:{background:"sidebar"===e.location?t.focusDiscussionBackground:void 0},basicDesktopTitleStyle:{paddingLeft:16,paddingTop:16,marginBottom:0,marginTop:0,fontSize:12,transition:"background 300ms ease"},mobileTitleStyle:{fontSize:13,fontWeight:n().Wy.medium,paddingBottom:0,textTransform:"unset",marginTop:-12}})),[e.location]);return(0,d.jsx)(a().A,{desktopTitleStyle:{...m.basicDesktopTitleStyle,...c?m.hoveredStyle:{},...u?m.pressedStyle:{}},mobileTitleStyle:m.mobileTitleStyle,disableDesktopPadding:!0,disableMobileBorders:!0,...e})}},146594:(e,t,s)=>{s.d(t,{H:()=>n});var o=()=>s(645873);const i=new(o().O2)("UpdateSidebarTabInfo",(async()=>await Promise.all([s.e(23806),s.e(9304),s.e(81141),s.e(72915),s.e(69689),s.e(43647),s.e(21377)]).then(s.bind(s,722143)))),n=(0,o()._h)(i,(e=>e.UpdateSidebarTabInfo))},273321:(e,t,s)=>{s.d(t,{A:()=>T});var o=s(296540),i=()=>s(790748),n=()=>s(56366),r=()=>s(401497),a=()=>s(713998),l=()=>s(797809),d=()=>s(959013),c=()=>s(284371),u=()=>s(175499),m=()=>s(678553),p=()=>s(125565),g=()=>s(862292),f=()=>s(186445),y=()=>s(972435),v=()=>s(480289),x=()=>s(351360),S=()=>s(441467),h=()=>s(848565),b=()=>s(493319),A=()=>s(555776),j=()=>s(116008),C=()=>s(811879),M=()=>s(846583),k=()=>s(898495),w=()=>s(105157),I=s(474848);function T(e){const{environment:t,menuListItemProps:s,shouldShowTopDividerLine:T,shouldShowBottomDividerLine:B,shouldExpandDiscussionWidth:D,noBackgroundColors:F,onMouseEnter:_,onMouseLeave:K,onFocus:U,onBlur:N}=e,P=(0,n().K8)((()=>x().default.state.mainEditorCurrentBlockStore),[]),R=(0,n().K8)((()=>(0,f()._m)(t)),[t]),E=h().eQ,L=(0,n().K8)((()=>A().A.state.isActivelyComposing),[]),H=(0,n().K8)((()=>A().A.state.isHovered),[]),O=(0,o.useCallback)((()=>{null==_||_()}),[_]),V=(0,o.useCallback)((()=>{null==K||K()}),[K]),W=(0,o.useCallback)((()=>{null==U||U()}),[U]),z=(0,o.useCallback)((()=>{j().A.hasContent()?A().A.resetAllActiveSources():(j().A.reset(),A().A.reset()),null==N||N()}),[N]),G=(0,d().tz)(),$=(0,o.useRef)(null);(0,i().b)(v().A,(()=>({getNode:()=>$.current})),[]);const Z=(0,r().IS)((e=>({menuDiscussionItem:{marginLeft:-14,marginRight:-14,width:"calc(100% + 28px)"},discussionContainer:{paddingTop:t.device.isMobile?4:6,borderTop:!t.device.isMobile&&T?`1px solid ${e.regularDividerColor}`:void 0,borderBottom:!t.device.isMobile&&B?`1px solid ${e.regularDividerColor}`:void 0,transition:"background 300ms ease",background:F?void 0:L?e.focusDiscussionBackground:H?e.hoveredDiscussionBackground:void 0},comment:{position:"relative",fontSize:14},commentElementsBelowUserRow:{paddingLeft:h().FB},avatar:{marginTop:0,marginRight:8,userSelect:"none",WebkitUserSelect:"none"},userRow:{display:"flex",flexDirection:"row",alignItems:"center",userSelect:"none",WebkitUserSelect:"none"},placeholder:{height:8,width:81,borderRadius:6,background:e.lightDividerColor},attachIcon:{width:18,height:18,fill:e.mediumIconColor},text:{cursor:"text",lineHeight:"20px",paddingTop:4},attachmentContainer:{display:"flex",alignItems:"center"},draftLabel:{margin:"0 6px",flexBasis:140,whiteSpace:"normal",flexGrow:void 0,display:"inline",color:e.text.tertiary},commentAuthorPlaceholder:{marginRight:8,marginTop:2,height:E,width:E,borderRadius:20,flexShrink:0},container:{paddingTop:h().e4,paddingRight:16,paddingBottom:h().Wv,paddingLeft:16},noOverflow:{overflow:"hidden"},commentContext:{display:"flex",width:"100%",marginTop:6,marginBottom:22,fontSize:13,color:e.text.secondary},displayName:{fontWeight:c().Wy.medium,whiteSpace:"normal"},fullWidthFlex:{display:"flex",width:"100%"},smallTopPadding:{marginTop:1}})),[E,t.device.isMobile,H,L,F,B,T]),Y=(0,o.useCallback)((async()=>{const e=await g().T.formulas.load();S().i5({environment:t,allowActionsWhileCommenting:!0,formulasModule:e})}),[t]),q=(0,n().K8)((()=>!j().A.state.open||"reaction"===j().A.state.content),[]),J=(0,n().K8)((()=>{var e;return j().A.getBlockStore()??(null===(e=j().A.getClosestBlockStore())||void 0===e?void 0:e.parentBlockStore)}),[]),X=(0,n().K8)((()=>j().A.getPropertyId()),[]),Q=(0,n().K8)((()=>{if(X){var e;const t=null===(e=j().A.getBlockStore())||void 0===e?void 0:e.getAssociatedCollectionStore();if(!t||"collection"!==t.table)return;const s=t.getSchema();return(0,a()._g)({schema:s,property:X})}}),[X]),ee=(0,n().K8)((()=>(0,l().RX)(y().A.getIntl()).title),[]),te=(0,n().K8)((()=>j().A.getDiscussionInputStore()),[]),se=(0,n().K8)((()=>null==R?void 0:R.getDisplayName(G)),[R,G]),oe=(0,n().K8)((()=>null==J?void 0:J.getSpaceId()),[J]),ie=(0,n().K8)((()=>S().Ek({environment:t})),[t]),ne=(0,n().K8)((()=>j().A.getType()),[]),re=(0,n().K8)((()=>null==J?void 0:J.getValue()),[J]);if(q||!ee||!R||!J||!P||!te||!oe||!re&&"block"===ne||!ie&&"inline"===ne)return null;const ae="inline"===ne||X,le="block"===ne&&!X?(0,I.jsx)(u().Ay,{blockValue:re,rootStore:J,blockPreviewLocation:"comments_sidebar"}):ae?(0,I.jsx)(u().vY,{value:{value:(null==ie?void 0:ie.context)??[],spaceId:oe},propertySchema:ee,labeled:!1,rootStore:J,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableDateStyleAnnotations:!0}):null;return(0,I.jsx)("div",{style:Z.discussionContainer,ref:$,onClick:null==s?void 0:s.onClick,onMouseEnter:O,onMouseLeave:V,children:(0,I.jsx)(m().A,{allowTextSelection:!0,style:Z.menuDiscussionItem,title:(0,I.jsx)("div",{style:Z.container,children:(0,I.jsxs)("div",{style:Z.comment,children:[(0,I.jsxs)("div",{style:Z.userRow,children:[(0,I.jsx)(C().E,{authorStore:R,avatarSize:E,avatarStyle:Z.avatar,placeholderStyle:Z.commentAuthorPlaceholder}),(0,I.jsxs)("div",{style:Z.noOverflow,children:[(0,I.jsx)("span",{style:Z.displayName,children:se||(0,I.jsx)("span",{style:Z.placeholder})}),(0,I.jsx)(p().A,{isSmall:!0,isSecondaryColor:!0,isMultiline:!0,style:Z.draftLabel,children:(0,I.jsx)(d().sA,{defaultMessage:"Draft",id:"DraftCommentInputWithContext.draftLabel"})})]})]}),(0,I.jsxs)("div",{style:Z.commentElementsBelowUserRow,children:[(0,I.jsx)("div",{style:Z.commentContext,children:(0,I.jsxs)("div",{style:Z.fullWidthFlex,children:[(0,I.jsx)(M().T,{}),Q&&(0,I.jsx)(w().A,{propertySchema:Q}),(0,I.jsx)("div",{style:Z.smallTopPadding,children:le})]})}),(0,I.jsx)(k().A,{showAvatar:!1,parentStore:P,blockStore:J,onSubmit:Y,discussionInputStore:te,isNewComment:!0,isEditingExistingComment:!1,isMobileSlideUpMenu:!0,shouldSaveUnsentComments:!1,discussionFormat:b().DiscussionFormat.Sidebar,canDrop:!0,disableFocusRing:!0,adjustWidthForDraftDiscussions:D,dontMoveCursorToInputEndOnFocus:!0,onBlur:z,onFocus:W},"draft-comment-sidebar")]})]})})})},"draft-comment-discussion-updates")}},310830:(e,t,s)=>{s.d(t,{f:()=>ve});var o=()=>s(244641),i=s(296540),n=()=>s(56366),r=()=>s(401497),a=()=>s(959013),l=()=>s(60499),d=()=>s(2143),c=(s(898992),s(823215),s(354520),s(430670),s(581454),s(908872),()=>s(968526)),u=()=>s(662303),m=()=>s(484714),p=()=>s(869190),g=()=>s(604995),f=()=>s(73514),y=()=>s(883234),v=()=>s(535845),x=()=>s(133033),S=()=>s(738418),h=()=>s(846899),b=()=>s(72135),A=()=>s(310442),j=()=>s(824862),C=()=>s(798880),M=()=>s(496603),k=()=>s(821062),w=()=>s(534177),I=()=>s(129546),T=()=>s(449506),B=()=>s(466721),D=()=>s(59976),F=()=>s(777092),_=()=>s(722872),K=()=>s(680026),U=()=>s(299545),N=()=>s(836251),P=()=>s(997583),R=()=>s(962730),E=()=>s(224239),L=()=>s(351360),H=()=>s(630116),O=()=>s(406699),V=()=>s(364280),W=()=>s(331542),z=()=>s(928600),G=()=>s(864943),$=()=>s(859428),Z=()=>s(256863),Y=()=>s(125565),q=()=>s(453697),J=()=>s(733815),X=()=>s(687110),Q=s(474848);const ee=Date.now();function te(e){let{store:t,spaceId:s,isDisabledForWorkspace:o}=e;const[l,d]=(0,i.useState)("last_28_days"),[c,u]=(0,i.useState)({state:o?"disabled-for-workspace":"loading"}),p=(0,m().v3)(),f=(0,r().DP)(),y=(0,n().K8)((()=>{const{currentSpaceStore:e}=L().default.state;return null==e?void 0:e.getName()}),[]),v=(0,n().K8)((()=>{switch(l){case"last_7_days":return 7;case"last_28_days":return 28;case"last_90_days":return 90;case"all_time":return}}),[l]);(0,i.useEffect)((()=>{o||async function(){const e=await T().callApi({eventName:"getPageAnalytics",environment:p,data:{pageId:t.id,spaceId:s,days:v}});if("failed"===e.type)return void u({state:"empty"});const o=e.data.map((e=>{let{ds:t,total_views:s,unique_views:o}=e;return{ds:t,values:{total_views:s,unique_views:o}}}));o.filter((e=>{let{ds:t}=e;return g().C6.isoToUnixMs(t,"UTC")??ee<=ee})).every((e=>{let{values:t}=e;return 0===t.total_views}))?u({state:"empty"}):u({state:"loaded",data:o})}()}),[p,t.id,o,s,v]);const S=(0,r().IS)((e=>({fullHeight:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"}})),[]);return"loading"===c.state?(0,Q.jsx)("div",{style:S.fullHeight,children:(0,Q.jsx)(W().A,{legacySize:32})}):"empty"===c.state?(0,Q.jsx)("div",{style:S.fullHeight,children:(0,Q.jsx)(pe,{heading:(0,Q.jsx)(a().sA,{id:"page_analytics.empty.heading",defaultMessage:"No page analytics yet"}),description:(0,Q.jsx)(a().sA,{id:"page_analytics.empty.description",defaultMessage:"It may take some time for page view information to appear."})})}):"disabled-for-workspace"===c.state?(0,Q.jsx)("div",{style:S.fullHeight,children:(0,Q.jsx)(pe,{heading:(0,Q.jsx)(a().sA,{id:"page_analytics.disabled.heading",defaultMessage:"Page viewership tracking is disabled"}),description:(0,Q.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:16},children:[y?(0,Q.jsx)(a().sA,{id:"page_analytics.disabled.description",defaultMessage:"Page viewership and analytics is turned off for all pages in {name}",values:{name:y}}):(0,Q.jsx)(a().sA,{id:"page_analytics.disabled.description.unnamed",defaultMessage:"Page viewership and analytics is turned off for all pages in your space"}),(0,Q.jsxs)("a",{href:(0,N().xS)("guides.pageAnalytics"),target:"_blank",style:{display:"flex",gap:4,color:f.regularTextColor,alignItems:"center",textDecoration:"none",cursor:"pointer"},children:[(0,x().$)({width:14,height:14}),(0,Q.jsx)(Y().A,{isSmall:!0,children:(0,Q.jsx)(a().sA,{id:"page_analytics.disabled.learnMore",defaultMessage:"Learn more"})})]})]})})}):(0,Q.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between",height:"100%"},children:[(0,Q.jsxs)(V().VP,{grow:1,gap:16,children:[(0,Q.jsx)(ie,{store:t,data:c.data,currentFilter:l,onChangeFilter:d}),(0,Q.jsx)(re,{store:t}),(0,Q.jsx)(me,{spaceId:s,store:t})]}),(0,Q.jsxs)("div",{style:{borderTop:`1px solid ${f.regularDividerColor}`,padding:"12px 16px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,Q.jsx)(O().Ay,{renderOrigin:e=>{let{onClick:t}=e;return(0,Q.jsx)(G().A,{size:"lg",onClick:t,icon:h().B,children:(0,Q.jsx)(a().sA,{id:"page_analytics.timeseries.settings",defaultMessage:"Settings"})})},popupType:p.device.isMobile?O().z7.SlideUp:O().z7.Popup,render:()=>(0,Q.jsx)(z().A,{menuType:_().gu.Popup,width:460,children:(0,Q.jsx)("div",{style:oe,children:(0,Q.jsx)(X().PageAnalyticsPageOptOut,{store:t})})})}),(0,Q.jsxs)("a",{href:(0,N().xS)("guides.pageAnalytics"),target:"_blank",style:{display:"flex",gap:4,color:f.regularTextColor,alignItems:"center",textDecoration:"none",cursor:"pointer"},children:[(0,x().$)({width:14,height:14}),(0,Q.jsx)(Y().A,{isSmall:!0,children:(0,Q.jsx)(a().sA,{id:"page_analytics.timeseries.learnMore",defaultMessage:"Learn more"})})]})]})]})}const se=175,oe={margin:"8px 16px",pointerEvents:"auto",cursor:"default"};function ie(e){const[t,s]=(0,P().z)(),{blueLayer:o,yellowLayer:n}=(0,c().useTimeSeriesPalette)(),r=(0,i.useMemo)((()=>{if(0===e.data.length)return ee;const t=g().C6.isoToUnixMs(e.data[0].ds,"UTC")??ee;return Math.min(t,ee)}),[e.data]);return(0,Q.jsxs)("div",{children:[(0,Q.jsx)(ne,{store:e.store,data:e.data,currentFilter:e.currentFilter,onChangeFilter:e.onChangeFilter}),(0,Q.jsx)("div",{ref:t,style:{...oe,marginBottom:0},children:(0,Q.jsx)(D().b,{startDate:(0,p().aD)(r,!0),endDate:(0,p().aD)(ee,!0),width:s,height:se,data:e.data,layers:[{key:"total_views",...o,renderLabel:e=>(0,Q.jsx)(a().sA,{id:"page_analytics.timeseries.total_views",defaultMessage:"{views, plural, one {1 total view} other {{views} total views}}",values:{views:e}})},{key:"unique_views",...n,renderLabel:e=>(0,Q.jsx)(a().sA,{id:"page_analytics.timeseries.unique_views",defaultMessage:"{uniqueViews, plural, one {1 unique view} other {{uniqueViews} unique views}}",values:{uniqueViews:e}})}]})})]})}function ne(e){const t=(0,a().tz)(),s=(0,i.useMemo)((()=>e.data.reduce(((e,t)=>{let{values:s}=t;return e+s.total_views}),0)),[e.data]);return(0,Q.jsx)("div",{style:{margin:"14px 16px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:(0,Q.jsxs)(V().fI,{justifyContent:"space-between",alignItems:"center",grow:1,children:[(0,Q.jsxs)(V().fI,{gap:4,children:[(0,Q.jsx)(Y().A,{style:{fontWeight:500},children:(0,Q.jsx)(a().sA,{id:"page_analytics.timeseries.title",defaultMessage:"Views"})}),(0,Q.jsx)(Y().A,{isSecondaryColor:!0,children:(0,Q.jsx)(a().sA,{id:"page_analytics.timeseries.totalViews",defaultMessage:"({totalViews} total)",values:{totalViews:(0,b().ZV)(s,"number_with_commas",t)}})})]}),(0,Q.jsx)(J().Z,{currentFilter:e.currentFilter,onChangeFilter:e.onChangeFilter})]})})}function re(e){const{store:t}=e,{pageVisitStore:s,presenceStore:o}=(0,n().O$)(L().default),r=(0,m().v3)();(0,i.useEffect)((()=>{B().Ds(r,{blockStore:t,pageVisitStore:s,incremental:!1,limit:B().FD})}),[r,t,s]);const l=(0,n().K8)((()=>(0,K().PZ)({pageVisitStore:s,presenceStore:o})),[s,o]);if(0===l.length)return null;const d=l.map((e=>{let{userId:s,activityTimestampNearestMinuteMs:o,onTrustedDomain:i}=e;return{actorStore:H().LU.createChildStore(t,{id:s,table:C().oo}),timestamp:o,onTrustedDomain:i}}));return(0,Q.jsxs)("div",{style:{...oe,display:"flex",flexDirection:"column",gap:12},children:[(0,Q.jsx)(Y().A,{style:{fontWeight:500},children:(0,Q.jsx)(a().sA,{id:"page_analytics.viewers.title",defaultMessage:"Viewers"})}),(0,Q.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:10},children:(0,Q.jsx)(le,{store:t,actorStores:d,collapsedLabel:(0,Q.jsx)(a().sA,{id:"page_analytics.viewers.expand",defaultMessage:"Show more viewers"}),expandedLabel:(0,Q.jsx)(a().sA,{id:"page_analytics.viewers.collapse",defaultMessage:"Show less viewers"})})})]})}const ae=5;function le(e){const{store:t,actorStores:s,collapsedLabel:o,expandedLabel:n}=e,[r,a]=(0,i.useState)(!0),l=r?s.slice(0,ae):s;return(0,Q.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[l.map((e=>{let{actorStore:s,timestamp:o,onTrustedDomain:i}=e;return(0,Q.jsx)(de,{store:t,actorStore:s,timestamp:o,onTrustedDomain:i},s.id)})),s.length>ae&&(0,Q.jsx)("button",{onClick:e=>{e.preventDefault(),a(!r)},style:{background:"none",border:"none",textAlign:"left",padding:0,marginTop:4},children:(0,Q.jsxs)(Y().A,{isSecondaryColor:!0,isSmall:!0,style:{display:"flex",gap:3,alignItems:"center"},children:[r?o:n,r?(0,y()._)({width:12}):(0,v().B)({width:12})]})},"toggle")]})}function de(e){const{actorStore:t,timestamp:s,onTrustedDomain:o}=e,l=(0,a().tz)(),d=(0,i.useMemo)((()=>{const e=Date.now();return(0,p().v9)(Math.min(s??e,e),u().locale)}),[s]),c=(0,n().K8)((()=>t.getDisplayName(l)),[t,l]),m=(0,r().IS)((e=>({icon:{width:14,height:14,position:"relative",top:1,color:e.mediumTextColor},tooltip:{marginTop:2}})),[]);return(0,Q.jsxs)(V().fI,{alignItems:"center",justifyContent:"space-between",children:[(0,Q.jsxs)(V().fI,{gap:4,children:[(0,Q.jsx)(ce,{actorStore:t}),(0,Q.jsx)(Y().A,{style:{fontWeight:500},children:c})]}),(0,Q.jsx)(Y().A,{isSecondaryColor:!0,children:s?(0,Q.jsx)("span",{title:(0,p().W_)(s,"medium_with_time",u().locale),children:d}):d}),o&&(0,Q.jsx)("div",{style:m.tooltip,children:(0,Q.jsx)($().A,{renderTooltip:()=>(0,Q.jsx)(a().sA,{id:"page_analytics.viewers.sharedEmailDomainUser.tooltip.message",defaultMessage:"Shared email domain user"}),render:e=>(0,Q.jsx)("div",{...e,style:m.icon,children:(0,S().G)()}),placement:R().W.Bottom})})]})}function ce(e){const{actorStore:t}=e;return t.table===j().GP?(0,Q.jsx)(Z().A,{botStore:t,size:18}):t.table===C().oo?(0,Q.jsx)(q().A,{userStore:t,size:18}):t.table===A().yj?(0,Q.jsx)(q().A,{userStore:void 0,size:18}):void(0,w().HB)(t)}function ue(e){const{environment:t,store:s,spaceId:o}=e,[,,r]=(0,n().$y)(void 0,E().L),[a,l]=(0,i.useState)([]);(0,i.useEffect)((()=>{I().rL(t,{store:r,activityIds:a,spaceId:o,filterActivityTypes:[],filterDateRange:{starting:void 0,ending:void 0},navigableBlockId:s.id})}),[a,r,o,s.id,t]);return(0,n().K8)((()=>{const e=r.state.activityIds;(0,k().A)(a,e)||l(e);const{currentSpaceStore:t}=L().default.state;if(!t)return[];const o=a.map((e=>(0,U().jA)(t,e,t.id))).flatMap((e=>{const t=e.getValue();return t?"top-level-block-created"!==t.type&&"top-level-block-deleted"!==t.type&&"block-edited"!==t.type?[]:function(e,t){var s;return M().oE(null===(s=e.edits)||void 0===s?void 0:s.flatMap((e=>{var s;return null===(s=e.authors)||void 0===s?void 0:s.map((s=>({actorStore:(0,F().JQ)({parentStore:t,pointer:s}),timestamp:e.timestamp})))})))}(t,s):[]})),i=M().Ul(o,"timestamp").reverse();return M().hS(i,(e=>e.actorStore.id))}),[a,r,s])}function me(e){const{spaceId:t,store:s}=e,o=ue({environment:(0,m().v3)(),spaceId:t,store:s}),i=(0,n().K8)((()=>{const e=s.getCreatedByPointer(),t=s.getCreatedTime();if(e&&t)return{actorStore:(0,F().JQ)({parentStore:s,pointer:e}),createdTime:t}}),[s]);return(0,Q.jsxs)("div",{style:{...oe,display:"flex",flexDirection:"column",gap:12},children:[(0,Q.jsx)(Y().A,{style:{fontWeight:500},children:(0,Q.jsx)(a().sA,{id:"page_analytics.editors.title",defaultMessage:"Editors"})}),i&&(0,Q.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:10,marginBottom:6},children:[(0,Q.jsx)(Y().A,{isSmall:!0,isSecondaryColor:!0,style:{fontWeight:500},children:(0,Q.jsx)(a().sA,{id:"page_analytics.editors.createdBy",defaultMessage:"Created by"})}),(0,Q.jsx)(de,{store:s,actorStore:i.actorStore,timestamp:i.createdTime})]}),o.length>0&&(0,Q.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[(0,Q.jsx)(Y().A,{isSmall:!0,isSecondaryColor:!0,style:{fontWeight:500},children:(0,Q.jsx)(a().sA,{id:"page_analytics.editors.editedBy",defaultMessage:"Recently edited by"})}),(0,Q.jsx)(le,{actorStores:o,store:s,collapsedLabel:(0,Q.jsx)(a().sA,{id:"page_analytics.editors.expand",defaultMessage:"Show more editors"}),expandedLabel:(0,Q.jsx)(a().sA,{id:"page_analytics.editors.collapse",defaultMessage:"Show less editors"})})]})]})}function pe(e){const t=(0,r().IS)((e=>({column:{display:"flex",flexDirection:"column"},row:{display:"flex"},centered:{textAlign:"center",alignItems:"center",width:250},analyticsIcon:{position:"relative",top:-8,left:-4},secondaryIcon:{fill:e.mediumTextColor},settingsButton:{padding:"7.5px 10px",alignSelf:"center"},link:{cursor:"pointer",justifyContent:"center",alignItems:"center",padding:8,alignSelf:"center"}})),[]);return(0,Q.jsx)("div",{style:{...t.column,gap:24},children:(0,Q.jsxs)("div",{style:{...t.column,...t.centered,gap:4},children:[(0,f().C)({...t.secondaryIcon,...t.analyticsIcon,width:62,height:62}),(0,Q.jsx)(Y().A,{isSecondaryColor:!0,style:{fontSize:16,fontWeight:500},children:e.heading}),(0,Q.jsx)(Y().A,{isSecondaryColor:!0,style:{whiteSpace:"normal",overflow:"visible"},children:e.description})]})})}var ge=()=>s(347199),fe=()=>s(737230),ye=()=>s(756279);function ve(e){let{enablePageAnalytics:t}=e;const s=(0,n().K8)((()=>L().default.state.mainEditorCurrentBlockStore),[]),i=(0,n().K8)((()=>{const e=o().c9.now().minus({years:1}).valueOf();return!!s&&s.getCreatedTime()<e}),[s]),c=(0,n().K8)((()=>L().default.state.currentSpaceStore),[]),u=(0,n().K8)((()=>!(null!=s&&s.canRead())),[s]),m=(0,n().K8)((()=>{var e;const t=null==s?void 0:s.getModel();return s&&null!=t&&t.isCollectionView()?null===(e=s.getCollectionPointer())||void 0===e?void 0:e.id:void 0}),[s]),p=(0,n().K8)((()=>Boolean(null==c?void 0:c.getSettings().disable_page_analytics)),[c]),g=(0,r().IS)((e=>({updatesEmptyStyle:{flex:1,display:"flex",justifyContent:"center",flexDirection:"column",textAlign:"center",color:e.mediumTextColor,fontSize:14,background:e.contentBackground,marginRight:0,pointerEvents:"auto",height:"100%"},updatesNotEmptyStyle:{display:"flex",flexDirection:"column",flex:"1 1 0%",background:e.contentBackground,marginRight:0,pointerEvents:"auto",marginTop:1,height:"100%"}})),[]),f=(0,n().K8)((()=>fe().Ay.state.updatesSubTab),[]);return u?(0,Q.jsx)(d().H,{type:ye().A.Y,style:g.updatesEmptyStyle,children:(0,Q.jsx)("div",{style:{width:200,alignSelf:"center"},children:(0,Q.jsx)(a().sA,{id:"updateSidebar.commentContainer.restricted",defaultMessage:"You don't have permission to view the updates of this restricted page."})})}):c&&s?(0,Q.jsxs)(d().H,{type:ye().A.Y,ref:e=>{ge().A.UpdateSidebarScroller=e},style:g.updatesNotEmptyStyle,children:[t&&(0,Q.jsx)("div",{style:{display:f===fe().VE.Analytics?"block":"none",height:"100%"},children:(0,Q.jsx)(te,{spaceId:c.id,store:s,isDisabledForWorkspace:p})}),(0,Q.jsx)("div",{style:{display:f===fe().VE.Updates?"block":"none"},children:(0,Q.jsx)(l().A,{collectionId:m,navigableBlockStore:s,spaceId:c.id,source:"updates_sidebar",empty:e=>(0,Q.jsx)(d().H,{type:ye().A.Y,style:g.updatesEmptyStyle,ref:e=>{ge().A.UpdateSidebarScroller=e},children:(0,Q.jsx)("div",{style:{width:200,alignSelf:"center"},children:e.hasFiltersOn?(0,Q.jsx)(a().sA,{id:"updateSidebar.updatesContainer.emptyAfterSearch",defaultMessage:"No updates match the requested filters."}):i?(0,Q.jsx)(a().sA,{id:"updateSidebar.updatesContainer.emptyMaybePurged",defaultMessage:"There are no recent updates on this page. Page updates are retained for one year."}):(0,Q.jsx)(a().sA,{id:"updateSidebar.updatesContainer.empty",defaultMessage:"No updates on this page yet."})})})},s.id)})]}):null}},386208:(e,t,s)=>{s.d(t,{R:()=>Pe});s(944114),s(898992),s(354520),s(672577),s(430670),s(581454),s(737550);var o=s(296540),i=()=>s(908006),n=()=>s(484714),r=()=>s(56366),a=()=>s(401497),l=()=>s(764880),d=()=>s(700500),c=()=>s(869190),u=()=>s(416504),m=s(474848);const p=(0,s(340498).wt)("commentSidebarZero",{viewBox:"0 0 56 56",svg:(0,m.jsx)("path",{d:"M13.1289 47.6641C13.9297 47.6641 14.4961 47.3516 15.4141 46.5508L21.8984 40.5938C23.0703 42.4297 25.1602 43.4258 27.9922 43.4258H36.3516L42.6602 48.8164C43.5195 49.5586 44.0273 49.9492 44.7305 49.9492C45.7461 49.9492 46.332 49.2266 46.332 48.0938V43.4258H47.4453C51.8398 43.4258 54.6328 40.8281 54.6328 36.2969V24.1289C54.6328 19.5977 51.8398 17 47.4453 17H43.9688V14.793C43.9688 9.83203 41.0781 7 36.0977 7H8.87109C4.00781 7 1 9.83203 1 14.793V32.4297C1 37.4102 4.00781 40.2422 8.87109 40.2422H11.4492V45.7695C11.4492 46.9609 12.0742 47.6641 13.1289 47.6641ZM13.7539 39.2461C13.7539 38.3867 13.2266 37.9766 12.543 37.9766H9.08594C5.43359 37.9766 3.42188 36.043 3.42188 32.293V14.9492C3.42188 11.2188 5.45312 9.26562 9.08594 9.26562H35.8828C39.5156 9.26562 41.5469 11.2188 41.5469 14.9492V17H27.9922C23.4414 17 20.8047 19.5977 20.8047 24.1289V36.3164C20.8047 36.9805 20.8438 37.6055 20.9609 38.1719L13.7539 44.9883V39.2461ZM44.0859 47.2148L38.1289 41.9023C37.4844 41.3359 37.0938 41.1602 36.2344 41.1602H28.168C25.0039 41.1602 23.207 39.4805 23.207 36.1797V24.2656C23.207 20.9648 25.0039 19.2656 28.168 19.2656H47.25C50.4336 19.2656 52.2305 20.9648 52.2305 24.2656V36.1602C52.2305 39.4609 50.4336 41.1602 47.25 41.1602H45.2383C44.5938 41.1602 44.0859 41.5312 44.0859 42.3711V47.2148Z"})});var g=()=>s(175947),f=()=>s(959013),y=()=>s(496603),v=()=>s(534177),x=()=>s(284371),S=()=>s(878523),h=()=>s(620689),b=()=>s(725614),A=()=>s(774733),j=()=>s(789557),C=()=>s(441467),M=()=>s(938045),k=()=>s(273321),w=()=>s(493319),I=()=>s(94953),T=()=>s(555776),B=()=>s(116008),D=()=>s(928600),F=()=>s(939740),_=()=>s(45552),K=()=>s(864943),U=()=>s(2143),N=()=>s(38337),P=()=>s(123021),R=()=>s(30626),E=()=>s(516672),L=()=>s(413267),H=()=>s(234194),O=()=>s(493823),V=()=>s(760217),W=()=>s(406699),z=()=>s(89924),G=()=>s(859428),$=()=>s(457688),Z=()=>s(972435),Y=()=>s(722872),q=()=>s(869562),J=()=>s(737230),X=()=>s(265201),Q=()=>s(962730),ee=()=>s(377586);const te=["commentsAndSuggestions","comments","suggestions"],se=["unresolved","resolved"],oe={unresolved:N().jc0,resolved:N().tXX},ie=(0,f().YK)({unresolved:{id:"updateSidebar.comments.mode.unresolvedOption",defaultMessage:"Open"},resolved:{id:"updateSidebar.comments.mode.resolvedOption",defaultMessage:"Resolved"},commentsAndSuggestions:{id:"updateSidebar.comments.typeMode.commentsAndSuggestions",defaultMessage:"Any"},comments:{id:"updateSidebar.comments.typeMode.comments",defaultMessage:"Comments only"},suggestions:{id:"updateSidebar.comments.typeMode.suggestions",defaultMessage:"Suggestions only"}}),ne=(0,f().YK)({filterLabel:{id:"updateSidebar.comments.filter.label",defaultMessage:"Filter"}});function re(e,t,s,o,i){if(t)return e;const{items:n}=e;if(n.length<=6)return e;const r=[...n.slice(0,5),{key:"show more",render:e=>(0,m.jsx)(V().A,{...e,icon:(0,R()._)(i.showMoreResultsButton),title:(0,m.jsx)("span",{style:i.showMoreResultsButtonTitle,children:(0,m.jsx)(f().sA,{defaultMessage:"{numberMore} more results",id:"updateSidebar.comments.filter.byPerson.showMoreResultsButton.title",values:{numberMore:n.length-5}})})}),action:()=>{s(!0)}}];return{...e,items:r}}function ae(e){let{numCommenters:t,userActorsForDisplay:s,actorForFilter:o,setActorForFilter:i,onMobileClose:r,currentCommentsMode:l,currentTypeMode:d,popupOpen:c,setPopupOpen:u,peopleFilterExpanded:p,setPeopleFilterExpanded:g}=e;const y=(0,n().v3)(),x=y.device.isMobile?(0,m.jsx)(f().sA,{defaultMessage:"By type",id:"commentFilterMenu.typeSectionMobile.title"}):(0,m.jsx)(f().sA,{defaultMessage:"Filter by type",id:"commentFilterMenu.typeSectionDesktop.title"}),S=y.device.isMobile?(0,m.jsx)(f().sA,{defaultMessage:"By status",id:"commentFilterMenu.statusSectionMobile.title"}):(0,m.jsx)(f().sA,{defaultMessage:"Filter by status",id:"commentFilterMenu.statusSectionDesktop.title"}),h=y.device.isMobile?(0,m.jsx)(f().sA,{defaultMessage:"By person",id:"commentFilterMenu.personFilterSectionMobile.title"}):(0,m.jsx)(f().sA,{defaultMessage:"Filter by person",id:"commentFilterMenu.personFilterSectionDesktop.title"}),b=(0,a().IS)((e=>({personIcon:{width:y.device.isMobile?24:20,fill:e.mediumIconColor},showMoreResultsButton:{width:16,fill:e.mediumTextColor},showMoreResultsButtonTitle:{color:e.mediumTextColor}})),[y.device.isMobile]),A={key:"typeMode",render:e=>(0,m.jsx)(z().A,{...e,title:x}),items:te.map((e=>({key:e,render:t=>(0,m.jsx)(V().A,{...t,title:Z().A.formatMessage(ie[e]),right:(0,m.jsx)("div",{style:{width:14,opacity:d===e?1:0},children:(0,L().b)()})}),action:()=>{q().setUpdateSidebarCommentsTypeMode(e),y.device.isMobile||u(!1)}})))},j={key:"commentFilter",render:e=>(0,m.jsx)(z().A,{...e,topBorder:!0,title:S}),items:se.map((e=>({key:e,render:t=>(0,m.jsx)(V().A,{...t,className:oe[e],title:Z().A.formatMessage(ie[e]),right:(0,m.jsx)("div",{style:{width:14,opacity:l===e?1:0},children:(0,L().b)()})}),action:()=>{q().setUpdateSidebarCommentsMode(e),y.device.isMobile||u(!1)}})))},C={key:"anyone",render:e=>(0,m.jsx)(V().A,{...e,title:(0,m.jsx)(f().sA,{defaultMessage:"Anyone",id:"commentFilterMenu.anyoneItem.title"}),icon:(0,H().M)(b.personIcon),right:(0,m.jsx)("div",{style:{width:14,opacity:void 0===o?1:0},children:(0,L().b)()})}),action:()=>{i(void 0),y.device.isMobile||u(!1)}},M=s.map((e=>{const t=e.getActorUserId();if(t){return{key:t,render:s=>(0,m.jsx)($().A,{...s,actor:e,useEmailAsTooltip:!0,right:(0,m.jsx)("div",{style:{width:14,opacity:(null==o?void 0:o.getActorUserId())===t?1:0},children:(0,L().b)()})}),action:()=>{i(e),y.device.isMobile||u(!1)}}}})).filter(v().O9),k={key:"personFilter",render:e=>(0,m.jsx)(z().A,{topBorder:!0,...e,title:h}),items:y.device.isMobile?[C,...M]:1===t?M:[C,...M]},w=(0,m.jsx)(F().Ay,{type:F().Oh.Vertical,initialFocus:void 0,sections:[A,j,y.device.isMobile?k:re(k,p,g,0,b)]});return y.device.isMobile?(0,m.jsx)(D().A,{menuType:Y().gu.Modal,scrollerStyle:{paddingBottom:0},title:(0,m.jsx)(f().sA,{defaultMessage:"Filter",id:"commentFilterMenu.title"}),right:(0,m.jsx)(_().DoneMenuText,{}),onClickRight:()=>{r(),u(!1)},children:w}):w}function le(e){let{userActors:t,actorForFilter:s,setActorForFilter:i}=e;const d=(0,n().v3)(),c=(0,f().tz)(),u=(0,r().K8)((()=>J().Ay.state.expanded),[]),p=(0,r().K8)((()=>X().A.state.open),[]),g=(0,r().K8)((()=>{let e=[...t];return s&&!e.find((e=>e.getActorUserId()===s.getActorUserId()))&&(d.device.isMobile?i(void 0):e=[s,...e]),e.sort(((e,t)=>{const s=(0,l().lR)(c,e),o=(0,l().lR)(c,t);return s&&o?s.localeCompare(o):0})),e}),[c,s,t,d.device.isMobile,i]),[y,v]=(0,o.useState)(!1),[x,S]=(0,o.useState)(!1),[h,b]=(0,r().K8)((()=>[J().Ay.state.commentsMode,J().Ay.state.commentsTypeMode]),[]),A=(0,a().IS)((e=>({container:{display:"flex",flexDirection:"column"},toggleButton:{justifyContent:"center",display:"flex",color:e.mediumTextColor},toggleButtonContainer:{paddingRight:d.device.isMobile?0:8,display:"flex"},filterIcon:{width:d.device.isMobile?18:16,fill:s||"resolved"===h?e.icon.uiBluePrimary:e.mediumIconColor}})),[s,h,d.device.isMobile]),j=Z().A.formatMessage(ne.filterLabel);return(0,r().K8)((()=>{d.device.isMobile||u?d.device.isMobile&&!p&&(q().setUpdateSidebarCommentsMode("unresolved"),i(void 0)):(q().setUpdateSidebarCommentsMode("unresolved"),i(void 0),S(!1))}),[p,d.device.isMobile,i,u]),(0,m.jsx)(W().Ay,{open:y,originGap:0,popupType:d.device.isMobile?ee().n.SlideUp:ee().n.Popup,renderOrigin:e=>(0,m.jsx)(G().A,{...e,placement:Q().W.Bottom,renderTooltip:()=>j,render:e=>(0,m.jsx)("div",{style:A.toggleButtonContainer,className:N().kJD,children:(0,m.jsx)(O().p,{...e,style:A.toggleButton,onClick:()=>{v(!0)},children:(0,E().S)(A.filterIcon)})})}),placementToOrigin:Q().W.Bottom,alignmentToOrigin:Q().C.Center,render:e=>(0,m.jsx)(ae,{userActorsForDisplay:g,actorForFilter:s,setActorForFilter:i,onMobileClose:()=>e.close(),currentCommentsMode:h,currentTypeMode:b,popupOpen:y,setPopupOpen:v,peopleFilterExpanded:x,setPeopleFilterExpanded:S,numCommenters:t.length}),onClose:()=>{v(!1)}})}var de=()=>s(351360),ce=()=>s(463830),ue=()=>s(508496);function me(e){let{userActors:t,actorForFilter:s,setActorForFilter:o}=e;const i=(0,a().IS)((e=>({container:{display:"flex",flexDirection:"column",borderBottom:`1px solid ${e.regularDividerColor}`},commentsHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",pointerEvents:"auto"},label:{lineHeight:"inherit",fontSize:14,color:e.regularTextColor,fontWeight:x().Wy.medium,display:"flex",alignItems:"center",margin:0,padding:"12px 12px 12px 16px"},notificationsLabel:{fontSize:x().J.UISmall.desktop,color:e.mediumTextColor,fontWeight:x().Wy.medium},notificationsBorder:{border:`1px solid ${e.outlineButtonBorder}`,borderRadius:4,marginTop:4},notificationsContainer:{padding:"0 16px 14px"}})),[]),n=(0,r().K8)((()=>"on"===ue().default.getEligibleGroup({experimentId:"remove_updates_topbar_button_v2",defaultGroup:"control",disableExposureLogging:!0})),[]),l=(0,r().K8)((()=>de().default.state.mainEditorCurrentBlockStore),[]),d=(0,r().uB)(void 0,ce().A);return(0,m.jsxs)("div",{style:i.container,children:[(0,m.jsxs)("div",{style:i.commentsHeader,className:N().S4C,children:[(0,m.jsx)("h2",{style:i.label,children:(0,m.jsx)(f().sA,{id:"updateSidebar.header.commentsAndSuggestionsLabel",defaultMessage:"Comments & suggestions"})}),(0,m.jsx)(le,{userActors:t,actorForFilter:s,setActorForFilter:o})]}),n&&l&&(0,m.jsxs)("div",{style:i.notificationsContainer,children:[(0,m.jsx)("div",{style:i.notificationsLabel,children:(0,m.jsx)(f().sA,{defaultMessage:"Notify me for",id:"topbarCommentsDesktop.notifications.label"})}),(0,m.jsx)("div",{style:i.notificationsBorder,children:(0,m.jsx)(P().O,{blockStore:l,moreProminentStyling:!0,from:"comments_sidebar",buttonPopupStore:d})})]})]})}var pe=()=>s(862292),ge=()=>s(449195),fe=()=>s(231722),ye=()=>s(299545),ve=()=>s(347199),xe=()=>s(953418),Se=()=>s(792002),he=()=>s(645873),be=()=>s(129522),Ae=()=>s(77126),je=()=>s(489348),Ce=()=>s(644914),Me=()=>s(756279),ke=()=>s(372154),we=()=>s(546574),Ie=()=>s(24157),Te=()=>s(704495),Be=()=>s(128973);function De(e){const t=(0,r().K8)((()=>T().A.state.isHovered),[]),s=(0,r().K8)((()=>T().A.state.isActivelyComposing),[]),o=(0,a().IS)((e=>({hoveredStyle:{background:e.hoveredDiscussionBackground},pressedStyle:{background:e.focusDiscussionBackground},basicDesktopTitleStyle:{paddingLeft:16,paddingTop:16,marginBottom:0,marginTop:0,fontSize:12,transition:"background 300ms ease"},mobileTitleStyle:{fontSize:13,fontWeight:x().Wy.medium,paddingBottom:0,textTransform:"unset",marginTop:-12}})),[]);return(0,m.jsx)(z().A,{desktopTitleStyle:{...o.basicDesktopTitleStyle,...t?o.hoveredStyle:{},...s?o.pressedStyle:{}},mobileTitleStyle:o.mobileTitleStyle,disableDesktopPadding:!0,disableMobileBorders:!0,...e})}var Fe=()=>s(423817);const _e=new(s(970585).A),Ke=50;function Ue(e){let{commentsMode:t,commentsType:s,actorForFilter:o}=e;const i=(0,f().tz)(),n=(0,r().K8)((()=>(0,l().lR)(i,o)),[i,o]);return(0,m.jsx)(m.Fragment,{children:((e,t)=>{if("unresolved"===e){if("commentsAndSuggestions"===t)return o?(0,m.jsx)(f().sA,{id:"updateSidebar.commentContainer.emptyUnresolvedCommentsAndSuggestionsForUser",defaultMessage:"No open comments or suggestions from {userName}",values:{userName:n}}):(0,m.jsx)(f().sA,{id:"updateSidebar.commentContainer.emptyUnresolvedCommentsAndSuggestions",defaultMessage:"No open comments or suggestions"});if("comments"===t)return o?(0,m.jsx)(f().sA,{id:"updateSidebar.commentContainer.emptyUnresolvedCommentsForUser",defaultMessage:"No open comments from {userName}",values:{userName:n}}):(0,m.jsx)(f().sA,{id:"updateSidebar.commentContainer.emptyUnresolvedComments",defaultMessage:"No open comments"});if("suggestions"===t)return o?(0,m.jsx)(f().sA,{id:"updateSidebar.commentContainer.emptyUnresolvedSuggestionsForUser",defaultMessage:"No open suggestions from {userName}",values:{userName:n}}):(0,m.jsx)(f().sA,{id:"updateSidebar.commentContainer.emptyUnresolvedSuggestions",defaultMessage:"No open suggestions"})}else{if("commentsAndSuggestions"===t)return o?(0,m.jsx)(f().sA,{id:"updateSidebar.commentContainer.emptyResolvedCommentsAndSuggestionsForUser",defaultMessage:"No resolved comments or suggestions from {userName}",values:{userName:n}}):(0,m.jsx)(f().sA,{id:"updateSidebar.commentContainer.emptyResolvedCommentsAndSuggestions",defaultMessage:"No resolved comments or suggestions"});if("comments"===t)return o?(0,m.jsx)(f().sA,{id:"updateSidebar.commentContainer.emptyResolvedCommentsForUser",defaultMessage:"No resolved comments from {userName}",values:{userName:n}}):(0,m.jsx)(f().sA,{id:"updateSidebar.commentContainer.emptyResolvedComments",defaultMessage:"No resolved comments"});if("suggestions"===t)return o?(0,m.jsx)(f().sA,{id:"updateSidebar.commentContainer.emptyResolvedSuggestionsForUser",defaultMessage:"No resolved suggestions from {userName}",values:{userName:n}}):(0,m.jsx)(f().sA,{id:"updateSidebar.commentContainer.emptyResolvedSuggestions",defaultMessage:"No resolved suggestions"})}})(t,s)})}function Ne(e){ve().A.UpdateSidebarCommentScroller=e}function Pe(e){const{timeViewed:t,location:s}=e,l=(0,n().v3)(),P=(0,n().Y0)(),[R,E]=(0,o.useState)(!1),[L,H]=(0,o.useState)(void 0),O=(0,r().K8)((()=>de().default.state.mainEditorCurrentBlockStore),[]),V=(0,r().K8)((()=>l.currentUser.id),[l]),{value:W}=(0,he().fJ)(A().commentsDependency),z=(0,r().K8)((()=>W?W.discussionHelpers.getDiscussionsForSidebar({blockStore:O,currentUserId:V,ignoreAfterTime:t}):[]),[W,O,t,V]),G=(0,r().K8)((()=>J().Ay.state.commentsMode),[]),$=(0,r().K8)((()=>J().Ay.state.commentsTypeMode),[]),q=(0,r().K8)((()=>(0,Ce().me)(l)),[l]),X=(0,r().K8)((()=>{const e=("comments"===$||"commentsAndSuggestions"===$)&&"unresolved"===G,t=(B().A.hasContent()||T().A.state.isActivelyComposing)&&B().A.isDraftCommentOnValidSelection();return(q||P.isMobile)&&t&&e&&B().A.ifPropertyCommentShouldDisplay()}),[G,$,P.isMobile,q]),Q=(0,r().K8)((()=>ke().A.state.open&&ke().A.state.discussionIds||[]),[]),ee=(0,r().K8)((()=>{const e="commentsAndSuggestions"===$?z:z.filter((e=>e.getType()===J().zX[$])),{resolved:t,unresolved:s}=(0,ye().uy)(e);return"unresolved"===G?s:t}),[z,$,G]),te=ee.map((e=>e.id)),se=(0,r().K8)((()=>L?ee.filter((e=>(0,ye().wc)(e).map((e=>e.getCreatedById())).some((e=>e===L.getActorUserId())))):ee),[ee,L]),oe=(0,r().K8)((()=>(0,w().getSetOfUsersInDiscussions)(ee)),[ee]);(0,o.useEffect)((()=>{if("popup"===s&&R)return()=>{we().A.markDiscussionsInteractedWith(te)}}),[s,te,R]);const ie=(0,a().IS)((e=>({commentsEmptyStyle:{flex:1,display:"flex",gap:11,alignItems:"center",justifyContent:"center",flexDirection:"column",textAlign:"center",fontSize:14,position:"relative",background:e.contentBackground,marginRight:0,pointerEvents:"auto",paddingTop:10},commentsContainerMessage:{fontWeight:x().Wy.semibold,color:e.mediumTextColor},commentsContentStyle:{position:"relative",minHeight:0,display:"flex",flexDirection:"column",background:e.contentBackground,marginRight:0,pointerEvents:"auto",height:"100%"},commentsIconStyle:{height:54,width:54,fill:e.mediumIconColor},addCommentButton:{borderRadius:6},scrollerStyle:{flexGrow:1,minHeight:0,transform:"translateZ(0px)",zIndex:1,overflow:"hidden auto",marginBottom:0}})),[]),ne=(0,o.useRef)(null),re=(0,r().K8)((()=>{if(!W)return{};const e=y().$z(se,(e=>{const s=W.discussionHelpers.getLatestRelevantComment({recordStore:e,currentUserId:V,timestamp:t});return s?(0,c().aD)(s.getCreatedTime()):""}));return delete e[""],e}),[W,se,t,V]),ae=(0,r().K8)((()=>!W||W.discussionHelpers.anyDiscussionCommentsLoading(se)),[W,se]),ce=(0,r().K8)((()=>{if(P.isMobile)return!1;if(!l.currentUser.isLoggedIn())return!1;if("suggestions"===$||"resolved"===G)return!1;if(null==O||!O.canComment())return!1;if(se.length>0)return!1;const e=Ie().default.getRootBlockStoreOfSelection();return!!(e&&"page"!==e.getType()||"section_hide"!==(0,ge().Rn)())}),[P.isMobile,$,G,O,se.length,l.currentUser]),ue=(0,o.useCallback)((async()=>{const e=Ie().default.getRootBlockStoreOfSelection(),t=e&&"page"!==e.getType()&&!e.isEmptyTitle()?"block":"page";switch(S().Bi(l,{target:t}),t){case"block":h().BM({environment:l,animate:!0}),await i().default.afterNextFlush();const s=await pe().T.formulas.load();return void(e&&function(e){const{environment:t,blockStore:s,formulasModule:o}=e,i=s.getModel();if(!s.isDefined()||null==i||!i.isType(d().uP))return;const n=s.getTitleStore(),r=n&&(0,Se().s6)(n);if(!(n&&r&&r.endIndex>0))return;(0,C().hN)({environment:t,blockStore:s,multiSelection:(0,fe().$U)({store:n,selection:{startIndex:0,endIndex:r.endIndex}}),rect:be().K.getRect(s),from:"updates_sidebar",formulasModule:o})}({environment:l,blockStore:e,formulasModule:s}));case"page":if(await i().default.afterNextFlush(),!1===B().A.state.open&&B().A.setState({open:!1,rect:new DOMRect,from:"updates_sidebar"}),!O)return;return je().A.openNewPageDiscussionInput(O),await i().default.afterNextFlush(),void function(e){const{blockStore:t,environment:s}=e;if(!t)return;const o=Ae().j.find((e=>e.getBlockStore().id===t.id));if(!o)return;const n=o.getNode(),r=o.getInputStore();if(!n)return;h().hT({element:n,environment:s,scrollerContext:{verticalScroller:ve().A.PageScroller,horizontalScroller:void 0},animate:!0,vertical:{reveal:"closest"},horizontal:void 0}),J().Ay.setState({...J().Ay.state,expanded:!1}),i().default.afterNextFlush((()=>{b().setSelectionAtEnd({store:r.state.textStore})}))}({blockStore:O,environment:l});default:(0,v().HB)(t)}}),[l,O]);(0,o.useEffect)((()=>{R||ae||E(!0)}),[R,ae]);const Pe=(0,o.useCallback)((()=>{T().A.setHoverWithSource("comments_pane"),I().A.reset()}),[]),Re=(0,o.useCallback)((()=>{T().A.resetHoverSource("comments_pane")}),[]),Ee=(0,r().K8)((()=>T().A.state.isActivelyComposing),[]);if(!O||!re||!R)return(0,m.jsx)(Fe().J,{areaHeight:window.innerHeight});const Le=(0,c().aD)(Date.now()),He=Object.keys(re).sort().reverse();!X||0!==He.length&&He.includes(Le)||He.unshift(Le);const Oe=He.map(((e,o)=>{const i=(0,c().ZF)({value:{type:"date",start_date:e},date_format:"relative",userTimeZone:(0,u().P)(),intl:Z().A.getIntl(),allowRelativeDates:!0}),n=re[e],r=X&&e===Le,a=[];r&&a.push({key:"draft-discussion-in-comments-pane",render:e=>(0,m.jsx)(k().A,{environment:l,shouldShowBottomDividerLine:!(1===He.length&&0===(null==n?void 0:n.length)),menuListItemProps:e,shouldExpandDiscussionWidth:!0,onMouseEnter:Pe,onMouseLeave:Re}),action:()=>{const e=B().A.getDiscussionInputStore();e&&(T().A.setActiveWithSource("comments_pane"),ke().A.reset(),(0,M().x)({currentBlockStore:O,discussionInputStore:e,environment:l,dontAffectCursor:Ee,animateScroll:!0}))}});const d=n?n.map(((e,i)=>{const a=e.getRecordStoreUIParent()??O,d={key:e.id,render:l=>(0,m.jsx)(Te().F,{...l,currentBlockStore:a,discussionStore:e,isFirstInSection:0===i&&!r,location:s,isLast:i===n.length-1&&o===He.length-1,showAllRepliesAfterTimestamp:t}),action:()=>{Ee&&T().A.resetAllActiveSources(),j().DZ({discussionStore:e,currentBlockStore:O,environment:l,analyticsFrom:"updates_sidebar",currentEl:ne.current})}};return d})):[];return a.push(...d),{key:e,render:e=>r?(0,m.jsx)(De,{title:i,...e}):(0,m.jsx)(Be().P,{title:i,firstItemId:n[0].id,location:s,ignoreFirstItemState:r,...e}),items:a}})),Ve=Oe.flatMap((e=>e.items)).findIndex((e=>Q.includes(e.key.toString()))),We=0!==se.length||X?(0,m.jsx)(U().H,{type:Me().A.Y,style:ie.scrollerStyle,className:N().bzV,ref:Ne,children:(0,m.jsx)(F().Ay,{disableKeyboard:!0,store:_e,type:F().Oh.Vertical,initialFocus:Ve>=0?Ve:void 0,scrollElIntoView:e=>{if(e instanceof Element){const t=e.getBoundingClientRect(),s=g().ek(l.device.isElectronMac),o=window.innerHeight,i=s+Ke,n=o-i;if(t.height>=n)return;const r=t.top>=i&&t.top<=o,a=r&&t.bottom>=o,d=t.bottom>=i&&t.bottom<=o,c=d&&t.top-i<0,u=r||d,m=.4*t.height;a&&Math.abs(t.top-o)<m?(0,xe().vq)(e,{edgeDist:o-t.height-i,animate:!0}):c&&Math.abs(t.bottom-i)<m?(0,xe().vq)(e,{edgeDist:0,animate:!0}):u||(0,xe().vq)(e,{edgeDist:0,animate:!0})}},sections:Oe})}):(0,m.jsx)("div",{style:ie.commentsContentStyle,children:(0,m.jsxs)("div",{style:ie.commentsEmptyStyle,children:[p(ie.commentsIconStyle),(0,m.jsx)("div",{style:ie.commentsContainerMessage,children:(0,m.jsx)(Ue,{commentsMode:G,commentsType:$,actorForFilter:L})}),ce&&(0,m.jsx)(K().A,{size:"lg",onClick:ue,style:ie.addCommentButton,children:(0,m.jsx)(f().sA,{id:"updateSidebar.commentContainer.emptyCommentsButton",defaultMessage:"Add comment"})})]})});return l.device.isMobile?(0,m.jsx)(D().A,{menuType:Y().gu.Modal,scrollerStyle:{paddingBottom:0},title:(0,m.jsx)(f().sA,{defaultMessage:"Comments & suggestions",id:"topbarMobile.commentsAndSuggestionsMenu.title"}),left:(0,m.jsx)(le,{userActors:oe,actorForFilter:L,setActorForFilter:H}),leftOuterStyle:{position:"relative",marginLeft:-4,paddingRight:4},right:(0,m.jsx)(_().DoneMenuText,{}),onClickRight:e.onMobileClose,children:We}):(0,m.jsxs)("div",{style:ie.commentsContentStyle,ref:ne,children:[(0,m.jsx)(me,{userActors:oe,actorForFilter:L,setActorForFilter:H}),We]})}},457190:(e,t,s)=>{s.d(t,{v:()=>a});var o=()=>s(835338),i=()=>s(848259),n=()=>s(246826),r=()=>s(317909);function a(e){const{environment:t,key:s,selectedKey:a,following:l,followSettings:d,navigableBlockId:c,userId:u,spaceId:m,from:p}=e;r().createAndCommit({userAction:"UpdateSidebarFollowControl.setFollowing",environment:e.environment,canUndo:!1,perform:t=>{n().vt({environment:e.environment,table:o().Cy,args:{following:l,followSettings:d,navigableBlockId:c,userId:u,spaceId:m},inMemoryRecordCache:e.environment.defaultRecordCache.inMemoryRecordCache,transaction:t})}}),l?i().KN(t,{from:"page_updates"}):i().tm(t,{from:"page_updates"}),a!==s&&i().EV(t,{from:p,navigableBlockId:c,oldSetting:a,newSetting:s})}},538075:(e,t,s)=>{s.d(t,{H8:()=>y,I7:()=>x,aE:()=>f});s(296540);var o=()=>s(66689),i=()=>s(413267),n=()=>s(959013),r=()=>s(534177),a=()=>s(416726),l=()=>s(457190),d=()=>s(436572),c=()=>s(575143),u=()=>s(351360),m=()=>s(518773),p=s(474848);const g=(0,n().YK)({repliesAndMentions:{id:"pageNotificationSettings.repliesAndMentions.displayName",defaultMessage:"Mentions"},comments:{id:"pageNotificationSettings.comments.displayName",defaultMessage:"Comments"},allUpdates:{id:"pageNotificationSettings.allUpdates.displayName",defaultMessage:"All"},importantUpdates:{id:"pageNotificationSettings.importantUpdates.displayName",defaultMessage:"Important"}});function f(e){switch(e){case"Mentions":return g.repliesAndMentions;case"Comments":return g.comments;case"All":return g.allUpdates;case"Important":return g.importantUpdates;default:return}}function y(e){const{followSettingsKey:t,environment:s,blockStore:i,from:r}=e,a=v({key:"none",selectedKey:t,title:(0,p.jsx)(n().sA,{id:"GetNotifiedDropdown.repliesAndMentions.label",defaultMessage:"Replies and @mentions"}),displayName:g.repliesAndMentions,environment:s,blockStore:i,from:r}),l=v({key:"comments",selectedKey:t,title:(0,p.jsx)(n().sA,{id:"GetNotifiedDropdown.allComments.label",defaultMessage:"All comments"}),displayName:g.comments,environment:s,blockStore:i,from:r}),d=v({key:"all",selectedKey:t,title:(0,p.jsx)(n().sA,{id:"GetNotifiedDropdown.allUpdates.label",defaultMessage:"All updates"}),caption:(0,p.jsx)(n().sA,{id:"GetNotifiedDropdown.simpleAllUpdates.caption",defaultMessage:"All comments and property changes"}),displayName:g.allUpdates,environment:s,blockStore:i,from:r}),c=i.getAssociatedCollectionStore();if(!c)return[l,a];const u=c.getDatabaseType();if(u===o().dC){return[d,v({key:"important",selectedKey:t,title:(0,p.jsx)(n().sA,{id:"GetNotifiedDropdown.importantUpdatesTasks.label",defaultMessage:"Important updates"}),caption:(0,p.jsx)(n().sA,{id:"GetNotifiedDropdown.importantUpdatesTasks.caption",defaultMessage:"All comments and changes to Status, Assignee, or Due Date"}),displayName:g.importantUpdates,environment:s,blockStore:i,from:r}),a]}if(u===o().Tw){return[d,v({key:"important",selectedKey:t,title:(0,p.jsx)(n().sA,{id:"GetNotifiedDropdown.importantUpdatesProjects.label",defaultMessage:"Important updates"}),caption:(0,p.jsx)(n().sA,{id:"GetNotifiedDropdown.importantUpdatesProjects.caption",defaultMessage:"All comments and changes to Status or Date"}),displayName:g.importantUpdates,environment:s,blockStore:i,from:r}),a]}return[d,v({key:"comments",selectedKey:t,title:(0,p.jsx)(n().sA,{id:"GetNotifiedDropdown.onlyCommentsAllComments.label",defaultMessage:"All comments"}),displayName:g.comments,environment:s,blockStore:i,from:r}),a]}function v(e){const{key:t,title:s,caption:o,selectedKey:n,environment:r,blockStore:g,from:f,displayName:y}=e,v=x({key:t,userSelectedKey:n}),h={icon:{width:14,height:14},rightWrapper:o?{alignSelf:"flex-start",paddingTop:2}:{}};return{action:(0,a().Ls)({key:t,displayName:y,analyticsName:t,validators:[],closeParentMenu:!0,action:()=>{const{currentUserRootStore:e}=u().default.state;if(e){const{following:s,followSettings:o}=(0,m().A)(t),i=e.id,a=g.id,c=g.getSpaceId();l().v({environment:r,following:s,followSettings:o,navigableBlockId:a,spaceId:c,userId:i,from:f,key:t,selectedKey:n}),"inbox"!==f&&"more_menu"!==f||d().rL({item:{label:S(t)},undoFunc:()=>{const{following:e,followSettings:s}=(0,m().A)(n);l().v({environment:r,following:e,followSettings:s,navigableBlockId:a,spaceId:c,userId:i,from:f,key:t,selectedKey:n})}})}},render:e=>(0,p.jsx)(c().A,{...e,title:s,caption:o,shouldWrapCaption:!0,right:v?(0,i().b)(h.icon):(0,p.jsx)("div",{style:h.icon}),rightStyle:h.right})}),title:s,isSelectedOption:v}}function x(e){const{key:t,userSelectedKey:s}=e;return"important"===s||"comments"===s?"important"===t||"comments"===t:t===s}function S(e){switch(e){case"none":return(0,p.jsx)(n().sA,{id:"GetNotifiedDropdown.subscribedRepliesAndMentionsSuccess.snackbarMessage",defaultMessage:"Subscribed to replies and @mentions"});case"comments":return(0,p.jsx)(n().sA,{id:"GetNotifiedDropdown.subscribedAllCommentsSuccess.snackbarMessage",defaultMessage:"Subscribed to all comments"});case"important":return(0,p.jsx)(n().sA,{id:"GetNotifiedDropdown.subscribedImportantUpdatesSuccess.snackbarMessage",defaultMessage:"Subscribed to important updates"});case"all":return(0,p.jsx)(n().sA,{id:"GetNotifiedDropdown.subscribedAllUpdatesSuccess.snackbarMessage",defaultMessage:"Subscribed to all updates"});default:(0,r().HB)(e)}}},687110:(e,t,s)=>{s.r(t),s.d(t,{PageAnalyticsPageOptOut:()=>x,TopbarPageAnalyticsOptOutMenu:()=>v,TopbarPageAnalyticsOptOutMenuStore:()=>y});s(296540);var o=()=>s(484714),i=()=>s(56366),n=()=>s(959013),r=()=>s(72234),a=()=>s(836251),l=()=>s(962730),d=()=>s(377586),c=()=>s(351360),u=()=>s(364280),m=()=>s(14235),p=()=>s(719147),g=()=>s(702723),f=s(474848);const y=s(757695).default.createValue({isOpen:!1,rect:void 0},{name:"TopbarPageAnalyticsOptOutMenuStore"});function v(){const e=(0,o().v3)(),t=(0,i().K8)((()=>y.state.isOpen),[]),s=(0,i().K8)((()=>y.state.rect),[]),r=(0,i().K8)((()=>c().default.state.mainEditorCurrentBlockStore),[]);return r?(0,f.jsx)(m().Ay,{popupType:e.device.isMobile?d().n.SlideUp:d().n.Popup,alignmentToOrigin:l().C.Center,open:t,render:()=>(0,f.jsx)("div",{style:{minWidth:360,padding:16},children:(0,f.jsxs)(u().VP,{gap:16,children:[(0,f.jsx)("div",{style:{fontSize:16,fontWeight:500},children:(0,f.jsx)(n().sA,{id:"TopbarPageAnalyticsOptOutMenu.heading",defaultMessage:"Privacy settings"})}),(0,f.jsx)(x,{store:r})]})}),originRect:s,onDismiss:()=>y.setState({isOpen:!1,rect:void 0})}):null}function x(e){const t=(0,o().v3)(),s=(0,i().K8)((()=>{const e=c().default.state.currentSpaceViewStore;return null==e?void 0:e.getSettings()}),[]),l=(0,i().K8)((()=>{const t=null==s?void 0:s.page_analytics_opt_out_list;return null==t?void 0:t.includes(e.store.id)}),[s,e.store.id]);return(0,f.jsx)(g().A,{type:"dropdown",currentOption:l?"do_not_record":"record",options:[{key:"record",label:(0,f.jsx)(n().sA,{id:"page_analytics.opt_out.record",defaultMessage:"Record"})},{key:"do_not_record",label:(0,f.jsx)(n().sA,{id:"page_analytics.opt_out.do_not_record",defaultMessage:"Don't record"})}],onSelectOption:s=>{"do_not_record"===s?r().Oy(t,e.store.id):r().F3(t,e.store.id)},isMobile:t.device.isMobile,title:(0,f.jsx)(n().sA,{id:"page_analytics.opt_out.title",defaultMessage:"My view history"}),caption:(0,f.jsx)(n().sA,{id:"page_analytics.opt_out.caption",defaultMessage:"Page editors can see my view history for this page. <inlinelink>Learn more</inlinelink>.",values:{inlinelink:e=>(0,f.jsx)(p().A,{external:!0,href:(0,a().xS)("guides.pageAnalytics"),children:e})}}),captionStyle:{maxWidth:270}})}},704495:(e,t,s)=>{s.d(t,{F:()=>d});var o=s(296540),i=()=>s(56366),n=()=>s(774733),r=()=>s(94953),a=()=>s(372154),l=s(474848);const d=o.forwardRef((function(e,t){const{currentBlockStore:d,discussionStore:c,showAllRepliesAfterTimestamp:u,focused:m,isLast:p,location:g}=e,f=(0,i().K8)((()=>a().A.state.open&&a().A.state.discussionIds||[]),[]),y=(0,s(484714).v3)();(0,o.useEffect)((()=>{var e;if(m){r().A.setState({source:"update_sidebar",discussionIds:[c.id]});const e=setTimeout((()=>{var e;(null===(e=r().A.state)||void 0===e||null===(e=e.discussionIds)||void 0===e?void 0:e[0])===c.id&&s(546574).A.markDiscussionsInteractedWith([c.id])}),1500);return()=>{clearTimeout(e)}}(null===(e=r().A.state)||void 0===e||null===(e=e.discussionIds)||void 0===e?void 0:e[0])===c.id&&r().A.setState({discussionIds:[]})}),[m,c,y]);const v=(0,i().K8)((()=>{var e;return(null===(e=r().A.state)||void 0===e?void 0:e.discussionIds)||[]}),[]),x=c.id,{parentId:S,currentSpaceId:h}=(0,i().K8)((()=>({parentId:c.getParentId(),currentSpaceId:c.getSpaceId()})),[c]),b=S?s(630116).Bv.createChildStore(c,{table:s(179034).ev,id:S}):void 0,A=f.includes(x),j=v.includes(x),C=(0,s(401497).IS)((e=>({discussionContainer:{paddingTop:y.device.isMobile?4:6,borderBottom:p||y.device.isMobile?void 0:`1px solid ${e.regularDividerColor}`,transition:"background 300ms ease"},replyButton:{color:e.blueColor,marginLeft:23,fontSize:14},hoveredStyle:{background:"sidebar"===g?e.hoveredDiscussionBackground:void 0},pressedStyle:{background:"sidebar"===g?e.focusDiscussionBackground:void 0},menuStyle:{marginLeft:-12,marginRight:-12,width:"calc(100% + 28px)",lineHeight:void 0,cursor:"pointer"}})),[y.device.isMobile,p,g]),{value:M}=(0,s(645873).fJ)(n().commentsDependency);if(!M)return null;if(!b||!h)return null;const k=(0,l.jsx)("div",{className:`sidebar-discussion-${x} ${s(38337)._57}`,onClick:e.onClick,onMouseEnter:e.onMouseEnter,ref:t,style:{...C.discussionContainer,...j?C.hoveredStyle:{},...A?C.pressedStyle:{}},children:(0,l.jsx)(n().PW,{store:c,blockStore:d,format:M.discussionHelpers.DiscussionFormat.Sidebar,isFirst:!1,isOnly:!1,showResolveButtonByDefaultIfPossible:!1,discussionLocation:"updates_sidebar",showAllRepliesAfterTimestamp:u})});return(0,l.jsx)(s(678553).A,{allowTextSelection:!0,title:k,style:C.menuStyle})}))},709687:(e,t,s)=>{s.d(t,{r:()=>i});s(296540);var o=s(474848);const i=(0,s(340498).wt)("bell",{viewBox:"0 0 16 16",svg:(0,o.jsx)("path",{d:"M1.36914 11.7627C1.36914 12.3369 1.80664 12.7266 2.51074 12.7266H5.32031C5.38184 14.0322 6.44824 15.2285 8 15.2285C9.55176 15.2285 10.6182 14.0391 10.6797 12.7266H13.4893C14.2002 12.7266 14.6309 12.3369 14.6309 11.7627C14.6309 11.0381 13.9678 10.416 13.3457 9.81445C12.8672 9.34277 12.751 8.39941 12.6621 7.46289C12.5732 4.87207 11.8213 3.14258 10.0371 2.49316C9.77734 1.59082 9.01855 0.900391 8 0.900391C6.98145 0.900391 6.22266 1.59082 5.96289 2.49316C4.17871 3.14258 3.42676 4.87207 3.33789 7.46289C3.24902 8.39941 3.13965 9.34277 2.6543 9.81445C2.03906 10.416 1.36914 11.0381 1.36914 11.7627ZM3.00293 11.4756V11.3936C3.18066 11.1953 3.57715 10.833 3.91211 10.4434C4.38379 9.90332 4.60254 8.92578 4.6709 7.62695C4.75293 4.85156 5.60059 3.92871 6.70801 3.62793C6.87207 3.58691 6.96777 3.50488 6.98145 3.32031C7.01562 2.62305 7.39844 2.1582 8 2.1582C8.60156 2.1582 8.99121 2.62305 9.01855 3.32031C9.03223 3.50488 9.12793 3.58691 9.29883 3.62793C10.3994 3.92871 11.2539 4.85156 11.3291 7.62695C11.3975 8.92578 11.623 9.90332 12.0879 10.4434C12.4297 10.833 12.8125 11.1953 12.9834 11.3936V11.4756H3.00293ZM6.6123 12.7266H9.3877C9.33984 13.5811 8.7793 14.1348 8 14.1348C7.22754 14.1348 6.66699 13.5811 6.6123 12.7266Z"})})},750420:(e,t,s)=>{s.d(t,{f2:()=>x,Oi:()=>S,HX:()=>v,Ay:()=>h});s(296540);var o=()=>s(484714),i=()=>s(56366),n=()=>s(401497),r=()=>s(175947),a=()=>s(959013),l=()=>s(284371),d=()=>s(987017),c=()=>s(38337),u=()=>s(737230),m=()=>s(508496),p=()=>s(187959);const g=new(s(463830).A);var f=()=>s(577009),y=s(474848);function v(){return(0,y.jsx)(a().sA,{id:"updateSidebar.header.updatesLabel",defaultMessage:"Updates"})}function x(){return(0,y.jsx)(a().sA,{id:"updateSidebar.header.analyticsLabel",defaultMessage:"Analytics"},"analytics")}const S="UpdateSidebar";function h(e){const t=(0,o().v3)(),{enablePageAnalytics:s,navigableBlockStore:a,inPeekView:h,noTopMargin:b}=e,A=(0,n().IS)((e=>({updatesHeaderStyle:{position:"relative",pointerEvents:"auto",marginTop:b?0:r().ek(t.device.isElectronMac),paddingTop:4,width:"100%",background:h?e.popoverBackground:e.contentBackground,padding:"12px 12px 12px 16px",borderBottom:`1px solid ${e.regularDividerColor}`},getNotifiedFor:{...s?{padding:8}:{paddingBottom:14}},label:{fontSize:14,color:e.regularTextColor,fontWeight:l().Wy.medium}})),[b,t.device.isElectronMac,h,s]),j=(0,i().K8)((()=>u().Ay.state.updatesSubTab),[]),C=h?g:p().A,M=(0,i().K8)((()=>"on"===m().default.getEligibleGroup({experimentId:"remove_updates_topbar_button_v2",defaultGroup:"control",disableExposureLogging:!0})),[]);return(0,y.jsxs)("div",{style:{...A.updatesHeaderStyle,...s?{padding:"0 6px"}:{}},className:c().Kbf,children:[!M&&(0,y.jsx)(f().QB,{navigableBlockStore:a,from:"page_updates",buttonPopupStore:C,style:A.getNotifiedFor}),s?(0,y.jsx)(d().Ay,{tabs:[(0,y.jsx)(v,{},"updates"),(0,y.jsx)(x,{},"analytics")],selectedIndex:j,onChange:e.onTabChange,style:{...A.label,padding:0,boxShadow:"none"},tabStyle:{padding:"12px 0"},idPrefix:S}):(0,y.jsx)("div",{style:A.label,children:(0,y.jsx)(v,{})})]})}},756214:(e,t,s)=>{s.d(t,{R:()=>r});s(898992),s(354520),s(581454),s(737550);var o=()=>s(919709);function i(e){const{userId:t,isFollowingPage:s,discussions:i,discussionToComments:n,groupIdsUserIsIn:r}=e,a=s?i:i.filter((e=>function(e){const{userId:t,comments:s,groupIdsUserIsIn:i}=e;return Boolean(s.some((e=>e.getCreatedById()===t||function(e){const{userId:t,comment:s,groupIdsUserIsIn:i}=e,n=o().Fbh(s.getText());if(n.includes(t))return!0;const r=o().FAS(s.getText());if(r.some((e=>i.has(e.groupId))))return!0;return!1}({userId:t,comment:e,groupIdsUserIsIn:i}))))}({userId:t,comments:n(e),groupIdsUserIsIn:r})));return a.filter((e=>function(e){const{userId:t,comments:s}=e;return Boolean(s.some((e=>e.getCreatedById()&&e.getCreatedById()!==t)))}({userId:t,comments:n(e)})))}var n=()=>s(534177);function r(e){var t;const{userId:s,blockStore:o,discussionStores:r,groupIdsUserIsIn:a}=e;return i({userId:s,isFollowingPage:Boolean(null===(t=o.getFollowStore())||void 0===t||null===(t=t.getModel())||void 0===t?void 0:t.isFollowingAllComments()),discussions:r,discussionToComments:e=>e.getCommentStores().map((e=>e.getModel())).filter(n().O9),groupIdsUserIsIn:a})}},891919:(e,t,s)=>{s.d(t,{N:()=>S,P:()=>A});s(898992),s(354520),s(581454);var o=s(296540),i=()=>s(484714),n=()=>s(56366),r=()=>s(401497),a=()=>s(774733),l=()=>s(789557),d=()=>s(939740),c=()=>s(2143),u=()=>s(38337),m=()=>s(347199),p=()=>s(645873),g=()=>s(756279),f=()=>s(486130),y=()=>s(756214),v=()=>s(128973),x=s(474848);function S(e){const{navigableBlockStore:t}=e,s=(0,i().v3)(),a=(0,n().K8)((()=>s.currentUser.id),[s]),m=A({navigableBlockStore:t,currentUserId:a}),p=(0,r().IS)((e=>({commentsContentStyle:{position:"relative",minHeight:0,display:"flex",flexDirection:"column",background:e.contentBackground,marginRight:0,pointerEvents:"auto",height:"100%"},scrollerStyle:{flexGrow:1,minHeight:0,transform:"translateZ(0px)",zIndex:1,overflow:"hidden auto",marginBottom:0}})),[]),f=(0,o.useRef)(null);return(0,x.jsx)("div",{style:p.commentsContentStyle,ref:f,children:(0,x.jsx)(c().H,{type:g().A.Y,style:p.scrollerStyle,className:u().bzV,ref:b,children:t&&(0,x.jsx)(d().Ay,{initialFocus:0,type:d().Oh.Vertical,sections:[{key:0,render:e=>(0,x.jsx)(v().P,{location:"sidebar",...e}),items:m.map((e=>({key:e.id,render:s=>{let{ref:i,...n}=s;return(0,o.createElement)(h,{...n,key:e.id,discussionStore:e,navigableBlockStore:t})},action:()=>l().DZ({discussionStore:e,currentBlockStore:t,environment:s,analyticsFrom:"updates_sidebar",currentEl:f.current})})))}]})})})}const h=o.memo(o.forwardRef((function(e,t){const{discussionStore:o,navigableBlockStore:i,...r}=e,a=(0,n().K8)((()=>o.getRecordStoreUIParent()),[o]),l=a instanceof s(630116).Bv?a:i;return(0,x.jsx)("div",{children:(0,x.jsx)(s(704495).F,{...r,ref:t,currentBlockStore:l,discussionStore:o,isFirstInSection:!0,isLast:!0,location:"sidebar",showAllRepliesAfterTimestamp:void 0})})})));function b(e){m().A.UpdateSidebarCommentScroller=e}function A(e){const{navigableBlockStore:t,currentUserId:s}=e,{value:o}=(0,p().fJ)(a().commentsDependency),i=(0,n().K8)((()=>t&&o?o.discussionHelpers.getDiscussionsForSidebar({blockStore:t,currentUserId:s,ignoreAfterTime:0}):[]),[o,t,s]),r=(0,n().K8)((()=>s&&t?(0,y().R)({userId:s,blockStore:t,discussionStores:i,groupIdsUserIsIn:f()._.getSpacePermissionGroupIds({userId:s,spaceId:t.getSpaceId()})}):[]),[s,t,i]);return(0,n().K8)((()=>r.filter((e=>e.isUnread()))),[r])}},920713:(e,t,s)=>{s.d(t,{B:()=>i});s(296540);var o=s(474848);const i=(0,s(340498).wt)("codeFile",{viewBox:"0 0 23 24",svg:(0,o.jsx)("path",{d:"M4.195 11.86c0-.266.078-.488.235-.665.156-.182.38-.3.672-.351.494-.089.849-.271 1.062-.547.214-.281.32-.73.32-1.344V6.961c0-1.115.263-1.938.79-2.469.525-.536 1.333-.804 2.421-.804.203 0 .375.023.516.07.177.057.31.146.398.265a.646.646 0 01.141.422c0 .339-.148.558-.445.657a1.14 1.14 0 01-.157.039l-.171.015c-.625.047-1.066.222-1.32.524-.256.302-.384.8-.384 1.492v2.414c0 .672-.182 1.198-.546 1.578-.36.38-.86.604-1.5.672-.032 0-.047.013-.047.039.005.02.02.034.047.04.64.062 1.14.283 1.5.663.364.38.546.906.546 1.578v2.414c0 .693.128 1.19.383 1.492.255.303.696.48 1.32.532.053 0 .1.002.141.008l.133.03c.333.09.5.308.5.657a.68.68 0 01-.14.43.816.816 0 01-.407.273 1.48 1.48 0 01-.437.063c-1.12 0-1.948-.266-2.485-.797-.531-.526-.797-1.352-.797-2.477V14.79c0-.614-.106-1.062-.32-1.344-.213-.28-.568-.463-1.062-.547-.292-.062-.516-.182-.672-.359-.157-.177-.235-.404-.235-.68zm15.602 0c0 .275-.078.502-.235.68-.156.176-.382.296-.68.358-.5.084-.856.266-1.07.547-.208.282-.312.73-.312 1.344v1.992c0 1.125-.266 1.95-.797 2.477-.531.531-1.36.797-2.484.797-.151 0-.297-.021-.438-.063a.757.757 0 01-.414-.265.715.715 0 01-.133-.438c0-.182.042-.328.125-.437a.674.674 0 01.383-.22l.117-.03c.047-.006.097-.008.149-.008.625-.052 1.065-.23 1.32-.532.255-.302.383-.799.383-1.492v-2.414c0-.672.182-1.208.547-1.61.364-.405.864-.616 1.5-.632.026-.005.039-.018.039-.039 0-.026-.013-.04-.04-.04-.635-.015-1.135-.226-1.5-.632-.364-.406-.546-.945-.546-1.617V7.172c0-.693-.128-1.193-.383-1.5-.255-.307-.695-.48-1.32-.516l-.18-.015a1.233 1.233 0 01-.148-.04c-.297-.109-.446-.328-.446-.656 0-.166.045-.307.133-.422a.777.777 0 01.414-.265c.14-.047.31-.07.508-.07 1.089 0 1.896.268 2.422.804.526.531.789 1.354.789 2.469v1.992c0 .615.107 1.06.32 1.336.214.276.568.461 1.063.555.297.052.523.169.68.351a.967.967 0 01.234.664z"})})}}]);