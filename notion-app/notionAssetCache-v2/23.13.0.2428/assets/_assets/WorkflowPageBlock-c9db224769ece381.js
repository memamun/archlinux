"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[11097,87700],{173019:(e,t,n)=>{n.d(t,{r:()=>o});n(296540);var r=n(474848);const o=(0,n(340498).wt)("pencil",{viewBox:"0 0 16 16",svg:(0,r.jsx)("path",{d:"M3.926 13.307H14.11c.183 0 .34-.066.472-.199a.644.644 0 00.198-.471.652.652 0 00-.198-.479.644.644 0 00-.472-.198H5.272l-1.346 1.347zm-.704-.636l7.683-7.684-1.312-1.319-7.69 7.684-.67 1.606c-.037.1-.017.191.06.273.083.082.174.105.274.069l1.655-.63zm8.34-8.326l.738-.732c.182-.187.278-.376.287-.567.009-.192-.068-.374-.232-.547l-.267-.267c-.169-.168-.351-.246-.547-.232-.196.014-.385.11-.567.287l-.739.732 1.327 1.326z"})})},390527:(e,t,n)=>{n.r(t),n.d(t,{DEFAULT_MAX_RECURRENCE_DUPLICATION_PER_TASK:()=>N,MAXIMUM_DAILY_RECURRENCES_IN_PATH:()=>R,MAXIMUM_NESTED_RECURRENCE_LEVEL:()=>M,MAX_RECURRENCE_INTERVAL:()=>w,MAX_RECURRENCE_NUMBER_OF_RUNS:()=>v,RRULE_WEEKDAYS_MAP:()=>_,adjustedStartDateIfPossible:()=>b,areRecurrenceSchedulesEqual:()=>B,convertFromUnpersistedRecurrenceConfig:()=>H,convertToUnpersistedRecurrenceConfig:()=>x,getFormattedEndCondition:()=>U,getFormattedNextRecurrenceTime:()=>T,getNewEndTimestamp:()=>S,getNextDateUtc:()=>D,getRecurrenceAfter:()=>k,isRunningBetweenMidnightAnd3AM:()=>C,isValidRecurrenceInterval:()=>y,isValidRecurrenceNumberOfRuns:()=>g,rruleFromRecurrence:()=>E,templateAncestorsViolateRecurrenceNesting:()=>A});n(898992),n(354520),n(581454);var r=()=>n(244641);n(944114);function o(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(0===n.length)return e.map((e=>[e]));const i=[];for(const a of e)i.push(...o(n[0],...n.slice(1)).map((e=>[a,...e])));return i}var i=()=>n(496603),a=()=>n(534177),c=()=>n(720665),d=()=>n(597777),s=()=>n(869190),l=()=>n(416504),u=()=>n(402390);class f extends(()=>n(896346))().p3{constructor(e,t){super(e,t)}after(e,t){return super.after(e,t)}}var m=()=>n(912720);const p=(0,n(959013).YK)({dateAtTime:{id:"automations.recurrenceHelpers.dateAtTime",defaultMessage:"{date} at {time}"},dateBetweenMidnightAnd3AM:{id:"automations.recurrenceHelpers.dateBetweenMidnightAnd3AM",defaultMessage:"{date} between 12â€“3 AM"},numberEndConditionDescription:{id:"automations.recurrenceHelpers.numberEndConditionDescription",defaultMessage:"{number, plural, one {After {number} run} other {After {number} runs}}"},noEndCondition:{id:"automations.recurrenceHelpers.noEndCondition",defaultMessage:"Never"}}),h={day:f.DAILY,week:f.WEEKLY,month:f.MONTHLY,year:f.YEARLY},_={MO:f.MO,TU:f.TU,WE:f.WE,TH:f.TH,FR:f.FR,SA:f.SA,SU:f.SU},w=99,v=999;function y(e){return(0,c().Et)(e)&&Number.isInteger(e)&&e>0&&e<=w}function g(e){return(0,c().Et)(e)&&Number.isInteger(e)&&e>0&&e<=v}function E(e){const{start_date:t,frequency:n,interval:r,weekdays:i,timezone:c,hour:s,minute:l}=e,u="week"===n&&i?i.map((e=>_[e])):void 0,m={};return(0,a().O9)(e.end_condition)&&("date"===e.end_condition.type?m.until=(0,d().eU)(e.end_condition.end_at):"number"===e.end_condition.type?m.count=e.end_condition.number_of_occurrences:(0,a().HB)(e.end_condition)),"month"===e.frequency&&(0,a().O9)(e.monthly_restriction)&&("monthdays"===e.monthly_restriction.type?m.bymonthday=e.monthly_restriction.monthdays:"weekdays_in_month"===e.monthly_restriction.type?m.byweekday=o(e.monthly_restriction.weekdays,e.monthly_restriction.week_numbers).map((e=>{let[t,n]=e;return _[t].nth(n)})):(0,a().HB)(e.monthly_restriction)),new f({freq:h[n],dtstart:(0,d().eU)(t),interval:r,byweekday:u,tzid:c,byhour:s??0,byminute:l??0,bysecond:0,...m})}const M=1,R=1;function A(e){var t;if(0===e.length)return{violatesConstraint:!1,templateNestingExceedsMaxDepth:!1,ancestorHasDailyTemplate:!1,nestedDepthOfAutomationAncestors:void 0,immediateAncestorRecurrenceType:void 0};const n=e.filter((e=>{var t;return"day"===(null===(t=e.getRecurrence())||void 0===t?void 0:t.frequency)})),r=e.length,o=null===(t=e[0].getRecurrence())||void 0===t?void 0:t.frequency,i=r>M,a=n.length>=R;return{violatesConstraint:i||a,templateNestingExceedsMaxDepth:i,ancestorHasDailyTemplate:a,nestedDepthOfAutomationAncestors:r,immediateAncestorRecurrenceType:o}}function b(e){var t;const{recurrence:n,afterDate:o}=e;if("number"===(null===(t=n.end_condition)||void 0===t?void 0:t.type)||n.start_date>=o)return n;let i=r().c9.fromMillis(n.start_date,{zone:"utc"});const a=r().c9.fromMillis(o,{zone:"utc"});switch(n.frequency){case"year":{const e=Math.floor(a.diff(i,"years").years/n.interval);i=i.plus({years:e*n.interval});break}case"month":{const e=Math.floor(a.diff(i,"months").months/n.interval);i=i.plus({months:e*n.interval});break}case"week":{const e=Math.floor(a.diff(i,"weeks").weeks/n.interval);i=i.plus({weeks:e*n.interval});break}case"day":{const e=Math.floor(a.diff(i,"days").days/n.interval);i=i.plus({days:e*n.interval});break}}return{...n,start_date:(0,d().DH)(i.toMillis())}}function k(e){const{recurrence:t,afterDate:n}=e;if((0,m().wt)(t)){const e=(0,d().l1)(n);return t.start_date>=e?new Date(t.start_date):void 0}{const e=E(b({recurrence:t,afterDate:n})).after((0,d().eU)(n));if(!e)return;return(0,d().h1)(e)}}function C(e){return 0===e.hour||1===e.hour||2===e.hour}function D(e){return E(e).after((0,d().eU)((0,d().Rz)()))||void 0}function T(e){const{recurrence:t,intl:n}=e,o=D(H(t));if(!o)return;const i=C(t),a=r().c9.fromJSDate(o).toUTC().setZone("local",{keepLocalTime:!0}).setLocale((0,u().H)(n)).setZone(t.timezone),c=(0,s().Yq)({date:a,dateFormat:"relative",allowRelativeDates:!0,intl:n,shortenDate:!0});if(i)return n.formatMessage(p.dateBetweenMidnightAnd3AM,{date:c});{let e=a.toLocaleString(r().c9.TIME_SIMPLE);return t.timezone!==(0,l().P)()&&(e+=` ${a.toFormat("ZZZZ")}`),n.formatMessage(p.dateAtTime,{date:c,time:e})}}function U(e,t){return(0,a().O9)(e)?"number"===e.type?t.formatMessage(p.numberEndConditionDescription,{number:e.number_of_occurrences}):"date"===e.type?(0,s().Yq)({date:r().c9.fromMillis(e.end_at),dateFormat:"relative",allowRelativeDates:!0,intl:t,shortenDate:!0}):void(0,a().HB)(e):t.formatMessage(p.noEndCondition)}const N=100;function x(e){return{...e,start_date:(0,d().l1)(e.start_date),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?{type:"date",end_at:(0,d().l1)(e.end_condition.end_at)}:(0,a().HB)(e.end_condition):void 0}}function S(e,t,n){return e.plus(n-t)}function I(e,t){const n=r().c9.fromMillis(t.end_at).set({hour:e.hour??0,minute:e.minute??0});return{type:"date",end_at:(0,d().Rz)(n.toJSDate())}}function H(e){return{...e,start_date:(0,d().Rz)(new Date(e.start_date)),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?I(e,e.end_condition):(0,a().HB)(e.end_condition):void 0}}function B(e,t){const n=i().fN(e,(e=>void 0!==e)),r=i().fN(t,(e=>void 0!==e));return i().n4(n,r)}},885789:(e,t,n)=>{n.r(t),n.d(t,{default:()=>c});n(16280),n(581454);var r=n(296540),o=()=>n(56366),i=()=>n(630116),a=n(474848);const c=function(e){const{store:t}=e,c=(0,n(401497).IS)((e=>({wrap:{width:"100%",height:"100%",overflow:"hidden",padding:"36px 0px 0px 96px",fontSize:14,display:"flex",flexDirection:"column",alignItems:"start"}})),[]),d=(0,o().K8)((()=>{var e;const r=null===(e=t.getFormat())||void 0===e?void 0:e.workflow_id;if(r)return i().NU.createChildStore(t,{table:n(743246).C0,id:r,spaceId:t.getSpaceId()})}),[t]),s=(0,o().K8)((()=>{if(d)return(0,n(94522).dh)(d)}),[d]),l=(0,n(484714).v3)(),u=(0,r.useCallback)((async()=>{if(!d)throw new Error("Can't migrate without a workflow");const e=d.getData();if(!e)return;const r=await n(449506).callApi({eventName:"getInferenceTranscriptsForUser",environment:l,data:{threadParentPointer:d.pointer}});if("failed"===r.type)return;const o=r.data.transcripts.map((e=>i().Ei.createChildStore(d,{id:e.id,table:n(234459).To,spaceId:t.getSpaceId()})));n(317909).createAndCommit({userAction:"WorkflowPageBlock.WorkflowDebugPopupContent.handleBlockMigration",environment:l,canUndo:!0,perform:r=>{(0,n(847).migrateWorkflowBlockToCollectionViewBlock)({environment:l,store:t,workflowStore:d,workflow:e,transaction:r,workflowThreads:o})}})}),[d,l,t]);return(0,a.jsx)(n(297872).A,{capture:!0,debugName:"WorkflowPageBlock",render:e=>{var t;return(0,a.jsx)("div",{style:c.wrap,...e,children:null!=s&&null!==(t=s.modules)&&void 0!==t&&t.length?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{children:"Workflows are now built in the new app builder. Migrate to continue using:"}),(0,a.jsx)(n(493823).p,{onClick:u,isRed:!0,children:"Migrate to collection view block"})]}):"This workflow has no data. Use the new app builder to create a new workflow."})}})}}}]);