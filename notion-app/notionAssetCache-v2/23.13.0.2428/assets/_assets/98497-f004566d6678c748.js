"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[98497],{51473:(e,t,n)=>{n.d(t,{A:()=>i});n(898992),n(672577);class a extends(()=>n(757695))().default{getInitialState(){return{open:!1}}close(){this.state.open&&this.setState({open:!1})}open(e){let{oldTier:t,newTier:a,oldAddOns:i,newAddOns:r}=e;if(function(e){if(!e)return!1;return["plus","enterprise","business","student"].includes(e)}(a)){if(function(e,t){if(!e||!t)return!1;return"upgrade"===(0,n(979340).qR)({oldTier:e,newTier:t})}(t,a))return this.setState({productUpgrade:a,open:!0}),!0}if(r.length>i.length){const e=r.find((e=>!i.includes(e)));if(function(e){if(!e)return!1;return["ai"].includes(e)}(e))return this.setState({productUpgrade:e,open:!0}),!0}return!1}}const i=new a},323063:(e,t,n)=>{n.d(t,{HO:()=>p,V5:()=>o,Vr:()=>d,gL:()=>c,qq:()=>u,vH:()=>l,z2:()=>m});n(16280),n(898992),n(354520),n(672577),n(581454),n(737550);var a=()=>n(720665),i=()=>n(762433),r=()=>n(47273),s=()=>n(979340);function o(e,t){return p(e.items,t.items).some((e=>{let[t,n]=e;return function(e,t){if(!e)return!1;if(!t)return!0;const n=i().xp(e),a=i().xp(t);if(!n||!a)return!1;return s().o3[n]>s().o3[a]}(t,n)}))}function d(e,t,n){let{trialEnd:a,items:i}=t;const r=i.map((t=>{const a=t.price.product,i=t.price.unitAmount.currencyCode,r=function(e,t){let{interval:n,product:a,currency:i}=t;const r=e.find((e=>e.product===a&&e.billingInterval===n&&e.unitAmount.currencyValue.currencyCode===i));return f(r,`Unable to find price with interval: ${n}, product: ${a}, currency: ${i}`)}(e,{interval:n,product:a,currency:i});return{...t,price:r}}));return{trialEnd:a,items:r}}function c(e,t){const n=e.items.filter((e=>i().IE(e)!==t));return{...e,items:n}}function l(e,t){const n=e.items.filter((e=>i().IE(e)!==i().IE(t)));return{...e,items:n.concat([t])}}function u(e,t,n){const{product:a,interval:r,currency:s}=n,o=function(e){if("personal_free"===e||"team_free"===e)return"free";return e}(a),d=t.items.filter((e=>i().IE(e)!==i().Mr(o))),c=function(e,t){let{interval:n,product:a,currency:i}=t;const r=e.find((e=>e.price.product===a&&e.price.billingInterval===n&&e.price.unitAmount.currencyValue.currencyCode===i));return f(r,`Unable to find price with interval: ${n}, product: ${a}, currency: ${i}`)}(e,{interval:r,product:o,currency:s});return{...t,items:d.concat([c])}}function p(e,t){return(0,a().Z4)(e,(e=>i().IE(e)),t,(e=>i().IE(e)))}function m(e){const{prices:t,billingData:n,product:a}=e,s=i().Ry(n),o=i().lQ(n),d=r().yw(o),c=i().q8(n),l=d??c;return t.find((e=>e.product===a&&e.billingInterval===l&&e.unitAmount.currencyValue.currencyCode===s))}function f(e,t){if(null==e)throw new Error(t);return e}},446242:(e,t,n)=>{n.d(t,{A:()=>i});class a extends(()=>n(757695))().default{getInitialState(){return{open:!1}}}const i=new a},995604:(e,t,n)=>{n.d(t,{Z:()=>g});n(296540);var a=()=>n(449506),i=()=>n(689309),r=()=>n(49210),s=()=>n(989423),o=()=>n(351360),d=()=>n(385346),c=()=>n(959013),l=()=>n(7674),u=()=>n(719147),p=()=>n(836251),m=n(474848);function f(e){let{onAccept:t}=e;return(0,m.jsx)(l().tf,{header:(0,m.jsx)(l().YA,{iconAndTitle:(0,m.jsx)(l().ZQ,{iconGroup:d().q,iconColorName:"uiRedPrimary",title:(0,m.jsx)(c().sA,{id:"voidOfferModal.title",defaultMessage:"Are you sure?"})}),description:(0,m.jsx)(c().sA,{id:"voidOfferModal.subtitle",defaultMessage:"If you continue, your current discount will no longer be applied. See <terms>terms and conditions</terms> for more information.",values:{terms:e=>(0,m.jsx)(u().A,{external:!0,href:(0,p().xS)("resurrectionLearnMore"),children:e})}})}),footer:(0,m.jsx)(l().aO,{layout:"vertical",primaryButtons:[{buttonType:"destructive",label:(0,m.jsx)(c().sA,{id:"voidOfferModal.primaryAction",defaultMessage:"Yes and remove discount"}),onClick:t}],secondaryButtons:[{buttonType:"dismiss",label:(0,m.jsx)(c().sA,{id:"voidOfferModal.cancelButton",defaultMessage:"Cancel"})}]})})}const v=406;async function g(e){var t;const n=null===(t=o().default.state.currentSpaceStore)||void 0===t?void 0:t.id;return await r().T.showAsyncModal((t=>(0,m.jsx)(i().s,{isOpen:t.isOpen,onDismiss:()=>{(0,s().u4)({environment:e,event:{eventName:"void_offer_modal_dismiss",eventProperties:{}}}),t.onDismiss()},onClosed:t.onClosed,areaConstraint:{width:{type:"min",length:v},height:{type:"unlimited",scroll:"allow"}},render:()=>(0,m.jsx)(f,{onAccept:async()=>{(0,s().u4)({environment:e,event:{eventName:"void_offer_modal_accept",eventProperties:{}}}),n&&await a().callApi({eventName:"voidCustomerOffer",environment:e,data:{spaceId:n}}),t.resolve("accepted")}})})))}},998497:(e,t,n)=>{n.r(t),n.d(t,{applyStudentGitHubGrant:()=>xe,cancelSubscription:()=>Ie,closeSubscriptionUpgradeModal:()=>Ce,handlePaymentIntentNextActions:()=>Oe,handlePlanChangeClick:()=>Pe,openSubscriptionUpgradeModal:()=>Me,openSubscriptionUpgradeModalForClaimAndUpgrade:()=>Ne,payUnpaidInvoice:()=>ge,refresh:()=>De,refreshBillingHistory:()=>_e,trackSubscriptionUpdate:()=>fe,updateAddress:()=>ye,updateBillingEmail:()=>Se,updateCurrentSpace:()=>Ae,updatePaymentMethod:()=>ve,updateSubscription:()=>pe,updateSubscriptionToEducationPlan:()=>he,updateVatId:()=>be});n(16280),n(296540);var a=()=>n(857639),i=()=>n(206267),r=()=>n(763884),s=()=>n(386164),o=()=>n(762433),d=()=>n(47273),c=()=>n(323063),l=()=>n(166386);var u=()=>n(622963),p=()=>n(959013),m=()=>n(496603),f=()=>n(534177),v=()=>n(252105),g=()=>n(449506),y=()=>n(934839),b=()=>n(901389),S=()=>n(496414),I=()=>n(209660),w=()=>n(662453),h=()=>n(680074),A=()=>n(972435),D=()=>n(965378),T=()=>n(719431),_=()=>n(529803),E=()=>n(351360),M=()=>n(780262),C=()=>n(57605),N=()=>n(21735),P=()=>n(508496),O=()=>n(975971),U=()=>n(150193),x=()=>n(589994),B=()=>n(613240),V=()=>n(151059),F=()=>n(630116),k=()=>n(404141),q=()=>n(506090),j=()=>n(596513),R=()=>n(762299),G=()=>n(843757),Q=()=>n(271084),L=()=>n(807778),H=()=>n(263928),$=()=>n(779795),Y=()=>n(72256);n(898992),n(354520),n(672577),n(581454);var Z=()=>n(112527),K=()=>n(134217),J=()=>n(10984),W=()=>n(995604),z=()=>n(430395),X=()=>n(51473),ee=()=>n(981046),te=()=>n(749240),ne=()=>n(921997),ae=()=>n(941541);async function ie(e){const{environment:t,spaceId:n}=e,a=(0,ne().GM)({spaceId:n});if(!oe||oe!==a){let n;!function(e){se&&ae().Ay.removeListener(se,e)}(t);const i=(t,a)=>{void 0!==n&&n!==a&&re(e),n=a},r=m().nF(i,5e3);se=ae().Ay.addListener(a,void 0,r,void 0,t),oe=a;const s=_().A.state;if(!Object.keys(s).length)return re(e)}}async function re(e){const{environment:t,spaceId:n}=e;if((0,K().e9)(t,n))return;const a=await g().callApi({eventName:"getBillingSubscriptionBannerData",environment:t,data:{spaceId:n},headers:(0,s().WS)({cellId:void 0,spaceId:n})});var i;"success"===a.type&&((null===(i=E().default.state.currentSpaceStore)||void 0===i?void 0:i.id)===n&&_().A.setState(a.data.bannerData));const r=await g().callApi({eventName:"getSubscriptionEntitlements",environment:t,data:{spaceId:n}});var o;"success"===r.type&&((null===(o=E().default.state.currentSpaceStore)||void 0===o?void 0:o.id)===n&&M().A.setState(r.data))}let se,oe;var de=()=>n(128265),ce=n(474848);const le="SubscriptionData",ue=(0,p().YK)({updatingSubscription:{id:"subscriptionSettings.updatingSubscriptionMessage",defaultMessage:"Updating your subscription…"},paymentMethodUpdateAuthFailed:{id:"subscriptionSettings.paymentMethodUpdateAuthFailedMessage",defaultMessage:"We could not update your payment method. Please try again or contact support."},verifyingEligibility:{id:"subscriptionSettings.verifyingEligibilityMessage",defaultMessage:"Verifying eligibility…"},personalFree:{id:"subscriptionSettings.personalFreeMessage",defaultMessage:"You are now subscribed to Notion’s Personal Pro Plan for free."},educationPlusFree:{id:"subscriptionSettings.educationPlusFreeMessage",defaultMessage:"You are now subscribed to Notion's Education plan for free"},finishingUp:{id:"subscription.upgrade.finishing",defaultMessage:"Finishing up..."},overFreeBlockLimitMobileNativeDialog:{id:"subscriptionActions.overFreeBlockLimit.mobileNativeDialog",defaultMessage:"Your free blocks have been used up. Unfortunately, unlimited blocks cannot be purchased on mobile."}});async function pe(e){const{from:t,environment:n,spaceStore:a,billingEmail:i,paymentData:r,vatId:s,coupon:d,customerName:l,businessName:u,addressLine1:p,addressZip:m,addressCity:f,addressState:v,addressCountry:w,promoCodeId:h,useTestClock:A,sessionId:D,inAppOffer:T,desiredState:_,trialData:E}=e;y().Re({bannerStore:U().A}),S().m({message:ue.updatingSubscription});if(!te().subscriptionDataStoreInstance.state)throw new Error("Subscription data not loaded.");const M=await C().A.awaitData(n,{spaceId:null==a?void 0:a.id});if(!M)throw new Error("Billing data not loaded");const N=(0,o().PP)(M),{plan:P,addOns:O,isTrial:x}=function(e,t){if(!t)return{plan:void 0,addOns:[],isTrial:void 0};const n=e.items.filter((e=>"plan"!==(0,o().IE)(e))),a=t.items.find((e=>"plan"===(0,o().IE)(e))),i=t.items.filter((e=>"plan"!==(0,o().IE)(e)));return{isTrial:Boolean(t.trialEnd),plan:null==a?void 0:a.price.externalId,addOns:(0,c().HO)(n,i).map((e=>{let[t,n]=e;return{isCancellation:!n,priceId:(n??t).price.externalId,quantity:null==n?void 0:n.quantity}}))}}(N,_),B=await g().callApi({eventName:"updateSubscription",environment:n,data:{spaceId:a.id,plan:P,addOns:O,billingEmail:i,paymentMethodId:(0,Z().optionalPaymentMethodIdGivenPaymentData)(r),vatId:s,coupon:d,customerName:l,businessName:u,addressLine1:p,addressZip:m,addressCity:f,addressState:v,addressCountry:w,promoCodeId:h,useTestClock:A,modalSessionId:D,inAppOffer:T,isTrial:x,clientVersion:n.device.version,trialData:E,from:t}});if(S().V(),"failed"===B.type)throw b().Qg(B),new Error("An error occurred while updating subscription");await we({environment:n,spaceStore:a,newDefaultTeamId:B.data.newDefaultTeamId});const V=te().subscriptionDataStoreInstance.state,F=a.id,q=a.getPlanType(),j=await C().A.awaitData(n,{spaceId:null==a?void 0:a.id});if(!j)throw new Error("Billing data not loaded");if(fe({environment:n,context:{spaceId:F,planType:q,from:t,isMmOrEnt:await(0,de().G)(n),trialData:E,modalId:D},oldData:M,newData:j,desiredState:_}),!V)throw new Error("Subscription data not loaded.");return Boolean(E)||me({oldTier:(0,o().AI)(M),newTier:(0,o().AI)(j),oldAddOns:(0,o().ji)(M),newAddOns:(0,o().ji)(j)}),k().A.state.open&&"requests"===k().A.state.currentTab&&I().Ow({currentTab:"billing"}),B.data}function me(e){return!!(0,L().Pe)()&&X().A.open(e)}function fe(e){var t;let{environment:n,context:a,oldData:i,newData:r,desiredState:s}=e;const c=(0,o().V9)(i),l=(0,o().AI)(i),u=(0,o().ji)(i),p=(0,o().q8)(i),m=(0,o().Ry)(i),f=i.email,g=(0,d().j1)(s),y=(0,d().Gf)(s),b=(0,d().V_)(s),S=(0,d().yw)(s),I=(0,d().j8)(s),w=Boolean(null==s?void 0:s.trialEnd),A=r.email,D=!(0,o().Fq)(i)&&(0,d().DS)(s),T=(0,o().Fq)(i)&&(0,d().DS)(s),_=(0,o().Fq)(i)&&!(0,d().DS)(s);D&&g?v().BK(n,{plan:g,credit_amount:0}):T?v().pT(n,{billing_email_changed:f!==A,plan_changed:g!==c,plan_current:g,plan_old:c,currency_code:I,billing_address_changed:!1}):_&&c&&v().pp(n,{plan:c}),v().xN(n,{from:a.from,action:_?"cancel":"update",spaceId:a.spaceId,isMmOrEnt:a.isMmOrEnt,planType:a.planType,addressCountry:null===(t=r.address)||void 0===t?void 0:t.country,oldSubscriptionTier:l,newSubscriptionTier:y,oldCurrency:m,newCurrency:I,oldPriceId:c,newPriceId:g,oldAddOns:u,newAddOns:b,oldBillingInterval:p,newBillingInterval:S,creditAmount:0,isProfessionalTeamUser:(0,h().YD)(),isTrial:w,trialEndDate:(0,o().i5)(i),trialData:a.trialData,modalId:a.modalId})}async function ve(e){const{environment:t,stripe:n,spaceStore:a,paymentMethodId:i}=e,r=await g().callApi({eventName:"updatePaymentMethod",environment:t,data:{spaceId:a.id,paymentMethodId:i}});if("failed"!==r.type){if(r.data.clientSecret&&"requires_action"===r.data.status){if("succeeded"!==await Ue({stripe:n,clientSecret:r.data.clientSecret}))return void b().f1(A().A.formatMessage(ue.paymentMethodUpdateAuthFailed));const e=await g().callApi({eventName:"setDefaultPaymentMethod",environment:t,data:{spaceId:a.id,paymentMethodId:i}});if("failed"===e.type)return void b().Qg(e)}await De(t)}else b().Qg(r)}async function ge(e){const{environment:t,invoiceId:n,paymentMethodId:a}=e,i=await g().callApi({eventName:"payInvoice",environment:t,data:{invoiceId:n,paymentMethodId:a}});"failed"!==i.type||b().Qg(i)}async function ye(e){const{environment:t,spaceStore:n,address:a}=e;y().Re({bannerStore:U().A}),S().m({message:ue.updatingSubscription});const i=await g().callApi({eventName:"updateBillingInformation",environment:t,data:{spaceId:n.id,address:a}});if("failed"===i.type)throw S().V(),b().Qg(i),i.error;v().pT(t,{billing_email_changed:!1,plan_changed:!1,billing_address_changed:!0}),await Te(t),await De(t),S().V()}async function be(e){const{environment:t,spaceStore:n,vatId:a}=e;y().Re({bannerStore:U().A}),S().m({message:ue.updatingSubscription});const i=await g().callApi({eventName:"updateBillingInformation",environment:t,data:{spaceId:n.id,vatId:a}});if("failed"===i.type)throw S().V(),b().Qg(i),i.error;v().pT(t,{billing_email_changed:!1,plan_changed:!1,billing_address_changed:!1}),await Te(t),await De(t),S().V()}async function Se(e){const{environment:t,spaceStore:n,email:a}=e;y().Re({bannerStore:U().A}),S().m({message:ue.updatingSubscription});const i=await g().callApi({eventName:"updateBillingInformation",environment:t,data:{spaceId:n.id,billingEmail:a}});if("failed"===i.type)throw S().V(),b().Qg(i),i.error;v().pT(t,{billing_email_changed:!0,plan_changed:!1,billing_address_changed:!1}),await Te(t),await De(t),S().V()}async function Ie(e){var t;const{environment:n,spaceStore:a,from:i}=e,r=await C().A.awaitData(n,{spaceId:null==a?void 0:a.id});if(!r)throw new Error("Billing data not loaded");y().Re({bannerStore:U().A}),S().m({message:ue.updatingSubscription});const s=await g().callApi({eventName:"cancelSubscription",environment:n,data:{spaceId:a.id,cancelImmediately:e.cancelImmediately}});if("failed"===s.type)return S().V(),void b().Qg(s);const d=(0,o().V9)(r);d&&v().pp(n,{plan:d}),await we({environment:n,spaceStore:a,newDefaultTeamId:void 0});if(!te().subscriptionDataStoreInstance.state)throw new Error("Subscription data not loaded.");return v().xN(n,{from:i,action:"cancel",spaceId:a.id,oldSubscriptionTier:(0,o().AI)(r),newSubscriptionTier:void 0,oldPriceId:null===(t=(0,o().KH)(r,"plan"))||void 0===t?void 0:t.price.externalId,oldCurrency:(0,o().Ry)(r),newCurrency:void 0,oldAddOns:(0,o().ji)(r),oldBillingInterval:(0,o().q8)(r),newBillingInterval:void 0,isCancelSubscription:!0,isProfessionalTeamUser:(0,h().YD)(),trialEndDate:(0,o().i5)(r)}),S().V(),!0}async function we(e){let{environment:t,newDefaultTeamId:n,spaceStore:a}=e;if(await De(t),await Te(t),ee().A.reset(),t.currentUser.id&&void 0!==n){await H().u({userId:t.currentUser.id,spaceId:a.id,environment:t});const e=F().h4.createChildStore(a,{table:"team",id:n,spaceId:a.id});await e.load()}}const he=(0,m().sg)((async function(e){const{environment:t,spaceStore:a,code:i}=e;S().m({message:ue.verifyingEligibility});const r=te().subscriptionDataStoreInstance.state;if(!r)throw new Error("Subscription data not loaded.");const s=await g().callApi({eventName:"updateSubscriptionToEducationPlan",environment:t,data:{spaceId:a.id,code:i}});"failed"===s.type?b().Qg(s):s.data.isEligible?Ee(r,t):n(446242).A.setState({open:!0,handlePromoCode:async e=>{S().m({message:ue.updatingSubscription});const n=await g().callApi({eventName:"updateSubscriptionToEducationPlan",environment:t,data:{spaceId:a.id,code:e}});"failed"===n.type?b().Qg(n):n.data.isEligible?Ee(r,t):b().f1((0,ce.jsx)(p().sA,{id:"subscriptionSettings.invalidPromoCodeError.message",defaultMessage:"This promo code is not valid."})),S().V()}}),S().V()}),1e3,{leading:!0,trailing:!1});async function Ae(e){const{environment:t,spaceId:n,isNewlyCreatedSpace:a}=e,i=te().subscriptionDataStoreInstance.spaceId;if(!t.currentUser.isLoggedIn()||i&&i===n)await te().subscriptionDataStoreInstance.waitUntilLoaded();else if(_().A.setState({}),ie({environment:t,spaceId:n}),M().A.setState({}),a){const e={type:"unsubscribed_admin",users:[],joinedMemberIds:[],blockUsage:0,hasPaidNonzero:!1,accountBalance:0,userSimilarity:{},spaceUsers:[],members:[],customerData:void 0,revenueCatEnabled:!1,addOns:[]};te().subscriptionDataStoreInstance.setState(e),te().subscriptionDataStoreInstance.spaceId=n,Q().k.setState(e.userSimilarity),De(t)}else De(t)}async function De(e){var t;const n=null===(t=E().default.state.currentSpaceStore)||void 0===t?void 0:t.id,i=e.currentUser.id;if(!n)throw new Error("No spaceId.");{const t=`${le}:${n}:v2`,o=r().A.get({userId:i,key:t});o&&(te().subscriptionDataStoreInstance.setState(o),te().subscriptionDataStoreInstance.spaceId=n,Q().k.setState(o.userSimilarity)),await async function(e){let{environment:t,spaceId:n,currentUserId:i,localKey:o}=e;await x().transactionQueue.drain();const d=P().default.checkGate({gateName:"dont_load_users"}),[c,l]=await Promise.all([g().callApi({eventName:"getSubscriptionData",environment:t,data:{spaceId:n},headers:(0,s().WS)({cellId:void 0,spaceId:n})}),d?Promise.resolve({type:"success",data:{users:[],joinedMemberIds:[],userSimilarity:{},shouldUseEdgeCache:!0},status:200}):g().callApi({eventName:"getVisibleUsers",environment:t,data:{spaceId:n,supportsEdgeCache:!0},headers:(0,s().WS)({spaceId:n})})]),u=P().default.checkGate({gateName:"users_edge_cache"});u&&N().A.state.shouldUseEdgeCache&&await G().P.resetData(t,{spaceId:n});if("success"===c.type&&"success"===l.type){var p;const e={...c.data,...l.data};u&&N().A.setState({shouldUseEdgeCache:l.data.shouldUseEdgeCache});try{r().A.set({userId:i,key:o,value:e})}catch{a().log({level:"error",from:"subscriptionActions",type:"subscriptionDataTooLarge",data:{miscDataToConvertToString:{subscriptionDataJsonSize:JSON.stringify(e).length}}})}(null===(p=E().default.state.currentSpaceStore)||void 0===p?void 0:p.id)===n&&(te().subscriptionDataStoreInstance.setState(e),te().subscriptionDataStoreInstance.spaceId=n,Q().k.setState(e.userSimilarity),K().Fq(e)&&v().G3(t))}else a().log({level:"error",from:"subscriptionActions",type:"fetchSubscriptionDataFailed",data:{miscDataToConvertToString:{getSubscriptionDataResponseType:c.type,getSubscriptionDataResponseStatus:c.status,getVisibleUserResponseType:l.type,getVisibleUserResponseStatus:l.status}}});await Promise.all([V().A.awaitData(t,{spaceId:n},!0),w().aiDependency.load().then((e=>{let{completionActions:a}=e;return a.maybeUpdateAiEligibility(t,n,!0)}))])}({environment:e,spaceId:n,currentUserId:i,localKey:t}),await C().A.resetData(e,{spaceId:n}),await j().t.resetData(e,{spaceId:n}),await O().A.resetData(e,{spaceId:n})}}function Te(e){var t;const n=null===(t=E().default.state.currentSpaceStore)||void 0===t?void 0:t.id;if(!n)throw new Error("No spaceId.");return R().A.resetData(e,{spaceId:n})}async function _e(e,t){const n=E().default.state.currentSpaceStore;if(!n)return;const a=await g().callApi({eventName:"getBillingHistory",environment:e,data:{spaceId:n.id,limit:t.state.billingEventsLimit}});"success"===a.type&&t.update((e=>({...e,billingEvents:a.data.events})))}async function Ee(e,t){await De(t),await Te(t),ee().A.reset();const n=()=>{me({oldTier:e.subscriptionTier??"free",newTier:"student",oldAddOns:[],newAddOns:[]})||b().rG({message:A().A.formatMessage(ue.educationPlusFree)}),k().A.setState({...k().A.state,currentTab:"billing",defaultSubtab:void 0});const n=K().RJ(e);v().tt(t,{plan:"student_free",old_plan:n?n.plan:void 0})};await T().shouldCreatePassword(t)?D().r({environment:t,onSubmit:n,onCancel:n}):n()}function Me(e,t){const{subscriptionTier:n,from:a,addOnFeature:r,coupon:s,isTrial:o,dismissMobilePlansModal:d,offer:c}=t,l=i().JW();v().ae(e,{subscriptionTier:n,from:a,addOnFeature:r,currency_code:ee().A.state.selectedCurrencyCode,isTrial:o,modal_id:l}),q().A.open({subscriptionTier:n,billingInterval:"month",addOnFeature:r,coupon:s,isTrial:o,sessionId:l,dismissMobilePlansModal:d,offer:c})}function Ce(e){const t=q().A.state;t.open&&(v().OC(e,{modal_id:t.sessionId}),q().A.setState({open:!1}))}function Ne(e){z().A.open(e)}async function Pe(e){var t;const{environment:n,product:i,spaceStore:r,from:s,pageSection:p,churnState:v,billingData:g}=e,y=await $().p_({environment:n,spaceId:r.id}),b=(null===(t=(0,o().KH)(g,"sites_custom_hostnames"))||void 0===t?void 0:t.quantity)??0,S=g.subscription;if(!(S&&(0,f().O9)(g.paymentMethod)||"free"===i))return void Me(n,{subscriptionTier:i,from:s});const I=(0,o().lQ)(g),w=(0,o().Ry)(g),h=(0,d().yw)(I),A=(0,d().yw)(S),D=h??A,T=(0,d().GB)({spaceId:r.id,logFunction:a().log.bind(a()),subscriptionState:I}),_=(0,d().GB)({spaceId:r.id,logFunction:a().log.bind(a()),subscriptionState:S}),E=T??_;let M;if("free"===i)M=(0,c().gL)(I,"plan");else{if(!(w&&D&&E))throw new Error("Trying to update plan on a subscription with no items");{const e={product:i,currency:w,interval:D};M=(0,c().qq)((0,u().Nw)({prices:y,quantity:E,domainsQuantity:b}),I,e)}}if(!m().n4(I,M)){if((0,c().V5)(I,M)){if("no_churn"===v||!v)return;if((0,l().hZ)(B().A.getData(n,{spaceId:null==r?void 0:r.id}))&&(0,l().Jf)("resurrection_offer",J().AI(),A)){if(!(await(0,W().Z)(n)))return}return 0===M.items.length?await Ie({environment:n,spaceStore:r,from:s,cancelImmediately:"churn_immediately"===v}):await pe({environment:n,spaceStore:r,desiredState:M,from:s})}(0,Y().o)(n,{desiredProducts:[i],analyticsArgs:{from:s,pageSection:p}})}}async function Oe(e){S().m({message:ue.finishingUp});const{paymentIntentData:t,stripe:n,onSuccess:a,onFailure:i}=e,r=t.paymentIntentClientSecret;let s=t.paymentIntentStatus;r&&"requires_action"===s&&(s=await Ue({stripe:n,clientSecret:r})),"succeeded"===s||"processing"===s?null==a||a():function(e){let{status:t}=e;return["requires_payment_method","requires_source"].includes(t)}({status:s})&&(null==i||i()),S().V()}async function Ue(e){let{stripe:t,clientSecret:n}=e;const{paymentIntent:a,setupIntent:i,error:r}=await t.handleNextAction({clientSecret:n});if(a)return a.status;if(i)return i.status;if(r.payment_intent)return r.payment_intent.status;if(r.setup_intent)return r.setup_intent.status;throw new Error(`Unexpected error handling intent: ${r.message}`)}async function xe(e){const{environment:t,data:n}=e;await g().callApi({eventName:"applyStudentGitHubGrant",environment:t,data:n})}}}]);