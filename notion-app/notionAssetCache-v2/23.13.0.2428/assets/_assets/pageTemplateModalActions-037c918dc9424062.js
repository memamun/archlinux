"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[34208],{174723:(e,t,a)=>{a.d(t,{$Y:()=>v,AF:()=>d,Px:()=>u,Up:()=>p,dY:()=>m});a(898992),a(354520);var o=()=>a(662303),n=()=>a(427704),i=()=>a(534177),r=()=>a(939768),l=()=>a(780054),c=()=>a(22102),s=()=>a(630116);async function d(e,t){const a=await c().k.load();return e.filter((e=>{const o=e.getCopiedFromPointer();return Boolean(o&&a.isTemplate(o)&&Boolean(t&&t(o.id)))}))}function p(e){const t=window.location.href;return r().O$(t,{tg:e.templateGalleryItem})}function m(e){let t;return e instanceof s().$x?t=e.getBlockId():"type"in e?"preset"===e.type?t=void 0:"pageTemplate"===e.type?t=e.template.rootId:(0,i().HB)(e):t=e.rootId,t}function u(e){const t=o().locale&&"en-us"!==o().locale.toLocaleLowerCase()?`/${o().locale.toLowerCase()}`:"",a=void 0!==e?`${t}${n().JZ.templates}/${encodeURIComponent(e)}`:`${t}${n().JZ.templates}`;return`${l().A.domainBaseUrl}${a}`}function v(e){if(!e)return"";try{const a=JSON.parse(e);if("text"===a.content[0].content[0].nodeType){var t;const e=(null==a||null===(t=a.content)||void 0===t||null===(t=t[0])||void 0===t||null===(t=t.content)||void 0===t||null===(t=t[0])||void 0===t?void 0:t.value)||"";return e.replace(/^(#{2,6})\s+/gm,"# ")}}catch(a){return""}}},413677:(e,t,a)=>{a.r(t),a.d(t,{accept:()=>N,close:()=>$,createTemplateInstance:()=>L,loadAndDuplicatePageTemplate:()=>O,openWithItem:()=>z,previewItem:()=>U,setTemplateVisited:()=>V});a(16280);var o=()=>a(584262),n=()=>a(857639),i=()=>a(763884),r=()=>a(388821),l=()=>a(179034),c=()=>a(665344),s=()=>a(94830),d=()=>a(973647),p=()=>a(449506),m=()=>a(857783),u=()=>a(71584),v=()=>a(34542),g=()=>a(989423),_=()=>a(972435),I=()=>a(108944),S=()=>a(174723),f=()=>a(869562),b=()=>a(351360),y=()=>a(508496),T=()=>a(75368),C=()=>a(714818),w=()=>a(630116),k=()=>a(160568),A=()=>a(624550),h=()=>a(246826),P=()=>a(666144),M=()=>a(778417),R=()=>a(185544),B=()=>a(317909),E=()=>a(345913);const x="LastViewedTemplateId",D=(0,a(959013).YK)({clientCopyError:{defaultMessage:"Client copy could not be created.",id:"spaceActions.createGettingStartedPage.copyNotCreated.error"}});function z(e){const{environment:t,item:a,createNewPage:o,isPrivate:n,disablePointerEvents:r,isCheckout:l=!1}=e;M().IU({environment:t}),C().A.setState({open:!0,item:a,createNewPage:o,isPrivate:n,isLoading:!1,disablePointerEvents:r,isCheckout:l}),i().A.set({userId:t.currentUser.id,key:x,value:a.rootId}),k().oO(t,{template_id:(0,S().dY)(a),from:o?"sidebar":"newPage"})}function U(e){let{templateItem:t,currentUserId:a}=e;const o=C().A.state.item;C().A.setState({...C().A.state,item:t}),o!==t&&i().A.set({userId:a,key:x,value:t.rootId})}function $(e){C().A.setState({item:C().A.state.item,open:!1}),M().IU({environment:e})}async function N(e){const{acceptFrom:t,item:a,environment:n,spaceStore:i,initializeStore:r,...l}=e;C().A.state.open&&C().A.setState({...C().A.state,isLoading:!0}),y().default.checkGate({gateName:"mobile_keep_template_gallery_open"})&&T().A.state.open&&T().A.setState({open:!1});const c=r?{...{...l,item:a,environment:n,spaceStore:i},initializeStore:r,type:"inExistingStore",useMinimalTemplates:!1}:{...{...l,item:a,environment:n,spaceStore:i},type:"inSpace",useMinimalTemplates:!1,isOnboarding:!1};let s=!1;const d=Date.now();let p;try{var u;p=await L(c),s=!0;const e=null===(u=b().default.state.mainEditorCurrentBlockStore)||void 0===u?void 0:u.id;!p||e&&e===p.id||m().uK({environment:n,store:p,pageVisitSource:o().y8.Create,showMoveTo:!0}),$(n),n.device.isMobile&&(f().close(),T().A.setState({open:!1}))}finally{var v;const o=Date.now()-d,r=e.initializeStore?I().Uo(e.initializeStore):void 0,l=e.initializeStore?!r:e.isPrivate;k().BX(n,{destination:l?"private":"team",template_block_id:a.rootId,template_duplication_duration_ms:o,team_id:null==r?void 0:r.id,created_page_id:null===(v=p)||void 0===v?void 0:v.id}),k().hB(n,{from:"mobileApp",success:s,context:t,template_block_id:a.rootId,target_space_id:i.id,template_duplication_duration_ms:o,public_template_name:a.name,template_id:a.id})}}async function O(e){const{environment:t,initializeStore:a,item:o,isPrivate:n,useMinimalTemplates:i,spaceStore:l,spaceViewStore:c}=e,s=i?o.rootId:o.previewRootId,d=await p().callApi({eventName:"loadBlockSubtree",environment:t,data:{block:{id:s,spaceId:o.spaceId},shallow:!1}});let m;"success"===d.type&&(m=r().RecordMapWithRole.create(d.data.subtreeRecordMap));const v="pageTemplateModalActions.loadAndDuplicatePageTemplate",{performResult:I}=B().createAndCommit({userAction:v,environment:t,canUndo:!0,perform:e=>{const o=a||R().IT({environment:t,spaceStore:l,spaceViewStore:c,isPrivate:n,loading:!0,transaction:e});P()._O({environment:t,inMemoryRecordCache:o.inMemoryRecordCache,recordMap:m,debugSource:v});const i=u().loadLocalSubtree(t,{blockId:s,inMemoryRecordCache:o.inMemoryRecordCache,allowCopyCollections:!0,requireFullSubtree:!1,skipTransclusionContainerChildren:!1,allowCopyExternalObjectInstances:!0}).recordMap;if(!i)throw new Error(_().A.getIntl().formatMessage(D.clientCopyError));return u().localDuplicate({environment:t,sourceBlockId:s,targetBlockPointer:o.pointer,sourceBlockSubtree:i,targetInMemoryRecordCache:o.inMemoryRecordCache,transaction:e,deepCopyTransclusionContainers:!0,resolveTemplateVariables:!0}),o}}),S=I.getCollectionPointer();return(0,g().u4)({environment:t,event:{eventName:"create_app_templates",eventProperties:{target_page_ids:[I.id],template_label:o.name,collection_ids:S?[S.id]:[]}}}),I}async function L(e){var t;const{environment:a,item:o,useRecordCache:i,useMinimalTemplates:r,spaceStore:p,isOnboarding:m,from:u,type:g,initializeStore:_,teamStore:I,onSuccess:S,onError:f}=e,b=i&&!r?o.previewRootId:o.rootId,T={id:b,table:l().ev,spaceId:o.spaceId},C=m?"onboarding":null!==(t=o.marketplaceTemplateMetadata)&&void 0!==t&&t.isMobileMarketplaceTemplate?"mobile_app":"homepage_team"===u?"team_home":void 0,k=await(0,v().oC)(a,b),h=C?{context:"",source:C,isListedTemplate:!!k,isFirstPartyPaidTemplate:void 0!==k&&(0,s().Z1)(k)}:void 0;let P=!1,M=p;const R=new(w().Bv)(a,{table:l().ev,id:T.id,spaceId:T.spaceId});if("inExistingStore"===g&&_){if(M=_,_.isEmptyPage()){const e=_.getParentStore();e&&e.canEdit()&&("block"===e.table||"space"===e.table||"team"===e.table)&&(P=!0,M=e)}}else"inTeam"===g&&I&&(M=I);h||n().log({level:"warning",from:"pageTemplateModalActions.createTemplateInstance",type:"templateInstallationMetadataNotSet",data:{miscDataToConvertToString:{template_id:o.id,template_block_id:o.rootId,target_space_id:p.id,public_template_name:o.name,isOnboarding:m,from:u,type:g}}});const x=y().default.checkGate({gateName:"enable_local_duplication_for_non_marketplace_templates"}),D=await A().Jx({environment:a,store:R,newParentStore:M,addCopyName:!1,duplicateOnlyCollectionSchema:!1,unlockPage:!0,templateInstallationMetadata:h,shouldAttemptServerBackedLocalDuplication:!(0,c().Fe)(null==h?void 0:h.source)&&x});if(D){if(d().Q.isSuccess(D)&&D.value.length>0){const e=D.value[0];if(P&&_){const t=_;try{await t.waitUntil((()=>t.isDefined()));const{serverCommitResult:o}=B().createAndCommit({userAction:"pageTemplateModalActions.initializePageTemplateInPlace",environment:a,canUndo:!0,perform:e=>{E().oD({environment:a,blocks:[t],transaction:e,permanentlyDelete:!0})}});return await o,e}catch(z){n().log({level:"error",from:"pageTemplateModalActions.initializePageTemplateInPlace",type:"transactionError",data:{miscDataToConvertToString:{error:z}}})}}return null==S||S(e),e}return null==f||f(),void n().log({level:"error",from:"pageTemplateModalActions.initializePageTemplate",type:"duplicateTemplateError",data:{miscDataToConvertToString:{error:D.error,template_id:o.id,template_block_id:o.rootId,target_space_id:p.id,public_template_name:o.name}}})}}function V(e){const{item:t,transaction:a,spaceViewStore:o}=e;if(o){const e=o.getVisitedTemplateIds();if(e.indexOf(t.rootId)<0){const n=e.concat([t.rootId]);h().zv({store:o,data:{visited_templates:n},transaction:a})}}}}}]);