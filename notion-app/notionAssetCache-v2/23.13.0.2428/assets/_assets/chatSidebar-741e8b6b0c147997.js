"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[2703],{77395:(e,t,r)=>{r.d(t,{A:()=>_});var a=r(296540),n=()=>r(484714),i=()=>r(56366),s=()=>r(401497),o=()=>r(959013),d=()=>r(496603),c=()=>r(534177),l=()=>r(661920),u=()=>r(778417),h=()=>r(890754),b=()=>r(590027),p=()=>r(747100),f=()=>r(906537),k=()=>r(770906),g=()=>r(900652),w=()=>r(941463),v=()=>r(441199),S=()=>r(869562),x=()=>r(644914),y=()=>r(749687),C=()=>r(737230),m=()=>r(962730),j=()=>r(712505),z=()=>r(35392),A=r(474848);const _=function(e){let{type:t}=e;const s=(0,o().tz)(),l=(0,n().v3)(),[h,p]=(0,r(819121).A)(),k=(0,a.useRef)(null),g=(0,r(93583).A)(h,k),v=(0,a.useRef)(!1),j=(0,a.useCallback)((()=>function(e){E({isResizing:!1},e)}(t)),[t]),z=(0,a.useCallback)((()=>function(e,t,r,a){r.current||T(t,e);E({isResizing:!1},t)}(l,t,v)),[l,t]),_=(0,a.useCallback)((e=>function(e,t,r,a){switch(f().clear(t),a.current=!0,r){case"page":S().setWidth({width:D(e.currentX,r,t),environment:t});break;case"update":S().setUpdateWidth({width:D(e.currentX,r,t),environment:t});break;case"peek":S().setPeekWidth({width:D(e.currentX,r,t),environment:t});break;case"secondary_sidebar":w().Ay.setWidth(D(e.currentX,r,t));break;case"chat":b().MU.update((a=>({...a,width:D(e.currentX,r,t)})));break;default:(0,c().HB)(r)}}(e,l,t,v)),[l,t]),H=(0,a.useCallback)((()=>function(e,t,r){u().IU({environment:e}),r.current=!1,E({...y().sidebarResizingStore.state,isResizing:!0},t)}(l,t,v)),[l,t]),{device:U}=l,K=(0,i().K8)((()=>function(e){const t=M(e);switch(e){case"page":case"secondary_sidebar":return t;case"peek":case"update":case"chat":return window.innerWidth-t;default:(0,c().HB)(e)}}(t)),[t]),L=(0,i().O$)(y().sidebarMouseEnterYStore),N=(0,i().O$)(r(230062).A),O=(0,i().K8)((()=>function(e){return{cursor:"col-resize",height:"100%",width:12,marginLeft:"update"===e?-C().Ay.state.width:-6}}(t)),[t]),X=(0,i().K8)((()=>function(e,t){const r=(0,x().KB)(t),a="peek"===e||"chat"===e;return{position:"absolute",left:a?0:void 0,right:a?void 0:0,width:0,flexGrow:0,zIndex:"peek"===e?109:1,top:r?0:-1,bottom:r?0:-1,pointerEvents:"auto"}}(t,l)),[t,l]),P=(0,i().K8)((()=>function(e){const t=M(e),r=W(e),a=I(e);if(a===r)return 0;return(t-a)/(r-a)}(t)),[t]),Y=(0,a.useRef)(!1);function V(e){y().sidebarMouseEnterYStore.setState(e.clientY)}const $=(0,a.useCallback)((()=>{E({isResizerHovered:Y.current||p},t)}),[p,t]);function F(){Y.current=!0,$()}function Z(){Y.current=!1,$()}(0,a.useEffect)((()=>{$()}),[p,$]);const q=(0,a.useCallback)((()=>{B(-10,t,l)}),[t,l]),G=(0,a.useCallback)((()=>{B(10,t,l)}),[t,l]),Q=(0,a.useCallback)((()=>{T(t,l)}),[t,l]);return N||U.isChromebook?null:(0,A.jsx)(r(545805).A,{capture:p,debugName:"SidebarResizer",onLeft:q,onRight:G,onUp:d().D_,onDown:d().D_,onTab:d().D_,onUntab:d().D_,onEnter:Q,children:(0,A.jsx)(r(859428).A,{renderTooltip:()=>(0,A.jsx)(R,{type:t}),originRect:new DOMRect(K,L,0,0),delayThreshold:0,placement:"page"===t||"secondary_sidebar"===t?m().W.Right:m().W.Left,originGap:10,render:e=>(0,A.jsx)("div",{style:X,...(0,r(553965).A)(e,{onMouseMove:F,onMouseLeave:Z,onMouseEnter:V}),children:(0,A.jsx)(r(603820).A,{onDraggableDragStart:H,onDraggableDragMove:_,onDraggableDragEnd:z,onDraggableDragCancel:j,disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,render:e=>(0,A.jsx)("div",{ref:g,role:"separator",tabIndex:0,"aria-label":s.formatMessage({id:"sidebarResizer.tooltip.resizeLabel",defaultMessage:"Resize with left and right arrow keys"}),"aria-orientation":"vertical","aria-valuenow":Math.round(100*P),"aria-valuemin":0,"aria-valuemax":100,style:O,...e})})})})})};function I(e){switch(e){case"page":return y().SIDEBAR_MIN_WIDTH;case"update":return C().Iz;case"peek":return j().SIDEPEEK_MIN_WIDTH;case"secondary_sidebar":return w().WR;case"chat":return b().vr;default:(0,c().HB)(e)}}function W(e){const t=window.innerWidth;switch(e){case"page":return 480;case"update":return Math.min(t/2,x().aL);case"peek":return(0,p().QX)();case"secondary_sidebar":return w().y8;case"chat":return b().Z5;default:(0,c().HB)(e)}}function M(e){switch(e){case"page":return y().sidebarWidthStore.state;case"secondary_sidebar":const t=y().sidebarExpandedStore.state,r=g().n5();return t?y().sidebarWidthStore.state+r:r;case"update":return C().Ay.state.width;case"peek":return j().default.state.preferredSidePeekWidth;case"chat":return b().MU.state.width;default:(0,c().HB)(e)}}function E(e,t){switch(t){case"page":y().sidebarResizingStore.update((t=>({...t,...e})));break;case"update":C().Ay.update((t=>({...t,...e})));break;case"secondary_sidebar":v().default.update((t=>({...t,...e})));break;case"peek":break;case"chat":b().MU.update((t=>({...t,...e})));break;default:(0,c().HB)(t)}}function D(e,t,r){let a;switch(t){case"page":a=e;break;case"secondary_sidebar":a=e-(y().sidebarExpandedStore.state?y().sidebarWidthStore.state:0);break;case"peek":case"update":case"chat":a=window.innerWidth-e;break;default:(0,c().HB)(t)}const n=W(t),i=I(t);return a>n?n:a<i?i:a}function R(e){let{type:t}=e;const r=(0,s().DP)(),a=(0,n().v3)(),d=(0,i().K8)((()=>function(e,t){switch(e){case"page":return(0,x().KB)(t);case"update":return(0,x().Nk)(t);case"peek":return j().default.state.open;case"secondary_sidebar":return v().default.isOpen();case"chat":return(0,h().getIsChatSidebarOpen)(t);default:(0,c().HB)(e)}}(t,a)),[t,a]),l=r.text.contrastSecondary,u=(0,A.jsx)(z().A,{name:"toggleSidebar"}),b=e=>(0,A.jsx)("span",{style:{color:l},children:e});let p;if(d)switch(t){case"secondary_sidebar":case"update":p=(0,A.jsx)(o().sA,{defaultMessage:"Close <invertedcolor>Click</invertedcolor>",id:"sidebarResizer.tooltip.closeMessage.noShortcut",values:{invertedcolor:b,keyboardShortcut:u}});break;case"chat":p=void 0;break;default:p=(0,A.jsx)(o().sA,{defaultMessage:"Close <invertedcolor>Click or {keyboardShortcut}</invertedcolor>",id:"sidebarResizer.tooltip.closeMessage",values:{invertedcolor:b,keyboardShortcut:u}})}else if("chat"===t)p=void 0;else p=(0,A.jsx)(o().sA,{defaultMessage:"Lock open <invertedcolor>Click or {keyboardShortcut}</invertedcolor>",id:"sidebarResizer.tooltip.lockMessage",values:{invertedcolor:b,keyboardShortcut:u}});return(0,A.jsxs)(A.Fragment,{children:[p?(0,A.jsxs)(A.Fragment,{children:[p,(0,A.jsx)("br",{})]}):null,(0,A.jsx)(o().sA,{defaultMessage:"Resize <invertedcolor>Drag</invertedcolor>",id:"sidebarResizer.tooltip.resizeMessage",values:{invertedcolor:b,keyboardShortcut:u}})]})}function T(e,t){switch(e){case"page":S().setExpand({environment:t,isExpanded:!y().sidebarExpandedStore.state,from:"sidebar_resizer",saveDetailsSidebarPreference:!0}),y().sidebarOpenStore.setState(!1);break;case"update":S().setUpdateExpand({environment:t,isExpanded:!(0,x().Nk)(t),from:"drag",saveDetailsSidebarPreference:!0});break;case"peek":l().VN({environment:t,from:"resizer_click"});break;case"secondary_sidebar":k().VI({environment:t});break;case"chat":break;default:(0,c().HB)(e)}}function B(e,t,r){const a=M(t);switch(t){case"page":S().setWidth({width:D(a+e,t),environment:r});break;case"update":S().setUpdateWidth({width:D(window.innerWidth-a+e,t),environment:r});break;case"peek":S().setPeekWidth({width:D(window.innerWidth-a+e,t),environment:r});break;case"secondary_sidebar":w().Ay.setWidth(D(a+e,t));break;case"chat":b().MU.update((r=>({...r,width:D(window.innerWidth-a+e,t)})));break;default:(0,c().HB)(t)}}},221605:(e,t,r)=>{r.r(t),r.d(t,{ChatSidebar:()=>O});var a=r(296540),n=()=>r(484714),i=()=>r(56366),s=()=>r(401497),o=()=>r(591779),d=()=>r(72307),c=()=>r(179034),l=()=>r(96689),u=()=>r(234459),h=()=>r(959013),b=()=>r(534177),p=()=>r(582524),f=()=>r(484762),k=()=>r(145214),g=()=>r(84817),w=()=>r(297872),v=()=>r(864943),S=()=>r(77395),x=()=>r(38337),y=()=>r(58293),C=()=>r(346),m=()=>r(567121),j=()=>r(351360),z=()=>r(948914),A=()=>r(630116),_=()=>r(691093),I=()=>r(363186),W=(r(944114),()=>r(498212)),M=()=>r(235956),E=()=>r(847),D=()=>r(94522),R=r(474848);function T(e){const{store:t,workflowStore:r,threadStore:n,config:i,onThreadChange:s,clientStore:o}=(0,I().$O)(),d=(0,a.useCallback)((e=>{let{currentSteps:a}=e;const n=[];if(0===a.length){const e=function(e){const{store:t,workflowStore:r}=e;if(r){const e=(0,D().dh)(r),a=(0,M().T7)({workflowValue:e,workflowStore:r}),n=(0,D().u1)({store:t,modules:a,views:e.views||[]});return{...e,modules:a,views:n}}return(0,E().createNewWorkflowValueWithDatabases)({store:t})}({store:t,workflowStore:r});e&&n.push({id:(0,W().Ay)(),type:"workflow",workflow_block_id:t.id,value:e,traceId:(0,W().Ay)(),saved:!0,tag:"initial-value"})}return n}),[t,r]);return(0,R.jsx)(f().cZ,{aiChatFeature:"workflows",threadStore:n,config:i,onThreadChange:s,clientStore:o,getAppendStepsOnUserInputSubmit:d,parentBlockStore:t})}var B=()=>r(46986),H=()=>r(118078),U=()=>r(890754),K=()=>r(590027);const L={translateX:"100%"},N={translateX:0};function O(){const e=(0,n().v3)(),t=(0,i().K8)((()=>(0,U().getChatSidebarState)(e)),[e]),r=(0,o().ZC)(t),a=void 0!==t,{width:c,isResizerHovered:l}=(0,i().O$)(K().MU),u=(0,C().n_)(),h=(0,s().IS)((e=>({container:{order:d().A.appCursorListener.secondarySidebar,cursor:"default",zIndex:102,width:c,height:u?`calc(100% - ${m().ls}px)`:"100%",background:e.contentBackground,flexShrink:0,display:"flex",position:"fixed",right:0},wrap:{height:"100%"},content:{position:"absolute",top:0,bottom:0,display:"flex",flexDirection:"column",overflow:"visible",width:c},resizer:{position:"absolute",top:0,left:3,zIndex:1,height:"100%",width:2,borderLeftWidth:1,borderLeftStyle:"solid",borderLeftColor:l?e.stroke.primary:e.stroke.secondary,transition:"border-color 300ms ease"}})),[u,c,l]),b=(0,i().K8)((()=>(0,B().s)()),[]),p=t??r;return b?(0,R.jsx)(w().A,{debugName:"ChatSidebar",capture:a,allowEsc:!0,render:()=>(0,R.jsxs)(k().A,{visible:a,initial:L,animate:N,exit:L,"aria-hidden":!a||void 0,style:h.container,role:"region",children:[(0,R.jsx)("div",{style:h.wrap,children:(0,R.jsx)("div",{style:h.content,children:p?(0,R.jsx)(X,{chatSidebarState:p}):null})}),(0,R.jsx)("div",{style:h.resizer}),(0,R.jsx)(S().A,{type:"chat"})]})}):null}function X(e){const{chatSidebarState:t}=e;switch(t.type){case"app_builder":return(0,R.jsx)(P,{chatSidebarState:t});case"devchat":return(0,R.jsx)(V,{chatSidebarState:t});default:(0,b().HB)(t)}}function P(e){const{chatSidebarState:t}=e;return(0,R.jsx)(I().X9,{store:t.collectionViewBlockStore,children:(0,R.jsxs)(g().Y1,{direction:"vertical",height:"fill",width:"fill",gap:"auto",children:[(0,R.jsx)(Y,{}),(0,R.jsx)(T,{})]})})}function Y(){const{store:e,threadStore:t,onThreadChange:r,clientStore:s}=(0,I().$O)(),o=(0,n().v3)(),d=(0,a.useCallback)((e=>{(0,p().Wq)({clientStore:s}),null==r||r({threadId:e})}),[r,s]),u=(0,i().K8)((()=>{const{currentSpaceStore:t}=j().default.state;if(t)return e?{table:c().ev,id:e.pointer.id,spaceId:t.id}:{table:l().NX,id:t.id,spaceId:t.id}}),[e]),b=(0,a.useCallback)((()=>{(0,_().closeWorkflowEditor)({environment:o})}),[o]),{isShowingTabBar:k}=(0,i().O$)(z().A),w=o.device.isElectron&&!k;return(0,R.jsxs)(g().Y1,{className:w?x().sbV:void 0,direction:"vertical",padding:"0 12px",width:"fill",gap:4,children:[(0,R.jsxs)(g().Y1,{direction:"horizontal",align:"center",gap:"auto",height:44,children:[(0,R.jsx)(f().qI,{threadStore:t,handleThreadClick:d,threadParentPointer:u}),(0,R.jsx)(g().Y1,{direction:"horizontal",align:"center-right",gap:8,style:{flexShrink:0},children:(0,R.jsx)(v().A,{size:"lg",onClick:b,children:(0,R.jsx)(h().sA,{id:"workflowEditor.close",defaultMessage:"Close"})})})]}),(0,R.jsx)(g().Y1,{direction:"horizontal",align:"center-right",gap:8,children:(0,R.jsx)(f().aU,{clientStore:s})})]})}function V(e){const{chatSidebarState:t}=e,r=(0,n().v3)(),s=(0,y().r)();(0,i().K8)((()=>{if(s&&t.chatThreadId&&t.chatThreadId!==U().NEW_CHAT_THREAD_ID)return A().Ei.createChildStore(s,{table:u().To,id:t.chatThreadId,spaceId:s.id})}),[s,t.chatThreadId]),(0,a.useCallback)((e=>{(0,H().openChatSidebar)({environment:r,chatThreadId:e.threadId})}),[r]),(0,a.useCallback)((()=>{(0,H().closeChatSidebar)({environment:r})}),[r]);return null}}}]);