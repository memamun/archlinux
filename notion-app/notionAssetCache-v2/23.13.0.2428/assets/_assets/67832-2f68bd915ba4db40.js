"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[67832],{5269:(e,t,o)=>{o.d(t,{y:()=>u});var r=()=>o(56366),n=()=>o(179034),a=()=>o(534177),i=()=>o(175116),s=()=>o(108944),l=()=>o(630116);function u(e,t){const o=(0,i().Ks)();return(0,r().K8)((()=>{const r=e.getParentStore();if("button_block"===t){const t=function(e){const t=(0,s().g7)(e);for(const o of t)if(o.table===n().ev&&o.isPageBlock())return o;return}(e);return null==t?void 0:t.getAssociatedCollectionStore()}if("button_property"===t)return null==o?void 0:o.collectionStore();if("event"===t){if(r&&r instanceof l().md)return r}else{if("recurrence"===t)return;if("assistant"===t){if(r&&r instanceof l().md)return r}else(0,a().HB)(t)}}),[e,t,o])}},7868:(e,t,o)=>{o.d(t,{A:()=>b});o(944114),o(581454);var r=o(296540),n=()=>o(484714),a=(o(898992),o(354520),()=>o(401497)),i=()=>o(247331),s=()=>o(791089),l=()=>o(919709),u=()=>o(959013),p=()=>o(496603),c=()=>o(419357),d=()=>o(742971),m=()=>o(258804),g=o(474848);var y=()=>o(722872),h=()=>o(928600),f=()=>o(939740),v=()=>o(45552),x=()=>o(89924),S=()=>o(996027),C=()=>o(231713);function b(e){const{currentSimpleFormulaValueTokens:t,formulaTypecheckContextValues:o,menuProps:b,onChange:T,onClose:A,showGenericHeader:M=!1,value:k,parentRecordStore:j}=e,P=(0,n().Y0)(),{footer:_,header:V,numberInput:I,valueItems:w}=function(e){const{currentSimpleFormulaValueTokens:t,formulaTypecheckContextValues:o,onChange:y,onClose:h,value:f}=e,v=(0,u().tz)(),{isMobile:x}=(0,n().Y0)(),S=(0,a().IS)((e=>({inputOuterStyle:{fontSize:"12px",...x?{boxShadow:"none",background:"light"===e.mode?e.white:e.selectLightGray[200],borderRadius:0,minHeight:"45px"}:{}}})),[x]),C=o.filter((e=>"number"===e.type.type)),b=(0,r.useCallback)((e=>{y({type:"simple",value:e})}),[y]),T=(0,r.useCallback)((e=>{b(e),h()}),[b,h]),A=(0,r.useCallback)((e=>{const t=e.target.value;let o;o=""===t?void 0:[[t]],b(o)}),[b]),M=(0,r.useCallback)((e=>{const t=void 0!==e[0]?(0,s().toSimpleFormulaSingleValue)(e[0]):void 0;T(t)}),[T]),k=p().oE(C.map((e=>{if(e.kind===i().FormulaContextValueKind.ContextValue)return{action:"replace",currentSimpleFormulaValueTokens:t,id:e.id||"",setCurrentTokens:M,value:e}}))),j=(0,r.useMemo)((()=>{const e=t[0],o="string"==typeof e?e:(0,l().q4_)(null==f?void 0:f.value);return(0,g.jsx)(c().Ay,{focusInitial:!x,onChange:A,value:o,type:"number",inputOuterStyle:S.inputOuterStyle,placeholder:v.formatMessage(d().D.propertyValuePlaceholder)})}),[t,A,v,x,S.inputOuterStyle,null==f?void 0:f.value]);return{footer:(0,g.jsx)(m().A,{value:f,onChange:y}),header:v.formatMessage(d().D.genericMenuHeader),numberInput:j,valueItems:k}}({formulaTypecheckContextValues:o,onChange:T,onClose:A,currentSimpleFormulaValueTokens:t,value:k})||{},R=(0,r.useMemo)((()=>w.map((e=>{const{annotation:t,itemAction:r}=(0,C().E)({action:e.action,currentSimpleFormulaValueTokens:e.currentSimpleFormulaValueTokens,setCurrentTokens:e.setCurrentTokens,value:e.value});return{key:e.id,render:e=>(0,g.jsx)(S().A,{annotation:t,disabled:!1,formulaTypecheckContextValues:o,menuArgs:e,parentRecordStore:j}),action:r}}))),[o,w,j]),N=[];let F;R.length>0&&N.push({key:"textbox",render:e=>(0,g.jsx)(x().A,{...e}),items:R}),F=P.isMobile?{menuType:y().gu.Modal,minWidth:260,onClickRight:A,right:(0,g.jsx)(v().DoneMenuText,{})}:{menuType:y().gu.Popup,maxHeight:"50vh",width:260,footer:_&&(0,g.jsx)(x().A,{topBorder:!0,children:_}),disableHeaderBorder:!0};const E=M&&(0,g.jsx)(x().A,{style:{paddingBottom:0},title:V}),O=(0,g.jsxs)("div",{children:[!P.isMobile&&((null==b?void 0:b.header)||E),I]}),B=(0,g.jsx)(f().Ay,{initialFocus:0,sections:N,type:f().Oh.Vertical});return{headerDiv:O,innerComponents:B,numberMenu:(0,g.jsx)(h().A,{...F,...b,header:O,children:B})}}},16707:(e,t,o)=>{o.d(t,{L:()=>p,g:()=>u});o(296540);var r=()=>o(401497),n=()=>o(572438),a=()=>o(977345),i=()=>o(959013),s=()=>o(214973),l=o(474848);function u(e){const{returnType:t}=e,o=(0,r().DP)(),u=(0,r().IS)((e=>({iconWrap:{display:"inline-block",fill:e.icon.secondary,height:"1em",position:"relative",verticalAlign:"-0.15em",width:"1em"},icon:{width:"100%"}})),[]),p=(0,a().Ix)(t);return(0,l.jsx)(n().R,{icon:(0,l.jsx)("span",{style:u.iconWrap,children:p(u.icon)}),index:0,theme:o,children:(0,l.jsx)(i().sA,{...s().CV.inlineCustomFormulaDefaultName})})}function p(){return(0,l.jsx)(i().sA,{...s().CV.inlineCustomFormulaDefaultName})}},27511:(e,t,o)=>{o.d(t,{a:()=>C,y:()=>v});o(898992),o(354520),o(672577),o(581454),o(296540);var r=()=>o(401497),n=()=>o(289915),a=()=>o(713998),i=()=>o(784892),s=()=>o(959013),l=()=>o(534177),u=()=>o(284371),p=()=>o(399762),c=()=>o(881690),d=()=>o(496401),m=()=>o(214973),g=()=>o(529135),y=()=>o(989064),h=o(474848);const f=5;function v(e){const t=(0,s().tz)(),{filter:o,limit:r=f,propertySchema:a,onClick:i}=e,u=a.name,p=(0,n().V6)(o),c=p.map((e=>"is_group"===e.type?e.value:void 0)).filter(l().O9),d=p.map((e=>"is_option"===e.type?e.value:void 0)).filter(l().O9),m=C({intl:t,groupValues:c,limit:r,optionValues:d,propertySchema:a}),g=C({intl:t,isText:!0,groupValues:c,limit:r,optionValues:d,propertySchema:a});return(0,h.jsx)(y().z,{onClick:i,tooltip:(0,h.jsx)(S,{propertyName:u,statusValues:g}),children:(0,h.jsx)(x,{propertyName:u,statusValues:m})})}function x(e){let{propertyName:t,statusValues:o}=e;const n=(0,s().tz)(),a=(0,r().IS)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"wrap",whiteSpace:"pre",lineHeight:1.6},propertyName:{...u().RC,fontWeight:u().Wy.medium}})),[]),i=n.formatList(o,{style:"long",type:"disjunction"});return(0,h.jsx)("div",{style:a.content,children:(0,m().Yx)(n,{propertyName:(0,h.jsx)("span",{style:a.propertyName,children:t}),propertyValues:(0,d().d)(i)})})}function S(e){let{propertyName:t,statusValues:o}=e;const n=(0,s().tz)(),a=(0,r().IS)((()=>({propertyName:{...u().RC,fontWeight:u().Wy.medium}})),[]),i=n.formatList(o,{style:"long",type:"disjunction"});return(0,h.jsx)(h.Fragment,{children:(0,m().Yx)(n,{propertyName:(0,h.jsx)("span",{style:a.propertyName,children:t}),propertyValues:(0,d().d)(i)})})}function C(e){let{groupValues:t,intl:o,isText:r,limit:n,optionValues:s,propertySchema:u,tokenFormat:d=i().NY.Medium}=e;const y=u.groups||[],f=u.options||[],v=t.map((e=>{const t=y.find((t=>t.name===e));if(t)return r?t.name:(0,h.jsx)(p().q,{format:d,isSingle:!0,value:t.name,color:t.color,groupColor:null==t?void 0:t.color,showRemoveButton:!1,showEllipsis:!1},t.id)})).filter(l().O9),x=s.map((e=>{const t=(0,a().jy)(f,e);if(void 0===t)return r?(0,m().iy)(o):(0,h.jsx)(g().A,{tokenFormat:d},`missing_option_value_${e}`);if(r)return t.value;const n=y.find((e=>{var o;return null===(o=e.optionIds)||void 0===o?void 0:o.includes(t.id)}));return(0,h.jsx)(p().q,{format:d,isSingle:!0,value:t.value,color:t.color,groupColor:null==n?void 0:n.color,showRemoveButton:!1,showEllipsis:!0},t.id)})),S=[...v,...x];let C=[];if(void 0!==n&&S.length>n){const e=x.length-n,t=r?`+${e}`:(0,h.jsx)(c().A,{format:i().NY.Medium,isRound:!0,isSingle:!0,showRemoveButton:!1,value:`+${e}`},"More tokens");C=[...x.slice(0,n),t]}else C=S;return C}},36697:(e,t,o)=>{o.d(t,{P:()=>i});o(296540);var r=()=>o(401497),n=()=>o(743176),a=o(474848);function i(e){let{style:t={},propertySchema:o}=e;const i=(0,r().DP)();return(0,a.jsx)(n().Ay,{size:16,theme:i,icon:o.icon,style:{...t,overflow:"visible"},type:o.type})}},38440:(e,t,o)=>{o.d(t,{LN:()=>i,W:()=>s,lD:()=>l,zQ:()=>u});o(296540);var r=()=>o(959013),n=()=>o(214973),a=o(474848);const i={checkbox_is_not:"checkbox",checkbox_is:"checkbox",enum_contains:"multi_select",enum_does_not_contain:"multi_select",enum_contains_all:"multi_select",enum_is_not:"select",enum_is:"select",number_does_not_equal:"number",number_equals:"number",number_greater_than_or_equal_to:"number",number_greater_than:"number",number_less_than_or_equal_to:"number",number_less_than:"number",person_contains:"person",person_does_not_contain:"person",relation_contains:"relation",relation_does_not_contain:"relation",status_is_not:"status",status_is:"status",string_contains:"text",string_does_not_contain:"text",string_ends_with:"text",string_is_not:"text",string_is:"text",string_starts_with:"text"},s={phone_number:"text",title:"text",url:"text",email:"text"},l={relation:["relation"],checkbox:["checkbox"],number:["number"],person:["person"],multi_select:["multi_select"],select:["select"],status:["status"],text:["email","phone_number","text","url"]};function u(e){return(0,a.jsx)(r().sA,{...n().o7({propertyName:e.name})})}},50401:(e,t,o)=>{o.d(t,{F:()=>d});var r=o(296540),n=()=>o(401497),a=()=>o(514503),i=()=>o(959013),s=()=>o(962730),l=()=>o(285790),u=()=>o(859428),p=o(474848);const c=(0,i().YK)({simpleFormulaFormulaActionButtonAriaLabel:{id:"formulas.simpleFormulaFormulaActionButton.ariaLabel",defaultMessage:"Formulas"},simpleFormulaFormulaActionButtonFormulaTooltip:{id:"formulas.simpleFormulaFormulaActionButton.formula.tooltip",defaultMessage:"Edit as formula"},simpleFormulaFormulaActionButtonSimpleFormulaTooltip:{id:"formulas.simpleFormulaFormulaActionButton.simpleFormula.tooltip",defaultMessage:"Edit as text"}});function d(e){const{disabled:t,onClick:o,value:d}=e,m="formula"===(null==d?void 0:d.type),g=(0,i().tz)(),y=(0,n().IS)((e=>({formulaIcon:{fill:m?e.icon.uiBluePrimary:e.mediumIconColor,height:16,width:16},button:{height:20,width:20}})),[m]),h=(0,r.useCallback)((()=>m?g.formatMessage(c.simpleFormulaFormulaActionButtonSimpleFormulaTooltip):g.formatMessage(c.simpleFormulaFormulaActionButtonFormulaTooltip)),[g,m]),f=(0,r.useCallback)((e=>(0,p.jsx)(l().A,{...e,ariaLabel:g.formatMessage(c.simpleFormulaFormulaActionButtonAriaLabel),disabled:t,disabledFeedback:t,icon:a().n,iconStyle:y.formulaIcon,onClick:o,style:y.button})),[t,g,o,y]);return(0,p.jsx)(u().A,{renderTooltip:h,placement:s().W.Bottom,render:f})}},72645:(e,t,o)=>{o.d(t,{b:()=>n});o(296540);var r=o(474848);const n=(0,o(340498).wt)("plusMedium",{viewBox:"0 0 16 16",svg:(0,r.jsx)("g",{children:(0,r.jsx)("path",{d:"M2 8a.77.77 0 01.237-.566.762.762 0 01.566-.244h4.394V2.803a.77.77 0 01.237-.566A.773.773 0 018 2c.225 0 .416.079.573.237a.773.773 0 01.237.566V7.19h4.387c.22 0 .409.081.566.244A.773.773 0 0114 8a.781.781 0 01-.237.573.785.785 0 01-.566.23H8.81v4.401a.764.764 0 01-.237.56A.781.781 0 018 14a.773.773 0 01-.566-.237.764.764 0 01-.237-.559V8.803H2.803a.785.785 0 01-.566-.23A.781.781 0 012 8z"})})})},79118:(e,t,o)=>{o.d(t,{Eo:()=>v,Fz:()=>m,KI:()=>s,M4:()=>u,YW:()=>C,iY:()=>b,mO:()=>g,qE:()=>p,vm:()=>h});var r=()=>o(604995),n=()=>o(247331),a=()=>o(977345);const i=(0,o(959013).YK)({buttonAutomationCurrentUserDescription:{defaultMessage:"The user who clicked this button",id:"automations.contextValue.buttonAutomationCurrentUserDescription"},buttonAutomationCurrentUserName:{defaultMessage:"Whoever clicked",id:"automations.contextValue.buttonAutomationCurrentUserName"},buttonAutomationCurrentUserTooltip:{defaultMessage:"The person who clicked the button",id:"automations.contextValue.buttonAutomationCurrentUserTooltip"},buttonAutomationThisPageDescription:{defaultMessage:"The page containing this button",id:"automations.contextValue.buttonAutomationThisPageDescription"},buttonAutomationThisPageName:{defaultMessage:"This page",id:"automations.contextValue.buttonAutomationThisPageName"},buttonAutomationThisPageTooltip:{defaultMessage:"The page containing this button",id:"automations.contextValue.buttonAutomationThisPageTooltip"},eventAutomationCurrentUserDescription:{defaultMessage:"The user who made the edit that triggered this automation to run.",id:"automations.contextValue.eventAutomationCurrentUserDescription"},eventAutomationCurrentUserName:{defaultMessage:"Whoever triggered",id:"automations.contextValue.eventAutomationCurrentUserName"},eventAutomationCurrentUserTooltip:{defaultMessage:"The person whose action triggered this automation",id:"automations.contextValue.eventAutomationCurrentUserTooltip"},eventAutomationThisPageDescription:{defaultMessage:"The page that was edited to trigger this automation to run.",id:"automations.contextValue.eventAutomationThisPageDescription"},eventAutomationThisPageName:{defaultMessage:"Trigger page",id:"automations.contextValue.eventAutomationThisPageName"},eventAutomationThisPageTooltip:{defaultMessage:"The page that triggered this automation",id:"automations.contextValue.eventAutomationThisPageTooltip"},now:{id:"automations.triggers.now.label",defaultMessage:"Time triggered"},nowDescription:{id:"automations.triggers.now.description",defaultMessage:"The time when this automation begins to run."},nowTooltip:{id:"automations.triggers.now.tooltip",defaultMessage:"The time this automation was triggered"},pageCreator:{id:"automations.triggers.pageCreator.label",defaultMessage:"Page creator"},pageCreatorDescription:{id:"automations.triggers.pageCreator.description",defaultMessage:"The user who created the page that was edited to trigger this automation to run."},pageCreatorTooltip:{id:"automations.triggers.pageCreator.tooltip",defaultMessage:"Person who created page"},today:{id:"automations.triggers.today.label",defaultMessage:"Date triggered"},todayDescription:{id:"automations.triggers.today.description",defaultMessage:"The date when this automation begins to run."},todayTooltip:{id:"automations.triggers.today.tooltip",defaultMessage:"The date this automation was triggered"}});function s(){return(0,a().$y)({source:"global",global:"button_page"})}function l(e,t,o){return{description:o,name:e,tooltip:t,compile:(r,a)=>({description:o?r.formatMessage(o):void 0,id:s(),kind:n().FormulaContextValueKind.ContextValue,name:r.formatMessage(e),tooltipName:r.formatMessage(t),type:{collection:a,type:"block"}}),evaluate:e=>({kind:n().FormulaContextValueKind.ContextValue,id:s(),value:{type:"block",value:e}})}}const u=l(i.buttonAutomationThisPageName,i.buttonAutomationThisPageTooltip,i.buttonAutomationThisPageDescription),p=l(i.eventAutomationThisPageName,i.eventAutomationThisPageTooltip,i.eventAutomationThisPageDescription);function c(){return(0,a().$y)({source:"global",global:"current_user"})}function d(e,t,o){return{description:o,name:e,tooltip:t,compile:r=>({description:o?r.formatMessage(o):void 0,id:c(),kind:n().FormulaContextValueKind.ContextValue,name:r.formatMessage(e),tooltipName:r.formatMessage(t),type:{type:"person"}}),evaluate:e=>({id:c(),kind:n().FormulaContextValueKind.ContextValue,value:{type:"person",value:e}})}}const m=d(i.buttonAutomationCurrentUserName,i.buttonAutomationCurrentUserTooltip,i.buttonAutomationCurrentUserDescription),g=d(i.eventAutomationCurrentUserName,i.eventAutomationCurrentUserTooltip,i.eventAutomationCurrentUserDescription);function y(){return(0,a().$y)({source:"global",global:"now"})}const h={description:i.nowDescription,name:i.now,tooltip:i.nowTooltip,compile(e){return{description:this.description?e.formatMessage(this.description):void 0,id:y(),kind:n().FormulaContextValueKind.ContextValue,name:e.formatMessage(this.name),tooltipName:this.tooltip?e.formatMessage(this.tooltip):void 0,type:{type:"date"}}},evaluate:e=>({id:y(),kind:n().FormulaContextValueKind.ContextValue,value:{type:"date",value:(0,r().KQ)(Date.now(),e)}})};function f(){return(0,a().$y)({source:"global",global:"today"})}const v={description:i.todayDescription,name:i.today,tooltip:i.todayTooltip,compile(e){return{description:this.description?e.formatMessage(this.description):void 0,id:f(),kind:n().FormulaContextValueKind.ContextValue,name:e.formatMessage(this.name),tooltipName:this.tooltip?e.formatMessage(this.tooltip):void 0,type:{type:"date"}}},evaluate:e=>({id:f(),kind:n().FormulaContextValueKind.ContextValue,value:{type:"date",value:(0,r().p6)(Date.now(),e)}})};function x(){return(0,a().$y)({source:"global",global:"page_creator"})}function S(e,t){return{description:i.pageCreatorDescription,name:e,tooltip:t,compile(o){return{description:this.description?o.formatMessage(this.description):void 0,id:x(),kind:n().FormulaContextValueKind.ContextValue,name:o.formatMessage(e),tooltipName:o.formatMessage(t),type:{type:"person"}}},evaluate:e=>({id:x(),kind:n().FormulaContextValueKind.ContextValue,value:{type:"person",value:e}})}}const C=S(i.pageCreator,i.pageCreatorTooltip),b=S(i.pageCreator,i.pageCreatorTooltip)},103966:(e,t,o)=>{o.d(t,{Z:()=>p});var r=()=>o(496603),n=()=>o(534177),a=()=>o(416504),i=()=>o(519831),s=()=>o(79118);const l={type:"button",getCreatePermissions(e){const{parentPointer:t}=e;return[{minimumRole:"read_and_write",pointer:t,type:"record_permission"}]},getEditPermissions(e){const{automationModel:t}=e;return[{minimumRole:"read_and_write",pointer:t.getParentPointer(),type:"record_permission"}]},getManagePermissions(e){const{automationModel:t}=e;return[{minimumRole:"read_and_write",pointer:t.getParentPointer(),type:"record_permission"}]},getExecutePermissions(e){const{automationModel:t}=e;return[{minimumRole:"reader",pointer:t.getParentPointer(),type:"record_permission"}]},typecheck(e){const{automationModel:t,contextType:a,getRecordModel:l,intl:u}=e,p=s().Fz.compile(u),c=s().vm.compile(u),d=s().Eo.compile(u),m=t.getParentPointer();let g,y;if("button_block"===a){if(e.pageBlockModel){const t=(0,o(236162).SH)({block:e.pageBlockModel,getRecordModel:l});t&&(g=s().M4.compile(u,t.pointer),y=s().YW.compile(u))}}else if("button_property"===a){const e=l(m);if((null==e?void 0:e.table)!==i().Vl)return{error:new(o(322867).N9)(`Unable to load automation parent: ${o(696706).L3.toKey(m)}`)};g=s().M4.compile(u,e.pointer),y=s().YW.compile(u)}else(0,n().HB)(a);return{value:{valueTypes:(0,r().oE)([p,c,d,g,y])}}},execute(e){const{formulaVariableResolution:t}=e,{executingUserPointer:o,executingUserTimeZone:n,thisPageBlockModel:i}=t??{},l=i?s().M4.evaluate(i.pointer):void 0,u=null==i?void 0:i.getCreatedByPointer(),p=u?s().YW.evaluate(u):void 0,c=o?s().Fz.evaluate(o):void 0,d=(0,a().P)(),m=s().vm.evaluate(n??d),g=s().Eo.evaluate(n??d);return{value:{values:(0,r().oE)([l,p,c,m,g])}}},isAvailableForContext:e=>!0};o(944114);const u={button:l,event:{type:"event",getCreatePermissions(e){const{parentPointer:t,spacePointer:o}=e;return[{minimumRole:"editor",pointer:t,type:"record_permission"},{minimumRole:"read_and_write",pointer:o,type:"record_permission"}]},getEditPermissions(e){const{automationModel:t}=e,r=[{minimumRole:"editor",pointer:t.getParentPointer(),type:"record_permission"},{minimumRole:"read_and_write",pointer:t.getSpacePointer(),type:"record_permission"}],a=t.getTrigger();if("event"===a.type){const e=a.event;(0,n().O9)(e.source)&&"filter"!==e.source.type&&(e.source.type===i().Vl||e.source.type===o(869558).Gy?r.push({minimumRole:"reader",pointer:e.source.pointer,type:"record_permission"}):(0,n().HB)(e.source))}return r},getManagePermissions(e){const{automationModel:t}=e;return[{minimumRole:"editor",pointer:t.getParentPointer(),type:"record_permission"},{minimumRole:"read_and_write",pointer:t.getSpacePointer(),type:"record_permission"}]},getExecutePermissions(e){const{automationModel:t}=e;return[{minimumRole:"reader",pointer:t.getParentPointer(),type:"record_permission"}]},typecheck(e){const{automationModel:t,intl:o}=e,n=s().mO.compile(o),a=s().iY.compile(o),l=s().vm.compile(o),u=s().Eo.compile(o),p=t.getParentPointer();let c;return p.table===i().Vl&&(c=s().qE.compile(o,p)),{value:{valueTypes:(0,r().oE)([n,a,l,u,c])}}},execute(e){const{formulaVariableResolution:t}=e,{executingUserPointer:o,executingUserTimeZone:i,thisPageBlockModel:l}=t??{},u=l?s().qE.evaluate(l.pointer):void 0,p=o?s().mO.evaluate(o):void 0,c=(0,a().P)(),d=s().vm.evaluate(i??c),m=null==l?void 0:l.getCreatedByPointer(),g=(0,n().O9)(m)?s().iY.evaluate(m):void 0,y=s().Eo.evaluate(i??c);return{value:{values:(0,r().oE)([u,p,d,y,g])}}},isAvailableForContext:e=>!0},recurrence:{type:"recurrence",getCreatePermissions(e){const{parentPointer:t}=e;return[{minimumRole:"read_and_write",pointer:t,type:"record_permission"}]},getEditPermissions(e){const{automationModel:t}=e;return[{minimumRole:"read_and_write",pointer:t.getParentPointer(),type:"record_permission"}]},getManagePermissions(e){const{automationModel:t}=e;return[{minimumRole:"read_and_write",pointer:t.getParentPointer(),type:"record_permission"}]},getExecutePermissions(e){const{automationModel:t}=e;return[{minimumRole:"reader",pointer:t.getParentPointer(),type:"record_permission"}]},typecheck(e){const{intl:t}=e;return{value:{valueTypes:[s().vm.compile(t),s().Eo.compile(t)]}}},execute(e){const{formulaVariableResolution:t}=e,{executingUserTimeZone:o}=t??{},r=(0,a().P)();return{value:{values:[s().vm.evaluate(o??r),s().Eo.evaluate(o??r)]}}},isAvailableForContext(e){const{automation:t,automationActions:r,hasPremiumAutomations:a}=e;if(t.parent_table===o(179034).ev)return!0;if(t.parent_table===i().Vl){const e=o(388821).RecordMap.create();for(const t of r)e.addModel(t);return!!t.isCompleteSprintAutomation({getRecordModel:o(792071).b4_.fromRecordMap(e)})||a}(0,n().HB)(t.parent_table)}}};function p(e){return u[e]}},105819:(e,t,o)=>{o.d(t,{x:()=>n});o(296540);const r={viewBox:"0 0 20 20",svg:(0,o(474848).jsx)("path",{d:"m13.987 5.682-.684.684-1.288-1.288.692-.691a.91.91 0 0 1 1.28 0c.35.35.35.93 0 1.28zm-9.433 9.433 7.914-7.914-1.289-1.289-7.92 7.908c-.122.122-.214.29-.274.457l-.336 1.082c-.06.229.153.442.366.366l1.082-.335q.252-.07.457-.275m12.446.76H5.61l1.25-1.25H17a.625.625 0 1 1 0 1.25"})},n=(0,o(340498).wt)("pencilLine",r)},112588:(e,t,o)=>{o.d(t,{Y:()=>c,h:()=>p});o(944114),o(898992),o(354520),o(908872),o(296540);var r=()=>o(56366),n=()=>o(764880),a=()=>o(289915),i=()=>o(546461),s=()=>o(397785),l=()=>o(989064),u=o(474848);function p(e){const{filter:t,propertySchema:o,onClick:n}=e,{automationStore:a}=(0,i().EC)(),p=(0,r().K8)((()=>c(t,a.getRecordModel)),[a.getRecordModel,t]),{title:d,tooltipTitle:m,styles:g}=(0,s().oG)({actorModels:p,messageType:"trigger",operator:t.operator,propertySchema:o});return(0,u.jsx)(l().z,{onClick:n,tooltip:(0,u.jsx)("span",{children:m}),children:(0,u.jsx)("div",{style:g.content,children:d})})}function c(e,t){return(0,a().Wf)(e).reduce(((e,o)=>("exact"===o.type&&o.value&&e.push((0,n().xC)({pointer:o.value,getRecordModel:t})),e)),[])}},120423:(e,t,o)=>{o.d(t,{A:()=>d});o(581454),o(296540);var r=()=>o(484714),n=()=>o(401497),a=()=>o(352271),i=()=>o(959013),s=()=>o(760217),l=()=>o(406699),u=()=>o(89924),p=()=>o(500861),c=o(474848);function d(e){let{action:t,handleOnChange:o}=e;const d=(0,r().Y0)(),m=(0,n().IS)((e=>({buttonStyle:{fontSize:d.isMobile?16:12,height:20,lineHeight:"unset",marginRight:0,paddingLeft:2,paddingRight:2,color:d.isMobile?e.accentColors.gray[900]:e.accentColors.gray[500]}})),[d.isMobile]),y=g[t||a().yP];return(0,c.jsx)(p().A,{alignmentToOrigin:l().yP.Start,innerButtonStyle:m.buttonStyle,selectedTitle:(0,c.jsx)(i().sA,{...y.text}),renderMenuSections:e=>[{key:"ReplaceAddRemoveToggleOperator",render:e=>(0,c.jsx)(u().A,{...e}),items:Object.values(g).map((t=>({key:t.value,action:()=>{e.close(),o(void 0,t.value)},render:e=>(0,c.jsx)(s().A,{...e,title:(0,c.jsx)(i().sA,{...t.text})})})))}]})}const m=(0,i().YK)({replace:{id:"automations.propertyAction.button.replaceWith",defaultMessage:"Replace with..."},append:{id:"automations.propertyAction.button.add",defaultMessage:"Add..."},remove:{id:"automations.propertyAction.button.remove",defaultMessage:"Remove..."},toggle:{id:"automations.propertyAction.button.toggle",defaultMessage:"Toggle..."}}),g={replace:{text:m.replace,value:"replace"},append:{text:m.append,value:"append"},remove:{text:m.remove,value:"remove"},toggle:{text:m.toggle,value:"toggle"}}},133518:(e,t,o)=>{o.d(t,{F:()=>s});var r=o(296540),n=()=>o(310109),a=()=>o(534177),i=()=>o(546461);function s(e){const{actionId:t}=e??{},o=(0,i().YC)();return(0,r.useMemo)((()=>{if(!o.defined)return[];return(0,a().O9)(t)?(0,n().getContextValuesForAction)(o.typecheckResult,t):(0,n().getAllContextValues)(o.typecheckResult)}),[o.defined,o.typecheckResult,t])}},142755:(e,t,o)=>{o.d(t,{F:()=>i});o(296540);var r=()=>o(401497),n=()=>o(704152),a=o(474848);function i(e){const{ariaLabel:t,disabled:o,icon:i,onClick:s,title:l}=e,u=(0,r().IS)((e=>({button:{alignItems:"center",border:`1px solid ${e.stroke.secondary}`,borderRadius:10,color:e.text.secondary,display:"flex",gap:8,justifyContent:"flex-start",padding:12},buttonHoveredStyle:{background:e.outlineButtonHoveredBackground},buttonPressedStyle:{background:e.buttonPressedBackground},iconContainer:{fill:e.icon.secondary,width:20,height:20,display:"flex",justifyContent:"center",alignItems:"center"},title:{fontSize:14,lineHeight:"20px"}})),[]);return(0,a.jsxs)(n().A,{ariaLabel:t,disabled:o,disabledFeedback:o,onClick:s,style:u.button,hoveredStyle:u.buttonHoveredStyle,pressedStyle:u.buttonPressedStyle,children:[i&&(0,a.jsx)("div",{"aria-hidden":"true",style:u.iconContainer,children:i}),(0,a.jsx)("div",{style:u.title,children:l})]})}},214973:(e,t,o)=>{o.d(t,{$B:()=>c,CH:()=>A,CV:()=>a,Ee:()=>w,Fp:()=>L,HG:()=>M,JQ:()=>f,LK:()=>b,NW:()=>s,Od:()=>j,Oo:()=>l,Pb:()=>d,Pg:()=>k,Q$:()=>N,Re:()=>F,Rn:()=>V,SV:()=>x,T2:()=>P,TF:()=>h,Xr:()=>i,Yx:()=>E,_M:()=>S,_d:()=>D,_f:()=>v,a9:()=>B,cC:()=>T,dd:()=>W,f4:()=>g,f_:()=>m,iy:()=>O,kN:()=>K,n1:()=>R,o7:()=>p,qx:()=>C,rh:()=>I,uW:()=>y,vC:()=>u,vH:()=>H,yR:()=>_});o(898992),o(354520),o(581454);var r=()=>o(713998),n=()=>o(496401);const a=(0,o(959013).YK)({actionCheckboxPropertyChecked:{defaultMessage:"checked",id:"automations.action.checkboxProperty.checked"},actionCheckboxPropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.checkboxProperty.single"},actionCheckboxPropertyUnchecked:{defaultMessage:"unchecked",id:"automations.action.checkboxProperty.unchecked"},actionDatePropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.dateProperty.single"},actionNumberPropertySet:{defaultMessage:"{propertyName} {operator} {propertyValues}",id:"automations.action.numberPropertySet.title"},actionTextPropertySet:{defaultMessage:"{propertyName} {operator} {propertyValues}",id:"automations.action.textPropertySet.title"},actionPersonPropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.personProperty.single"},actionPropertyReplaceWith:{defaultMessage:"Replace {propertyName} with {propertyValue}",id:"automations.action.property.replaceWith"},actionPropertyReplaceWithOthers:{defaultMessage:"Replace {propertyName} with {propertyValue} and {numOthers} {numOthers, plural, one {other} other {others}}",id:"automations.action.property.replaceWithOthers"},actionPropertyAdd:{defaultMessage:"Add {propertyValue} to {propertyName}",id:"automations.action.property.add"},actionPropertyAddWithOthers:{defaultMessage:"Add {propertyValue} and {numOthers} {numOthers, plural, one {other} other {others}} to {propertyName}",id:"automations.action.property.addWithOthers"},actionPropertyRemove:{defaultMessage:"Remove {propertyValue} from {propertyName}",id:"automations.action.property.remove"},actionPropertyRemoveWithOthers:{defaultMessage:"Remove {propertyValue} and {numOthers} {numOthers, plural, one {other} other {others}} from {propertyName}",id:"automations.action.property.removeWithOthers"},actionPropertyClear:{defaultMessage:"Clear {propertyName}",id:"automations.action.property.clear"},actionPropertyToggle:{defaultMessage:"Toggle {propertyValue} in {propertyName}",id:"automations.action.property.toggle"},actionPropertyToggleWithOthers:{defaultMessage:"Toggle {propertyValue} and {numOthers} {numOthers, plural, one {other} other {others}} in {propertyName}",id:"automations.action.property.toggleWithOthers"},actionRelationPropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.relationProperty.single"},actionSelectPropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.selectProperty.single"},actionStatusPropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.statusProperty.single"},actionTextPropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.textProperty.single"},actionDeletedProperty:{defaultMessage:"Edit a deleted property",id:"automations.action.deletedProperty"},triggerAnyPageAdded:{defaultMessage:"Page added",id:"automations.trigger.pageAdded.title"},triggerAnyPagePropertyEdit:{defaultMessage:"Any property edited",id:"automations.trigger.anyPagePropertyEdited.title"},triggerAnyPropertyEdit:{defaultMessage:"{propertyName} is edited",id:"automations.trigger.propertyChangesToAny.title"},triggerAnyPropertyClear:{defaultMessage:"{propertyName} is cleared",id:"automations.trigger.propertyCleared.title"},triggerButtonClicked:{defaultMessage:"<b>Button</b> is clicked",id:"automations.trigger.button.clicked"},triggerCheckboxPropertyChecked:{defaultMessage:"checked",id:"automations.trigger.checkboxProperty.checked"},triggerCheckboxPropertySet:{defaultMessage:"{propertyName} set to {propertyValues}",id:"automations.trigger.checkboxPropertySet.title"},triggerCheckboxPropertyUnchecked:{defaultMessage:"unchecked",id:"automations.trigger.checkboxProperty.unchecked"},triggerNumberPropertySet:{defaultMessage:"{propertyName} {operator} {propertyValues}",id:"automations.trigger.numberPropertySet.title"},triggerTextPropertySet:{defaultMessage:"{propertyName} {operator} {propertyValues}",id:"automations.trigger.textPropertySet.title"},triggerSelectPropertyIs:{id:"automations.trigger.selectPropertyIs.title",defaultMessage:"{propertyName} is set to {propertyValues}"},triggerSelectPropertyIsNot:{id:"automations.trigger.selectPropertyIsNot.title",defaultMessage:"{propertyName} is not set to {propertyValues}"},triggerMultiSelectPropertyContains:{id:"automations.trigger.multiSelectPropertyContains.title",defaultMessage:"{propertyName} contains {propertyValues}"},triggerMultiSelectPropertyDoesNotContain:{id:"automations.trigger.multiSelectPropertyDoesNotContain.title",defaultMessage:"{propertyName} does not contain {propertyValues}"},triggerStatusPropertySet:{defaultMessage:"{propertyName} set to {propertyValues}",id:"automations.trigger.statusPropertySet.singleProperty"},triggerPersonPropertyContainsSingle:{defaultMessage:"{propertyName} contains {propertyValue}",id:"automations.trigger.personPropertySet.singleProperty"},triggerPersonPropertyContainsMultiple:{defaultMessage:"{propertyName} contains any of {propertyValues}",id:"automations.trigger.personPropertySet.multipleProperties"},triggerPersonPropertyDoesNotContainSingle:{defaultMessage:"{propertyName} does not contain {propertyValue}",id:"automations.trigger.personPropertyDoesNotContain.singleProperty"},triggerPersonPropertyDoesNotContainMultiple:{defaultMessage:"{propertyName} does not contain any of {propertyValues}",id:"automations.trigger.personPropertyDoesNotContain.multipleProperties"},triggerRelationPropertyDoesNotContainSingle:{defaultMessage:"{propertyName} does not contain {propertyValue}",id:"automations.trigger.relationProperty.singleDoesNotContain"},triggerRelationPropertyDoesNotContainMultiple:{defaultMessage:"{propertyName} does not contain any of {propertyValue}",id:"automations.trigger.relationProperty.multipleDoesNotContain"},triggerRelationPropertyContainsMultiple:{defaultMessage:"{propertyName} contains any of {propertyValue}",id:"automations.trigger.relationProperty.multiple"},triggerRelationPropertyContainsSingle:{defaultMessage:"{propertyName} contains {propertyValue}",id:"automations.trigger.relationProperty.single"},triggerDeletedPropertyEdit:{defaultMessage:"Deleted property is edited",id:"automations.trigger.deletedPropertyEdited"},deletedPropertyOption:{defaultMessage:"Deleted option",id:"automations.values.deletedPropertyOption"},unknownValue:{defaultMessage:"Unknown value",id:"automations.values.unknownValue"},unknownPropertyTitle:{defaultMessage:"a property",id:"database.viewSettings.automationTab.unknownPropertyTitle"},triggerInvalidConfigurationTitle:{defaultMessage:"Invalid {propertyName} property configuration",id:"automations.trigger.invalidConfiguration"},inlineCustomFormulaDefaultName:{defaultMessage:"My value",id:"automations.formulas.inlineCustomFormulaDefaultName"},triggerRelativeDate:{defaultMessage:"Relative date trigger",id:"automations.trigger.relativeDate.title"}});function i(e){const{propertyName:t,propertyValue:o}=e;return{...a.actionCheckboxPropertySetSingle,values:{propertyName:t,propertyValue:o}}}function s(e){const{propertyName:t}=e;return{...a.actionPropertyClear,values:{propertyName:t}}}function l(e){const{propertyName:t,propertyValue:o}=e;return{...a.actionDatePropertySetSingle,values:{propertyName:t,propertyValue:o}}}function u(e){const{propertyName:t,propertyValues:o,operator:r}=e;return{...a.actionNumberPropertySet,values:{propertyName:t,propertyValues:o,operator:r}}}function p(e){const{propertyName:t}=e;return{...a.triggerInvalidConfigurationTitle,values:{propertyName:t}}}function c(e){const{propertyName:t,propertyValues:o,operator:r}=e;return{...a.actionTextPropertySet,values:{propertyName:t,propertyValues:o,operator:r}}}function d(e){const{propertyName:t,propertyValue:o}=e;return{...a.actionPersonPropertySetSingle,values:{propertyName:t,propertyValue:o}}}function m(e){let{elements:t,intl:o}=e;const r=t.length>3?t.length-2:0,a=r>0?2:3,i=o.formatList(t.slice(0,a),{style:"long",type:r>0?"unit":"conjunction"});return{numOthers:r,propertyValue:(0,n().d)(i,{display:"flex"})}}function g(e){const{numOthers:t=0,operator:o,propertyName:r,propertyValue:n}=e;let i;return i=!n||Array.isArray(n)&&0===n.filter((e=>!!e)).length?a.actionPropertyClear:"append"===o?t>0?a.actionPropertyAddWithOthers:a.actionPropertyAdd:"remove"===o?t>0?a.actionPropertyRemoveWithOthers:a.actionPropertyRemove:"toggle"===o?t>0?a.actionPropertyToggleWithOthers:a.actionPropertyToggle:t>0?a.actionPropertyReplaceWithOthers:a.actionPropertyReplaceWith,{...i,values:{propertyName:r,propertyValue:n,numOthers:t}}}function y(e){const{propertyName:t,propertyValue:o}=e;return{...a.actionRelationPropertySetSingle,values:{propertyName:t,propertyValue:o}}}function h(e){const{propertyName:t,propertyValue:o}=e;return{...a.triggerRelationPropertyContainsSingle,values:{propertyName:t,propertyValue:o}}}function f(e){const{propertyName:t,propertyValue:o}=e;return{...a.triggerRelationPropertyContainsMultiple,values:{propertyName:t,propertyValue:o}}}function v(e){const{propertyName:t,propertyValue:o}=e;return{...a.triggerRelationPropertyDoesNotContainSingle,values:{propertyName:t,propertyValue:o}}}function x(e){const{propertyName:t,propertyValue:o}=e;return{...a.triggerRelationPropertyDoesNotContainMultiple,values:{propertyName:t,propertyValue:o}}}function S(e){const{propertyName:t,propertyValue:o}=e;return{...a.actionSelectPropertySetSingle,values:{propertyName:t,propertyValue:o}}}function C(e){const{propertyName:t,propertyValue:o}=e;return{...a.actionStatusPropertySetSingle,values:{propertyName:t,propertyValue:o}}}function b(e){const{propertyName:t,propertyValue:o}=e;return{...a.actionTextPropertySetSingle,values:{propertyName:t,propertyValue:o}}}function T(e){return e.formatMessage(a.actionDeletedProperty)}function A(e){return e.formatMessage(a.triggerAnyPageAdded)}function M(e){return e.formatMessage(a.triggerAnyPagePropertyEdit)}function k(e){return e.formatMessage(a.triggerDeletedPropertyEdit)}function j(e,t){const{propertyName:o}=t;return e.formatMessage(a.triggerAnyPropertyEdit,{propertyName:o})}function P(e,t){return e.formatMessage(a.triggerCheckboxPropertySet,t)}function _(e,t){const{propertyName:o}=t;return e.formatMessage(a.triggerAnyPropertyClear,{propertyName:o})}function V(e){const{propertyName:t,propertyValues:o,operator:r}=e;return{...a.triggerNumberPropertySet,values:{propertyName:t,propertyValues:o,operator:r}}}function I(e){const{propertyName:t,propertyValues:o,operator:r}=e;return{...a.triggerTextPropertySet,values:{propertyName:t,propertyValues:o,operator:r}}}function w(e,t){return e.formatMessage(a.triggerSelectPropertyIs,t)}function R(e,t){return e.formatMessage(a.triggerSelectPropertyIsNot,t)}function N(e,t){return e.formatMessage(a.triggerMultiSelectPropertyContains,t)}function F(e,t){return e.formatMessage(a.triggerMultiSelectPropertyDoesNotContain,t)}function E(e,t){return e.formatMessage(a.triggerStatusPropertySet,t)}function O(e){return e.formatMessage(a.deletedPropertyOption)}function B(e){const{propertyName:t,propertyValues:o}=e;return{...a.triggerPersonPropertyContainsSingle,values:{propertyName:t,propertyValue:o}}}function D(e){const{propertyName:t,propertyValues:o}=e;return{...a.triggerPersonPropertyContainsMultiple,values:{propertyName:t,propertyValues:o}}}function W(e){const{propertyName:t,propertyValues:o}=e;return{...a.triggerPersonPropertyDoesNotContainSingle,values:{propertyName:t,propertyValue:o}}}function L(e){const{propertyName:t,propertyValues:o}=e;return{...a.triggerPersonPropertyDoesNotContainMultiple,values:{propertyName:t,propertyValues:o}}}function K(e){const{limit:t,optionValues:o,propertySchema:n}=e,a=n.options??[],i=a.length>0,s=o.map((e=>{const t=i?(0,r().jy)(a,e):void 0;return t?{type:"option",value:t}:{type:"deleted",value:e}}));let l=s;if(void 0!==t&&s.length>t){const e=s.length-t;l=[...s.slice(0,t),{type:"truncation",value:`+${e}`}]}return l}function H(e){return e.formatMessage(a.triggerRelativeDate)}},217028:(e,t,o)=>{o.d(t,{RY:()=>S,cn:()=>A,gI:()=>b,m9:()=>T,z$:()=>C});var r=o(296540),n=()=>o(56366),a=()=>o(401497),i=()=>o(743176),s=()=>o(693954),l=()=>o(959013),u=()=>o(534177),p=()=>o(284371),c=()=>o(406699),d=()=>o(682146),m=()=>o(963589),g=()=>o(463830),y=()=>o(656134),h=()=>o(741310),f=()=>o(807787),v=()=>o(541172),x=o(474848);function S(e){const{actionMenu:t,buttonPopupStore:o,disabled:r,onClick:n,propertySchema:i}=e,s=(0,m().X)("automation_updated_error_states"),l=(0,a().IS)((e=>({icon:{fill:e.text.uiRedPrimary},propertyType:{color:e.accentColors.red[700]}})),[]),u=T({propertySchema:i,styles:l,hasAutomationUpdatedErrorStatesEnabled:s}),p=A({propertySchema:i,hasAutomationUpdatedErrorStatesEnabled:s});return(0,x.jsx)(C,{actionMenu:t,buttonPopupStore:o,disabled:r,onClick:n,propertyType:i.type,styles:l,tooltip:p,children:u})}function C(e){const{actionMenu:t,buttonPopupStore:o,children:n,disabled:l,onClick:c,propertyType:d,styles:g,tooltip:y,tooltipPlacement:v}=e,S=(0,m().X)("automation_updated_error_states"),C=(0,a().IS)((e=>({content:{color:e.text.uiRedPrimary,fontWeight:S?p().Wy.regular:p().Wy.medium,whiteSpace:"normal"}})),[S]),b=(0,r.useCallback)((e=>(0,x.jsx)(f().aX,{...e,actionMenu:t,buttonPopupStore:o,disabled:l,icon:S&&(0,u().O9)(d)?i().Yp[d]:s().Q,onClick:c,styles:g,hideDragHandle:!0,children:(0,x.jsx)("div",{style:C.content,children:n})})),[t,o,n,l,S,c,g,d,C]);return(0,x.jsx)(h().P,{renderOrigin:b,title:y,tooltipPlacement:v})}function b(e){const{actionId:t,propertyId:o,renderOrigin:a}=e,i=(0,y().j)(),s=(0,n().uB)(void 0,g().A),l=(0,r.useCallback)((()=>s.reset()),[s]);return(0,x.jsx)(c().Ay,{buttonPopupStore:s,popupType:i,render:()=>(0,x.jsx)(v().qM,{actionId:t,closeMenu:l,propertyId:o}),renderOrigin:a})}function T(e){const{propertySchema:t,styles:o,hasAutomationUpdatedErrorStatesEnabled:r}=e,n=t.type,a=d().dC[n];return r?(0,x.jsx)(l().sA,{defaultMessage:'"{propertyTypeDisplayName}" property type is not supported',id:"updateThisPageUnsupportedPropertyAction.updatedUnsupportedProperty.titleElement",values:{propertyTypeDisplayName:a}}):(0,x.jsx)(l().sA,{defaultMessage:"{propertyTypeDisplayName} property type is not supported",id:"updateThisPageUnsupportedPropertyAction.unsupportedProperty.title",values:{propertyTypeDisplayName:(0,x.jsx)("span",{style:o.propertyType,children:a})}})}function A(e){const{propertySchema:t,hasAutomationUpdatedErrorStatesEnabled:o}=e,r=t.type,n=d().dC[r];return o?(0,x.jsx)(l().sA,{defaultMessage:"Change property type or delete to enable this automation",id:"updateThisPageUnsupportedPropertyAction.updatedUnsupportedProperty.title"}):(0,x.jsx)(l().sA,{defaultMessage:"{propertyTypeDisplayName} property type is not supported",id:"updateThisPageUnsupportedPropertyAction.unsupportedProperty.title",values:{propertyTypeDisplayName:n}})}},231713:(e,t,o)=>{o.d(t,{E:()=>i});o(16280),o(898992),o(672577);var r=()=>o(247331),n=()=>o(791089),a=()=>o(919709);function i(e){const{action:t,currentSimpleFormulaValueTokens:o,onCheckboxClick:i,setCurrentTokens:s,value:l}=e;if(l.kind!==r().FormulaContextValueKind.ContextValue)throw new Error("Not implemented yet.");const u=Boolean(o.find((e=>(0,n().isAnnotationSimpleValueToken)(e)&&(0,a().s1Y)(e)&&(0,a().iVq)(e).id===l.id))),p=(0,a().CA$)({id:l.id});return{annotation:p,checkState:u,itemAction:()=>{s("append"===t?u?(0,n().simpleFormulaValueWithoutToken)(o,p):[...o,p]:[p]),null==i||i()}}}},253809:(e,t,o)=>{o.d(t,{A:()=>S,r:()=>A});var r=o(296540),n=()=>o(484714),a=()=>o(56366),i=()=>o(401497),s=()=>o(149375),l=()=>o(274609),u=()=>o(340498),p=()=>o(959013),c=()=>o(284371),d=()=>o(493823),m=()=>o(285790),g=()=>o(928600),y=()=>o(939740),h=()=>o(45552),f=()=>o(722872),v=o(474848);const x=(0,p().YK)({backButtonAriaLabel:{id:"notificationRuleSettingsMenu.backButton.ariaLabel",defaultMessage:"Back to previous step"}});function S(e){const{automationTriggerActionMenuStore:t,customMenuProps:o,headerTitle:r,onClose:n,onDone:a,subHeaderComponent:i,type:s,width:l}=e,u=A({automationTriggerActionMenuStore:t,customMenuProps:o,onClose:n,onDone:a,subHeaderComponent:i,title:r,width:l});return"custom"===s?(0,v.jsx)(b,{...e,menuProps:u}):(0,v.jsx)(C,{...e,menuProps:u})}function C(e){const{sections:t,menuProps:o}=e;return(0,v.jsx)(g().A,{...o,children:(0,v.jsx)(y().Ay,{type:y().Oh.Vertical,initialFocus:0,sections:t})})}function b(e){const{children:t,menuProps:o}=e;return(0,v.jsx)(g().A,{...o,children:t})}function T(e){const{automationActionMenuStore:t,menuHeaderTitle:o,onDone:r,subHeaderComponent:n}=e,l=(0,p().tz)(),g=(0,a().K8)((()=>t.state.stack.length>1),[t]),y=(0,i().IS)((e=>({header:{display:"flex",alignItems:"center",color:e.mediumTextColor,fontWeight:c().Wy.medium,fontSize:c().J.UISmall.desktop,padding:8,justifyContent:"space-between"},leadingItems:{display:"flex",alignItems:"center",gap:6},iconButtonStyle:{height:u().Ev.default,width:u().Ev.default},iconButtonIconStyle:{width:u().Ev.sm,height:u().Ev.sm}})),[]);return void 0!==o||g?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("div",{style:y.header,children:[(0,v.jsxs)("div",{style:y.leadingItems,children:[g&&(0,v.jsx)(m().A,{ariaLabel:l.formatMessage(x.backButtonAriaLabel),icon:s().v,style:y.iconButtonStyle,iconStyle:y.iconButtonIconStyle,onClick:()=>{t.popSettingsItem()}}),o]}),r&&(0,v.jsx)(d().p,{onClick:r,isBlue:!0,size:"xs",children:(0,v.jsx)(p().sA,{id:"automationTriggerActionMenu.doneButton.title",defaultMessage:"Done"})})]}),n]}):null}function A(e){const{automationTriggerActionMenuStore:t,customMenuProps:o={},onClose:a,onDone:i,subHeaderComponent:s,title:u,width:c}=e,{isMobile:d}=(0,n().Y0)(),g=(0,p().tz)(),y=(0,r.useCallback)((()=>{1===t.getState().stack.length?a():t.popSettingsItem()}),[t,a]);return(0,r.useMemo)((()=>{let e;return e=d?{...o,minWidth:260,menuType:f().gu.Modal,title:u,left:(0,v.jsx)(m().A,{ariaLabel:g.formatMessage(x.backButtonAriaLabel),icon:l().L,onClick:y}),right:(0,v.jsx)(h().DoneMenuText,{}),onClickRight:()=>{null==i||i(),a()},header:s}:{width:c??266,menuType:f().gu.Popup,maxHeight:"50vh",header:(0,v.jsx)(T,{automationActionMenuStore:t,menuHeaderTitle:u,subHeaderComponent:s,onDone:i})},e}),[t,o,g,d,a,i,y,s,u,c])}},258804:(e,t,o)=>{o.d(t,{A:()=>u});var r=o(296540),n=()=>o(514503),a=()=>o(959013),i=()=>o(742971),s=()=>o(318249),l=o(474848);function u(e){const{value:t,onChange:o}=e,u=(0,r.useCallback)((()=>{o({type:"formula",value:null==t?void 0:t.value})}),[t,o]);return(0,l.jsx)(s().A,{icon:n().n,title:(0,l.jsx)(a().sA,{...i().D.customFormula}),onClick:u})}},277871:(e,t,o)=>{o.d(t,{A:()=>k});o(944114),o(581454);var r=o(296540),n=()=>o(484714),a=()=>o(401497),i=(o(898992),o(354520),()=>o(56366)),s=()=>o(247331),l=()=>o(791089),u=()=>o(959013),p=()=>o(496603),c=()=>o(38337),d=()=>o(521732),m=()=>o(742971),g=()=>o(246722),y=()=>o(847743),h=()=>o(792540),f=()=>o(351360),v=o(474848);var x=()=>o(722872),S=()=>o(928600),C=()=>o(939740),b=()=>o(45552),T=()=>o(89924),A=()=>o(996027),M=()=>o(231713);function k(e){const{currentSimpleFormulaValueTokens:t,disableEmojiCommands:o,disableFormulas:k,disableFormattingAndMentions:j,disableMobileActionBar:P,disableTemplateVariableMentions:_,formulaTypecheckContextValues:V,menuProps:I,onChange:w,onClose:R,parentRecordStore:N,showGenericHeader:F=!1,value:E}=e,{isMobile:O}=(0,n().Y0)(),{header:B,textInput:D,valueItems:W}=function(e){const{currentSimpleFormulaValueTokens:t,disableEmojiCommands:o,disableFormattingAndMentions:x,disableFormulas:S,disableMobileActionBar:C,disableTemplateVariableMentions:b,formulaTypecheckContextValues:T,onChange:A,onClose:M,parentRecordStore:k,value:j}=e,P=(0,u().tz)(),_=(0,r.useMemo)((()=>T.filter((e=>"text"===e.type.type))),[T]),V=(0,i().K8)((()=>{var e;return null===(e=f().default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),I=(0,r.useCallback)((e=>{A({type:"simple",value:e})}),[A]),w=(0,r.useCallback)((e=>{I(e),M()}),[I,M]),R=(0,r.useCallback)((e=>{const t=void 0!==e[0]?(0,l().toSimpleFormulaSingleValue)(e[0]):void 0;w(t)}),[w]),{store:N}=(0,y().AI)({initialValue:null==j?void 0:j.value,onChange:I}),{isMobile:F}=(0,n().Y0)(),E=(0,a().IS)((e=>({textWrap:{borderRadius:6,lineHeight:"24px",padding:1,...F?{boxShadow:"unset"}:{boxShadow:e.inputBoxShadow,margin:"0 12px"}},simpleFormulaText:{fontSize:12,width:"100%",...F?{padding:"10px"}:{padding:"0px 8px 8px 8px"}},text:{fontSize:12,maxHeight:120,overflow:"auto",...F?{background:"light"===e.mode?e.white:e.selectLightGray[200],margin:0,padding:"10px"}:{background:e.inputBackground,padding:"4px 10px"}}})),[F]),O=p().oE(_.map((e=>{if(e.kind===s().FormulaContextValueKind.ContextValue)return{action:"replace",currentSimpleFormulaValueTokens:t,id:e.id||"",setCurrentTokens:R,value:e}})));let B;return B=V&&k?(0,v.jsx)(d().Y,{...x?{disableDateMentions:!0,disableDateReminderMentions:!0,disableMentions:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0}:{},disabled:!1,disableEmojiCommands:o,disableFormulas:S,disableMobileActionBar:C,disableTemplateVariableMentions:b,formulaTypecheckContextValues:T,onChange:A,onTextEnter:M,parentRecordStore:k,spaceId:V,placeholder:P.formatMessage(m().D.propertyValuePlaceholder),style:E.simpleFormulaText,value:j}):(0,v.jsx)("div",{className:c().CCX,style:E.textWrap,children:(0,v.jsx)(g().A,{disableComment:!0,disabled:!1,disableEmbedMenu:!0,disableEmojiCommands:o,disableMobileActionBar:C,disableSelectAllBlocks:!0,disableSelectionDrag:!0,disableSlashCommands:!0,disableTemplateVariableMentions:b,...x?{disableDateMentions:!0,disableDateReminderMentions:!0,disableMentions:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0}:{},onEnter:M,pasteBehavior:"inline",store:N,style:E.text,inPageFind:h().Os.none,placeholder:P.formatMessage(m().D.propertyValuePlaceholder)})}),{header:P.formatMessage(m().D.genericMenuHeader),textInput:B,valueItems:O}}({currentSimpleFormulaValueTokens:t,disableFormulas:k,disableEmojiCommands:o,disableFormattingAndMentions:j,disableMobileActionBar:P,disableTemplateVariableMentions:_,formulaTypecheckContextValues:V,onChange:w,onClose:R,parentRecordStore:N,value:E})||{},L=(0,a().IS)((e=>({header:{...O&&{borderBlockEnd:`1px solid ${e.lightDividerColor}`}}})),[O]),K=(0,r.useMemo)((()=>W.map((e=>{const{annotation:t,itemAction:o}=(0,M().E)({action:e.action,currentSimpleFormulaValueTokens:e.currentSimpleFormulaValueTokens,setCurrentTokens:e.setCurrentTokens,value:e.value});return{key:e.id,render:e=>(0,v.jsx)(A().A,{annotation:t,disabled:!1,menuArgs:e,parentRecordStore:N}),action:o}}))),[W,N]),H=[];let U;K.length>0&&H.push({key:"textbox",render:e=>(0,v.jsx)(T().A,{...e}),items:K}),U=O?{menuType:x().gu.Modal,right:(0,v.jsx)(b().DoneMenuText,{}),onClickRight:R,minWidth:260}:{menuType:x().gu.Popup,maxHeight:"50vh",width:260,disableHeaderBorder:!0};const Y=F&&(0,v.jsx)(T().A,{style:{paddingBottom:0},title:B}),z=(0,v.jsxs)("div",{style:L.header,children:[!O&&((null==I?void 0:I.header)||Y),(0,v.jsx)(T().A,{children:D})]}),q=(0,v.jsx)(C().Ay,{initialFocus:0,sections:H,type:C().Oh.Vertical});return{headerDiv:z,innerComponents:q,textMenu:(0,v.jsx)(S().A,{...U,...I,header:z,children:q})}}},294852:(e,t,o)=>{o.d(t,{A:()=>G});o(944114),o(581454);var r=o(296540),n=()=>o(484714),a=()=>o(401497),i=()=>o(100622),s=(o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(354520),o(908872),()=>o(908006)),l=()=>o(56366),u=()=>o(970013),p=()=>o(247331),c=()=>o(977345),d=()=>o(791089),m=()=>o(467730),g=()=>o(187174),y=()=>o(792071),h=()=>o(919709),f=()=>o(959013),v=()=>o(496603),x=()=>o(419830),S=()=>o(742971),C=()=>o(258804),b=()=>o(856952),T=()=>o(106628),A=()=>o(361330),M=()=>o(970585),k=()=>o(120423),j=()=>o(674300),P=()=>o(576241),_=o(474848);var V=()=>o(722872),I=()=>o(928600),w=()=>o(939740),R=()=>o(64e3),N=()=>o(45552),F=()=>o(89924),E=()=>o(320865),O=()=>o(996027),B=()=>o(231713),D=()=>o(764880),W=()=>o(798880),L=()=>o(962730),K=()=>o(760217),H=()=>o(625830),U=()=>o(859428),Y=()=>o(448693),z=()=>o(239633),q=()=>o(629203);function $(e){let{annotation:t,disabled:o,getRecordModel:r,isSelected:a,menuArgs:i,showPersonCheckbox:s}=e;const u=(0,n().Y0)(),p=(0,q().U)(),c=(0,l().K8)((()=>{if((0,d().isAnnotationSimpleValueToken)(t)&&(0,h().rie)(t)){const e=(0,h().NcG)(t);return e?(0,D().xC)({pointer:{table:W().oo,id:e},getRecordValue:r}):void 0}}),[t,r]);return null!=c&&c.asActor&&c.table===W().oo?(0,_.jsx)(K().A,{...i,...s?{icon:(0,_.jsx)(H().A,{checked:a,size:14,onClick:i.onClick})}:{},title:o?(0,_.jsx)(U().A,{renderTooltip:()=>(0,_.jsx)(f().sA,{...z().O.maximumPeopleSelectedTooltip}),placement:L().W.Right,render:e=>(0,_.jsx)("div",{style:{width:"100%"},...e,children:(0,_.jsx)(Y().t_,{isSingle:!0,shouldShrink:!0,format:u.isMobile?Y().t_.Format.Large:Y().t_.Format.Medium,userValue:c.asActor})})}):(0,_.jsx)(Y().t_,{isSingle:!0,shouldShrink:!0,format:u.isMobile?Y().t_.Format.Large:Y().t_.Format.Medium,userValue:c.asActor}),disabled:o,style:o?p.disabledMenuItem:void 0,isTokenTitle:!0}):null}function G(e){const{action:t,currentSimpleFormulaValueTokens:o,formulaTypecheckContextValues:D,formulaValueContext:W,getRecordModel:L,isDisabled:K,limit:H,menuProps:U,onChange:Y,onClose:z,showClearButton:q=!1,showFormulaValueItems:G=!1,showGenericHeader:X=!1,showInputMenuItem:Z=!1,showPersonCheckbox:Q=!1,showReplaceAddRemoveToggle:J=!1,value:ee,parentRecordStore:te}=e,oe=(0,n().Y0)(),re=(0,a().IS)((e=>({genericHeader:{paddingBottom:0},headerDiv:{paddingBlockEnd:oe.isMobile?0:6,borderBlockEnd:oe.isMobile?"none":`1px solid ${i().Ay.dividerColor}`},replaceAddRemoveToggleButton:{marginLeft:"8px",marginRight:"8px",marginTop:"8px"}})),[oe.isMobile]),{errorMessage:ne,footer:ae,header:ie,isLoading:se,menuListStore:le,noResultsMessage:ue,replaceAddRemoveToggleButton:pe,searchInput:ce,userItems:de,valueItems:me}=function(e){var t,o;const{action:a,formulaTypecheckContextValues:i,formulaValueContext:V,isDisabled:I=!1,limit:w,onChange:R,onClose:N,showClearButton:F,showReplaceAddRemoveToggle:E,showSelectedPeople:O,unlimitedCurrentSimpleFormulaValueTokens:B,value:D}=e,W=(0,n().v3)(),L=(0,n().Y0)(),K=(0,f().tz)(),H="collection"===(null==V?void 0:V.type)?V.collectionStore.getRecordModel:y().b4_.constant(void 0),U=(0,x().pg)(V),Y=U(B,"first"),z=(0,r.useMemo)((()=>i.filter((e=>(0,c().o5)(e.type,{type:"person"})))),[i]),[q,$]=(0,r.useState)(""),G=(0,l().uB)(void 0,M().A),X=(0,l().K8)((()=>{if("collection"!==V.type)return!1;const e=V.collectionStore.getSchema()[V.property];return e&&(0,u().sO)(e)?1===e.limit:void 0}),[V]),[Z]=(0,g().Yb)((async()=>{const e=q?(0,m().Ay)(q,z,(e=>e.kind===p().FormulaContextValueKind.ContextValue?e.name:"")):z,t=await T().T.searchActions.load(),o=await t.searchVisibleSpaceUsers({environment:W,query:q,membersOnly:!1}),r=(0,d().fromSimpleFormulaArrayValue)(null==D?void 0:D.value).reduce(((e,t)=>(t&&(0,d().isAnnotationSimpleValueToken)(t)&&(0,h().rie)(t)&&e.push(t[1]),e)),[]);let n=0,a=o[n];const i=[];for(;a&&i.length<20;)r.includes(a.id)&&!O||i.push(a.id),n+=1,a=o[n];return{valueResults:e,userResults:i}}),[W,q,O,z,null==D?void 0:D.value],{debounce:A().tu}),Q=(0,r.useCallback)((()=>{$(""),G.setState({...G.state,focus:{section:0,indexLocal:0,indexGlobal:0,footerFocused:!1}})}),[G]),J=(0,r.useCallback)(((e,t)=>{R(e||D,t||a)}),[a,R,D]),ee=(0,r.useCallback)((e=>{const t=U(e,"last");J({type:"simple",value:(0,d().toSimpleFormulaArrayValue)(t)}),Q()}),[U,J,Q]),te=(0,r.useCallback)((()=>{ee(Y.slice(0,Y.length-1))}),[Y,ee]),oe=(0,r.useCallback)((e=>{null==ee||ee((0,d().simpleFormulaValueWithoutToken)(Y,e))}),[Y,ee]),re=Boolean(w&&Y.length>=w),ne=v().oE(Y.map(((e,t)=>"string"==typeof e||"boolean"==typeof e?null:(0,h().rie)(e)?(0,_.jsx)(P().A,{handleRemoveToken:oe,token:e},t):(0,h().s1Y)(e)?(0,_.jsx)(j().A,{formulaTypecheckContextValues:i,handleRemoveToken:oe,isDisabled:I||re,token:e},t):null))),ae=new Set(v().oE(Y.map((e=>(0,d().isAnnotationSimpleValueToken)(e)&&(0,h().s1Y)(e)&&(0,h().iVq)(e).id)))),ie=new Set(v().oE(Y.map((e=>(0,d().isAnnotationSimpleValueToken)(e)&&(0,h().rie)(e)&&(0,h().NcG)(e))))),se=v().oE(((null===(t=Z.value)||void 0===t?void 0:t.valueResults)||[]).map((e=>{const t=e.kind===p().FormulaContextValueKind.ContextValue&&e.id||"";if(!t||!ae.has(t)||O)return{action:"append",currentSimpleFormulaValueTokens:Y,isDisabled:I||re,id:t,getRecordModel:H,setCurrentTokens:ee,value:e}}))),le=v().oE(((null===(o=Z.value)||void 0===o?void 0:o.userResults)||[]).map((e=>{const t=ie.has(e);if(t&&!O)return;const o=(0,h().P4h)(e);return{action:()=>{t?oe(o):ee([...Y,o]),X&&s().default.afterNextFlush((()=>{N()}))},annotation:o,getRecordModel:H,id:e,isDisabled:I||re,userId:e,isSelected:t}}))),ue=[...se,...le],pe=(0,_.jsx)("div",{style:{...!L.isMobile&&{padding:"0 8px 4px 8px"}},children:(0,_.jsx)(b().Ay,{style:{maxHeight:6*parseInt(b().sA,10)},disabled:I||re,dontShowBorderBottom:L.isAndroid,focus:!L.isMobile||void 0,focusAfterAnimation:!0,format:b().le.FilterValue,onChange:e=>$(e.target.value),onClearButtonClick:()=>ee([]),onRemoveLastToken:te,placeholder:K.formatMessage(S().D.personSearchPlaceholder),showClearButton:F,tokens:ne,value:q})}),ce=(0,_.jsx)(C().A,{value:D,onChange:J}),de=(0,_.jsx)(k().A,{action:a,handleOnChange:J});return{errorMessage:Z.error&&K.formatMessage(S().D.somethingWentWrong),footer:ce,header:K.formatMessage(S().D.genericMenuHeader),isLoading:!Z.value&&!Z.error,menuListStore:G,noResultsMessage:0===ue.length&&Z.value&&K.formatMessage(S().D.noResults),replaceAddRemoveToggleButton:!!E&&de,searchInput:pe,userItems:le,valueItems:se}}({action:t,formulaTypecheckContextValues:D,formulaValueContext:W,isDisabled:K,limit:H,onChange:Y,onClose:z,showClearButton:q,showReplaceAddRemoveToggle:J,showSelectedPeople:Q,unlimitedCurrentSimpleFormulaValueTokens:o,value:ee})||{},ge=[...(0,r.useMemo)((()=>me&&G?me.map((e=>{const{annotation:t,itemAction:o}=(0,B().E)({action:e.action,currentSimpleFormulaValueTokens:e.currentSimpleFormulaValueTokens,setCurrentTokens:e.setCurrentTokens,value:e.value});return{key:e.id,render:o=>(0,_.jsx)(O().A,{annotation:t,disabled:e.isDisabled,formulaTypecheckContextValues:D,menuArgs:o,parentRecordStore:te}),action:o}})):[]),[D,G,me,te]),...(0,r.useMemo)((()=>de?de.map((e=>({key:e.userId,render:t=>(0,_.jsx)($,{annotation:e.annotation,disabled:e.isDisabled,getRecordModel:L||e.getRecordModel,isSelected:e.isSelected,menuArgs:t,showPersonCheckbox:Q}),action:e.action}))):[]),[L,Q,de])],ye=[];let he;ge.length>0&&ye.push({key:"users",render:e=>(0,_.jsx)(F().A,{...e}),items:ge}),he=oe.isMobile?{menuType:V().gu.Modal,minWidth:260,right:(0,_.jsx)(N().DoneMenuText,{}),onClickRight:z,footer:ae&&(0,_.jsx)(F().A,{topBorder:!0,children:ae})}:{menuType:V().gu.Popup,maxHeight:"50vh",width:260,footer:ae&&(0,_.jsx)(F().A,{topBorder:!0,children:ae}),disableHeaderBorder:!0};const fe=X&&(0,_.jsx)(F().A,{style:re.genericHeader,title:ie}),ve=(0,_.jsxs)("div",{style:re.headerDiv,children:[!oe.isMobile&&((null==U?void 0:U.header)||fe),Z&&ce]}),xe=(0,_.jsxs)(_.Fragment,{children:[ne&&(0,_.jsx)(F().A,{children:(0,_.jsx)(R().A,{title:ne})}),!se&&!ne&&pe&&(0,_.jsx)("div",{style:re.replaceAddRemoveToggleButton,children:pe}),ue&&(0,_.jsx)(F().A,{children:(0,_.jsx)(R().A,{title:ue})}),se&&(0,_.jsx)(F().A,{children:(0,_.jsx)(E().A,{})}),ge.length>0&&(0,_.jsx)(w().Ay,{type:w().Oh.Vertical,initialFocus:0,sections:ye,store:le})]});return{headerDiv:ve,innerComponents:xe,personArrayMenu:(0,_.jsx)(I().A,{...he,...U,header:ve,children:xe})}}},310109:(e,t,o)=>{o.r(t),o.d(t,{getAllContextValues:()=>f,getContextValueForActionById:()=>x,getContextValuesForAction:()=>v,typecheckAutomation:()=>y,typecheckAutomationAsync:()=>h});o(944114),o(898992),o(581454),o(737550);var r=()=>o(496603),n=()=>o(973647),a=()=>o(534177),i=()=>o(999515),s=()=>o(977345),l=()=>o(329333),u=()=>o(638458),p=()=>o(322867),c=()=>o(281994),d=()=>o(648651),m=()=>o(103966);function*g(e){const{actionModels:t,automationModel:o,contextType:g,formulasModule:y,runtimeStats:h}=e,f={valueTypes:e.valueTypes,actionInputValueTypes:{},actionValidationFailures:{}},v=performance.now();let x,S,C;if("button_block"===g||"button_property"===g){if(!o.isButtonType())return{error:new(p().N9)(`Automation trigger (${o.getTriggerType()}) does not match context type (${g}).`)};const t=o.getTrigger();C=(0,m().Z)(o.getTriggerType()).typecheck(e,t)}else if("event"===g){if(!o.isEventType())return{error:new(p().N9)(`Automation trigger (${o.getTriggerType()}) does not match context type (${g}).`)};const t=o.getTrigger();C=(0,m().Z)(o.getTriggerType()).typecheck(e,t)}else if("recurrence"===g){if(!o.isRecurrenceType())return{error:new(p().N9)(`Automation trigger (${o.getTriggerType()}) does not match context type (${g}).`)};const t=o.getTrigger();C=(0,m().Z)(o.getTriggerType()).typecheck(e,t)}else(0,a().HB)(e);if(n().Q.isFail(C))return C;f.valueTypes.push(...r().o8(C.value.valueTypes));for(const a of t){x=void 0,h&&(x=d().hs.getOrCreateAction(h,a.pointer,a.getType()));const t=(0,l().getActionRegistryItem)(a.getType());if(!t){S={error:new(p().oM)({actionId:a.id,message:`Unsupported action type: ${a.getType()}`})};break}const m=performance.now(),g=(0,u().Q)({automationModel:o,formulasModule:y,formulaValueTypes:f.valueTypes}),v=(0,c().HI)(yield*t.resolveExecutionDependencies(g,a));yield*i().q.fetchRecords(v.map((e=>e.pointer))),x&&(x.totalDependencies=v.length,x.getDependenciesDurationMs=Math.trunc(performance.now()-m));const C=t.typecheck(e,a),b=r().o8(f.valueTypes);if(f.actionInputValueTypes[a.id]=b,n().Q.isFail(C)){S=C;break}for(const e of C.value.valueTypes??[]){f.valueTypes.some((t=>(0,s().oH)(e,t)))||f.valueTypes.push(e)}C.value.validationFailures&&C.value.validationFailures.length>0&&(f.actionValidationFailures[a.id]=C.value.validationFailures)}const b=Math.trunc(performance.now()-v);return h&&(h.typecheckStartTime=v,h.typecheckDurationMs=b,h.typecheckSuccess=!(0,a().O9)(S)),S??{value:f}}function y(e){return i().q.runSync(e.getRecordModel,g(e))}async function h(e){return await i().q.runAsync(e.loadRecordModel,g(e))}function f(e){return n().Q.isFail(e)?[]:e.value.valueTypes.slice(0)}function v(e,t){return n().Q.isFail(e)?[]:e.value.actionInputValueTypes[t]??[]}function x(e,t,o){const r=v(e,t);return(0,s().IV)(r,o)}},318249:(e,t,o)=>{o.d(t,{A:()=>s});o(296540);var r=()=>o(401497),n=()=>o(742117),a=()=>o(760217),i=o(474848);function s(e){const t=(0,r().IS)((e=>({icon:{width:14,fill:e.mediumIconColor},chevronRight:{width:12,fill:e.mediumIconColor}})),[]);return(0,i.jsx)(a().A,{icon:e.icon(t.icon),title:e.title,focused:!1,right:(0,n().V)(t.chevronRight),onClick:e.onClick})}},340743:(e,t,o)=>{o.d(t,{G:()=>s});o(296540);var r=()=>o(401497),n=()=>o(100622),a=()=>o(284371),i=o(474848);function s(e){const{children:t,icon:o,shouldTruncateChildren:s}=e,l=(0,r().IS)((e=>{const t=(0,n().LD)(e,void 0);return{iconWrap:{flex:"0 0 auto"},textWrap:{...s?a().RC:{},flex:"1 1 auto"},wrap:{backgroundColor:t.backgroundColor,borderRadius:12,color:t.textColor,display:"inline-flex",gap:4,minWidth:s?50:void 0,padding:"0 8px"}}}),[s]);return(0,i.jsxs)("span",{style:l.wrap,children:[o&&(0,i.jsx)("span",{"aria-hidden":"true",style:l.iconWrap,children:o}),(0,i.jsx)("span",{style:l.textWrap,children:t})]})}},366360:(e,t,o)=>{o.d(t,{b:()=>s,k:()=>l});o(16280);var r=o(296540),n=()=>o(56366),a=()=>o(546461),i=()=>o(911724);function s(){return(0,r.useContext)(i().A)}function l(){const{automationStore:e}=(0,a().EC)(),{collectionStore:t,...o}=s(),r=(0,n().K8)((()=>{if(!(null!=e&&e.isTriggerType("event")||null!=e&&e.isTriggerType("recurrence")))throw new Error("automationStore is wrong type. Is this called in the wrong type of automation?");return e}),[e]);if(!t)throw new Error("collectionStore is undefined. Is this rendered inside an AutomationEditorContext.Provider?");return{...o,collectionStore:t,automationStore:r}}},383688:(e,t,o)=>{o.d(t,{Hk:()=>g,ZZ:()=>d});o(898992),o(354520),o(296540);var r=()=>o(401497),n=()=>o(834368),a=()=>o(486521),i=()=>o(959013),s=()=>o(284371),l=()=>o(340743),u=()=>o(214973),p=()=>o(989064),c=o(474848);function d(e){const t=(0,i().tz)(),{propertySchema:o,filter:r,onClick:n}=e;return(0,c.jsx)(p().z,{onClick:n,tooltip:g({filter:r,intl:t,propertySchema:o}),children:(0,c.jsx)(m,{propertySchema:o,filter:r})})}function m(e){let{propertySchema:t,filter:o}=e;const n=(0,i().tz)(),a=(0,r().IS)((()=>({propertyName:{...s().RC,fontWeight:s().Wy.medium},wrap:{alignItems:"center",display:"flex",whiteSpace:"pre"}})),[]),l=function(e){const{filter:t,intl:o,propertySchema:r,styles:n}=e,a=r.name,i=t.value,s={propertyName:(0,c.jsx)("span",{style:n.propertyName,children:a}),propertyValues:(0,c.jsx)(y,{checkboxValue:i.value??!1})};return(0,u().T2)(o,s)}({filter:o,intl:n,propertySchema:t,styles:a});return(0,c.jsx)("span",{style:a.wrap,children:l})}function g(e){const{filter:t,intl:o,propertySchema:r}=e,n={propertyName:r.name,propertyValues:!0===t.value.value?(0,c.jsx)(i().sA,{...u().CV.actionCheckboxPropertyChecked}):(0,c.jsx)(i().sA,{...u().CV.actionCheckboxPropertyUnchecked})};return(0,u().T2)(o,n)}function y(e){const{checkboxValue:t}=e,o=!0===t?(0,a().v)({width:12}):(0,n().K)({width:10}),r=!0===t?(0,c.jsx)(i().sA,{...u().CV.actionCheckboxPropertyChecked}):(0,c.jsx)(i().sA,{...u().CV.actionCheckboxPropertyUnchecked});return(0,c.jsx)(l().G,{icon:o,children:r})}},397785:(e,t,o)=>{o.d(t,{H:()=>C,hs:()=>S,oG:()=>v});o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(354520),o(581454),o(296540);var r=()=>o(56366),n=()=>o(401497),a=()=>o(764880),i=()=>o(713998),s=()=>o(784892),l=()=>o(247331),u=()=>o(919709),p=()=>o(959013),c=()=>o(534177),d=()=>o(284371),m=()=>o(448693),g=()=>o(684125),y=()=>o(16707),h=()=>o(214973),f=o(474848);function v(e){const{messageType:t}=e,o=(0,p().tz)(),a=(0,n().IS)((()=>({content:{display:"flex",flexWrap:"wrap",whiteSpace:"pre"},propertyName:{...d().RC,fontWeight:d().Wy.medium},propertyValue:{...d().RC},propertyValueList:{display:"flex",flexBasis:"100%",listStyle:"none",margin:0,padding:0,width:"100%",columnGap:4,rowGap:4},inlineActorTokenContainer:{...d().RC,paddingBlockStart:1},inlineActorToken:{margin:0,paddingRight:0}})),[]),i=(0,r().K8)((()=>"action"===t?function(e){const{getRecordModel:t,contextValues:o,intl:r,operator:n,propertySchema:a,styles:i,value:s}=e;let l;const u=(0,f.jsx)("span",{style:i.propertyName,children:a.name});if("formula"===(null==s?void 0:s.type))l=n?h().f4({operator:n,propertyName:u,propertyValue:(0,f.jsx)(y().g,{returnType:{type:"person"}})}):h().Pb({propertyName:u,propertyValue:(0,f.jsx)(y().g,{returnType:{type:"person"}})});else{const e=x({getRecordModel:t,propertySchema:a,value:s}),p=T(s,o),c=b({actors:e,values:p,showAsList:!1,styles:i}),d=e.length+p.length;l=n?h().f4({...h().f_({elements:Array.isArray(c)?c:[c],intl:r}),operator:n,propertyName:u}):0===d?h().NW({propertyName:u}):h().Pb({propertyName:u,propertyValue:c})}return(0,f.jsx)(p().sA,{...l})}({getRecordModel:e.getRecordModel,contextValues:e.contextValues,intl:o,propertySchema:e.propertySchema,styles:a,value:e.value,operator:e.operator}):"trigger"===t?function(e){const{actorModels:t,propertySchema:o,styles:r,operator:n}=e;if(!t)return null;const a=(0,f.jsx)("span",{style:r.propertyName,children:o.name}),i=b({actors:t,values:[],styles:r,showAsList:!0});let s;if(1===t.length){s=("person_contains"===n?h().a9:h().dd)({propertyName:a,propertyValues:i})}else{s=("person_contains"===n?h()._d:h().Fp)({propertyName:a,propertyValues:i})}return(0,f.jsx)(p().sA,{...s})}({actorModels:e.actorModels,propertySchema:e.propertySchema,operator:e.operator,styles:a}):void(0,c().HB)(t)),[t,e,o,a]);return{tooltipTitle:(0,r().K8)((()=>"action"===t?S({getRecordModel:e.getRecordModel,contextValues:e.contextValues,intl:o,propertySchema:e.propertySchema,styles:a,value:e.value}):"trigger"===t?C({actorModels:e.actorModels,intl:o,operator:e.operator,propertySchema:e.propertySchema,styles:a}):void(0,c().HB)(t)),[t,e,o,a]),title:i,styles:a}}function x(e){const{getRecordModel:t,propertySchema:o,value:r}=e;return(0,i().e5)({blockCreatorPointer:void 0,propertySchema:o,textValue:null==r?void 0:r.value}).map((e=>(0,a().xC)({getRecordModel:t,pointer:e}))).filter(c().O9)}function S(e){const{getRecordModel:t,contextValues:o,intl:r,operator:n,propertySchema:i,styles:s,value:l}=e;let u;const c=(0,f.jsx)("span",{style:null==s?void 0:s.propertyName,children:i.name});if("formula"===(null==l?void 0:l.type))u=n?h().f4({operator:n,propertyName:c,propertyValue:(0,f.jsx)(y().L,{})}):h().Pb({propertyName:c,propertyValue:(0,f.jsx)(y().L,{})});else{const e=x({getRecordModel:t,propertySchema:i,value:l}),s=e.map((e=>(0,a().lR)(r,e))),p=T(l,o),d=p.map((e=>e.tooltipName??e.name)),m=r.formatList([...s,...d],{style:"long",type:"conjunction"}),g=e.length+p.length;u=n?h().f4({propertyName:c,propertyValue:m,operator:n}):0===g?h().NW({propertyName:c}):h().Pb({propertyName:c,propertyValue:m})}return(0,f.jsx)(p().sA,{...u})}function C(e){const{actorModels:t,intl:o,propertySchema:r,styles:n,operator:i}=e;if(!t)return null;const s=(0,f.jsx)("span",{style:null==n?void 0:n.propertyName,children:r.name}),l=t.map((e=>(0,a().lR)(o,e))),u=o.formatList(l,{style:"long",type:"conjunction"});let c;if(1===t.length){c=("person_contains"===i?h().a9:h().dd)({propertyName:s,propertyValues:u})}else{c=("person_contains"===i?h()._d:h().Fp)({propertyName:s,propertyValues:u})}return(0,f.jsx)(p().sA,{...c})}function b(e){const{actors:t,styles:o,showAsList:r=!0,values:n}=e,a=[...t.map(((e,t)=>(0,f.jsx)(m().Ay,{style:o.inlineActorToken,actor:e,showRemoveButton:!1,format:s().NY.Medium,isSingle:!1},t))),...n.map(((e,t)=>(0,f.jsx)(g().F,{style:o.inlineFormulaValue,format:s().NY.Medium,isSingle:!1,value:e},t)))];return 1===a.length?(0,f.jsx)("div",{style:o.propertyValue,children:a[0]}):r?(0,f.jsx)("ul",{style:o.propertyValueList,children:a.map(((e,t)=>(0,f.jsx)("li",{children:(0,f.jsx)("div",{style:o.propertyValue,children:e},t)},t)))}):a.map(((e,t)=>(0,f.jsx)("div",{style:o.inlineActorTokenContainer,children:e},t)))}function T(e,t){const o=new Set(u().kNd(null==e?void 0:e.value).map((e=>e.id))),r=l().FormulaContextValueKind.ContextValue;return t.filter((e=>e.kind===r)).filter((e=>o.has(e.id)))}},404412:(e,t,o)=>{o.d(t,{AK:()=>n,ew:()=>a});class r extends(()=>o(757695))().default{getInitialState(){return{insertionPoint:void 0,stack:[]}}getCurrentTab(){return o(496603).HV(this.getState().stack)}getInsertionPoint(){return this.getState().insertionPoint}pushSettingsItem(e){this.update((t=>({...t,stack:[...t.stack,e]})))}popSettingsItem(){this.update((e=>({...e,stack:e.stack.slice(0,e.stack.length-1)})))}replaceSettingsItem(e){this.update((t=>{const o=[...t.stack.slice(0,t.stack.length-1),e];return{...t,stack:o}}))}setInsertionPoint(e){this.update((t=>({...t,insertionPoint:e})))}}class n extends r{}class a extends r{}},419830:(e,t,o)=>{o.d(t,{Cp:()=>v,aS:()=>h,pG:()=>f,pg:()=>y});o(944114),o(898992),o(354520),o(908872);var r=o(296540),n=()=>o(56366),a=()=>o(970013),i=()=>o(597777),s=()=>o(523872),l=()=>o(681873),u=()=>o(919709),p=()=>o(959013),c=()=>o(534177),d=()=>o(284371),m=()=>o(901389),g=o(474848);function y(e){const t=(0,n().K8)((()=>{if("collection"!==e.type)return;const t=e.collectionStore.getSchema()[e.property];let o;return t&&(0,a().sO)(t)&&(o=t.limit),o}),[e]);return(0,r.useCallback)(((e,o)=>(0,c().O9)(t)?"first"===o?e.slice(0,t):"last"===o?e.slice(-t):void(0,c().HB)(o):e),[t])}function h(e){var t;const o=null===(t=e.collectionStore.getSchema())||void 0===t?void 0:t[e.property];return o&&"date"===o.type?{dateFormat:o.date_format||i().vz,timeFormat:o.time_format||i().CE}:{dateFormat:i().vz,timeFormat:i().CE}}function f(e){if("simple"===(null==e?void 0:e.type)&&e.value){const t=e.value.reduce(((e,t)=>{const o=e.length>0;if((0,u().bHQ)(t))!o&&(0,u()._g9)(t)||e.push((0,u().Ey_)(`"${t[0]}"`));else if((0,u().BEe)(t))e.push((0,u().Ey_)(`"${t[0]}"`));else if((0,u().qXl)(t)){const o=(0,u().uPN)(t),r=(0,u().jhx)(o);if(r){const t=o.filter((e=>!(0,u().jcO)(e)));e.push((0,u().wmz)(r,t))}}return e}),[]),o=(0,u().__s)((0,l().A)(t,(()=>(0,u().Ey_)(" + "))));return o.length>0?o:void 0}return null==e?void 0:e.value}async function v(){const{accept:e}=await m().Gh({acceptButtonType:"outline",acceptColor:void 0,acceptLabel:(0,g.jsx)(p().sA,{id:"formulaInputMenu.handleBack.convert",defaultMessage:"Convert"}),cancelButtonType:"outline",description:(0,g.jsx)(p().sA,{id:"formulaInputMenu.handleBack.description",defaultMessage:"Existing formula content will be lost"}),icon:(0,s().U)({fontWeight:d().Wy.semibold,height:36,width:36}),message:(0,g.jsx)(p().sA,{id:"formulaInputMenu.handleBack.message",defaultMessage:"Convert this variable from a formula to plain text?"})});return e}},438873:(e,t,o)=>{o.d(t,{bK:()=>i,mK:()=>n});const r=["string_is","string_is_not","string_contains","string_does_not_contain","string_starts_with","string_ends_with","is_empty","changes_to_any"];function n(e){const t=e;return r.includes(t)?t:"string_is"}const a=(0,o(959013).YK)({changesToAny:{id:"automations.propertyTrigger.textField.changesToAnyOption",defaultMessage:"Is edited"},isEmpty:{id:"automations.propertyTrigger.textField.isEmpty",defaultMessage:"Is cleared"},stringIs:{id:"automations.propertyTrigger.textField.stringIsOption",defaultMessage:"Is set to"},stringIsNot:{id:"automations.propertyTrigger.textField.stringIsNotOption",defaultMessage:"Is not set to"},stringContains:{id:"automations.propertyTrigger.textField.stringContainsOption",defaultMessage:"Contains"},stringDoesNotContain:{id:"automations.propertyTrigger.textField.stringDoesNotContain",defaultMessage:"Does not contain"},stringStartsWith:{id:"automations.propertyTrigger.textField.stringStartsWithOption",defaultMessage:"Starts with"},stringEndsWith:{id:"automations.propertyTrigger.textField.stringEndsWithOption",defaultMessage:"Ends with"}}),i={string_is:{hasInput:!0,text:a.stringIs,value:"string_is"},string_is_not:{hasInput:!0,text:a.stringIsNot,value:"string_is_not"},string_contains:{hasInput:!0,text:a.stringContains,value:"string_contains"},string_does_not_contain:{hasInput:!0,text:a.stringDoesNotContain,value:"string_does_not_contain"},string_starts_with:{hasInput:!0,text:a.stringStartsWith,value:"string_starts_with"},string_ends_with:{hasInput:!0,text:a.stringEndsWith,value:"string_ends_with"},changes_to_any:{hasInput:!1,text:a.changesToAny,value:"changes_to_any"},is_empty:{text:a.isEmpty,value:"is_empty",hasInput:!1}}},457050:(e,t,o)=>{o.d(t,{Iq:()=>_,UW:()=>k,WE:()=>w,eg:()=>I,oE:()=>j,xL:()=>M});o(898992),o(354520),o(581454),o(737550),o(296540);var r=()=>o(484714),n=()=>o(56366),a=()=>o(401497),i=()=>o(289915),s=()=>o(713998),l=()=>o(784892),u=()=>o(977345),p=()=>o(791089),c=()=>o(179034),d=()=>o(919709),m=()=>o(959013),g=()=>o(534177),y=()=>o(284371),h=()=>o(684125),f=()=>o(512052),v=()=>o(71304),x=()=>o(508496),S=()=>o(630116),C=()=>o(16707),b=()=>o(529135),T=()=>o(214973),A=o(474848);function M(e){const{automationContextValues:t,messageType:o,propertySchema:i,value:s}=e,l=(0,m().tz)(),u=(0,r().v3)(),p=(0,n().K8)((()=>s?_({automationContextValues:t,limit:i.limit,value:s}):[]),[t,i.limit,s]),c=(0,a().IS)((()=>({content:{alignItems:"center",display:"flex",flex:"1 1 auto",flexWrap:"wrap",minWidth:0,whiteSpace:"pre",lineHeight:1.6},operatorContent:{alignItems:"center",flexWrap:"wrap",gridGap:"1px"},propertyName:{...y().RC,fontWeight:y().Wy.semibold,minWidth:20},propertyValue:{...y().RC,minWidth:40},propertyValueList:{display:"flex",flexBasis:"100%",flexDirection:"column",listStyle:"none",margin:0,marginBlockStart:10,padding:0,rowGap:10,width:"100%"},propertyValueListItem:{display:"flex"},and:{marginRight:"4px",marginLeft:"4px"}})),[]),d=(0,n().K8)((()=>{if("action"===o)return function(e){const{intl:t,collectionStore:o,operator:r,propertySchema:n,relationPages:a,styles:i,value:s}=e,l=(0,A.jsx)("span",{style:i.propertyName,children:n.name});let u;const p="formula"===(null==s?void 0:s.type);u=p?(0,A.jsx)("div",{style:i.content,children:(0,A.jsx)(m().sA,{...T().uW({propertyName:l,propertyValue:(0,A.jsx)("span",{style:i.propertyValue,children:(0,A.jsx)(C().g,{returnType:{type:"block"}})})})})}):"replace"===r||"append"===r||"remove"===r||"toggle"===r?(0,A.jsx)("div",{style:{...i.content,...i.operatorContent},children:(0,A.jsx)(m().sA,{...T().f4({...T().f_({elements:a.map(((e,t)=>(0,A.jsx)(P,{propertySchema:n,collectionStore:o,value:e},t))),intl:t}),operator:r,propertyName:l})})}):0===a.length?(0,A.jsx)("div",{style:i.content,children:(0,A.jsx)(m().sA,{...T().NW({propertyName:l})})}):(0,A.jsx)("div",{style:i.content,children:(0,A.jsx)(m().sA,{...T().uW({propertyName:l,propertyValue:(0,A.jsx)("span",{style:i.propertyValue,children:(0,A.jsx)(P,{collectionStore:o,value:a[0],propertySchema:n})})})})});return u}({collectionStore:e.collectionStore,intl:l,operator:e.operator,propertySchema:e.propertySchema,relationPages:p,styles:c,value:e.value});if("trigger"===o){const{collectionStore:t,filter:o,propertySchema:r}=e;return function(e){const{availableTokens:t,collectionStore:o,operator:r,propertySchema:n,relationPages:a,styles:i}=e,s=(0,A.jsx)("span",{style:i.propertyName,children:n.name});let l;if(1===a.length){const e="relation_contains"===r?T().TF:T()._f;l=(0,A.jsx)("div",{style:i.content,children:(0,A.jsx)(m().sA,{...e({propertyName:s,propertyValue:(0,A.jsx)("span",{style:i.propertyValue,children:(0,A.jsx)(P,{availableTokens:t,collectionStore:o,propertySchema:n,value:a[0]})})})})})}else{const e="relation_contains"===r?T().JQ:T().SV;l=(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)("div",{style:i.content,children:(0,A.jsx)(m().sA,{...e({propertyName:s,propertyValue:[]})})}),(0,A.jsx)("ul",{style:i.propertyValueList,children:a.map(((e,r)=>(0,A.jsx)("li",{style:i.propertyValueListItem,children:(0,A.jsx)(P,{availableTokens:t,collectionStore:o,propertySchema:n,value:e})},r)))})]})}return l}({availableTokens:o?I({collectionStore:t,filter:o,propertySchema:r}):void 0,collectionStore:e.collectionStore,operator:e.operator,propertySchema:e.propertySchema,relationPages:p,styles:c})}(0,g().HB)(o)}),[e,l,o,p,c]);return{tooltipTitle:(0,n().K8)((()=>{if("action"===o)return k({collectionStore:e.collectionStore,environment:u,intl:l,operator:e.operator,propertySchema:i,relationPages:p,value:e.value});if("trigger"===o){const{collectionStore:t,filter:o,propertySchema:r}=e;return j({availableTokens:o?I({collectionStore:t,filter:o,propertySchema:r}):void 0,collectionStore:e.collectionStore,environment:u,intl:l,operator:e.operator,propertySchema:e.propertySchema,relationPages:p})}(0,g().HB)(o)}),[e,u,l,o,i,p]),title:d,styles:c}}function k(e){const{collectionStore:t,environment:o,intl:r,operator:n,propertySchema:a,relationPages:i,value:s}=e,l=a.name;if("formula"===(null==s?void 0:s.type))return(0,A.jsx)(m().sA,{...T().uW({propertyName:l,propertyValue:(0,A.jsx)(C().L,{})})});const p=i.map((e=>{if("string"==typeof e){const n=S().Bv.createChildStore(t,{id:e,table:c().ev});return(0,v().tS)({environment:o,intl:r,store:n})}return(0,u().sM)(e)})).filter(g().O9),d=1===p.length?p[0]:r.formatList(p,{style:"long",type:"conjunction"});let y;return y="replace"===n||"append"===n||"remove"===n||"toggle"===n?T().f4({propertyName:l,propertyValue:d,operator:n}):0===p.length?T().NW({propertyName:l}):T().uW({propertyName:l,propertyValue:d}),(0,A.jsx)(m().sA,{...y})}function j(e){const{availableTokens:t,collectionStore:o,environment:r,intl:n,operator:a,propertySchema:i,relationPages:s}=e,l=s.map((e=>{if("string"==typeof e){if(!t||t.some((t=>t.id===e))){const t=S().Bv.createChildStore(o,{id:e,table:c().ev});return(0,v().tS)({environment:r,intl:n,store:t})}return T().iy(n)}return(0,u().sM)(e)})).filter(g().O9),p=i.name,d=1===l.length?l[0]:n.formatList(l,{style:"long",type:"conjunction"});let y;if(1===l.length){y=("relation_contains"===a?T().TF:T()._f)({propertyName:p,propertyValue:d})}else{y=("relation_contains"===a?T().JQ:T().SV)({propertyName:p,propertyValue:d})}return(0,A.jsx)(m().sA,{...y})}function P(e){const{availableTokens:t,collectionStore:o,propertySchema:r,value:n}=e;return!t||t.some((e=>e.id===n))?"string"==typeof n?(0,A.jsx)(f().A,{blockId:n,format:l().NY.Medium,isSingle:!0,noUnderline:!0,parentStore:o,relationPropertySchema:r,shouldShrink:!0}):(0,A.jsx)(h().F,{format:l().NY.Medium,isSingle:!0,shouldShrink:!0,value:n}):(0,A.jsx)(b().A,{tokenFormat:l().NY.Medium},`missing_option_value_${n}`)}function _(e){const{automationContextValues:t,limit:o,value:r}=e;if(!r)return[];return(0,p().fromSimpleFormulaArrayValue)(r.value).slice(0,o).map((e=>{if("string"!=typeof e&&"boolean"!=typeof e){if((0,d().s1Y)(e)){const o=(0,d().iVq)(e).id,r=(0,u().IV)(t,o);if(!r)return;return r}if((0,d().jIt)(e)){var o;const t=null===(o=(0,d().i$F)(e))||void 0===o?void 0:o.id;if(!t)return;return t}}})).filter(g().O9)}function V(e){const{collectionStore:t,filter:o}=e,r=(0,i().Rh)(o),n=t.getSpaceId();return r.map((e=>{if(e.value&&"string"==typeof e.value)return{table:"block",id:e.value,spaceId:n}})).filter(g().O9)}function I(e){const{collectionStore:t,filter:o,propertySchema:r}=e,n=V({collectionStore:t,filter:o});return(0,s().bG)({getRecordModel:t.getRecordModel,propertySchema:r,relationValue:n,includeDeleted:x().default.checkGate({gateName:"relations_show_deleted"}),includeInvalidCollection:x().default.checkGate({gateName:"relations_show_invalid_collection"}),includeNoAccess:x().default.checkGate({gateName:"relations_show_no_access"})})}function w(e){const{collectionStore:t,filter:o}=e,r=V({collectionStore:t,filter:o});return{action:"replace",value:{type:"simple",value:(0,s().Ap)(r)}}}},477329:(e,t,o)=>{o.d(t,{$5:()=>S,JI:()=>x,Ww:()=>f,l5:()=>C});o(898992),o(354520),o(581454),o(296540);var r=()=>o(401497),n=()=>o(713998),a=()=>o(784892),i=()=>o(959013),s=()=>o(534177),l=()=>o(284371),u=()=>o(399762),p=()=>o(881690),c=()=>o(496401),d=()=>o(214973),m=()=>o(529135),g=()=>o(989064),y=o(474848);const h=5;function f(e){const t=(0,i().tz)(),{filter:o,propertySchema:r,onClick:n}=e,a={...l().RC,fontWeight:l().Wy.medium},u=o.value,p=r.name,d=(Array.isArray(u)?u:[u]).map((e=>e.value)).filter(s().O9),m=S({intl:t,isText:!0,limit:h,optionValues:d,propertySchema:r}),f=t.formatList(m,{style:"long",type:"disjunction"}),b=C({filter:o,propertySchema:r});if(!b)return null;const T=x(b)(t,{propertyName:(0,y.jsx)("span",{style:a,children:p}),propertyValues:(0,c().d)(f)});return(0,y.jsx)(g().z,{tooltip:T,onClick:n,children:(0,y.jsx)(v,{...b})})}function v(e){const{filter:t,propertySchema:o}=e,n=(0,i().tz)(),a=t.value,u=o.name,p=(Array.isArray(a)?a:[a]).map((e=>e.value)).filter(s().O9),d=S({intl:n,limit:h,optionValues:p,propertySchema:o}),m=n.formatList(d,{style:"long",type:"disjunction"}),g=(0,r().IS)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"wrap",whiteSpace:"pre",lineHeight:1.6},propertyName:{...l().RC,fontWeight:l().Wy.medium}})),[]),f=C({filter:t,propertySchema:o});if(!f)return null;const v=x(f)(n,{propertyName:(0,y.jsx)("span",{style:g.propertyName,children:u}),propertyValues:(0,c().d)(m)});return(0,y.jsx)("div",{style:g.content,children:v})}function x(e){let{filter:t,propertySchema:o}=e;return"select"===o.type?"enum_is"===t.operator?d().Ee:d().n1:"enum_contains"===t.operator?d().Q$:d().Re}function S(e){let{intl:t,isText:o,limit:r,optionValues:i,propertySchema:s,tokenFormat:l=a().NY.Medium}=e;const c=s.options??[],g=i.map((e=>{const r=(0,n().jy)(c,e);return r?o?r.value:(0,y.jsx)(u().O,{value:r.value,color:r.color,format:l,isSingle:!0,showRemoveButton:!1},r.id):o?(0,d().iy)(t):(0,y.jsx)(m().A,{tokenFormat:l},`missing_option_value_${e}`)}));let h;if(void 0!==r&&g.length>r){const e=g.length-r,t=o?`+${e}`:(0,y.jsx)(p().A,{format:a().NY.Medium,isRound:!0,isSingle:!0,showRemoveButton:!1,value:`+${e}`},"More tokens");h=[...g.slice(0,r),t]}else h=g;return h}function C(e){const{filter:t,propertySchema:o}=e;if("select"===o.type){if("enum_is"===t.operator||"enum_is_not"===t.operator)return{filter:t,propertySchema:o}}else if("multi_select"===o.type&&("enum_contains"===t.operator||"enum_does_not_contain"===t.operator))return{filter:t,propertySchema:o};return!1}},486521:(e,t,o)=>{o.d(t,{v:()=>n});o(296540);var r=o(474848);const n=(0,o(340498).wt)("checkboxSquareChecked",{viewBox:"0 0 14 14",svg:(0,r.jsx)("path",{d:"M2.85742 13.4561H11.1357C12.6123 13.4561 13.3779 12.6904 13.3779 11.2344V2.91504C13.3779 1.45215 12.6123 0.693359 11.1357 0.693359H2.85742C1.38086 0.693359 0.615234 1.45215 0.615234 2.91504V11.2344C0.615234 12.6973 1.38086 13.4561 2.85742 13.4561ZM2.93945 12.1162C2.30371 12.1162 1.95508 11.7812 1.95508 11.1182V3.02441C1.95508 2.36133 2.30371 2.0332 2.93945 2.0332H11.0537C11.6826 2.0332 12.0381 2.36133 12.0381 3.02441V11.1182C12.0381 11.7812 11.6826 12.1162 11.0537 12.1162H2.93945ZM6.26855 10.3115C6.51465 10.3115 6.72656 10.1885 6.87012 9.96973L9.92578 5.19141C10.0146 5.04785 10.0967 4.88379 10.0967 4.72656C10.0967 4.3916 9.7959 4.16602 9.47461 4.16602C9.26953 4.16602 9.08496 4.27539 8.94141 4.50781L6.24121 8.8418L4.96973 7.22168C4.80566 7.00977 4.6416 6.93457 4.43652 6.93457C4.10156 6.93457 3.8418 7.20117 3.8418 7.54297C3.8418 7.70703 3.90332 7.85742 4.01953 8.00098L5.63281 9.96973C5.81738 10.209 6.01562 10.3115 6.26855 10.3115Z"})})},496401:(e,t,o)=>{o.d(t,{d:()=>n});o(944114),o(296540);var r=o(474848);function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!Array.isArray(e))return[e];const o=[];for(const n of e)if("string"==typeof n&&" "!==n[0]){const e=o.pop();o.push((0,r.jsxs)("div",{style:t,children:[e,n]}))}else o.push(n);return o}},521732:(e,t,o)=>{o.d(t,{Y:()=>S});var r=o(296540),n=()=>o(908006),a=()=>o(484714),i=()=>o(56366),s=()=>o(401497),l=()=>o(496603),u=()=>o(534177),p=()=>o(829300),c=()=>o(725614),d=()=>o(963589),m=()=>o(24157),g=()=>o(84817),y=()=>o(406699),h=()=>o(959013),f=o(474848);const v=(0,h().YK)({simpleFormulaMentionActionButtonAriaLabel:{id:"formulas.simpleFormulaMentionActionButton.ariaLabel",defaultMessage:"Mentions"},simpleFormulaMentionActionButtonTooltip:{id:"formulas.simpleFormulaMentionActionButton.tooltip",defaultMessage:"Mention a person, page, or date"}});function x(e){const{disabled:t,onClick:n}=e,a=(0,h().tz)(),i=(0,s().IS)((e=>({formulaIcon:{fill:e.mediumIconColor,height:16,width:16},button:{height:20,width:20,borderRadius:4}})),[]),l=(0,r.useCallback)((()=>a.formatMessage(v.simpleFormulaMentionActionButtonTooltip)),[a]),u=(0,r.useCallback)((e=>(0,f.jsx)(o(285790).A,{...e,ariaLabel:a.formatMessage(v.simpleFormulaMentionActionButtonAriaLabel),disabled:t,disabledFeedback:t,icon:o(617640).m,iconStyle:i.formulaIcon,onClick:n,style:i.button})),[t,a,n,i]);return(0,f.jsx)(o(859428).A,{disableTooltip:t,renderTooltip:l,placement:o(962730).W.Bottom,render:u})}const S=r.forwardRef((function(e,t){const{allowedReturnTypes:h,disabled:v,disabledMentionTypes:S,disableEmojiCommands:C,disableFilters:b,disableFormulas:T,disableInsertedDeletedAnnotations:A,disableMentions:M,disableMobileActionBar:k,disableNewLines:j,disableStyleAnnotations:P,formulaInputButtonPopupStore:_,formulaTypecheckContextValues:V,onChange:I,onTextEnter:w,onTextStoreSelect:R,onTextStoreUnselect:N,onTextEsc:F,parentRecordStore:E,placeholder:O,rows:B,shouldShowErrorStyles:D,spaceId:W,style:L,value:K}=e,H=Boolean(v),U=(0,a().v3)(),{isMobile:Y}=(0,a().Y0)(),z=(0,r.useRef)(null),q=(0,d().X)("automation_updated_error_states"),$=(0,i().uB)(_,o(463830).A),[G,X,Z]=r.useMemo((()=>{var e;const t=(null==K?void 0:K.type)??"simple",r=null==K?void 0:K.value;return[t,r,(0,u().O9)(r)?(null===(e=o(919709).q4_(r).match(/\n/g))||void 0===e?void 0:e.length)??0:0]}),[null==K?void 0:K.type,null==K?void 0:K.value]),Q="formula"===G,J=(0,r.useMemo)((()=>Z>0||void 0!==B&&B>1),[Z,B]),ee=r.useRef(!1),te=(0,r.useMemo)((()=>{if(I)return function(e){ee.current?ee.current=!1:I({type:G,value:e})}}),[I,G]),{automationStore:oe}=(0,o(546461).YC)(),re=(0,r.useMemo)((()=>oe?{automation_id:[[oe.id]]}:void 0),[oe]),{setValue:ne,store:ae}=(0,o(847743).AI)({initialValue:X,onChange:te,properties:re}),ie=(0,i().K8)((()=>ae.getValue()),[ae]);r.useEffect((()=>{(0,l().n4)(X,ie)||(ee.current=!0,ne(X))}),[ie,ne,X]);const se=r.useRef(V);r.useEffect((()=>{(0,l().n4)(V,se.current)||(se.current=V,(0,l().n4)(X,ie)||(ee.current=!0),ne(X))}),[V,ie,ne,X]);const le=(0,i().K8)((()=>!1!==(0,o(792002).j_)(ae)),[ae]);r.useEffect((()=>{if(le)return null==R||R(),function(){null==N||N()}}),[le,R,N]);const ue=(0,r.useMemo)((()=>({...S,reminder:!0})),[S]),pe=(0,r.useMemo)((()=>j?w:function(){const e=m().default.state;"editing"===e.mode&&o(317909).createAndCommit({userAction:"SimpleFormulaValueTextInput.handleEnter",environment:U,canUndo:!0,perform:t=>{o(606952).$D({disableEmojiCommands:!0,disableMentions:!0,disableSlashCommands:!0,editorMode:"default",environment:U,multiSelection:e.multiSelection,string:"\n",transaction:t})}}),null==w||w()}),[U,j,w]),ce=(0,r.useCallback)((()=>{const e=m().default.state;"editing"===e.mode&&(0,o(231722).KP)(e.multiSelection)&&e.multiSelection.start.store===ae||(c().setSelectionAtEnd({store:ae}),n().default.afterNextFlush((()=>{const e=null==z?void 0:z.current,t=null==e?void 0:e.getNode();t&&t.scrollTo({top:t.scrollHeight})})))}),[z,ae]),de=r.useRef(!1),me=r.useCallback((()=>{de.current||(p().VN(),o(393255).VN({dismissed:!1}),o(131581).VN()),de.current=!1,ce()}),[ce]),ge=(0,r.useCallback)((e=>null==I?void 0:I(e)),[I]),ye=(0,r.useCallback)((e=>{e.stopPropagation(),async function(){de.current=!0,p().VN(),null==R||R(),ce(),await n().default.afterNextFlush(),p().Gf({environment:U,mentionSectionOrdering:["custom-formula","formula"],mentionTypes:{bot:!0,createPage:!1,date:!0,formulaContextVariable:!0,group:!0,team:!0,heading:!0,inviteUserToPage:!1,inviteUserToWorkspace:!1,page:!0,reminder:!1,templateVariable:!1,user:!0}})}()}),[U,R,ce]),he=(0,r.useCallback)((e=>{ce(),e.stopPropagation()}),[ce]),fe=(0,r.useCallback)((e=>{if(e.relatedTarget&&(e.currentTarget.contains(e.relatedTarget)||(0,o(253579).Rp)(e.relatedTarget)))return;const t=m().default.getState();if("editing"!==t.mode)return;t.multiSelection.start.store.id===ae.id&&c().clear({environment:U})}),[U,ae.id]),ve=r.useCallback((async()=>{if("formula"===G){await(0,o(419830).Cp)()&&(null==I||I({type:"simple",value:null==K?void 0:K.value}))}else"simple"===G?$.setState({open:!0}):(0,u().HB)(G)}),[$,I,null==K?void 0:K.value,G]),xe=(0,r.useCallback)((()=>$.setState({open:!1})),[$]),Se=(0,r.useCallback)((()=>ce()),[ce]),Ce=(0,r.useCallback)((()=>{le&&c().clear({environment:U})}),[U,le]);r.useImperativeHandle(t,(()=>({blur:Ce,focus:Se})),[Ce,Se]);const be=(0,d().X)("collections_xws"),Te=(0,s().IS)((e=>{const t={whiteSpace:"pre-wrap",lineHeight:"20px",padding:"2px 4px",fontSize:14};return{buttonWrap:{alignSelf:"end"},containerWrap:{width:200,...L},formulaIcon:{fill:Q?e.icon.uiBluePrimary:e.mediumIconColor},formulaText:{...t,cursor:"pointer"},scroller:{flexGrow:1,height:void 0!==B?`calc(1em * ${1.5*B})`:void 0,maxHeight:"calc(1em * 6)",width:void 0!==B&&B>1||J?"100%":"auto"},text:{...t},textWrap:{cursor:"text",display:"flex",flexWrap:"wrap",justifyContent:"end",opacity:H?.4:void 0,width:"100%"},wrap:{background:e.inputBackground,borderRadius:6,boxShadow:e.inputBoxShadow,boxSizing:"border-box",cursor:"text",padding:2,...D&&q&&{border:`1px solid ${e.text.uiRedPrimary}`,boxShadow:"none"}},actionButtonGroup:{alignSelf:"end",cursor:"unset",justifyContent:"end",padding:"2px 2px 2px 0px"}}}),[q,H,J,Q,B,D,L]),Ae=!M||!T,Me=M||Q,ke=be?"cross_space_and_read_permissions":"read_permissions_only";return(0,f.jsx)(y().Ay,{buttonPopupStore:$,popupType:Y?y().z7.SlideUp:y().z7.Popup,render:()=>(0,f.jsx)(o(999638).A,{allowedReturnTypes:h,disabled:H,formulaTypecheckContextValues:V??[],onChange:ge,onClose:xe,parentRecordStore:E,restrictUnaccessibleProperties:ke,spaceId:W,value:K}),renderOrigin:e=>(0,f.jsx)("div",{onClick:he,style:Te.containerWrap,onBlur:fe,children:(0,f.jsx)(g().Y1,{align:"center",className:o(38337).CCX,direction:"vertical",gap:4,style:Te.wrap,children:(0,f.jsxs)("div",{style:Te.textWrap,children:[(0,f.jsx)(o(2143).H,{ref:z,style:Te.scroller,type:o(756279).A.Y,children:"simple"===G?(0,f.jsx)(o(246722).A,{disableComment:!0,disabled:H,disabledMentionTypes:ue,disableEmbedMenu:!0,disableEmojiCommands:C,disableFilters:b,disableInsertedDeletedAnnotations:A,disableMentions:M,disableMobileActionBar:k,disableSelectAllBlocks:!0,disableSelectionDrag:!0,disableShiftEnter:j,disableSlashCommands:!0,disableStyleAnnotations:P,formulaValueTypes:V??[],inPageFind:o(792540).Os.none,mentionSectionOrdering:["custom-formula","formula"],onDown:l().D_,onEnter:pe,onFocus:me,onTab:l().D_,onUntab:l().D_,onUp:l().D_,onEsc:F,pasteBehavior:"inline",placeholder:O,store:ae,style:Te.text}):(0,f.jsx)("div",{...e,style:Te.formulaText,children:(0,f.jsx)(o(905209).$,{formulaTypecheckContextValues:V,parentRecordStore:E,spaceId:W,value:K})})}),Ae&&(0,f.jsx)("div",{children:(0,f.jsxs)(g().Y1,{direction:"horizontal",gap:2,style:Te.actionButtonGroup,children:[!Me&&(0,f.jsx)(x,{disabled:H,onClick:ye}),!T&&(0,f.jsx)(o(50401).F,{disabled:H,onClick:ve,value:K})]})})]})})})})}))},527871:(e,t,o)=>{o.d(t,{V:()=>s});o(898992),o(354520),o(581454);var r=()=>o(103966),n=()=>o(534177),a=()=>o(351360),i=()=>o(597898);function s(e){var t,o;const{triggerType:s,environment:l,automationStore:u}=e;if(null==u||!u.isDefined())return!0;const p=(0,r().Z)(s),c=a().default.state,d=(0,i().zD)(l,{name:"premium_automations",spaceId:null===(t=c.currentSpaceStore)||void 0===t?void 0:t.id,userId:null===(o=c.currentUserStore)||void 0===o?void 0:o.id});return p.isAvailableForContext({automation:u.getModel(),automationActions:u.getActionStores().map((e=>e.getModel())).filter(n().O9),hasPremiumAutomations:d})}},529135:(e,t,o)=>{o.d(t,{A:()=>c});o(296540);var r=()=>o(484714),n=()=>o(401497),a=()=>o(784892),i=()=>o(693954),s=()=>o(959013),l=()=>o(881690),u=()=>o(214973),p=o(474848);function c(e){let{key:t,tokenFormat:o=a().NY.Medium,isSingle:c,showRemoveButton:d,onClickRemove:m}=e;const{isMobile:g}=(0,r().Y0)(),y=(0,s().tz)(),h=(0,n().IS)((e=>{const t="light"===e.mode?400:800,o="light"===e.mode?50:200,r="light"===e.mode?700:900;return{tokenValueWrap:{display:"inline-flex",gap:"4px",alignItems:"baseline"},warning:{color:e.accentColors.orange[t],height:"auto",width:g?16:14},warningWrap:{alignSelf:"center"},token:{backgroundColor:e.accentColors.yellow[o]},textWrap:{color:e.accentColors.yellow[r]}}}),[g]);return(0,p.jsx)(l().A,{format:o,isSingle:c??!0,showRemoveButton:d??!1,onClickRemove:m,style:h.token,value:(0,p.jsxs)("span",{style:h.tokenValueWrap,children:[(0,p.jsx)("span",{style:h.warningWrap,children:(0,i().Q)(h.warning)}),(0,p.jsx)("span",{style:h.textWrap,children:(0,u().iy)(y)})]})},t)}},535511:(e,t,o)=>{o.d(t,{xB:()=>Y,Kn:()=>Z,ck:()=>$,vV:()=>q});o(898992),o(737550);var r=o(296540),n=()=>o(484714),a=()=>o(56366),i=()=>o(401497),s=()=>o(72645),l=()=>o(959013),u=()=>o(534177),p=()=>o(284371),c=()=>o(406699),d=()=>o(285790),m=(o(354520),o(581454),()=>o(760217)),g=()=>o(89924),y=()=>o(500861),h=o(474848);function f(e){let{disabled:t,handleSelectOperator:o,selectedItem:a}=e;const s=(0,n().Y0)(),u=(0,i().IS)((e=>({buttonWrap:{height:"initial"},buttonStyle:{fontSize:s.isMobile?14:12,height:18,lineHeight:"unset",marginRight:2,marginLeft:2,paddingLeft:2,paddingRight:2,textTransform:"lowercase",fontWeight:p().Wy.semibold,...t?{opacity:"unset",color:"unset"}:{color:e.lightTextColor}},downIconStyle:{...t?{fill:"unset",opacity:"unset"}:{fill:e.lightTextColor}}})),[s.isMobile,t]),d=Object.values(x).filter((e=>e.shown)),f=(0,r.useMemo)((()=>x[a].shown?x[a]:x.all),[a]);return(0,h.jsx)(y().A,{disabled:t,alignmentToOrigin:c().yP.Start,style:u.buttonWrap,innerButtonStyle:u.buttonStyle,downIconStyle:u.downIconStyle,selectedTitle:(0,h.jsx)(l().sA,{...f.text}),renderMenuSections:e=>[{key:"selectTriggerOperator",render:e=>(0,h.jsx)(g().A,{...e}),items:d.map((t=>({key:t.value,action:()=>{o(t.value),e.close()},render:e=>(0,h.jsx)(m().A,{...e,title:(0,h.jsx)(l().sA,{...t.text})})})))}]})}const v=(0,l().YK)({allOf:{id:"automations.propertyTrigger.all",defaultMessage:"All of"},anyOf:{id:"automations.propertyTrigger.any",defaultMessage:"Any of"},all:{id:"automations.builderModal.propertyTrigger.all",defaultMessage:"All"},any:{id:"automations.builderModal.propertyTrigger.any",defaultMessage:"Any"}}),x={all:{text:v.all,value:"all",shown:!0},some:{text:v.any,value:"some",shown:!0},none:{shown:!1,value:"none"},any:{shown:!1,value:"any"}};var S=()=>o(546461),C=()=>o(656134),b=()=>o(813716),T=()=>o(142755);const A=(0,o(340498).wt)("cursorArrowClick2",{viewBox:"0 0 20 20",svg:(0,h.jsxs)("g",{children:[(0,h.jsx)("path",{d:"M0 10.18c0 3.74 2.158 7.04 5.107 8.661 1.026.577 1.875-.79.743-1.445-2.452-1.367-4.18-4.082-4.18-7.217 0-4.609 3.672-8.3 8.281-8.3 4.61 0 8.31 3.691 8.31 8.3 0 .586.45.87.88.87.4 0 .78-.293.78-.87 0-5.449-4.52-9.96-9.97-9.96C4.511.218 0 4.73 0 10.178Z"}),(0,h.jsx)("path",{d:"M3.945 10.18c0 2.177 1.192 4.003 2.618 4.921.986.664 1.835-.654 1.005-1.22a4.41 4.41 0 0 1-2.011-3.702A4.38 4.38 0 0 1 9.95 5.765c2.442 0 4.326 1.944 4.414 4.414.02.45.362.801.81.801.45 0 .802-.351.802-.8 0-3.301-2.725-6.026-6.026-6.026-3.281 0-6.006 2.725-6.006 6.025Z"}),(0,h.jsx)("path",{d:"M9.58 17.25c-.01.38.44.508.684.263l1.494-1.494 1.67 4.121c.078.186.273.274.449.205l.967-.39c.176-.078.244-.283.156-.469l-1.748-4.063 2.1-.078c.37-.02.546-.38.283-.654l-5.332-5.488c-.254-.254-.625-.108-.635.254Z"})]})});var M=()=>o(214973),k=()=>o(997939);function j(){const e=(0,l().tz)(),{automationStore:t}=(0,S().EC)();if(!_(t))return null;const o=e.formatMessage(M().CV.triggerButtonClicked,{b:P});return(0,h.jsx)(k().X,{icon:A,tooltip:o,children:o})}function P(e){return(0,h.jsx)("span",{style:{fontWeight:p().Wy.medium},children:e})}function _(e){return(0,a().K8)((()=>Boolean(null==e?void 0:e.isTriggerType("button"))),[e])}var V=()=>o(689094);function I(){const{automationStore:e}=(0,S().EC)(),{removePageAddedTrigger:t}=(0,b().p)(),o=(0,l().tz)(),r=(0,i().IS)((()=>({title:{fontWeight:p().Wy.medium}})),[]);if(!w(e))return null;const n=M().CH(o);return(0,h.jsx)(k().X,{icon:V().W,onDelete:t,tooltip:n,children:(0,h.jsx)("div",{style:r.title,children:n})})}function w(e){return(0,a().K8)((()=>{if(null==e||!e.isTriggerType("event"))return!1;const t=e.getEventConfiguration();return Boolean(null==t?void 0:t.pagesAdded)}),[e])}var R=()=>o(897499),N=()=>o(961137),F=()=>o(643381),E=()=>o(464708),O=()=>o(104636),B=()=>o(548526),D=()=>o(621627);function W(){const{automationStore:e}=(0,S().EC)(),{removeRecurrenceTrigger:t}=(0,b().p)(),o=(0,i().IS)((e=>({title:{fontWeight:p().Wy.medium,display:"flex",gap:6,alignItems:"center"},badgeContainer:{alignItems:"center",display:"flex"},icon:{width:12,height:12,marginRight:"4px"},badge:{backgroundColor:e.tint.regular,color:e.text.secondary,marginLeft:8}})),[]),r=function(e){return(0,a().K8)((()=>Boolean(null==e?void 0:e.isTriggerType("recurrence"))),[e])}(e),n=(0,a().K8)((()=>(0,O().NH)(e)),[e]);return r?(0,h.jsx)(k().X,{icon:F().l,onDelete:t,children:(0,h.jsxs)("div",{style:o.title,children:[(0,h.jsx)(l().sA,{id:"RecurrenceTrigger.title",defaultMessage:"<span>Every </span>{frequency}",values:{frequency:(0,h.jsx)(L,{}),span:e=>(0,h.jsx)("span",{style:{flex:0},children:e})}}),n&&(0,h.jsx)(E().A,{style:o.badge,content:(0,h.jsx)("div",{style:o.badgeContainer,children:(0,h.jsx)(l().sA,{defaultMessage:"Completed",id:"automationSummaryCard.completedToken"})})})]})}):null}function L(){const e=(0,l().tz)(),{isMobile:t}=(0,n().Y0)(),{automationStore:o}=(0,S().EC)(),{changeRecurrenceSchedule:r}=(0,b().p)(),i=(0,a().K8)((()=>o.getRecurrence()),[o]),s=i?(0,O().LS)({intl:e,recurrence:i}):(0,h.jsx)(l().sA,{id:"RecurrenceTrigger.frequency",defaultMessage:"frequency"}),p=(0,D().$)({recurrence:i,onChange:r,disabled:!1,autoFocusIfNew:!0});return(0,h.jsx)(c().Ay,{...p,popupType:t?c().z7.SlideUp:c().z7.Popup,placementToOrigin:c().sx.Bottom,renderOrigin:e=>(0,h.jsx)(B().x,{...e,isCompact:!0,dropdownButtonType:"dropdown",hasActionRequired:!(0,u().O9)(i),children:s})})}var K=()=>o(918676);function H(){const{automationStore:e}=(0,S().EC)(),{removeRelativeDateTrigger:t}=(0,b().p)(),o=(0,l().tz)(),r=(0,i().IS)((()=>({title:{fontWeight:p().Wy.medium}})),[]);if(!U(e))return null;const n=M().vH(o);return(0,h.jsx)(k().X,{icon:K().y,onDelete:t,tooltip:n,children:(0,h.jsx)("div",{style:r.title,children:n})})}function U(e){return(0,a().K8)((()=>{if(null==e||!e.isTriggerType("event"))return!1;const t=e.getEventConfiguration();return Boolean(null==t?void 0:t.relativeDate)}),[e])}const Y="automation-list-item automation-list-item-modal",z=(0,l().YK)({newTriggerLabel:{defaultMessage:"New trigger",id:"collectionSettings.editAutomationView.triggerSection.newPlaceholder"},addTriggerLabel:{defaultMessage:"Add trigger",id:"collectionSettings.editAutomationView.triggerSection.placeholder"},addTriggerAriaLabel:{id:"collectionSettings.editAutomationView.addTrigger.iconButton",defaultMessage:"Add trigger"},builderModalTriggerTitleWithOperatorButton:{defaultMessage:"When {operatorButton} triggers occur",id:"builderModal.editAutomationView.triggerSection.titleWithOperator"},buttonBuilderTriggerTitleOrNoTriggers:{defaultMessage:"When",id:"builderModal.editAutomationView.buttonBuilderTriggerSection.title"}});function q(){return(0,i().IS)((e=>({wrap:{position:"relative",paddingInline:1},list:{display:"flex",flexDirection:"column"}})),[])}function $(e){const{children:t}=e;return(0,h.jsx)("div",{className:Y,children:t})}function G(e){const{children:t}=e,o=q();return(0,h.jsx)("div",{style:o.wrap,children:(0,h.jsx)("div",{style:o.list,children:t})})}function X(e){const{variant:t,hasAnyTriggers:o}=e,n=(0,C().j)(),a=(0,l().tz)(),i=(0,r.useMemo)((()=>({type:"eventTriggers"})),[]);return(0,h.jsx)(c().Ay,{alignmentToOrigin:c().yP.Start,placementToOrigin:c().sx.Bottom,popupType:n,render:e=>(0,h.jsx)(N().A,{initialState:i,buttonPopupParent:e}),renderOrigin:e=>"icon"===t?(0,h.jsx)(d().A,{...e,ariaLabel:a.formatMessage(o?z.addTriggerLabel:z.newTriggerLabel),icon:s().b}):(0,h.jsx)(T().F,{...e,ariaLabel:a.formatMessage(z.addTriggerAriaLabel),icon:(0,s().b)({height:16,width:16}),title:(0,h.jsx)(l().sA,{...o?z.addTriggerLabel:z.newTriggerLabel})})})}function Z(e){const{isEditable:t}=e,{isMobile:o}=(0,n().Y0)(),{showAnyPropertyTriggers:r,showButtonClickedTrigger:s,showPageAddedTrigger:u,showRecurrenceTrigger:c,showRelativeDateTrigger:d}=function(){const{automationStore:e}=(0,S().EC)(),t=_(e),o=w(e),r=(0,R().CD)(e),n=(0,a().K8)((()=>Boolean(e.isTriggerType("recurrence"))),[e]),i=U(e);return{showAnyPropertyTriggers:r,showPageAddedTrigger:o,showButtonClickedTrigger:t,showRecurrenceTrigger:n,showRelativeDateTrigger:i}}(),m=r||s||u||c||d,g=!c,y=(0,i().IS)((e=>({section:{display:"flex",flexDirection:"column",gap:4,width:"100%"},header:{alignItems:"center",display:"flex",flexDirection:"row"},headerAdd:{marginLeft:"auto",flexGrow:0,flexShrink:0,visibility:m?void 0:"hidden"},title:{color:e.lightTextColor,fontSize:o?14:12,lineHeight:1.3,fontWeight:p().Wy.medium}})),[m,o]),{contextType:f}=(0,S().EC)(),v="button_property"===f||"button_block"===f;return(0,h.jsxs)("section",{style:y.section,children:[(0,h.jsx)("header",{style:y.header,children:(0,h.jsx)("div",{style:y.title,children:v?(0,h.jsx)(l().sA,{...z.buttonBuilderTriggerTitleOrNoTriggers}):(0,h.jsx)(Q,{disabled:!t})})}),(0,h.jsxs)(G,{children:[s&&(0,h.jsx)(j,{}),u&&(0,h.jsx)(I,{}),r&&(0,h.jsx)(R().Js,{}),d&&(0,h.jsx)(H,{}),t&&g&&(0,h.jsx)(X,{hasAnyTriggers:m,variant:"button"}),c&&(0,h.jsx)(W,{})]})]})}function Q(e){let{disabled:t}=e;const{automationStore:o}=(0,S().EC)(),{updateTriggerOperator:n}=(0,b().p)(),s=(0,a().K8)((()=>{if(null==o||!o.isTriggerType("event"))return"some";const e=o.getEventConfiguration();return(null==e?void 0:e.pagePropertiesEdited.type)||"all"}),[o]),p=(0,a().K8)((()=>{if(null==o||!o.isTriggerType("event"))return 0;const e=o.getEventConfiguration(),t=null==e?void 0:e.pagePropertiesEdited;return t?"any"===t.type||"none"===t.type?0:"all"===t.type?(null===(r=t.all)||void 0===r?void 0:r.length)??0:"some"===t.type?(null===(n=t.some)||void 0===n?void 0:n.length)??0:void(0,u().HB)(t):0;var r,n}),[o]),c=(0,r.useCallback)((e=>{n(e)}),[n]),d=(0,i().IS)((e=>({title:{alignItems:"center",display:"flex",flexWrap:"wrap",height:24}})),[]);return(0,h.jsx)("div",{style:d.title,children:(0,h.jsx)(l().sA,{...p>0?z.builderModalTriggerTitleWithOperatorButton:z.buttonBuilderTriggerTitleOrNoTriggers,values:{operatorButton:(0,h.jsx)(f,{disabled:t,handleSelectOperator:c,selectedItem:s})}})})}},541172:(e,t,o)=>{o.d(t,{A5:()=>V,Ol:()=>I,qM:()=>_});o(898992),o(354520),o(672577);var r=o(296540),n=()=>o(484714),a=()=>o(56366),i=()=>o(401497),s=()=>o(957963),l=()=>o(735384),u=()=>o(112452),p=()=>o(959013),c=()=>o(534177),d=()=>o(813297),m=()=>o(686526),g=()=>o(760217),y=()=>o(928600),h=()=>o(939740),f=()=>o(89924),v=()=>o(175116),x=()=>o(898125),S=()=>o(862292),C=()=>o(525432),b=()=>o(645873),T=()=>o(324587),A=()=>o(546461),M=()=>o(366360),k=()=>o(781697),j=()=>o(813716),P=o(474848);function _(e){const{actionId:t,closeMenu:o,propertyId:i}=e,{maybePersistedTransactionActions:s}=(0,M().b)(),{automationStore:l,contextType:u}=(0,A().EC)(),c=(0,v().Ks)(),g=(0,n().v3)(),y=(0,p().tz)(),{value:h}=(0,b().fJ)(S().T.formulas),{value:f}=(0,b().fJ)(d().QV.automationTypecheck),k=(0,a().K8)((()=>null==c?void 0:c.settingsStore),[c]),j=(0,a().K8)((()=>c&&(0,C().ZI)({collectionContextStore:c,timelineViewTab:"timeline"})),[c]),_=(0,a().K8)((()=>{const e=l.getActionStores().find((e=>e.id===t));if(null!=e&&e.isDefined())return e}),[l,t]),V=(0,r.useCallback)((()=>{_&&h&&f&&(s.createAndCommit({perform:e=>{T().removeAutomationAction({actionStore:_,automationStore:l,automationTypecheckModule:f,contextType:u,environment:g,formulasModule:h,intl:y,transaction:e})},userAction:"UnsupportedPropertyMenu.removeAction"}),null==o||o())}),[_,l,o,u,g,y,s,h,f]),w=(0,r.useMemo)((()=>{if(k&&j&&i)return async function(){await(0,x().lT)({hasPendingChanges:!0})&&m().a2({collectionSettingsStore:k,item:{type:"property",formatKey:j,property:i}}),null==o||o()}}),[o,k,j,i]);return(0,P.jsx)(I,{onDelete:V,onEdit:w,stepType:"action"})}function V(e){const{closeMenu:t,propertyId:o}=e,n=(0,v().Ks)(),{removePropertyTrigger:i}=(0,j().p)(),s=(0,a().K8)((()=>null==n?void 0:n.settingsStore),[n]),l=(0,a().K8)((()=>n&&(0,C().ZI)({collectionContextStore:n,timelineViewTab:"timeline"})),[n]),u=(0,r.useCallback)((()=>{i(o),null==t||t()}),[t,o,i]),p=(0,r.useMemo)((()=>{if(s&&l&&o)return async function(){await(0,x().lT)({hasPendingChanges:!0})&&m().a2({collectionSettingsStore:s,item:{type:"property",formatKey:l,property:o}}),null==t||t()}}),[t,s,l,o]);return(0,P.jsx)(I,{onDelete:u,onEdit:p,stepType:"trigger"})}function I(e){const{onDelete:t,onEdit:o,onRestore:a,stepType:d}=e,m=(0,k().e)({width:266}),v=(0,n().Y0)().isMobile,x=(0,i().IS)((e=>({icon:{color:e.accentColors.gray[600],height:"auto",width:v?"12px":"16px"}})),[v]),S=(0,r.useMemo)((()=>(0,c().O9)(o)?{action:o,key:"edit-property-menu-item",render:e=>(0,P.jsx)(g().A,{...e,icon:(0,s().j)(x.icon),title:(0,P.jsx)(p().sA,{defaultMessage:"Edit property",id:"unsupportedPropertyMenu.editMenuItem.title"})})}:void 0),[o,x.icon]),C=(0,r.useMemo)((()=>(0,c().O9)(a)?{action:a,key:"restore-property-menu-item",render:e=>(0,P.jsx)(g().A,{...e,icon:(0,u()._)(x.icon),title:(0,P.jsx)(p().sA,{defaultMessage:"Restore property",id:"unsupportedPropertyMenu.restoreMenuItem.title"})})}:void 0),[a,x.icon]),b=(0,r.useMemo)((()=>(0,c().O9)(t)?{action:t,key:"delete-property-menu-item",render:e=>(0,P.jsx)(g().A,{...e,icon:(0,l().I)(x.icon),title:"action"===d?(0,P.jsx)(p().sA,{id:"automationUnsupportedPropertyMenu.deleteAction.title",defaultMessage:"Delete action"}):(0,P.jsx)(p().sA,{id:"automationUnsupportedPropertyMenu.deleteTrigger.title",defaultMessage:"Delete trigger"})})}:void 0),[t,d,x.icon]);return(0,P.jsx)(y().A,{...m,children:(0,P.jsx)(h().Ay,{initialFocus:0,sections:[{key:"actions-section",items:[S,C,b].filter(c().O9),render:e=>(0,P.jsx)(f().A,{...e})}],type:h().Oh.Vertical})})}},574299:(e,t,o)=>{o.d(t,{$R:()=>i,Qy:()=>n});const r=["number_does_not_equal","number_equals","number_greater_than","number_greater_than_or_equal_to","number_less_than","number_less_than_or_equal_to","is_empty","changes_to_any"];function n(e){const t=e;return r.includes(t)?t:"number_equals"}const a=(0,o(959013).YK)({changesToAny:{id:"automations.propertyTrigger.numberField.changesToAnyOption",defaultMessage:"Is edited"},numberEquals:{id:"automations.propertyTrigger.numberField.equalsOption",defaultMessage:"="},numberGreaterThanOrEqualTo:{id:"automations.propertyTrigger.numberField.greaterThanOrEqualTo",defaultMessage:"≥"},numberLessThanOrEqualTo:{id:"automations.propertyTrigger.numberField.lessThanOrEqualTo",defaultMessage:"≤"},isEmpty:{id:"automations.propertyTrigger.numberField.isEmpty",defaultMessage:"Is cleared"},numberGreaterThan:{id:"automations.propertyTrigger.numberField.greaterThan",defaultMessage:">"},numberLessThan:{id:"automations.propertyTrigger.numberField.lessThan",defaultMessage:"<"},numberDoesNotEqual:{id:"automations.propertyTrigger.numberField.doesNotEqualOption",defaultMessage:"≠"}}),i={number_equals:{hasInput:!0,text:a.numberEquals,value:"number_equals"},number_does_not_equal:{hasInput:!0,text:a.numberDoesNotEqual,value:"number_does_not_equal"},number_greater_than:{hasInput:!0,text:a.numberGreaterThan,value:"number_greater_than"},number_less_than:{hasInput:!0,text:a.numberLessThan,value:"number_less_than"},number_greater_than_or_equal_to:{hasInput:!0,text:a.numberGreaterThanOrEqualTo,value:"number_greater_than_or_equal_to"},number_less_than_or_equal_to:{hasInput:!0,text:a.numberLessThanOrEqualTo,value:"number_less_than_or_equal_to"},changes_to_any:{hasInput:!1,text:a.changesToAny,value:"changes_to_any"},is_empty:{text:a.isEmpty,value:"is_empty",hasInput:!1}}},576241:(e,t,o)=>{o.d(t,{A:()=>m});var r=o(296540),n=()=>o(484714),a=()=>o(56366),i=()=>o(764880),s=()=>o(791089),l=()=>o(798880),u=()=>o(919709),p=()=>o(448693),c=()=>o(546461),d=o(474848);function m(e){let{handleRemoveToken:t,token:o,style:m,isDisabled:g,preventOnClickPropagation:y}=e;const h=(0,n().Y0)(),{automationStore:f}=(0,c().EC)(),v=(0,a().K8)((()=>{if((0,s().isAnnotationSimpleValueToken)(o)&&(0,u().rie)(o)){const e=(0,u().NcG)(o);if(e)return(0,i().xC)({pointer:{table:l().oo,id:e},getRecordValue:f.getRecordModel})}}),[f.getRecordModel,o]),x=(0,r.useCallback)((()=>{t&&t(o)}),[t,o]);return null!=v&&v.asActor&&v.table===l().oo?(0,d.jsx)(p().Ay,{actor:v,format:h.isMobile?p().Ay.Format.Medium:p().Ay.Format.Small,showRemoveButton:!!t&&!g,onClickRemove:e=>{y&&(null==e||e.stopPropagation()),x()},shouldShrink:!0,isSingle:!1,style:m},v.id):null}},621314:(e,t,o)=>{o.d(t,{A:()=>H});o(944114),o(581454);var r=o(296540),n=()=>o(484714),a=()=>o(401497),i=(o(898992),o(354520),o(672577),()=>o(56366)),s=()=>o(970013),l=()=>o(247331),u=()=>o(977345),p=()=>o(791089),c=()=>o(467730),d=()=>o(187174),m=()=>o(919709),g=()=>o(959013),y=()=>o(496603),h=()=>o(419830),f=()=>o(742971),v=()=>o(258804),x=()=>o(856952),S=()=>o(645873),C=()=>o(106628),b=()=>o(361330),T=()=>o(970585),A=()=>o(120423),M=()=>o(674300),k=()=>o(784892),j=()=>o(512052),P=()=>o(546461),_=o(474848);function V(e){let{handleRemoveToken:t,isDisabled:o,token:a}=e;const i=(0,n().Y0)(),{automationStore:s}=(0,P().EC)(),l=(0,r.useCallback)((()=>{t&&t(a)}),[t,a]),u=(0,m().i$F)(a);if(!u)return null;const p=u.id;return(0,_.jsx)(j().A,{blockId:p,relationPropertySchema:void 0,format:i.isMobile?k().NY.Medium:k().NY.Small,isSingle:!1,onClickRemove:l,parentStore:s,shouldShrink:!0,shouldWrap:!1,showRemoveButton:!o},p)}var I=()=>o(722872),w=()=>o(928600),R=()=>o(939740),N=()=>o(64e3),F=()=>o(45552),E=()=>o(89924),O=()=>o(996027),B=()=>o(231713),D=()=>o(179034),W=()=>o(630116),L=()=>o(305390);function K(e){let{annotation:t,checkState:o,menuArgs:r}=e;const{automationStore:n}=(0,P().EC)(),a=(0,i().K8)((()=>{if((0,p().isAnnotationSimpleValueToken)(t)&&(0,m().jIt)(t))return(0,m().i$F)(t)}),[t]);if(!a)return null;const s=a.id,l=W().Bv.createChildStore(n,{id:s,table:D().ev});return(0,_.jsx)(L().A,{store:l,checkState:o,hidePath:!0,...r})}function H(e){const{action:t,collection:o,currentSimpleFormulaValueTokens:k,formulaTypecheckContextValues:j,formulaValueContext:P,menuProps:D,onChange:W,onClose:L,showClearButton:H=!1,showFormulaValueItems:U=!1,showGenericHeader:Y=!1,showInputMenuItem:z=!1,showReplaceAddRemoveToggle:q=!1,value:$,parentRecordStore:G}=e,X=(0,n().Y0)(),Z=(0,a().IS)((e=>({genericHeader:{paddingBottom:0},replaceAddRemoveToggleButton:{marginLeft:"8px",marginRight:"8px",marginTop:"8px"}})),[]),{footer:Q,header:J,menuListStore:ee,noResultsMessage:te,searchInput:oe,pageItems:re,replaceAddRemoveToggleButton:ne,valueItems:ae}=function(e){var t,o;const{action:a,collection:k,formulaTypecheckContextValues:j,formulaValueContext:P,onChange:I,onClose:w,showClearButton:R,showReplaceAddRemoveToggle:N,unlimitedCurrentSimpleFormulaValueTokens:F,value:E}=e,O=(0,n().v3)(),B=(0,n().Y0)(),D=(0,g().tz)(),{collectionStore:W,property:L}=P,K=(0,h().pg)(P),H=(0,i().K8)((()=>W.getSchema()[L]),[W,L]),U=(0,r.useMemo)((()=>{const e="relation"===(null==H?void 0:H.type)?(0,s().Nv)(H):void 0;return j.filter((t=>(0,u().o5)(t.type,{type:"block",collection:e},!0)))}),[j,H]),[Y,z]=(0,r.useState)(""),q=(0,i().uB)(void 0,T().A),$=(0,i().K8)((()=>!!(W&&L&&H&&(0,s().sO)(H))&&1===H.limit),[W,L,H]),G=(0,S().fJ)(C().T.searchActions),[X]=(0,d().Yb)((async()=>{const e=Y?(0,c().Ay)(Y,U,(e=>e.kind===l().FormulaContextValueKind.ContextValue?e.name:"")):U;if("resolved"!==G.status||!k)return;const t=G.value,{results:o}=await t.searchPagesInCollection({environment:O,query:Y,collectionId:k.id,limit:20,spaceId:k.spaceId,excludeTemplates:!0,source:"simple_formula_value_page_search",includePublicPagesWithoutExplicitAccess:!0,boostRecentlyViewedPages:!1});return{valueResults:e,pageResults:o}}),[Y,U,G.status,G.value,k,O],{debounce:b().tu}),Z=K(F,"first").filter((e=>{if("string"!=typeof e&&"boolean"!=typeof e&&(0,m().jIt)(e)){var t,o;const r=null===(t=(0,m().i$F)(e))||void 0===t?void 0:t.id;if(r&&null!=X&&null!==(o=X.value)&&void 0!==o&&o.pageResults.includes(r))return!0}return!0})),Q=(0,r.useCallback)((()=>{z(""),q.setState({...q.state,focus:{section:0,indexLocal:0,indexGlobal:0,footerFocused:!1}})}),[q]),J=(0,r.useCallback)(((e,t)=>{I(e||E,t||a)}),[a,I,E]),ee=(0,r.useCallback)((e=>{const t=K(e,"last");J({type:"simple",value:(0,p().toSimpleFormulaArrayValue)(t)}),Q(),$&&w()}),[K,J,Q,$,w]),te=(0,r.useCallback)((()=>{ee(Z.slice(0,Z.length-1))}),[Z,ee]),oe=(0,r.useCallback)((e=>{null==ee||ee((0,p().simpleFormulaValueWithoutToken)(Z,e))}),[Z,ee]),re=y().oE(Z.map(((e,t)=>"string"==typeof e||"boolean"==typeof e?null:(0,m().s1Y)(e)?(0,_.jsx)(M().A,{formulaTypecheckContextValues:j,handleRemoveToken:oe,isDisabled:!1,token:e},t):(0,m().jIt)(e)?(0,_.jsx)(V,{handleRemoveToken:oe,isDisabled:!1,token:e},t):null))),ne=(0,_.jsx)("div",{style:{...!B.isMobile&&{padding:"0 8px 4px 8px"}},children:(0,_.jsx)(x().Ay,{focus:!B.isMobile||void 0,focusAfterAnimation:!0,format:x().le.FilterValue,tokens:re,placeholder:D.formatMessage(f().D.pageSearchPlaceholder),onRemoveLastToken:te,onClearButtonClick:()=>ee([]),value:Y,onChange:e=>z(e.target.value),dontShowBorderBottom:B.isAndroid,showClearButton:R})}),ae=(0,_.jsx)(v().A,{value:E,onChange:J}),ie=(0,_.jsx)(A().A,{action:a,handleOnChange:J}),se=y().oE(((null===(t=X.value)||void 0===t?void 0:t.valueResults)||[]).map((e=>{const t=e.kind===l().FormulaContextValueKind.ContextValue&&e.id||"",o=Boolean(Z.find((e=>(0,p().isAnnotationSimpleValueToken)(e)&&(0,m().s1Y)(e)&&(0,m().iVq)(e).id===t)));return{action:"append",checkType:$?"single":"multi",checkState:o,currentSimpleFormulaValueTokens:Z,id:t,setCurrentTokens:ee,value:e}}))),le=y().oE(((null===(o=X.value)||void 0===o?void 0:o.pageResults)||[]).map((e=>{const t=Boolean(Z.find((t=>{var o;return(0,p().isAnnotationSimpleValueToken)(t)&&(0,m().jIt)(t)&&(null===(o=(0,m().i$F)(t))||void 0===o?void 0:o.id)===e})));if(k){const o=(0,m().ld4)(e,k.spaceId);return{action:()=>{ee(t?(0,p().simpleFormulaValueWithoutToken)(Z,o):[...Z,o])},checkState:t,checkType:$?"single":"multi",annotation:o,id:e}}}))),ue=[...se,...le];return{footer:ae,header:D.formatMessage(f().D.genericMenuHeader),menuListStore:q,noResultsMessage:0===ue.length&&X.value&&D.formatMessage(f().D.noResults),replaceAddRemoveToggleButton:!!N&&ie,searchInput:ne,pageItems:le,valueItems:se}}({action:t,collection:o,formulaTypecheckContextValues:j,formulaValueContext:P,onChange:W,onClose:L,showClearButton:H,showReplaceAddRemoveToggle:q,unlimitedCurrentSimpleFormulaValueTokens:k,value:$})||{},ie=[...(0,r.useMemo)((()=>U?ae.map((e=>{const{annotation:t,itemAction:o}=(0,B().E)({action:e.action,currentSimpleFormulaValueTokens:e.currentSimpleFormulaValueTokens,setCurrentTokens:e.setCurrentTokens,value:e.value});return{key:e.id,render:o=>(0,_.jsx)(O().A,{annotation:t,checkState:e.checkState,disabled:!1,formulaTypecheckContextValues:j,menuArgs:o,parentRecordStore:G}),action:o}})):[]),[j,U,ae,G]),...(0,r.useMemo)((()=>re?re.map((e=>({key:e.id,render:t=>(0,_.jsx)(K,{annotation:e.annotation,checkState:e.checkState,menuArgs:t}),action:e.action}))):[]),[re])],se=[];let le;ie.length>0&&se.push({key:"values",render:e=>(0,_.jsx)(E().A,{...e}),items:ie}),le=X.isMobile?{menuType:I().gu.Modal,right:(0,_.jsx)(F().DoneMenuText,{}),onClickRight:L,minWidth:260,footer:Q&&(0,_.jsx)(E().A,{topBorder:!0,children:Q})}:{menuType:I().gu.Popup,maxHeight:"50vh",width:260,footer:Q&&(0,_.jsx)(E().A,{topBorder:!0,children:Q}),disableHeaderBorder:!0};const ue=Y&&(0,_.jsx)(E().A,{style:Z.genericHeader,title:J}),pe=(0,_.jsxs)(_.Fragment,{children:[!X.isMobile&&((null==D?void 0:D.header)||ue),z&&(0,_.jsx)(E().A,{children:oe})]}),ce=(0,_.jsxs)(_.Fragment,{children:[ne&&(0,_.jsx)("div",{style:Z.replaceAddRemoveToggleButton,children:ne}),te&&(0,_.jsx)(E().A,{children:(0,_.jsx)(N().A,{title:te})}),ie.length>0&&(0,_.jsx)(R().Ay,{type:R().Oh.Vertical,initialFocus:0,sections:se,store:ee})]});return{headerDiv:pe,innerComponents:ce,relationMenu:(0,_.jsx)(w().A,{...le,...D,header:pe,children:ce})}}},630550:(e,t,o)=>{o.d(t,{a:()=>v,c:()=>x});o(898992),o(672577);var r=o(296540),n=()=>o(484714),a=()=>o(56366),i=()=>o(959013),s=()=>o(813297),l=()=>o(175116),u=()=>o(862292),p=()=>o(645873),c=()=>o(324587),d=()=>o(546461),m=()=>o(366360),g=()=>o(813716),y=()=>o(7667),h=()=>o(541172),f=o(474848);function v(e){const{actionId:t,closeMenu:o,propertyId:l}=e,{maybePersistedTransactionActions:g}=(0,m().b)(),{automationStore:v,contextType:x}=(0,d().EC)(),S=(0,n().v3)(),C=(0,i().tz)(),{value:b}=(0,p().fJ)(u().T.formulas),{value:T}=(0,p().fJ)(s().QV.automationTypecheck),A=(0,a().K8)((()=>{const e=v.getActionStores().find((e=>e.id===t));if(null!=e&&e.isDefined())return e}),[v,t]),M=(0,r.useCallback)((()=>{A&&b&&T&&(g.createAndCommit({perform:e=>{c().removeAutomationAction({actionStore:A,automationStore:v,automationTypecheckModule:T,contextType:x,environment:S,formulasModule:b,intl:C,transaction:e})},userAction:"UnsupportedPropertyMenu.removeAction"}),null==o||o())}),[A,v,T,o,x,S,b,C,g]),k=(0,y().A)(),j=(0,r.useMemo)((()=>()=>{k&&k(l),null==o||o()}),[o,k,l]);return(0,f.jsx)(h().Ol,{onDelete:M,onRestore:j,stepType:"action"})}function x(e){const{closeMenu:t,propertyId:o}=e,n=(0,l().Ks)(),{removePropertyTrigger:i}=(0,g().p)(),s=(0,a().K8)((()=>null==n?void 0:n.settingsStore),[n]),u=(0,a().K8)((()=>{const e=null==n?void 0:n.collectionStore();return Boolean(!(null!=e&&e.getSchema()[o]))&&Boolean(!(null!=e&&e.getDeletedSchema()[o]))}),[n,o]),p=(0,r.useCallback)((()=>{i(o),null==t||t()}),[t,o,i]),c=(0,y().A)(),d=(0,r.useMemo)((()=>()=>{s&&!u&&(c&&c(o),null==t||t())}),[t,s,c,u,o]);return(0,f.jsx)(h().Ol,{onDelete:p,onRestore:d,stepType:"trigger"})}},643381:(e,t,o)=>{o.d(t,{l:()=>n});o(296540);var r=o(474848);const n=(0,o(340498).wt)("repeat",{viewBox:"0 0 16 14",svg:(0,r.jsx)("path",{d:"M1.185 7.317a.689.689 0 00.697-.704v-.601c0-1.19.806-1.942 2.064-1.942H9.23v1.573c0 .328.199.52.527.52a.66.66 0 00.403-.144l2.68-2.236c.253-.212.26-.547 0-.765L10.16.782A.62.62 0 009.757.64c-.328 0-.527.184-.527.52v1.53H4.05C1.875 2.69.48 3.9.48 5.875v.738c0 .397.308.704.705.704zm13.624-.649a.689.689 0 00-.698.704v.608c0 1.19-.806 1.942-2.064 1.942H6.763V8.35c0-.329-.199-.52-.527-.52a.66.66 0 00-.403.144l-2.68 2.242c-.26.212-.26.547 0 .759l2.68 2.242a.66.66 0 00.403.143c.328 0 .527-.191.527-.52v-1.544h5.181c2.174 0 3.569-1.21 3.569-3.179v-.745a.695.695 0 00-.704-.704z"})})},674300:(e,t,o)=>{o.d(t,{A:()=>u});o(296540);var r=()=>o(784892),n=()=>o(977345),a=()=>o(919709),i=()=>o(534177),s=()=>o(684125),l=o(474848);function u(e){let{formulaTypecheckContextValues:t,handleRemoveToken:o,isDisabled:u,token:p,style:c,iconSize:d,preventOnClickPropagation:m}=e;const g=(0,a().iVq)(p).id,y=(0,i().O9)(t)?(0,n().IV)(t,g):void 0;return y?(0,l.jsx)(s().F,{value:y,format:r().NY.Small,isSingle:!1,shouldShrink:!0,showRemoveButton:!u,style:c,onClickRemove:e=>{m&&(null==e||e.stopPropagation()),o(p,e)}}):null}},684125:(e,t,o)=>{o.d(t,{F:()=>c});o(296540);var r=()=>o(401497),n=()=>o(494379),a=()=>o(247331),i=()=>o(977345),s=()=>o(534177),l=()=>o(931077),u=()=>o(848401),p=o(474848);function c(e){const{value:t,style:o}=e,c=(0,r().DP)(),d=e.iconStyle??{width:12,height:12,marginRight:4},m=(0,i().sM)(t);let g;if(t.kind===a().FormulaContextValueKind.ContextValue&&(0,s().O9)(t.stepNumberForDisplay)){const e=t.stepNumberForDisplay;g=()=>(0,p.jsx)(l().Q,{size:n().H.ExtraSmall,number:e,style:{marginRight:4}})}else{const e=(0,i().Ix)(t.type);if(e){const t=e;g=()=>t(d)}}return(0,p.jsx)(u().Ay,{...e,title:m,renderAvatar:g,shouldShrink:!0,style:{background:c.outlineBlueButtonPressedBackground,color:c.blueColor,padding:"2px 4px",margin:0,...o}})}},741310:(e,t,o)=>{o.d(t,{P:()=>l});var r=o(296540),n=()=>o(401497),a=()=>o(859428),i=()=>o(962730),s=o(474848);function l(e){const{caption:t,disable:o,renderOrigin:l,title:u,tooltipAlignment:p,tooltipPlacement:c,disableTooltip:d}=e,m=(0,n().IS)((e=>({tooltipTitle:{margin:0},tooltipCaption:{color:e.text.contrastSecondary,margin:0}})),[]),g=(0,r.useCallback)((()=>(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{style:m.tooltipTitle,children:u}),(0,s.jsx)("p",{style:m.tooltipCaption,children:t})]})),[t,u,m.tooltipCaption,m.tooltipTitle]);return(0,s.jsx)(a().A,{alignment:p||i().C.Center,delayThreshold:800,disableTooltip:o||d,placement:c||i().W.Bottom,render:l,renderTooltip:g,textWrap:!0})}},742971:(e,t,o)=>{o.d(t,{D:()=>r});const r=(0,o(959013).YK)({back:{defaultMessage:"Back",id:"formulas.SimpleFormulaValuePicker.back"},valuesFromThisAutomation:{defaultMessage:"From this automation",id:"formulas.SimpleFormulaValuePicker.valuesFromThisAutomation"},pickADate:{defaultMessage:"Pick a date",id:"formulas.SimpleFormulaValuePicker.pickADate"},clear:{defaultMessage:"Clear",id:"formulas.SimpleFormulaValuePicker.clear"},unchecked:{defaultMessage:"Unchecked",id:"formulas.SimpleFormulaValuePicker.checkbox.unchecked"},checked:{defaultMessage:"Checked",id:"formulas.SimpleFormulaValuePicker.checkbox.checked"},checkboxOptions:{defaultMessage:"Checkbox options",id:"formulas.SimpleFormulaValuePicker.checkbox.sectionHeader"},searchPlaceHolder:{defaultMessage:"Select one or more options…",id:"formulas.SimpleFormulaValuePicker.select.searchPlaceholder"},selectOptionsSectionHeader:{defaultMessage:"Select an option",id:"formulas.SimpleFormulaValuePicker.select.sectionHeader"},noResults:{defaultMessage:"No results",id:"formulas.simpleValuePicker.noResults"},pageSearchPlaceholder:{defaultMessage:"Search for one or more pages…",id:"formulas.SimpleFormulaValuePicker.pages.searchPlaceholder"},pages:{defaultMessage:"Pages",id:"formulas.SimpleFormulaValuePicker.pages.sectionHeader"},somethingWentWrong:{defaultMessage:"Something went wrong.",id:"formulas.simpleValuePicker.errorMessage"},personSelect:{defaultMessage:"Select...",id:"formulas.SimpleFormulaValuePicker.chooseAValue"},personSearchPlaceholder:{defaultMessage:"Search for one or more people…",id:"formulas.SimpleFormulaValuePicker.people.searchPlaceholder"},propertyValuePlaceholder:{defaultMessage:"Enter a value",id:"formulas.SimpleFormulaValuePicker.general.propertyValuePlaceholder"},customFormula:{defaultMessage:"Custom formula",id:"formulas.SimpleFormulaValuePicker.customFormula"},peopleInWorkspace:{defaultMessage:"People",id:"formulas.SimpleFormulaValuePicker.people.sectionHeader"},genericMenuHeader:{defaultMessage:"Set property to",id:"formulas.SimpleFormulaValuePicker.genericMenuHeader"}})},798941:(e,t,o)=>{o.d(t,{VW:()=>g,aR:()=>m});o(296540);var r=()=>o(56366),n=()=>o(401497),a=()=>o(784892),i=()=>o(959013),s=()=>o(534177),l=()=>o(284371),u=()=>o(881690),p=()=>o(214973),c=()=>o(574299),d=o(474848);function m(e){const{numberValue:t,operator:o,propertySchema:m,messageType:y}=e,h=(0,i().tz)(),f=(0,n().IS)((()=>({content:{alignItems:"center",display:"flex",flexWrap:"wrap",whiteSpace:"pre",lineHeight:1.6},propertyName:{...l().RC,fontWeight:l().Wy.medium},propertyValue:{...l().RC,paddingBlockStart:4}})),[]),v=(0,r().K8)((()=>function(e){const{numberValue:t,operator:o,propertySchema:r,styles:n,messageType:l,intl:m}=e,g=(0,d.jsx)("span",{style:n.propertyName,children:r.name});let y;const h=m.formatMessage(c().$R[o].text).toLocaleLowerCase();"action"===l?y=p().vC({propertyName:g,propertyValues:(0,d.jsx)(u().A,{format:a().NY.Medium,isRound:!0,isSingle:!0,value:t,showRemoveButton:!1,style:{flex:"none"}}),operator:h}):"trigger"===l?y=p().Rn({propertyName:g,propertyValues:(0,d.jsx)(u().A,{format:a().NY.Medium,isRound:!0,isSingle:!0,value:t,showRemoveButton:!1,style:{flex:"none"}}),operator:h}):(0,s().HB)(l);return(0,d.jsx)(i().sA,{...y})}({intl:h,messageType:y,numberValue:t,operator:o,propertySchema:m,styles:f})),[y,t,o,m,f,h]);return{tooltipTitle:(0,r().K8)((()=>g({intl:h,messageType:y,numberValue:t,operator:o,propertySchema:m})),[h,y,t,o,m]),title:v,styles:f}}function g(e){const{numberValue:t,operator:o,propertySchema:r,messageType:n,intl:a}=e,l=r.name;let u;const m=a.formatMessage(c().$R[o].text).toLocaleLowerCase();return"action"===n?u=p().vC({propertyName:l,propertyValues:t,operator:m}):"trigger"===n?u=p().Rn({propertyName:l,propertyValues:t,operator:m}):(0,s().HB)(n),(0,d.jsx)(i().sA,{...u})}},807787:(e,t,o)=>{o.d(t,{aX:()=>q,OT:()=>$,qt:()=>Z,h3:()=>X,ot:()=>z,M0:()=>Q});var r=o.n(o(32485)),n=o(296540),a=()=>o(484714),i=()=>o(819121),s=()=>o(588316),l=()=>o(56366),u=()=>o(401497),p=()=>o(352271),c=()=>o(558842),d=()=>o(725614),m=()=>o(704152),g=()=>o(348501),y=()=>o(859428),h=()=>o(614415),f=()=>o(115512),v=()=>o(645873),x=()=>o(554283),S=()=>o(962730),C=()=>o(463830),b=()=>o(366360),T=()=>o(959013),A=()=>o(973647),M=()=>o(963589),k=()=>o(546461),j=()=>o(653417),P=o(474848);function _(e){let{actionId:t}=e;const{typecheckResult:o}=(0,k().EC)(),{suppressActionErrors:r}=(0,b().b)(),n=(0,M().X)("automation_updated_error_states"),a=(0,l().K8)((()=>{if(n&&A().Q.isSuccess(o)&&!r.includes(t)){return(o.value.actionValidationFailures[t]||[]).length>0}return!1}),[t,n,r,o]);return{hasTypecheckErrors:a,typecheckErrorMessage:a?(0,P.jsx)(T().sA,{...j().automationErrorMessages.generalErrorMessage}):null}}o(898992),o(354520),o(581454);var V=()=>o(534177);function I(e){let{disabled:t}=e;const{automationStore:o}=(0,k().EC)(),{hideDragHandle:r}=(0,b().b)(),n=(0,l().K8)((()=>o.getActionStores().map((e=>e.isDefined()&&e.hasConcern("display")?e:null)).filter(V().Pe)),[o]);return r||1===n.length||t}var w=()=>o(568625),R=()=>o(340498);const N=(0,R().wt)("rectangleCollapseVertical",{viewBox:"0 0 16 16",svg:(0,P.jsx)("path",{d:"M2.80281 10.1213C2.42849 10.1213 2.0967 10.0426 1.80746 9.88526C1.51821 9.72788 1.29277 9.51307 1.13113 9.24084C0.969491 8.96435 0.888672 8.65384 0.888672 8.30929V7.69039C0.888672 7.34159 0.969491 7.0332 1.13113 6.76522C1.29702 6.49299 1.52246 6.27818 1.80746 6.1208C2.0967 5.95916 2.42849 5.87834 2.80281 5.87834H13.1965C13.5709 5.87834 13.9027 5.95916 14.1919 6.1208C14.4811 6.27818 14.7066 6.49299 14.8682 6.76522C15.0299 7.0332 15.1107 7.34159 15.1107 7.69039V8.30929C15.1107 8.65384 15.0299 8.96435 14.8682 9.24084C14.7066 9.51307 14.4811 9.72788 14.1919 9.88526C13.9027 10.0426 13.5709 10.1213 13.1965 10.1213H2.80281ZM2.98784 9.01114H13.0115C13.2923 9.01114 13.5113 8.93032 13.6687 8.76868C13.8303 8.60279 13.9112 8.39436 13.9112 8.1434V7.85628C13.9112 7.60106 13.8303 7.39263 13.6687 7.231C13.5113 7.06511 13.2923 6.98216 13.0115 6.98216H2.98784C2.71135 6.98216 2.49229 7.06511 2.33065 7.231C2.17327 7.39263 2.09458 7.60106 2.09458 7.85628V8.1434C2.09458 8.39436 2.17327 8.60279 2.33065 8.76868C2.49229 8.93032 2.71135 9.01114 2.98784 9.01114ZM8.00287 15.9977C7.84548 15.9977 7.70937 15.9403 7.59452 15.8255C7.48393 15.7149 7.42863 15.5851 7.42863 15.4362V13.4711L7.47967 12.4119L6.98838 12.9543L6.21634 13.7518C6.16955 13.8029 6.11213 13.8433 6.04407 13.873C5.97601 13.9028 5.90583 13.9177 5.83352 13.9177C5.68464 13.9177 5.55916 13.8688 5.45707 13.771C5.35924 13.6731 5.31032 13.5519 5.31032 13.4073C5.31032 13.3307 5.32521 13.2605 5.35498 13.1967C5.38901 13.1372 5.4358 13.0776 5.49535 13.0181L7.58176 11.0656C7.65407 10.9976 7.72213 10.9487 7.78593 10.9189C7.85399 10.8891 7.9263 10.8742 8.00287 10.8742C8.13898 10.8742 8.27723 10.938 8.4176 11.0656L10.504 13.0181C10.5636 13.0776 10.6082 13.1372 10.638 13.1967C10.672 13.2605 10.689 13.3307 10.689 13.4073C10.689 13.5519 10.638 13.6731 10.5359 13.771C10.4381 13.8688 10.3126 13.9177 10.1595 13.9177C10.0106 13.9177 9.8851 13.8624 9.78301 13.7518L9.01736 12.9543L8.52606 12.4119L8.57073 13.4711V15.4362C8.57073 15.5851 8.5133 15.7149 8.39846 15.8255C8.28786 15.9403 8.156 15.9977 8.00287 15.9977ZM8.00287 5.12545C7.8625 5.12545 7.72213 5.06165 7.58176 4.93404L5.49535 2.97524C5.4358 2.91994 5.38901 2.86252 5.35498 2.80297C5.32521 2.73916 5.31032 2.66898 5.31032 2.59241C5.31032 2.44354 5.35924 2.32231 5.45707 2.22873C5.55916 2.13089 5.68464 2.08198 5.83352 2.08198C5.90583 2.08198 5.97601 2.09687 6.04407 2.12664C6.11213 2.15642 6.16955 2.19683 6.21634 2.24787L6.98838 3.04543L7.47967 3.58776L7.42863 2.52861V0.563432C7.42863 0.414555 7.48393 0.284819 7.59452 0.174225C7.70937 0.0593771 7.84548 0.00195312 8.00287 0.00195312C8.156 0.00195312 8.28786 0.0593771 8.39846 0.174225C8.5133 0.284819 8.57073 0.414555 8.57073 0.563432V2.52861L8.52606 3.58776L9.01736 3.03904L9.78301 2.24787C9.8851 2.13728 10.0106 2.08198 10.1595 2.08198C10.3126 2.08198 10.4381 2.13089 10.5359 2.22873C10.638 2.32231 10.689 2.44354 10.689 2.59241C10.689 2.66898 10.672 2.73916 10.638 2.80297C10.6082 2.86677 10.5636 2.9242 10.504 2.97524L8.4176 4.93404C8.27723 5.06165 8.13898 5.12545 8.00287 5.12545Z"})}),F=(0,R().wt)("rectangleExpandVertical",{viewBox:"0 0 16 16",svg:(0,P.jsx)("path",{d:"M2.38379 12.6506C1.79492 12.6506 1.32031 12.4771 0.959961 12.1299C0.599609 11.7827 0.419434 11.3389 0.419434 10.7983V5.54468C0.419434 4.99976 0.599609 4.55591 0.959961 4.21313C1.32031 3.87036 1.79492 3.69897 2.38379 3.69897H4.56567V4.83936H2.58813C2.30249 4.83936 2.07617 4.92505 1.90918 5.09644C1.74658 5.26343 1.66528 5.47876 1.66528 5.74243V10.6006C1.66528 10.8599 1.74658 11.0752 1.90918 11.2466C2.07617 11.418 2.30249 11.5037 2.58813 11.5037H4.56567V12.6506H2.38379ZM13.6162 12.6506H11.4343V11.5037H13.4119C13.6975 11.5037 13.9238 11.418 14.0908 11.2466C14.2578 11.0752 14.3413 10.8599 14.3413 10.6006V5.74243C14.3413 5.47876 14.2578 5.26343 14.0908 5.09644C13.9238 4.92505 13.6975 4.83936 13.4119 4.83936H11.4343V3.69897H13.6162C14.2051 3.69897 14.6797 3.87036 15.04 4.21313C15.4004 4.55591 15.5806 4.99976 15.5806 5.54468V10.7983C15.5806 11.3389 15.4004 11.7827 15.04 12.1299C14.6797 12.4771 14.2051 12.6506 13.6162 12.6506ZM8 16.1575C7.9209 16.1575 7.84839 16.1421 7.78247 16.1113C7.71655 16.0806 7.64624 16.03 7.57153 15.9597L5.40942 13.936C5.3479 13.8833 5.30176 13.824 5.271 13.7581C5.24023 13.6921 5.22485 13.6196 5.22485 13.5405C5.22485 13.3867 5.27759 13.2593 5.38306 13.1582C5.48853 13.0615 5.61816 13.0132 5.77197 13.0132C5.84229 13.0132 5.9104 13.0286 5.97632 13.0593C6.04663 13.0901 6.10815 13.1318 6.16089 13.1846L6.9519 14.0085L7.45947 14.5623L7.40674 13.4746V11.4048C7.40674 11.2422 7.46387 11.1038 7.57812 10.9895C7.69678 10.8752 7.8374 10.8181 8 10.8181C8.1626 10.8181 8.30103 10.8752 8.41528 10.9895C8.52954 11.1038 8.58667 11.2422 8.58667 11.4048V13.4746L8.54053 14.5623L9.0481 14.0085L9.83911 13.1846C9.94897 13.0703 10.0808 13.0132 10.2346 13.0132C10.3928 13.0132 10.5225 13.0615 10.6235 13.1582C10.7246 13.2593 10.7751 13.3867 10.7751 13.5405C10.7751 13.6196 10.7598 13.6921 10.729 13.7581C10.6982 13.824 10.6543 13.8833 10.5972 13.936L8.42847 15.9597C8.28345 16.0916 8.14062 16.1575 8 16.1575ZM8 5.5249C7.8374 5.5249 7.69678 5.46777 7.57812 5.35352C7.46387 5.23926 7.40674 5.10303 7.40674 4.94482V2.86841L7.45947 1.78076L6.9519 2.33447L6.16089 3.15845C6.05103 3.27271 5.91919 3.32983 5.76538 3.32983C5.61157 3.32983 5.48193 3.28149 5.37646 3.18481C5.27539 3.08374 5.22485 2.9563 5.22485 2.80249C5.22485 2.72339 5.24023 2.65308 5.271 2.59155C5.30176 2.52563 5.3479 2.46411 5.40942 2.40698L7.57153 0.383301C7.71655 0.251465 7.85938 0.185547 8 0.185547C8.14062 0.185547 8.28345 0.251465 8.42847 0.383301L10.5906 2.40698C10.6521 2.46411 10.6982 2.52563 10.729 2.59155C10.7598 2.65308 10.7751 2.72339 10.7751 2.80249C10.7751 2.9563 10.7224 3.08374 10.6169 3.18481C10.5159 3.28149 10.3862 3.32983 10.228 3.32983C10.1577 3.32983 10.0874 3.31445 10.0171 3.28369C9.95117 3.25293 9.89185 3.21118 9.83911 3.15845L9.0481 2.33447L8.54053 1.78076L8.58667 2.86841V4.94482C8.58667 5.10303 8.52954 5.23926 8.41528 5.35352C8.30103 5.46777 8.1626 5.5249 8 5.5249Z"})});var E=()=>o(406699),O=()=>o(285790),B=()=>o(14235);const D=(0,T().YK)({moreLabel:{id:"automationBaseStepElement.moreActionsMenu.title",defaultMessage:"More"},collapseLabel:{id:"automationBaseStepElement.moreActionsMenu.collapseLabel",defaultMessage:"Collapse"},expandLabel:{id:"automationBaseStepElement.moreActionsMenu.expandLabel",defaultMessage:"Expand"}});function W(e){const{actionMenu:t,disabled:o,buttonPopupStore:r}=e,{device:n}=(0,a().v3)(),i=(0,T().tz)(),s=(0,u().IS)((e=>({container:{display:"flex",gap:1,padding:2,borderRadius:6,boxShadow:`0px 0px 0px 1px ${e.stroke.secondary}, 0px 2px 4px 0px rgba(0, 0, 0, ${"dark"===e.mode?.08:.04})`,backgroundColor:e.surface.elevated},iconButton:{height:24,width:24,flexShrink:0,borderRadius:4},icon:{height:16,width:16}})),[]);return(0,P.jsxs)("div",{style:s.container,children:[e.collapsible&&(0,P.jsx)(y().A,{renderTooltip:()=>(0,P.jsx)(T().sA,{...L(e.isCollapsed)}),render:t=>(0,P.jsx)(O().A,{...t,ariaLabel:i.formatMessage(L(e.isCollapsed)),disabled:o,disabledFeedback:o,hasBackground:!0,icon:e.isCollapsed?F:N,iconStyle:s.icon,style:s.iconButton,onClick:e.onCollapseToggled})}),(0,P.jsx)(E().Ay,{alignmentToOrigin:E().yP.Center,buttonPopupStore:r,originGap:0,placementToOrigin:E().sx.Bottom,popupType:n.isMobile?B().nl.SlideUp:B().nl.Popup,render:()=>t,renderOrigin:e=>(0,P.jsx)(O().A,{...e,ariaLabel:i.formatMessage(D.moreLabel),disabled:o,disabledFeedback:o,hasBackground:!0,icon:w().L,iconStyle:s.icon,style:s.iconButton})})]})}function L(e){return e?D.expandLabel:D.collapseLabel}const K="automation-list-item-base-step",H="automation-list-item-base-step--drag-disabled",U="automation-list-item-icon",Y="automation-list-item-drag-handle";function z(e){const{actionMenu:t,buttonPopupStore:o,children:r,disabled:i,icon:u,onClick:p,onMouseDown:d,onMouseEnter:m,onMouseLeave:g,subtitle:y,styles:h}=e,{isMobile:f}=(0,a().Y0)(),v=(0,l().uB)(o,C().A),[S,b]=(0,s().A)(),[T,A]=(0,x().B)(),M=(0,l().K8)((()=>v.getState()),[v]),k=!i&&(f||A||b||M.open),j=Q({disabled:i,hasActionMenu:Boolean(t),isActionMenuVisible:k,overrideStyles:h}),_=(0,c().Px)(S,T),V=(0,n.useMemo)((()=>({...j.componentWrap,...j.border})),[j.border,j.componentWrap]);return(0,P.jsxs)("div",{className:K,onClick:p,onMouseDown:d,onMouseEnter:m,onMouseLeave:g,ref:_,style:V,children:[(0,P.jsxs)("div",{style:j.headerWrap,children:[u&&(0,P.jsx)("div",{"aria-hidden":"true",style:j.iconContainer,children:(0,P.jsx)("div",{style:j.iconWrap,children:u(j.icon)})}),(0,P.jsx)("div",{style:j.titleWrap,children:r})]}),y&&(0,P.jsx)("div",{style:j.subtitleWrap,children:y}),t&&(0,P.jsx)("div",{style:j.actionMenuWrap,children:(0,P.jsx)(W,{actionMenu:t,buttonPopupStore:v,disabled:i})})]})}function q(e){const{actionMenu:t,buttonPopupStore:o,children:u,disabled:p,icon:y,onBlur:h,onClick:f,onFocus:v,onMouseDown:S,onMouseEnter:b,onMouseLeave:T,styles:A,subtitle:M,hideDragHandle:k}=e,{isMobile:j}=(0,a().Y0)(),[_,V]=(0,i().A)(),[w,R]=(0,s().A)(),[N,F]=(0,x().B)(),E=(0,l().uB)(o,C().A),O=(0,l().K8)((()=>E.getState().open),[E]),B=(0,c().Px)(N,w),D=!p&&(j||F||V||R||O);(0,n.useEffect)((()=>{function e(e){e.state.open||d().blurActiveElement()}return E.addListener(e),()=>{E.removeListener(e)}}),[E]);const L=Q({disabled:p,hasActionMenu:Boolean(t),isActionMenuVisible:D,overrideStyles:A}),z=I({disabled:p}),q=Boolean(k||z);return(0,P.jsxs)("div",{className:r()(K,{[H]:p||j||q}),ref:B,style:L.buttonWrap,children:[(0,P.jsxs)(m().A,{disabled:p,disabledFeedback:p,ignoreLocalHoverState:!0,ignoreLocalPressedState:!0,onBlur:h,onClick:f,onFocus:v,onMouseDown:S,onMouseEnter:b,onMouseLeave:T,ref:_,style:L.componentWrap,children:[(0,P.jsxs)("div",{style:L.headerWrap,children:[y&&(0,P.jsxs)("div",{"aria-hidden":"true",style:L.iconContainer,children:[(0,P.jsx)("div",{className:U,style:L.iconWrap,children:y(L.icon)}),!q&&(0,P.jsx)("div",{className:Y,style:L.iconWrap,children:(0,P.jsx)(g().A,{width:20,height:20,hideClickMessage:!0})})]}),(0,P.jsx)("div",{style:L.titleWrap,children:u})]}),M&&(0,P.jsx)("div",{style:L.subtitleWrap,children:M})]}),t&&(0,P.jsx)("div",{style:L.actionMenuWrap,children:(0,P.jsx)(W,{actionMenu:t,buttonPopupStore:E,disabled:p})})]})}function $(e){return(0,P.jsx)(oe,{actionId:e.actionId,canCollapse:e.canCollapse,children:(0,P.jsx)(G,{...e})})}function G(e){const{actionId:t,actionMenu:o,buttonPopupStore:i,children:u,disabled:p,forceShowActionMenu:m,onMouseEnter:g,onMouseLeave:y,styles:h,hideDragHandle:f}=e,{hasTypecheckErrors:v}=_({actionId:t}),S=I({disabled:p}),T=Boolean(f||S),{isMobile:A}=(0,a().Y0)(),[M,k]=(0,s().A)(),[j,V]=(0,x().B)(),w=(0,l().uB)(i,C().A),R=(0,l().K8)((()=>w.getState().open),[w]),{currentDraggingActionId:N}=(0,b().b)(),{isCollapsed:F,canCollapse:E,toggleCollapsed:O}=te(),B=(0,c().Px)(j,M),D=!p&&(m||A||V||k||R);(0,n.useEffect)((()=>{function e(e){e.state.open||d().blurActiveElement()}return w.addListener(e),()=>{w.removeListener(e)}}),[w]);const L=Q({disabled:p,hasActionMenu:Boolean(o),isActionMenuVisible:D,overrideStyles:h}),U=(0,n.useMemo)((()=>({...L.componentWrap,...L.border,...N&&!T?{cursor:"grabbing"}:{}})),[N,L.border,L.componentWrap,T]);return(0,P.jsxs)("div",{className:r()(K,{[H]:p||A||T||v}),onMouseEnter:g,onMouseLeave:y,ref:B,style:U,children:[o&&(0,P.jsx)("div",{style:L.actionMenuWrap,children:(0,P.jsx)(W,{actionMenu:o,buttonPopupStore:w,disabled:p,...E?{collapsible:!0,isCollapsed:F,onCollapseToggled:O}:{collapsible:!1}})}),u]})}function X(e){const{actionId:t,actionRegistryItem:o,children:r,disabled:a,errorMessage:i,onMouseEnter:s,onMouseLeave:l,styles:u}=e,{typecheckErrorMessage:c}=_({actionId:t}),d=i||c,m=I({disabled:a}),h=Boolean(d||m),{canCollapse:f,toggleCollapsed:v}=te(),x=Q({disabled:a,hasActionMenu:!1,isActionMenuVisible:!1,overrideStyles:{...u,...f?{headerWrap:{cursor:"pointer"}}:{}}}),C=(0,n.useCallback)((()=>{!a&&f&&v()}),[f,a,v]),b=(0,p().qe)(o)?o.display:void 0;return(0,P.jsx)(y().A,{disableTooltip:!d,renderTooltip:()=>d,render:e=>(0,P.jsxs)("header",{onClick:C,onMouseEnter:s,onMouseLeave:l,...e,onFocus:e=>e.stopPropagation(),style:x.headerWrap,role:"button",children:[b&&(0,P.jsxs)("div",{"aria-hidden":"true",style:x.iconContainer,children:[(0,P.jsx)("div",{className:U,style:x.iconWrap,children:(0,P.jsx)(J,{display:b,isError:Boolean(d),hasSideEffects:o.hasNewReversableEffect})}),!h&&(0,P.jsx)("div",{className:Y,style:x.iconWrap,children:(0,P.jsx)(g().A,{width:20,height:20,hideClickMessage:!0})})]}),(0,P.jsx)("div",{style:x.titleWrap,children:r})]}),placement:S().W.Bottom,delayThreshold:0})}function Z(e){const{children:t,disabled:o,styles:r}=e,{isCollapsed:a}=te(),{value:i}=(0,v().fJ)(h().fM),s=Q({disabled:o,hasActionMenu:!1,isActionMenuVisible:!1,overrideStyles:r}),[l,u]=(0,n.useState)(!1);if((0,n.useEffect)((()=>{u(!0)}),[a]),!i)return null;const{AnimatePresence:p,motion:c}=i;return(0,P.jsx)(p,{children:!a&&(0,P.jsxs)(c.div,{style:{display:"flex",flexDirection:"column"},initial:!!l&&{height:0},animate:{height:"auto"},exit:{height:0},children:[(0,P.jsx)("div",{style:s.collapsedDivider}),(0,P.jsx)("div",{style:s.bodyWrap,children:t})]})})}function Q(e){const{disabled:t,hasActionMenu:o,isActionMenuVisible:r,overrideStyles:n}=e;return(0,u().IS)((e=>({border:{border:"unset",boxShadow:`0px 0px 0px 1px ${e.stroke.secondary}, 0px 2px 4px 0px rgba(0, 0, 0, ${"dark"===e.mode?.08:.04})`},buttonWrap:{background:e.surface.elevated,border:"unset",boxShadow:`0px 0px 0px 1px ${e.stroke.secondary}, 0px 2px 4px 0px rgba(0, 0, 0, ${"dark"===e.mode?.08:.04})`,overflow:"hidden",position:"relative",...null==n?void 0:n.buttonWrap},componentWrap:{background:e.surface.elevated,display:"flex",flexDirection:"column",paddingInline:12,paddingBlock:12,position:"relative",overflow:"hidden",...t?{cursor:"default",pointerEvents:"none"}:{},...null==n?void 0:n.componentWrap},headerWrap:{display:"flex",flexDirection:"row",gap:8,marginInlineEnd:o?64:0,...t?{opacity:.4}:{},...null==n?void 0:n.headerWrap},iconContainer:{width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",position:"relative",flexShrink:0},iconWrap:{display:"flex",justifyContent:"center",alignItems:"center",width:20,height:20,...null==n?void 0:n.iconWrap},icon:{fill:e.text.secondary,height:"auto",width:16,...null==n?void 0:n.icon},titleWrap:{display:"flex",alignItems:"start",flex:"1 1 auto",fontSize:14,lineHeight:"20px",minWidth:0,whiteSpace:"pre",flexWrap:"wrap",...null==n?void 0:n.titleWrap},subtitleWrap:{...null==n?void 0:n.subtitleWrap},bodyWrap:{fontSize:14,marginBlockStart:12,marginBlockEnd:2,marginInline:2,marginTop:22,...null==n?void 0:n.bodyWrap},collapsedDivider:{borderTop:`1px solid ${e.stroke.secondary}`,left:0,marginTop:12,position:"absolute",width:"100%"},actionMenuWrap:{flex:"0 0 auto",height:26,position:"absolute",right:8,top:8,zIndex:2,...r?{}:f().Qg}})),[12,t,o,r,n])}function J(e){const{display:t,hasSideEffects:o,isError:r}=e,n=(0,u().IS)((e=>({iconWrap:{width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:4,background:r?e.tint.uiRed:o?e.tint.uiBlue:e.tint.regular,flexShrink:0},icon:{width:14,height:14,fill:r?e.icon.uiRedPrimary:o?e.icon.uiBluePrimary:e.icon.secondary,margin:"0 auto"}})),[o,r]);return(0,P.jsx)("div",{style:n.iconWrap,children:t.icon(n.icon)})}const ee=(0,n.createContext)({canCollapse:!1,isCollapsed:!1,toggleCollapsed:()=>{}});function te(){return(0,n.useContext)(ee)}function oe(e){const{actionId:t,children:o,canCollapse:r}=e,{collapsedActionIds:a,toggleActionIdCollapsed:i}=(0,b().b)(),s=(0,n.useMemo)((()=>a.includes(t)),[t,a]),l=(0,n.useCallback)((()=>{i(t)}),[t,i]);return(0,P.jsx)(ee.Provider,{value:{canCollapse:r,isCollapsed:s,toggleCollapsed:l},children:o})}ee.displayName="BaseStepElementCollapseContext"},813716:(e,t,o)=>{o.d(t,{p:()=>S});o(944114),o(898992),o(354520),o(672577),o(581454),o(737550);var r=o(296540),n=()=>o(484714),a=()=>o(390527),i=()=>o(970013),s=()=>o(206267),l=()=>o(959013),u=()=>o(534177),p=()=>o(813297),c=()=>o(246826),d=()=>o(317909),m=()=>o(862292),g=()=>o(989423),y=()=>o(726483),h=()=>o(645873),f=()=>o(324587),v=()=>o(366360);const x="all";function S(){const{automationStore:e,collectionStore:t,maybePersistedTransactionActions:o}=(0,v().k)(),{value:S}=(0,h().fJ)(p().QV.automationTypecheck),{value:b}=(0,h().fJ)(m().T.formulas),T=(0,n().v3)(),A=(0,l().tz)(),M=(0,r.useMemo)((()=>({automation_id:e.id,collection_id:t.id,builder_type:"modal"})),[e.id,t.id]),k=(0,r.useCallback)((()=>{var t;if(e.isTriggerType("recurrence"))return{currentPropertyTriggers:[],triggerOperator:x};const o=null===(t=e.getTrigger())||void 0===t?void 0:t.event.pagePropertiesEdited,r="some"===(null==o?void 0:o.type)&&o.some,n="all"===(null==o?void 0:o.type)&&o.all,a=(null==o?void 0:o.type)||"some";return r||n?{currentPropertyTriggers:r||n||[],triggerOperator:a}:{currentPropertyTriggers:[],triggerOperator:a}}),[e]),j=(0,r.useCallback)((function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:x,n=r||x;("none"===r||"any"===r&&t.length>0)&&(n=x),o.createAndCommit({userAction:"automations.removePropertyTrigger",perform:o=>{d().applyOperation({store:e,operation:{pointer:e.pointer,command:"update",path:["trigger","event"],args:{pagePropertiesEdited:0===t.length?{type:"none"}:{type:n,[n]:t}}},transaction:o})}})}),[e,o]),P=(0,r.useCallback)((t=>{const{currentPropertyTriggers:r}=k();o.createAndCommit({userAction:"automations.updatePropertyTriggerOperator",perform:o=>{d().applyOperation({store:e,operation:{pointer:e.pointer,command:"update",path:["trigger","event"],args:{pagePropertiesEdited:{type:t,[t]:r}}},transaction:o})}})}),[e,k,o]);return{addPropertyTrigger:(0,r.useCallback)((e=>{const{currentPropertyTriggers:o,triggerOperator:r}=k();j([...o,e],r);const n=t.getSchema()[e.property];(0,g().u4)({environment:T,event:{eventName:"automation_trigger_create",eventProperties:{automation_trigger:{type:"property",condition:r,property_types:null!=n&&n.type?[n.type]:[],property_configs:(0,u().O9)(e.filter.operator)&&(0,u().O9)(null==n?void 0:n.type)?[{operator:e.filter.operator,type:null==n?void 0:n.type}]:[]},...M}}})}),[M,t,T,k,j]),updatePropertyTrigger:(0,r.useCallback)((e=>{const{anyOptionCheckState:o,propertyId:r,currentFilter:n,propertySchema:a}=e,{currentPropertyTriggers:s,triggerOperator:l}=k();j((()=>{switch(o){case"partial":return C(s,(e=>e.property===r),(e=>({...e,filter:n})),{property:r,filter:n});case!0:return C(s,(e=>e.property===r),(e=>({...e,filter:{operator:"changes_to_any"}})),{property:r,filter:{operator:"changes_to_any"}});case!1:return(0,i().sS)(a)?C(s,(e=>e.property===r),(e=>({...e,filter:n})),{property:r,filter:n}):s.filter((e=>e.property!==r))}})(),l);const p=t.getSchema()[r];(0,g().u4)({environment:T,event:{eventName:"automation_trigger_create",eventProperties:{automation_trigger:{type:"property",condition:l,property_types:null!=p&&p.type?[p.type]:[],property_configs:(0,u().O9)(n.operator)&&(0,u().O9)(null==p?void 0:p.type)?[{operator:n.operator,type:null==p?void 0:p.type}]:[]},...M}}})}),[M,t,T,k,j]),removePropertyTrigger:(0,r.useCallback)((e=>{const{currentPropertyTriggers:o,triggerOperator:r}=k();j(o.filter((t=>t.property!==e)),r);const n=t.getSchema()[e],a=o.find((t=>t.property===e));(0,g().u4)({environment:T,event:{eventName:"automation_trigger_delete",eventProperties:{automation_trigger:{type:"property",condition:r,property_types:null!=n&&n.type?[n.type]:[],property_configs:(0,u().O9)(a)&&(0,u().O9)(a.filter.operator)&&(0,u().O9)(null==n?void 0:n.type)?[{operator:a.filter.operator,type:null==n?void 0:n.type}]:[]},...M}}})}),[M,t,T,k,j]),addPageAddedTrigger:(0,r.useCallback)((()=>{o.createAndCommit({userAction:"automations.addPageAddedTrigger",perform:t=>{d().applyOperation({store:e,operation:{pointer:e.pointer,command:"update",path:["trigger","event"],args:{pagesAdded:!0}},transaction:t})}}),(0,g().u4)({environment:T,event:{eventName:"automation_trigger_create",eventProperties:{automation_trigger:{type:"page"},...M}}})}),[M,e,T,o]),removePageAddedTrigger:(0,r.useCallback)((()=>{o.createAndCommit({userAction:"automations.removePageAddedTrigger",perform:t=>{d().applyOperation({store:e,operation:{pointer:e.pointer,command:"update",path:["trigger","event"],args:{pagesAdded:!1}},transaction:t})}}),(0,g().u4)({environment:T,event:{eventName:"automation_trigger_delete",eventProperties:{automation_trigger:{type:"page"},...M}}})}),[M,e,T,o]),addAnyPropertyEditedTrigger:(0,r.useCallback)((()=>{o.createAndCommit({userAction:"automations.addAnyPagePropertyEditedTrigger",perform:t=>{d().applyOperation({store:e,operation:{pointer:e.pointer,command:"update",path:["trigger","event"],args:{pagePropertiesEdited:{type:"any"}}},transaction:t})}}),(0,g().u4)({environment:T,event:{eventName:"automation_trigger_create",eventProperties:{automation_trigger:{type:"property",condition:"any"},...M}}})}),[M,e,T,o]),removeAnyPropertyEditedTrigger:(0,r.useCallback)((()=>{o.createAndCommit({userAction:"automations.removeAnyPropertyEditedTrigger",perform:t=>{d().applyOperation({store:e,operation:{path:["trigger","event"],args:{pagePropertiesEdited:{type:"none"}},pointer:e.pointer,command:"update"},transaction:t})}}),(0,g().u4)({environment:T,event:{eventName:"automation_trigger_delete",eventProperties:{automation_trigger:{type:"property",condition:"any"},...M}}})}),[M,e,T,o]),updateTriggerOperator:P,addEmptyRecurrenceTrigger:(0,r.useCallback)((()=>{o.createAndCommit({userAction:"automations.addEmptyRecurrenceTrigger",perform:t=>{c().KY({transaction:t,store:e.getKeyStore("trigger"),value:{type:"recurrence",id:s().JW()}}),S&&b&&(0,f().clearInvalidVariables)({environment:T,automationStore:e,automationTypecheckModule:S,contextType:"recurrence",formulasModule:b,intl:A,transaction:t}),(0,g().u4)({environment:T,event:{eventName:"automation_trigger_create",eventProperties:{automation_trigger:{type:"recurrence"},...M}}})}})}),[e,S,b,A,o,M,T]),changeRecurrenceSchedule:(0,r.useCallback)((t=>{o.createAndCommit({userAction:"automations.changeRecurrenceSchedule",perform:o=>{c().zv({store:e.getKeyStore("trigger"),data:{recurrence:t?(0,a().convertFromUnpersistedRecurrenceConfig)(t):void 0},transaction:o})}})}),[e,o]),removeRecurrenceTrigger:(0,r.useCallback)((()=>{o.createAndCommit({userAction:"automations.removeRecurrenceTrigger",perform:o=>{c().KY({transaction:o,store:e.getKeyStore("trigger"),value:{type:"event",id:s().JW(),event:(0,y().B0)(t)}})}}),(0,g().u4)({environment:T,event:{eventName:"automation_trigger_delete",eventProperties:{automation_trigger:{type:"recurrence"},...M}}})}),[M,e,t,T,o]),removeRelativeDateTrigger:(0,r.useCallback)((()=>{o.createAndCommit({userAction:"automations.removeRelativeDateTrigger",perform:t=>{d().applyOperation({store:e,operation:{pointer:e.pointer,command:"update",path:["trigger","event"],args:{relativeDate:void 0}},transaction:t})}}),(0,g().u4)({environment:T,event:{eventName:"automation_trigger_delete",eventProperties:{automation_trigger:{type:"relative_date"},...M}}})}),[M,e,T,o]),addRelativeDateTrigger:(0,r.useCallback)((t=>{o.createAndCommit({userAction:"automations.addRelativeDateTrigger",perform:o=>{d().applyOperation({store:e,operation:{pointer:e.pointer,command:"update",path:["trigger","event"],args:{relativeDate:{property:t.propertyId,offset:{type:"hours",hours:0}}}},transaction:o})}}),(0,g().u4)({environment:T,event:{eventName:"automation_trigger_create",eventProperties:{automation_trigger:{type:"relative_date"},...M}}})}),[M,e,T,o])}}function C(e,t,o,r){let n=!1;const a=e.map((e=>t(e)?(n=!0,o(e)):e));return n||a.push(r),a}},880264:(e,t,o)=>{o.d(t,{Mh:()=>x,Zr:()=>f});var r=o(296540),n=()=>o(56366),a=()=>o(401497),i=()=>o(693954),s=()=>o(959013),l=()=>o(284371),u=()=>o(406699),p=()=>o(463830),c=()=>o(656134),d=()=>o(813716),m=()=>o(541172),g=()=>o(997939),y=()=>o(897499),h=o(474848);function f(e){const{propertySchema:t}=e,{property:o}=(0,r.useContext)(y()._B),{removePropertyTrigger:m}=(0,d().p)(),f=(0,a().IS)((e=>({content:{...l().RC,color:e.text.uiRedPrimary,fontWeight:l().Wy.medium,whiteSpace:"normal"},icon:{fill:e.text.uiRedPrimary},propertyName:{color:e.accentColors.red[700],fontWeight:l().Wy.semibold,whiteSpace:"nowrap"}})),[]),x=(0,c().j)(),C=(0,n().uB)(void 0,p().A),b=(0,r.useCallback)((()=>C.reset()),[C]),T=(0,r.useCallback)((()=>{m(o)}),[o,m]),A=function(e){const{propertySchema:t,styles:o}=e;return(0,h.jsx)(s().sA,{defaultMessage:"{propertyName} property is a cross-workspace relation",id:"crossWorkspaceRelationPropertyTrigger.title",values:{propertyName:(0,h.jsx)("span",{style:o.propertyName,children:t.name})}})}({propertySchema:t,styles:f}),M=function(e){const{propertySchema:t}=e;return(0,h.jsx)(s().sA,{defaultMessage:"{propertyName} property is a cross-workspace relation. Cross-workspace features are restricted in automations and will not work.",id:"crossWorkspaceRelationPropertyTrigger.tooltip",values:{propertyName:S({maxLength:20,text:t.name})}})}({propertySchema:t});return(0,h.jsx)(u().Ay,{buttonPopupStore:C,popupType:x,render:()=>(0,h.jsx)(v,{closeMenu:b,propertyId:o}),renderOrigin:e=>(0,h.jsx)(g().X,{...e,icon:i().Q,onDelete:T,styles:f,tooltip:M,children:(0,h.jsx)("div",{style:f.content,children:A})})})}function v(e){const{closeMenu:t,propertyId:o}=e,{removePropertyTrigger:n}=(0,d().p)(),a=(0,r.useCallback)((()=>{n(o),null==t||t()}),[t,o,n]);return(0,h.jsx)(m().Ol,{onDelete:a,stepType:"trigger"})}function x(e){const{propertySchema:t}=e;return(0,h.jsx)(s().sA,{defaultMessage:"{propertyName} property is a cross-workspace relation",id:"crossWorkspaceRelationPropertyTrigger.title",values:{propertyName:t.name}})}function S(e){const{maxLength:t,text:o,truncateCharacter:r}=e,n=r??"…",a=Array.from(o);return a.length<=t?o:`${a.slice(0,t-1).join("")}${n}`}},897499:(e,t,o)=>{o.d(t,{Js:()=>he,_B:()=>ye,CD:()=>fe});o(898992),o(354520),o(581454),o(737550);var r=o(296540),n=()=>o(56366),a=()=>o(546461),i=()=>o(5269),s=()=>o(401497),l=()=>o(173019),u=()=>o(959013),p=()=>o(284371),c=()=>o(214973),d=()=>o(813716),m=()=>o(997939),g=o(474848);function y(){const{removeAnyPropertyEditedTrigger:e}=(0,d().p)(),t=(0,u().tz)(),o=(0,s().IS)((()=>({title:{fontWeight:p().Wy.medium}})),[]),r=c().HG(t);return(0,g.jsx)(m().X,{icon:l().r,onDelete:e,tooltip:r,children:(0,g.jsx)("div",{style:o.title,children:r})})}var h=()=>o(422540),f=()=>o(289915),v=()=>o(970013),x=()=>o(963589),S=()=>o(38440),C=()=>o(366360),b=()=>o(406699),T=()=>o(656134),A=()=>o(961137);function M(e){const{renderOrigin:t,property:o}=e,r=(0,T().j)();return(0,g.jsx)(b().Ay,{popupType:r,renderOrigin:t,render:e=>(0,g.jsx)(A().A,{initialState:{type:"propertyChangedFilter",property:o},buttonPopupParent:e})})}var k=()=>o(383688),j=()=>o(880264),P=()=>o(36697),_=()=>o(989064);function V(e){let{propertySchema:t,onClick:o}=e;return(0,g.jsx)(_().z,{onClick:o,icon:e=>(0,g.jsx)(P().P,{propertySchema:t,style:e}),tooltip:(0,g.jsx)(w,{propertyName:t.name}),children:(0,g.jsx)(I,{propertyName:t.name})})}function I(e){let{propertyName:t}=e;const o=(0,u().tz)(),r=(0,s().IS)((()=>({propertyName:{...p().RC,fontWeight:p().Wy.medium},wrap:{alignItems:"center",display:"flex",whiteSpace:"pre"}})),[]),n=c().yR(o,{propertyName:(0,g.jsx)("span",{style:r.propertyName,children:t})});return(0,g.jsx)("span",{style:r.wrap,children:n})}function w(e){let{propertyName:t}=e;const o=(0,u().tz)();return(0,g.jsx)(g.Fragment,{children:c().yR(o,{propertyName:t})})}function R(e){let{propertySchema:t,onClick:o}=e;return(0,g.jsx)(_().z,{onClick:o,icon:e=>(0,g.jsx)(P().P,{propertySchema:t,style:e}),tooltip:(0,g.jsx)(F,{propertyName:t.name}),children:(0,g.jsx)(N,{propertyName:t.name})})}function N(e){let{propertyName:t}=e;const o=(0,u().tz)(),r=(0,s().IS)((()=>({propertyName:{...p().RC,fontWeight:p().Wy.medium},wrap:{alignItems:"center",display:"flex",whiteSpace:"pre"}})),[]),n=c().Od(o,{propertyName:(0,g.jsx)("span",{style:r.propertyName,children:t})});return(0,g.jsx)("span",{style:r.wrap,children:n})}function F(e){let{propertyName:t}=e;const o=(0,u().tz)();return(0,g.jsx)(g.Fragment,{children:c().Od(o,{propertyName:t})})}var E=()=>o(798941);function O(e){const{filter:t,propertySchema:o,onClick:r}=e,{title:n,tooltipTitle:a,styles:i}=(0,E().aR)({numberValue:t.value.value,operator:t.operator,propertySchema:o,messageType:"trigger"});return(0,g.jsx)(_().z,{onClick:r,tooltip:(0,g.jsx)("span",{children:a}),children:(0,g.jsx)("div",{style:i.content,children:n})})}var B=()=>o(112588),D=()=>o(743176),W=()=>o(693954),L=()=>o(534177),K=()=>o(463830),H=()=>o(984714),U=()=>o(630550);function Y(e){const{deletedPropertySchema:t}=e,o=null==t?void 0:t.type,{property:a}=(0,r.useContext)(ye),{removePropertyTrigger:i}=(0,d().p)(),l=(0,x().X)("automation_updated_error_states"),u=(0,s().IS)((e=>({content:{color:e.text.uiRedPrimary,fontWeight:l?p().Wy.regular:p().Wy.medium,whiteSpace:"normal"},icon:{fill:e.text.uiRedPrimary},iconWrap:{...l&&{background:e.tint.uiRed,borderRadius:4}},propertyType:{color:e.accentColors.red[700]}})),[l]),c=(0,T().j)(),y=(0,n().uB)(void 0,K().A),h=(0,r.useCallback)((()=>y.reset()),[y]),f=(0,r.useCallback)((()=>{i(a)}),[a,i]),v=(0,L().O9)(t)?(0,H().AJ)({propertySchema:t,styles:u,hasAutomationUpdatedErrorStatesEnabled:l}):(0,H().Xl)(),S=(0,L().O9)(t)?(0,H().CH)({propertySchema:t,hasAutomationUpdatedErrorStatesEnabled:l}):(0,H().Xl)();return(0,g.jsx)(b().Ay,{buttonPopupStore:y,popupType:c,render:()=>(0,g.jsx)(U().c,{closeMenu:h,propertyId:a}),renderOrigin:e=>(0,g.jsx)(m().X,{...e,icon:l&&(0,L().O9)(o)?D().Yp[o]:W().Q,onDelete:f,styles:u,tooltip:S,children:(0,g.jsx)("div",{style:u.content,children:v})})})}var z=()=>o(133518),q=()=>o(457050);function $(e){const{filter:t,propertySchema:o,onClick:r}=e,a=(0,z().F)(),{collectionStore:i}=(0,C().k)(),s=(0,x().X)("collections_xws"),l=(0,n().K8)((()=>i.getSpaceId()),[i]),u=(0,n().K8)((()=>s&&(0,v().o2)(l,o)),[s,o,l]),p=(0,n().K8)((()=>(0,q().WE)({collectionStore:i,filter:t})),[i,t]),{title:c,tooltipTitle:d,styles:m}=(0,q().xL)({automationContextValues:a,filter:t,collectionStore:i,operator:t.operator,propertySchema:o,messageType:"trigger",value:null==p?void 0:p.value});return u?(0,g.jsx)(j().Zr,{propertySchema:o}):(0,g.jsx)(_().z,{onClick:r,tooltip:(0,g.jsx)("span",{children:d}),children:(0,g.jsx)("div",{style:m.content,children:c})})}var G=()=>o(477329),X=()=>o(27511),Z=()=>o(967823);function Q(e){const{filter:t,propertySchema:o,onClick:r}=e,{title:n,tooltipTitle:a,styles:i}=(0,Z().w5)({textValue:t.value.value,operator:t.operator,propertySchema:o,messageType:"trigger"});return(0,g.jsx)(_().z,{onClick:r,tooltip:(0,g.jsx)("span",{children:a}),children:(0,g.jsx)("div",{style:i.content,children:n})})}var J=()=>o(682146),ee=()=>o(484714),te=()=>o(735384),oe=()=>o(760217),re=()=>o(928600),ne=()=>o(939740),ae=()=>o(89924),ie=()=>o(781697);function se(e){const{closeMenu:t,propertyId:o}=e,{removePropertyTrigger:n}=(0,d().p)(),a=(0,r.useCallback)((()=>{n(o),null==t||t()}),[t,o,n]),i=(0,ie().e)({width:266}),l=(0,ee().Y0)().isMobile,p=(0,s().IS)((e=>({icon:{color:e.accentColors.gray[600],height:"auto",width:l?"12px":"16px"}})),[l]),c=(0,r.useMemo)((()=>({action:a,key:"delete-property-menu-item",render:e=>(0,g.jsx)(oe().A,{...e,icon:(0,te().I)(p.icon),title:(0,g.jsx)(u().sA,{id:"automationUnsupportedOperatorMenu.deleteTrigger.title",defaultMessage:"Delete trigger"})})})),[a,p.icon]);return(0,g.jsx)(re().A,{...i,children:(0,g.jsx)(ne().Ay,{initialFocus:0,sections:[{key:"actions-section",items:[c],render:e=>(0,g.jsx)(ae().A,{...e})}],type:ne().Oh.Vertical})})}function le(e){let{filter:t,propertySchema:o}=e;const a=(0,u().tz)(),{property:i}=(0,r.useContext)(ye),{removePropertyTrigger:l}=(0,d().p)(),c=(0,x().X)("automation_updated_error_states"),y=(0,s().IS)((e=>({content:{color:e.text.uiRedPrimary,fontWeight:c?p().Wy.regular:p().Wy.medium,whiteSpace:"normal"},icon:{fill:e.text.uiRedPrimary},iconWrap:{...c&&{background:e.tint.uiRed,borderRadius:4}},propertyType:{color:e.accentColors.red[700]}})),[c]),h=(0,T().j)(),f=(0,n().uB)(void 0,K().A),v=(0,r.useCallback)((()=>f.reset()),[f]),C=(0,r.useCallback)((()=>{l(i)}),[i,l]),A=function(e){const{propertySchema:t,styles:o,hasAutomationUpdatedErrorStatesEnabled:r}=e,n=t.type,a=t.name||J().dC[n];if(r)return(0,g.jsx)(u().sA,{defaultMessage:'"{propertyTypeDisplayName}" property type is incompatible with this step',id:"updateThisPageUnsupportedOperatorAction.updatedUnsupportedOperator.title",values:{propertyTypeDisplayName:a}});return(0,g.jsx)(u().sA,{defaultMessage:"{propertyTypeDisplayName} property type is incompatible with this step",id:"updateThisPageUnsupportedOperatorAction.unsupportedOperator.title",values:{propertyTypeDisplayName:(0,g.jsx)("span",{style:o.propertyType,children:a})}})}({propertySchema:o,styles:y,hasAutomationUpdatedErrorStatesEnabled:c}),M=function(e){const{filter:t,intl:o}=e,r=S().LN[t.operator],n=(S().lD[r]||[]).map((e=>J().dC[e])),a=o.formatList(n,{style:"long",type:"disjunction"});return(0,g.jsx)(u().sA,{defaultMessage:"Remove step or restore property to a valid type: {propertiesSupportedList}",id:"updateThisPageUnsupportedOperatorAction.unsupportedOperator.titleList",values:{propertiesSupportedList:a}})}({intl:a,filter:t}),k=o.type;return(0,g.jsx)(b().Ay,{buttonPopupStore:f,popupType:h,render:()=>(0,g.jsx)(se,{closeMenu:v,propertyId:i}),renderOrigin:e=>(0,g.jsx)(m().X,{...e,icon:c&&(0,L().O9)(k)?D().Yp[k]:W().Q,onDelete:C,styles:y,tooltip:M,children:(0,g.jsx)("div",{style:y.content,children:A})})})}var ue=()=>o(217028),pe=()=>o(541172);function ce(e){let{propertySchema:t}=e;const{property:o}=(0,r.useContext)(ye),{removePropertyTrigger:a}=(0,d().p)(),i=(0,x().X)("automation_updated_error_states"),l=(0,s().IS)((e=>({content:{color:e.text.uiRedPrimary,fontWeight:i?p().Wy.regular:p().Wy.medium,whiteSpace:"normal"},icon:{fill:e.text.uiRedPrimary},iconWrap:{...i&&{background:e.tint.uiRed,borderRadius:4}},propertyType:{color:e.accentColors.red[700]}})),[i]),u=(0,T().j)(),c=(0,n().uB)(void 0,K().A),y=(0,r.useCallback)((()=>c.reset()),[c]),h=(0,r.useCallback)((()=>{a(o)}),[o,a]),f=(0,ue().m9)({propertySchema:t,styles:l,hasAutomationUpdatedErrorStatesEnabled:i}),v=(0,ue().cn)({propertySchema:t,hasAutomationUpdatedErrorStatesEnabled:i}),S=t.type;return(0,g.jsx)(b().Ay,{buttonPopupStore:c,popupType:u,render:()=>(0,g.jsx)(pe().A5,{closeMenu:y,propertyId:o}),renderOrigin:e=>(0,g.jsx)(m().X,{...e,icon:i&&(0,L().O9)(S)?D().Yp[S]:W().Q,onDelete:h,styles:l,tooltip:v,children:(0,g.jsx)("div",{style:l.content,children:f})})})}function de(e){const{collectionStore:t}=(0,C().k)(),{property:o,filter:r}=e,[a,i]=(0,n().K8)((()=>{var e,r;return[null===(e=t.getSchema())||void 0===e?void 0:e[o],null===(r=t.getDeletedSchema())||void 0===r?void 0:r[o]]}),[t,o]);if(!a)return(0,g.jsx)(Y,{deletedPropertySchema:i});if(!(0,h().$0)(a))return(0,g.jsx)(ce,{propertySchema:a});const s=S().W[a.type]||a.type;return"changes_to_any"!==r.operator&&"is_empty"!==r.operator&&r.operator&&S().LN[r.operator]!==s?(0,g.jsx)(le,{propertySchema:a,filter:r}):(0,h().nq)(a)?(0,g.jsx)(ge,{property:o,propertySchema:a,filter:r}):(0,g.jsx)(R,{propertySchema:a})}function me(e){const{filter:t,onClick:o,propertySchema:r}=e,{collectionStore:a}=(0,C().k)(),i=(0,x().X)("collections_xws"),s=(0,n().K8)((()=>i&&(0,v().nC)(r)&&(0,v().o2)(a.getSpaceId(),r)),[a,r,i]);return(0,v().nC)(r)&&s?(0,g.jsx)(j().Zr,{propertySchema:r}):"is_empty"===t.operator?(0,g.jsx)(V,{...e,propertySchema:r}):"changes_to_any"!==t.operator&&(0,f().gc)(t)?"checkbox"===r.type&&(0,f().Ui)(t)?(0,g.jsx)(k().ZZ,{filter:t,onClick:o,propertySchema:r}):"status"===r.type&&(0,f().H$)(t)?(0,g.jsx)(X().y,{filter:t,onClick:o,propertySchema:r}):"select"===r.type&&(0,f().v0)(t)||"multi_select"===r.type&&(0,f().as)(t)?(0,g.jsx)(G().Ww,{filter:t,onClick:o,propertySchema:r}):"person"===r.type&&(0,f().I_)(t)?(0,g.jsx)(B().h,{filter:t,onClick:o,propertySchema:r}):"number"===r.type&&(0,f().My)(t)?(0,g.jsx)(O,{filter:t,onClick:o,propertySchema:r}):"email"!==r.type&&"phone_number"!==r.type&&"text"!==r.type&&"title"!==r.type&&"url"!==r.type||!(0,f().YH)(t)?"relation"===r.type&&(0,f().Pq)(t)?(0,g.jsx)($,{filter:t,onClick:o,propertySchema:r}):(0,g.jsx)(R,{onClick:o,propertySchema:r}):(0,g.jsx)(Q,{filter:t,onClick:o,propertySchema:r}):(0,g.jsx)(R,{onClick:o,propertySchema:r})}function ge(e){const{filter:t,propertySchema:o,property:n}=e,a=(0,r.useCallback)((e=>(0,g.jsx)(me,{filter:t,onClick:e.onClick,propertySchema:o})),[t,o]);return(0,g.jsx)(M,{renderOrigin:a,property:n})}const ye=(0,r.createContext)({pagePropertiesEdited:[],property:""});function he(){const{automationStore:e,contextType:t}=(0,a().EC)(),o=(0,i().y)(e,t),r=fe(e),s=(0,n().K8)((()=>{var t;if(!e||!e.isTriggerType("event"))return;const o=null===(t=e.getEventConfiguration())||void 0===t?void 0:t.pagePropertiesEdited;return"none"===(null==o?void 0:o.type)?void 0:o}),[e]),l=(0,n().K8)((()=>null==o?void 0:o.getSchema()),[o]);if(!r||!s)return null;if("any"===s.type)return(0,g.jsx)(y,{});if(!l)return null;let u=[];return"all"===s.type?u=s.all??[]:"some"===s.type&&(u=s.some??[]),u?(0,g.jsx)(g.Fragment,{children:u.map((e=>{let{property:t,filter:o}=e;return(0,g.jsx)(ye.Provider,{value:{property:t,pagePropertiesEdited:u},children:(0,g.jsx)(de,{property:t,filter:o})},t)}))}):null}function fe(e){return(0,n().K8)((()=>{if(null==e||!e.isTriggerType("event"))return!1;const t=e.getEventConfiguration(),o=Boolean("none"!==(null==t?void 0:t.pagePropertiesEdited.type)),r=Boolean("all"===(null==t?void 0:t.pagePropertiesEdited.type)&&!(null==t||!t.pagePropertiesEdited.all)),n=Boolean("some"===(null==t?void 0:t.pagePropertiesEdited.type)&&!(null==t||!t.pagePropertiesEdited.some)),a=Boolean("any"===(null==t?void 0:t.pagePropertiesEdited.type));return o&&(r||n||a)}),[e])}ye.displayName="PropertyEditedTriggerContext"},898125:(e,t,o)=>{o.d(t,{HJ:()=>P,WA:()=>k,be:()=>j,bx:()=>I,kU:()=>A,lT:()=>V,lg:()=>M,nO:()=>T,vH:()=>_});o(16280),o(944114);var r=()=>o(890409),n=()=>o(735384),a=()=>o(206267),i=()=>o(912720),s=()=>o(973647),l=()=>o(534177),u=()=>o(901389),p=()=>o(246826),c=()=>o(317909),d=()=>o(324587),m=()=>o(546461),g=()=>o(301782),y=()=>o(989423),h=()=>o(909470),f=()=>o(698331),v=()=>o(594794),x=()=>o(972435),S=()=>o(508496),C=()=>o(630116);const b=(0,o(959013).YK)({automationDeleteConfirmationMessage:{id:"slackAutomations.remove.confirmation.message",defaultMessage:"Delete {automationName}?"},automationDeleteAcceptLabel:{id:"slackAutomations.remove.confirmation.acceptLabel",defaultMessage:"Delete"},confirmDiscardChangesMessage:{id:"automations.confirmDiscardChanges.message",defaultMessage:"Discard unsaved changes to this automation?"},confirmDiscardChangesAccept:{defaultMessage:"Discard",id:"automations.confirmDiscardChanges.acceptLabel"},confirmDiscardOptionalFieldChangesMessage:{id:"automations.confirmDiscardToggleFieldChangesMessage.message",defaultMessage:"{hasName, select, true {Discard {fieldName} field?} other {Discard field?}}"}});function T(e){const{automationStore:t,collectionStore:o,environment:n,intl:u,from:f,builderType:v}=e;c().createAndCommit({environment:n,userAction:"collectionSettingsAutomationsActions.createDatabaseAutomation",canUndo:!0,perform:e=>{c().applyOperation({store:o,operation:{pointer:o.pointer,path:["format","automation_ids"],command:"listAfter",args:{id:t.id}},transaction:e});const r=C().dn.createChildStore(o,t.pointer),s=t.getActionStores();for(const t of s){const o=t.getType();o&&d().addAutomationAction({actionId:t.id,actionType:o,automationStore:r,config:t.getConfig(),environment:n,intl:u,transaction:e})}let m;const g=t.getTrigger();(0,l().O9)(g)&&"event"!==g.type?"recurrence"===g.type?m={id:a().JW(),type:"recurrence",recurrence:g.recurrence}:(0,l().HB)(g):m={id:a().JW(),type:"event",event:(null==g?void 0:g.event)??{pagesAdded:!1,pagePropertiesEdited:{type:"none"},source:{pointer:o.getSpaceShardedPointer(),type:"collection"}}},p().eC({environment:n,inMemoryRecordCache:o.inMemoryRecordCache,table:i().yB,transaction:e,value:{action_ids:t.getActionIds(),alive:!0,id:t.id,parent_id:o.id,parent_table:o.table,properties:{name:t.getName()},space_id:o.getSpaceId(),status:"active",trigger:m}})}});const x=t.getModel();if((0,l().O9)(x)){const e=(0,m().To)(t);let o=[];e&&s().Q.isSuccess(e)&&(o=e.value.valueTypes),(0,g().CM)(((e,a,i)=>{const s=(0,y().ik)(n),l=r().sp({automationModel:x,builderType:v,formulaAnalyticsModule:a,formulasModule:e,formulaTypecheckContextValues:o,getRecordModel:t.getRecordModel,featureGates:(0,h().i)(),simpleFormulasModule:i}),u=f?{feature:{id:l.automation_id,from:f,type:"automation"}}:{};r().Dk(s,{...l,...u}),S().default.logEvent("automation_create")}))}}function A(e){const{automationStore:t,collectionStore:o,environment:n,builderType:a,source:i}=e;c().createAndCommit({environment:n,userAction:"collectionSettingsAutomationsActions.saveDatabaseAutomation",canUndo:!0,perform:e=>{const r=C().dn.createChildStore(o,t.pointer),n=t.getName(),a=r.getKeyStore("properties");p().zv({store:a,data:{name:n},transaction:e}),t.getStatus()!==r.getStatus()&&p().zv({store:r,data:{status:t.getStatus()},transaction:e});const i=t.getActionStores();if((0,f().$X)(r)&&(0,f().$X)(t))if(t.isTriggerType("event"))r.isTriggerType("event")||p().zv({store:r.getTriggerStore(),data:{type:"event"},transaction:e}),r.verifyTriggerType("event"),p().zv({store:r.getTriggerStore().getKeyStore("event"),data:t.getTriggerStore().getKeyStore("event").getValue(),transaction:e});else{if(!t.isTriggerType("recurrence"))throw new Error("Unexpected trigger type for automationStore");r.isTriggerType("recurrence")||p().zv({store:r.getTriggerStore(),data:{type:"recurrence"},transaction:e}),r.verifyTriggerType("recurrence"),p().zv({store:r.getTriggerStore().getKeyStore("recurrence"),data:t.getTriggerStore().getKeyStore("recurrence").getValue(),transaction:e})}const s=[];for(const t of i){const o=t.getModel();if(!o)continue;const n=C().bx.createChildStore(r,t.pointer);p().KY({store:n,value:{alive:!0,config:o.getConfig(),id:o.id,parent_id:r.id,parent_table:r.table,space_id:r.getSpaceId(),type:o.type},transaction:e}),s.push(t.id)}p().zv({store:r,data:{action_ids:s},transaction:e})}});const u=t.getModel();(0,l().O9)(u)&&(0,g().CM)(((e,o,l)=>{const p=(0,m().To)(t);let c=[];p&&s().Q.isSuccess(p)&&(c=p.value.valueTypes);const d=(0,y().ik)(n),g=r().sp({automationModel:u,builderType:a,formulaAnalyticsModule:o,formulasModule:e,formulaTypecheckContextValues:c,getRecordModel:t.getRecordModel,featureGates:(0,h().i)(),simpleFormulasModule:l,source:i});r().SF(d,g),S().default.logEvent("automation_update")}))}async function M(e){const{intl:t,environment:o,collectionStore:r,existingAutomationStore:n,onDelete:a}=e,i=n.getNameWithDefault(t);(await u().Gh({message:t.formatMessage(b.automationDeleteConfirmationMessage,{automationName:i}),acceptLabel:t.formatMessage(b.automationDeleteAcceptLabel)})).accept&&(!function(e){const{environment:t,collectionStore:o,existingAutomationStore:r}=e;c().createAndCommit({environment:t,userAction:"collectionSettingsAutomationsActions.deleteAutomation",canUndo:!0,perform:e=>{const n=o.getFormatStore().getKeyStore("automation_ids"),a=C().dn.createChildStore(o,r.pointer);c().applyOperation({store:n,operation:{pointer:n.pointer,path:n.path,command:"listRemove",args:{id:a.id}},transaction:e}),d().deleteAutomation({automationStore:a,environment:t,transaction:e})}})}({environment:o,collectionStore:r,existingAutomationStore:n}),null==a||a())}function k(e){const{automationStore:t,environment:o}=e;c().createAndCommit({environment:o,userAction:"collectionSettingsAutomationsActions.disableAutomation",canUndo:!0,perform:e=>{d().disableAutomation({automationStore:t,environment:o,transaction:e})}})}function j(e){const{automationStore:t,collectionStore:o,environment:r}=e;c().createAndCommit({canUndo:!0,environment:r,userAction:"collectionSettingsAutomationsActions.restartAutomation",perform:e=>{const r=C().dn.createChildStore(o,t.pointer);d().restartAutomation({automationStore:r,transaction:e})}})}function P(e){const{automationStore:t,environment:o}=e;c().createAndCommit({environment:o,userAction:"collectionSettingsAutomationsActions.enableAutomation",canUndo:!0,perform:e=>{d().enableAutomation({automationStore:t,environment:o,transaction:e})}})}function _(e){const{automationStore:t,collectionStore:o,environment:r}=e,n=o.getFormatStore().getKeyStore("automation_ids"),a=(0,v().Z1)({environment:r,table:i().yB,spaceId:t.getSpaceId()});c().createAndCommit({environment:r,userAction:"",canUndo:!0,perform:e=>{d().duplicateAutomation({environment:r,sourceAutomationStore:t,targetAutomationId:a,transaction:e}),c().applyOperation({store:n,operation:{pointer:n.pointer,path:n.path,command:"listAfter",args:{id:a}},transaction:e})}})}async function V(e){const{hasPendingChanges:t}=e;if(!t)return!0;return(await u().Gh({acceptLabel:x().A.formatMessage(b.confirmDiscardChangesAccept),message:x().A.formatMessage(b.confirmDiscardChangesMessage),icon:(0,n().I)({height:24,width:24})})).accept}async function I(e){const{fieldName:t}=e;return(await u().Gh({acceptLabel:x().A.formatMessage(b.confirmDiscardChangesAccept),message:x().A.formatMessage(b.confirmDiscardOptionalFieldChangesMessage,{fieldName:t,hasName:Boolean(t)}),icon:(0,n().I)({height:24,width:24})})).accept}},905209:(e,t,o)=>{o.d(t,{$:()=>f});var r=o(296540),n=()=>o(662303),a=()=>o(484714),i=()=>o(56366),s=()=>o(401497),l=()=>o(534177),u=()=>o(284371),p=()=>o(354584),c=()=>o(712030),d=()=>o(921855),m=()=>o(645873),g=()=>o(562800),y=()=>o(509144),h=o(474848);function f(e){const{formulaTypecheckContextValues:t,parentRecordStore:o,spaceId:f,value:v}=e,x=(0,s().IS)((()=>({overflowWrap:{whiteSpace:"inherit"},textWrap:{alignItems:"center",display:"flex",fontFamily:u().vc(n().locale).githubMono}})),[]),S=function(e){const{formulaTypecheckContextValues:t,parentRecordStore:o,spaceId:n,value:u}=e,f=(0,a().v3)(),v=(0,a().Y0)(),x=(0,i().K8)((()=>f.KatexStore.getKatex()),[f]),S=(0,c().Ol)(),C=(0,s().DP)(),{value:b}=(0,m().fJ)(p().y),[T,A]=(0,r.useMemo)((()=>[null==u?void 0:u.value,(null==u?void 0:u.type)??"simple"]),[u]);return(0,i().K8)((()=>{if(!T)return"";if("simple"===A)return(0,d().S5)({disabled:!0,disableDateStyleAnnotations:!1,disableHover:!1,disableInsertedDeletedAnnotations:!1,disableStyleAnnotations:!1,disableSuggestionAnnotations:!1,emojiType:S,environment:f,formulaValueTypes:t,katex:x,parentBlockId:void 0,parentStore:o,renderedPageBlockId:void 0,textValue:{value:T,spaceId:n},theme:C});if("formula"===A){if(b){const e=(0,y()._)({currentUserId:f.currentUser.id,errorRanges:[],getPublicBaseUrlForPage:g().SN(f),isAndroid:v.isAndroid,isMobileNative:v.isMobileNative,isSafariOrIOS:v.isSafari||v.isIOS,isWindows:v.isWindows,parentSpaceId:n,Prism:b,store:o,textValue:T,theme:C,valueTypes:t});return(0,h.jsx)("div",{dangerouslySetInnerHTML:{__html:e}})}return""}(0,l().HB)(A)}),[b,v.isAndroid,v.isIOS,v.isMobileNative,v.isSafari,v.isWindows,S,f,t,x,o,n,C,A,T])}({formulaTypecheckContextValues:t??[],parentRecordStore:o,spaceId:f,value:v});return(0,h.jsx)("div",{style:x.textWrap,children:(0,h.jsx)("div",{style:x.overflowWrap,children:S})})}},961137:(e,t,o)=>{o.d(t,{A:()=>We});var r=o(296540),n=()=>o(56366),a=()=>o(534177),i=()=>o(404412),s=(o(898992),o(354520),o(672577),o(581454),o(737550),o.n(o(844751))),l=()=>o(484714),u=()=>o(401497),p=()=>o(422540),c=()=>o(970013),d=()=>o(743176),m=()=>o(742117),g=()=>o(918676),y=()=>o(173019),h=()=>o(689094),f=()=>o(959013),v=()=>o(496603),x=()=>o(901389),S=()=>o(760217),C=()=>o(419357),b=()=>o(928600),T=()=>o(939740),A=()=>o(89924),M=()=>o(662971),k=()=>o(42425),j=()=>o(726483),P=()=>o(722872),_=()=>o(963589),V=()=>o(991249),I=()=>o(527871),w=()=>o(366360),R=()=>o(781697),N=()=>o(813716),F=o(474848);const E=(0,f().YK)({searchInputPlaceholder:{id:"automationEventTriggerMenu.searchInputPlaceholder.label",defaultMessage:"Search triggers…"},pageAddedCopy:{id:"automationEventTriggerMenu.pageAdded.title",defaultMessage:"Page added"},pagePropertiesEditedCopy:{id:"automationEventTriggerMenu.anyPropertyEdited.title",defaultMessage:"Any property edited"},recurrenceCopy:{id:"automationEventTriggerMenu.recurrence.title",defaultMessage:"Every…"}});function O(e){const{automationTriggerMenuStore:t,onClose:o}=e,{automationStore:i,collectionStore:g}=(0,w().k)(),M=(0,u().DP)(),k=(0,f().tz)(),P=(0,N().p)(),V=(0,_().X)("collections_xws"),I=(0,r.useMemo)((()=>({...P,closeMenu:o})),[P,o]),[O,W]=r.useState(""),H=(0,n().K8)((()=>g.getSpaceId()),[g]),U=(0,n().K8)((()=>g.getSchema()),[g]),Y=(0,n().K8)((()=>i.getTrigger()),[i]),z=(0,n().K8)((()=>"event"===(null==Y?void 0:Y.type)&&Y.event.pagesAdded),[Y]),q=(0,n().K8)((()=>{if(V)return e=>{const t=e[1];return!(0,c().nC)(t)||!(0,c().o2)(H,t)}}),[V,H]),$=(0,n().K8)((()=>(0,p().nv)({collectionFormat:g.getFormat(),collectionSchema:U,filter:q})),[g,U,q]),G=(0,j().iX)({collectionSchema:U,propertyIds:$,searchTerm:O}),X=(0,n().K8)((()=>"event"===(null==Y?void 0:Y.type)&&(z||"none"!==Y.event.pagePropertiesEdited.type)),[Y,z]),Z=B(),Q=(0,R().e)({maxHeight:"50vh",width:266}),J=(0,l().v3)(),{isMobile:ee}=(0,l().Y0)(),te=(0,F.jsx)(A().A,{isInput:!0,children:(0,F.jsx)(C().Ay,{focus:!ee,value:O,onChange:e=>{W(e.target.value)},placeholder:k.formatMessage(E.searchInputPlaceholder)})}),oe=(0,n().K8)((()=>function(e){const{environment:t,intl:o,searchInput:r,styles:n,actions:a,hasPageAddedTrigger:i,hasAnyEventConditions:l,automationStore:u}=e,p=u.getTrigger(),c=o.formatMessage(E.pageAddedCopy),d=o.formatMessage(E.recurrenceCopy),m=o.formatMessage(E.pagePropertiesEditedCopy),{hasAnyPageEditedTrigger:g,specificPropertyChangedFilters:C}=L(p),b=v().oE([g||!s().test(r,m)?void 0:{key:"any_property_edited",action:async()=>{const e=await async function(e){const{hasSpecificPropertyChangedFilters:t}=e;if(!t)return!0;return await x().Gh({message:(0,F.jsx)(f().sA,{id:"automations.eventTriggerMenu.replaceTriggerConfirmation.message",defaultMessage:"Replace other triggers?"}),description:(0,F.jsx)(f().sA,{id:"automations.eventTriggerMenu.replaceTriggerConfirmation.description",defaultMessage:"Adding the 'Any property edited' trigger will replace all other property triggers."}),acceptLabel:(0,F.jsx)(f().sA,{id:"automations.eventTriggerMenu.replaceTriggerConfirmation.acceptLabel",defaultMessage:"Replace"})}).then((e=>e.accept))}({hasSpecificPropertyChangedFilters:C.length>0});e&&(a.addAnyPropertyEditedTrigger(),a.closeMenu())},render:e=>(0,F.jsx)(S().A,{...e,icon:(0,y().r)(n.propertyIcon),title:m})},!i&&s().test(r,c)?{key:"page_added",action(){a.addPageAddedTrigger(),a.closeMenu()},render:e=>(0,F.jsx)(S().A,{...e,icon:(0,h().W)(n.propertyIcon),title:c})}:void 0,!l&&s().test(r,d)?D({actions:a,environment:t,automationStore:u}):void 0]);return b.length>0?{key:"event_section",items:b,render:e=>(0,F.jsx)(A().A,{...e,title:(0,F.jsx)(f().sA,{id:"automationEventTriggerMenu.eventSection.title",defaultMessage:"Event"})})}:void 0}({environment:J,intl:k,searchInput:O,actions:I,styles:Z,hasPageAddedTrigger:z,hasAnyEventConditions:X,automationStore:i})),[z,X,k,I,O,Z,J,i]),re=(0,_().X)("automation_relative_date_trigger"),ne=(0,n().K8)((()=>function(e){const{automationTriggerValue:t,automationTriggerMenuStore:o,showTopBorder:r,properties:n,collectionSchema:i,theme:s,actions:l,isRelativeDateTriggerEnabled:u}=e,{specificPropertyChangedFilters:c}=L(t),g=n.map((e=>{if(!c.find((t=>t.property===e)))return function(e){const{automationTriggerMenuStore:t,propertyId:o,collectionSchema:r,theme:n,actions:a,isRelativeDateTriggerEnabled:i}=e,s=r[o];if(!s)return;const l=(0,p().nq)(s),u=i&&"date"===s.type;return{key:o,action:()=>{u||(l?t.pushSettingsItem({type:"propertyChangedFilter",property:o}):(a.addPropertyTrigger({property:o,filter:{operator:"changes_to_any"}}),a.closeMenu()))},render:(e,t)=>u?(0,F.jsx)(K,{menuListItemProps:e,propertySchema:s,propertyId:o,actions:a,parent:t}):(0,F.jsx)(S().A,{...e,icon:(0,F.jsx)(d().Ay,{icon:s.icon,type:s.type,size:16,theme:n,style:{overflow:"visible"}}),title:s.name,right:l?(0,m().V)({marginLeft:6,width:12,height:"auto",color:n.icon.secondary}):void 0})}}({propertyId:e,collectionSchema:i,theme:s,automationTriggerMenuStore:o,actions:l,isRelativeDateTriggerEnabled:u})})).filter(a().O9);if(0===g.length)return;return{key:"property_section",items:g,render:e=>(0,F.jsx)(A().A,{...e,topBorder:r,title:(0,F.jsx)(f().sA,{id:"automationEventTriggerMenu.pagePropertiesEditedSection.title",defaultMessage:"Property"})})}}({automationTriggerValue:Y,automationTriggerMenuStore:t,showTopBorder:Boolean(oe),properties:G,collectionSchema:U,theme:M,actions:I,isRelativeDateTriggerEnabled:re})),[Y,t,oe,G,U,M,I,re]),ae=r.useMemo((()=>{const e=[oe,ne].filter(a().O9);return 0===e.length?[{key:"none",items:[{key:"none-item",action:()=>{},render:e=>(0,F.jsx)(S().A,{...e,disabled:!0,disabledFeedback:!0,title:(0,F.jsx)(f().sA,{id:"automations.eventTriggerMenu.noResultsItem",defaultMessage:"No results"})})}],render:e=>(0,F.jsx)(A().A,{...e})}]:e}),[oe,ne]);return(0,F.jsx)(b().A,{...Q,header:te,children:(0,F.jsx)(T().Ay,{type:T().Oh.Vertical,sections:ae,initialFocus:0})})}function B(){return(0,u().IS)((e=>({propertyIcon:{width:16,height:16,color:e.mediumIconColor}})),[])}function D(e){const{actions:t,environment:o,automationStore:r}=e,n=(0,I().V)({environment:o,automationStore:r,triggerType:"recurrence"});return{key:"recurrence",action(){n?t.addEmptyRecurrenceTrigger():V().K(o,{upsell:{type:"product",product:"plus",limit:{type:"none"}},from:"recurrence_automation"}),t.closeMenu()},render:e=>(0,F.jsx)(W,{...e,automationStore:r})}}const W=r.forwardRef((function(e,t){var r;const{automationStore:a,...i}=e,s=B(),p=(0,u().IS)((()=>({wrap:{display:"flex",alignItems:"center"},upsellWrap:{marginLeft:6}})),[]),c=(0,l().v3)(),d=(0,n().K8)((()=>(0,I().V)({triggerType:"recurrence",automationStore:a,environment:c})),[a,c]),{spaceId:m,userId:g}=(0,n().K8)((()=>{var e;return{spaceId:a.getSpaceId(),userId:null===(e=o(351360).default.state.currentUserStore)||void 0===e?void 0:e.id}}),[a]),y=null===(r=(0,o(597898)._X)({name:"premium_automations",spaceId:m,userId:g}))||void 0===r?void 0:r.upsell;return(0,F.jsx)(S().A,{...i,ref:t,icon:(0,o(643381).l)(s.propertyIcon),title:(0,F.jsxs)("div",{style:p.wrap,children:[(0,F.jsx)(f().sA,{...E.recurrenceCopy}),d?(0,F.jsx)(o(147294).E,{newBadgeKey:"generalized_recurrence_automations",didUserEngage:!1}):y?(0,F.jsx)("div",{style:p.upsellWrap,children:(0,F.jsx)(o(112698).B,{upsell:y,analyticsName:"recurrence_automation"})}):null]})})}));function L(e){let t=!1,o=[];return"event"===(null==e?void 0:e.type)&&(t="any"===e.event.pagePropertiesEdited.type,t||("some"===e.event.pagePropertiesEdited.type?o=e.event.pagePropertiesEdited.some||[]:"all"===e.event.pagePropertiesEdited.type&&(o=e.event.pagePropertiesEdited.all||[]))),{hasAnyPageEditedTrigger:t,specificPropertyChangedFilters:o}}function K(e){const{propertyId:t,propertySchema:o,menuListItemProps:r,actions:n,parent:a}=e,i=(0,u().DP)();return(0,F.jsx)(M().A,{...r,onFocus:a.onFocus,alignmentToOrigin:k().C1.Start,renderOrigin:(e,t)=>(0,F.jsx)(S().A,{...e,ref:t,icon:(0,F.jsx)(d().Ay,{icon:o.icon,type:o.type,size:16,theme:i,style:{overflow:"visible"}}),title:o.name,right:(0,m().V)({marginLeft:6,width:12,height:"auto",color:i.icon.secondary})}),renderExtension:(e,o)=>(0,F.jsx)(b().A,{...e,menuType:P().gu.Popup,children:(0,F.jsx)(T().Ay,{initialFocus:0,type:T().Oh.Vertical,sections:[{key:"section",render:e=>(0,F.jsx)(A().A,{...e}),items:[{key:"occurs",action:()=>{n.addRelativeDateTrigger({propertyId:t}),n.closeMenu()},render:e=>(0,F.jsx)(S().A,{...e,icon:(0,g().y)({width:20,height:20,color:i.icon.secondary}),title:"Occurs"})},{key:"is_edited",action:()=>{n.addPropertyTrigger({property:t,filter:{operator:"changes_to_any"}}),n.closeMenu()},render:e=>(0,F.jsx)(S().A,{...e,icon:(0,y().r)({width:16,height:16,color:i.icon.secondary}),title:"Is edited"})}]}]})})})}var H=()=>o(289915),U=()=>o(253809);function Y(e){const{propertyId:t,automationTriggerMenuStore:o,propertySchema:a,propertyChangedFilter:i,onClose:s}=e,{updatePropertyTrigger:l}=(0,N().p)(),u=(0,n().K8)((()=>"changes_to_any"===i.operator?[{type:"exact",value:!0},{type:"exact",value:!1}]:(0,H().Ui)(i)&&(0,H().gc)(i)?Array.isArray(i.value)?i.value:[i.value]:[]),[i]),[p,c]=(0,r.useState)(u),d=(0,r.useMemo)((()=>1===p.length?{operator:"checkbox_is",value:p[0]}:{operator:"changes_to_any"}),[p]),m=(0,r.useMemo)((()=>2===p.length||1===p.length&&"partial"),[p]),g=(0,r.useCallback)((e=>{const t=Boolean(p.find((t=>t.value===e)));c(t?p.filter((t=>t.value!==e)):[...p,{type:"exact",value:e}])}),[p]),y=(0,r.useCallback)((()=>{l({anyOptionCheckState:m,propertyId:t,currentFilter:d}),s()}),[m,d,s,t,l]),h=Boolean(p.find((e=>!0===e.value))),v=Boolean(p.find((e=>!1===e.value)));return(0,F.jsx)(U().A,{type:"default",automationTriggerActionMenuStore:o,onDone:y,onClose:s,sections:[{key:"select",render:e=>(0,F.jsx)(A().A,{...e,topBorder:!0}),items:[{key:"unchecked",render:e=>(0,F.jsx)(S().A,{...e,checkState:v,isTokenTitle:!0,title:(0,F.jsx)(f().sA,{defaultMessage:"Unchecked",id:"automations.propertyTrigger.checkbox.unchecked"})}),action:()=>g(!1)},{key:"checked",render:e=>(0,F.jsx)(S().A,{...e,checkState:h,isTokenTitle:!0,title:(0,F.jsx)(f().sA,{defaultMessage:"Checked",id:"automations.propertyTrigger.checkbox.checked"})}),action:()=>g(!0)}]}],headerTitle:(0,F.jsx)(f().sA,{id:"automations.propertyTrigger.checkbox.title",defaultMessage:"{propertyName} set to",values:{propertyName:a.name}})})}var z=()=>o(310109),q=()=>o(713998),$=()=>o(284371),G=()=>o(859428),X=()=>o(574299),Z=()=>o(500861);function Q(e){let{handleSelectOperator:t,selectedItem:o}=e;const r=(0,l().Y0)(),n=(0,u().IS)((e=>({buttonStyle:{fontSize:r.isMobile?16:12,height:20,lineHeight:"unset",marginRight:0,paddingLeft:2,paddingRight:2,textTransform:"lowercase",color:r.isMobile?e.accentColors.gray[900]:e.accentColors.gray[500]}})),[r.isMobile]);return(0,F.jsx)(Z().A,{style:{height:20},innerButtonStyle:n.buttonStyle,selectedTitle:(0,F.jsx)(f().sA,{...o.text}),renderMenuSections:e=>[{key:"selectNumberOperator",render:e=>(0,F.jsx)(A().A,{...e}),items:Object.values(X().$R).map((o=>({key:o.value,action:()=>{t(o),e.close()},render:e=>(0,F.jsx)(S().A,{...e,title:(0,F.jsx)(f().sA,{...o.text})})})))}]})}var J=()=>o(7868),ee=()=>o(962730),te=()=>o(546461);function oe(e){let{automationTriggerMenuStore:t,onClose:o,propertyChangedFilter:i,propertySchema:s,propertyId:l,shouldUseDefaultPropertyOperator:p}=e;const c=(0,r.useMemo)((()=>{if(p)return"number"===s.type?"number_equals":"changes_to_any"}),[s.type,p]),d=(0,n().K8)((()=>{if("changes_to_any"!==i.operator&&(0,H().My)(i)&&"is_empty"!==i.operator)return(0,H().gc)(i)?i.value.value:void 0}),[i]),[m,g]=(0,r.useState)((0,X().Qy)(c||i.operator)),[y,h]=(0,r.useState)(d),f=(0,r.useMemo)((()=>{if((0,a().O9)(y))return{type:"simple",value:(0,q().hk)(y)}}),[y]),{updatePropertyTrigger:v}=(0,N().p)(),{typecheckResult:x,automationStore:S}=(0,te().EC)(),C=(0,r.useMemo)((()=>(0,z().getAllContextValues)(x)),[x]),b=(0,r.useCallback)((e=>{const t=(0,q().Me)(null==e?void 0:e.value);h(t)}),[]),T=(0,r.useCallback)((e=>{g(e.value),X().$R[e.value].hasInput||h(void 0)}),[]),M=(0,r.useCallback)((()=>{const e=(0,a().O9)(y)?{operator:m,value:{type:"exact",value:y}}:{operator:"is_empty"};let t="partial";"changes_to_any"===m?t=!0:"is_empty"===m&&(t=!1),v({anyOptionCheckState:t,propertyId:l,currentFilter:e,propertySchema:s}),o()}),[m,y,o,l,s,v]),k=X().$R[m],j=(0,u().IS)((e=>({header:{display:"grid",gridTemplateColumns:"auto auto",gridGap:"4px",alignItems:"center"},propertyName:{...$().RC},input:{marginTop:"2px"}})),[]),{headerDiv:P}=(0,J().A)({currentSimpleFormulaValueTokens:[],formulaTypecheckContextValues:C,onChange:b,onClose:M,value:f,parentRecordStore:S});return(0,F.jsx)(U().A,{type:"custom",automationTriggerActionMenuStore:t,onDone:M,onClose:o,headerTitle:(0,F.jsxs)("div",{style:j.header,children:[(0,F.jsx)(G().A,{placement:ee().W.Bottom,render:e=>(0,F.jsx)("div",{...e,style:j.propertyName,children:s.name}),renderTooltip:()=>s.name}),(0,F.jsx)(Q,{selectedItem:k,handleSelectOperator:T})]}),subHeaderComponent:k.hasInput&&(0,F.jsx)(A().A,{children:P}),customMenuProps:{leftOuterStyle:{flex:"unset"},rightOuterStyle:{flex:"unset"},titleOuterStyle:{flex:"unset"},topbarStyle:{justifyContent:"space-between"}}})}var re=()=>o(791089),ne=()=>o(187174),ae=()=>o(625830);const ie=["person_contains","person_does_not_contain","is_empty","changes_to_any"];const se=(0,f().YK)({changesToAny:{id:"automations.propertyTrigger.personField.changesToAnyOption",defaultMessage:"Is edited"},isEmpty:{id:"automations.propertyTrigger.personField.isEmpty",defaultMessage:"Is cleared"},personContains:{id:"automations.propertyTrigger.personField.personContainsOption",defaultMessage:"Contains"},personDoesNotContain:{id:"automations.propertyTrigger.personField.personDoesNotContainOption",defaultMessage:"Does not contain"}}),le={person_contains:{hasInput:!0,text:se.personContains,labelText:se.personContains,value:"person_contains"},person_does_not_contain:{hasInput:!0,labelText:se.personDoesNotContain,text:se.personDoesNotContain,value:"person_does_not_contain"},changes_to_any:{hasInput:!1,text:se.changesToAny,labelText:se.changesToAny,value:"changes_to_any"},is_empty:{hasInput:!1,labelText:se.isEmpty,text:se.isEmpty,value:"is_empty"}};function ue(e){let{handleSelectOperator:t,selectedItem:o}=e;const r=(0,l().Y0)(),n=(0,u().IS)((e=>({buttonStyle:{fontSize:r.isMobile?16:12,height:20,lineHeight:"unset",marginRight:0,paddingLeft:2,paddingRight:2,textTransform:"lowercase",color:r.isMobile?e.accentColors.gray[900]:e.accentColors.gray[500]}})),[r.isMobile]);return(0,F.jsx)(Z().A,{style:{height:20},innerButtonStyle:n.buttonStyle,selectedTitle:(0,F.jsx)(f().sA,{...o.text}),renderMenuSections:e=>[{key:"selectPersonOperator",render:e=>(0,F.jsx)(A().A,{...e}),items:Object.values(le).map((o=>({key:o.value,action:()=>{t(o),e.close()},render:e=>(0,F.jsx)(S().A,{...e,title:(0,F.jsx)(f().sA,{...o.text})})})))}]})}var pe=()=>o(294852),ce=()=>o(106628),de=()=>o(361330);function me(e){var t,o;let{automationTriggerMenuStore:i,collectionStore:s,onClose:p,propertyChangedFilter:c,propertySchema:d,propertyId:m,shouldUseDefaultPropertyOperator:g}=e;const y=(0,r.useMemo)((()=>{if(g&&"person"===d.type)return"person_contains"}),[d.type,g]),h=(0,n().K8)((()=>{if("changes_to_any"!==c.operator)return(0,H().I_)(c)&&"is_empty"!==c.operator&&(0,H().gc)(c)?(0,H().Wf)(c):[]}),[c]),[v,x]=(0,r.useState)((()=>{if(h){const e=h.map((e=>{if("exact"===e.type)return e.value})).filter(a().O9);return{action:"replace",value:{type:"simple",value:(0,q().AH)(e)}}}})),[C,b]=(0,r.useState)(function(e){const t=e;return ie.includes(t)?t:"person_contains"}(y||c.operator)),T=(0,l().v3)(),M=(0,l().Y0)(),[k]=(0,ne().Yb)((async()=>{const e=await ce().T.searchActions.load();return(await e.searchVisibleSpaceUsers({environment:T,query:"",membersOnly:!1})).length}),[T],{debounce:de().tu}),j=(0,r.useRef)(),P=(0,r.useRef)(),[_,V]=(0,r.useState)(!h),I=(0,r.useMemo)((()=>{var e;return(0,re().fromSimpleFormulaArrayValue)(null==v||null===(e=v.value)||void 0===e?void 0:e.value)}),[null==v||null===(t=v.value)||void 0===t?void 0:t.value]),w=(0,n().K8)((()=>{var e;return function(e){const{formulaValue:t,allChecked:o,numTotalActors:r}=e;if(t&&t.length>0){return(0,re().fromSimpleFormulaArrayValue)(t).length===r||"partial"}if(o)return!0;return!1}({propertySchema:d,formulaValue:null==v||null===(e=v.value)||void 0===e?void 0:e.value,allChecked:_,numTotalActors:k.value||0})}),[d,null==v||null===(o=v.value)||void 0===o?void 0:o.value,_,k.value]),{typecheckResult:R,automationStore:E}=(0,te().EC)(),O=(0,r.useMemo)((()=>({collectionStore:s,property:m,type:"collection"})),[s,m]),B=(0,r.useMemo)((()=>(0,z().getAllContextValues)(R)),[R]),{updatePropertyTrigger:D}=(0,N().p)(),W=(0,r.useCallback)((()=>{const e=j.current||(null==v?void 0:v.value),t=P.current||C,o=e?(0,q().e5)({textValue:null==e?void 0:e.value,propertySchema:d,blockCreatorPointer:void 0}):void 0,r=o&&0!==o.length?{operator:t,value:o.map((e=>({type:"exact",value:e})))}:{operator:"person_contains"===t&&_?"changes_to_any":"is_empty"};let n="partial";"changes_to_any"===t?n=!0:"is_empty"===t&&(n=!1),D({anyOptionCheckState:n,propertyId:m,currentFilter:r,propertySchema:d}),p()}),[null==v?void 0:v.value,C,d,_,D,m,p]),L=(0,r.useCallback)((e=>{j.current=e,x({action:"replace",value:e}),1===d.limit&&W()}),[W,d.limit]),K=(0,r.useCallback)((()=>{w?(V(!1),I.length>0&&L(void 0)):V(!0)}),[w,I.length,L]),Y=(0,r.useCallback)((e=>{P.current=e.value,b(e.value),le[e.value].hasInput||L(void 0)}),[L]),X=le[C],Z=(0,u().IS)((e=>({header:{display:"flex",gap:"4px",alignItems:"center"},propertyName:{...$().RC}})),[]),Q=X.hasInput,J=!_||I.length>0,{headerDiv:oe,innerComponents:se}=(0,pe().A)({currentSimpleFormulaValueTokens:I,formulaTypecheckContextValues:B,formulaValueContext:O,isDisabled:!J,limit:void 0,onChange:L,onClose:p,showClearButton:!0,showGenericHeader:!1,showInputMenuItem:!0,value:null==v?void 0:v.value,parentRecordStore:E});if(!O)return null;const me=[X.hasInput?{key:"any",items:[{key:"any-option-item",action:K,render:e=>(0,F.jsxs)(F.Fragment,{children:[oe,(0,F.jsx)(S().A,{onClick:K,focused:!0,icon:(0,F.jsx)(ae().A,{checked:w,size:14,onClick:K}),title:(0,F.jsx)(f().sA,{id:"automationEventTriggerPropertyChangedFilterMenu.anyOption.title",defaultMessage:"Any option"})})]})}],render:e=>(0,F.jsx)(A().A,{...e,topBorder:!1})}:void 0,Q?{key:"inner-components",items:[{key:"inner-components-item",action:K,render:e=>se}],render:e=>M.isMobile?se:(0,F.jsx)(A().A,{...e,topBorder:!0})}:void 0].filter(a().O9);return(0,F.jsx)(U().A,{type:"default",automationTriggerActionMenuStore:i,onDone:W,onClose:p,headerTitle:(0,F.jsxs)("div",{style:Z.header,children:[(0,F.jsx)(G().A,{placement:ee().W.Bottom,render:e=>(0,F.jsx)("div",{...e,style:Z.propertyName,children:d.name}),renderTooltip:()=>d.name}),(0,F.jsx)(ue,{selectedItem:X,handleSelectOperator:Y})]}),sections:me,customMenuProps:{leftOuterStyle:{flex:"unset"},rightOuterStyle:{flex:"unset"},titleOuterStyle:{flex:"unset"},topbarStyle:{justifyContent:"space-between"}}})}var ge=()=>o(696706),ye=()=>o(179034);const he=["relation_contains","relation_does_not_contain","is_empty","changes_to_any"];const fe=(0,f().YK)({changesToAny:{id:"automations.propertyTrigger.relationOperator.changesToAnyOption",defaultMessage:"Is edited"},isEmpty:{id:"automations.propertyTrigger.relationOperator.isEmpty",defaultMessage:"Is cleared"},relationContains:{id:"automations.propertyTrigger.relationOperator.relationContainsOption",defaultMessage:"Contains"},relationDoesNotContain:{id:"automations.propertyTrigger.relationOperator.relationDoesNotContain",defaultMessage:"Does not contain"}}),ve={relation_contains:{hasInput:!0,labelText:fe.relationContains,text:fe.relationContains,value:"relation_contains"},relation_does_not_contain:{hasInput:!0,labelText:fe.relationDoesNotContain,text:fe.relationDoesNotContain,value:"relation_does_not_contain"},changes_to_any:{hasInput:!1,text:fe.changesToAny,labelText:fe.changesToAny,value:"changes_to_any"},is_empty:{text:fe.isEmpty,labelText:fe.isEmpty,value:"is_empty",hasInput:!1}};function xe(e){let{handleSelectOperator:t,selectedItem:o}=e;const r=(0,l().Y0)(),n=(0,u().IS)((e=>({buttonStyle:{fontSize:r.isMobile?16:12,height:20,lineHeight:"unset",marginRight:0,paddingLeft:2,paddingRight:2,textTransform:"lowercase",color:r.isMobile?e.accentColors.gray[900]:e.accentColors.gray[500]}})),[r.isMobile]);return(0,F.jsx)(Z().A,{style:{height:20},innerButtonStyle:n.buttonStyle,selectedTitle:(0,F.jsx)(f().sA,{...o.text}),renderMenuSections:e=>[{key:"selectRelationOperator",render:e=>(0,F.jsx)(A().A,{...e}),items:Object.values(ve).map((o=>({key:o.value,action:()=>{t(o),e.close()},render:e=>(0,F.jsx)(S().A,{...e,title:(0,F.jsx)(f().sA,{...o.text})})})))}]})}var Se=()=>o(621314);function Ce(e){var t;let{automationTriggerMenuStore:o,collectionStore:i,onClose:s,propertyChangedFilter:l,propertySchema:p,propertyId:c,shouldUseDefaultPropertyOperator:d}=e;const m=(0,r.useMemo)((()=>{if(d)return"relation"===p.type?"relation_contains":"changes_to_any"}),[p.type,d]),g=(0,n().K8)((()=>"changes_to_any"===l.operator?[]:(0,H().Pq)(l)&&"is_empty"!==l.operator&&(0,H().gc)(l)?(0,H().Rh)(l):[]),[l]),y=(0,n().K8)((()=>{if(i&&p)return(0,re().setPropertyValueToSimpleFormulaReturnType)(i.getSpaceShardedPointer(),c,p)}),[i,p,c]),h=(0,n().K8)((()=>i.getSpaceId()),[i]),[f,v]=(0,r.useState)(function(e){const t=e;return he.includes(t)?t:"relation_contains"}(m||l.operator)),[x,S]=(0,r.useState)((()=>{const e=g.map((e=>{if(e.value&&"string"==typeof e.value)return ge().L3.fromSpaceShardRecordId({id:e.value,spaceId:h},ye().ev)})).filter(a().O9);return{action:"replace",value:{type:"simple",value:(0,q().Ap)(e)}}})),C=(0,r.useMemo)((()=>{var e;return(0,re().fromSimpleFormulaArrayValue)(null==x||null===(e=x.value)||void 0===e?void 0:e.value)}),[null==x||null===(t=x.value)||void 0===t?void 0:t.value]),b=(0,r.useRef)(),{updatePropertyTrigger:T}=(0,N().p)(),{typecheckResult:M,automationStore:k}=(0,te().EC)(),j=(0,r.useMemo)((()=>({collectionStore:i,property:c,type:"collection"})),[i,c]),P=(0,r.useMemo)((()=>(0,z().getAllContextValues)(M)),[M]),_=(0,r.useCallback)((e=>{v(e.value),ve[e.value].hasInput||S(void 0)}),[]),V=ve[f],I=(0,r.useCallback)((()=>{const e=b.current||(null==x?void 0:x.value),t=(0,a().O9)(null==e?void 0:e.value)?(0,q().n)(null==e?void 0:e.value):void 0,o=t&&0!==t.length?{operator:V.value,value:t.map((e=>({type:"exact",value:e.id})))}:{operator:"is_empty"};T({anyOptionCheckState:"changes_to_any"===V.value,currentFilter:o,propertyId:c,propertySchema:p}),s()}),[null==x?void 0:x.value,s,c,p,V.value,T]),w=(0,r.useCallback)((e=>{b.current=e,S({action:"replace",value:e}),1===p.limit&&I()}),[I,p.limit]),R=(0,u().IS)((e=>({header:{display:"grid",gridTemplateColumns:"auto auto",gridGap:"2px",alignItems:"center"},propertyName:{...$().RC},input:{marginTop:"2px"}})),[]),{headerDiv:E,innerComponents:O}=(0,Se().A)({currentSimpleFormulaValueTokens:C,formulaTypecheckContextValues:P,formulaValueContext:j,onChange:w,onClose:s,showClearButton:!0,showInputMenuItem:!0,collection:"block_array"===(null==y?void 0:y.type)?y.collection:void 0,value:null==x?void 0:x.value,parentRecordStore:k});return(0,F.jsx)(U().A,{type:"custom",automationTriggerActionMenuStore:o,onDone:I,onClose:s,headerTitle:(0,F.jsxs)("div",{style:R.header,children:[(0,F.jsx)(G().A,{placement:ee().W.Bottom,render:e=>(0,F.jsx)("div",{...e,style:R.propertyName,children:p.name}),renderTooltip:()=>p.name}),(0,F.jsx)(xe,{selectedItem:V,handleSelectOperator:_})]}),subHeaderComponent:V.hasInput&&(0,F.jsx)(A().A,{children:E}),customMenuProps:{leftOuterStyle:{flex:"unset"},rightOuterStyle:{flex:"unset"},titleOuterStyle:{flex:"unset"},topbarStyle:{justifyContent:"space-between"}},children:V.hasInput&&O})}var be=()=>o(784892),Te=()=>o(859794);const Ae=["enum_contains","enum_does_not_contain","enum_is","enum_is_not","is_empty","changes_to_any"];const Me=(0,f().YK)({changesToAny:{id:"automations.propertyTrigger.selectOperator.changesToAnyOption",defaultMessage:"Is edited"},isEmpty:{id:"automations.propertyTrigger.selectOperator.isEmpty",defaultMessage:"Is cleared"},enumContains:{id:"automations.propertyTrigger.selectOperator.enumContainsOption",defaultMessage:"Contains"},enumDoesNotContain:{id:"automations.propertyTrigger.selectOperator.enumDoesNotContain",defaultMessage:"Does not contain"},enumIs:{id:"automations.propertyTrigger.selectOperator.enumIs",defaultMessage:"Is"},enumIsNot:{id:"automations.propertyTrigger.selectOperator.enumIsNot",defaultMessage:"Is not"}}),ke={enum_contains:{hasInput:!0,isMulti:!0,isSingle:!1,labelText:Me.enumContains,text:Me.enumContains,value:"enum_contains"},enum_does_not_contain:{hasInput:!0,isMulti:!0,isSingle:!1,labelText:Me.enumDoesNotContain,text:Me.enumDoesNotContain,value:"enum_does_not_contain"},enum_is:{hasInput:!0,isMulti:!1,isSingle:!0,labelText:Me.enumIs,text:Me.enumIs,value:"enum_is"},enum_is_not:{hasInput:!0,isMulti:!1,isSingle:!0,labelText:Me.enumIsNot,text:Me.enumIsNot,value:"enum_is_not"},changes_to_any:{hasInput:!1,isMulti:!0,isSingle:!0,labelText:Me.changesToAny,text:Me.changesToAny,value:"changes_to_any"},is_empty:{hasInput:!1,isMulti:!0,isSingle:!0,labelText:Me.isEmpty,text:Me.isEmpty,value:"is_empty"}};function je(e){let{handleSelectOperator:t,selectedItem:o,type:n}=e;const a=(0,l().Y0)(),i=(0,u().IS)((e=>({buttonStyle:{fontSize:a.isMobile?16:12,height:20,lineHeight:"unset",marginRight:0,paddingLeft:2,paddingRight:2,textTransform:"lowercase",color:a.isMobile?e.accentColors.gray[900]:e.accentColors.gray[500]}})),[a.isMobile]),s=(0,r.useMemo)((()=>{const e="multi_select"===n,t="select"===n;return Object.values(ke).filter((o=>e?o.isMulti:t?o.isSingle:void 0))}),[n]);return(0,F.jsx)(Z().A,{style:{height:20},innerButtonStyle:i.buttonStyle,selectedTitle:(0,F.jsx)(f().sA,{...o.text}),renderMenuSections:e=>[{key:"selectSelectOperator",render:e=>(0,F.jsx)(A().A,{...e}),items:s.map((o=>({key:o.value,action:()=>{t(o),e.close()},render:e=>(0,F.jsx)(S().A,{...e,title:(0,F.jsx)(f().sA,{...o.text})})})))}]})}var Pe=()=>o(399762),_e=()=>o(856952);function Ve(e){const{automationTriggerMenuStore:t,onClose:o,propertyChangedFilter:i,propertyId:s,propertySchema:p,shouldUseDefaultPropertyOperator:c}=e,{isMobile:d,isAndroid:m}=(0,l().Y0)(),g=(0,f().tz)(),{updatePropertyTrigger:y}=(0,N().p)(),h=(0,r.useMemo)((()=>{if(c)return"select"===p.type?"enum_is":"multi_select"===p.type?"enum_contains":"changes_to_any"}),[p.type,c]),x=(0,n().K8)((()=>{if("changes_to_any"===i.operator){return(p.options??[]).map((e=>({type:"exact",value:e.value})))}if(!(0,H().v0)(i)&&!(0,H().as)(i))return[];if((0,H().gc)(i)){const e=(p.options??[]).map((e=>e.value));return(Array.isArray(i.value)?i.value:[i.value]).filter((t=>(0,a().O9)(t.value)&&e.includes(t.value)))}return[]}),[p,i]),[C,b]=r.useState(x),[T,M]=(0,r.useState)(function(e){const t=e;return Ae.includes(t)?t:"enum_contains"}(h||i.operator)),k=(0,r.useCallback)((e=>{M(e.value)}),[]),j=ke[T],P=(0,n().K8)((()=>function(e){const{propertySchema:t,selectedOptions:o}=e;let r=!1,n=!0;const a=t.options??[];for(const i of a){const e=o.some((e=>e.value===i.value));r||=e,n&&=e}return!!n||!!r&&"partial"}({propertySchema:p,selectedOptions:C})),[p,C]),_=r.useMemo((()=>(p.options??[]).map((e=>({type:"exact",value:e.value})))),[p]),V=!0===P?[]:C.map((e=>{if(!e.value||!p.options)return;const t=(0,q().jy)(p.options,e.value);return t?(0,F.jsx)(Pe().O,{format:d?be().NY.Large:be().NY.Small,isSingle:!1,value:t.value,color:t.color,showRemoveButton:!0,onClickRemove:()=>{const t=v().FF(C,e);b(t)}},t.id):void 0})),[I,w]=r.useState(""),R=(0,Te().r9)({query:I,propertySchema:p,selectedValues:C,updateValue:e=>{w(""),b(e)},isMobile:d,styles:{},isFormEditorView:!1}),E=(0,u().IS)((e=>({header:{display:"grid",gridTemplateColumns:"auto auto",gridGap:"2px",alignItems:"center"},propertyName:{...$().RC}})),[]),O=(0,r.useCallback)((()=>{let e,t="partial";if("changes_to_any"===T)t=!0,e={operator:T};else if("is_empty"===T)t=!1,e={operator:T};else{const o=Array.isArray(C)?C:[C];0===o.length?(t=!1,e={operator:"is_empty"}):e={operator:T,value:o}}y({anyOptionCheckState:t,propertyId:s,currentFilter:e,propertySchema:p}),o()}),[o,s,p,T,C,y]),B=[{key:"search",items:[{key:"input",action:()=>{},render:e=>(0,F.jsx)("div",{style:{...!d&&{paddingTop:0,paddingRight:8,paddingBottom:4,paddingLeft:8}},children:(0,F.jsx)(_e().Ay,{...e,focusInitial:!0,onClick:void 0,focusAfterAnimation:!0,format:_e().le.FilterValue,tokens:V,placeholder:P?g.formatMessage({defaultMessage:"Any option",id:"automations.selectPropertyChangedFilter.inputPlaceholder.anyOption"}):g.formatMessage({defaultMessage:"Select one or more options…",id:"automations.selectPropertyChangedFilter.inputPlaceholder.searchPlaceholder"}),onRemoveLastToken:()=>{const e=C.slice(0,C.length-1);b(e)},onClearButtonClick:()=>{b([])},value:I,onChange:e=>{w(e.target.value)},dontShowBorderBottom:m,showClearButton:!0})})}],render:e=>(0,F.jsx)(A().A,{...e})},{key:"any",items:[{key:"any-option-item",action:()=>{!0===P?b([]):!1===P||"partial"===P?b(_):(0,a().HB)(P),w("")},render:e=>(0,F.jsx)(S().A,{...e,icon:(0,F.jsx)(ae().A,{checked:P,size:14,onClick:e.onClick}),title:(0,F.jsx)(f().sA,{id:"automations.selectPropertyChangedFilter.anyOption.title",defaultMessage:"Any option"})})}],render:e=>(0,F.jsx)(A().A,{...e,topBorder:!0})},R.length>0?{key:"items",items:R,render:e=>(0,F.jsx)(A().A,{...e,topBorder:!0})}:void 0].filter(a().O9);return(0,F.jsx)(U().A,{type:"default",automationTriggerActionMenuStore:t,onDone:O,onClose:o,sections:j.hasInput?B:[],headerTitle:(0,F.jsxs)("div",{style:E.header,children:[(0,F.jsx)(G().A,{placement:ee().W.Bottom,render:e=>(0,F.jsx)("div",{...e,style:E.propertyName,children:p.name}),renderTooltip:()=>p.name}),(0,F.jsx)(je,{handleSelectOperator:k,selectedItem:j,type:p.type})]}),customMenuProps:{leftOuterStyle:{flex:"unset"},rightOuterStyle:{flex:"unset"},titleOuterStyle:{flex:"unset"},topbarStyle:{justifyContent:"space-between"}}})}o(823215);var Ie=()=>o(378864),we=()=>o(873050);function Re(e){const{propertyId:t,automationTriggerMenuStore:o,propertySchema:i,propertyChangedFilter:s,onClose:u}=e,{isMobile:p}=(0,l().Y0)(),{updatePropertyTrigger:c}=(0,N().p)(),d=(0,n().K8)((()=>{if("changes_to_any"===s.operator){return(i.groups??[]).map((e=>({type:"is_group",value:e.name})))}return(0,H().H$)(s)&&(0,H().gc)(s)?(0,H().V6)(s):[]}),[i,s]),[m,g]=r.useState(d),y=(0,n().K8)((()=>function(e){const{propertySchema:t,selectedStatusOptions:o}=e,r=t.groups??[],n=t.options??[],a=r.map((e=>(0,we().Ze)({group:e,options:n,filterValues:o}))),i=a.every((e=>!0===e.groupCheckState)),s=a.some((e=>!1!==e.groupCheckState));return!!i||!!s&&"partial"}({propertySchema:i,selectedStatusOptions:m})),[i,m]),h=r.useMemo((()=>(i.groups??[]).map((e=>({type:"is_group",value:e.name})))),[i]),v=(0,Ie().T)({propertySchema:i,statusFilterValues:m,updateValue:e=>{g(e)},isMobile:p,styles:{},visibleOptions:i.options??[]}),x=(0,r.useCallback)((()=>{const e=0===m.length?{operator:"is_empty"}:{operator:"status_is",value:m};c({anyOptionCheckState:y,propertyId:t,currentFilter:e,propertySchema:i}),u()}),[y,u,t,i,m,c]);return(0,F.jsx)(U().A,{type:"default",automationTriggerActionMenuStore:o,onDone:x,onClose:()=>{u()},sections:[{key:"any",items:[{key:"any-option-item",action:()=>{!0===y?g([]):!1===y||"partial"===y?g(h):(0,a().HB)(y)},render:e=>(0,F.jsx)(S().A,{...e,icon:(0,F.jsx)(ae().A,{checked:y,size:14,onClick:e.onClick}),title:(0,F.jsx)(f().sA,{id:"automationEventTriggerPropertyChangedFilterMenu.anyOption.title",defaultMessage:"Any option"})})}],render:e=>(0,F.jsx)(A().A,{...e})},{key:"items",items:v,render:e=>(0,F.jsx)(A().A,{...e,topBorder:!0})}],headerTitle:(0,F.jsx)(f().sA,{id:"automations.propertyChangedFilterHeader.status.title",defaultMessage:"{propertyName} set to",values:{propertyName:i.name}}),customMenuProps:{leftOuterStyle:{flex:"unset"},rightOuterStyle:{flex:"unset"},titleOuterStyle:{flex:"unset"},topbarStyle:{justifyContent:"space-between"}}})}var Ne=()=>o(919709),Fe=()=>o(438873);function Ee(e){let{handleSelectOperator:t,selectedItem:o}=e;const r=(0,l().Y0)(),n=(0,u().IS)((e=>({buttonStyle:{fontSize:r.isMobile?16:12,height:20,lineHeight:"unset",marginRight:0,paddingLeft:2,paddingRight:2,textTransform:"lowercase",color:r.isMobile?e.accentColors.gray[900]:e.accentColors.gray[500]}})),[r.isMobile]);return(0,F.jsx)(Z().A,{style:{height:20},innerButtonStyle:n.buttonStyle,selectedTitle:(0,F.jsx)(f().sA,{...o.text}),renderMenuSections:e=>[{key:"selectTextOperator",render:e=>(0,F.jsx)(A().A,{...e}),items:Object.values(Fe().bK).map((o=>({key:o.value,action:()=>{t(o),e.close()},render:e=>(0,F.jsx)(S().A,{...e,title:(0,F.jsx)(f().sA,{...o.text})})})))}]})}var Oe=()=>o(277871);function Be(e){let{automationTriggerMenuStore:t,onClose:o,propertyChangedFilter:i,propertySchema:s,propertyId:l,shouldUseDefaultPropertyOperator:p}=e;const c=(0,r.useMemo)((()=>{if(p)return(0,q().DY)(s.type)?"string_is":"changes_to_any"}),[s.type,p]),d=(0,n().K8)((()=>{if("changes_to_any"!==i.operator&&(0,H().YH)(i)&&"is_empty"!==i.operator)return(0,H().gc)(i)?i.value.value:void 0}),[i]),[m,g]=(0,r.useState)((()=>(0,Fe().mK)(c||i.operator))),[y,h]=(0,r.useState)(d),f=(0,r.useMemo)((()=>{if(y)return{type:"simple",value:Ne().x9d(y)}}),[y]),{updatePropertyTrigger:v}=(0,N().p)(),{typecheckResult:x,automationStore:S}=(0,te().EC)(),C=(0,r.useMemo)((()=>(0,z().getAllContextValues)(x)),[x]),b=(0,r.useCallback)((e=>{const t=Ne().k4p(null==e?void 0:e.value);h(t.trim()?t:void 0)}),[]),T=(0,r.useCallback)((e=>{g(e.value),Fe().bK[e.value].hasInput||h(void 0)}),[]),M=(0,r.useCallback)((()=>{const e=(0,a().O9)(y)?{operator:m,value:{type:"exact",value:y}}:{operator:"is_empty"};let t="partial";"changes_to_any"===m?t=!0:"is_empty"===m&&(t=!1),v({anyOptionCheckState:t,propertyId:l,currentFilter:e,propertySchema:s}),o()}),[m,y,o,l,s,v]),k=Fe().bK[m],j=(0,u().IS)((e=>({header:{display:"grid",gridTemplateColumns:"auto auto",gridGap:"2px",alignItems:"center"},propertyName:{...$().RC}})),[]),{headerDiv:P}=(0,Oe().A)({currentSimpleFormulaValueTokens:[],disableEmojiCommands:!0,disableFormulas:!0,disableFormattingAndMentions:!0,disableMobileActionBar:!0,disableTemplateVariableMentions:!0,formulaTypecheckContextValues:C,onChange:b,onClose:M,value:f,parentRecordStore:S});return(0,F.jsx)(U().A,{type:"custom",automationTriggerActionMenuStore:t,onDone:M,onClose:o,headerTitle:(0,F.jsxs)("div",{style:j.header,children:[(0,F.jsx)(G().A,{placement:ee().W.Bottom,render:e=>(0,F.jsx)("div",{...e,style:j.propertyName,children:s.name}),renderTooltip:()=>s.name}),(0,F.jsx)(Ee,{selectedItem:k,handleSelectOperator:T})]}),subHeaderComponent:k.hasInput&&(0,F.jsx)(A().A,{children:P}),customMenuProps:{leftOuterStyle:{flex:"unset"},rightOuterStyle:{flex:"unset"},titleOuterStyle:{flex:"unset"},topbarStyle:{justifyContent:"space-between"}}})}function De(e){const{propertyId:t,automationTriggerMenuStore:o,onClose:r}=e,{automationStore:i,collectionStore:s}=(0,w().k)(),l=(0,n().K8)((()=>s.getSchema()),[s])[t],u=(0,n().K8)((()=>i.getTrigger()),[i]);let c=[];"event"===(null==u?void 0:u.type)&&("some"===u.event.pagePropertiesEdited.type?c=u.event.pagePropertiesEdited.some||[]:"all"===u.event.pagePropertiesEdited.type&&(c=u.event.pagePropertiesEdited.all||[]));const d=c.find((e=>e.property===t)),m=d??{property:t,filter:{operator:"changes_to_any"}};if(!l)return null;if(!(0,p().nq)(l))return null;const g=!(0,a().O9)(d);return"multi_select"===l.type||"select"===l.type?(0,F.jsx)(Ve,{automationTriggerMenuStore:o,onClose:r,propertyChangedFilter:m.filter,propertyId:t,propertySchema:l,shouldUseDefaultPropertyOperator:g}):"status"===l.type?(0,F.jsx)(Re,{propertyId:t,automationTriggerMenuStore:o,propertySchema:l,propertyChangedFilter:m.filter,onClose:r}):"checkbox"===l.type?(0,F.jsx)(Y,{automationTriggerMenuStore:o,onClose:r,propertyChangedFilter:m.filter,propertyId:t,propertySchema:l}):"person"===l.type?(0,F.jsx)(me,{automationTriggerMenuStore:o,collectionStore:s,onClose:r,propertyChangedFilter:m.filter,propertyId:t,propertySchema:l,shouldUseDefaultPropertyOperator:g}):"number"===l.type?(0,F.jsx)(oe,{automationTriggerMenuStore:o,onClose:r,propertyChangedFilter:m.filter,propertyId:t,propertySchema:l,shouldUseDefaultPropertyOperator:g}):"email"===l.type||"phone_number"===l.type||"text"===l.type||"title"===l.type||"url"===l.type?(0,F.jsx)(Be,{automationTriggerMenuStore:o,onClose:r,propertyChangedFilter:m.filter,propertyId:t,propertySchema:l,shouldUseDefaultPropertyOperator:g}):"relation"===l.type?(0,F.jsx)(Ce,{automationTriggerMenuStore:o,collectionStore:s,onClose:r,propertyChangedFilter:m.filter,propertyId:t,propertySchema:l,shouldUseDefaultPropertyOperator:g}):null}function We(e){const{initialState:t,buttonPopupParent:o}=e,s=(0,n().K8)((()=>{const e=new(i().AK);return e.setState({insertionPoint:void 0,stack:[t]}),e}),[t]),l=(0,n().K8)((()=>s.getCurrentTab()),[s]),u=(0,r.useCallback)((()=>o.close()),[o]);return l?"eventTriggers"===l.type?(0,F.jsx)(O,{automationTriggerMenuStore:s,onClose:u}):"propertyChangedFilter"===l.type?(0,F.jsx)(De,{propertyId:l.property,automationTriggerMenuStore:s,onClose:u}):(0,a().HB)(l):null}},967823:(e,t,o)=>{o.d(t,{w5:()=>m,zl:()=>g});o(296540);var r=()=>o(56366),n=()=>o(401497),a=()=>o(784892),i=()=>o(959013),s=()=>o(534177),l=()=>o(284371),u=()=>o(881690),p=()=>o(214973),c=()=>o(438873),d=o(474848);function m(e){const{textValue:t,operator:o,propertySchema:m,messageType:y}=e,h=(0,i().tz)(),f=(0,n().IS)((()=>({content:{alignItems:"center",display:"flex",flexWrap:"wrap",whiteSpace:"pre",lineHeight:1.6},propertyName:{...l().RC,fontWeight:l().Wy.medium},propertyValue:{...l().RC,paddingBlockStart:4}})),[]),v=(0,r().K8)((()=>function(e){const{textValue:t,operator:o,propertySchema:r,styles:n,messageType:l,intl:m}=e,g=(0,d.jsx)("span",{style:n.propertyName,children:r.name});let y;const h=m.formatMessage(c().bK[o].text).toLocaleLowerCase();"action"===l?y=p().$B({operator:h,propertyName:g,propertyValues:(0,d.jsx)(u().A,{format:a().NY.Medium,isRound:!0,isSingle:!0,value:t,showRemoveButton:!1})}):"trigger"===l?y=p().rh({operator:h,propertyName:g,propertyValues:(0,d.jsx)(u().A,{format:a().NY.Medium,isRound:!0,isSingle:!0,value:t,showRemoveButton:!1})}):(0,s().HB)(l);return(0,d.jsx)(i().sA,{...y})}({messageType:y,operator:o,propertySchema:m,styles:f,textValue:t,intl:h})),[y,t,o,m,f,h]);return{tooltipTitle:(0,r().K8)((()=>g({messageType:y,operator:o,propertySchema:m,textValue:t,intl:h})),[y,o,m,t,h]),title:v,styles:f}}function g(e){const{textValue:t,operator:o,propertySchema:r,messageType:n,intl:a}=e,l=r.name;let u;const m=a.formatMessage(c().bK[o].text).toLocaleLowerCase();return"action"===n?u=p().$B({operator:m,propertyName:l,propertyValues:t}):"trigger"===n?u=p().rh({operator:m,propertyName:l,propertyValues:t}):(0,s().HB)(n),(0,d.jsx)(i().sA,{...u})}},984714:(e,t,o)=>{o.d(t,{AJ:()=>v,CH:()=>x,Xl:()=>S,qR:()=>h,sF:()=>f,vu:()=>y});var r=o(296540),n=()=>o(56366),a=()=>o(401497),i=()=>o(959013),s=()=>o(406699),l=()=>o(963589),u=()=>o(962730),p=()=>o(463830),c=()=>o(656134),d=()=>o(630550),m=()=>o(217028),g=o(474848);function y(e){const{actionMenu:t,buttonPopupStore:o,disabled:r,onClick:n,propertySchema:i}=e,s=(0,l().X)("automation_updated_error_states"),p=(0,a().IS)((e=>({icon:{fill:e.text.uiRedPrimary},iconWrap:{...s&&{background:e.tint.uiRed,borderRadius:4}},propertyType:{color:e.accentColors.red[700]}})),[s]),c=v({propertySchema:i,styles:p,hasAutomationUpdatedErrorStatesEnabled:s}),d=x({propertySchema:i,hasAutomationUpdatedErrorStatesEnabled:s});return(0,g.jsx)(m().z$,{actionMenu:t,buttonPopupStore:o,disabled:r,onClick:n,propertyType:i.type,styles:p,tooltip:d,tooltipPlacement:s?u().W.Bottom:u().W.Left,children:c})}function h(e){const{actionMenu:t,buttonPopupStore:o,disabled:r,onClick:n}=e,i=(0,a().IS)((e=>({icon:{fill:e.text.uiRedPrimary},propertyType:{color:e.accentColors.red[700]}})),[]),s=S();return(0,g.jsx)(m().z$,{actionMenu:t,buttonPopupStore:o,disabled:r,onClick:n,styles:i,tooltip:s,children:s})}function f(e){const{actionId:t,propertyId:o,renderOrigin:a}=e,i=(0,c().j)(),l=(0,n().uB)(void 0,p().A),u=(0,r.useCallback)((()=>l.reset()),[l]);return(0,g.jsx)(s().Ay,{buttonPopupStore:l,popupType:i,render:()=>(0,g.jsx)(d().a,{actionId:t,closeMenu:u,propertyId:o}),renderOrigin:a})}function v(e){const{propertySchema:t,styles:o,hasAutomationUpdatedErrorStatesEnabled:r}=e;return r?(0,g.jsx)(i().sA,{defaultMessage:'"{propertyName}" property was deleted',id:"updateThisPageUnsupportedPropertyAction.updatedDeletedProperty.elementTitleText",values:{propertyName:t.name}}):(0,g.jsx)(i().sA,{defaultMessage:"{propertyName} property was deleted",id:"updateThisPageUnsupportedPropertyAction.deletedProperty.title",values:{propertyName:(0,g.jsx)("span",{style:o.propertyType,children:t.name})}})}function x(e){const{propertySchema:t,hasAutomationUpdatedErrorStatesEnabled:o}=e;return o?(0,g.jsx)(i().sA,{defaultMessage:"Restore property or delete to enable this automation",id:"updateThisPageUnsupportedPropertyAction.updatedDeletedProperty.title"}):(0,g.jsx)(i().sA,{defaultMessage:"{propertyName} property was deleted",id:"updateThisPageUnsupportedPropertyAction.deletedProperty.title",values:{propertyName:t.name}})}function S(){return(0,g.jsx)(i().sA,{defaultMessage:"The property was permanently deleted",id:"updateThisPageUnsupportedPropertyAction.permanentlyDeleted.title"})}},989064:(e,t,o)=>{o.d(t,{z:()=>c});var r=o(296540),n=()=>o(56366),a=()=>o(366360),i=()=>o(813716),s=()=>o(997939),l=()=>o(36697),u=()=>o(897499),p=o(474848);function c(e){const{property:t}=(0,r.useContext)(u()._B),{collectionStore:o}=(0,a().k)(),{removePropertyTrigger:c}=(0,i().p)(),d=(0,r.useCallback)((()=>{c(t)}),[t,c]),m=(0,n().K8)((()=>o.getSchema()),[o])[t],g=m?e=>(0,p.jsx)(l().P,{propertySchema:m,style:e}):void 0;return(0,p.jsx)(s().X,{icon:g,onDelete:d,...e,children:e.children})}},997939:(e,t,o)=>{o.d(t,{X:()=>b});o(16280),o(898992),o(354520);var r=o(296540),n=()=>o(56366),a=()=>o(401497),i=()=>o(173019),s=()=>o(735384),l=()=>o(959013),u=()=>o(534177),p=()=>o(760217),c=()=>o(928600),d=()=>o(939740),m=()=>o(89924),g=()=>o(962730),y=()=>o(463830),h=()=>o(366360),f=()=>o(781697),v=()=>o(535511),x=()=>o(741310),S=()=>o(807787),C=o(474848);function b(e){const{onDelete:t,styles:o}=e,{disabled:i}=(0,h().b)(),s=Boolean(i),l=(0,n().uB)(void 0,y().A),p=(0,r.useCallback)((()=>{if(!t)throw new Error("onDelete is not implemented for trigger");t(),l.setState({open:!1})}),[l,t]),c=(0,r.useMemo)((()=>t?(0,C.jsx)(T,{onDelete:p}):null),[t,p]),d=(0,a().IS)((e=>({componentWrap:{borderRadius:10},buttonWrap:{borderRadius:10}})),[]),m=(0,r.useCallback)((t=>{const r=e.onClick?S().aX:S().ot;return(0,C.jsx)(r,{...t,actionMenu:c,buttonPopupStore:l,disabled:s,icon:e.icon,onClick:e.onClick,styles:{...o,...d},hideDragHandle:!0,children:e.children})}),[e.onClick,e.icon,e.children,c,l,s,o,d]);return(0,C.jsx)(v().ck,{children:(0,C.jsx)(x().P,{disable:s,renderOrigin:m,title:e.tooltip,tooltipPlacement:e.tooltipPlacement||g().W.Bottom,disableTooltip:!(0,u().O9)(e.tooltip)})})}function T(e){const{onClose:t,onEdit:o,onDelete:r}=e,n=(0,f().e)(),a=[o?{action:()=>{null==t||t(),o()},key:"edit",render:e=>(0,C.jsx)(p().A,{...e,icon:(0,i().r)({height:16,width:16}),title:(0,C.jsx)(l().sA,{id:"automationBaseStepElement.moreActionsMenu.edit",defaultMessage:"Edit"})})}:void 0,r?{action:()=>{null==t||t(),r()},key:"delete",render:e=>(0,C.jsx)(p().A,{...e,icon:(0,s().I)({height:16,width:16}),title:(0,C.jsx)(l().sA,{id:"automationBaseStepElement.moreActionsMenu.delete",defaultMessage:"Delete"})})}:void 0].filter(u().O9);return(0,C.jsx)(c().A,{...n,children:(0,C.jsx)(d().Ay,{type:d().Oh.Vertical,sections:[{items:a,key:"items",render:e=>(0,C.jsx)(m().A,{enableActionSheetTitle:!0,topBorder:!0,...e})}],initialFocus:0})})}},999638:(e,t,o)=>{o.d(t,{A:()=>l});var r=o(296540),n=()=>o(56366),a=()=>o(722872),i=()=>o(419830),s=o(474848);const l=(0,o(645873).Qz)(o(862292).T.formulas,((e,t)=>(0,s.jsx)(u,{...t,formulas:e})));function u(e){const{allowedReturnTypes:t,disabled:l,formulas:u,formulaTypecheckContextValues:p,onBack:c,onChange:d,onClose:m,parentRecordStore:g,restrictUnaccessibleProperties:y,spaceId:h,value:f}=e,v=(0,o(484714).Y0)(),x=(0,r.useCallback)((async()=>{if(c)return void c();if("simple"===(null==f?void 0:f.type))return void m();await(0,i().Cp)()?(d({type:"simple",value:null==f?void 0:f.value}),m()):m()}),[m,d,c,f]),S=(0,r.useCallback)((e=>{void 0!==e&&e[0][0].length?d({type:"formula",value:e}):d(void 0),m()}),[d,m]),C=(0,n().K8)((()=>{const e=(0,o(909470).i)(),r=(0,o(502856).MC)({collectionFeatureGates:e,experimentService:o(508496).default,getRecordModel:g.getRecordModel,loadRecordModel:g.loadRecordModel});return{allowedReturnTypes:t,handleDataRequest:r,restrictUnaccessibleProperties:y,spaceId:h,valueTypes:p,featureGates:e}}),[t,p,g.getRecordModel,g.loadRecordModel,h,y]),b=(0,n().K8)((()=>(0,i().pG)(f)),[f]);return C?(0,s.jsx)(o(928600).A,{disableBottomPadding:!0,disableHeaderBorder:!0,disableScroller:!0,hideMobileTopbar:!0,maxHeight:"unset",menuType:v.isMobile?a().gu.Modal:a().gu.Popup,width:v.isMobile?void 0:740,children:(0,s.jsx)(o(833682).v,{formulas:u,initialCode:b,typecheckContext:C,handleClose:S,handleCancel:x,parentSpaceId:h,disabled:l,focus:!0,evaluationErrors:[],getRecordModel:g.getRecordModel})}):null}}}]);