"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[84856],{100594:(e,t,r)=>{r.d(t,{CN:()=>k,D0:()=>_,D5:()=>R,GL:()=>y,I9:()=>m,JQ:()=>v,JW:()=>M,PC:()=>h,Rb:()=>B,SK:()=>x,UK:()=>D,VY:()=>u,YU:()=>b,Yp:()=>C,_x:()=>w,bg:()=>p,fn:()=>A,i8:()=>P,kq:()=>d,q_:()=>T,sh:()=>g,tG:()=>f,xS:()=>F,zn:()=>V});var o=()=>r(534177),n=()=>r(708685),a=()=>r(921598),i=()=>r(970013),l=()=>r(713998),c=()=>r(499755),s=()=>r(901610);const u=["gray","blue","yellow","green","purple","teal","orange","pink","red"],d=["auto","colorful"];let p=function(e){return e.small="small",e.medium="medium",e.large="large",e.extra_large="extra_large",e}({});function g(e){switch(e){case p.small:return 300;case p.medium:return 400;case p.large:return 600;case p.extra_large:return 800;default:(0,o().HB)(e)}}function m(e){switch(e){case p.small:return 150;case p.medium:return 250;case p.large:return 300;case p.extra_large:return 400;default:(0,o().HB)(e)}}let y=function(e){return e.avatar="avatar",e.avatar_name="avatar_name",e.name="name",e}({}),f=function(e){return e.none="none",e.x_axis="x_axis",e.y_axis="y_axis",e.both="both",e}({}),v=function(e){return e.none="none",e.horizontal="horizontal",e.vertical="vertical",e.both="both",e}({}),h=function(e){return e.normal="normal",e.percent="percent",e.side_by_side="side_by_side",e}({}),_=function(e){return e.none="none",e.value="value",e.name="name",e.name_and_value="name_and_value",e}({});function S(e){if(!e)return!1;return a().BI.includes(e)}function C(e){const t=(0,n().getFormulaPropertySchemaBaseResultType)(e);return"text"===t||"number"===t||"checkbox"===t||"person"===t||"date"===t}function b(e,t){var r,n;let i,s=e.chartFormat;if("groups_reducer"===e.dataConfig.type){var u;const{chartFormat:r,chartGroupByFormat:o}=function(e,t,r,o){const n=(0,l()._g)({schema:o,property:e.property});if(n&&"donut"===r&&(0,c().e0)(n)){const r=(0,a().MP)(e);return{chartFormat:{...t,mainSort:c().S0.yDescending},chartGroupByFormat:r}}return{chartFormat:t,chartGroupByFormat:e}}(null==e||null===(u=e.dataConfig)||void 0===u?void 0:u.groupBy,null==e?void 0:e.chartFormat,"donut",t);s=r,i={...e.dataConfig,groupBy:o,aggregationConfig:{aggregation:e.dataConfig.aggregationConfig.aggregation}}}else"results_reducer"===e.dataConfig.type?(i=e.dataConfig,s={...s,mainSort:c().S0.yDescending}):(0,o().HB)(e.dataConfig);T(e)&&s&&(void 0===(null===(r=s)||void 0===r?void 0:r.donutDataLabels)||(null===(n=s)||void 0===n?void 0:n.donutDataLabels)===_.none)?s.donutDataLabels=_.value:!T(e)&&s&&(s.donutDataLabels=_.none);const d={...e,type:"donut",dataConfig:i};return s&&(d.chartFormat=s),d}function w(e,t){let r;"groups_reducer"===e.dataConfig.type?r={...e.dataConfig,aggregationConfig:{...e.dataConfig.aggregationConfig,seriesFormat:{displayType:t},stackOptions:void 0}}:"results_reducer"===e.dataConfig.type?r={...e.dataConfig,valueSeriesFormat:{displayType:t}}:(0,o().HB)(e.dataConfig);const n=e.chartFormat;return n&&n.donutDataLabels&&n.donutDataLabels!==_.none?n.axisShowDataLabels=!0:!n||n.donutDataLabels!==_.none&&void 0!==n.donutDataLabels||(n.axisShowDataLabels=!1),{...e,type:t,dataConfig:r}}function x(e,t){let r;if("groups_reducer"===e.dataConfig.type){var n;const o=null==e||null===(n=e.dataConfig)||void 0===n?void 0:n.groupBy;r={...e.dataConfig,groupBy:o,aggregationConfig:{...e.dataConfig.aggregationConfig,seriesFormat:{displayType:t}}}}else"results_reducer"===e.dataConfig.type?r={...e.dataConfig,valueSeriesFormat:{displayType:t}}:(0,o().HB)(e.dataConfig);return{...e,type:t,dataConfig:r}}const B={main:c().S0.xAscending,stacked:c().S0.manual};function k(e){let{chartConfig:t,xAxisPropertyId:r,newDataConfigType:n,groupBy:a,aggregation:i,valueProperty:l}=e;const s="groups_reducer"===t.dataConfig.type?t.dataConfig.aggregationConfig.seriesFormat:t.dataConfig.valueSeriesFormat;"groups_reducer"===n?t.dataConfig={type:"groups_reducer",groupBy:a,aggregationConfig:{aggregation:i,seriesFormat:s,stackOptions:"groups_reducer"===t.dataConfig.type?t.dataConfig.aggregationConfig.stackOptions:void 0}}:"results_reducer"===n?t.dataConfig={type:"results_reducer",nameProperty:r,valueProperty:l,valueSeriesFormat:s}:(0,o().HB)(n);const u="formula"===a.type?a.groupBy.sort:a.sort;return t.chartFormat={...t.chartFormat,mainSort:(0,c().gN)(u)},t}function F(e){let{property:t,propertySchema:r,groupByOption:o,hideEmptyGroups:i}=e;const l=r.type;if((0,a().Eg)(r)){if((0,a()._o)(l)){if(o&&S(o))return{type:l,property:t,groupBy:o,sort:{type:"ascending"}}}else{if((0,a().KI)(l)||"select"===l||"multi_select"===l)return{type:l,property:t,sort:{type:"ascending"}};if((0,a().iF)(l)){if(o&&((c=o)&&a().PC.includes(c)))return{type:l,property:t,groupBy:o,sort:{type:"ascending"}}}else{if("number"===l)return{type:l,property:t,groupBy:{type:"unique"},start:-1,end:-1,size:-1,sort:{type:"ascending"}};if("formula"===l){const e=(0,n().getFormulaPropertySchemaResultType)(r);if("number"===e)return{type:"formula",property:t,groupBy:{type:"number",groupBy:{type:"unique"},start:-1,end:-1,size:-1,sort:{type:"ascending"}}};if("date"===e&&S(o))return{type:"formula",property:t,groupBy:{type:"date",groupBy:o,sort:{type:"ascending"}}}}else if("person"===l)return{type:l,property:t,sort:{type:"manual"}}}}var c;return(0,a().V0)({property:t,propertySchema:r,hideEmptyGroups:i})}}function M(e){const t="formula"===e.type?(0,n().getFormulaPropertySchemaResultType)(e):void 0;return(0,i().AM)(e)||"number"===t}function V(e){const t="formula"===e.type?(0,n().getFormulaPropertySchemaResultType)(e):void 0;return(0,a()._o)(e.type)||"date"===t}function A(e){const t="formula"===e.type?(0,n().getFormulaPropertySchemaResultType)(e):void 0;return(0,i().JY)(e)||"person"===t}function P(e){if("formula"===e.type){const t=(0,n().getFormulaPropertySchemaResultType)(e);return(0,a()._o)(t)}return(0,a()._o)(e.type)}function D(e){return"text"===e||"number"===e||"person"===e||"date"===e}function R(e){var t;return!(!e||!(0,s().m)(e))&&("groups_reducer"!==e.dataConfig.type||!e.dataConfig.aggregationConfig.stackOptions||"percent"!==(null===(t=e.chartFormat)||void 0===t?void 0:t.axisGroupStyle))}function T(e){return!!R(e)&&(!(!e||!(0,s().m)(e))&&(void 0===(null===(t=e.chartFormat)||void 0===t?void 0:t.axisShowDataLabels)||(null===(r=e.chartFormat)||void 0===r?void 0:r.axisShowDataLabels)));var t,r}},152236:(e,t,r)=>{r.d(t,{M:()=>p,h:()=>g});r(16280),r(898992),r(354520);var o=()=>r(700500),n=()=>r(363497),a=()=>r(179034),i=()=>r(869558),l=()=>r(750660),c=()=>r(246826),s=()=>r(780054),u=()=>r(71584),d=()=>r(351360);function p(e){const{environment:t,collectionViewStore:r,parentCollectionViewBlockStore:l,transaction:s,filter:u,inMemoryRecordCache:p,sort:g,semanticQuery:m,assistantChatSessionId:y}=e,f=d().default.state.currentSpaceStore,v=d().default.state.currentSpaceViewStore;if(!f||!v)throw new Error("No current space or space view.");const h=t.currentUser.id;if(!h)throw new Error("User is not logged in.");const _=c().Wv({environment:t,type:o().xd.collectionViewPage,inMemoryRecordCache:f.inMemoryRecordCache,transaction:s,spaceId:f.id,permissions:[{type:"user_permission",user_id:h,role:"editor"}]}),S={type:"table",parent_id:_.id,parent_table:a().ev,alive:!0,space_id:f.id,format:{table_properties:r.getFormat().table_properties,timeline_arrows_by:void 0,subitem_display_mode:"hidden",table_subitem_toggle_column:"title",is_unlisted:!0,collection_pointer:r.getFormat().collection_pointer??l.getCollectionPointer(),...m?{is_unlisted_from_semantic_query:{is_from_semantic_query:!0,query:m}}:{is_unlisted_from_semantic_query:{is_from_semantic_query:!1}}},query2:{filter:u,sort:g}},C=c().eC({environment:t,table:i().Gy,value:S,inMemoryRecordCache:p,transaction:s});return c().zv({store:_,data:{parent_id:y,parent_table:n().TF,alive:!0,view_ids:[C.id]},transaction:s}),{collectionViewStore:C,linkedDatabaseCollectionBlockStore:_}}async function g(e){const{environment:t,transaction:r,acceptMoveToArgs:o,linkedDatabaseBlockStore:n}=e,[[a],i]=u().duplicateBlock({environment:t,stores:[n],transaction:r,resolveTemplateVariables:!1,targetSpaceId:n.getSpaceId(),baseUrl:s().A.domainBaseUrl,publicDomainName:s().A.publicDomainName,preferDuplicateLocation:"local",addCopyName:!1,deepCopyTransclusionContainers:!0});c().zv({store:a,data:{alive:!0},transaction:r});for(const l of a.getCollectionViewStores())c().zv({store:l.getFormatStore(),data:{is_unlisted:null,is_unlisted_from_semantic_query:null},transaction:r});return await l().Ju({...o,targets:[a],transaction:r}),a}},374136:(e,t,r)=>{r.d(t,{_G:()=>O,$k:()=>P,w$:()=>W,H$:()=>z,l9:()=>E,NH:()=>U,jY:()=>I,JI:()=>j,ck:()=>T,i5:()=>q,EN:()=>G,gc:()=>D,wK:()=>R});var o=()=>r(244641),n=r(296540),a=()=>r(401497),i=()=>r(764880),l=()=>r(100594),c=()=>r(901610),s=()=>r(921598),u=()=>r(713998),d=()=>r(534177),p=()=>r(825237),g=()=>r(651124),m=()=>r(792071),y=r(474848);function f(e){let{size:t,style:r,icon:o,baseUrl:n,getRecordModel:a}=e;return(0,y.jsx)("div",{style:{height:t,width:t,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:4,verticalAlign:"top",marginTop:1,...r},children:(0,y.jsx)(S,{icon:o,size:t,baseUrl:n,getRecordModel:a})})}const v=n.memo(f);function h(e){return.9*e}function _(e){return.888*e}function S(e){let{icon:t,size:r,baseUrl:o,getRecordModel:n}=e;if(!t)return null;const a=(e,t)=>{const n=p().wY({url:e,baseUrl:o,fullyQualified:!0,permissionRecord:t,width:_(r),userId:void 0});return(0,y.jsx)("img",{alt:"icon",src:n,style:{width:_(r),height:_(r),objectFit:"cover",borderRadius:4,marginTop:1}})},i=(0,g().WO)(t.icon);switch(i.type){case"unicode_emoji":return(0,y.jsx)("div",{style:{fontSize:h(r)},children:i.emoji.unicode});case"custom_emoji":const e=m().xm7.resolveCustomEmojiIcon(t,n);return e?a(e.icon,e.pointer):null;case"app_package_asset":case"notion_icon":case"url":return a(t.icon,t.pointer);default:(0,d().HB)(i)}}var C=()=>r(216519);const b=function(e){const{botValue:t,avatarSize:o,baseUrl:n,theme:a,style:i}=e;if(null!=t&&t.icon){const l=r(522419).GM(t.icon)?p().x8({url:t.icon,width:e.avatarSize,fullyQualified:!0,stripGoogleIconQuery:!0,baseUrl:n,userId:void 0}):t.icon;return(0,y.jsx)("div",{style:{...(0,C().fo)({theme:a,avatarSize:o}),...i},children:(0,y.jsx)("img",{src:l,style:{display:"block",width:"100%",height:"100%",objectFit:"cover"}})})}if(null!=t&&t.name){const e=t.name[0];return(0,y.jsx)("div",{children:(0,y.jsx)("div",{style:{...(0,C().ws)({theme:a,avatarSize:o}),...i},children:(0,y.jsx)("div",{children:e})})})}return(0,y.jsx)("span",{children:"🤖"})};var w=()=>r(597777),x=()=>r(869190),B=()=>r(72135),k=()=>r(379632),F=()=>r(100622),M=()=>r(284371),V=()=>r(780054),A=()=>r(10594);const P=(0,r(959013).YK)({titlePlaceholder:{defaultMessage:"Untitled",id:"chartLabelFormatHelpers.untitledBlock"}});function D(e,t,r){const o=(0,a().IS)((e=>({wrapper:{display:"flex",alignItems:"center",gap:6,minWidth:0},initialStyle:{backgroundColor:e.chartAvatarBackgroundColor,border:`1px solid ${e.chartAvatarBorderColor}`,color:e.chartAvatarColor},avatarStyle:{background:"none"},botStyle:{backgroundColor:e.chartAvatarBackgroundColor,border:`1px solid ${e.chartAvatarBorderColor}`,color:e.chartAvatarColor,fontSize:r?8:10},avatarWrapper:{flexShrink:0},nameWrapper:{minWidth:0,...M().RC}})),[r]);return(0,n.useCallback)(((n,a)=>{var l,c;if(!a)return n.toString();let s,u,d;if(a.actorPointer&&e){var p;const r=(0,i().xC)({pointer:a.actorPointer,getRecordModel:e});u=null==r?void 0:r.asActor,d=null===(p=u)||void 0===p?void 0:p.getDisplayName(t)}return d||(d=n||t.formatMessage(m().Fvx.messages.anonymousPlaceholder)),s=null!==(l=u)&&void 0!==l&&l.isUser()?(0,y.jsx)(C().Ay,{userValue:u,avatarSize:r?16:20,baseUrl:V().A.domainBaseUrl,theme:(0,F().x0)(),fontSize:r?8:10,initialStyle:o.initialStyle,avatarStyle:o.avatarStyle}):null!==(c=u)&&void 0!==c&&c.isBot()?(0,y.jsx)(b,{botValue:u,avatarSize:r?16:20,baseUrl:V().A.domainBaseUrl,theme:(0,F().x0)(),style:o.botStyle}):(0,y.jsx)(C().Ay,{userValue:{name:"?"},avatarSize:r?16:20,baseUrl:V().A.domainBaseUrl,theme:(0,F().x0)(),fontSize:r?8:10,initialStyle:o.initialStyle,avatarStyle:o.avatarStyle}),k().A.renderToStaticMarkup((0,y.jsxs)("div",{style:o.wrapper,children:[(0,y.jsx)("div",{style:o.avatarWrapper,children:s}),r?(0,y.jsx)("div",{style:o.nameWrapper,children:d}):null]}))}),[e,t,r,o])}function R(e,t,r){const o=(0,a().IS)((()=>({wrapper:{display:"flex",alignItems:"center",gap:6,minWidth:0},avatarWrapper:{flexShrink:0},titleWrapper:{minWidth:0,...M().RC}})),[]),i=t.formatMessage(P.titlePlaceholder);return(0,n.useCallback)(((n,a)=>{if(!a||!e)return n.toString()||i;let l;if(a.pagePointer&&e&&(l=e(a.pagePointer)),!l)return n.toString()||i;const c=l.getRenderTitleWithPlaceholder({getRecordModel:e,userTimeZone:r,intl:t}),s=l.getRenderIcon({getRecordModel:e});return k().A.renderToStaticMarkup((0,y.jsxs)("div",{style:o.wrapper,children:[s&&(0,y.jsx)("div",{style:o.avatarWrapper,children:(0,y.jsx)(v,{getRecordModel:e,icon:s,size:16,baseUrl:V().A.domainBaseUrl})}),(0,y.jsx)("div",{style:o.titleWrapper,children:c})]}))}),[e,r,t,i,o.wrapper,o.avatarWrapper,o.titleWrapper])}function T(e){var t,r,o,n;const a="count"===(null===(t=e.aggregation)||void 0===t?void 0:t.aggregator)||"unique"===(null===(r=e.aggregation)||void 0===r?void 0:r.aggregator)?"number":j(e.propertySchema);let i;return i="count"===(null===(o=e.aggregation)||void 0===o?void 0:o.aggregator)||"unique"===(null===(n=e.aggregation)||void 0===n?void 0:n.aggregator)?"precision_0":"precision_from_number_property"===e.numberPrecisionOverride?q(e.propertySchema):e.numberPrecisionOverride,t=>"string"==typeof t?t:i&&"precision_uncapped"!==i?(0,B().ZV)(t,a,e.intl,"compact",i):(0,B().ZV)(G(t,2),a,e.intl,"compact",void 0)}function I(e){let{groupBy:t,dateFormat:r,intl:o}=e;return(e,n)=>{let a;return a=n?n.name:"string"==typeof e?e:e.toString(),z({dateString:a,dateFormat:r,groupBy:t,intl:o})}}function z(e){let{dateString:t,dateFormat:r,groupBy:n,intl:a}=e;const i=parseInt(t,10);if(isNaN(i))return t;switch(n){case"relative":default:return t;case"day":return(0,x().ZF)({value:{type:"date",start_date:o().c9.fromMillis(i).toISODate()},date_format:r||w().vz,allowRelativeDates:!0,intl:a});case"week":case"month":case"year":const e=o().c9.fromMillis(i),l={type:n,range:{type:"daterange",start_date:e.toISODate(),end_date:e.plus({[`${n}s`]:1}).minus({days:1}).toISODate()}};return(0,A().nc)({value:l,intl:a})}}function j(e){let t;return("number"===e.type||"formula"===e.type)&&(t=e.number_format),t}function q(e){return"number"===e.type||"formula"===e.type?e.number_precision:void 0}function U(e){let{chartConfig:t,schema:r,highChartsLabel:o,highChartsValue:n,isMultiSeries:a,intl:i,numberPrecisionOverride:s}=e,d=o,p=n;if(!t)return{label:d,value:p};const g=t.dataConfig;let m,y,f,v;if(a){if((0,c().m)(t)&&"groups_reducer"===t.dataConfig.type){var h;const e=t.dataConfig;if(m=null===(h=e.aggregationConfig.stackOptions)||void 0===h?void 0:h.groupBy,m){const e=(0,u()._g)({schema:r,property:m.property});e&&(0,l().zn)(e)&&(y=e)}v=e.aggregationConfig.aggregation,"count"!==v.aggregator&&(f=(0,u()._g)({schema:r,property:v.property}))}}else"groups_reducer"===g.type?(m=g.groupBy,y=(0,u()._g)({schema:r,property:g.groupBy.property}),v=g.aggregationConfig.aggregation,"count"!==v.aggregator&&(f=(0,u()._g)({schema:r,property:v.property}))):f=(0,u()._g)({schema:r,property:g.valueProperty});if(d=y?W({propertySchema:y,groupByFormat:m,aggregation:void 0,highChartsLabel:o,intl:i}):d,p&&"number"==typeof p&&f&&(0,l().JW)(f)){var _,S,C,b;const e="count"===(null===(_=v)||void 0===_?void 0:_.aggregator)||"unique"===(null===(S=v)||void 0===S?void 0:S.aggregator)?"number":j(f),t="count"===(null===(C=v)||void 0===C?void 0:C.aggregator)||"unique"===(null===(b=v)||void 0===b?void 0:b.aggregator)?"precision_0":s??q(f);p=t&&"precision_uncapped"!==t?(0,B().ZV)(p,e,i,"compact",t):(0,B().ZV)(G(p,2),e,i,"compact")}return{label:d,value:p}}function W(e){const{propertySchema:t,groupByFormat:r,aggregation:o,highChartsLabel:n,intl:a}=e;if(t&&(0,l().JW)(t)){const e="count"===(null==o?void 0:o.aggregator)||"unique"===(null==o?void 0:o.aggregator)?"number":j(t),r=parseInt(n,10);return isNaN(r)||"percent"===e?n:(0,B().ZV)(r,e,a,"compact")}const i="formula"===(null==r?void 0:r.type)?r.groupBy:r;return t&&(0,l().i8)(t)&&i&&(0,s().Ik)(i)?z({dateString:n,dateFormat:t.date_format,groupBy:i.groupBy,intl:a}):n}const L=1.2,N=2;function O(e){var t,r,o,n;if("count"===(null===(t=e.aggregation)||void 0===t?void 0:t.aggregator)||"unique"===(null===(r=e.aggregation)||void 0===r?void 0:r.aggregator))return!1;return"percent"===j(e.propertySchema)||(void 0!==e.userYAxisMax&&void 0!==e.userYAxisMin&&Math.abs(e.userYAxisMax-e.userYAxisMin)<N||(!!(null!==(o=e.userYAxisMax)&&void 0!==o&&o.toString().includes(".")||null!==(n=e.userYAxisMin)&&void 0!==n&&n.toString().includes("."))||Math.abs(e.dataYAxisMax)<L&&Math.abs(e.dataYAxisMin)<L))}function E(e){return e%1==0?e:e.toFixed(1)}function G(e,t){const r=Math.pow(10,t);return Math.round(e*r)/r}},384856:(e,t,r)=>{r.d(t,{B:()=>g,G:()=>p});var o=()=>r(584262),n=()=>r(650829),a=()=>r(152236),i=()=>r(681445),l=()=>r(492414),c=()=>r(732038),s=()=>r(750660),u=()=>r(435009),d=()=>r(317909);function p(e){const{collectionContextStore:t,environment:r,originRect:n,isChartDrilldown:i,intl:l}=e,u=null==t?void 0:t.collectionViewBlockStore(),p=null==t?void 0:t.collectionViewStore();u&&p&&s().ho({environment:r,blocks:[u],originRect:n,moveToContext:"ai_ephemeral_view",isAddTo:!0,isDefaultPrivateLocation:!0,forceShowPrivatePageOption:!0,dontCommitActions:!0,onAccept:async e=>{const{performResult:n}=await d().createAndCommitAsync({environment:r,userAction:"UnlistedCollectionViewMoreButton.handleAddViewToMenuClick",waitForServerCommit:!0,perform:o=>i?c().Iz({environment:r,collectionViewStore:p,collectionViewBlockStore:u,collectionContextStore:t,acceptMoveToArgs:e,transaction:o,intl:l}):(0,a().h)({environment:r,transaction:o,linkedDatabaseBlockStore:u,acceptMoveToArgs:e})});await g({environment:r,blockStore:n,pageVisitSource:i?o().y8.ChartsDrilldown:o().y8.AIEphemeralView})}})}async function g(e){const{environment:t,blockStore:r,pageVisitSource:o}=e;if(!r)return;const a=(0,l().Ay)({store:r,pageVisitSource:o});u().oo({environment:t,url:a});const{assistantMenuActions:c}=await n().assistantDependency.load();i().S.close(),await c.closeAssistantRightHandSideMenu({environment:t})}},732038:(e,t,r)=>{r.d(t,{Sp:()=>B,sw:()=>k,Iz:()=>F});var o=()=>r(584262),n=()=>r(713998),a=()=>r(750660),i=()=>r(467676),l=()=>r(681445),c=()=>r(989423),s=()=>r(476492),u=(r(898992),r(354520),r(672577),()=>r(901610)),d=()=>r(592269),p=()=>r(289915),g=()=>r(970013),m=()=>r(857639),y=()=>r(416504),f=()=>r(498212),v=()=>r(508496);function h(e){var t,r;const{chartConfig:o,dataPoint:n,format:a,schema:i,collectionViewBlockStore:l,query2:c,temporaryViewState:s}=e;if(!(o&&"placeholder"!==o.type&&"results_reducer"!==o.dataConfig.type&&o.dataConfig.groupBy&&n&&l&&l.pointer.spaceId))return void m().log({level:"error",from:"chartDrilldownHelpers",type:"chartDrilldownMissingRequiredData",error:{name:"chartDrilldownHelpers",message:"Unexpected error"},data:{miscDataToConvertToString:{chartConfig:o,dataPoint:n,collectionViewBlockStore:l}}});const h=function(e,t){const r={property:g().rn,visible:!0,width:276},o={property:t,visible:!0},n=[r,o],a=e.getCollectionViewStores(),i=a.find((e=>"table"===e.getType())),l=null==i?void 0:i.getFormatStore().getKeyStore("table_properties").getValue();if(!i||!l||0===l.length)return n;const c=l.find((e=>e.property===g().rn))??r,s=l.find((e=>e.property===t))??o,u=l.filter((e=>e.property!==g().rn&&e.property!==t));return[c,s,...u]}(l,o.dataConfig.groupBy.property),_={type:"table",parent_id:l.pointer.id,parent_table:l.pointer.table,alive:!0,space_id:l.pointer.spaceId,format:{is_unlisted:!0,collection_pointer:null==a?void 0:a.collection_pointer,property_filters:(null==s||null===(t=s.propertyFilters)||void 0===t?void 0:t.value)??(null==a?void 0:a.property_filters),table_properties:h},query2:{...c,filter:(null==s||null===(r=s.combinatorFilter)||void 0===r?void 0:r.value)??(null==c?void 0:c.filter)}};let S;var C;(n.groupFormat&&(S=(0,d().K8)({schema:i,propertyMapping:void 0,groupBy:o.dataConfig.groupBy,group:n.groupFormat,timeZone:(0,y().P)(),experimentService:v().default})),S)&&((0,p().dU)(S)?null!==(C=_.query2)&&void 0!==C&&C.filter?_.query2.filter=(0,p().GV)([_.query2.filter,S]):_.query2.filter=S:(0,p().yX)(S)&&(_.format.property_filters=[..._.format.property_filters??[],{filter:S,id:(0,f().Ay)()}]));return"groups_reducer"===o.dataConfig.type&&(0,u().m)(o)&&o.dataConfig.aggregationConfig.stackOptions&&(_.format.collection_group_by=function(e){var t;if(null===(t=e.aggregationConfig)||void 0===t||!t.stackOptions)return;const r=e.aggregationConfig.stackOptions.groupBy;return r.hideEmptyGroups=!0,r}(o.dataConfig)),_}var _=()=>r(374136),S=()=>r(492414),C=()=>r(753199),b=()=>r(630116),w=()=>r(246826),x=()=>r(435009);function B(e){const{chartConfig:t,collectionViewBlockStore:r,format:o,dataPoint:a,clickEvent:i,schema:u,environment:d,collectionContextStore:p,intl:g,query2:m,temporaryViewState:y}=e;if(!r||"groups_reducer"!==(null==t?void 0:t.dataConfig.type))return;(0,C().SQ)({event:i,context:C().y$.EditorClick});const f=function(e){const{dataPoint:t,propertySchema:r,groupByFormat:o,aggregation:n,intl:a}=e,i=t.name??t.x.toString();if(!r)return i;return(0,_().w$)({propertySchema:r,groupByFormat:o,aggregation:n,highChartsLabel:i,intl:a})}({dataPoint:a,propertySchema:(0,n()._g)({schema:u,property:t.dataConfig.groupBy.property}),groupByFormat:null==t?void 0:t.dataConfig.groupBy,aggregation:null==t?void 0:t.dataConfig.aggregationConfig.aggregation,intl:g}),v=h({chartConfig:t,format:o,dataPoint:a,schema:u,collectionViewBlockStore:r,query2:m,temporaryViewState:y});if(!v)return;const S=(0,s().sl)(p);(0,c().u4)({environment:d,event:{eventName:"collection_chart_drilldown_click",eventProperties:{...S,drilldown_type:"grouped"}}}),l().S.openAndCreateChartDrilldownView({collectionViewValue:v,collectionViewBlockStore:r,title:f})}function k(e){var t;const{collectionStore:r,dataPoint:n,clickEvent:a,environment:i,collectionContextStore:l}=e;if(null==n||null===(t=n.pagePointer)||void 0===t||!t.id||!r)return;(0,C().SQ)({event:a,context:C().y$.EditorClick});const u=b().Bv.createChildStore(r,n.pagePointer),d=(0,S().Ay)({store:u,fullyQualified:!1,pageVisitSource:o().y8.Expand,showMoveTo:!1,openInCenterPeek:!0});if(!d)return;const p=(0,s().sl)(l);(0,c().u4)({environment:i,event:{eventName:"collection_chart_drilldown_click",eventProperties:{...p,drilldown_type:"results"}}}),x().oo({environment:i,url:d})}async function F(e){const{environment:t,collectionViewStore:r,collectionViewBlockStore:o,collectionContextStore:n,acceptMoveToArgs:l,transaction:u,intl:d}=e;if(!r)return;const p=o.getCollectionPointer(),g=w().Wv({environment:t,inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,type:"collection_view",transaction:u}),m=(0,i().t)({environment:t,transaction:u,collectionViewStore:r,collectionViewBlockStore:g,intl:d,copyNameExactly:!0});if(!m)return;m.getFormatStore().getKeyValue("collection_pointer")||w().zv({store:m.getFormatStore().getKeyStore("collection_pointer"),data:p,transaction:u}),w().zv({store:m.getFormatStore(),data:{is_unlisted:null},transaction:u}),await a().Ju({...l,targets:[g],transaction:u});const y=(0,s().sl)(n);return(0,c().u4)({environment:t,event:{eventName:"collection_chart_drilldown_save",eventProperties:{...y,new_collection_view_block_id:g.pointer.id}}}),g}}}]);