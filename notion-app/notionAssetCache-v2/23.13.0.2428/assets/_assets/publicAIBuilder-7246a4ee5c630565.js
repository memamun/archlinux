"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[28387,71204],{175213:(e,t,n)=>{n.d(t,{G:()=>i});var r=()=>n(989423),o=()=>n(508496);function i(e,t){r().vd(e,"delete_property",t),o().default.logEvent("delete_property")}},299177:(e,t,n)=>{n.d(t,{A:()=>i});class r extends(()=>n(757695))().default{getInitialState(){return{}}}const o=new r;n(604341).exposeDebugValue("SpaceWorkflowTemplateInstanceMapStore",o);const i=o},390527:(e,t,n)=>{n.r(t),n.d(t,{DEFAULT_MAX_RECURRENCE_DUPLICATION_PER_TASK:()=>I,MAXIMUM_DAILY_RECURRENCES_IN_PATH:()=>b,MAXIMUM_NESTED_RECURRENCE_LEVEL:()=>M,MAX_RECURRENCE_INTERVAL:()=>h,MAX_RECURRENCE_NUMBER_OF_RUNS:()=>v,RRULE_WEEKDAYS_MAP:()=>y,adjustedStartDateIfPossible:()=>w,areRecurrenceSchedulesEqual:()=>L,convertFromUnpersistedRecurrenceConfig:()=>H,convertToUnpersistedRecurrenceConfig:()=>U,getFormattedEndCondition:()=>S,getFormattedNextRecurrenceTime:()=>D,getNewEndTimestamp:()=>N,getNextDateUtc:()=>k,getRecurrenceAfter:()=>T,isRunningBetweenMidnightAnd3AM:()=>C,isValidRecurrenceInterval:()=>g,isValidRecurrenceNumberOfRuns:()=>A,rruleFromRecurrence:()=>E,templateAncestorsViolateRecurrenceNesting:()=>R});n(898992),n(354520),n(581454);var r=()=>n(244641);n(944114);function o(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(0===n.length)return e.map((e=>[e]));const i=[];for(const a of e)i.push(...o(n[0],...n.slice(1)).map((e=>[a,...e])));return i}var i=()=>n(496603),a=()=>n(534177),s=()=>n(720665),d=()=>n(597777),c=()=>n(869190),l=()=>n(416504),u=()=>n(402390);class m extends(()=>n(896346))().p3{constructor(e,t){super(e,t)}after(e,t){return super.after(e,t)}}var p=()=>n(912720);const f=(0,n(959013).YK)({dateAtTime:{id:"automations.recurrenceHelpers.dateAtTime",defaultMessage:"{date} at {time}"},dateBetweenMidnightAnd3AM:{id:"automations.recurrenceHelpers.dateBetweenMidnightAnd3AM",defaultMessage:"{date} between 12â€“3 AM"},numberEndConditionDescription:{id:"automations.recurrenceHelpers.numberEndConditionDescription",defaultMessage:"{number, plural, one {After {number} run} other {After {number} runs}}"},noEndCondition:{id:"automations.recurrenceHelpers.noEndCondition",defaultMessage:"Never"}}),_={day:m.DAILY,week:m.WEEKLY,month:m.MONTHLY,year:m.YEARLY},y={MO:m.MO,TU:m.TU,WE:m.WE,TH:m.TH,FR:m.FR,SA:m.SA,SU:m.SU},h=99,v=999;function g(e){return(0,s().Et)(e)&&Number.isInteger(e)&&e>0&&e<=h}function A(e){return(0,s().Et)(e)&&Number.isInteger(e)&&e>0&&e<=v}function E(e){const{start_date:t,frequency:n,interval:r,weekdays:i,timezone:s,hour:c,minute:l}=e,u="week"===n&&i?i.map((e=>y[e])):void 0,p={};return(0,a().O9)(e.end_condition)&&("date"===e.end_condition.type?p.until=(0,d().eU)(e.end_condition.end_at):"number"===e.end_condition.type?p.count=e.end_condition.number_of_occurrences:(0,a().HB)(e.end_condition)),"month"===e.frequency&&(0,a().O9)(e.monthly_restriction)&&("monthdays"===e.monthly_restriction.type?p.bymonthday=e.monthly_restriction.monthdays:"weekdays_in_month"===e.monthly_restriction.type?p.byweekday=o(e.monthly_restriction.weekdays,e.monthly_restriction.week_numbers).map((e=>{let[t,n]=e;return y[t].nth(n)})):(0,a().HB)(e.monthly_restriction)),new m({freq:_[n],dtstart:(0,d().eU)(t),interval:r,byweekday:u,tzid:s,byhour:c??0,byminute:l??0,bysecond:0,...p})}const M=1,b=1;function R(e){var t;if(0===e.length)return{violatesConstraint:!1,templateNestingExceedsMaxDepth:!1,ancestorHasDailyTemplate:!1,nestedDepthOfAutomationAncestors:void 0,immediateAncestorRecurrenceType:void 0};const n=e.filter((e=>{var t;return"day"===(null===(t=e.getRecurrence())||void 0===t?void 0:t.frequency)})),r=e.length,o=null===(t=e[0].getRecurrence())||void 0===t?void 0:t.frequency,i=r>M,a=n.length>=b;return{violatesConstraint:i||a,templateNestingExceedsMaxDepth:i,ancestorHasDailyTemplate:a,nestedDepthOfAutomationAncestors:r,immediateAncestorRecurrenceType:o}}function w(e){var t;const{recurrence:n,afterDate:o}=e;if("number"===(null===(t=n.end_condition)||void 0===t?void 0:t.type)||n.start_date>=o)return n;let i=r().c9.fromMillis(n.start_date,{zone:"utc"});const a=r().c9.fromMillis(o,{zone:"utc"});switch(n.frequency){case"year":{const e=Math.floor(a.diff(i,"years").years/n.interval);i=i.plus({years:e*n.interval});break}case"month":{const e=Math.floor(a.diff(i,"months").months/n.interval);i=i.plus({months:e*n.interval});break}case"week":{const e=Math.floor(a.diff(i,"weeks").weeks/n.interval);i=i.plus({weeks:e*n.interval});break}case"day":{const e=Math.floor(a.diff(i,"days").days/n.interval);i=i.plus({days:e*n.interval});break}}return{...n,start_date:(0,d().DH)(i.toMillis())}}function T(e){const{recurrence:t,afterDate:n}=e;if((0,p().wt)(t)){const e=(0,d().l1)(n);return t.start_date>=e?new Date(t.start_date):void 0}{const e=E(w({recurrence:t,afterDate:n})).after((0,d().eU)(n));if(!e)return;return(0,d().h1)(e)}}function C(e){return 0===e.hour||1===e.hour||2===e.hour}function k(e){return E(e).after((0,d().eU)((0,d().Rz)()))||void 0}function D(e){const{recurrence:t,intl:n}=e,o=k(H(t));if(!o)return;const i=C(t),a=r().c9.fromJSDate(o).toUTC().setZone("local",{keepLocalTime:!0}).setLocale((0,u().H)(n)).setZone(t.timezone),s=(0,c().Yq)({date:a,dateFormat:"relative",allowRelativeDates:!0,intl:n,shortenDate:!0});if(i)return n.formatMessage(f.dateBetweenMidnightAnd3AM,{date:s});{let e=a.toLocaleString(r().c9.TIME_SIMPLE);return t.timezone!==(0,l().P)()&&(e+=` ${a.toFormat("ZZZZ")}`),n.formatMessage(f.dateAtTime,{date:s,time:e})}}function S(e,t){return(0,a().O9)(e)?"number"===e.type?t.formatMessage(f.numberEndConditionDescription,{number:e.number_of_occurrences}):"date"===e.type?(0,c().Yq)({date:r().c9.fromMillis(e.end_at),dateFormat:"relative",allowRelativeDates:!0,intl:t,shortenDate:!0}):void(0,a().HB)(e):t.formatMessage(f.noEndCondition)}const I=100;function U(e){return{...e,start_date:(0,d().l1)(e.start_date),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?{type:"date",end_at:(0,d().l1)(e.end_condition.end_at)}:(0,a().HB)(e.end_condition):void 0}}function N(e,t,n){return e.plus(n-t)}function x(e,t){const n=r().c9.fromMillis(t.end_at).set({hour:e.hour??0,minute:e.minute??0});return{type:"date",end_at:(0,d().Rz)(n.toJSDate())}}function H(e){return{...e,start_date:(0,d().Rz)(new Date(e.start_date)),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?x(e,e.end_condition):(0,a().HB)(e.end_condition):void 0}}function L(e,t){const n=i().fN(e,(e=>void 0!==e)),r=i().fN(t,(e=>void 0!==e));return i().n4(n,r)}},754606:(e,t,n)=>{n.r(t),n.d(t,{PublicAIBuilder:()=>v});n(814603),n(147566),n(198721);var r=n(296540),o=()=>n(484714),i=()=>n(56366),a=()=>n(428045),s=()=>n(427704),d=()=>n(498212),c=()=>n(435009),l=()=>n(508496),u=()=>n(541801),m=()=>n(338907),p=()=>n(913454),f=()=>n(32454),_=()=>n(458097),y=()=>n(204063),h=n(474848);function v(){const e=(0,o().v3)(),t=(0,r.useCallback)((()=>{const t=new URLSearchParams(window.location.search).get("prompt"),n=p().globalWorkflowTemplates.fromIdOfType({templateId:a().MH,type:"collection"}),r=(0,d().lZ)();var o;(_().A.setState({open:!0,isSaving:!1,isPackagingM3_3Enabled:(0,m().Te)(),version:"pre_signup_build_with_ai",collectionTemplate:n,userCustomizations:{featureTemplateSelections:[],recordTitles:[]},previewCollectionInfo:void 0,setupGenerator:(0,f().getSetupGeneratorForTemplate)({environment:e,template:n,isForInAppFlows:!1,parentStore:void 0,initialAiPrompt:void 0,analyticsArgs:{origin:"workflow_templates_deeplink",hadSelectionModalSearchEntered:!1,workflowTemplatesFlowId:r}}),currentStepIndex:0,parentStore:void 0,existingCollectionInfo:void 0,relationInfos:[],navigateToOnFinish:"skip",collectionTemplatesSearchQuery:void 0,origin:"pre_signup_build_with_ai",flowId:r}),_().A.state.open)&&(null===(o=_().A.state.setupGenerator)||void 0===o||o.setPrompt([[t??""]]))}),[e]);(0,r.useEffect)((()=>{if(e.currentUser.isLoggedIn())return void c().oo({environment:e,url:s().JZ.root,redirect:!0});"control"!==l().default.getEligibleGroup({experimentId:"ai_builder_onboarding_flow",defaultGroup:"control"})?t():c().oo({environment:e,url:s().JZ.root,redirect:!0})}),[t,e]);const n=(0,i().K8)((()=>_().A.state.open),[]);return(0,h.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:[(0,h.jsx)(y().A,{style:{height:32,borderRadius:6,padding:10},onClick:t,children:"Open builder"}),n&&(0,h.jsx)(u().JA,{})]})}},888325:(e,t,n)=>{function r(e){return`${e.table}:${e.id}`}n.d(t,{_:()=>r})},966759:(e,t,n)=>{n.d(t,{i:()=>i});var r=()=>n(476492),o=()=>n(175213);function i(e){const{environment:t,collectionContextStore:n,property_type:i,from:a,property:s,...d}=e,c=(0,r().sl)(n)||{};(0,o().G)(t,{property:s,property_type:i,from:a,...d,...c})}}}]);