"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[53638],{75544:(e,t,r)=>{r.d(t,{A:()=>m});r(898992),r(354520);var o=r(296540),n=()=>r(908006),a=()=>r(56366),l=()=>r(737658),i=()=>r(336811),s=()=>r(496603),c=()=>r(183558),d=(r(517642),r(658004),r(733853),r(845876),r(432475),r(515024),r(731698),()=>r(921598));function u(e){const{reducerId:t,instanceId:r,reducer:o,collectionContextStore:n,groupsPointer:a}=e,l=n.reducersStore.state,i=l[t];let c,u;if(a&&a.length>0&&(c=(0,d().Hm)(a)),o){if(u={instanceIds:s().sb([...(null==i?void 0:i.instanceIds)||[],r]),reducer:o},c){n.reducerDependencies.has(c)||n.reducerDependencies.set(c,new Set);const e=n.reducerDependencies.get(c);null==e||e.add(t)}}else{if(c){const e=n.reducerDependencies.get(c);e&&(e.delete(t),0===e.size&&n.reducerDependencies.delete(c))}const e=s().FF((null==i?void 0:i.instanceIds)||[],r);u=i&&e.length>0?{instanceIds:e,reducer:i.reducer}:void 0}s().n4(i,u)||n.reducersStore.setState({...l,[t]:u})}function m(e){const{id:t,reducer:r,collectionContextStore:d,groupsPointer:m,debounceWait:f}=e,p=(0,a().K8)((()=>m),[m],{useDeepEqual:!0}),y=(0,a().K8)((()=>r),[r],{useDeepEqual:!0}),S=(0,a().K8)((()=>d.collectionViewStore()),[d]),g=(0,a().K8)((()=>d.normalizedFormatStore.state.collection_pointer),[d.normalizedFormatStore]),v=(0,a().K8)((()=>{var e;return null==S||null===(e=S.getFormatStore())||void 0===e?void 0:e.getKeyStore("collection_view_source").getValue()}),[S]),h=(0,o.useRef)(!1),x=(0,i().O)(),[C,b]=(0,o.useReducer)(((e,t)=>s().n4(e,t)?e:t),void 0),M=(0,o.useCallback)((()=>{const e=d.localResultStore.state,r=d.remoteResultStore.state,o=e&&"reducer"===e.type?e.reducerResults[t]:void 0,n=r&&"reducer"===r.type?r.reducerResults[t]:void 0;return function(e){const{reducerId:t,localReducerResult:r,remoteReducerResult:o,collectionContextStore:n,reducer:a}=e,i=n.reducersStore.state,c=n.remoteResultStore.state,d=n.isClientModeEnabledStore.state;if(d)return r;if("aggregation"===a.type||"groups"===a.type){const e=n.isCreatingNewChartCollectionStore.state,o=null==c?void 0:c.reducerResults[t],l=n.wasCreatedThisSessionStore.state;if(e&&l){const e=Boolean(o&&"groups"===o.type&&("v2"===o.version?o.hasMore:0!==o.total)),t=Boolean(o&&"aggregation"===o.type&&"number"===o.aggregationResult.type&&0!==o.aggregationResult.value);return(e||t)&&n.isCreatingNewChartCollectionStore.setState(!1),r}if(o)return o;const d=Boolean(c&&"reducer"===c.type&&s().I6(c.reducerResults,((e,t)=>{const r=i[t];if(!r)return!1;const o="groups"===a.type?void 0:a.filter;return Boolean("results"===r.reducer.type&&!r.reducer.searchQuery&&"results"===e.type&&e.hasMore&&s().n4(o,r.reducer.filter))})));return d?r:o}if("results"===a.type){var u;const e=n.wasCreatedThisSessionStore.state,a=Boolean(c&&"reducer"===c.type&&c.reducerResults[t]),i=null===(u=n.collectionViewStore())||void 0===u?void 0:u.getCollectionSource(),s=(0,l().TR)(i)||(0,l().hJ)(i);if((a||e)&&!s&&r&&"results"===r.type){return{...r,hasMore:o&&"results"===o.type?o.hasMore:r.hasMore}}return o}}({reducerId:t,collectionContextStore:d,reducer:y,localReducerResult:o,remoteReducerResult:n})}),[d,y,t]),O=(0,o.useCallback)((()=>{h.current=!1,x.current||b(M())}),[M,x]),k=(0,o.useCallback)((()=>{h.current||(h.current=!0,n().default.afterNextFlush(O))}),[O]),[_]=(0,o.useState)((()=>(0,c().Ay)()));return(0,o.useEffect)((()=>{const e=f?(0,s().sg)(k,f,{leading:!0}):k;return d.remoteResultStore.addListener(k),d.localResultStore.addListener(e),()=>{d.remoteResultStore.removeListener(k),d.localResultStore.removeListener(e)}}),[d,k,f]),(0,o.useEffect)((()=>(u({reducerId:t,instanceId:_,reducer:y,collectionContextStore:d,groupsPointer:p}),()=>{u({reducerId:t,instanceId:_,reducer:void 0,collectionContextStore:d,groupsPointer:p})})),[d,S,g,v,p,y,t,_]),(0,o.useEffect)((()=>{k()}),[]),(0,o.useEffect)((()=>(d.timingTracker.mountCollectionReducerRequest(t,y.type),()=>{d.timingTracker.unmountCollectionReducerRequest(t)})),[d,t,y]),C}},101981:(e,t,r)=>{r.d(t,{A:()=>i});var o=r(296540),n=()=>r(56366),a=r(474848);function l(e){const{resultStore:t,render:l,...i}=e,s=(0,r(75544).A)(i),c=(0,n().uB)(t,r(757695).default.createClass(void 0));(0,o.useEffect)((()=>{c.setState(s)}),[s,c]);const d=(0,n().K8)((()=>l?l(c):null),[l,c]);return(0,a.jsx)(a.Fragment,{children:d})}const i=o.memo(l)},173019:(e,t,r)=>{r.d(t,{r:()=>n});r(296540);var o=r(474848);const n=(0,r(340498).wt)("pencil",{viewBox:"0 0 16 16",svg:(0,o.jsx)("path",{d:"M3.926 13.307H14.11c.183 0 .34-.066.472-.199a.644.644 0 00.198-.471.652.652 0 00-.198-.479.644.644 0 00-.472-.198H5.272l-1.346 1.347zm-.704-.636l7.683-7.684-1.312-1.319-7.69 7.684-.67 1.606c-.037.1-.017.191.06.273.083.082.174.105.274.069l1.655-.63zm8.34-8.326l.738-.732c.182-.187.278-.376.287-.567.009-.192-.068-.374-.232-.547l-.267-.267c-.169-.168-.351-.246-.547-.232-.196.014-.385.11-.567.287l-.739.732 1.327 1.326z"})})},274652:(e,t,r)=>{r.d(t,{A:()=>a});var o=r(296540),n=r(474848);const a=o.forwardRef((function(e,t){const o=(0,r(401497).IS)((t=>({base:{color:e.isBlue?r(100622).Ay.blue:t.mediumTextColor},disabled:{cursor:"not-allowed"},buttonMenuItem:{...e.style,...e.disabled?{cursor:"not-allowed"}:{}}})),[e.disabled,e.isBlue,e.style]),{color:a}=o.base;return(0,n.jsx)(r(760217).A,{ref:t,...e,title:(0,n.jsx)("div",{style:{color:a,fill:a},children:e.title}),icon:(0,n.jsx)(r(8980).I,{icon:r(617668).plusIcon,style:{fill:a}}),style:o.buttonMenuItem})}))},319357:(e,t,r)=>{r.d(t,{O:()=>s});r(296540);var o=()=>r(484714),n=()=>r(430923),a=()=>r(406699),l=()=>r(962730),i=r(474848);function s(e){let{collectionContextStore:t,groupFormat:r,renderLinkButton:s,onAddOrLink:c,...d}=e;const u=(0,o().Y0)();return(0,i.jsx)(a().Ay,{popupType:u.isMobile?a().z7.BottomSheet:a().z7.Popup,alignmentToOrigin:l().C.Start,disableFlippingPlacement:!0,...d,renderOrigin:s,render:e=>(0,i.jsx)(n().l7,{collectionContextStore:t,groupFormat:r,onClose:()=>e.close(),onAddOrLink:c})})}},320865:(e,t,r)=>{r.d(t,{A:()=>n});r(296540);var o=r(474848);const n=function(){return(0,o.jsx)(r(678553).A,{title:(0,o.jsx)(r(331542).A,{})})}},338931:(e,t,r)=>{r.d(t,{Gj:()=>n,RN:()=>i,vZ:()=>a});r(944114),r(898992),r(823215),r(354520),r(672577);var o=()=>r(244641);function n(e){const t=o().c9.fromMillis(e.startUnixTimestampMS),r=e.endUnixTimestampMS?o().c9.fromMillis(e.endUnixTimestampMS):void 0,n=o().c9.fromMillis(e.startOfWeekUnixTimestampMS),a=o().c9.fromMillis(e.endOfWeekUnixTimestampMS),l=t.startOf("day"),i=o().c9.max(n,l),s=Math.ceil(i.diff(n,"days").get("days"));let c=1;if(r){const e=r.endOf("day"),t=o().c9.min(a,e);c=Math.ceil(t.diff(i,"days").get("days"))}return{start:t,end:r,startOfWeek:n,endOfWeek:a,startColumn:s,columnCount:c}}function a(e){const t=(e.attendees||[]).filter((e=>!e.self&&!e.resource));return e.hasParticipants&&t.length>0&&t.every((e=>"declined"===e.responseStatus))}const l={upcomingMinsThreshold:10,startingMinsThreshold:5,startedMinsThreshold:15};function i(e){const t=e.filter((e=>{var t;if(!e.conferencing)return!1;return!function(e){if("declined"===e)return!0;return!1}((null===(t=e.attendees)||void 0===t?void 0:t.find((e=>e.self)))?e.responseStatus??"accepted":"accepted")&&!e.isAllDay}));if(0===t.length)return;const{upcomingMinsThreshold:r,startingMinsThreshold:n,startedMinsThreshold:a}=l,i=[],c=[],d=[],u=[],m=[];for(const l of t){if(l.isAllDay)continue;const e=s(l),t=o().c9.now(),f=e.start.diff(t,"minutes").minutes;f>=0&&f<=r?i.push(l):-f>=n?d.push(l):-f>=a?u.push(l):e.contains(t)?c.push(l):m.push(l)}return[...i,...d,...u,...c,...m][0]}function s(e){const t=o().c9.fromISO(e.start.dateTime,{zone:e.start.timeZone}),r=o().c9.fromISO(e.end.dateTime,{zone:e.end.timeZone});return o().IX.fromDateTimes(t,r)}},380048:(e,t,r)=>{r.d(t,{I:()=>n});r(296540);var o=r(474848);const n=(0,r(340498).wt)("chevronLeft",{viewBox:"0 0 16 16",svg:(0,o.jsx)("path",{d:"M3.61816 8.06445C3.61816 8.29688 3.70703 8.49512 3.8916 8.67285L9.22363 13.8887C9.36719 14.0391 9.55859 14.1143 9.77734 14.1143C10.2217 14.1143 10.5703 13.7725 10.5703 13.3213C10.5703 13.1025 10.4814 12.9043 10.3311 12.7539L5.52539 8.06445L10.3311 3.375C10.4814 3.21777 10.5703 3.01953 10.5703 2.80078C10.5703 2.35645 10.2217 2.01465 9.77734 2.01465C9.55859 2.01465 9.36719 2.08984 9.22363 2.24023L3.8916 7.45605C3.70703 7.63379 3.625 7.83203 3.61816 8.06445Z"})})},381451:(e,t,r)=>{r.d(t,{MobileCalendarDayMenu:()=>oe});r(581454);var o=()=>r(244641),n=r(296540),a=()=>r(484714),l=()=>r(56366),i=()=>r(401497),s=()=>r(757695),c=()=>r(584262),d=()=>r(597777),u=()=>r(869190),m=()=>r(604995),f=()=>r(416504),p=()=>r(955363),y=()=>r(380048),S=()=>r(742117),g=()=>r(179034),v=()=>r(959013),h=()=>r(496603),x=()=>r(612008),C=()=>r(435009),b=()=>r(317909),M=()=>r(319357),O=()=>r(101981),k=()=>r(519839),_=()=>r(274652),R=()=>r(760217),w=()=>r(285790),P=()=>r(928600),D=()=>r(64e3),T=()=>r(45552),I=()=>r(8980),V=()=>r(89924),j=()=>r(320865),A=()=>r(484792),B=()=>r(862292),E=()=>r(492414),z=()=>r(722872),K=()=>r(645873);class L extends s().default{getInitialState(){return{}}}const F=L;var W=()=>r(630116),Z=()=>r(465364),U=()=>r(833880),N=(r(898992),r(354520),r(672577),()=>r(860118)),Q=()=>r(187533),G=()=>r(41459),X=()=>r(909470),q=()=>r(972435),H=()=>r(351360),J=()=>r(508496),$=r(474848);const Y=function(e){let{time:t,store:o,format:a,schema:s,blockPropertyValueOverlayStore:d,collectionStore:u}=e;const m=(0,i().DP)(),f=(0,l().K8)((()=>o.getIcon()),[o]),p=(0,l().K8)((()=>o.hasIcon()||!o.isEmptyPage()),[o]),y=(0,l().K8)((()=>o.hasError()),[o]),S=(0,l().K8)((()=>o.isEmptyPage()),[o]),g=(0,l().K8)((()=>(0,E().Ay)({store:o,fullyQualified:!1,pageVisitSource:c().y8.LinkInPage})),[o]),v=(0,l().K8)((()=>r(299545).oC(o,{recursivelyLoadAllDiscussions:!1})),[o]),h=(0,l().K8)((()=>{var e;return(null==a?void 0:a.table_wrap)||!0===(null==a||null===(e=a.calendar_properties)||void 0===e||null===(e=e.find((e=>"title"===(null==e?void 0:e.property))))||void 0===e?void 0:e.wrap)}),[null==a?void 0:a.calendar_properties,null==a?void 0:a.table_wrap]);return(0,$.jsx)(r(187485).A,{href:g,children:(0,$.jsx)(R().A,{focused:!1,title:(0,$.jsxs)(n.Fragment,{children:[t&&(0,$.jsx)("div",{style:{display:"flex",color:m.mediumTextColor,fontSize:14,marginTop:8,marginBottom:6},children:t}),(0,$.jsxs)("div",{style:{display:"flex",alignItems:"center",...t&&{marginBottom:8}},children:[p&&!y&&(0,$.jsx)(r(614505).A,{disabled:!0,icon:f,isEmptyPage:S,size:24,style:{flexShrink:0,marginRight:8,alignSelf:"baseline"}}),y&&(0,r(693954).Q)({marginLeft:2,marginRight:10,width:20,fill:m.accentColors.orange[500]}),(0,$.jsx)(r(16006).A,{store:o,style:{fontWeight:r(284371).Wy.semibold,whiteSpace:h?"pre-wrap":void 0}}),v>0&&(0,$.jsxs)("div",{style:{display:"flex",alignItems:"center",color:m.mediumTextColor,fontSize:12,marginLeft:4,flexShrink:0,alignSelf:"baseline"},children:[(0,r(965998).M)({width:12,height:12,marginRight:4,fill:m.mediumIconColor}),v]})]})]}),caption:(0,$.jsx)(te,{format:a,schema:s,store:o,blockPropertyValueOverlayStore:d,collectionStore:u})})})};function ee(e){let{property:t,schema:r,store:o,blockPropertyValueOverlayStore:n,collectionStore:a}=e;return r[t]?(0,$.jsx)(Q().m,{store:o,property:t,disabled:!0,locked:!1,format:G().j.Calendar,tableWrap:!1,blockPropertyValueOverlayStore:n,collectionStore:a},t):null}function te(e){let{format:t,schema:r,store:o,blockPropertyValueOverlayStore:n,collectionStore:a}=e;const{value:i}=(0,K().fJ)(B().T.formulas),s=(0,l().K8)((()=>(t.calendar_properties?t.calendar_properties.filter((e=>e.visible)).map((e=>e.property)):[]).filter((e=>{var t;return(0,N().T)({block:o.getModel(),property:e,schema:r,getRecordModel:o.getRecordModel,userId:null===(t=H().default.state.currentUserStore)||void 0===t?void 0:t.id,userTimeZone:(0,f().P)(),intl:q().A.getIntl(),experimentService:J().default,collectionFeatureGates:(0,X().i)(),formulasModule:i})}))),[t.calendar_properties,r,o,i]);return s.length>0?(0,$.jsx)("div",{style:{marginTop:8},children:s.map((e=>(0,$.jsx)(ee,{property:e,schema:r,store:o,blockPropertyValueOverlayStore:n,collectionStore:a},e)))}):null}const re=s().default.createClass(void 0,{name:"ResultStore"});function oe(e){const{collectionContextStore:t,initialStartOfDay:r,calendarBy:o,disabled:a,onDismiss:i,blockPropertyValueOverlayStore:s,schema:c,format:d}=e,u=(0,l().uB)(void 0,re),m=(0,l().uB)(void 0,F),f=(0,l().K8)((()=>(0,U().Sn)({collectionContextStore:t,startOfDay:le(r,m).valueOf()})),[t,r,m]),p=(0,n.useCallback)((()=>(0,$.jsx)(se,{collectionContextStore:t,calendarBy:o,initialStartOfDay:r,disabled:a,onDismiss:i,blockPropertyValueOverlayStore:s,schema:c,format:d,store:m,resultStore:u})),[t,o,r,a,i,s,c,d,m,u]);return f?(0,$.jsx)(O().A,{id:"calendar_day_results",reducer:f,collectionContextStore:t,render:p,resultStore:u}):null}function ne(e){let{item:t,currentStartOfDay:r,currentEndOfDay:o,schema:n,calendarBy:a,intl:l}=e;const i=n[a];if(!i||"date"!==i.type)return;const s=i.date_format||d().vz,c=i.time_format||d().CE,p=t.start,y=t.end,S=Boolean(!(r<=p&&p<=o)||y&&!(r<=y&&y<=o));if(t.end){const e=m().NC(t.start.valueOf(),t.end?t.end.valueOf():t.start.valueOf(),t.timeZone??(0,f().P)());return S?(0,u().ZF)({value:e,date_format:s,time_format:c,userTimeZone:t.timeZone,allowRelativeDates:!0,intl:l}):(0,u().sH)({start_time:e.start_time,end_time:e.end_time,time_format:c,humanReadable:!0,intl:l})}return(0,u().fU)({start_time:m().KQ(t.start.valueOf(),t.timeZone??(0,f().P)()).start_time,time_format:c,humanReadable:!0,intl:l})}function ae(e){let{blockStore:t,item:r,currentStartOfDay:o,currentEndOfDay:n,disabled:a,blockPropertyValueOverlayStore:i,collectionContextStore:s,schema:c,calendarBy:d,format:u}=e;const m=(0,v().tz)(),f=(0,l().K8)((()=>s.collectionStore()),[s]);return f?(0,$.jsx)(Y,{store:t,time:r.includeTime?ne({schema:c,calendarBy:d,intl:m,item:r,currentStartOfDay:o,currentEndOfDay:n}):void 0,disabled:a,format:u,schema:c,blockPropertyValueOverlayStore:i,collectionStore:f},r.id):null}function le(e,t){const{currentStartOfDay:r}=t.state;return r?o().c9.fromMillis(r):o().c9.fromMillis(e)}function ie(e,t,r,o,n,a){const l=le(o,n),i=b().createAndCommit({userAction:"MobileCalendarDayMenu.newStore",environment:e,canUndo:!0,perform:o=>{const n=(0,x().Q)({environment:e,collectionContextStore:t,groupsPointer:[],insertAtIndex:0,shouldCoerce:!0,templateStore:t.defaultPageTemplateStore.state,transaction:o,from:{createBlock:"mobile_calendar_day_menu"},inMemoryRecordCache:e.defaultRecordCache.inMemoryRecordCache});if(n)return Z().D5({type:"timestamp",environment:e,store:n.newStore,propertyId:r,timestampMs:l.valueOf(),transaction:o}),n.newStore}});if(!i.performResult)return;!function(e,t,r){r?r(e):C().oo({environment:t,url:e})}((0,E().Ay)({store:i.performResult,pageVisitSource:c().y8.Create}),e,a)}function se(e){let{collectionContextStore:t,calendarBy:r,initialStartOfDay:o,disabled:s,onDismiss:c,blockPropertyValueOverlayStore:d,schema:m,format:f,store:x,resultStore:C}=e;const b=(0,a().v3)(),O=(0,v().tz)(),{value:E}=(0,K().fJ)(B().T.formulas),L=(0,n.useContext)(A().n),F=(0,l().K8)((()=>t.collectionStore()),[t]),N=(0,l().K8)((()=>le(o,x)),[o,x]),Q=N.endOf("day"),G=(0,n.useCallback)((()=>ie(b,t,r,o,x,L)),[b,t,r,o,x,L]),X=(0,n.useCallback)(((e,t)=>{Z().D5({type:"timestamp",environment:b,store:t,propertyId:r,timestampMs:N.valueOf(),transaction:e})}),[r,N,b]),q=(0,n.useCallback)((()=>function(e,t){const r=le(e,t);t.setState({...t.state,currentStartOfDay:r.plus({day:1}).valueOf()})}(o,x)),[o,x]),H=(0,n.useCallback)((()=>function(e,t){const r=le(e,t);t.setState({...t.state,currentStartOfDay:r.minus({day:1}).valueOf()})}(o,x)),[o,x]),J=(0,l().K8)((()=>function(e,t,r,o,n){const a=t.collectionStore();if(!a)return;const l=o.state,i=t.normalizedQueryStore.state,s=t.normalizedSchemaStore.state,c=i?i.calendar_by:void 0;if(!(l&&i&&c&&s))return;const d=new Map,u=new Map;let m=h().oE(l.blockIds.map((t=>{const o=W().Bv.createChildStore(a,{id:t,table:g().ev});return(0,U().S4)({blockStore:o,calendarBy:c,schema:s,getRecordValue:a.getRecordValue,userId:e.currentUser.id,intl:r,resultCache:d,regExpCache:u,formulasModule:n})})));return i.sort||(m=h().Ul(m,(e=>e.start))),m}(b,t,O,C,E)),[b,t,O,C,E]),Y=(0,l().K8)((()=>k().fG({collectionContextStore:t,environment:b,intl:O})),[t,b,O]),ee=(0,i().IS)((e=>({headerStyle:{display:"flex",alignItems:"center",height:"100%"},linkExistingButton:{color:e.mediumTextColor,fill:e.mediumTextColor}})),[]);return F?(0,$.jsxs)(P().A,{menuType:z().gu.Modal,title:(0,$.jsxs)("div",{style:ee.headerStyle,children:[(0,$.jsx)(w().A,{onClick:H,icon:y().I,style:{marginRight:8,marginTop:2},mobileFeedback:!0}),(0,$.jsx)("div",{children:(0,u().eV)({value:N,preset:"month_day_long"})}),(0,$.jsx)(w().A,{onClick:q,icon:S().V,style:{marginLeft:8,marginTop:2},mobileFeedback:!0})]}),right:(0,$.jsx)(T().DoneMenuText,{}),onClickRight:c,children:[!J&&(0,$.jsx)(V().A,{children:(0,$.jsx)(j().A,{})}),J&&0===J.length&&(0,$.jsx)(V().A,{children:(0,$.jsx)(D().A,{title:(0,$.jsx)(v().sA,{defaultMessage:"No items",id:"mobileCalendarDayMenu.noResults.message"})})}),J&&J.length>0&&(0,$.jsx)(V().A,{children:J.map((e=>{const o=W().Bv.createChildStore(F,{id:e.id,table:g().ev});return(0,$.jsx)(ae,{disabled:s,blockPropertyValueOverlayStore:d,collectionContextStore:t,schema:m,calendarBy:r,format:f,blockStore:o,item:e,currentStartOfDay:N,currentEndOfDay:Q},e.id)}))}),!s&&(0,$.jsxs)(V().A,{topBorder:!0,children:[(0,$.jsx)(_().A,{focused:!1,onClick:G,title:(0,$.jsx)(v().sA,{defaultMessage:"New item",id:"mobileCalendarDayMenu.newItemButton.label"})}),Y&&(0,$.jsx)(M().O,{collectionContextStore:t,renderLinkButton:e=>(0,$.jsx)(R().A,{...e,focused:!1,title:(0,$.jsx)(v().sA,{id:"mobileCalendarDayMenu.linkExistingButton.label",defaultMessage:"Link existing"}),icon:(0,$.jsx)(I().I,{icon:p().N}),style:ee.linkExistingButton}),onAddOrLink:X})]})]}):null}},430923:(e,t,r)=>{r.d(t,{DV:()=>i,l7:()=>l,y7:()=>a});var o=()=>r(645873);const n={CollectionNewViewsPopupComponent:new(o().O2)("CollectionNewViewsPopupComponent",(async()=>await Promise.all([r.e(23806),r.e(96346),r.e(36192),r.e(90409),r.e(63077),r.e(74562),r.e(95794),r.e(46414),r.e(8184),r.e(99353),r.e(52681),r.e(38664),r.e(24587),r.e(14518),r.e(17713),r.e(28271),r.e(17254),r.e(67435),r.e(34576),r.e(62620)]).then(r.bind(r,93709)))),CollectionLinkExistingModal:new(o().O2)("CollectionLinkExistingModal",(async()=>await Promise.all([r.e(23806),r.e(96346),r.e(36192),r.e(44711),r.e(53321),r.e(90825),r.e(90409),r.e(63077),r.e(74562),r.e(95794),r.e(46414),r.e(8184),r.e(99353),r.e(52681),r.e(38664),r.e(24587),r.e(14518),r.e(17713),r.e(28271),r.e(17254),r.e(4422),r.e(67435),r.e(5887),r.e(70769),r.e(97965),r.e(83210),r.e(26090),r.e(10596),r.e(99346),r.e(5287)]).then(r.bind(r,901226)))),ModalOverlayCollectionView:new(o().O2)("ModalOverlayCollectionView",(async()=>await Promise.all([r.e(84856),r.e(32413)]).then(r.bind(r,956436))))},a=(0,o()._h)(n.CollectionNewViewsPopupComponent,(e=>e.CollectionNewViewsPopupComponent)),l=(0,o()._h)(n.CollectionLinkExistingModal,(e=>e.CollectionLinkExistingModal)),i=(0,o()._h)(n.ModalOverlayCollectionView,(e=>e.ModalOverlayCollectionView))},465364:(e,t,r)=>{r.d(t,{$N:()=>P,D5:()=>D,GB:()=>_,M9:()=>O,Pt:()=>w,eW:()=>R,jo:()=>T,v7:()=>k});r(944114),r(898992),r(803949),r(581454);var o=()=>r(244641),n=()=>r(787626),a=()=>r(713998),l=()=>r(597777),i=()=>r(604995),s=()=>r(416504),c=()=>r(519831),d=()=>r(496603),u=()=>r(534177),m=()=>r(299709),f=()=>r(317001),p=()=>r(520861),y=()=>r(878060),S=()=>r(44729),g=()=>r(246826),v=()=>r(606952),h=()=>r(519839),x=()=>r(695625),C=()=>r(397248),b=()=>r(630116),M=()=>r(747671);function O(e){const{environment:t,droppedStores:r,duplicate:a,calendarBy:d,transaction:u,collectionContextStore:y}=e,g=o().c9.fromMillis(e.startOfDay);let v=!0;for(const o of r){const t=e.collectionStore?e.collectionStore:(0,h().Dj)({store:o,collectionContextStore:y});if(o.getParentTable()===c().Vl||!t){v=!1;break}S().X$({childStore:o,parentStore:t,transaction:u})||(v=!1)}const x=(0,p().T)({environment:t,droppedStores:r,duplicate:a,transaction:u,collectionStore:e.collectionStore});for(const o of x){const r=e.collectionStore?e.collectionStore:(0,h().Dj)({store:o,collectionContextStore:y});if(!r)continue;const a=r.getMappedProperty(d),c=o.getPropertyStore(a),p=(0,n().b)(c.getValue())||i().Ec((0,s().P)()),S=i().kW(p,(0,s().P)()),x=g.toFormat(i().tr);let C;if("date"===S.type||"datetime"===S.type)C={...S,start_date:x};else{const e=i().AA(S,(0,s().P)());if(!e.end)return;const t={...S,start_date:x},r=i().AA(t,(0,s().P)()).start.diff(e.start,"days"),o=e.end.plus(r).toFormat(i().tr);C={...S,start_date:x,end_date:o}}const b=i().kW(C,l().$K(p)||(0,s().P)());(0,f().j)({environment:t,store:o,collectionStore:r,collectionContextStore:y,shouldCoerce:!0,groupsPointer:[],transaction:u,alreadyMovedToCollection:v}),D({environment:t,type:"dateValue",propertyId:a,store:o,transaction:u,dateValue:b}),(0,m().E)({environment:t,collectionContextStore:y,block_id:o.id,property:a,property_type:"date",from:"calendar"})}}function k(e){const{calendarStore:t,direction:r,targetStore:o}=e;t.setState({...t.state,isDragging:!0,targetStore:o,direction:r,temporaryValue:void 0})}function _(e){const{calendarStore:t,x:r,y:a,calendarBy:c}=e,u=t.state;if(u.isDragging){const e=(0,n().b)(u.targetStore.getPropertyStore(c).getValue());if(!e)return;const m=i().kW(e,(0,s().P)()),f=u.temporaryValue||e,p=i().kW(f,(0,s().P)()),y=[];u.dayStoreMap.forEach(((e,t)=>{y.push({store:e,timestamp:t})}));const S=y.find((e=>{let{store:t}=e;const o=x().T.getRectFromStore(t);return Boolean(o&&C().ux(o,r,a))}));let g;if(S){const e=o().c9.fromMillis(S.timestamp),t=e.endOf("day"),r=e.toFormat(i().tr);if(m){const n=i().AA(m,(0,s().P)());if(u.direction===M().Q.Left)if(o().IX.fromDateTimes(e,t).contains(n.start))g=m;else{let e;e="datetimerange"===m.type||"daterange"===m.type?{...m,start_date:r,end_date:m.end_date}:"datetime"===m.type?{type:"datetimerange",start_date:r,start_time:m.start_time,end_date:m.start_date,end_time:m.start_time,time_zone:m.time_zone,reminder:m.reminder}:{type:"daterange",start_date:r,end_date:m.start_date,reminder:m.reminder};const t=i().AA(e,(0,s().P)());g=!n.end&&t.start>n.start||n.end&&t.start>n.end?p:e}else if(n.end?o().IX.fromDateTimes(e,t).contains(n.end):o().IX.fromDateTimes(e,t).contains(n.start))g=m;else{let e;e="date"===m.type?{...m,type:"daterange",end_date:r}:"datetime"===m.type?{...m,type:"datetimerange",end_date:r,end_time:"00:00"}:{...m,end_date:r};const t=i().AA(e,(0,s().P)());g=t.end&&t.end<t.start?p:e}}}if(g&&!d().n4(p,g)){const e=i().kW(g,l().$K(f)||(0,s().P)());t.setState({...u,temporaryValue:e})}}}function R(e){const{environment:t,calendarStore:r,calendarBy:o,transaction:n}=e,a=r.state;a.isDragging&&a.temporaryValue&&(D({type:"dateValue",environment:t,dateValue:a.temporaryValue,propertyId:o,store:a.targetStore,transaction:n}),r.setState({...r.state,isDragging:!1}))}function w(e){const{calendarStore:t}=e,r=t.state;r.isDragging&&t.setState({...r,isDragging:!1})}function P(e){const{environment:t,store:r,collectionStore:n,collectionContextStore:l,startDayOfWeek:c,transaction:d}=e,u=l.dateRangeStartStore.state,m=(0,s().P)(),p=l.normalizedQueryStore.state;if(!p||!p.calendar_by)return;const y=(null==n?void 0:n.getMappedProperty(p.calendar_by))??p.calendar_by,S=i().hp(u,c,m),v=S.startOf("month"),h=S.endOf("month"),x=o().c9.now().startOf("day");let C;return C=o().IX.fromDateTimes(v,h).contains(x)?i().p6(x.valueOf(),m):i().p6(i().iB(u,c,m).valueOf(),m),g().zv({store:r.getPropertiesStore(),data:{[y]:a().m5(C)},transaction:d}),(0,f().j)({environment:t,store:r,collectionStore:n,collectionContextStore:l,shouldCoerce:!0,groupsPointer:[],transaction:d}),r}function D(e){const{environment:t,store:r,propertyId:o,transaction:n}=e;let l;"timestamp"===e.type?l=i().p6(e.timestampMs.valueOf(),(0,s().P)()):"dateValue"===e.type?l=e.dateValue:(0,u().HB)(e);const c=r.getPropertyValue(o),d=a().m5(l);g().zv({store:r.getPropertiesStore(),data:{[o]:d},transaction:n}),y().O({environment:t,store:r,dateProperty:{id:o,oldValue:c,newValue:d}})}function T(e){const{environment:t,collectionStore:r,calendarBy:o,store:n,insertStores:a,collectionContextStore:l,transaction:i}=e,s=n.getPropertyStore(o).getValue();for(const c of a)(0,f().j)({environment:t,store:c,collectionStore:r,collectionContextStore:l,shouldCoerce:!0,groupsPointer:[],transaction:i}),v().KY({environment:t,store:c.getPropertyStore(o),value:s,transaction:i});return a.map((e=>b().Bv.createChildStore(r,e.pointer)))}},520861:(e,t,r)=>{r.d(t,{T:()=>n});r(944114),r(898992),r(908872);var o=()=>r(415651);function n(e){const{environment:t,collectionStore:r,duplicate:n,droppedStores:a,transaction:l}=e,{movedStores:i,reparentedStores:s}=a.reduce(((e,t)=>(n||t.getAssociatedCollectionId()!==(null==r?void 0:r.id)?e.reparentedStores.push(t):e.movedStores.push(t),e)),{movedStores:[],reparentedStores:[]});return[...i,...o().MS({environment:t,droppedStores:s,duplicate:n,transaction:l,resolveTemplateVariables:!1})]}},617668:(e,t,r)=>{r.r(t),r.d(t,{iconDefinition:()=>o,plusIcon:()=>n});r(296540);const o={viewBox:"0 0 20 20",svg:(0,r(474848).jsx)("path",{d:"M10.625 3.75a.625.625 0 1 0-1.25 0v5.625H3.75a.625.625 0 1 0 0 1.25h5.625v5.625a.625.625 0 1 0 1.25 0v-5.625h5.625a.625.625 0 1 0 0-1.25h-5.625z"})},n=(0,r(340498).wt)("plus",o)},747671:(e,t,r)=>{r.d(t,{Q:()=>o,a:()=>n});let o=function(e){return e[e.Left=0]="Left",e[e.Right=1]="Right",e}({});class n extends(()=>r(757695))().default{getInitialState(){return{dayStoreMap:new Map,isDragging:!1,startingMonth:0}}}},833880:(e,t,r)=>{r.d(t,{S4:()=>h,Sn:()=>S,j2:()=>y,kc:()=>p,oq:()=>v});r(944114),r(517642),r(658004),r(733853),r(845876),r(432475),r(515024),r(731698),r(898992),r(354520),r(803949),r(581454);var o=()=>r(244641),n=()=>r(410486),a=()=>r(597777),l=()=>r(604995),i=()=>r(416504),s=()=>r(792071),c=()=>r(496603),d=()=>r(186445),u=()=>r(338931),m=()=>r(909470),f=()=>r(508496);(0,r(959013).YK)({week:{defaultMessage:"Week",id:"calendar.viewRanges.week"},month:{defaultMessage:"Month",id:"calendar.viewRanges.month"}});function p(e){return!1===e.isDragging}function y(e){const{collectionContextStore:t}=e,r=t.collectionViewStore();if(!r)return;const o=t.normalizedSchemaStore.state,n=r.getQuery(o);if(!n||!n.calendar_by)return;const a=t.dateRangeStartStore.state,s=t.dateRangeEndStore.state,c=(0,l().p6)(a,(0,i().P)()),d=(0,l().p6)(s,(0,i().P)());return g({calendarBy:n.calendar_by,dateRangeStartDate:c,dateRangeEndDate:d})}function S(e){const{collectionContextStore:t,startOfDay:r}=e,n=t.collectionViewStore();if(!n)return;const a=t.normalizedSchemaStore.state,s=n.getQuery(a);if(!s||!s.calendar_by)return;const c=o().c9.fromMillis(r).endOf("day").valueOf(),d=(0,l().p6)(r,(0,i().P)()),u=(0,l().p6)(c,(0,i().P)());return g({calendarBy:s.calendar_by,dateRangeStartDate:d,dateRangeEndDate:u})}function g(e){const{dateRangeStartDate:t,dateRangeEndDate:r,calendarBy:o}=e;return{type:"results",filter:{operator:"and",filters:[{property:o,filter:{operator:"date_is_on_or_after",use_end:!0,value:{type:"exact",value:t}}},{property:o,filter:{operator:"date_is_on_or_before",value:{type:"exact",value:r}}}]},limit:5e3}}function v(e){var t;const{collectionContextStore:r,results:o,getRecordValue:n,intl:s,formulasModule:m}=e,f=r.collectionViewStore(),p=r.normalizedQueryStore.state,y=r.normalizedSchemaStore.state,S=p?p.calendar_by:void 0,g=r.dateRangeStartStore.state,v=r.dateRangeEndStore.state,C=(null===(t=r.collectionViewStore())||void 0===t?void 0:t.getFormat().calendar_show_weekends)??!0,b=d().XX.state,M=(0,i().P)(),O=r.getCurrentUserId();if(!(f&&p&&S&&y))return;const k=new Map,_=new Map,R=c().oE(o.map((e=>h({blockStore:e,calendarBy:S,schema:y,getRecordValue:n,userId:O,intl:s,resultCache:k,regExpCache:_,formulasModule:m})))),w={};o.forEach(((e,t)=>{w[e.id]=t}));0===(p.sort||[]).length&&R.sort(((e,t)=>{const r=e.start.valueOf(),o=t.start.valueOf();if(r===o){return w[e.id]-w[t.id]}return r-o}));const P=C?(0,l().iB)(g,b,M):(0,l().J0)(g,b,M),D=C?(0,l().hp)(v,b,M):(0,l().EK)(v,b,M);let T=P;const I=[];do{const e=C?(0,l().hp)(T.valueOf(),b,M):(0,l().EK)(T.valueOf(),b,M),t={},r=R.filter((t=>(0,a().m6)(T.valueOf(),e.valueOf(),t.start.valueOf(),t.end?t.end.valueOf():void 0))).map((r=>{const{id:o,start:n,end:a,includeTime:l,timeZone:i}=r,{startColumn:s,columnCount:c}=(0,u().Gj)({startUnixTimestampMS:n.valueOf(),endUnixTimestampMS:a?a.valueOf():void 0,startOfWeekUnixTimestampMS:T.valueOf(),endOfWeekUnixTimestampMS:e.valueOf()}),d=x(s,c,t);return{id:o,start:n.valueOf(),end:a?a.valueOf():void 0,row:d,includeTime:l,timeZone:i}}));I.push({start:T.valueOf(),end:e.valueOf(),items:r}),T=C?(0,l().iB)(T.plus({week:1}).plus({hour:25}).valueOf(),b,M):(0,l().J0)(T.plus({week:1}).plus({hour:25}).valueOf(),b,M)}while(T<D);return I}function h(e){const{blockStore:t,calendarBy:r,schema:o,getRecordValue:a,intl:c,userId:d,resultCache:u,regExpCache:p,formulasModule:y}=e,S=t.getAssociatedCollectionStore(),g=t.getModel();if(!g)return;const v=(0,n().d2)({property:r,schema:o,block:g,getRecordModel:s().b4_.fromGetRecordValueFn(a),propertyMapping:null==S?void 0:S.getPropertyMapping(),collectionRequestContext:{userId:d,userTimeZone:(0,i().P)(),depth:0,intl:c,visitedProperties:new Set,resultCache:u,regExpCache:p,experimentService:f().default,collectionFeatureGates:(0,m().i)()},formulasModule:y}).next().value;if("date"!==(null==v?void 0:v.type))return;const h=v.value;if(!h)return;const x=(0,l().AA)(h,(0,i().P)());if(!x)return;return{id:g.id,start:x.start,end:x.end,includeTime:"datetime"===h.type||"datetimerange"===h.type,timeZone:"datetime"===h.type||"datetimerange"===h.type?h.time_zone:void 0}}function x(e,t,r){let o=0;for(;;){let n=!1;for(let a=0;a<t;a++)C(r,e+a,o)&&(n=!0);if(!n)break;o++}for(let n=0;n<t;n++)b(r,e+n,o);return o}function C(e,t,r){return Boolean(e[r]&&e[r][t])}function b(e,t,r){e[r]||(e[r]={}),e[r][t]=!0}},860118:(e,t,r)=>{r.d(t,{T:()=>n});var o=()=>r(713998);function n(e){const{block:t,property:r,schema:n,getRecordModel:a,userId:l,userTimeZone:i,intl:s,experimentService:c,collectionFeatureGates:d,formulasModule:u}=e;if(!t)return!1;if("title"===r)return!1;const m=n[r];return!(!m||"checkbox"!==m.type)||(!(!m||"button"!==m.type)||(!(!m||"status"!==m.type)||!o().r8({property:r,schema:n,block:t,getRecordModel:a,userId:l,userTimeZone:i,intl:s,experimentService:c,collectionFeatureGates:d,formulasModule:u})))}}}]);