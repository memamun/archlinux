"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[25700,31185,43647],{300451:(e,t,n)=>{n.d(t,{A:()=>o});class i extends(()=>n(757695))().default{getInitialState(){return{settingOpen:"initial",permissionItem:void 0,from:void 0,sudoModeStore:void 0,location:"",faviconUrl:null,previewImageUrl:null,hideBreadcrumbs:!1,hideSearch:!1,hideWatermark:!1,enableDuplicateAsTemplate:!1,customHeaderBlockIds:[],googleAnalyticsId:void 0,theme:void 0,enableQna:!1}}}const o=new i},392890:(e,t,n)=>{n.d(t,{A:()=>s});var i=()=>n(194188),o=()=>n(7767),a=()=>n(570551),r=6e4;function s(e,t){(0,a().A)(2,arguments);var n=(0,i().A)(t);return(0,o().A)(e,n*r)}},435212:(e,t,n)=>{n.d(t,{Kz:()=>a,Sc:()=>r,as:()=>o});var i=()=>n(989423);function o(e,t){(0,i().u4)({environment:e,event:{eventName:"open_customize_site",eventProperties:t}})}function a(e,t){(0,i().u4)({environment:e,event:{eventName:"update_site_customization_settings",eventProperties:t}})}function r(e){(0,i().u4)({environment:e,event:{eventName:"close_customize_site",eventProperties:{}}})}},440339:(e,t,n)=>{n.d(t,{oq:()=>se,aR:()=>te,zM:()=>ie});var i=n(296540),o=()=>n(484714),a=()=>n(56366),r=()=>n(401497),s=()=>n(148307),l=()=>n(149375),d=()=>n(954845),c=()=>n(289313),u=()=>n(66913),m=()=>n(206267),g=()=>n(68263),p=()=>n(959013),h=()=>n(534177),v=()=>n(284371),f=()=>n(703875),b=()=>n(854672),S=()=>n(285790),y=()=>n(125565),A=()=>n(987017),I=()=>n(38337),x=()=>n(115512),k=()=>n(436572),C=()=>n(704152),w=()=>n(859428),M=()=>n(962730),j=(n(16280),()=>n(449506)),B=()=>n(351360);var P=n(474848);function R(e){const{beamMetadata:t}=e,[n,a]=(0,i.useState)(!1),s=(0,o().v3)(),l=(0,r().IS)((e=>({beamIcon:{height:24,width:24},button:{borderRadius:6},tooltipWidth:{width:280}})),[]);return n||!t?null:(0,P.jsx)(w().A,{delayThreshold:500,placement:M().W.Bottom,renderTooltip:()=>(0,P.jsx)(p().sA,{defaultMessage:"Beam sends a real-time link of this page to your teammates who are online and on the same calendar event",id:"shareMenu.beam.tooltip"}),textWrap:!0,style:l.tooltipWidth,render:e=>(0,P.jsx)(C().A,{...e,style:l.button,onClick:async()=>{a(!0);const e=await function(e){var t,n;const{environment:i,beamMetadata:o}=e;if(!(null===(t=B().default.state.mainEditorCurrentBlockStore)||void 0===t?void 0:t.id))throw new Error("No current page selected");if(!(null===(n=B().default.state.currentSpaceStore)||void 0===n?void 0:n.id))throw new Error("No current space selected");return j().callApi({eventName:"sendBeam",environment:i,data:{beamMetadata:o}})}({environment:s,beamMetadata:t});"failed"!==e.type?k().D6({label:(0,P.jsx)(p().sA,{id:"shareMenu.beam.sent",defaultMessage:"Beam sent!"})}):k().D6({label:(0,P.jsx)(p().sA,{id:"shareMenu.beam.failed",defaultMessage:"There was an issue sending the beam. Please try again later."})})},children:(0,d().J)(l.beamIcon)})})}n(898992),n(354520),n(581454);var U=()=>n(392890),_=()=>n(883626),T=()=>n(496603),E=()=>n(615234),D=()=>n(866515),W=()=>n(573985),N=()=>n(677169),H=()=>n(158751),L=()=>n(379560),F=()=>n(807778),z=(n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(672577),()=>n(861017)),K=()=>n(179034),Q=()=>n(780054),O=()=>n(630116);function V(e){const{environment:t,currentSpaceStore:n}=e;let i=e.fileUrl;Q().A.isLocalhost&&(i=i.replace("dev.notion.so","localhost:3000").replace("https","http"));const o=(0,z().parseRoute)({url:i,isMobile:t.device.isMobile,baseUrl:Q().A.domainBaseUrl,publicDomainName:Q().A.publicDomainName,protocol:Q().A.protocol,currentUrl:window.location.href}),a="page"===o.name?o.blockId:void 0;if(!a)return;const r=O().Bv.createChildStore(n,{table:K().ev,id:a});return r.load(),r.isReady()?r:void 0}function q(e){var t;return"block"===(null==e||null===(t=e.pointer)||void 0===t?void 0:t.table)}function $(){const e=(0,o().v3)(),t=(0,a().K8)((()=>(0,F().Bh)()),[]),{botId:n}=(0,N().m)(),r=(0,a().K8)((()=>B().default.state.currentSpaceViewStore),[]),s=(0,i.useRef)(!1),l=(0,i.useRef)(0);(0,i.useEffect)((()=>{s.current=!1,l.current=0;(async()=>{if(t&&!s.current&&n&&r&&l.current<3)try{await(0,W().qq)({environment:e,currentSpaceViewStore:r,botId:n,timeRange:(0,H().M)(),forceRefetch:!0,reason:"background_load"}),s.current=!0,l.current=0}catch(i){s.current=!1,l.current+=1}})()}),[e,r,n,t]);const[d,c]=(0,i.useState)([]),[u,m]=(0,a().K8)((()=>{const e=B().default.state.mainEditorCurrentBlockStore;if(!e)return[void 0,void 0];const t=e.getIcon();return[e.id,q(t)?t:void 0]}),[]),g=(0,a().K8)((()=>B().default.state.currentSpaceStore),[]),p=(0,a().K8)((()=>L().A.getEvents()),[]),h=(0,i.useCallback)((()=>{if(!g||!t)return[];return p.filter((e=>{var t;if(e.isAllDay||"declined"===e.responseStatus)return!1;const n=new Date(e.start.dateTime),i=(0,U().A)(n,-5),o=new Date(e.end.dateTime),a=(0,U().A)(o,5),r=new Date;return((null===(t=e.attachments)||void 0===t?void 0:t.length)??0)>0&&a>=i&&r>=i&&r<=a}))}),[g,p,t]);(0,D().n)((()=>{if(!t)return;const e=h(),n=e.map((e=>e.id)),i=d.map((e=>e.id));(0,T().R9)(n,i).length>0&&c(e)}),2*E().Xb,!0);const v=(0,a().K8)((()=>{if(!t)return;if(!u||!g)return;const n=function(e){const{environment:t,upcomingEvents:n,currentBlockId:i,currentSpaceStore:o}=e;for(const a of n){const e=(a.attachments||[]).find((e=>{const n=V({environment:t,fileUrl:e.fileUrl,currentSpaceStore:o});return(null==n?void 0:n.id)===i}));if(e)return{event:a,attachment:e}}}({environment:e,upcomingEvents:d,currentBlockId:u,currentSpaceStore:g});if(!n)return;const i=n.event,o=n.attachment,a=null!=(r=i)&&r.attendees&&0!==r.attendees.length?Array.from(new Set(r.attendees.filter((e=>!e.self&&e.email)).map((e=>e.email)))).filter((e=>void 0!==e)):[];var r;return 0!==a.length?{beamType:"calendarAttendees",emails:a,attachment:o,recordIcon:m}:void 0}),[u,d,e,g,m,t]);if(v&&!(v.emails.length>_().Hs))return{beamType:v.beamType,emails:v.emails,attachment:v.attachment,recordIcon:v.recordIcon}}var G=()=>n(676870),Y=()=>n(525700),J=()=>n(380682),X=()=>n(663590),Z=()=>n(437487);const ee=(0,p().YK)({seo:{defaultMessage:"Search engine indexing",id:"publishSiteSettings.SEO.title"},embed:{defaultMessage:"Embed this page",id:"embedSiteSettings.title"}});function te(e){let{inviteTargetsStore:t,mostPermissivePublicItem:n}=e;const{display:i,source:o}=(0,a().K8)((()=>{const{display:e}=Z().Ay.state;if(e===Z().pP.Invite){const{source:t}=Z().Ay.state;return{display:e,source:t}}return{display:e,source:void 0}}),[]);switch(i){case Z().pP.MainShareMenu:case Z().pP.Publish:return(0,P.jsx)(ie,{mostPermissivePublicItem:n});case Z().pP.Invite:if("notion"===o)return(0,P.jsx)(oe,{inviteTargetsStore:t});if("slack"===o||"google"===o)return(0,P.jsx)(ae,{source:o});throw(0,h().HB)(o);default:(0,h().HB)(i)}}const ne=[Z().QC.Share,Z().QC.Publish];function ie(e){let{mostPermissivePublicItem:t}=e;const n=(0,o().v3)(),s=i.useRef(null),{isMobile:l}=n.device,c=(0,a().K8)((()=>(0,g().W8)(t.permissionItem)),[t.permissionItem]);(0,i.useEffect)((()=>{const e=Z().Ay.state,t=e.tab===Z().QC.Share&&e.display===Z().pP.MainShareMenu?e.source:void 0;c&&t!==Z().mc.InviteBackButton&&(Z().Ay.setState({tab:Z().QC.Publish,display:Z().pP.Publish,sessionId:m().JW(),isInitialized:!0}),(0,G().EN)(n,{source:"share_button"}))}),[n,c]);const u=(0,a().K8)((()=>Z().Ay.state.tab),[]),h=(0,a().K8)((()=>(0,X().FI)()),[]),b=(0,r().IS)((e=>({tabStyle:{color:e.lightTextColor,...l&&{width:"50%",textAlign:"center"}},selectedTabStyle:h?{}:{fontWeight:v().Wy.medium},tabTitleStyle:{color:"inherit",...h&&{fontSize:(0,x().ny)(n,"UIRegular"),fontWeight:v().Wy.medium}},style:l?{marginBottom:8,justifyContent:"space-between"}:{marginBottom:h?16:14,paddingLeft:h?16:8},tabBorderStyle:h?{left:0,right:0}:{}})),[n,l,h]),S=(0,r().IS)((e=>({tabStyle:{width:"50%",textAlign:"center",borderRadius:10,color:e.text.secondary,fontWeight:v().Wy.regular,paddingTop:2,paddingBottom:2},tabBorderStyle:{borderBottom:"none"},selectedTabStyle:{borderRadius:8,background:"dark"===e.mode?e.tint.regular:e.surface.elevated},tabTitleStyle:{color:"inherit",fontSize:(0,x().ny)(n,"UIRegular"),fontWeight:v().Wy.regular},selectedTabTitleStyle:{fontWeight:v().Wy.medium},style:{justifyContent:"space-between",padding:2,background:e.tint.regular,borderRadius:10,marginBottom:0,height:34}})),[n]),y=(0,r().IS)((e=>({publishTabContainer:{display:"flex",alignItems:"center"},publishIcon:{height:16,width:16,marginLeft:4,opacity:u===Z().QC.Publish?1:.5},tabBarContainer:{paddingLeft:20,paddingRight:20,paddingTop:8,paddingBottom:16,backgroundColor:e.surface.page}})),[u]),k=(0,i.useCallback)((e=>{const t=ne[e];t!==u&&(f().N(n,{tab:t}),t===Z().QC.Share&&Z().Ay.setState({...Z().Ay.state,display:Z().pP.MainShareMenu,tab:Z().QC.Share,source:Z().mc.ShareTab}),t===Z().QC.Publish&&Z().Ay.setState({...Z().Ay.state,display:Z().pP.Publish,tab:Z().QC.Publish}))}),[u,n]),C=$(),w=C&&C.emails.length>0,M=[(0,P.jsx)(i.Fragment,{children:l&&!h?(0,P.jsx)(p().sA,{defaultMessage:"Permissions",id:"shareMenu.permissionsTab.title"},"permissions"):(0,P.jsx)(p().sA,{defaultMessage:"Share",id:"shareMenu.shareTab.title"},"share")},"title"),(0,P.jsxs)("div",{ref:s,style:y.publishTabContainer,className:I().hKK,children:[(0,P.jsx)(p().sA,{defaultMessage:"Publish",id:"shareMenu.publishTab.title"},"publish"),c&&(0,d().J)(y.publishIcon)]},"publishTab")],j=(0,a().K8)((()=>J().A.state.siteSettingContentType),[]);return"seo"===j?(0,P.jsx)(le,{}):"embed"===j?(0,P.jsx)(de,{handleBackButtonClick:()=>{Y().Bp("initial")}}):l&&h?(0,P.jsx)("div",{style:y.tabBarContainer,children:(0,P.jsx)(A().Ay,{...S,tabs:M,selectedIndex:ne.indexOf(u),onChange:k,hideTabBorder:!0})}):(0,P.jsx)(A().Ay,{...b,tabs:M,selectedIndex:ne.indexOf(u),onChange:k,right:w&&C?(0,P.jsx)(R,{beamMetadata:C}):null})}function oe(e){let{inviteTargetsStore:t}=e;const n=(0,a().K8)((()=>(0,X().FI)()),[]),o=(0,r().IS)((e=>({container:n?{display:"flex",paddingLeft:12,paddingRight:12,marginBottom:16,height:40,boxShadow:`inset 0 -1px 0 ${e.regularDividerColor}`}:{display:"flex",margin:"0 12px 6px",height:48}})),[n]),s=(0,i.useCallback)((()=>{t.reset(),Z().Ay.setState({...Z().Ay.state,display:Z().pP.MainShareMenu,tab:Z().QC.Share,source:Z().mc.InviteBackButton})}),[t]);return(0,P.jsx)("div",{style:o.container,children:(0,P.jsx)(se,{onClick:s,titleMessage:n?(0,P.jsx)(p().sA,{id:"shareMenu.sendInvite.labelV2",defaultMessage:"Invite"}):(0,P.jsx)(p().sA,{id:"shareMenu.sendInvite.label",defaultMessage:"Send invite"})})})}function ae(e){const{source:t}=e,n=(0,p().tz)(),o=(0,r().IS)((()=>({container:{display:"flex",justifyContent:"space-between",margin:"0 12px",height:48,alignItems:"center"},titleLabel:{display:"flex",fontSize:12,alignItems:"center",fontWeight:v().Wy.semibold}})),[]),a=(0,i.useCallback)((()=>{Z().Ay.setState({...Z().Ay.state,tab:Z().QC.Share,display:Z().pP.Invite,source:Z().NL.Notion,focus:Z().yZ.Search,emailMessage:""})}),[]);return(0,P.jsxs)("div",{style:o.container,children:[(0,P.jsx)(y().A,{style:o.titleLabel,children:(0,P.jsx)(p().sA,{id:"shareMenu.addFromSlack.label",defaultMessage:"Add people from {integrationNameWithLogo}",values:{integrationNameWithLogo:(0,P.jsx)(re,{source:t})}})}),(0,P.jsx)(S().A,{ariaLabel:n.formatMessage({id:"shareMenuHeader.goBackToInviteFromNotionMenu.iconButton",defaultMessage:"Close external integration and go back to the main invite flow."}),icon:u().V,style:{borderRadius:"100%"},onClick:a})]})}function re(e){let{source:t}=e;const n=(0,r().IS)((()=>({imageStyle:{marginLeft:4,marginRight:4}})),[]);return t===Z().NL.Slack?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(b().A,{type:"image_url",imageURL:s().A.images.externalIntegrations.slackIconPng,size:18,imageStyle:n.imageStyle}),(0,P.jsx)(p().sA,{defaultMessage:"Slack",id:"shareMenu.slackIntegrationName.label"})]}):t===Z().NL.Google?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(b().A,{type:"image_url",imageURL:s().A.images.externalIntegrations.googleGIconPng,size:18,imageStyle:n.imageStyle}),(0,P.jsx)(p().sA,{defaultMessage:"Google",id:"shareMenu.googleContactsIntegrationName.label"})]}):void(0,h().HB)(t)}function se(e){const{onClick:t,titleMessage:n}=e,i=(0,o().v3)(),s=(0,a().K8)((()=>(0,X().FI)()),[]),d=(0,p().tz)(),u=(0,r().IS)((()=>({topContainer:{display:"flex",alignItems:"center",width:"max-content"},backButtonPressedStyle:{backgroundColor:"transparent"},iconButton:{marginRight:6,height:24,width:24},arrowIcon:{...s?{height:20,width:20}:{height:16,width:16},strokeWidth:v().Wy.semibold},sendInviteLabel:{fontWeight:v().Wy.medium,...s&&{fontSize:(0,x().ny)(i,"UIRegular")}}})),[i,s]);return(0,P.jsxs)("div",{style:u.topContainer,children:[(0,P.jsx)(S().A,{icon:s?c().Z:l().v,iconStyle:u.arrowIcon,style:u.iconButton,onClick:t,ariaLabel:d.formatMessage({id:"shareMenu.backButton.iconButton",defaultMessage:"Go back to main share menu."})}),(0,P.jsx)(y().A,{style:u.sendInviteLabel,children:n})]})}function le(){const e=(0,r().IS)((e=>({container:{display:"flex",padding:"0 12px 0 8px",height:40,borderBottom:`1px solid ${e.stroke.secondary}`}})),[]),t=(0,i.useCallback)((()=>{Y().Bp("initial")}),[]);return(0,P.jsx)("div",{style:e.container,children:(0,P.jsx)(se,{onClick:t,titleMessage:(0,P.jsx)(p().sA,{...ee.seo})})})}function de(e){const t=(0,r().IS)((e=>({container:{display:"flex",padding:"0 12px 0 8px",height:40,borderBottom:`1px solid ${e.stroke.secondary}`}})),[]);return(0,P.jsx)("div",{style:t.container,children:(0,P.jsx)(se,{onClick:e.handleBackButtonClick,titleMessage:(0,P.jsx)(p().sA,{...ee.embed})})})}},525700:(e,t,n)=>{n.d(t,{Bp:()=>U,DD:()=>W,E9:()=>G,H6:()=>j,HE:()=>B,HY:()=>_,JI:()=>z,Nf:()=>K,P8:()=>q,V_:()=>Q,XL:()=>N,Xz:()=>H,aD:()=>P,aN:()=>F,d7:()=>L,d8:()=>C,j4:()=>O,n0:()=>V,pu:()=>E,uH:()=>T,uY:()=>$,wl:()=>R,yF:()=>D,zV:()=>M});n(16280),n(944114),n(898992),n(354520),n(581454),n(296540);var i=()=>n(68263),o=()=>n(161479),a=()=>n(101628),r=()=>n(245241),s=()=>n(959013),l=()=>n(496603),d=()=>n(498212),c=()=>n(449506),u=()=>n(246826),m=()=>n(755636),g=()=>n(436572),p=()=>n(317909),h=()=>n(780054),v=()=>n(594794),f=()=>n(976721),b=()=>n(562800),S=()=>n(40226),y=()=>n(380682),A=()=>n(300451),I=()=>n(676870),x=()=>n(435212),k=n(474848);function C(e){const{environment:t,store:n,type:i,header:r,domainId:s}=e,l=n.getSiteStore();if(l)return l.id;let d=s;var c;d||(d=null===(c=b().Nq(n.getSpaceStore()))||void 0===c?void 0:c.id);const m=(0,v().JH)({environment:t,table:a().Eu,spaceId:(0,o().e)(n.getSpaceId())});p().createAndCommit({userAction:"publishSite.create",environment:t,canUndo:!0,perform:e=>{const o=u().vt({environment:t,table:m.table,args:{id:m.id,type:i,spaceId:m.spaceId,blockId:n.id,domainId:d,currentUserId:t.currentUser.id,header:r??{}},inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,transaction:e});return u().zv({store:n.getFormatStore(),data:{site_id:o.id},transaction:e}),o.id}})}function w(e){const{environment:t,siteRootBlockStore:n,domainId:i}=e;let o=n.getSiteStore();if(o||(C({environment:t,type:"site",store:n,domainId:i}),o=n.getSiteStore()),o)return o}function M(e){const{environment:t,domainId:n,resetWatermark:i}=e,o=w(e);o&&o.isDefined()&&(p().createAndCommit({userAction:"publishSite.updatePublicDomain",environment:t,canUndo:!0,perform:e=>{o.getDomainId()!==n&&p().applyOperation({transaction:e,store:o,operation:o.getModel().ops.updatePublicDomainId({domainId:n,currentUserId:t.currentUser.id})})}}),p().createAndCommit({userAction:"publishSite.resetWatermark",environment:t,canUndo:!0,perform:e=>{if(i){const n=o.getHeader();p().applyOperation({transaction:e,store:o,operation:o.getModel().ops.updateHeader({header:{...n,hideWatermark:!1},currentUserId:t.currentUser.id})})}}}),g().D6({label:(0,k.jsx)(s().sA,{id:"publishSiteSettings.publicDomain.confirmation",defaultMessage:"Successfully updated domain for all pages within this site"})}))}function j(e){const{environment:t,siteRootBlockStore:n,isSearchEngineIndexingEnabled:i}=e,a=w(e);if(!a)return;"form"!==a.getType()&&p().createAndCommit({userAction:"publishSite.updateSeoEnabled",environment:t,canUndo:!0,perform:e=>{a&&a.isDefined()&&i!==a.isSearchEngineIndexingEnabled()&&(p().applyOperation({transaction:e,store:a,operation:a.getModel().ops.updateIsSearchEngineIndexingEnabled({isSearchEngineIndexingEnabled:i,currentUserId:t.currentUser.id})}),i&&e.postSubmitCallbacks.push((async e=>{e||await c().callApi({eventName:"enqueueScanContentTask",environment:t,data:{pagePointer:{id:n.id,table:"block",spaceId:(0,o().e)(n.pointer.spaceId)}}})})))}})}function B(e){const{environment:t,store:n,seoTitle:i,seoDescription:o}=e;p().createAndCommit({userAction:"publishSite.create",environment:t,canUndo:!0,perform:e=>{const a=n.getFormat().seo_title,r=n.getFormat().seo_description;a===i&&r===o||(u().zv({store:n.getFormatStore(),data:{seo_title:i,seo_description:o},transaction:e}),(0,I().NZ)(t,{target_block_id:n.id,new_title:i??null,new_description:o??null}),g().D6({label:(0,k.jsx)(s().sA,{id:"siteSettingsEditor.publishSeoChanges.confirmation",defaultMessage:"Successfully updated the SEO settings"})}))}})}function P(e){A().A.setState({...A().A.state,settingOpen:e})}function R(){A().A.setState({...A().A.state,settingOpen:"initial"})}function U(e){y().A.setState({...y().A.state,siteSettingContentType:e})}function _(e){var t,n,i;const{siteRootBlockStore:o,permissionItem:a,from:r,sudoModeStore:s}=e,l=o.getSiteStore(),d=null==l?void 0:l.getHeader(),c=(null==d||null===(t=d.customItems)||void 0===t?void 0:t.map((e=>e.blockId)))||[];A().A.setState({settingOpen:"initial",permissionItem:a,from:r,sudoModeStore:s,faviconUrl:(null==l?void 0:l.getFaviconUrl())||null,previewImageUrl:(null==l?void 0:l.getPreviewImageUrl())||null,hideBreadcrumbs:null==d?void 0:d.hideBreadcrumbs,hideSearch:null==d?void 0:d.hideSearch,hideWatermark:null==d?void 0:d.hideWatermark,enableDuplicateAsTemplate:a.allow_duplicate,customHeaderBlockIds:c,googleAnalyticsId:null==l?void 0:l.getGoogleAnalyticsId(),theme:null==l||null===(n=l.getSettings())||void 0===n?void 0:n.theme,enableQna:null==l||null===(i=l.getSettings())||void 0===i?void 0:i.enableQna})}async function T(e){var t;const{environment:n,store:o,siteRootBlockStore:a}=e,r=w({environment:n,siteRootBlockStore:a}),u=null==r?void 0:r.getType();if(!r||"form"===u)return;const m=A().A.getState();let h=!1;const v={};let S;m.enableQna&&(S=await async function(e){var t,n,i,o;const{environment:a,siteStore:r}=e,s=null===(t=r.getSettings())||void 0===t?void 0:t.siteUserId;if(s)return s;if(!((null===(n=r.getDomainStore())||void 0===n?void 0:n.getDomainName())??(null===(i=b().Nq(r.getSpaceStore()))||void 0===i?void 0:i.domain_name)))throw new Error("no domain on site");const l=b().Ix({spaceStore:r.getSpaceStore(),domainId:null===(o=r.getDomainStore())||void 0===o?void 0:o.id}).split(":")[0],u=`${(0,d().S2)(r.id)}@${l}`,m=await c().callApi({eventName:"createEmailUser",environment:a,data:{email:u}});if("failed"===m.type)throw new Error("failed to create qna user");return m.data.userId}({environment:n,siteStore:r})),p().createAndCommit({userAction:"publishSite.updateSiteSettingsInEditor",environment:n,canUndo:!0,perform:e=>{if(r&&r.isDefined()){var t,i;(r.getFaviconUrl()||null)!==m.faviconUrl&&(p().applyOperation({transaction:e,store:r,operation:r.getModel().ops.updateFaviconUrl({faviconUrl:m.faviconUrl,currentUserId:n.currentUser.id})}),h=!0,v.favicon=m.faviconUrl);(r.getPreviewImageUrl()||null)!==m.previewImageUrl&&(p().applyOperation({transaction:e,store:r,operation:r.getModel().ops.updatePreviewImageUrl({previewImageUrl:m.previewImageUrl,currentUserId:n.currentUser.id})}),h=!0,v.preview_image=m.previewImageUrl);const o=r.getHeader();let a=o;const s=function(e,t){const n=e.map((e=>({type:"block",blockId:e})));if(!t&&0===n.length)return;if(t&&(0,l().n4)(n,t))return;return n}(m.customHeaderBlockIds,null==o?void 0:o.customItems);s&&(a={...a,customItems:s},v.custom_headers=s.map((e=>e.blockId))),(null==o?void 0:o.hideBreadcrumbs)!==m.hideBreadcrumbs&&(a={...a,hideBreadcrumbs:m.hideBreadcrumbs},v.hide_breadcrumbs=m.hideBreadcrumbs),(null==o?void 0:o.hideSearch)!==m.hideSearch&&(a={...a,hideSearch:m.hideSearch},v.hide_search=m.hideSearch),(null==o?void 0:o.hideWatermark)!==m.hideWatermark&&(a={...a,hideWatermark:m.hideWatermark},v.hide_watermark=m.hideWatermark),a&&o!==a&&(p().applyOperation({transaction:e,store:r,operation:r.getModel().ops.updateHeader({header:a,currentUserId:n.currentUser.id})}),h=!0);r.getGoogleAnalyticsId()!==m.googleAnalyticsId&&(p().applyOperation({transaction:e,store:r,operation:r.getModel().ops.updateGoogleAnalyticsId({googleAnalyticsId:m.googleAnalyticsId,currentUserId:n.currentUser.id})}),h=!0,v.google_analytics_id=m.googleAnalyticsId);(null===(t=r.getSettings())||void 0===t?void 0:t.theme)!==m.theme&&(p().applyOperation({transaction:e,store:r,operation:r.getModel().ops.updateTheme({theme:m.theme,currentUserId:n.currentUser.id})}),h=!0,v.theme=m.theme);(null===(i=r.getSettings())||void 0===i?void 0:i.enableQna)!==m.enableQna&&(m.enableQna?S&&p().applyOperation({transaction:e,store:r,operation:{pointer:r.pointer,command:"update",path:["settings"],args:{enableQna:m.enableQna,siteUserId:S}}}):p().applyOperation({transaction:e,store:r,operation:{pointer:r.pointer,command:"update",path:["settings"],args:{enableQna:m.enableQna}}}),h=!0)}}});if((null===(t=m.permissionItem)||void 0===t?void 0:t.allow_duplicate)!==m.enableDuplicateAsTemplate&&m.permissionItem&&m.from){const e=(0,i().Yi)(m.from);(0,f().Hc)({oldPermissionItem:m.permissionItem,newPermissionItem:{...m.permissionItem,allow_duplicate:m.enableDuplicateAsTemplate},wasInherited:e!==o.id,environment:n,store:o,sudoModeStore:m.sudoModeStore,location:"published_site_settings"}),h=!0,v.enable_duplicate_as_template=m.enableDuplicateAsTemplate}h&&((0,x().Kz)(n,{settings_changed:v}),g().D6({label:(0,k.jsx)(s().sA,{id:"siteSettingsEditor.publishChanges.confirmation",defaultMessage:"Changes published"})}))}function E(e){A().A.setState({...A().A.state,faviconUrl:e})}function D(e){A().A.setState({...A().A.state,previewImageUrl:e})}function W(e){A().A.setState({...A().A.state,hideBreadcrumbs:e})}function N(e){A().A.setState({...A().A.state,hideSearch:e})}function H(e){A().A.setState({...A().A.state,hideWatermark:e})}function L(e){A().A.setState({...A().A.state,enableDuplicateAsTemplate:e})}function F(e){const t=A().A.state.customHeaderBlockIds.concat([e]);A().A.setState({...A().A.state,customHeaderBlockIds:t})}function z(e){const t=A().A.state.customHeaderBlockIds.filter((t=>t!==e));A().A.setState({...A().A.state,customHeaderBlockIds:t})}function K(e){A().A.setState({...A().A.state,googleAnalyticsId:e})}function Q(e){A().A.setState({...A().A.state,theme:e})}async function O(e){const{environment:t,spaceStore:n,query:i,siteRootBlockId:o}=e;if(!n)return;const a=await c().callApi({eventName:"searchPagesInSite",environment:t,data:{query:i,spaceId:n.id,filters:r().N2({isDeletedOnly:!1,navigableBlockContentOnly:!0,excludeTemplates:!0,editedBy:[],ancestors:[o],inTeams:[]}),sort:{field:"relevance"},limit:10}});return"failed"!==a.type?a.data:void 0}async function V(e){const{environment:t,blockStore:n,slug:i}=e,o=await c().callApi({eventName:"updatePublicPageSlug",environment:t,data:{spaceId:n.getSpaceId(),blockId:n.id,slug:i,clientVersion:h().A.version}});if("success"!==o.type)return{error:o};g().D6({label:(0,k.jsx)(s().sA,{id:"customSlugInput.updateSuccess.toast",defaultMessage:"Successfully updated URL for this page"})})}function q(e){A().A.setState({...A().A.state,enableQna:e})}function $(e){const{environment:t,store:n,pageVisitSource:i}=e,o=S().R({store:n,pageVisitSource:i});m().f({environment:t,url:o})}function G(e){const{environment:t,siteStore:n,embedSettings:i}=e;p().createAndCommit({userAction:"embedSite.updateEmbedSettings",environment:t,canUndo:!0,perform:e=>{u().zv({store:n.getSettingsStore(),data:{embedSettings:i},transaction:e})}})}},608581:(e,t,n)=>{n.d(t,{A:()=>c});n(898992),n(354520),n(581454),n(941795);var i=n(296540),o=()=>n(401497),a=()=>n(451306),r=()=>n(284371),s=()=>n(963575),l=n(474848);function d(e){const{button:t,isLast:n}=e,s=(0,o().IS)((e=>({button:{display:"flex",alignItems:"center",padding:"4px 6px",fontWeight:r().Wy.medium,borderRight:`1px solid ${e.regularDividerColor}`,color:e.actionMenuButtonTextColor,fill:e.actionMenuButtonTextColor},buttonLast:{borderRight:"none"},buttonHovered:{background:e.whiteButtonHoveredBackground},buttonPressed:{background:e.whiteButtonPressedBackground}})),[]);return i.cloneElement(t,{...(0,a().AH)(t.props.style,s.button,n&&s.buttonLast),hoveredStyle:(0,a().AH)(s.buttonHovered,n&&s.buttonLast).style,pressedStyle:s.buttonPressed})}const c=function(e){let{children:t,isVisible:c,position:u,style:m}=e;const g=(0,n(484714).v3)(),p=(0,o().IS)((e=>({container:{color:e.actionMenuButtonTextColor,fill:e.actionMenuButtonTextColor,fontSize:12,background:e.whiteButtonBackground,boxShadow:e.shadowSM,display:"flex",whiteSpace:"nowrap",borderRadius:s().A.borderRadius,maxWidth:"calc(100% - 16px)",minHeight:24,overflow:"hidden",pointerEvents:g.device.isMobile?"auto":"none",opacity:g.device.isMobile?1:0,fontFamily:r().vc(n(662303).locale).sans,position:"absolute",right:s().A.horizontal.small,bottom:s().A.vertical.small,zIndex:2},containerHover:{pointerEvents:"auto",opacity:1},containerTop:{top:s().A.vertical.small,bottom:void 0}})),[g]),h=i.Children.toArray(t).filter(n(534177).O9),v=h.length;return(0,l.jsx)(n(145214).A,{animate:{opacity:c?1:0},...(0,a().AH)(p.container,m,c&&p.containerHover,"top"===u&&p.containerTop),children:h.map(((e,t)=>{const o=t===v-1;if(e&&"object"==typeof e&&"type"in e){if(e.type===n(859428).A&&i.isValidElement(e))return i.cloneElement(e,{render:(t,n)=>{const i=e.props.render(t,n);return(0,l.jsx)(d,{isLast:o,button:i},e.key)}});if(e.type===n(704152).A&&i.isValidElement(e))return(0,l.jsx)(d,{isLast:o,button:e},e.key)}}))})}},676870:(e,t,n)=>{n.d(t,{EN:()=>o,Ex:()=>a,NZ:()=>r,T6:()=>l,i_:()=>s,kW:()=>d});var i=()=>n(989423);function o(e,t){(0,i().u4)({environment:e,event:{eventName:"open_publish_modal",eventProperties:t}})}function a(e,t){(0,i().u4)({environment:e,event:{eventName:"change_domain",eventProperties:t}})}function r(e,t){(0,i().u4)({environment:e,event:{eventName:"update_seo_settings",eventProperties:t}})}function s(e,t){(0,i().u4)({environment:e,event:{eventName:"site_set_link_expiration",eventProperties:t}})}function l(e,t){(0,i().u4)({environment:e,event:{eventName:"page_unpublish",eventProperties:t}})}function d(e,t){(0,i().u4)({environment:e,event:{eventName:"page_publish",eventProperties:t}})}},703875:(e,t,n)=>{n.d(t,{N:()=>a,V:()=>o});var i=()=>n(989423);function o(e){i().vd(e,"view_public_site_click")}function a(e,t){i().vd(e,"share_menu_tab_click",t)}},801678:(e,t,n)=>{n.d(t,{A:()=>v});var i=n(296540),o=()=>n(662303),a=()=>n(484714),r=()=>n(56366),s=()=>n(451306),l=()=>n(959013),d=()=>n(100622),c=()=>n(496603),u=()=>n(284371),m=()=>n(720665),g=()=>n(145214),p=n(474848);const h={isRepositioning:!1};const v=function(e){const t=(0,i.useRef)(null),o=(0,a().v3)(),{isMobile:l}=(0,a().Y0)(),[d,u]=(0,i.useState)(h),g=(0,i.useCallback)((()=>{u(h)}),[]),{renderControl:v,onFlushTemporaryPosition:b,style:S,source:y,store:A}=e,{isRepositioning:I,image:x,startDragRenderedPosition:k,startDragImageScreenHeight:C}=d,w=(0,r().K8)((()=>0===n(502438).default.state.stores.length),[]),[M,j]=(0,i.useState)(!1),B=(0,r().uB)(e.mouseStore,n(454305).A),P=(0,r().K8)((()=>B.state.mouseEntered),[B]),R=(0,n(401497).IS)((()=>({dragContainer:{width:"100%",cursor:I?"move":"inherit"},container:{position:"relative",width:"100%",zIndex:1}})),[I]),U=(0,r().K8)((()=>function(e,t,n){return(0,c().Et)(n)?n:function(e,t){if("gallery"===e||"board"===e){const e=t.getFormat().card_cover_position;if((0,c().Et)(e))return e}const n=.5;if(t.isCollectionView()){const e=t.getCollectionStore();if(e){const t=e.getFormat().collection_cover_position;return(0,m().pN)(t)?n:t}}const i=t.getFormat(),o=i.page_cover_position;if((0,c().Et)(o))return o;return n}(e,t)}(y,A,d.temporaryPosition)),[d.temporaryPosition,y,A]);(0,i.useEffect)((()=>{const e=e=>{const n=t.current;n&&!n.contains(e.target)&&I&&b({imagePosition:U,reset:()=>{B.reset(),g()}})};return window.addEventListener("mousedown",e),()=>window.removeEventListener("mousedown",e)}),[U,I,B,b,g]),I&&!w&&g();const _=(0,i.useMemo)((()=>(0,c().nF)((e=>{B.setState({...B.state,mouseEntered:!0})}),100)),[B]),T=(0,i.useMemo)((()=>(0,c().sg)((e=>{B.setState({...B.state,mouseEntered:!1})}),100)),[B]),E=(0,i.useCallback)(((e,t)=>{n(778417).IU({environment:o});const i=new Image;i.onload=()=>{u((e=>({...e,isRepositioning:!0,image:i})))},t&&(i.src=t)}),[o]),D=(0,i.useCallback)((e=>{b({imagePosition:U,reset:()=>{g()}})}),[U,b,g]),W=(0,i.useCallback)((e=>{const t=e.target;void 0!==t&&t instanceof HTMLElement&&(0,n(819121).p)(t)&&j(!0)}),[]),N=(0,i.useCallback)((()=>{j(!0)}),[]),H=(0,i.useCallback)((e=>{if(x&&I){const e=t.current;if(e&&e instanceof Element){const t=e.getBoundingClientRect().width/x.width*x.height;u((e=>({...e,startDragImageScreenHeight:t,startDragRenderedPosition:U})))}}}),[x,U,I]),L=(0,i.useCallback)((e=>{if(I){const t=e.diffY/(C||0)+(k||0);u((e=>({...e,temporaryPosition:(0,c().LI)((0,n(40845).A)(t,0,1),4)})))}}),[I,C,k]),F=(0,i.useCallback)((()=>{u((e=>({...e,startDragImageScreenHeight:void 0,startDragRenderedPosition:void 0})))}),[]),z=(0,r().K8)((()=>v({handleRepositionClick:E,handleSavePositionClick:D,handleCancelClick:g,isVisible:l||P||M||I,isRepositioning:I})),[E,D,M,l,I,P,v,g]);return(0,p.jsxs)("div",{ref:t,onFocus:W,onBlur:N,onMouseEnter:_,onMouseMove:_,onMouseLeave:T,...(0,s().AH)(R.container,S),children:[(0,p.jsx)(n(603820).A,{onDraggableDragStart:H,onDraggableDragMove:L,onDraggableDragEnd:F,onDraggableDragCancel:F,disabled:!I,render:t=>(0,p.jsx)("div",{...(0,s().AH)(R.dragContainer),...t,children:e.render({imagePosition:U,isRepositioning:I})})}),(0,p.jsx)(f,{small:e.small,isRepositioning:I}),z]})};function f(e){let{small:t,isRepositioning:n}=e;if(t)return null;const i={background:d().Ay.blackWithAlpha(.4),borderRadius:4,color:d().Ay.white,fontSize:12,fontFamily:u().vc(o().locale).sans,width:180,left:"calc(50% - 90px)",padding:"0.3em 1.5em 0.3em",pointerEvents:"none",position:"absolute",top:"calc(50% - 10px)",textAlign:"center"};return(0,p.jsx)(g().A,{visible:n,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:i,children:(0,p.jsx)(l().sA,{defaultMessage:"Drag image to reposition",id:"withImageRepositioning.dragImage.text"})})}},883626:(e,t,n)=>{n.d(t,{Hs:()=>o,nw:()=>r,vI:()=>s});var i=()=>n(720665);const o=100,a=5*i().Xb,r=15*i().TD;function s(e){return!!e.sendDateMs&&Date.now()-e.sendDateMs<=a}},943647:(e,t,n)=>{n.d(t,{A:()=>b});var i=n(296540),o=()=>n(484714),a=()=>n(56366),r=()=>n(959013),s=()=>n(896628),l=()=>n(454531),d=()=>n(317909),c=()=>n(478726),u=()=>n(867772),m=()=>n(681810),g=()=>n(608581),p=()=>n(145214),h=()=>n(704152),v=()=>n(24611),f=n(474848);const b=function(e){let{store:t,disabled:r,paddingRight:l,paddingLeft:c,height:g,proxyWidth:p}=e;const h=(0,o().v3)(),v=(0,a().uB)(void 0,n(454305).A),b=(0,a().K8)((()=>r||"suggest"===n(77246).Uv.getMode(t)),[r,t]),A=(0,a().K8)((()=>t.getCover()),[t]),I=(0,a().O$)(m().A),[x,k]=(0,i.useState)(void 0);if(!A)return null;const C=I.loadingMode!==u().pF&&I.loadingMode!==u().Wc;return(0,f.jsx)(n(801678).A,{mouseStore:v,onFlushTemporaryPosition:e=>function(e,t,n){const{imagePosition:i,reset:o}=e;d().createAndCommit({userAction:"PageCover.handleFlushTemporaryPosition",environment:n,canUndo:!0,perform:e=>{s().yY({store:t,coverPosition:i,transaction:e}),o()}})}(e,t,h),renderControl:e=>{let{handleRepositionClick:n,handleSavePositionClick:i,handleCancelClick:o,isVisible:a,isRepositioning:r}=e;return(0,f.jsx)(y,{handleRepositionClick:n,handleSavePositionClick:i,handleCancelClick:o,isVisible:a,isRepositioning:r,lastProxiedUrl:x,store:t,disabled:b,paddingRight:l,paddingLeft:c,mouseStore:v})},source:"page",store:t,style:{display:"flex",flexDirection:"column",alignItems:"center",height:g,maxHeight:280,cursor:"default"},render:e=>(0,f.jsxs)(i.Fragment,{children:[(0,f.jsx)(n(360083).A,{url:A.cover,isAuthenticated:!0,permissionRecord:A.pointer,width:p,onFinishedLoadingProxyUrl:k,render:(t,i)=>{const o={width:"100%",height:g,maxHeight:280,objectFit:"cover",opacity:C?.5:1,objectPosition:`center ${100*(1-(e.imagePosition||0))}%`,borderRadius:0},a={width:"100%",height:g,maxHeight:280};return(0,f.jsx)(n(307440).E,{src:i,placeholderSrc:C?I.dataURL:void 0,placeholderBehavior:C?"force-show-placeholder":"show-placeholder-if-loading-src",containerStyle:a,imageStyle:o,onLoadComplete:S,testId:"pageCover"})}}),C&&(0,f.jsxs)("div",{style:n(816559).fd,children:[(0,f.jsx)(n(331542).A,{size:"md",style:{marginRight:4}}),(0,f.jsx)("div",{style:{minWidth:30,textAlign:"right"},children:(0,f.jsx)(n(773382).A,{percentage:I.uploadProgress})})]})]})})};function S(){m().A.reset()}function y(e){let{isVisible:t,isRepositioning:n,handleCancelClick:s,handleRepositionClick:d,handleSavePositionClick:b,lastProxiedUrl:S,store:y,disabled:A,paddingRight:I,paddingLeft:x,mouseStore:k}=e;const C=(0,o().v3)(),w=(0,r().tz)(),M=(0,i.useCallback)((e=>function(e,t,n,i,o){o.reset();const a=e.target.getBoundingClientRect();l().W({environment:t,intl:n,store:i,rect:a})}(e,C,w,y,k)),[C,w,y,k]),j=(0,a().K8)((()=>m().A.state.loadingMode),[]),B=(0,a().K8)((()=>function(e){let t;return t=e.isFullWidth()?"100%":c().x6,t}(y)),[y]);if(A||j!==u().pF)return null;const{device:P}=C,{isMobile:R}=P;return(0,f.jsx)(p().A,{animate:{width:B,opacity:t?1:0},style:{position:"absolute",pointerEvents:t?"auto":"none",maxWidth:"100%",top:48},children:(0,f.jsxs)(g().A,{isVisible:t,position:"bottom",style:{marginRight:I,marginLeft:x},children:[!n&&(0,f.jsx)(h().A,{style:{borderRight:R?"none":void 0,...v().k},onClick:M,children:(0,f.jsx)(r().sA,{defaultMessage:"Change cover",id:"pageCover.changeCover.text"})}),!n&&!R&&(0,f.jsx)(h().A,{style:{...v().k,borderRight:"none"},onClick:e=>d(e,S),children:(0,f.jsx)(r().sA,{defaultMessage:"Reposition",id:"pageCover.reposition.text"})}),n&&!R&&(0,f.jsx)(h().A,{style:v().k,onClick:b,children:(0,f.jsx)(r().sA,{defaultMessage:"Save position",id:"pageCover.savePosition.text"})}),n&&!R&&(0,f.jsx)(h().A,{style:{...v().k,borderRight:"none"},onClick:s,children:(0,f.jsx)(r().sA,{defaultMessage:"Cancel",id:"pageCover.reposition.cancelText"})})]})})}},954845:(e,t,n)=>{n.d(t,{J:()=>o});n(296540);var i=n(474848);const o=(0,n(340498).wt)("blueCircleDot",{viewBox:"0 0 16 16",svg:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("circle",{cx:"8",cy:"8",r:"8",fill:"none",stroke:"#2383E2",children:[(0,i.jsx)("animate",{attributeName:"r",from:"3",to:"8",dur:"1s",begin:"0s",repeatCount:"indefinite"}),(0,i.jsx)("animate",{attributeName:"opacity",from:"1",to:"0",dur:"1s",begin:"0s",repeatCount:"indefinite"})]}),(0,i.jsx)("circle",{cx:"8",cy:"8",r:"3",fill:"#2383E2"})]})})}}]);