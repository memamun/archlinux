"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[22542,55776],{66529:(e,t,n)=>{n.r(t),n.d(t,{getFormulaEditorInfoAtPosition:()=>g});n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(354520),n(672577),n(803949),n(581454);var o=()=>n(303151),r=()=>n(763824),i=()=>n(973647),a=()=>n(467730),s=()=>n(510916),c=()=>n(958970),l=()=>n(247331),p=()=>n(106714),u=()=>n(44907),d=()=>n(871202),y=()=>n(622317),m=()=>n(349835),f=()=>n(977345),h=()=>n(943707);async function v(e,t,n){const o=[],i=new Set;if(void 0!==e){const a=t.handleDataRequest({recordPointers:[e]}),s=((0,r().yL)(a)?await a:a).getRecordModel(e),c=null==s?void 0:s.getNormalizedSchema();if(c)for(const[r,p]of Object.entries(c))if(void 0!==(null==p?void 0:p.type)&&l().FormulaTokenSupportedBlockSystemPropertyList.includes(null==p?void 0:p.type)&&i.add(p.type),r!==t.sourceProperty&&null!=p&&p.name&&l().FORMULAS_SUPPORTED_COLLECTION_PROPERTY_TYPES.includes(null==p?void 0:p.type)&&T(n,p.name)){let n;"cross_space_only"===t.restrictUnaccessibleProperties?n=d().hasSameSpaceAccess:"read_permissions_only"===t.restrictUnaccessibleProperties?n=d().hasReadPermissionsAccess:"cross_space_and_read_permissions"===t.restrictUnaccessibleProperties&&(n=d().hasAccessDefaultFn);(!t.restrictUnaccessibleProperties||!n||await(0,d().hasAccessToProperty)({collectionPointer:e,collectionSchema:c,context:t,propertyId:r,hasAccessFn:n}))&&o.push({kind:l().FormulaEditorInfoCompletionKind.Token,name:p.name,token:{type:l().FormulaTokenType.BlockProperty,property:(0,f().XH)(r),collection:e}})}}for(const r of Object.values(l().FormulaTokenSupportedBlockSystemProperty)){if(i.has(r))continue;const e=(0,s().i)(r);(""===n||T(n,e))&&o.push({kind:l().FormulaEditorInfoCompletionKind.Token,token:{type:l().FormulaTokenType.BlockProperty,property:r,collection:void 0},name:e})}return o}function T(e,t){return""===e||(0,a().It)(e,t)}async function k(e){const{prefix:t,context:n,receiverType:o,includeDeprecatedCompletions:r,dotMemberExpression:i}=e,s=[],c=[],p=[],u=new Set;if(void 0===o){var d;n.valueTypes.forEach((e=>{if(e.kind===l().FormulaContextValueKind.Binding){const n=e.id;!u.has(n)&&t!==e.id&&T(t,e.id)&&(s.push({kind:l().FormulaEditorInfoCompletionKind.Binding,text:n,type:e.type}),u.add(n))}}));const e=null===(d=n.valueTypes.find((e=>e.kind===l().FormulaContextValueKind.ThisRow)))||void 0===d?void 0:d.type;"block"===(null==e?void 0:e.type)&&void 0!==e.collection&&c.push(...await v(e.collection,n,t)),n.valueTypes.forEach((e=>{if(e.kind===l().FormulaContextValueKind.ContextValue&&T(t,e.name)){const t=(0,f().Bk)(e.id);c.push({kind:l().FormulaEditorInfoCompletionKind.Token,name:e.name,token:{type:l().FormulaTokenType.ContextValue,valueId:t}})}}))}else"block"===o.type&&c.push(...await v(o.collection,n,t));for(const a in h().LP)if(!u.has(a)&&T(t,a)&&(r||!a.startsWith("_"))&&("toNumber"!==a||null==o||!o.type||!h().Qi.includes(o.type))&&(!i||!h().bq.includes(a))){const e=h().LP[a];if(void 0!==o){var y,m;const t=(null===(y=e.parameters)||void 0===y||null===(y=y.expected)||void 0===y||null===(y=y[0])||void 0===y?void 0:y.type)??(null===(m=e.parameters)||void 0===m||null===(m=m.varargs)||void 0===m||null===(m=m[0])||void 0===m?void 0:m.type);if(void 0===t||!(0,f().s7)(o,t))continue}p.push({kind:l().FormulaEditorInfoCompletionKind.LibraryFunction,libraryFunction:e}),u.add(a)}return[...(0,a().Ay)(t,s,(e=>e.text)),...(0,a().Ay)(t,c,(e=>e.name??"")),...(0,a().Ay)(t,[],(e=>e.builtin)),...(0,a().Ay)(t,p,(e=>e.libraryFunction.name))]}function b(e,t){const n=[...e].reverse().find((e=>e.kind===m().NM.Call));if((null==n?void 0:n.kind)===m().NM.Call){let e=-1;if(t>n.lParenOffset&&(void 0===n.rParenOffset||t<=n.rParenOffset))for(e=0;e<n.commaOffsets.length&&!(n.commaOffsets[e]>t);e++);return{expression:n.expression,parameterIndex:e}}}const x={[l().FormulaEditorInfoCompletionKind.Binding]:0,[l().FormulaEditorInfoCompletionKind.Token]:1,[l().FormulaEditorInfoCompletionKind.Builtin]:2,[l().FormulaEditorInfoCompletionKind.LibraryFunction]:3};async function g(e){var t,n;const{formula:r,inputPosition:a,context:s,includeDeprecatedCompletions:d}=e,[v,g]=(0,p().kb)(r),I=(0,p().NZ)(g,a);let C=v.substring(0,I);const F=C[C.length-1],A=/[\s.]/.test(F);A&&(C=`${C}_`);const M=(0,u().p8)(),N=(0,u().TM)(M).tokenize(C).tokens,E=(0,u()._M)(M);E.input=N;const S=E.expression(),R=(0,c().f)(S);if(i().Q.isFail(R))return{value:void 0};const O=await(0,y()._)(R.value,s,g),{node:w}=O,X=N[N.length-1];let U=!1,D=N;void 0!==X&&(0,o().G)(X,M.IdentifierName)&&(D=[...D],D.pop(),U=!0);const W=E.computeContentAssist("expression",D),_=U?X.image.substring(0,X.image.length-(A?1:0)):void 0,L=(0,f().Kp)(w,I),B={inputPosition:a,mappedPosition:I,nodePath:L,callParameter:b(L,I)},z=[],V=b(L,I),K={handleDataRequest:s.handleDataRequest,restrictUnaccessibleProperties:s.restrictUnaccessibleProperties,sourceProperty:s.sourceProperty,spaceId:s.spaceId,valueTypes:w.valueTypes,featureGates:s.featureGates};let H;for(let o=1;o<=5;o++){const e=(0,f().Kp)(w,I-o);if(H=e[e.length-1],void 0!==H)break}(null===(t=H)||void 0===t?void 0:t.kind)===m().NM.RecoveryNode&&(H=void 0);const q=void 0!==H&&0===L.length,G=!H||H.kind===m().NM.Unary||H.kind===m().NM.Equality||H.kind===m().NM.Identifier,j=!H||H.kind===m().NM.Equality||H.kind===m().NM.Identifier;for(const i of W){var Q,$,J,Y,Z,ee,te,ne,oe;if(i.nextTokenType===M.IdentifierName){const e="dotMemberExpression"===i.ruleStack[i.ruleStack.length-1];if(e){const t=D[D.length-1];if(!(0,o().G)(t,M.Dot))return{value:void 0};const n=L[L.length-1];if(void 0!==n&&(n.kind===m().NM.UnifiedFunctionProperty||n.kind===m().NM.MemberBlockProperty)){const t=n.expression;B.completionsInfo={type:"member dot receiver",prefix:_,receiverNode:t};const o=await k({prefix:_??"",context:K,receiverType:t.type,includeDeprecatedCompletions:d,dotMemberExpression:e});z.push(...o)}}else{B.completionsInfo={type:"free identifier",prefix:_};const t=await k({prefix:_??"",context:K,includeDeprecatedCompletions:d,dotMemberExpression:e});if(z.push(...t),V&&(V.expression.kind===m().NM.UnifiedFunctionProperty&&0===V.parameterIndex||V.expression.kind===m().NM.Identifier&&1===V.parameterIndex)){const e=V.expression.kind===m().NM.UnifiedFunctionProperty?V.expression.name:V.expression.text,t=h().LP[e];if(((null==t?void 0:t.parameters)===h().Ux||(null==t?void 0:t.parameters)===h().MB)&&T(_??"",l().CURRENT_VALUE_NAME)&&_!==l().CURRENT_VALUE_NAME&&_!==`${l().CURRENT_VALUE_NAME}.`){var re,ie;const e=V.expression,t="function"===e.type.type&&"array"===(null===(re=e.type.boundTargetType)||void 0===re?void 0:re.type)&&(null===(ie=e.type.boundTargetType)||void 0===ie?void 0:ie.of)||{type:"unknown"};z.push({kind:l().FormulaEditorInfoCompletionKind.Binding,text:l().CURRENT_VALUE_NAME,type:t}),z.push({kind:l().FormulaEditorInfoCompletionKind.Binding,text:l().CURRENT_INDEX_NAME,type:{type:"number"}})}}}}else if(i.nextTokenType===M.AdditionOperator&&q&&"text"===(null===(Q=H)||void 0===Q?void 0:Q.type.type)){const e=P(["+"],_??"");z.push(...e)}else if(i.nextTokenType===M.AdditionOperator&&q&&"number"===(null===($=H)||void 0===$?void 0:$.type.type)){const e=P(["+","-"],_??"");z.push(...e)}else if(i.nextTokenType===M.MultiplicationOperator&&q&&"number"===(null===(J=H)||void 0===J?void 0:J.type.type)){const e=P(["*","/"],_??"");z.push(...e)}else if(i.nextTokenType!==M.RelationalOperator||!q||"number"!==(null===(Y=H)||void 0===Y?void 0:Y.type.type)&&"text"!==(null===(Z=H)||void 0===Z?void 0:Z.type.type)&&"date"!==(null===(ee=H)||void 0===ee?void 0:ee.type.type)){if(i.nextTokenType===M.EqualityOperator&&q&&null!==(te=H)&&void 0!==te&&te.type.type&&"unknown"!==(null===(ne=H)||void 0===ne?void 0:ne.type.type)){const e=P(["==","!="],_??"");z.push(...e)}else if(i.nextTokenType===M.BooleanLiteral&&G){const e=P(["true","false"],_??"");z.push(...e)}else if(i.nextTokenType===M.And&&q&&"checkbox"===(null===(oe=H)||void 0===oe?void 0:oe.type.type)){const e=P(["and","or"],_??"");z.push(...e)}else if(i.nextTokenType===M.UnaryOperator&&j){const e=P(["not"],_??"");z.push(...e)}}else{const e=P([">",">=","<","<="],_??"");z.push(...e)}}const ae=null===(n=N[N.length-1])||void 0===n?void 0:n.tokenType;if(0===z.length&&ae===M.IdentifierName){const e=N.slice(-4).reverse(),t=[];for(let o=0;o<e.length;o++){var se;if((null===(se=e[o])||void 0===se?void 0:se.tokenType)!==M.IdentifierName)break;const n=U?e[o].image.substring(0,e[o].image.length-(A?1:0)):void 0;void 0!==n&&(0===o?t.push(n):t.push(n+t[o-1]))}let n=[];for(let o=1;o<t.length;o++){const e=t[o],r=await k({prefix:e.trim(),context:K,includeDeprecatedCompletions:d,dotMemberExpression:!1});if(r.length>0){n=r.map((t=>({...t,overridePrefixLength:e.length+o})))}}z.push(...n)}return B.completions=z.sort(((e,t)=>{const n=e.kind,o=t.kind;return x[n]-x[o]})),{value:B}}function P(e,t){return e.filter((e=>T(t,e))).map((e=>({kind:l().FormulaEditorInfoCompletionKind.Builtin,builtin:e})))}},563015:(e,t,n)=>{n.d(t,{eJ:()=>f,ew:()=>m,ml:()=>p,rA:()=>d,yI:()=>y,zf:()=>u});n(581454);var o=()=>n(496603),r=()=>n(534177),i=()=>n(708685),a=()=>n(145076),s=()=>n(349835),c=()=>n(977345);function l(e){switch(e){case"checkbox":return"boolean";case"number":return"number";case"text":return"text";case"date":return"date";case"array":return"array";case"block":return"block";case"person":return"person";case"select":return"select";case"function":return"function";case"unknown":return"unknown";case"undefined":return"undefined";default:(0,r().HB)(e)}}function p(e){switch(e.type){case s().M9.InvalidCharacter:return{...a().x0.InvalidCharacter,values:{errorCharacter:e.character}};case s().M9.UnclosedStringLiteral:return a().x0.UnclosedStringLiteral;case s().M9.UnclosedComment:return a().x0.UnclosedComment;case s().M9.TokenExpected:return{...a().x0.TokenExpected,values:{expectedToken:e.token}};case s().M9.StringLiteralContainsToken:return a().x0.StringLiteralContainsToken;case s().M9.ExpressionExpected:return a().x0.ExpressionExpected;case s().M9.PropertyTokenOrFunctionExpected:return a().x0.PropertyTokenOrFunctionExpected;case s().M9.EndOfInputExpected:return a().x0.EndOfInputExpected;case s().M9.UnexpectedError:return a().x0.UnexpectedError;case s().M9.TooDeeplyNested:return a().x0.TooDeeplyNested;default:(0,r().HB)(e)}}function u(e){switch(e.type){case s().IA.FunctionCallArgumentWrongType:case s().IA.FunctionCallUnexpectedArgument:return e.argument;default:return e.node}}function d(e,t){let n;switch(t.type){case s().IA.ThisRowTypeNotFound:n=a().Xz.ThisRowTypeNotFound;break;case s().IA.ThisRowNotBlockWithCollection:n=a().Xz.ThisRowNotBlockWithCollection;break;case s().IA.MissingPropertyOnThisRow:n={...a().Xz.MissingPropertyOnThisRow,values:{propertyName:t.property}};break;case s().IA.MissingContextVariable:{const e=(0,c().ix)(t.token)?t.token.contextValueId:t.token.valueId;n={...a().Xz.MissingContextVariable,values:{valueId:e}}}break;case s().IA.MissingBlock:n={...a().Xz.MissingBlock,values:{blockId:t.token.blockId}};break;case s().IA.CallingNotFunction:n={...a().Xz.CallingNotFunction,values:{expressionType:l(t.callee.type.type)}};break;case s().IA.FunctionCallTooFewArguments:n={...a().Xz.FunctionCallTooFewArguments,values:{minNumParameters:t.minNumParameters,functionName:t.libraryFunction.name,numArguments:t.numArguments}};break;case s().IA.FunctionCallUnexpectedArgument:n={...a().Xz.FunctionCallUnexpectedArgument,values:{functionName:t.libraryFunction.name}};break;case s().IA.FunctionCallArgumentWrongType:n={...a().Xz.FunctionCallArgumentWrongType,values:{argumentType:l(t.argument.type.type),functionName:t.libraryFunction.name}};break;case s().IA.MemberPropertyMismatchCollection:n={...a().Xz.MemberPropertyMismatchCollection,values:{propertyName:t.token.property}};break;case s().IA.MemberPropertyMissing:n={...a().Xz.MemberPropertyMissing,values:{propertyName:t.property}};break;case s().IA.MemberPropertyTargetNotBlock:n=a().Xz.MemberPropertyTargetNotBlock;break;case s().IA.MemberPropertyTypeInvalid:n={...a().Xz.MemberPropertyTypeInvalid,values:{propertyName:t.propertyName,propertyType:t.propertyType}};break;case s().IA.UndefinedIdentifier:n={...a().Xz.UndefinedIdentifier,values:{identifier:t.node.text}};break;case s().IA.UnifiedFunctionCannotFindFunction:n={...a().Xz.UnifiedFunctionCannotFindFunction,values:{functionName:t.name}};break;case s().IA.UnifiedFunctionNoArguments:n={...a().Xz.UnifiedFunctionNoArguments,values:{functionName:t.libraryFunction.name}};break;case s().IA.UnifiedFunctionTargetWrongType:n={...a().Xz.UnifiedFunctionTargetWrongType,values:{functionName:t.libraryFunction.name,targetType:l(t.expression.type.type)}};break;case s().IA.CannotRelativelyCompareTypes:n={...a().Xz.CannotRelativelyCompareTypes,values:{lhsType:l(t.lhsType.type),rhsType:l(t.rhsType.type)}};break;case s().IA.CannotDoMathOnType:n={...a().Xz.CannotDoMathOnType,values:{lhsType:l(t.lhsType.type),rhsType:l(t.rhsType.type)}};break;case s().IA.UnaryMinusOnNonNumber:n={...a().Xz.UnaryMinusOnNonNumber,values:{type:l(t.expression.type.type)}};break;case s().IA.IdentifierExpected:n=a().Xz.IdentifierExpected;break;case s().IA.FunctionCallExpected:n={...a().Xz.FunctionCallExpected,values:{functionName:t.functionName}};break;case s().IA.RenamedIdentifier:n={...a().Xz.RenamedIdentifier,values:{identifier:t.identifier,renamedTo:t.renamedTo}};break;case s().IA.RemovedFunction:n={...a().Xz.RemovedFunction,values:{functionName:t.functionName,alternative:t.alternative}};break;case s().IA.ContextVariableNotBlockWithCollection:n={...a().Xz.ContextVariableNotBlockWithCollection,values:{valueId:t.token.contextValueId}};break;case s().IA.MissingPropertyOnContextVariable:n={...a().Xz.MissingPropertyOnContextVariable,values:{propertyName:t.property,valueId:t.token.contextValueId}};break;case s().IA.BlockPropertyTypeInvalid:n={...a().Xz.BlockPropertyTypeInvalid,values:{propertyName:t.propertyName}};break;case s().IA.DisallowedReturnType:{const o=t.allowedReturnTypes.map((t=>e.formatMessage((0,i().getHumanReadableType)(t)).toLocaleLowerCase()));n={...a().Xz.DisallowedReturnType,values:{allowedReturnType:e.formatList(o,{style:"long",type:"conjunction"}),allowedReturnTypeCount:t.allowedReturnTypes.length,returnType:e.formatMessage((0,i().getHumanReadableType)(t.returnType)).toLocaleLowerCase()}};break}case s().IA.CrossSpacePropertyNotSupported:n={...a().Xz.CrossSpacePropertyNotSupported};break;default:(0,r().HB)(t)}return{...n,values:{...n.values,startOffset:t.node.startOffset,endOffset:t.node.endOffset+1}}}function y(e,t){let n;switch(t.type){case s().uW.MissingThisRow:n=a().X8.MissingThisRow;break;case s().uW.MissingSchemaPropertyOnThisRow:n={...a().X8.MissingSchemaPropertyOnThisRow,values:{propertyName:t.property}};break;case s().uW.ThisRowBlockPropertyMismatchCollection:n=a().X8.ThisRowBlockPropertyMismatchCollection;break;case s().uW.MissingContextVariable:n={...a().X8.MissingContextVariable,values:{valueId:t.valueId}};break;case s().uW.IdentifierNotFound:n={...a().X8.IdentifierNotFound,values:{identifier:t.node.text}};break;case s().uW.CannotRelativelyCompareTypes:n={...a().X8.CannotRelativelyCompareTypes,values:{lhsType:l(t.lhsType),rhsType:l(t.rhsType)}};break;case s().uW.CannotDoMathOnType:n={...a().X8.CannotDoMathOnType,values:{valueType:l(t.valueType)}};break;case s().uW.CannotCallNonFunction:n={...a().X8.CannotCallNonFunction,values:{calleeType:l(t.calleeType)}};break;case s().uW.UnifiedFunctionPropertyNotFound:n={...a().X8.UnifiedFunctionPropertyNotFound,values:{functionName:t.node.name}};break;case s().uW.LibraryFunctionExecutionError:const o=t.error instanceof s().x4?t.error:void 0;n=(null==o?void 0:o.info.type)===s().v3.DateInvalidDurationUnit?{...a().gW.DateInvalidDurationUnit,values:{functionName:t.libraryFunction.name,invalidUnit:o.info.invalidUnit}}:(null==o?void 0:o.info.type)===s().v3.CannotUseToNumberOnList?{...a().gW.CannotUseToNumberOnList}:(null==o?void 0:o.info.type)===s().v3.CannotRoundToNonInteger?{...a().gW.CannotRoundToNonInteger,values:{precision:o.info.precision}}:(null==o?void 0:o.info.type)===s().v3.CannotRoundToTooManyDecimalPlaces?{...a().gW.CannotRoundToTooManyDecimalPlaces,values:{precision:o.info.precision}}:{...a().X8.LibraryFunctionExecutionError,values:{functionName:t.libraryFunction.name}};break;case s().uW.FunctionCallTooFewArguments:n={...a().X8.FunctionCallTooFewArguments,values:{functionName:t.libraryFunction.name}};break;case s().uW.FunctionCallUnexpectedArgument:n={...a().X8.FunctionCallUnexpectedArgument,values:{functionName:t.libraryFunction.name}};break;case s().uW.FunctionCallArgumentWrongType:n={...a().X8.FunctionCallArgumentWrongType,values:{functionName:t.libraryFunction.name,argumentType:l(t.argumentType)}};break;case s().uW.AccessingPropertyOnNonBlock:n=a().X8.AccessingPropertyOnNonBlock;break;case s().uW.MissingDataDependencyBlock:n={...a().X8.MissingDataDependencyBlock,values:{blockId:t.blockPointer.id}};break;case s().uW.MissingDataDependencyPerson:n={...a().X8.MissingDataDependencyPerson,values:{personId:t.personPointer.id}};break;case s().uW.MemberPropertyMismatchCollection:n=a().X8.MemberPropertyMismatchCollection;break;case s().uW.MissingPropertyOnSchemaForMemberProperty:n=a().X8.MissingPropertyOnSchemaForMemberProperty;break;case s().uW.UnaryMinusOnNonNumber:n={...a().X8.UnaryMinusOnNonNumber,values:{expressionType:l(t.expressionType)}};break;case s().uW.UnexpectedRecoveryNode:n=a().X8.UnexpectedRecoveryNode;break;case s().uW.UnexpectedError:n=a().X8.UnexpectedError;break;case s().uW.DepthExceeded:n=a().X8.DepthExceeded;break;case s().uW.CycleDetected:n=a().X8.CycleDetected;break;case s().uW.DownstreamParseFailure:n=a().X8.DownstreamParseFailure;break;case s().uW.MaxEvaluationTimeExceeded:n=a().X8.MaxEvaluationTimeExceeded;break;case s().uW.MissingSchemaPropertyOnCollection:n={...a().X8.MissingSchemaPropertyOnCollection,values:{collectionId:t.collectionId,propertyName:t.property}};break;case s().uW.ContextVariableWrongType:n={...a().X8.ContextVariableWrongType,values:{expectedType:t.expectedType,propertyType:t.resultType,valueId:t.valueId}};break;case s().uW.DisallowedValueType:{const o=t.allowedValueTypes.map((t=>e.formatMessage((0,i().getHumanReadableType)(t)).toLocaleLowerCase()));n={...a().Xz.DisallowedReturnType,values:{allowedValueType:e.formatList(o,{style:"long",type:"conjunction"}),allowedValueTypeCount:t.allowedValueTypes.length,valueType:e.formatMessage((0,i().getHumanReadableValueType)(t.expressionValue)).toLocaleLowerCase()}};break}default:(0,r().HB)(t)}return(0,c().li)(t)?{...n,values:{...n.values,startOffset:t.node.startOffset,endOffset:t.node.endOffset+1}}:n}function m(e){const t=null==e?void 0:e.values;return[o().cJ(e,"values"),t]}function f(e){return e.type===s().uW.DepthExceeded||e.type===s().uW.CycleDetected||e.type===s().uW.MaxEvaluationTimeExceeded||e.type===s().uW.LibraryFunctionExecutionError}},871202:(e,t,n)=>{n.r(t),n.d(t,{hasAccessDefaultFn:()=>T,hasAccessToCode:()=>g,hasAccessToProperty:()=>x,hasReadPermissionsAccess:()=>k,hasSameSpaceAccess:()=>b,testOnly:()=>P});n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(354520);var o=()=>n(496603),r=()=>n(763824),i=()=>n(973647),a=()=>n(534177),s=()=>n(970013),c=()=>n(247331),l=()=>n(443881),p=()=>n(977345),u=()=>n(501053),d=()=>n(373907);function*y(e){const{collectionPointer:t,context:n,propertyId:o,propertySchema:r,visitedPointers:i,hasAccessFn:a}=e,s=(0,l().G7)({...t,propertyId:o});if(i.has(s))return!0;i.add(s);const c=a({propertySchema:r,spaceId:n.spaceId});return"boolean"==typeof c?c:yield*c}function*m(e){var t,n;const{collectionPointer:r,depth:u,collectionSchema:y,context:m,propertyId:f,propertySchema:h,visitedPointers:T,hasAccessFn:k}=e;if("v2"!==h.version||u>c().FORMULA_MAX_DEPTH)return!1;const b=(0,l().G7)({...r,propertyId:f});if(T.has(b))return!0;if(T.add(b),!(0,a().O9)(null===(t=h.formula2)||void 0===t?void 0:t.code))return!0;const x=(0,d().$)(null===(n=h.formula2)||void 0===n?void 0:n.code);if(i().Q.isFail(x))return!1;const{spaceId:g}=m,P=(0,l().zm)({formulaTypecheckContextValues:[{kind:c().FormulaContextValueKind.ThisRow,type:{collection:r,type:"block"}}],node:x.value,spaceId:g}),I=(0,o().hS)(P,(e=>(0,l().G7)(e)));if(0===I.length)return!0;const{getRecordModel:C}=yield{collectionBlockProperties:[{blockPointers:[],collectionPointer:r,property:f,schema:y}],recordPointers:I.filter((e=>(0,p().T3)(e)))};for(const o of I)if((0,s().pq)(o)){const e=C(o);if(!(0,a().O9)(e))return!1;const t=o.propertyId,n=e.getSchema(),r=n[t];if(!r)continue;if((0,s().bT)(r)||(0,s().lb)(r)){if(!(yield*v({collectionPointer:o,collectionSchema:n,context:m,depth:u+1,propertyId:t,propertySchema:r,visitedPointers:T,hasAccessFn:k})))return!1}else if((0,s().nC)(r)){if(!(yield*v({collectionPointer:o,collectionSchema:n,context:m,depth:u,propertyId:t,propertySchema:r,visitedPointers:T,hasAccessFn:k})))return!1}}else if(!(0,a().O9)(C(o)))return!1;return!0}function*f(e){const{collectionPointer:t,depth:n,collectionSchema:o,context:r,propertyId:i,propertySchema:a,visitedPointers:p,hasAccessFn:d}=e;if("v2"===a.version||n>c().FORMULA_MAX_DEPTH)return!1;const y=(0,l().G7)({...t,propertyId:i});if(p.has(y))return!0;p.add(y);const m=(0,u().kh)(a.formula);if(0===m.length)return!0;for(const c of m){const e=o[c];if(e)if((0,s().bT)(e)||(0,s().lb)(e)){if(!(yield*v({collectionPointer:t,depth:n+1,collectionSchema:o,context:r,propertyId:c,propertySchema:e,visitedPointers:p,hasAccessFn:d})))return!1}else if((0,s().nC)(e)){if(!(yield*v({collectionPointer:t,collectionSchema:o,context:r,depth:n,propertyId:c,propertySchema:e,visitedPointers:p,hasAccessFn:d})))return!1}}return!0}function*h(e){const{collectionPointer:t,depth:n,collectionSchema:o,context:r,propertyId:i,propertySchema:a,visitedPointers:p,hasAccessFn:u}=e;if(n>c().FORMULA_MAX_DEPTH)return!1;const d=(0,l().G7)({...t,propertyId:i});if(p.has(d))return!0;if(p.add(d),!a.relation_property||!a.target_property)return!0;const y=o[a.relation_property];if(!y||"relation"!==y.type)return!0;const m=u({propertySchema:y,spaceId:r.spaceId});if(!("boolean"==typeof m?m:yield*m))return!1;const f=(0,s().Nv)(y);if(!f)return!0;const{getRecordModel:h}=yield{recordPointers:[f]},T=h(f),k=null==T?void 0:T.getNormalizedSchema();if(a.target_property_type&&k){const e=k[a.target_property];if(e&&a.target_property_type===e.type){if((0,s().lb)(e))return yield*v({collectionPointer:f,collectionSchema:k,context:r,depth:n+1,propertyId:a.target_property,propertySchema:e,visitedPointers:p,hasAccessFn:u});if((0,s().nC)(e))return yield*v({collectionPointer:f,collectionSchema:k,context:r,depth:n,propertyId:a.target_property,propertySchema:e,visitedPointers:p,hasAccessFn:u})}}return!0}function*v(e){const{collectionPointer:t,depth:n,collectionSchema:o,context:r,propertyId:i,propertySchema:a,visitedPointers:c,hasAccessFn:l}=e;return(0,s().nC)(a)?yield*y({collectionPointer:t,context:r,propertyId:i,propertySchema:a,visitedPointers:c,hasAccessFn:l}):(0,s().lb)(a)?"v2"===a.version?yield*m({collectionPointer:t,depth:n,collectionSchema:o,context:r,propertyId:i,propertySchema:a,visitedPointers:c,hasAccessFn:l}):yield*f({collectionPointer:t,depth:n,collectionSchema:o,context:r,propertyId:i,propertySchema:a,visitedPointers:c,hasAccessFn:l}):!(0,s().bT)(a)||(yield*h({collectionPointer:t,depth:n,collectionSchema:o,context:r,propertyId:i,propertySchema:a,visitedPointers:c,hasAccessFn:l}))}function*T(e){const{propertySchema:t,spaceId:n}=e,o=(0,s().Nv)(t);if(!(0,a().O9)(o))return!0;const{getRecordModel:r}=yield{recordPointers:[o]},i=r(o);return(0,a().O9)(i)&&b({spaceId:n,propertySchema:t})}function*k(e){const{propertySchema:t}=e,n=(0,s().Nv)(t);if(!(0,a().O9)(n))return!0;const{getRecordModel:o}=yield{recordPointers:[n]},r=o(n);return(0,a().O9)(r)}function b(e){const{propertySchema:t,spaceId:n}=e;return!(0,s().o2)(n,t)}async function x(e){const{collectionPointer:t,collectionSchema:n,context:o,propertyId:i,hasAccessFn:a}=e,s=n[i];return!s||await async function(e){const{context:t}=e;try{const n=v(e);let o=n.next();for(;!o.done;){const e=t.handleDataRequest(o.value);o=n.next((0,r().yL)(e)?await e:e)}return o.value}catch(n){return!0}}({collectionPointer:t,depth:0,collectionSchema:n,context:o,propertyId:i,propertySchema:s,visitedPointers:new Set,hasAccessFn:a})}function g(e){const{context:t}=e;try{const n=function*(e){const{collectionPointer:t,depth:n,context:r,code:u,visitedPointers:y,hasAccessFn:m}=e,f=(0,d().$)(u);if(i().Q.isFail(f))return!1;const{spaceId:h}=r,T=r.valueTypes.filter((e=>e.kind!==c().FormulaContextValueKind.ThisRow)),k=(0,l().zm)({formulaTypecheckContextValues:t?[...T,{kind:c().FormulaContextValueKind.ThisRow,type:{collection:t,type:"block"}}]:[],node:f.value,spaceId:h}),b=(0,o().hS)(k,(e=>(0,l().G7)(e)));if(0===b.length)return!0;const{getRecordModel:x}=yield{collectionBlockProperties:[],recordPointers:b.filter((e=>(0,p().T3)(e)))};for(const o of b)if((0,s().pq)(o)){const e=x(o);if(!(0,a().O9)(e))return!1;const t=o.propertyId,i=e.getSchema(),c=i[t];if(!c)continue;if((0,s().bT)(c)||(0,s().lb)(c)){if(!(yield*v({collectionPointer:o,collectionSchema:i,context:r,depth:n+1,propertyId:t,propertySchema:c,visitedPointers:y,hasAccessFn:m})))return!1}else if((0,s().nC)(c)&&!(yield*v({collectionPointer:o,collectionSchema:i,context:r,depth:n,propertyId:t,propertySchema:c,visitedPointers:y,hasAccessFn:m})))return!1}else if(!(0,a().O9)(x(o)))return!1;return!0}(e);let r=n.next();for(;!r.done;){const e=t.handleDataRequest(r.value);r=n.next(e)}return r.value}catch(n){return!0}}const P={hasAccessDefaultFn:T,hasAccessToProperty:x,hasAccessToFormula1Property:f,hasAccessToFormula2Property:m,hasAccessToRelationProperty:y,hasAccessToRollupProperty:h}}}]);