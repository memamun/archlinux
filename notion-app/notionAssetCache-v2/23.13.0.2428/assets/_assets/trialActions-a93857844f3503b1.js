"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[77970],{47273:(e,t,r)=>{r.d(t,{DS:()=>i,Fe:()=>u,GB:()=>o,Gf:()=>p,V_:()=>l,j1:()=>s,j8:()=>a,yp:()=>d,yw:()=>c});var n=()=>r(762433);function i(e){return(0,n().Fq)({subscription:e})}function a(e){return(0,n().Ry)({subscription:e})}function o(e){let{subscriptionState:t,logFunction:r,spaceId:i}=e;return(0,n().yB)({billingData:{subscription:t},logFunction:r,spaceId:i})}function c(e){return(0,n().q8)({subscription:e})}function s(e){return(0,n().V9)({subscription:e})}function u(e){return(0,n().d$)({subscription:e})}function l(e){return(0,n().ji)({subscription:e})}function p(e){return(0,n().AI)({subscription:e})}function d(e,t){return(0,n().KH)({subscription:e},t)}},66460:(e,t,r)=>{r.d(t,{V_:()=>M,WR:()=>T,eu:()=>k,xE:()=>O});r(16280);var n=()=>r(244641),i=(r(296540),()=>r(857639)),a=()=>r(762433),o=()=>r(323063),c=()=>r(622963),s=()=>r(959013),u=()=>r(229833),l=()=>r(498212),p=()=>r(252105),d=()=>r(449506),f=()=>r(901389),m=()=>r(989423),y=()=>r(351360),v=()=>r(57605),_=()=>r(508496),g=()=>r(613240),b=()=>r(128265),w=()=>r(224701),I=()=>r(749356),h=()=>r(779795),S=()=>r(807778),C=()=>r(134217),A=()=>r(981046),D=()=>r(749240),N=()=>r(151168),E=r(474848);async function k(e){var t,r;const{environment:u,stripe:l,elements:d,trialData:m,trialDays:_,sessionId:g,customerName:b,businessName:I}=e;if(!D().subscriptionDataStoreInstance.state)return void i().log({level:"error",from:"trialUpsellActions",type:"StripeError",error:{miscDataString:"Unable to get subscription data."}});if(!d||!l)return void i().log({level:"error",from:"trialUpsellActions",type:"StripeError",error:{miscDataString:"Stripe elements not initialized when user tried to upgrade"}});const{error:S}=await d.submit();if(S)return void p().$X(u,{error:"could not submit form",error_type:"payment_method"});const k=await l.createPaymentMethod({elements:d});if(k.error)return void p().$X(u,{error:k.error.message,error_type:"payment_method"});if(!k.paymentMethod)return void p().$X(u,{error:"could not create token",error_type:"payment_method"});const T={type:"paymentMethodId",value:k.paymentMethod.id},M=y().default.state.currentSpaceStore;if(!M)return;const O=M.id,U=await h().p_({environment:u,spaceId:O}),V=await v().A.awaitData(u,{spaceId:O});if(!V)throw new Error("Billing data not loaded");const $=(0,a().lQ)(V),R=A().A.state.selectedCurrencyCode??"USD",q=(0,N().Zr)(),x=(0,c().Nw)({prices:U,quantity:1,domainsQuantity:0}),F={product:q,interval:"month",currency:R},P=(0,o().qq)(x,$,F),Z=n().c9.now().plus({days:_});return await async function(e){const{environment:t,spaceStore:r,paymentData:n,desiredState:i,stripe:a,trialData:o,customerName:c,businessName:u,addressZip:l,addressCountry:d,sessionId:m}=e,y=await v().A.awaitData(t,{spaceId:r.id});try{const e=await w().nV({environment:t,sessionId:m,spaceStore:r,desiredState:i,paymentData:n,from:"onboarding",trialData:o,billingEmail:(0,C().cs)(y),customerName:c,businessName:u,addressZip:l,addressCountry:d}),p=e.paymentIntentClientSecret,v=e.paymentIntentStatus;if(p&&"requires_action"===v){const{error:e}=await a.handleNextAction({clientSecret:p});e&&(await w().M2({environment:t,spaceStore:r,from:"subscription_upgrade_onboarding_failed_payment"}),f().f1((0,E.jsx)(s().sA,{id:"subscription.upgrade.payment_failed",defaultMessage:"Your payment could not be processed. Please provide an alternate payment method or you will lose access to Notion."})))}return"success"}catch{return void p().AF(t)}}({environment:u,spaceStore:M,desiredState:{...P,trialEnd:Z},paymentData:T,stripe:l,subscriptionTier:(0,N().Zr)(),trialData:m,customerName:b,businessName:I,addressZip:(null===(t=k.paymentMethod.billing_details.address)||void 0===t?void 0:t.postal_code)||"",addressCountry:(null===(r=k.paymentMethod.billing_details.address)||void 0===r?void 0:r.country)||"",sessionId:g})}const T=(0,r(496603).sg)(k,1e3,{leading:!0,trailing:!1});async function M(e){let{spaceId:t,environment:r}=e;if(await(0,I().L6)({environment:r,spaceId:t,offerCampaign:"reverse"})&&(0,S().s)(r)){await O(t,r,"going_multiplayer")&&await g().A.resetData(r,{spaceId:t})}}async function O(e,t,r){let n="reverse";try{const i=await(0,b().G)(t),a=Boolean(_().default.checkGate({gateName:"apply_reverse_trial_key"}));i&&(n="reverse_mm_ent");const o=`${e}_timed_trial`,c=a?(0,l().gB)(o):void 0,s=await d().callApi({eventName:"applyReverseTrial",environment:t,data:{spaceId:e,trialData:{id:n,from:r},idempotencyKey:c}});return"success"===s.type?((0,m().u4)({environment:t,event:{eventName:"trial_apply_attempt",eventProperties:{trial_id:n,success:"success"===s.data.status}}}),await w().Ow(t),"success"===s.data.status):(U(n,t,s.error),!1)}catch(i){return U(n,t,i),!1}}function U(e,t,r){(0,m().u4)({environment:t,event:{eventName:"trial_apply_attempt",eventProperties:{trial_id:e,success:!1}}}),i().log({level:"error",from:"trialUpsellActions",type:"applyReverseTrialError",error:(0,u().n6)(r)})}},323063:(e,t,r)=>{r.d(t,{HO:()=>d,V5:()=>c,Vr:()=>s,gL:()=>u,qq:()=>p,vH:()=>l,z2:()=>f});r(16280),r(898992),r(354520),r(672577),r(581454),r(737550);var n=()=>r(720665),i=()=>r(762433),a=()=>r(47273),o=()=>r(979340);function c(e,t){return d(e.items,t.items).some((e=>{let[t,r]=e;return function(e,t){if(!e)return!1;if(!t)return!0;const r=i().xp(e),n=i().xp(t);if(!r||!n)return!1;return o().o3[r]>o().o3[n]}(t,r)}))}function s(e,t,r){let{trialEnd:n,items:i}=t;const a=i.map((t=>{const n=t.price.product,i=t.price.unitAmount.currencyCode,a=function(e,t){let{interval:r,product:n,currency:i}=t;const a=e.find((e=>e.product===n&&e.billingInterval===r&&e.unitAmount.currencyValue.currencyCode===i));return m(a,`Unable to find price with interval: ${r}, product: ${n}, currency: ${i}`)}(e,{interval:r,product:n,currency:i});return{...t,price:a}}));return{trialEnd:n,items:a}}function u(e,t){const r=e.items.filter((e=>i().IE(e)!==t));return{...e,items:r}}function l(e,t){const r=e.items.filter((e=>i().IE(e)!==i().IE(t)));return{...e,items:r.concat([t])}}function p(e,t,r){const{product:n,interval:a,currency:o}=r,c=function(e){if("personal_free"===e||"team_free"===e)return"free";return e}(n),s=t.items.filter((e=>i().IE(e)!==i().Mr(c))),u=function(e,t){let{interval:r,product:n,currency:i}=t;const a=e.find((e=>e.price.product===n&&e.price.billingInterval===r&&e.price.unitAmount.currencyValue.currencyCode===i));return m(a,`Unable to find price with interval: ${r}, product: ${n}, currency: ${i}`)}(e,{interval:a,product:c,currency:o});return{...t,items:s.concat([u])}}function d(e,t){return(0,n().Z4)(e,(e=>i().IE(e)),t,(e=>i().IE(e)))}function f(e){const{prices:t,billingData:r,product:n}=e,o=i().Ry(r),c=i().lQ(r),s=a().yw(c),u=i().q8(r),l=s??u;return t.find((e=>e.product===n&&e.billingInterval===l&&e.unitAmount.currencyValue.currencyCode===o))}function m(e,t){if(null==e)throw new Error(t);return e}},655765:(e,t,r)=>{r.r(t),r.d(t,{applyMultiplayerReverseTrialIfEligible:()=>u().V_,applyReversePlusTrial:()=>u().xE,handleTrialUpgradeFromOnboarding:()=>u().WR,handleTrialUpgradeFromOnboardingImpl:()=>u().eu,isEligibleForBlockLimitTimedTrial:()=>s});var n=()=>r(130382),i=()=>r(762433),a=()=>r(57605),o=()=>r(128265),c=()=>r(749356);async function s(e,t){const r=await a().A.awaitData(e,{spaceId:null==t?void 0:t.id});if("free"!==(0,i().AI)(r))return!1;const s=null==t?void 0:t.getSetting("reach_block_limit_time");if(!s||(0,n().Mn)(s)<3)return!1;if(await(0,o().G)(e))return!1;const u=t.getSpaceId();return!!(await(0,c().L6)({environment:e,spaceId:u,offerCampaign:"default"}))}var u=()=>r(66460)},749356:(e,t,r)=>{r.d(t,{VY:()=>d,Qm:()=>f,z6:()=>p,OC:()=>v,L6:()=>m,Zc:()=>_,x3:()=>y});var n=()=>r(857639),i=()=>r(386164);const a={plans_page:["lic_25","lic_50","resurrection_offer","ai_fifty_percent_upgrade"],sidebar_upsell:["lic_25","lic_50"]};var o=()=>r(229833),c=()=>r(449506),s=()=>r(901389),u=()=>r(989423),l=()=>r(351360);async function p(e,t){var r;const{spaceId:n,offerCampaign:i}=t;if(!n||!i||null===(r=l().default.state.currentSpaceStore)||void 0===r||!r.canAdmin())return;const a=await c().callApi({eventName:"getCustomerOffer",environment:e,data:{spaceId:n,offerCampaign:i}});return"failed"!==a.type&&"offer"in a.data&&a.data.offer?a.data.offer:void 0}async function d(e){const{environment:t,spaceId:r,offerCampaign:n,entrypoint:i}=e,a=await c().callApi({eventName:"applyCustomerOffer",environment:t,data:{spaceId:r,offerCampaign:n,entrypoint:i??"unknown"}});if("failed"!==a.type)return a;s().Qg(a)}async function f(e,t){const r=await c().callApi({eventName:"applyCustomerOffer",environment:e,data:{...t}});if("failed"!==r.type)return r;s().Qg(r)}async function m(e){const{environment:t,spaceId:r,offerCampaign:n}=e;return void 0!==await p(t,{spaceId:r,offerCampaign:n})}async function y(e){var t;const{environment:r,hasReceived:a,offerType:s,newPlan:u,coupon:p}=e,d=null===(t=l().default.state.currentSpaceStore)||void 0===t?void 0:t.getSpaceId();if(!d)return;const f=await c().callApi({eventName:"updateCustomerOffer",environment:r,data:{spaceId:d,hasReceived:a,offerType:s,newPlan:u,coupon:p},headers:(0,i().WS)({cellId:void 0,spaceId:d})});"failed"===f.type&&n().log({level:"error",from:"offerActions",type:"updateLegacyCustomerOfferFailed",error:(0,o().n6)(f.error)})}async function v(e,t,r){const n=function(e){if(a.hasOwnProperty(e))return a[e]}(r);if(n)for(const i of n){const r=await p(e,{spaceId:t,offerCampaign:i});if((null==r?void 0:r.campaign)===i)return r}}function _(e){let{environment:t,spaceName:r,offerCampaign:n}=e;if(r)switch(n){case"lic_25":case"lic_50":(0,u().WU)(t,"lic_offer_eligible","lic_offer_eligible",3600,{workspace_name:r,lic_25:"lic_25"===n,lic_50:"lic_50"===n});break;case"resurrection_offer":(0,u().WU)(t,"resurrection_offer_eligible","resurrection_offer_eligible",3600,{workspace_name:r});break;default:return}}}}]);