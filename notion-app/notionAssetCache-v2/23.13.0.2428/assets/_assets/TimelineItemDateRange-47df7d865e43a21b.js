"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[11922],{117686:(e,t,o)=>{o.r(t),o.d(t,{TimelineItemDateRange:()=>_,propertiesWidth:()=>$,scrollArrowLeftOffset:()=>H,scrollArrowLeftOffsetAnimatePx:()=>X});o(581454);var r=o(296540),l=()=>o(484714),n=()=>o(56366),i=()=>o(401497),a=()=>o(693954),s=()=>o(959013),c=()=>o(496603),d=()=>o(284371),u=()=>o(415651),g=()=>o(778417),S=()=>o(317909),m=()=>o(519839),p=()=>o(187533),h=()=>o(74513),b=()=>o(41459),y=()=>o(743147),f=()=>o(164124),v=()=>o(614505),x=()=>o(16006),k=()=>o(246722),C=()=>o(38337),D=()=>o(405417),w=()=>o(792540),P=()=>o(695625),I=()=>o(508496),M=()=>o(230062),A=()=>o(717989),j=()=>o(690471),R=()=>o(259464),K=()=>o(603820),T=()=>o(953418),B=o(474848);const E=24;function L(e){const{store:t,schema:o,timelineState:a,dateValueStore:s,collectionContextStore:c,isFullScreen:d,isRootChild:u}=e,g=(0,r.useRef)(null),[m,p]=(0,r.useState)(!1),h=(0,l().v3)(),b=(0,n().K8)((()=>{const e=a.drawStateStore.state;if(e)return e.startStore===t}),[t,a.drawStateStore]),y=(0,n().K8)((()=>!b&&a.hoveredItemStore.state===t&&!M().A.state),[b,t,a.hoveredItemStore]),f=(0,n().K8)((()=>(0,j().tH)(c)),[c]),v=(0,r.useCallback)((e=>{if(e.preventDefault(),!a.scrollLeftStore.state||!g.current)return;const r=(0,T().NM)(g.current);A().vt({timelineState:a,store:t,startX:e.startX,startY:e.startY,schema:o,collectionContextStore:c,verticalScroller:r}),p(!1)}),[c,o,t,a]),x=(0,r.useCallback)((e=>{if(!g.current)return;const t=(0,T().NM)(g.current);A().GZ({timelineState:a,currentX:e.currentX,currentY:e.currentY,verticalScroller:t})}),[a]),k=(0,r.useCallback)((()=>{S().createAndCommit({userAction:"TimelineItemDependencyDrawHandle.handleDraggableDragEnd",environment:h,canUndo:!0,perform:e=>{A().sd({timelineState:a,environment:h,transaction:e,collectionContextStore:c,isFullScreen:d,isRootChild:u})}})}),[h,a,c,d,u]),C=(0,r.useCallback)((e=>{A().P7({timelineState:a,environment:h})}),[h,a]),D=(0,r.useCallback)((()=>{p(!0)}),[p]),w=(0,r.useCallback)((()=>{p(!1)}),[p]),P=(0,i().IS)((e=>({draggableStyle:{position:"absolute",top:0,right:-E,width:E,height:"100%",zIndex:1,isolation:"auto"},draggableSvgStyle:{position:"absolute",left:0,cursor:"pointer"},svgPathStyle:{stroke:f?e.collectionValidDependencyArrow:e.collectionUnsetDependencyArrow,strokeWidth:j().cC},svgCircleFill:{color:e.white}})),[f]),I=(0,r.useCallback)((e=>{if(!s.state)return;return(0,B.jsx)("div",{ref:g,style:P.draggableStyle,...e,children:y&&(0,B.jsx)("div",{style:P.draggableSvgStyle,children:(0,B.jsxs)("svg",{style:{width:22,height:30},onMouseMove:D,onMouseLeave:w,children:[(0,B.jsx)(R().A,{startPoint:{x:0,y:14},endPoint:{x:10,y:14},style:P.svgPathStyle,showArrowHead:m}),(0,B.jsx)("circle",{cx:m?10+j().EZ:10,cy:14,r:m?j().EZ:j().w7,style:P.svgPathStyle,fill:P.svgCircleFill.color})]})})})}),[s,w,D,y,P.draggableStyle,P.draggableSvgStyle,P.svgCircleFill.color,P.svgPathStyle,m]);return(0,B.jsx)(K().A,{render:I,onDraggableDragStart:v,onDraggableDragMove:x,onDraggableDragEnd:k,onDraggableDragCancel:C})}var F=()=>o(839106);const z={position:"absolute",top:0,right:-6,width:8,height:"100%",zIndex:1,cursor:"col-resize"},V={position:"absolute",top:0,left:-6,width:8,height:"100%",zIndex:1,cursor:"col-resize"};function W(e){let{type:t,store:o,query:a,schema:c,timelineState:d,dateValueStore:u,collectionContextStore:g,isInPeekRenderer:m,isFullScreen:p,isRootChild:b}=e;const y=(0,l().v3)(),f=(0,s().tz)(),[v,x]=(0,r.useState)(!1),k=(0,n().K8)((()=>{const e=d.dragStateStore.state;return e?e.stores[0]===o&&("left"===t?e.type===j().MB.LeftResizer:e.type===j().MB.RightResizer):v&&!M().A.state}),[v,o,d,t]),C=(0,n().O$)(u),D=(0,n().O$)(d.zoomLevelStore),w=(0,i().IS)((e=>{const t={position:"absolute",top:6,borderRadius:3,width:3,bottom:6,background:e.regularTextColor},o={fontSize:12,position:"absolute",width:200,lineHeight:`${h().V}px`,pointerEvents:"none"};return{leftDraggableIndicator:{...t,left:Math.ceil(3.5)+1},rightDraggableIndicator:{...t,left:Math.floor(.5)},leftDraggableLabel:{...o,right:12,textAlign:"right"},rightDraggableLabel:{...o,left:12},timelineBackground:{background:m?e.peekTimelineBackground:e.timelineBackground,padding:4,borderRadius:6}}}),[m]),P=(0,r.useCallback)((()=>x(!0)),[]),I=(0,r.useCallback)((()=>x(!1)),[]),R=(0,r.useCallback)((e=>{A().GB({timelineState:d,currentX:e.currentX})}),[d]),T=(0,r.useCallback)((()=>{S().createAndCommit({userAction:"TimelineItemResizer.handleDraggableDragEnd",environment:y,canUndo:!0,perform:e=>{A().eW({timelineState:d,collectionContextStore:g,query:a,schema:c,intl:f,environment:y,transaction:e})}}),(0,F().gp)(y,{...(0,F().ZR)({environment:y,collectionContextStore:g,timelineState:d,isFullScreen:p,isRootChild:b}),type:t})}),[g,y,f,p,b,a,c,d,t]),E=(0,r.useCallback)((e=>{e.preventDefault(),A().v7({timelineState:d,store:o,startX:e.startX,type:"left"===t?j().MB.LeftResizer:j().MB.RightResizer,query:a,schema:c,intl:f,environment:y})}),[y,f,a,c,o,d,t]),L=(0,r.useCallback)((()=>{A().Pt({timelineState:d,environment:y})}),[y,d]),W=(0,r.useCallback)((e=>{const o="left"===t;if(C)return(0,B.jsx)("div",{style:o?V:z,onMouseMove:P,onMouseLeave:I,...e,children:k&&(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)("div",{style:o?w.leftDraggableIndicator:w.rightDraggableIndicator}),(0,B.jsx)("span",{style:o?w.leftDraggableLabel:w.rightDraggableLabel,children:(0,B.jsx)("span",{style:w.timelineBackground,children:o?(0,j()._D)(C,D):(0,j().ji)(C,D)})})]})})}),[C,D,I,P,k,w,t]);return(0,B.jsx)(K().A,{render:W,onDraggableDragStart:E,onDraggableDragMove:R,onDraggableDragEnd:T,onDraggableDragCancel:L})}const N=r.memo(W,o(821062).A),O=(0,s().YK)({typeAName:{defaultMessage:"Type a nameâ€¦",id:"timelineItem.itemName.placeholder"}}),H=21,X=48,$=800,q=400;var U=function(e){return e[e.Absolute=0]="Absolute",e[e.Sticky=1]="Sticky",e}(U||{});function Z(e){const{timelineState:t,scrollerLeftOffset:a,itemPositionStore:c,store:d,query:u,schema:g,dateValueStore:p,disabled:b,isDraggingViaTimelineItemStore:y,collectionContextStore:f,isFullScreen:v,isRootChild:x,parentStore:k,toggleButton:D,isInPeekRenderer:w,handleOpenPeekPage:P,showProperties:R,clonedStore:K,blockPropertyValueOverlayStore:T,propertiesWrapElementRef:E}=e,F=(0,l().v3)(),z=(0,s().tz)(),{value:V}=(0,o(645873).fJ)(o(862292).T.formulas),W=(0,n().K8)((()=>c.state),[c]),O=(0,n().K8)((()=>{if(W){const{left:e,right:o}=W,r=o-e;if(!((0,j().zZ)(F)&&r>50))return{position:U.Absolute,left:e};{const l=t.scrollLeftStore.state;if(void 0!==l){const t=l+a-e+H;if(t<0)return{position:U.Absolute,left:e};if(t>r)return{position:U.Absolute,left:o};if(t>0)return{position:U.Sticky,left:a+H}}}}}),[F,W,a,t.scrollLeftStore]),X=(0,n().K8)((()=>{var e;const t=o(24157).default.state;if("editing"!==t.mode)return!1;const r=null===(e=(0,o(231722).H7)(t.multiSelection))||void 0===e?void 0:e.store;return d&&r&&r===d.getBlockTitleStore()}),[d]),q=(0,n().K8)((()=>(0,j().tH)(f)),[f]),Z=(0,n().K8)((()=>t.hoveredItemStore.state===d),[d,t.hoveredItemStore]),_=(0,n().K8)((()=>{const{mainEditorCurrentBlockStore:e}=o(351360).default.state;if(d&&e)return m().wy({environment:F,store:d,mainEditorCurrentBlockStore:e,collectionContextStore:f,fullyQualified:!1})}),[F,f,d]),J=(0,n().K8)((()=>{if(d)return(0,o(492414).Ay)({store:d,fullyQualified:!1,pageVisitSource:o(584262).y8.LinkInPage})}),[d]),te=(0,n().K8)((()=>!b&&(null==d?void 0:d.canEdit())),[b,d]),oe=(0,l().WS)(),re=(0,n().K8)((()=>"collectionTypedView"===f.contextType),[f]),le=(0,n().K8)((()=>te&&!oe&&(q||f.permissionScopesStore.state.canConfigureBlock)&&!re),[te,f.permissionScopesStore,oe,re,q]),ne=(0,n().K8)((()=>f.currentSubitemFormatStoreForUiDisplayStore.state),[f]),ie=ne?42:10,ae=W?Math.max(W.right-W.left,ie)+1:ie+1,se=(0,n().K8)((()=>y.state),[y]),ce=(0,n().K8)((()=>{const e=k,t=(0,o(873050).AU)({collectionContextStore:f,collectionStore:e,environment:F}),r=null==d?void 0:d.getModel(),l=null==d?void 0:d.getRecordModel;if(!t||!r||!l)return!0;const n=I().default.getConfigKey("collection_request_settings","clientFormulaTimeoutMs");return(0,o(289915).oR)(t)({block:r,getRecordModel:l,propertyMapping:null==e?void 0:e.getPropertyMapping(),formulaTimeoutTimestampMs:Date.now()+n,resultCache:new Map,regExpCache:new Map,experimentService:I().default,formulasModule:V})}),[f,F,k,d,V]),de=(0,n().K8)((()=>d&&(0,o(97059).W)(F,d.id)),[F,d]),ue=(0,n().K8)((()=>f.isInHomeWidgetStore.state),[f.isInHomeWidgetStore]),ge=(0,n().K8)((()=>!!d&&m().NM(d)),[d]),Se=(0,n().K8)((()=>{const e=t.drawStateStore.state;return e&&e.startStore!==d}),[d,t.drawStateStore]),me=(0,r.useMemo)((()=>(0,B.jsx)(Y,{collectionContextStore:f,toggleButton:D,itemPositionStore:c})),[f,c,D]),pe=(0,i().IS)((e=>({linkBoxStyle:{width:"100%",height:"100%",borderRadius:6},linkBoxInnerStyle:{width:"100%",height:"100%",display:"flex",paddingLeft:6,paddingRight:6,borderRadius:6},container:{position:"absolute",left:null==W?void 0:W.left,marginTop:1,marginBottom:1,width:ae,height:h().V-2,borderRadius:6,display:"flex",...null!=W&&W.isExistingSubitemPlaceholder?void 0:{..."light"===e.mode?{background:null!=W&&W.isPlaceholder?e.buttonHoveredBackground:e.contentBackground,boxShadow:null!=W&&W.isPlaceholder?void 0:e.buttonBoxShadow}:{background:w?e.calendarItemBackground:e.popoverBackground,boxShadow:null!=W&&W.isPlaceholder?void 0:e.shadowSM}},...(null==W?void 0:W.isPlaceholder)&&{cursor:"crosshair"},...se&&{display:"none"},...!ce&&{opacity:.5},...de&&{opacity:.5},zIndex:85},halo:{...m().wh(e,ge),borderRadius:6},propertiesContainer:{width:"100%",WebkitMaskImage:null!=W&&W.maskPercent&&(null==W?void 0:W.maskPercent)<1&&Z?`linear-gradient(90deg, rgba(0,0,0,1) ${100*W.maskPercent}%, rgba(0,0,0,0.4) ${100*W.maskPercent}%)`:void 0,pointerEvents:"none",...se&&{display:"none"},zIndex:85,opacity:!ce||de?.5:1},propertiesWrapInnerStyle:{display:"flex",height:h().V-2+1,paddingLeft:ne&&me?24:6,width:$,overflow:"hidden"}})),[se,Z,w,ce,W,ge,ne,me,ae,de]),he=(0,r.useCallback)((()=>{const e=null==E?void 0:E.current,t=O;e&&t&&(e.style.position=t.position===U.Absolute?"absolute":"sticky",e.style.left=`${t.left}px`)}),[O,E]),be=(0,r.useMemo)((()=>(0,B.jsx)("div",{style:pe.propertiesContainer,children:(0,B.jsx)("div",{style:pe.propertiesWrapInnerStyle,ref:E,className:C().st6,children:R.map(((e,t)=>(0,B.jsx)(ee,{showProperties:R,store:d,disabled:b,blockPropertyValueOverlayStore:T,clonedStore:K,collectionContextStore:f,parentStore:k,editingTitle:X,property:e,index:t},e)))})})),[T,K,f,b,X,k,E,R,d,pe]),ye=(0,r.useCallback)((e=>{d&&(t.dragStateStore.state||A().v7({timelineState:t,store:d,startX:e.startX,type:j().MB.ItemDrag,query:u,schema:g,intl:z,environment:F}),A().GB({timelineState:t,currentX:e.currentX}))}),[t,d,u,g,z,F]),fe=(0,r.useCallback)((()=>{S().createAndCommit({userAction:"TimelineItemDateRange.handleSelectableDragEnd",environment:F,canUndo:!0,perform:e=>{A().eW({timelineState:t,collectionContextStore:f,query:u,schema:g,intl:z,environment:F,transaction:e})}})}),[t,f,u,g,z,F]),ve=(0,r.useCallback)((()=>{A().Pt({timelineState:t,environment:F})}),[t,F]),xe=(0,r.useCallback)((e=>{const o=t.dragStateStore.state;(M().A.state||o)&&!Se||F.device.isPhone||t.hoveredItemStore.setState(d)}),[t,Se,F,d]),ke=(0,r.useCallback)((()=>{const e=t.dragStateStore.state;M().A.state}),[t,Se]);return(0,r.useEffect)((()=>{he()}),[O,he]),W?!d||null!=W&&W.isPlaceholder?(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)("div",{style:pe.container,className:C().KfS}),be]}):(0,B.jsxs)(B.Fragment,{children:[(0,B.jsxs)(o(199896).A,{style:pe.container,haloStyle:pe.halo,className:C().KfS,store:d,canSelect:!0,shouldShowHalo:!ue,shouldForceRenderSelectionHalo:ge,canDrag:te,analyticsName:"timeline",onDraggableDragStart:G,onDraggableDragMove:ye,onDraggableDragEnd:fe,onDraggableDragCancel:ve,canTriggerContextMenu:te,getGhostElement:Q,disableScrollToReveal:!0,onMouseMove:xe,onMouseLeave:ke,showBlockMenuInput:!0,children:[me,(0,B.jsx)(o(296798).A,{style:pe.linkBoxStyle,innerStyle:pe.linkBoxInnerStyle,onClick:P,href:J,metaHref:_,hovered:Z,ignoreLocalHoverState:!0}),le&&d&&(0,B.jsx)(L,{store:d,isFullScreen:v,isRootChild:x,schema:g,timelineState:t,dateValueStore:p,collectionContextStore:f}),te&&!oe&&(0,B.jsx)(N,{type:"left",store:d,query:u,schema:g,timelineState:t,dateValueStore:p,collectionContextStore:f,isFullScreen:v,isInPeekRenderer:w,isRootChild:x}),te&&!oe&&(0,B.jsx)(N,{type:"right",store:d,query:u,schema:g,timelineState:t,dateValueStore:p,collectionContextStore:f,isFullScreen:v,isInPeekRenderer:w,isRootChild:x})]}),be]}):null}const _=r.memo(Z);function Y(e){let{collectionContextStore:t,toggleButton:o,itemPositionStore:r}=e;const l=(0,n().O$)(t.currentSubitemFormatStoreForUiDisplayStore),i=(0,n().O$)(r);return!l||!o||null!=i&&i.isExistingSubitemPlaceholder?null:(0,B.jsx)("span",{style:{zIndex:1,paddingTop:3},children:o})}function G(e){e.preventDefault()}function Q(e){const t=P().T.findSelectablesFromStore(e),o=c().oE(t.map((e=>e.getNode()))),r=c().oE(o.map((e=>e.closest(`.${C().ZLF}`))))[0];if(r){const e=u().up(r),t=e.cloned.querySelector(`.${C().KfS}`),o=e.cloned.querySelector(`.${C().st6}`);return t&&o&&"sticky"===o.style.position&&(o.style.position="absolute",o.style.left=t.style.left),[e]}return o.map(u().up)}function J(e){let{isLast:t,store:o,collectionContextStore:u,parentStore:S,editingTitle:m}=e;const p=(0,i().DP)(),h=(0,l().v3)(),b=(0,s().tz)(),C=(0,n().K8)((()=>null==o?void 0:o.getIcon()),[o]),P=(0,n().K8)((()=>null==u?void 0:u.shouldShowPageIcon()),[u]),I=(0,n().K8)((()=>null==o?void 0:o.hasError()),[o]),M=(0,n().K8)((()=>!o||o.isEmptyPage()),[o]),A=(0,n().O$)(u.currentSubitemFormatStoreForUiDisplayStore),j=(0,n().K8)((()=>{var e;return A&&S?null===(e=S.getSchema()[A.property])||void 0===e?void 0:e.name:""}),[S,A]),R=(0,n().K8)((()=>null==o?void 0:o.getBlockTitleStore()),[o]),K=(0,n().K8)((()=>o&&(0,D().xC)({collectionContextStore:u,blockStore:o})),[u,o]),T=(0,n().K8)((()=>o&&(0,D().Kk)({collectionContextStore:u,blockStore:o})),[u,o]),E=(0,r.useCallback)((()=>{o&&g().Lt({environment:h,store:o})}),[h,o]);return(0,B.jsxs)("div",{style:{display:"flex",marginRight:t?0:10,fontSize:14,fontWeight:d().Wy.medium,alignItems:"center"},children:[P&&C&&!I&&(0,B.jsx)(v().A,{disabled:!0,icon:C,isEmptyPage:M,size:20,style:{marginLeft:2,marginRight:6}}),I&&(0,a().Q)({display:"inline-block",verticalAlign:"text-top",marginLeft:4,marginRight:7,width:16,fill:p.accentColors.orange[500]}),o&&!m&&(0,B.jsx)(x().A,{style:{whiteSpace:"nowrap",maxWidth:q},store:o}),m&&o&&R&&(0,B.jsx)(k().A,{store:R,style:{whiteSpace:h.device.isFirefox?"pre":"nowrap"},disabled:!1,disableSlashCommands:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableEmbedMenu:!0,onEnter:E,onEsc:E,onTab:c().D_,placeholder:b.formatMessage(O.typeAName),disableSelectAllBlocks:!0,pasteBehavior:"inline",inPageFind:w().Os.none}),o&&K&&(0,B.jsx)("div",{style:{paddingTop:2,paddingLeft:4},children:(0,B.jsx)(y().n,{blockStore:o,collectionContextStore:u})}),o&&T&&(0,B.jsx)("div",{style:{paddingTop:2,paddingLeft:8,color:p.lightTextColor},children:(0,B.jsx)(f().W,{blockStore:o,collectionContextStore:u})}),!o&&(0,B.jsx)("span",{children:S&&j?(0,B.jsx)(s().sA,{defaultMessage:"New page in {propertyName}",id:"timeline.itemPlaceholder.nest.addSubitemWithPropertyName",values:{propertyName:j}}):(0,B.jsx)(s().sA,{id:"timeline.itemPlaceholder.newPage",defaultMessage:"New page"})})]},"title")}function ee(e){let{property:t,index:o,showProperties:r,store:l,disabled:i,blockPropertyValueOverlayStore:a,clonedStore:s,collectionContextStore:c,parentStore:d,editingTitle:u}=e;const g=o===r.length-1,S=(0,n().K8)((()=>null==l?void 0:l.getAssociatedCollectionStore()),[l]),m=(0,n().K8)((()=>null==l?void 0:l.canEdit()),[l]),h=(0,n().K8)((()=>c.collectionViewStore()),[c]);return S?"title"===t?(0,B.jsx)(J,{store:l,collectionContextStore:c,parentStore:d,editingTitle:u,isLast:g}):l&&s?(0,B.jsx)(p().m,{store:s,property:t,disabled:i||!m,locked:!1,format:b().j.Timeline,tableWrap:!1,isLast:g,blockPropertyValueOverlayStore:a,enablePointerEventsForInteractiveTypes:!0,collectionStore:S,collectionViewStore:h},t):null:null}}}]);