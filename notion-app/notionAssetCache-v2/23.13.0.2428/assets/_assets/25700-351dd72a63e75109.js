"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[25700],{300451:(e,t,n)=>{n.d(t,{A:()=>o});class i extends(()=>n(757695))().default{getInitialState(){return{settingOpen:"initial",permissionItem:void 0,from:void 0,sudoModeStore:void 0,location:"",faviconUrl:null,previewImageUrl:null,hideBreadcrumbs:!1,hideSearch:!1,hideWatermark:!1,enableDuplicateAsTemplate:!1,customHeaderBlockIds:[],googleAnalyticsId:void 0,theme:void 0,enableQna:!1}}}const o=new i},435212:(e,t,n)=>{n.d(t,{Kz:()=>a,Sc:()=>r,as:()=>o});var i=()=>n(989423);function o(e,t){(0,i().u4)({environment:e,event:{eventName:"open_customize_site",eventProperties:t}})}function a(e,t){(0,i().u4)({environment:e,event:{eventName:"update_site_customization_settings",eventProperties:t}})}function r(e){(0,i().u4)({environment:e,event:{eventName:"close_customize_site",eventProperties:{}}})}},525700:(e,t,n)=>{n.d(t,{Bp:()=>C,DD:()=>x,E9:()=>K,H6:()=>D,HE:()=>E,HY:()=>M,JI:()=>F,Nf:()=>q,P8:()=>Y,V_:()=>j,XL:()=>W,Xz:()=>Q,aD:()=>N,aN:()=>z,d7:()=>R,d8:()=>k,j4:()=>V,n0:()=>G,pu:()=>O,uH:()=>H,uY:()=>J,wl:()=>P,yF:()=>T,zV:()=>B});n(16280),n(944114),n(898992),n(354520),n(581454),n(296540);var i=()=>n(68263),o=()=>n(161479),a=()=>n(101628),r=()=>n(245241),s=()=>n(959013),d=()=>n(496603),l=()=>n(498212),c=()=>n(449506),u=()=>n(246826),m=()=>n(755636),p=()=>n(436572),v=()=>n(317909),g=()=>n(780054),S=()=>n(594794),h=()=>n(976721),f=()=>n(562800),I=()=>n(40226),b=()=>n(380682),A=()=>n(300451),U=()=>n(676870),y=()=>n(435212),_=n(474848);function k(e){const{environment:t,store:n,type:i,header:r,domainId:s}=e,d=n.getSiteStore();if(d)return d.id;let l=s;var c;l||(l=null===(c=f().Nq(n.getSpaceStore()))||void 0===c?void 0:c.id);const m=(0,S().JH)({environment:t,table:a().Eu,spaceId:(0,o().e)(n.getSpaceId())});v().createAndCommit({userAction:"publishSite.create",environment:t,canUndo:!0,perform:e=>{const o=u().vt({environment:t,table:m.table,args:{id:m.id,type:i,spaceId:m.spaceId,blockId:n.id,domainId:l,currentUserId:t.currentUser.id,header:r??{}},inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,transaction:e});return u().zv({store:n.getFormatStore(),data:{site_id:o.id},transaction:e}),o.id}})}function w(e){const{environment:t,siteRootBlockStore:n,domainId:i}=e;let o=n.getSiteStore();if(o||(k({environment:t,type:"site",store:n,domainId:i}),o=n.getSiteStore()),o)return o}function B(e){const{environment:t,domainId:n,resetWatermark:i}=e,o=w(e);o&&o.isDefined()&&(v().createAndCommit({userAction:"publishSite.updatePublicDomain",environment:t,canUndo:!0,perform:e=>{o.getDomainId()!==n&&v().applyOperation({transaction:e,store:o,operation:o.getModel().ops.updatePublicDomainId({domainId:n,currentUserId:t.currentUser.id})})}}),v().createAndCommit({userAction:"publishSite.resetWatermark",environment:t,canUndo:!0,perform:e=>{if(i){const n=o.getHeader();v().applyOperation({transaction:e,store:o,operation:o.getModel().ops.updateHeader({header:{...n,hideWatermark:!1},currentUserId:t.currentUser.id})})}}}),p().D6({label:(0,_.jsx)(s().sA,{id:"publishSiteSettings.publicDomain.confirmation",defaultMessage:"Successfully updated domain for all pages within this site"})}))}function D(e){const{environment:t,siteRootBlockStore:n,isSearchEngineIndexingEnabled:i}=e,a=w(e);if(!a)return;"form"!==a.getType()&&v().createAndCommit({userAction:"publishSite.updateSeoEnabled",environment:t,canUndo:!0,perform:e=>{a&&a.isDefined()&&i!==a.isSearchEngineIndexingEnabled()&&(v().applyOperation({transaction:e,store:a,operation:a.getModel().ops.updateIsSearchEngineIndexingEnabled({isSearchEngineIndexingEnabled:i,currentUserId:t.currentUser.id})}),i&&e.postSubmitCallbacks.push((async e=>{e||await c().callApi({eventName:"enqueueScanContentTask",environment:t,data:{pagePointer:{id:n.id,table:"block",spaceId:(0,o().e)(n.pointer.spaceId)}}})})))}})}function E(e){const{environment:t,store:n,seoTitle:i,seoDescription:o}=e;v().createAndCommit({userAction:"publishSite.create",environment:t,canUndo:!0,perform:e=>{const a=n.getFormat().seo_title,r=n.getFormat().seo_description;a===i&&r===o||(u().zv({store:n.getFormatStore(),data:{seo_title:i,seo_description:o},transaction:e}),(0,U().NZ)(t,{target_block_id:n.id,new_title:i??null,new_description:o??null}),p().D6({label:(0,_.jsx)(s().sA,{id:"siteSettingsEditor.publishSeoChanges.confirmation",defaultMessage:"Successfully updated the SEO settings"})}))}})}function N(e){A().A.setState({...A().A.state,settingOpen:e})}function P(){A().A.setState({...A().A.state,settingOpen:"initial"})}function C(e){b().A.setState({...b().A.state,siteSettingContentType:e})}function M(e){var t,n,i;const{siteRootBlockStore:o,permissionItem:a,from:r,sudoModeStore:s}=e,d=o.getSiteStore(),l=null==d?void 0:d.getHeader(),c=(null==l||null===(t=l.customItems)||void 0===t?void 0:t.map((e=>e.blockId)))||[];A().A.setState({settingOpen:"initial",permissionItem:a,from:r,sudoModeStore:s,faviconUrl:(null==d?void 0:d.getFaviconUrl())||null,previewImageUrl:(null==d?void 0:d.getPreviewImageUrl())||null,hideBreadcrumbs:null==l?void 0:l.hideBreadcrumbs,hideSearch:null==l?void 0:l.hideSearch,hideWatermark:null==l?void 0:l.hideWatermark,enableDuplicateAsTemplate:a.allow_duplicate,customHeaderBlockIds:c,googleAnalyticsId:null==d?void 0:d.getGoogleAnalyticsId(),theme:null==d||null===(n=d.getSettings())||void 0===n?void 0:n.theme,enableQna:null==d||null===(i=d.getSettings())||void 0===i?void 0:i.enableQna})}async function H(e){var t;const{environment:n,store:o,siteRootBlockStore:a}=e,r=w({environment:n,siteRootBlockStore:a}),u=null==r?void 0:r.getType();if(!r||"form"===u)return;const m=A().A.getState();let g=!1;const S={};let I;m.enableQna&&(I=await async function(e){var t,n,i,o;const{environment:a,siteStore:r}=e,s=null===(t=r.getSettings())||void 0===t?void 0:t.siteUserId;if(s)return s;if(!((null===(n=r.getDomainStore())||void 0===n?void 0:n.getDomainName())??(null===(i=f().Nq(r.getSpaceStore()))||void 0===i?void 0:i.domain_name)))throw new Error("no domain on site");const d=f().Ix({spaceStore:r.getSpaceStore(),domainId:null===(o=r.getDomainStore())||void 0===o?void 0:o.id}).split(":")[0],u=`${(0,l().S2)(r.id)}@${d}`,m=await c().callApi({eventName:"createEmailUser",environment:a,data:{email:u}});if("failed"===m.type)throw new Error("failed to create qna user");return m.data.userId}({environment:n,siteStore:r})),v().createAndCommit({userAction:"publishSite.updateSiteSettingsInEditor",environment:n,canUndo:!0,perform:e=>{if(r&&r.isDefined()){var t,i;(r.getFaviconUrl()||null)!==m.faviconUrl&&(v().applyOperation({transaction:e,store:r,operation:r.getModel().ops.updateFaviconUrl({faviconUrl:m.faviconUrl,currentUserId:n.currentUser.id})}),g=!0,S.favicon=m.faviconUrl);(r.getPreviewImageUrl()||null)!==m.previewImageUrl&&(v().applyOperation({transaction:e,store:r,operation:r.getModel().ops.updatePreviewImageUrl({previewImageUrl:m.previewImageUrl,currentUserId:n.currentUser.id})}),g=!0,S.preview_image=m.previewImageUrl);const o=r.getHeader();let a=o;const s=function(e,t){const n=e.map((e=>({type:"block",blockId:e})));if(!t&&0===n.length)return;if(t&&(0,d().n4)(n,t))return;return n}(m.customHeaderBlockIds,null==o?void 0:o.customItems);s&&(a={...a,customItems:s},S.custom_headers=s.map((e=>e.blockId))),(null==o?void 0:o.hideBreadcrumbs)!==m.hideBreadcrumbs&&(a={...a,hideBreadcrumbs:m.hideBreadcrumbs},S.hide_breadcrumbs=m.hideBreadcrumbs),(null==o?void 0:o.hideSearch)!==m.hideSearch&&(a={...a,hideSearch:m.hideSearch},S.hide_search=m.hideSearch),(null==o?void 0:o.hideWatermark)!==m.hideWatermark&&(a={...a,hideWatermark:m.hideWatermark},S.hide_watermark=m.hideWatermark),a&&o!==a&&(v().applyOperation({transaction:e,store:r,operation:r.getModel().ops.updateHeader({header:a,currentUserId:n.currentUser.id})}),g=!0);r.getGoogleAnalyticsId()!==m.googleAnalyticsId&&(v().applyOperation({transaction:e,store:r,operation:r.getModel().ops.updateGoogleAnalyticsId({googleAnalyticsId:m.googleAnalyticsId,currentUserId:n.currentUser.id})}),g=!0,S.google_analytics_id=m.googleAnalyticsId);(null===(t=r.getSettings())||void 0===t?void 0:t.theme)!==m.theme&&(v().applyOperation({transaction:e,store:r,operation:r.getModel().ops.updateTheme({theme:m.theme,currentUserId:n.currentUser.id})}),g=!0,S.theme=m.theme);(null===(i=r.getSettings())||void 0===i?void 0:i.enableQna)!==m.enableQna&&(m.enableQna?I&&v().applyOperation({transaction:e,store:r,operation:{pointer:r.pointer,command:"update",path:["settings"],args:{enableQna:m.enableQna,siteUserId:I}}}):v().applyOperation({transaction:e,store:r,operation:{pointer:r.pointer,command:"update",path:["settings"],args:{enableQna:m.enableQna}}}),g=!0)}}});if((null===(t=m.permissionItem)||void 0===t?void 0:t.allow_duplicate)!==m.enableDuplicateAsTemplate&&m.permissionItem&&m.from){const e=(0,i().Yi)(m.from);(0,h().Hc)({oldPermissionItem:m.permissionItem,newPermissionItem:{...m.permissionItem,allow_duplicate:m.enableDuplicateAsTemplate},wasInherited:e!==o.id,environment:n,store:o,sudoModeStore:m.sudoModeStore,location:"published_site_settings"}),g=!0,S.enable_duplicate_as_template=m.enableDuplicateAsTemplate}g&&((0,y().Kz)(n,{settings_changed:S}),p().D6({label:(0,_.jsx)(s().sA,{id:"siteSettingsEditor.publishChanges.confirmation",defaultMessage:"Changes published"})}))}function O(e){A().A.setState({...A().A.state,faviconUrl:e})}function T(e){A().A.setState({...A().A.state,previewImageUrl:e})}function x(e){A().A.setState({...A().A.state,hideBreadcrumbs:e})}function W(e){A().A.setState({...A().A.state,hideSearch:e})}function Q(e){A().A.setState({...A().A.state,hideWatermark:e})}function R(e){A().A.setState({...A().A.state,enableDuplicateAsTemplate:e})}function z(e){const t=A().A.state.customHeaderBlockIds.concat([e]);A().A.setState({...A().A.state,customHeaderBlockIds:t})}function F(e){const t=A().A.state.customHeaderBlockIds.filter((t=>t!==e));A().A.setState({...A().A.state,customHeaderBlockIds:t})}function q(e){A().A.setState({...A().A.state,googleAnalyticsId:e})}function j(e){A().A.setState({...A().A.state,theme:e})}async function V(e){const{environment:t,spaceStore:n,query:i,siteRootBlockId:o}=e;if(!n)return;const a=await c().callApi({eventName:"searchPagesInSite",environment:t,data:{query:i,spaceId:n.id,filters:r().N2({isDeletedOnly:!1,navigableBlockContentOnly:!0,excludeTemplates:!0,editedBy:[],ancestors:[o],inTeams:[]}),sort:{field:"relevance"},limit:10}});return"failed"!==a.type?a.data:void 0}async function G(e){const{environment:t,blockStore:n,slug:i}=e,o=await c().callApi({eventName:"updatePublicPageSlug",environment:t,data:{spaceId:n.getSpaceId(),blockId:n.id,slug:i,clientVersion:g().A.version}});if("success"!==o.type)return{error:o};p().D6({label:(0,_.jsx)(s().sA,{id:"customSlugInput.updateSuccess.toast",defaultMessage:"Successfully updated URL for this page"})})}function Y(e){A().A.setState({...A().A.state,enableQna:e})}function J(e){const{environment:t,store:n,pageVisitSource:i}=e,o=I().R({store:n,pageVisitSource:i});m().f({environment:t,url:o})}function K(e){const{environment:t,siteStore:n,embedSettings:i}=e;v().createAndCommit({userAction:"embedSite.updateEmbedSettings",environment:t,canUndo:!0,perform:e=>{u().zv({store:n.getSettingsStore(),data:{embedSettings:i},transaction:e})}})}},676870:(e,t,n)=>{n.d(t,{EN:()=>o,Ex:()=>a,NZ:()=>r,T6:()=>d,i_:()=>s,kW:()=>l});var i=()=>n(989423);function o(e,t){(0,i().u4)({environment:e,event:{eventName:"open_publish_modal",eventProperties:t}})}function a(e,t){(0,i().u4)({environment:e,event:{eventName:"change_domain",eventProperties:t}})}function r(e,t){(0,i().u4)({environment:e,event:{eventName:"update_seo_settings",eventProperties:t}})}function s(e,t){(0,i().u4)({environment:e,event:{eventName:"site_set_link_expiration",eventProperties:t}})}function d(e,t){(0,i().u4)({environment:e,event:{eventName:"page_unpublish",eventProperties:t}})}function l(e,t){(0,i().u4)({environment:e,event:{eventName:"page_publish",eventProperties:t}})}}}]);