"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[26906],{36951:(e,t,n)=>{n.d(t,{Ak:()=>x,VK:()=>h,xh:()=>m});n(16280);var r=()=>n(370657),o=()=>n(386164),i=()=>n(427704),a=()=>n(234459),s=()=>n(919709),l=()=>n(532659),c=()=>n(498212),d=()=>n(449506),u=()=>n(435009),p=()=>n(594794),f=()=>n(351360),g=()=>n(582524);async function m(e){var t;const{environment:n,clientStore:i,message:a}=e,u=f().default.state.currentSpaceStore;if(!u)throw new Error("No current space store");const p=null===(t=n.currentUser)||void 0===t?void 0:t.id;if(!p)throw new Error("No current user");if((0,s().q4_)(a).trim().length<6)return;const g=await d().callStreamApi({eventName:"runInferenceTranscript",environment:n,data:{transcript:[{id:(0,c().Ay)(),type:"config",value:{type:"route-inference-transcript",configs:r().r5}},{id:(0,c().Ay)(),type:"user",value:a,userId:p}],traceId:(0,c().Ay)(),spaceId:u.id,generateTitle:!1},headers:(0,o().WS)({spaceId:u.id})});if("failed"===g.type)throw g.error;if(l().hS.is(g.data))for await(const r of g.data)if("config"===r.type)i.state.userSelectedConfig||i.setState({...i.state,config:r.value});else if("error"===r.type)throw r.message}function h(e){const{environment:t,threadId:n}=e;u().oo({environment:t,url:n?`${i().GJ.aiInferenceTranscript}?t=${(0,c().Xw)(n)}`:i().GJ.aiInferenceTranscript})}function x(e){const{environment:t,query:n,clientStore:r}=e,{currentSpaceStore:o,currentUserStore:i}=f().default.state;if(!o||!n)throw new Error("No current space or value");if(!t.currentUser.id)throw new Error("No current user");const s=(0,p().Z1)({environment:t,table:a().To,spaceId:o.id});(0,g().Wq)({clientStore:r}),(0,g().i0)({environment:t,clientStore:r,threadStore:void 0,threadId:s,threadParentPointer:{...o.pointer,spaceId:o.id},additionalSteps:[],config:{type:"search",scopeForNextSearch:{type:"everything"}},userStore:i,spaceStore:o,value:n}),h({environment:t,threadId:s})}},73223:(e,t,n)=>{n.r(t),n.d(t,{dismissTutorial:()=>d,resetTutorials:()=>u,tutorialAdvanceToStep:()=>p,tutorialAdvanceToStepAfter:()=>f,tutorialGoToNextStep:()=>l,tutorialGoToPrevStep:()=>c});var r=()=>n(541235),o=()=>n(317909),i=()=>n(755199),a=()=>n(739135),s=()=>n(351360);function l(e,t){var n;const{currentUserSettingsStore:r}=s().default.state;if(!r)return;const o=null===(n=r.getSettings())||void 0===n?void 0:n.tutorials;g({userAction:"TutorialActions.nextStep",environment:e,perform:e=>{i().mJ({userSettingsStore:r,transaction:e,data:{tutorials:{...o,[t]:(0,a().i9)(r,t)}}})},userId:r.id})}function c(e,t){var n;const{currentUserSettingsStore:r}=s().default.state;if(!r)return;const o=null===(n=r.getSettings())||void 0===n?void 0:n.tutorials;g({userAction:"TutorialActions.prevStep",environment:e,perform:e=>{i().mJ({userSettingsStore:r,transaction:e,data:{tutorials:{...o,[t]:(0,a().KD)(r,t)}}})},userId:r.id})}function d(e,t){var n;const{currentUserSettingsStore:o}=s().default.state;if(!o)return;const a=null===(n=o.getSettings())||void 0===n?void 0:n.tutorials;g({userAction:"TutorialActions.dismissTutorial",environment:e,perform:e=>{i().mJ({userSettingsStore:o,transaction:e,data:{tutorials:{...a,[t]:r().YD}}})},userId:o.id})}function u(e){const{currentUserSettingsStore:t}=s().default.state;t&&g({userAction:"TutorialActions.resetTutorialsDebug",environment:e,perform:e=>{i().mJ({userSettingsStore:t,transaction:e,data:{tutorials:{}}})},userId:t.id})}function p(e,t,n){var o;const{currentUserSettingsStore:l}=s().default.state;if(!l||(0,a().x$)(l,t))return;const c=(0,a().gt)(l,t);r().c$[t].steps.findIndex((e=>e.id===c))>=r().c$[t].steps.findIndex((e=>e.id===n))||i().mJ({userSettingsStore:l,transaction:e,data:{tutorials:{...null===(o=l.getSettings())||void 0===o?void 0:o.tutorials,[t]:n}}})}function f(e,t,n){if((0,a().ll)(n))return;const r=(0,a().tb)(t,n);r&&p(e,t,r)}function g(e){return o().createAndCommit({...e,canUndo:!1})}},77279:(e,t,n)=>{n.r(t),n.d(t,{default:()=>o});class r extends(()=>n(757695))().default{getInitialState(){return{discussionIdToExpansionStartPointMap:{}}}}const o=new r},204552:(e,t,n)=>{n.d(t,{c:()=>o,x:()=>i});var r=()=>n(645873);const o=(0,r()._h)(new(r().O2)("UniversalQnaModals",(async()=>await Promise.all([n.e(23806),n.e(37353),n.e(55373),n.e(29151),n.e(16908),n.e(48315),n.e(847),n.e(5887),n.e(17989),n.e(56985),n.e(21627),n.e(82472),n.e(96345),n.e(75659),n.e(47858),n.e(51860),n.e(221),n.e(14358)]).then(n.bind(n,457974)))),(e=>e.UniversalQnaModals)),i=(0,r()._h)(new(r().O2)("SlackConnectionOptions",(async()=>await n.e(85873).then(n.bind(n,210230)))),(e=>e.SlackConnectionOptions))},329452:(e,t,n)=>{n.d(t,{l:()=>r});const r=(0,n(340498).xh)("chat",{default:{loader:()=>Promise.resolve().then(n.bind(n,859002))},small:{loader:()=>n.e(24003).then(n.bind(n,827312))},fill:{loader:()=>n.e(22093).then(n.bind(n,296488))},fillSmall:{loader:()=>n.e(27370).then(n.bind(n,470447))}},["comment","bubble","chat","message","speech","right"])},354936:(e,t,n)=>{n.d(t,{Y:()=>w});n(581454),n(296540);var r=()=>n(484714),o=()=>n(56366),i=()=>n(401497),a=()=>n(980585),s=()=>n(284371),l=()=>n(704152),c=()=>n(493823),d=()=>n(760217),u=()=>n(406699),p=()=>n(928600),f=()=>n(939740),g=()=>n(89924),m=()=>n(859428),h=()=>n(722872),x=()=>n(553965),y=()=>n(962730),v=()=>n(88291),S=n(474848);function w(e){const t=e.model,n=(0,r().v3)(),w=(0,i().IS)((e=>({badge:{fontSize:12,fontWeight:500,padding:"1px 6px",backgroundColor:e.cardHoveredBackground,color:e.lightTextColor,borderRadius:4,...s().RC},checkIcon:{width:14}})),[]),j=(0,o().K8)((()=>v().$.getData(n,{})||[]),[n]),k=e.model?b[e.model]||e.model:"Default model";return(0,S.jsx)(u().Ay,{popupType:u().z7.Popup,placementToOrigin:u().sx.Bottom,alignmentToOrigin:u().yP.Start,renderOrigin:t=>(0,S.jsx)(m().A,{renderTooltip:()=>(0,S.jsx)("div",{children:"Select a model"}),placement:y().W.Bottom,alignment:y().C.Center,render:n=>"button"===e.format?(0,S.jsx)(c().p,{...(0,x().A)(t,n),children:k}):(0,S.jsx)(l().A,{...(0,x().A)(t,n),ignoreLocalHoverState:!0,children:(0,S.jsx)("div",{style:w.badge,children:k})})}),render:n=>(0,S.jsx)(p().A,{menuType:h().gu.Popup,children:(0,S.jsx)(f().Ay,{type:f().Oh.Vertical,initialFocus:0,sections:[{key:"models",render:e=>(0,S.jsx)(g().A,{...e,title:"Models",shouldShowBottomDivider:!0}),items:j.map((r=>({key:r,action:()=>{e.setModel(r),n.close()},render:e=>(0,S.jsx)(d().A,{...e,title:b[r]||r,right:r===t?(0,a().n)(w.checkIcon):void 0})})))}]})})})}const b={default:"Default model","openai-gpt-4o":"OpenAI GPT-4o","openai-chatgpt-4o-latest":"OpenAI ChatGPT-4o-latest","openai-gpt-4o-mini":"OpenAI GPT-4o-mini","openai-o1":"OpenAI o1","openai-o1-mini":"OpenAI o1-mini","openai-o3-mini":"OpenAI o3-mini","anthropic-haiku":"Anthropic Haiku","anthropic-sonnet-3.5":"Anthropic Sonnet 3.5","anthropic-sonnet-3.7":"Anthropic Sonnet 3.7","anthropic-opus":"Anthropic Opus","vertex-gemini-1.5-pro":"Vertex Gemini 1.5 Pro","vertex-gemini-1.5-flash":"Vertex Gemini 1.5 Flash","vertex-gemini-2.0-flash":"Vertex Gemini 2.0 Flash","groq-gemma2-9b-it":"Groq Gemma2 9b It","groq-gemma-7b-it":"Groq Gemma 7b It","groq-llama-70b":"Groq Llama 70b","groq-llama-8b":"Groq Llama 8b","groq-mixtral":"Groq Mixtral","fireworks-llama3.1-405b":"Llama 3.1 405b","fireworks-llama3.1-70b":"Llama 3.1 70b","fireworks-llama3.3-70b":"Llama 3.3 70b","fireworks-llama3.3-70b-dedicated":"Llama 3.3 70b Dedicated","fireworks-llama3.1-8b":"Llama 3.1 8b","fireworks-llama3-70b":"Llama 3.70b","fireworks-mixtral-22b":"Mixtral 22b","fireworks-mixtral-7b":"Mixtral 7b","fireworks-ft-router-101":"FT Router 101","fireworks-ft-router-102":"FT Router 102","fireworks-deepseek-v3":"DeepSeek V3","fireworks-deepseek-r1":"DeepSeek R1","cerebras-llama3.1-8b":"Cerebras Llama 3.1 8b","cerebras-llama3.3-70b":"Cerebras Llama 3.3 70b","cerebras-deepseek-r1-distill-llama-70b":"Cerebras DeepSeek R1 Distill Llama 70b","bedrock-nova-pro":"Bedrock Nova Pro","bedrock-nova-lite":"Bedrock Nova Lite","bedrock-nova-micro":"Bedrock Nova Micro"}},383245:(e,t,n)=>{n.d(t,{A:()=>u,m:()=>p});n(16280),n(296540);var r=()=>n(56366),o=()=>n(401497),i=()=>n(284371),a=()=>n(94522),s=()=>n(776690),l=()=>n(363186),c=()=>n(310397),d=n(474848);function u(e){const{module:t,workflowValue:n,workflowDefinitionPointer:r,isInTranscript:a,saveModule:s,store:l}=e,u=(0,o().IS)((e=>({container:{display:"flex",gap:4,flexDirection:"column"},title:{color:e.text.tertiary,fontWeight:i().Wy.medium,fontSize:14}})),[]),p=c().y[t.type],f=s;if(!p)throw new Error(`Module definition not found for module ${t.type}`);if(p.ModuleConfiguration){const{ModuleConfiguration:e}=p;return(0,d.jsx)("div",{style:u.container,children:(0,d.jsx)(e,{module:t,workflowValue:n,workflowDefinitionPointer:r,isInTranscript:a,saveModule:f,store:l})})}return null}function p(e){const{module:t,isInTranscript:n}=e,{workflowStore:o,clientStore:i,threadStore:c,saveModule:p}=(0,l().$O)(),f=(0,s().J)(),g=(0,r().K8)((()=>(0,a().Cq)({workflowStore:o,threadStore:c,clientStore:i})),[o,c,i]),m=o??c;return g&&f&&m?(0,d.jsx)(u,{workflowValue:f,module:t,workflowDefinitionPointer:g,isInTranscript:n,saveModule:p,store:m}):null}},383286:(e,t,n)=>{n.d(t,{E:()=>o});n(296540);var r=n(474848);const o=(0,n(340498).wt)("microphone",{viewBox:"0 0 17 25",svg:(0,r.jsx)("path",{d:"M0.20752 12.0743C0.20752 13.5496 0.511882 14.853 1.12061 15.9845C1.72933 17.116 2.57438 18.0219 3.65576 18.7023C4.73714 19.3826 5.98324 19.7908 7.39404 19.9269V22.129H3.45166C3.17236 22.129 2.93245 22.2257 2.73193 22.4191C2.53141 22.6196 2.43115 22.8595 2.43115 23.1388C2.43115 23.4109 2.53141 23.6437 2.73193 23.837C2.93245 24.0376 3.17236 24.1378 3.45166 24.1378H13.313C13.5923 24.1378 13.8322 24.0376 14.0327 23.837C14.2332 23.6437 14.3335 23.4109 14.3335 23.1388C14.3335 22.8595 14.2332 22.6196 14.0327 22.4191C13.8322 22.2257 13.5923 22.129 13.313 22.129H9.37061V19.9269C10.7814 19.7908 12.0239 19.3826 13.0981 18.7023C14.1795 18.0219 15.0246 17.116 15.6333 15.9845C16.242 14.853 16.5464 13.5496 16.5464 12.0743V9.94739C16.5464 9.66809 16.4461 9.43176 16.2456 9.2384C16.0522 9.04504 15.8159 8.94836 15.5366 8.94836C15.2573 8.94836 15.0174 9.04504 14.8169 9.2384C14.6164 9.43176 14.5161 9.66809 14.5161 9.94739V11.9991C14.5161 13.2166 14.2583 14.2837 13.7427 15.2003C13.2271 16.1098 12.5109 16.8152 11.5942 17.3165C10.6776 17.8178 9.60693 18.0685 8.38232 18.0685C7.16488 18.0685 6.09424 17.8178 5.17041 17.3165C4.24658 16.8152 3.52686 16.1098 3.01123 15.2003C2.50277 14.2837 2.24854 13.2166 2.24854 11.9991V9.94739C2.24854 9.66809 2.14827 9.43176 1.94775 9.2384C1.74723 9.04504 1.50374 8.94836 1.21729 8.94836C0.94515 8.94836 0.708822 9.04504 0.508301 9.2384C0.30778 9.43176 0.20752 9.66809 0.20752 9.94739V12.0743ZM8.38232 15.8448C9.10563 15.8448 9.75016 15.6766 10.3159 15.34C10.8888 14.9962 11.3364 14.5236 11.6587 13.922C11.9881 13.3204 12.1528 12.6222 12.1528 11.8273V4.59778C12.1528 3.80286 11.9881 3.10461 11.6587 2.50305C11.3364 1.90149 10.8888 1.43241 10.3159 1.09583C9.75016 0.752075 9.10563 0.5802 8.38232 0.5802C7.65902 0.5802 7.0109 0.752075 6.43799 1.09583C5.87223 1.43241 5.42464 1.90149 5.09521 2.50305C4.76579 3.10461 4.60107 3.80286 4.60107 4.59778V11.8273C4.60107 12.6222 4.76579 13.3204 5.09521 13.922C5.42464 14.5236 5.87223 14.9962 6.43799 15.34C7.0109 15.6766 7.65902 15.8448 8.38232 15.8448Z"})})},388182:(e,t,n)=>{n.d(t,{A:()=>r});const r=n(757695).default.createValue({open:!1},{name:"ConfirmOverwriteModalStore"})},403315:(e,t,n)=>{n.d(t,{a:()=>r});const r=(0,n(340498).xh)("checkmark",{default:{loader:()=>n.e(38978).then(n.bind(n,29037))},small:{loader:()=>n.e(7180).then(n.bind(n,349679))},fill:{loader:()=>n.e(43920).then(n.bind(n,94701))},fillSmall:{loader:()=>n.e(38789).then(n.bind(n,73956))}},["check","tick","confirm","approve","success"])},484762:(e,t,n)=>{n.d(t,{cZ:()=>Mt,aU:()=>Bt,qI:()=>Ot});n(16280),n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(354520),n(672577),n(581454);var r=n(296540),o=()=>n(484714),i=()=>n(56366),a=()=>n(401497),s=()=>n(187174),l=()=>n(22634),c=()=>n(952816),d=()=>n(883234),u=()=>n(918676),p=()=>n(872146),f=()=>n(980585),g=()=>n(179034),m=()=>n(96689),h=()=>n(234459),x=()=>n(919709),y=()=>n(959013),v=()=>n(449506),S=()=>n(783793),w=()=>n(84817),b=()=>n(493823),j=()=>n(760217),k=()=>n(406699),C=()=>n(285790),I=()=>n(331542),T=()=>n(928600),A=()=>n(939740),M=()=>n(8980),B=()=>n(554509),D=()=>n(89924),P=()=>n(859428),K=()=>n(518598),O=()=>n(581495),W=()=>n(200562),E=()=>n(38337),z=()=>n(847743),N=()=>n(594794),F=()=>n(722872),q=()=>n(953418),G=()=>n(255063),V=()=>n(725614);var L=()=>n(496603);function $(e){const{input:t,debounceMs:n,useDeepEqual:o}=e,i=(0,r.useRef)(!1),[a,s]=(0,r.useState)(t),l=(0,r.useRef)(t);return(0,r.useEffect)((()=>{if(o?L().n4(t,l.current):t===l.current)return;i.current=!0,l.current=t;const e=setTimeout((()=>{i.current=!1,s(t)}),n);return()=>clearTimeout(e)}),[t,n,o]),{value:a,isBuffering:i.current}}var R=()=>n(644914),U=()=>n(351360),_=()=>n(227440),H=()=>n(948914),Y=()=>n(630116),J=()=>n(46986),X=()=>n(582524),Z=()=>n(36951),Q=()=>n(600434),ee=()=>n(255299),te=()=>n(383286),ne=()=>n(102777),re=()=>n(340498),oe=n(474848);const ie=(0,re().wt)("stop",{viewBox:"0 0 20 20",svg:(0,oe.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 19 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,oe.jsx)("rect",{y:"0.793945",width:"18.8027",height:"18.8027",rx:"9.40137",fill:"#37352F"}),(0,oe.jsx)("rect",{x:"5.91028",y:"6.7041",width:"6.98255",height:"6.98255",rx:"0.783447",fill:"white"})]})});var ae=()=>n(606952),se=()=>n(317909),le=()=>n(246722),ce=()=>n(549500),de=()=>n(792540),ue=()=>n(301421),pe=()=>n(370657);const fe=(0,re().xh)("arrowIntersectRight",{default:{loader:()=>n.e(22749).then(n.bind(n,139676))},small:{loader:()=>n.e(91715).then(n.bind(n,934202))},fill:{loader:()=>n.e(18925).then(n.bind(n,371846))},fillSmall:{loader:()=>n.e(18730).then(n.bind(n,882677))}},["shuffle","cross","crisscross","diverge","converge"]);var ge=()=>n(329452),me=()=>n(403315),he=()=>n(668725);const xe=(0,re().xh)("comment",{default:{loader:()=>n.e(54686).then(n.bind(n,168345))},small:{loader:()=>n.e(7632).then(n.bind(n,566531))},fill:{loader:()=>n.e(80300).then(n.bind(n,534921))},fillSmall:{loader:()=>n.e(71345).then(n.bind(n,432272))}},["comment","bubble","chat","message","speech"]),ye=(0,re().xh)("cube",{default:{loader:()=>n.e(79216).then(n.bind(n,465505))},small:{loader:()=>n.e(14082).then(n.bind(n,79787))},fill:{loader:()=>n.e(71578).then(n.bind(n,177985))},fillSmall:{loader:()=>n.e(9703).then(n.bind(n,703432))}},["cube","box","threedimensional","geometric","square"]),ve=(0,re().xh)("eyeglasses",{default:{loader:()=>Promise.resolve().then(n.bind(n,38679))},small:{loader:()=>n.e(4472).then(n.bind(n,171505))},fill:{loader:()=>Promise.resolve().then(n.bind(n,45923))},fillSmall:{loader:()=>n.e(26953).then(n.bind(n,298778))}},["glasses","eyewear","spectacles","vision","lenses"]);var Se=()=>n(534177),we=()=>n(460292),be=()=>n(515918),je=()=>n(477293);function ke(e){const{clientStore:t}=e,n=(0,je().r)("ai_chat_mode_selector");return"control"===n?(0,oe.jsx)(Ce,{clientStore:t}):"dropdown"===n?(0,oe.jsx)(Ie,{clientStore:t}):(0,Se().HB)(n)}function Ce(e){const{clientStore:t}=e,n=(0,i().K8)((()=>{var e;return null===(e=t.state.config)||void 0===e?void 0:e.type}),[t]),o=(0,r.useCallback)((e=>{t.setState({...t.state,userSelectedConfig:!0,config:e})}),[t]),s=(0,a().IS)((e=>({buttonWrapper:{display:"flex",alignItems:"center",gap:4},button:{borderRadius:"100px",paddingLeft:10,paddingRight:10},selectedButton:{background:e.outlineBlueButtonHoveredBackground}})),[]);return(0,oe.jsx)("div",{style:s.buttonWrapper,children:pe().r5.map((e=>(0,oe.jsx)(b().p,{isBlue:e.type===n,isGray:e.type!==n,style:{...s.button,...e.type===n&&s.selectedButton},onClick:()=>o(e),children:(0,oe.jsx)(We,{type:e.type})},e.type)))})}function Ie(e){const{clientStore:t}=e,n=(0,i().K8)((()=>{var e;const n=null===(e=t.state.config)||void 0===e?void 0:e.type;return t.state.userSelectedConfig&&n?n:"auto"}),[t]),o=(0,r.useCallback)((e=>{e?t.setState({...t.state,userSelectedConfig:!0,config:e}):t.setState({...t.state,userSelectedConfig:!1})}),[t]),s=(0,a().IS)((e=>({chevron:{width:10,marginLeft:4,fill:e.lightIconColor},button:{display:"flex",alignItems:"center",gap:4,borderRadius:"100px",background:e.accentColors.translucentGray[50],border:`1px solid ${e.outlineButtonBorder}`}})),[]);return(0,oe.jsx)(k().Ay,{popupType:k().z7.Popup,placementToOrigin:k().sx.Bottom,alignmentToOrigin:k().yP.Start,originGap:4,renderOrigin:e=>(0,oe.jsxs)(b().p,{...e,isGray:!0,style:s.button,children:[(0,oe.jsx)(Be,{type:n}),(0,oe.jsx)(De,{type:n}),(0,he().b)(s.chevron)]}),render:e=>(0,oe.jsx)(Oe,{type:n,handleSelectConfig:t=>{o(t),e.close()}})})}const Te={auto:fe,"markdown-chat":ge().l,search:xe,researcher:ve,workflow:ye};function Ae(e,t){const n={auto:t.accentColors.gray[400],"markdown-chat":t.accentColors.blue[400],search:t.accentColors.green[400],researcher:t.accentColors.red[400],workflow:t.accentColors.purple[400]};return(0,Se().O)(n,e)?n[e]:n.auto}function Me(e,t){const n={auto:t.accentColors.gray[100],"markdown-chat":t.accentColors.blue[100],search:t.accentColors.green[100],researcher:t.accentColors.red[100],workflow:t.accentColors.purple[100]};return(0,Se().O)(n,e)?n[e]:n.auto}function Be(e){let{type:t,showBackground:n=!1}=e,r=ge().l;(0,Se().O)(Te,t)&&(r=Te[t]);const o=(0,a().IS)((e=>({iconWrapper:{background:Me(t,e),borderRadius:2,padding:4},icon:{color:Ae(t,e)}})),[t]);return n?(0,oe.jsx)("div",{style:o.iconWrapper,children:(0,oe.jsx)(we().Q,{iconGroup:r,variantName:"small",style:o.icon})}):(0,oe.jsx)(we().Q,{iconGroup:r,variantName:"small",style:o.icon})}function De(e){let{type:t}=e;return"auto"===t?(0,oe.jsx)(y().sA,{id:"AIModePicker.buttonContent.auto",defaultMessage:"Auto"}):(0,oe.jsx)(We,{type:t})}function Pe(e){let{type:t}=e;return"auto"===t?(0,oe.jsx)(y().sA,{id:"AIModePicker.typeCaption.auto",defaultMessage:"Automatic mode selection"}):"markdown-chat"===t?(0,oe.jsx)(y().sA,{id:"AIModePicker.typeCaption.markdownChat",defaultMessage:"Chat and get answers"}):"search"===t?(0,oe.jsx)(y().sA,{id:"AIModePicker.typeCaption.search",defaultMessage:"Get help finding information"}):"researcher"===t?(0,oe.jsx)(y().sA,{id:"AIModePicker.typeCaption.researcher",defaultMessage:"Analysis for complex questions"}):"workflow"===t?(0,oe.jsx)(y().sA,{id:"AIModePicker.typeCaption.workflow",defaultMessage:"Create an app"}):null}function Ke(e){const t={"markdown-chat":!1,search:!1,researcher:!0,workflow:!0};return!!(0,Se().O)(t,e)&&t[e]}function Oe(e){const{handleSelectConfig:t,type:n}=e,r={key:"auto",render:e=>(0,oe.jsx)(j().A,{...e,icon:(0,oe.jsx)(Be,{type:"auto",showBackground:!0}),title:(0,oe.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:2},children:[(0,oe.jsx)(De,{type:"auto"}),Ke("auto")?(0,oe.jsx)(be().A,{}):null]}),caption:(0,oe.jsx)(Pe,{type:"auto"}),right:"auto"===n?(0,oe.jsx)(we().Q,{iconGroup:me().a,variantName:"small"}):null}),action:()=>t(void 0)},o=pe().r5.map((e=>({key:e.type,render:t=>(0,oe.jsx)(j().A,{...t,icon:(0,oe.jsx)(Be,{type:e.type,showBackground:!0}),title:(0,oe.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:2},children:[(0,oe.jsx)(De,{type:e.type}),Ke(e.type)?(0,oe.jsx)(be().A,{}):null]}),caption:(0,oe.jsx)(Pe,{type:e.type}),right:n===e.type?(0,oe.jsx)(we().Q,{iconGroup:me().a,variantName:"small"}):null}),action:()=>t(e)})));return(0,oe.jsx)(T().A,{menuType:F().gu.Popup,children:(0,oe.jsx)(A().Ay,{type:A().Oh.Vertical,initialFocus:void 0,sections:[{key:"configs",render:e=>(0,oe.jsx)(D().A,{...e}),items:[r,...o]}]})})}function We(e){let{type:t}=e;return(0,oe.jsx)(y().sA,{...Ee[t]})}const Ee=(0,y().YK)({talkTo:{id:"aiInferenceTranscript.configType.talkTo",defaultMessage:"Talk to..."},"markdown-chat":{id:"aiInferenceTranscript.configType.markdownChat",defaultMessage:"Chat"},search:{id:"aiInferenceTranscript.configType.search",defaultMessage:"Ask"},"fast-researcher":{id:"aiInferenceTranscript.configType.fastResearcher",defaultMessage:"Fast Researcher"},workflow:{id:"aiInferenceTranscript.configType.workflow",defaultMessage:"Build"},"simple-workflow":{id:"aiInferenceTranscript.configType.simpleWorkflow",defaultMessage:"Simple Workflow"},"update-workflow":{id:"aiInferenceTranscript.configType.updateWorkflow",defaultMessage:"Update Workflow"},"update-workflow-function":{id:"aiInferenceTranscript.configType.updateWorkflowFunction",defaultMessage:"Update Workflow Function"},"setup-generator":{id:"aiInferenceTranscript.configType.setupGenerator",defaultMessage:"Setup Generator"},researcher:{id:"aiInferenceTranscript.configType.researcher",defaultMessage:"Deep research"},"tool-markdown-chat":{id:"aiInferenceTranscript.configType.toolMarkdownChat",defaultMessage:"Tool Markdown Chat"},autocorrect:{id:"aiInferenceTranscript.configType.autocorrect",defaultMessage:"Autocorrect"},"debug-inference":{id:"aiInferenceTranscript.configType.debugInference",defaultMessage:"Debug Inference"},"memory-agent":{id:"aiInferenceTranscript.configType.memoryAgent",defaultMessage:"Memory Agent"},"summarize-transcript":{id:"aiInferenceTranscript.configType.summarizeTranscript",defaultMessage:"Summarize Transcript"},"route-inference-transcript":{id:"aiInferenceTranscript.configType.routeInferenceTranscript",defaultMessage:"Route Inference Transcript"}}),ze=(0,y().YK)({placeholder:{id:"aiInferenceTranscript.placeholder",defaultMessage:"Ask AI anything..."}});function Ne(e){const t=(0,y().tz)(),{store:n,onSubmit:s,clientStore:l,threadStore:c,showModePicker:d,aiChatFeatureController:u}=e,p=(0,o().v3)(),[f,g]=r.useState(!1),m=(0,i().K8)((()=>0===(0,x().AhH)(n.getValue()||[])),[n]),h=(0,i().K8)((()=>l.state.loading||void 0!==(null==c?void 0:c.getCurrentInferenceId())),[l,c]),v=(0,r.useCallback)((()=>{if(!c)return;const{serverCommitResult:e}=se().createAndCommit({userAction:"AIChatTranscript.StopInferenceButton.handleClick",environment:p,canUndo:!0,perform:e=>{(0,X().GS)({threadStore:c,transaction:e,clientStore:l})}});l.setState({...l.state,stopInferencePromise:e})}),[p,c,l]),S=(0,r.useCallback)((async()=>{const{dictationActions:e}=await ce().$O.load(),t=(0,x().q4_)(n.getValue()||[]);await e.StreamingDictationManager.start({environment:p,onTranscription:e=>{const r=t?`${t}\n${e}`:e;se().createAndCommit({userAction:"AIChatInput.handleDictation",environment:p,canUndo:!0,perform:e=>{ae().KY({environment:p,store:n,value:(0,x().x9d)(r),transaction:e})}})}}),g(!0)}),[p,n]),w=(0,r.useCallback)((async()=>{const{dictationActions:e}=await ce().$O.load();await e.StreamingDictationManager.stop(),g(!1)}),[]);(0,r.useEffect)((()=>()=>{w()}),[w]);const b=(0,a().IS)((e=>({stagingAndInputWrap:{overflow:"inherit",flexGrow:1,flexShrink:1},wrap:{display:"flex",alignItems:"center",fontSize:14,flexWrap:"wrap",boxShadow:`0px 0px 0px 0.5px ${e.stroke.primary}, 0px 4px 12px -2px rgba(0, 0, 0, 0.08)`,backgroundColor:"dark"===e.mode?e.accentColors.translucentGray[100]:e.contentBackground,borderRadius:12,overflow:"inherit",position:"relative"},textContainer:{flexGrow:1,padding:"10px 12px 16px 12px",minHeight:void 0,maxHeight:240,overflow:"auto"},placeholder:{opacity:1,cursor:"text"},rightGutter:{display:"flex",alignItems:"center",justifyContent:"center",padding:6,gap:6},leftGutter:{display:"flex",alignItems:"flex-end",justifyContent:"flex-start",padding:"0 0 6px 12px"},sendButtonIcon:{width:28,height:28},microphoneIcon:{width:28},stopIcon:{width:28,height:28},inputActionsRow:{display:"flex",width:"100%",justifyContent:"space-between"}})),[]),j=(0,r.useCallback)((()=>{V().clear({environment:p})}),[p]),k=(0,r.useCallback)((()=>{h||(null==s||s(n.getValue()),requestAnimationFrame((()=>{const e=ue().n.findNodeFromStore(n);e&&e.focus()})))}),[s,n,h]);return(0,oe.jsx)("div",{style:b.stagingAndInputWrap,tabIndex:0,children:(0,oe.jsxs)("div",{style:b.wrap,onClick:e=>{if(e.target===e.currentTarget){const t=ue().n.findEditableWithStore(n);t&&t.handleClick(e)}},children:[(0,oe.jsx)(le().A,{style:b.textContainer,placeholder:t.formatMessage(ze.placeholder),disabled:!1,store:n,placeholderStyle:b.placeholder,pasteBehavior:"inline",disableSlashCommands:!0,disableEmbedMenu:!0,disableEmojiCommands:!1,disableComment:!0,disableSelectAllBlocks:!0,disableSelectionDrag:!0,disableEnter:!1,onEnter:k,disableMobileActionBar:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableSuggestEdit:!0,inPageFind:de().Os.none,usePopupForMentionOnMobile:!0,onBlur:j,disableMentions:!u.shouldAllowMentions}),(0,oe.jsxs)("div",{style:b.inputActionsRow,children:[d&&(0,oe.jsx)("div",{style:b.leftGutter,children:(0,oe.jsx)(ke,{clientStore:l})}),(0,oe.jsx)("div",{style:{flexGrow:1}}),(0,oe.jsx)("div",{style:b.rightGutter,children:f?(0,oe.jsx)(C().A,{icon:ie,onClick:w,iconStyle:b.stopIcon,ariaLabel:t.formatMessage({id:"aiInferenceTranscript.stopRecording",defaultMessage:"Stop recording"})},"stop-recording"):h?(0,oe.jsx)(C().A,{icon:ie,onClick:v,iconStyle:b.stopIcon,ariaLabel:t.formatMessage({id:"aiInferenceTranscript.stopInference",defaultMessage:"Stop AI message"})},"stop-inference"):(0,oe.jsxs)(oe.Fragment,{children:[!f&&(0,oe.jsx)(C().A,{icon:te().E,onClick:S,iconStyle:b.microphoneIcon,ariaLabel:t.formatMessage({id:"aiInferenceTranscript.startRecording",defaultMessage:"Start recording"})},"start-recording"),(0,oe.jsx)(C().A,{icon:ne().b,onClick:k,iconStyle:b.sendButtonIcon,isBlue:!m,disabled:m,ariaLabel:t.formatMessage({id:"aiInferenceTranscript.submitAiMessage",defaultMessage:"Submit AI message"})},"send-message")]})})]})]})})}var Fe=()=>n(639838);function qe(e){const{clientStore:t,threadStore:n,handleNewSearch:s}=e,[l,c]=(0,r.useState)(!1),d=(0,y().tz)(),u=(0,a().IS)((e=>({text:{width:"100%",transition:"box-shadow .125s ease",padding:4,borderRadius:6,...l&&{boxShadow:"0 0 0 2px #E3E2E080"}},placeholder:{color:e.pageTitlePlaceholderTextColor}})),[l]),p=(0,r.useRef)(!0),f=(0,o().v3)(),g=(0,i().K8)((()=>{var e;const r=(0,ee().A3)({clientStore:t,threadStore:n}),o=null===(e=r.find((e=>"config"===e.type)))||void 0===e?void 0:e.value;if(o){if("search"===o.type){const e=r.find((e=>"user"===e.type));if(!e)return;return e.value}"autocorrect"!==o.type&&"debug-inference"!==o.type&&"markdown-chat"!==o.type&&"memory-agent"!==o.type&&"summarize-transcript"!==o.type&&"fast-researcher"!==o.type&&"simple-workflow"!==o.type&&"update-workflow"!==o.type&&"update-workflow-function"!==o.type&&"setup-generator"!==o.type&&"researcher"!==o.type&&"tool-markdown-chat"!==o.type&&"route-inference-transcript"!==o.type&&"workflow"!==o.type&&(0,Se().HB)(o)}}),[t,n]);(0,r.useEffect)((()=>{p.current=!0}),[null==n?void 0:n.id]);const{store:m,setValue:h}=(0,z().AI)({initialValue:g});return(0,r.useEffect)((()=>{p.current&&g&&(h(g),p.current=!1)}),[g,h]),n&&g?(0,oe.jsx)("div",{style:{width:"100%",marginBottom:20,marginTop:0},children:(0,oe.jsx)("div",{style:{width:"100%",margin:"auto",display:"flex",justifyContent:"space-between",gap:6,alignItems:"center"},children:(0,oe.jsx)("div",{onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),style:{width:"100%"},children:(0,oe.jsx)(le().A,{disabled:!1,onFocus:()=>{V().selectAllText({environment:f,store:m,canSelectAllBlocks:!1})},onBlur:()=>{h(g)},onEnter:()=>{s(m.getValue())},store:m,pasteBehavior:"inline",disableBrowserSpellcheck:!0,disableSlashCommands:!0,disableEmbedMenu:!0,disableEmojiCommands:!1,disableComment:!0,disableSelectAllBlocks:!0,disableSelectionDrag:!0,disableMobileActionBar:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableSuggestEdit:!0,usePopupForMentionOnMobile:!0,placeholder:d.formatMessage({defaultMessage:"Search or ask anything",id:"assistant.deepFind.inputPlaceholder"}),placeholderStyle:u.placeholder,inPageFind:de().Os.none,style:u.text,className:"tx-uititle-30-semibold",disableMentions:!0})})})}):null}var Ge=()=>n(218602),Ve=()=>n(460744),Le=()=>n(212050),$e=()=>n(86465),Re=()=>n(724639),Ue=()=>n(625830),_e=()=>n(623580),He=()=>n(962730),Ye=()=>n(981928),Je=()=>n(562936),Xe=()=>n(459129),Ze=()=>n(735384),Qe=()=>n(297872);function et(e){const[t,n]=(0,r.useState)(!1),{onFocus:o,onBlur:i,...a}=e,s=e=>{n(!0),null==o||o(e)},l=e=>{n(!1),null==i||i(e)};return(0,oe.jsx)(Qe().A,{capture:t,render:e=>(0,oe.jsx)(_e().A,{...a,...e,onFocus:s,onBlur:l})})}function tt(e){const t=(0,y().tz)(),{request:n,memory:i,clientStore:s,onChange:l}=e,c=(0,o().v3)(),[d,u]=(0,r.useState)(!1),p=(0,a().IS)((e=>({topbar:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:8},inputWrap:{flexGrow:1},status:{marginRight:2}})),[]),f=(0,r.useCallback)((e=>{l({...i,feedback:e.target.value})}),[i,l]),g=(0,r.useCallback)((()=>{l(void 0)}),[l]),m=(0,r.useCallback)((async()=>{u(!0),await(0,Xe().Wd)({environment:c,request:n,memory:i,clientStore:s,onChange:l}),u(!1)}),[c,n,i,s,l]);return(0,oe.jsxs)(oe.Fragment,{children:[(0,oe.jsxs)("div",{style:p.topbar,children:[(0,oe.jsx)(P().A,{renderTooltip:()=>(0,oe.jsx)("div",{style:{width:300,whiteSpace:"normal"},children:"The text you type here is used as feedback to generate an InferenceMemory."}),placement:He().W.Top,render:e=>(0,oe.jsx)("div",{...e,style:p.inputWrap,children:(0,oe.jsx)(et,{value:i.feedback,placeholder:"Set feedback",onChange:f,textarea:!0,autosize:!0})})}),(0,oe.jsx)(b().p,{onClick:m,children:"Run"})]}),(0,oe.jsx)(Je().b,{label:"Memory",left:(0,oe.jsxs)("div",{style:p.status,children:[" ",d?(0,oe.jsx)(I().A,{}):i.verified?"✅":"❌"]}),children:(0,oe.jsx)(Ye().X,{language:"json",value:JSON.stringify(i,null,2)})}),(0,oe.jsx)(C().A,{icon:Ze().I,onClick:g,ariaLabel:t.formatMessage({id:"aiInferenceTranscript.memoryEditor.deleteMemory",defaultMessage:"Delete memory"})})]})}var nt=()=>n(763884),rt=()=>n(419357),ot=()=>n(864943);function it(e){const{scopeKey:t,inference:n,defaultState:r}=e,o=(0,a().IS)((e=>({chevron:{width:10,marginLeft:4,fill:e.lightIconColor},menuContent:{display:"flex",flexDirection:"column",gap:8,padding:8},label:{fontSize:12,color:e.regularTextColor}})),[]);return(0,oe.jsx)(k().Ay,{popupType:k().z7.Popup,placementToOrigin:k().sx.Bottom,alignmentToOrigin:k().yP.Start,renderOrigin:e=>(0,oe.jsxs)(b().p,{...e,children:[(0,oe.jsx)("div",{children:"Save"}),(0,he().b)(o.chevron)]}),render:e=>(0,oe.jsx)(at,{scopeKey:t,inference:n,buttonPopupParent:e,defaultState:r})})}function at(e){const{scopeKey:t,inference:n,buttonPopupParent:i,defaultState:s}=e,l=(0,o().v3)(),c=(0,a().IS)((e=>({menuContent:{display:"flex",flexDirection:"column",gap:8,padding:8},label:{fontSize:12,color:e.regularTextColor}})),[]),d=(0,r.useMemo)((()=>function(e){const{environment:t,scopeKey:n,defaultState:r}=e,o=ut(n),i=nt().A.get({userId:t.currentUser.id,key:o});if(!i&&r)return r;return i||{project:void 0,dataset:void 0,tags:[]}}({environment:l,scopeKey:t,defaultState:s})),[l,s,t]),[u,p]=(0,r.useState)(d),f=(0,r.useCallback)((e=>{p(e),function(e){const{environment:t,scopeKey:n,state:r}=e,o=ut(n);nt().A.set({userId:t.currentUser.id,key:o,value:r})}({environment:l,scopeKey:t,state:e})}),[l,t]),g=(0,r.useCallback)((e=>{f({...u,project:e,dataset:void 0})}),[f,u]),m=(0,r.useCallback)((e=>{f({...u,dataset:e})}),[f,u]),h=(0,r.useCallback)((e=>{f({...u,tags:e})}),[f,u]),x=(0,r.useCallback)((()=>{const{project:e,dataset:t,tags:r}=u;e&&t&&(0,Xe().wm)({environment:l,inference:{...n,tags:r},project:e.name,dataset:t})}),[l,n,u]);return(0,oe.jsx)(T().A,{menuType:F().gu.Popup,...i,children:(0,oe.jsxs)("div",{style:c.menuContent,children:[(0,oe.jsx)("div",{style:c.label,children:"Project"}),(0,oe.jsx)(st,{project:u.project,setProject:g}),u.project&&(0,oe.jsxs)(oe.Fragment,{children:[(0,oe.jsx)("div",{style:c.label,children:"Dataset"}),(0,oe.jsx)(lt,{project:u.project.name,dataset:u.dataset,onChange:m})]}),u.project&&u.dataset&&(0,oe.jsxs)(oe.Fragment,{children:[(0,oe.jsx)("div",{style:c.label,children:"Tags"}),(0,oe.jsx)(dt,{tags:u.tags,onChange:h}),(0,oe.jsx)(ot().A,{size:"lg",onClick:x,children:"Save"})]})]})})}function st(e){const t=e.project,[n,i]=(0,r.useState)([]),a=(0,o().v3)();return(0,s().Yb)((async()=>{const e=await v().callApi({eventName:"getBraintrustProjects",environment:a,data:{}});if("failed"===e.type)throw e.error;i(e.data.projects.map((e=>{let{id:t,name:n}=e;return{id:t,name:n}})))}),[a]),(0,oe.jsx)(ct,{items:n.sort(((e,t)=>e.name.localeCompare(t.name))),selectedItem:t,onSelect:e.setProject,renderItem:e=>e.name,isFiltered:(e,t)=>e.name.toLowerCase().includes(t.toLowerCase()),placeholder:"Select project"})}function lt(e){const{project:t,dataset:n,onChange:i}=e,a=(0,o().v3)(),[l,c]=(0,r.useState)([]),d=(0,r.useCallback)((async()=>{if(!t)return;const e=await v().callApi({eventName:"getBraintrustDatasetsForProject",environment:a,data:{project:t}});if("failed"===e.type)throw e.error;const n=e.data.datasets.map((e=>e.name));n.sort(),c(n)}),[a,t]);return(0,s().Yb)((async()=>{await d()}),[d]),(0,oe.jsx)(ct,{items:l,selectedItem:n,onSelect:i,renderItem:L().D_,isFiltered:(e,t)=>e.toLowerCase().includes(t.toLowerCase()),placeholder:"Select dataset"})}function ct(e){const{items:t,selectedItem:n,onSelect:o,renderItem:i,placeholder:s,isFiltered:l}=e,c=(0,a().IS)((e=>({chevron:{width:10,marginLeft:4,fill:e.lightIconColor},buttonWrapper:{display:"flex",alignItems:"center"}})),[]),[d,u]=(0,r.useState)(""),p=(0,r.useCallback)((e=>{u(e.target.value)}),[]),f=t.filter((e=>l(e,d)));return(0,oe.jsx)(k().Ay,{popupType:k().z7.Popup,placementToOrigin:k().sx.Bottom,alignmentToOrigin:k().yP.Start,renderOrigin:e=>(0,oe.jsx)(b().p,{...e,children:(0,oe.jsxs)("div",{style:c.buttonWrapper,children:[n?i(n):s||"",(0,he().b)(c.chevron)]})}),render:e=>(0,oe.jsxs)(T().A,{menuType:F().gu.Popup,children:[(0,oe.jsx)(rt().Ay,{value:d,onChange:p,autoFocus:!0}),(0,oe.jsx)(A().Ay,{type:A().Oh.Vertical,initialFocus:0,sections:[{key:"items",render:e=>(0,oe.jsx)(D().A,{...e}),items:f.map(((t,r)=>({key:r,action:()=>{o(t),e.close()},render:e=>(0,oe.jsx)(j().A,{...e,title:i(t),checkState:t===n})})))}]})]})})}function dt(e){const{tags:t,onChange:n}=e,o=(0,a().IS)((e=>({container:{display:"flex",flexDirection:"column",gap:4},tagsContainer:{display:"flex",flexWrap:"wrap",gap:8}})),[]),i=(0,r.useCallback)((e=>{const r=t.includes(e)?t.filter((t=>t!==e)):[...t,e];n(r)}),[n,t]);return(0,oe.jsx)("div",{style:o.container,children:(0,oe.jsx)("div",{style:o.tagsContainer,children:pe().d7.map((e=>(0,oe.jsxs)(b().p,{onClick:()=>i(e),style:{display:"flex",alignItems:"center",gap:4},children:[(0,oe.jsx)(Ue().A,{checked:t.includes(e),size:14}),(0,oe.jsx)("span",{children:e})]},e)))})})}function ut(e){return`ai-inference-transcript-save-to-dataset-${e}`}function pt(e){const t=(0,y().tz)(),{clientStore:n,threadStore:o}=e,s=(0,a().IS)((e=>({topBar:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:8,fontSize:14},configEditorWrap:{display:"flex",flexDirection:"column",gap:8,overflowY:"auto",fontSize:14},inferencesWrap:{display:"flex",flexDirection:"column",gap:8,overflowY:"auto",fontSize:14},tagsRow:{display:"flex",alignItems:"center",gap:8},header:{fontSize:14}})),[]),l=(0,r.useCallback)((()=>{n.setState({...n.state,showDebug:!1})}),[n]),c=(0,i().K8)((()=>n.state.inferences.length),[n]),d=(0,i().K8)((()=>n.state.loading||void 0!==(null==o?void 0:o.getCurrentInferenceId())),[n,o]),u=(0,i().K8)((()=>n.state.inferences),[n]),p=(0,i().K8)((()=>n.state.requestInfo),[n]),f=(0,r.useCallback)((()=>{const{acceptedInferenceKeys:e}=n.state;e.length>0?n.setState({...n.state,acceptedInferenceKeys:[]}):n.setState({...n.state,acceptedInferenceKeys:n.state.inferences.map((e=>e.key))})}),[n]),g=(0,i().K8)((()=>n.state.config),[n]);return(0,oe.jsxs)("div",{style:{padding:16,gap:16,display:"flex",flexDirection:"column",rowGap:16},children:[(0,oe.jsxs)("div",{style:s.topBar,children:[d&&(0,oe.jsx)(I().A,{}),o&&(0,oe.jsx)(xt,{clientStore:n,threadStore:o},o.id),(0,oe.jsx)("div",{style:{flexGrow:1}}),(0,oe.jsx)(C().A,{onClick:l,icon:Le().u,ariaLabel:t.formatMessage({id:"AIDebugPanel.closeDebugTools",defaultMessage:"Close debug tools"})})]}),p&&(0,oe.jsx)(ft,{requestInfo:p,clientStore:n}),!o&&g&&(0,oe.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:12},children:(0,oe.jsx)(yt,{config:g,clientStore:n})}),(0,oe.jsxs)("div",{style:s.inferencesWrap,children:[u.length>0&&(0,oe.jsxs)("div",{style:s.topBar,children:[(0,oe.jsx)("div",{style:s.header,children:"Inferences"}),(0,oe.jsx)("div",{style:{flexGrow:1}}),c>0&&(0,oe.jsx)("div",{children:`${c} inference${1===c?"":"s"}`}),!d&&c>0&&(0,oe.jsx)(b().p,{onClick:f,children:"Toggle all"})]}),u.map(((e,t)=>(0,oe.jsx)(mt,{inference:e,clientStore:n},`${e.key}-${t}`)))]})]})}function ft(e){const{requestInfo:t,clientStore:n}=e,o=(0,a().IS)((e=>({wrap:{display:"flex",flexDirection:"column",gap:12,padding:8,border:`1px solid ${e.regularDividerColor}`,borderRadius:4,whiteSpace:"pre-wrap",fontSize:14},header:{display:"flex",gap:8,alignItems:"center"},toggle:{border:"none",padding:0,margin:0},code:{whiteSpace:"pre-wrap",fontFamily:"monospace",background:e.codeBlockBackground,color:e.regularTextColor,padding:8,margin:0,marginBottom:12}})),[]),{request:i,response:s,memory:l}=t,c=i.transcript.find((e=>"config"===e.type)),d=(0,r.useCallback)((()=>{if(!s)throw new Error("Response is required");n.setState({...n.state,requestInfo:{...t,memory:{...pe().s8,originalOutput:s}}})}),[n,t,s]),u=(0,r.useCallback)((e=>{n.setState({...n.state,requestInfo:{...t,memory:e}})}),[n,t]),p=(0,r.useMemo)((()=>({id:i.traceId,input:{type:Ve().uF,...i},expected:s,metadata:{memories:L().oE([l])}})),[i,s,l]),f=(0,r.useMemo)((()=>{if(!t.response)return;return{type:"inferenceTranscript",request:t.request,response:t.response}}),[t]);return(0,oe.jsxs)("div",{style:o.wrap,children:[(0,oe.jsxs)("div",{style:o.header,children:[(0,oe.jsx)("span",{style:{flexGrow:1},children:"Request"}),!l&&(0,oe.jsx)(b().p,{onClick:d,children:"Add memory"}),p&&(0,oe.jsx)(it,{inference:p,scopeKey:`inferenceTranscript-${null==c?void 0:c.value.type}`})]}),(0,oe.jsx)(Je().b,{label:"Input",style:o.toggle,children:(0,oe.jsx)(Ye().X,{language:"json",value:JSON.stringify(t.request,null,2)})}),t.response?(0,oe.jsx)(Je().b,{label:"Output",style:o.toggle,children:(0,oe.jsx)(Ye().X,{value:JSON.stringify(t.response,null,2),language:"json"})}):null,f&&l&&(0,oe.jsx)(tt,{request:f,memory:l,onChange:u,clientStore:n})]})}function gt(e){const{inference:t,clientStore:n}=e,s=t.key,l=(0,o().v3)(),c=(0,a().IS)((e=>({wrap:{display:"flex",flexDirection:"column",gap:12,padding:8,border:`1px solid ${e.regularDividerColor}`,borderRadius:4,whiteSpace:"pre-wrap",fontSize:14},header:{display:"flex",gap:8,alignItems:"center"},toggle:{border:"none",padding:0,margin:0},code:{whiteSpace:"pre-wrap",fontFamily:"monospace",background:e.codeBlockBackground,color:e.regularTextColor,padding:8,margin:0,marginBottom:12},lockedIcon:{width:16}})),[]),d=(0,i().K8)((()=>n.state.inferenceKeysToAnnotations[s]),[n,s]),u=(0,r.useCallback)((e=>{const t=e.target.value,r={...n.state.inferenceKeysToAnnotations,[s]:t};n.setState({...n.state,inferenceKeysToAnnotations:r})}),[n,s]),p=(0,i().K8)((()=>{const{acceptedInferenceKeys:e}=n.state;return e.includes(s)}),[n,s]),f=(0,r.useCallback)((e=>{const{acceptedInferenceKeys:t,inferences:r}=n.state,o=e.shiftKey;if(t.includes(s))if(o){const e=r.findIndex((e=>e.key===s)),o=r.slice(0,e+1).map((e=>e.key));n.setState({...n.state,acceptedInferenceKeys:L().sb(t.filter((e=>!o.includes(e))))})}else n.setState({...n.state,acceptedInferenceKeys:t.filter((e=>e!==s))});else if(o){const e=r.findIndex((e=>e.key===s)),o=r.slice(0,e+1).map((e=>e.key)),i=L().sb([...t,...o]);n.setState({...n.state,acceptedInferenceKeys:i})}else n.setState({...n.state,acceptedInferenceKeys:L().sb([...t,s])})}),[n,s]),g=(0,r.useMemo)((()=>{const e=null==t?void 0:t.value.expected;if(!e)return"";if("string"!=typeof e)return JSON.stringify(e,null,2);try{return e.trim().startsWith("{")?JSON.stringify(JSON.parse(e),null,2):e}catch(n){return e}}),[t]),m=(0,i().K8)((()=>n.state.inferenceKeysToMemories[s]),[n,s]),h=(0,r.useMemo)((()=>({type:"inference",inference:t.value})),[t]),x=(0,r.useCallback)((async()=>{await(0,Xe().Ou)({environment:l,clientStore:n,inference:t})}),[n,l,t]),y=(0,r.useCallback)((e=>{n.setState({...n.state,inferenceKeysToMemories:{...n.state.inferenceKeysToMemories,[s]:e}})}),[n,s]),v=(0,r.useCallback)((()=>{if(!t.value.expected)throw new Error("Expected output is required");n.setState({...n.state,inferenceKeysToMemories:{...n.state.inferenceKeysToMemories,[s]:{...pe().s8,originalOutput:t.value.expected}}})}),[n,s,t]),S=(0,r.useMemo)((()=>({...t.value,metadata:{...t.value.metadata,memories:L().oE([m])}})),[t,m]);return t?(0,oe.jsxs)("div",{style:c.wrap,children:[(0,oe.jsxs)("div",{style:c.header,children:[(0,oe.jsx)(P().A,{renderTooltip:()=>(0,oe.jsx)("div",{style:{width:300,whiteSpace:"normal"},children:"Checking this will 'freeze' this inference. When the request is retried, instead of running the inference again, the original output will be used."}),placement:He().W.Top,render:e=>(0,oe.jsx)("div",{...e,children:(0,oe.jsx)(Ue().A,{checked:p,size:14,onClick:f})})}),(0,oe.jsx)("span",{style:{flexGrow:1},children:ht(t.value.input)}),(0,oe.jsx)(b().p,{onClick:x,children:"Retry"}),!m&&(0,oe.jsx)(b().p,{onClick:v,children:"Add memory"}),(0,oe.jsx)(it,{inference:S,scopeKey:`inference-${t.value.input.type}`,defaultState:{project:Ve().vK,dataset:t.value.input.type,tags:[]}})]}),(0,oe.jsx)(P().A,{renderTooltip:()=>(0,oe.jsx)("div",{style:{width:300,whiteSpace:"normal"},children:"The text you type here is passed as 'context.annotation' when this inference is retried. Typically, this is rendered as a final user step in the prompt used to 'nudge' the model."}),placement:He().W.Right,render:e=>(0,oe.jsx)("div",{...e,children:(0,oe.jsx)(et,{value:d,placeholder:"Set annotation",onChange:u,textarea:!0,autosize:!0})})}),(0,oe.jsx)(Je().b,{label:"Input",style:c.toggle,children:(0,oe.jsx)(Ye().X,{language:"json",value:JSON.stringify({...t.value.input,examples:void 0},null,2)})}),t.value.expected?(0,oe.jsx)(Je().b,{label:"Output",style:c.toggle,children:(0,oe.jsx)(Ye().X,{value:g,language:"json"})}):null,t.value.metadata?(0,oe.jsx)(Je().b,{label:"Metadata",style:c.toggle,children:(0,oe.jsx)(Ye().X,{value:JSON.stringify(t.value.metadata,null,2),language:"json"})}):null,m&&(0,oe.jsx)(tt,{request:h,memory:m,onChange:y,clientStore:n})]}):null}const mt=r.memo(gt);function ht(e){let t=e.type;"fileName"in e&&(t+=` – ${e.fileName}`),"testName"in e&&(t+=` – ${e.testName}`),"functionKey"in e&&(t+=` – ${e.functionKey}`),"key"in e&&(t+=` – ${e.key}`);const n=["retries","validationRetries"];for(const r of n)if(r in e&&e[r].length>0){t+=` (${e[r].filter((e=>"assistant"!==e.type)).length} error steps)`}return t}function xt(e){const t=(0,y().tz)(),{clientStore:n,threadStore:l}=e,c=(0,o().v3)(),d=(0,a().IS)((e=>({button:{fontSize:14}})),[]),u=(0,i().K8)((()=>l.getSpaceId()),[l]),p=(0,i().K8)((()=>{const e=l.getMessageStores().map((e=>{const t=e.getStep();if(t&&"config"===t.type)return t.value.type}));return L().oE(e)[0]}),[l]),[{value:f},g]=(0,s().Yb)((async()=>{if(!u||!p)return;const e=(0,Ge().W)({environmentName:"production",suffix:p});return await v().callApi({eventName:"getBraintrustLogsForThread",environment:c,data:{project:e,threadId:l.id,spaceId:u}})}),[c,u,l,p]),m=(0,r.useMemo)((()=>{if(!f||"failed"===f.type)return;const e=f.data.logs,t=[],n=new Map;for(const r of e)if(r.span_id===r.root_span_id)t.push(r);else if(r.root_span_id){const e=n.get(r.root_span_id)||[];e.push(r),n.set(r.root_span_id,e)}for(const r of n.values())r.sort(((e,t)=>{var n,r;return((null===(n=e.metadata)||void 0===n?void 0:n.index)||0)-((null===(r=t.metadata)||void 0===r?void 0:r.index)||0)}));return t.sort(((e,t)=>{const n=new Date(e.created||"");return new Date(t.created||"").getTime()-n.getTime()})),{rootSpans:t,subSpanGroups:n}}),[f]),h=(0,r.useCallback)((e=>{if(!e.span_id)return;const t=null==m?void 0:m.subSpanGroups.get(e.span_id);t&&n.setState({...n.state,requestInfo:{request:e.input,response:e.output,memory:void 0},inferences:t.filter((e=>{var t;return"number"==typeof(null===(t=e.metadata)||void 0===t?void 0:t.index)})).map((e=>{var t;const n=null===(t=e.metadata)||void 0===t?void 0:t.index;if("number"!=typeof n)throw new Error("Index is not a number");return{type:"inference",key:(0,Re().$A)(e.input),index:n,value:{id:e.id,input:e.input,expected:e.output,metadata:e.metadata}}}))})}),[n,m]),x=(0,r.useCallback)((()=>{var e;const t=null===(e=n.state.requestInfo)||void 0===e?void 0:e.request.traceId;if(!p||!t)return;const r=(0,Ge().W)({environmentName:"production",suffix:p});window.open(`https://www.braintrust.dev/app/Notion/p/${r}/logs?r=${t}`,"_blank")}),[n,p]);return(0,oe.jsx)(k().Ay,{popupType:k().z7.Popup,placementToOrigin:k().sx.Bottom,alignmentToOrigin:k().yP.Start,renderOrigin:e=>(0,oe.jsxs)(oe.Fragment,{children:[(0,oe.jsx)(b().p,{...e,style:d.button,children:"failed"===(null==f?void 0:f.type)?"Failed to load logs":m?`View logs (${m.rootSpans.length})`:"Loading logs"}),(0,oe.jsx)(P().A,{renderTooltip:()=>(0,oe.jsx)("span",{children:"Open in Braintrust"}),render:e=>(0,oe.jsx)(C().A,{...e,icon:$e().N,ariaLabel:t.formatMessage({id:"aiInferenceTranscript.openInBraintrust",defaultMessage:"Open in Braintrust"}),onClick:x})})]}),render:e=>(0,oe.jsxs)(T().A,{menuType:F().gu.Popup,children:[(0,oe.jsx)(b().p,{onClick:()=>{e.close(),g()},children:"Refresh"}),(0,oe.jsx)(A().Ay,{type:A().Oh.Vertical,initialFocus:0,sections:[{key:"dates",render:e=>(0,oe.jsx)(D().A,{...e,shouldShowBottomDivider:!0}),items:((null==m?void 0:m.rootSpans)||[]).map((t=>({key:t.id,render:e=>(0,oe.jsx)(j().A,{...e,title:t.created||"No date"}),action:()=>{e.close(),h(t)}})))||[]}]})]})})}function yt(e){const{config:t,clientStore:n}=e,o=Object.entries(t).filter((e=>{let[t,n]=e;return"type"!==t&&("boolean"==typeof n||"string"==typeof n||"number"==typeof n)})),s=(0,a().IS)((e=>({wrap:{margin:"12px 0",display:"flex",flexDirection:"column",gap:8},title:{fontSize:16,color:e.mediumTextColor,fontWeight:500},row:{display:"flex",alignItems:"center",gap:8,color:e.mediumTextColor,fontSize:12},input:{width:200,backgroundColor:e.contentBackground,border:`1px solid ${e.regularDividerColor}`,fontSize:12,color:e.mediumTextColor}})),[]),l=(0,i().K8)((()=>n.state.debugOverrides.fastWorkflowBuilds??!1),[n]),c=(0,r.useCallback)((()=>{n.setState({...n.state,debugOverrides:{...n.state.debugOverrides,fastWorkflowBuilds:!n.state.debugOverrides.fastWorkflowBuilds}})}),[n]),d=(0,r.useCallback)((e=>{n.setState({...n.state,config:e})}),[n]);if(0===o.length)return null;const u=o.map((e=>{let[n,r]=e;return((e,n)=>"boolean"==typeof n?(0,oe.jsxs)("div",{style:s.row,children:[(0,oe.jsx)("span",{children:e}),(0,oe.jsx)(Ue().A,{checked:n,onClick:()=>d({...t,[e]:!n}),size:12})]},e):"string"==typeof n?(0,oe.jsxs)("div",{style:s.row,children:[(0,oe.jsx)("span",{children:e}),(0,oe.jsx)(_e().A,{value:n.toString(),onChange:n=>{d({...t,[e]:n.target.value})},style:{width:200}})]},e):"number"==typeof n?(0,oe.jsxs)("div",{style:s.row,children:[(0,oe.jsx)("span",{children:e}),(0,oe.jsx)(_e().A,{type:"number",value:n.toString(),onChange:n=>{d({...t,[e]:Number(n.target.value)})},style:{...s.input,width:65}})]},e):null)(n,r)}));return u.length>0?(0,oe.jsxs)("div",{style:s.wrap,children:[(0,oe.jsx)("div",{style:s.title,children:"Debug overrides"}),(0,oe.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:16},children:"workflow"===t.type&&(0,oe.jsxs)("div",{style:s.row,children:[(0,oe.jsx)("span",{children:"Build workflows without tests and evals"}),(0,oe.jsx)(Ue().A,{checked:l,onClick:c,size:12})]})}),(0,oe.jsx)("div",{style:s.title,children:"Configuration"}),(0,oe.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:16},children:u})]}):null}var vt=()=>n(354936),St=()=>n(591779),wt=()=>n(531896),bt=()=>n(847),jt=()=>n(383245),kt=()=>n(759113),Ct=()=>n(94522);function It(e){const{clientStore:t,threadStore:n}=e;if(!n)return;const r=(0,Ct().SL)({clientStore:t,threadStore:n});if(!r)return;const o=r.value;return{triggers:(o.triggers??[]).filter((e=>!(0,Re().VB)(e,o))),modules:(o.modules??[]).filter((e=>"ready"!==wt().N[e.type].getModuleConfigurationStatus(e)))}}function Tt(e){const{clientStore:t,threadStore:n}=e,[a,s]=(0,r.useState)([]),l=(0,o().v3)(),c=(0,i().K8)((()=>{if(!n)return;const e=(0,Ct().SL)({clientStore:t,threadStore:n});return(0,wt().E)(null==e?void 0:e.value)}),[t,n]),d=(0,St().ZC)(c);(0,r.useEffect)((()=>{if(!c&&d&&n){const{serverCommitResult:e}=se().createAndCommit({userAction:"AIChatTranscript.StopInferenceButton.handleClick",environment:l,canUndo:!0,perform:e=>{(0,X().GS)({threadStore:n,transaction:e,clientStore:t})}}),r=Promise.allSettled([...a,e]).then(L().lQ);(0,X().WE)({environment:l,threadStore:n,clientStore:t,waitBeforeSending:r}),s([])}}),[c,d,l,n,t,a]);return(0,i().K8)((()=>function(e){const t=It(e);return!!t&&(t.triggers.length>0||t.modules.length>0)}({clientStore:t,threadStore:n})),[t,n])?(0,oe.jsx)(At,{...e,setPendingCommits:s}):null}function At(e){const{clientStore:t,threadStore:n,setPendingCommits:s}=e,l=(0,a().IS)((()=>({setupInstructionsContainer:{paddingBottom:12}})),[]),c=(0,i().K8)((()=>{if(!n)return;const e=(0,Ct().SL)({clientStore:t,threadStore:n});return null==e?void 0:e.value}),[t,n]),d=(0,i().K8)((()=>null==n?void 0:n.getSpaceId()),[n]),u=(0,i().K8)((()=>It({clientStore:t,threadStore:n})),[t,n]),p=(0,i().K8)((()=>{if(n&&d)return{table:h().To,id:n.id,spaceId:d}}),[n,d]),f=(0,o().v3)(),g=(0,r.useCallback)((e=>{if(!n||!c)return;const t={workflowValueOperation:{type:"setTrigger",triggerKey:e.key,args:e},timestamp:Date.now()},{serverCommitResult:r}=se().createAndCommit({userAction:"WorkflowSetupInstructions.saveTrigger",environment:f,canUndo:!0,perform:e=>{(0,bt().createWorkflowUpdate)({environment:f,threadStore:n,workflowOperation:t,workflowStore:void 0,currentWorkflowData:c,transaction:e})}});s((e=>[...e,r]))}),[n,c,f,s]),m=(0,r.useCallback)((e=>{if(!n||!c)return;const t={workflowValueOperation:{type:"setModule",moduleKey:e.key,args:e},timestamp:Date.now()},{serverCommitResult:r}=se().createAndCommit({userAction:"WorkflowSetupInstructions.saveModule",environment:f,canUndo:!0,perform:e=>{(0,bt().createWorkflowUpdate)({environment:f,threadStore:n,workflowOperation:t,workflowStore:void 0,currentWorkflowData:c,transaction:e})}});s((e=>[...e,r]))}),[n,c,f,s]);(0,bt().useInitializationOfExternalStores)({environment:f,spaceId:d});const x=(0,r.useMemo)((()=>{if(!(u&&c&&p&&n))return;const{modules:e,triggers:t}=u,r=[];for(const o of e)r.push((0,oe.jsx)(jt().A,{workflowValue:c,module:o,workflowDefinitionPointer:p,isInTranscript:!0,saveModule:m,store:n}));for(const n of t)r.push((0,oe.jsx)(kt().m,{workflowValue:c,trigger:n,workflowDefinitionPointer:p,isInTranscript:!0,saveTrigger:g}));return L().oE(r)[0]}),[u,c,p,g,m,n]);return x?(0,oe.jsx)("div",{style:l.setupInstructionsContainer,children:x}):null}function Mt(e){const{aiChatFeature:t,threadStore:n,config:s,onThreadChange:l,defaultUserMessage:c,clientStore:u,getAppendStepsOnUserInputSubmit:p,parentBlockStore:f}=e,v=(0,r.useMemo)((()=>new(Q().J)(t)),[t]),{isElectronWindows:b}=(0,o().Y0)(),j=(0,o().v3)(),k=(0,i().K8)((()=>u.state.showDebug),[u]),{store:C,setValue:I}=(0,z().AI)({initialValue:(0,x().x9d)(c)});(0,r.useEffect)((()=>{s&&u.state.config!==s&&u.setState({...u.state,config:s})}),[u,s]),function(e){const{textStore:t,initialFocus:n}=e,o=(0,r.useCallback)((()=>{V().setSelectionAtEnd({store:t})}),[t]);(0,r.useEffect)((()=>{n&&o()}),[n,o])}({textStore:C,initialFocus:!0});const T=k,A=(0,r.useRef)(null),[M,B]=(0,r.useState)(!0),[D,P]=(0,r.useState)(!1),[O,F]=(0,r.useState)(!0),L=v.supportWelcomeMode&&!n,_=(0,a().IS)((e=>({header:{flex:"0 0 auto",display:"flex",height:44,alignItems:"center",justifyContent:"space-between",padding:"0 12px",backgroundColor:e.contentBackground,borderBottom:D?`1px solid ${e.stroke.secondary}`:"1px solid transparent",transition:"border-color 150ms ease-out"},columns:{display:"flex",flexDirection:"row",flex:1,minHeight:0,gap:12,...T&&{paddingLeft:16}},chatColumn:{flex:1,display:"flex",flexDirection:"column",minHeight:0,maxWidth:"100%",...L&&{justifyContent:"center"}},contentWrapper:{flex:1,overflowY:"auto",position:"relative",...L&&{flex:"0 1 auto"}},contentContainer:{margin:"0 auto",width:"100%",maxWidth:800,padding:"16px 12px 16px",marginLeft:"auto"},inputWrapper:{flex:"0 0 auto",position:"relative",backgroundColor:e.contentBackground,padding:"0 0 12px",...L&&{marginTop:24}},fullPageWelcomeContainer:{textAlign:"center",marginBottom:24,display:"flex",flexDirection:"column",alignItems:"center"},fullPageWelcomeTitle:{fontSize:30,fontWeight:600,color:e.text.primary,marginBottom:8,marginTop:26},scrollToBottomButton:{position:"absolute",left:"50%",bottom:"100%",transform:"translate(-50%, -8px)",zIndex:2,padding:10,borderRadius:20,backgroundColor:"dark"===e.mode?"#fff":"#000",border:"none",cursor:"pointer",fontWeight:500,boxShadow:"dark"===e.mode?`0px 0px 0px 0.5px ${e.stroke.primary}, 0px 1px 2px 0px rgba(0, 0, 0, 0.12), 0px 4px 16px -2px rgba(0, 0, 0, 0.6)`:`0px 0px 0px 0.5px ${e.stroke.primary}, 0px 1px 2px 0px rgba(0, 0, 0, 0.02), 0px 4px 16px -2px rgba(0, 0, 0, 0.1)`,transition:"opacity 150ms ease-out, transform 150ms ease-out",opacity:0,pointerEvents:"none"},scrollToBottomButtonVisible:{opacity:1,transform:"translate(-50%, -16px)",pointerEvents:"auto"},scrollToBottomButtonHidden:{opacity:0,transform:"translate(-50%, -8px)",pointerEvents:"none"},inputContainer:{margin:"0 auto",width:"100%",maxWidth:800,padding:"0 12px",marginLeft:"auto",...L&&{maxWidth:650}},gradientMask:{width:"100%",height:v.isInWorkflowEditor?32:44,pointerEvents:"none",position:"absolute",bottom:"100%",background:`linear-gradient(to bottom, rgba(255, 255, 255, 0), ${e.contentBackground})`},title:{position:"absolute",left:"50%",transform:"translateX(-50%)",fontSize:16,fontWeight:500,textAlign:"center"},floatingColumn:{zIndex:1,marginTop:4,marginBottom:16,backgroundColor:e.contentBackground,overflow:"auto",boxShadow:"0px 18px 32px 0px rgba(0, 0, 0, 0.04), 0px 0px 0px 1px rgba(0, 0, 0, 0.03)",backdropFilter:"blur(10px)",borderRadius:8,padding:8,display:"flex",flexDirection:"column",gap:8},historyColumn:{width:350},debugColumn:{width:600},dismissButton:{height:28,width:28,padding:0,display:"flex",alignItems:"center",justifyContent:"center"},chevronDownIcon:{width:12,height:12,fill:"dark"===e.mode?"#000":e.white,transform:"translateY(1px)"}})),[T,D,v.isInWorkflowEditor,L]),Y=(0,r.useCallback)((()=>{const e=A.current;if(!e)return;const t=e.scrollHeight-e.scrollTop-e.clientHeight<50;B(t),!t&&O&&F(!1),t&&!O&&F(!0),P(e.scrollTop>2)}),[O]);(0,r.useEffect)((()=>{const e=A.current;if(!e)return;e.addEventListener("scroll",Y);const t=new MutationObserver((()=>{O&&(e.scrollTop=e.scrollHeight),setTimeout(Y,100)}));return t.observe(e,{childList:!0,subtree:!0,characterData:!0}),setTimeout(Y,100),()=>{e.removeEventListener("scroll",Y),t.disconnect()}}),[Y,O]),(0,r.useEffect)((()=>{const e=A.current;if(!e)return;const t=setTimeout((()=>{e.scrollTop=e.scrollHeight,F(!0)}),100);return()=>clearTimeout(t)}),[null==n?void 0:n.id]);const J=(0,r.useCallback)((()=>{const e=A.current;e&&q().VG({element:e,environment:j,options:{top:e.scrollHeight,behavior:"smooth"}})}),[j]),te=(0,i().K8)((()=>{const{currentSpaceStore:e}=U().default.state;if(e)return f?{table:g().ev,id:f.pointer.id,spaceId:e.id}:{table:m().NX,id:e.id,spaceId:e.id}}),[f]),ne=(0,r.useCallback)((e=>{if(!e||0===e.length)return;I(void 0);const{currentSpaceStore:t,currentUserStore:r}=U().default.state;if(!t||!e||!te)throw new Error("No current space or value");if(!j.currentUser.id)throw new Error("No current user");const o=(null==n?void 0:n.id)??(0,N().Z1)({environment:j,table:h().To,spaceId:t.id}),i=(null==p?void 0:p({currentSteps:(null==n?void 0:n.getTranscript())||[]}))||[];(0,X().i0)({environment:j,clientStore:u,threadStore:n,threadId:o,threadParentPointer:te,additionalSteps:i,config:s||u.state.config,userStore:r,spaceStore:t,value:e}),null==l||l({threadId:o})}),[u,j,I,l,s,n,p,te]),re=(0,r.useCallback)((e=>{if(!e||0===e.length)return;const{currentSpaceStore:t,currentUserStore:n}=U().default.state;if(!t||!e||!te)throw new Error("No current space or value");if(!j.currentUser.id)throw new Error("No current user");const r=(0,N().Z1)({environment:j,table:h().To,spaceId:t.id});(0,X().i0)({environment:j,clientStore:u,threadStore:void 0,threadId:r,threadParentPointer:te,additionalSteps:[],config:{type:"search",scopeForNextSearch:{type:"everything"}},userStore:n,spaceStore:t,value:e}),null==l||l({threadId:r})}),[te,j,u,l]),ie=(0,r.useCallback)((e=>{(0,X().Wq)({clientStore:u}),null==l||l({threadId:e})}),[l,u]),{isShowingTabBar:ae}=(0,i().O$)(H().A),se=j.device.isElectron&&!ae,le=(0,i().K8)((()=>!e.config&&!n),[e.config,n]),ce=$({input:(0,i().K8)((()=>C.getValue()),[C]),debounceMs:200,useDeepEqual:!0});(0,r.useEffect)((()=>{le&&ce.value&&!ce.isBuffering&&!u.state.userSelectedConfig&&(0,Z().xh)({environment:j,clientStore:u,message:ce.value})}),[ce,u,j,le]);const de=(0,r.useCallback)((e=>(0,G().dC)(e)&&!k?(0,G().an)(e,!0):(0,ee().fO)(e)&&!k?(0,ee().nZ)(e):e),[k]),ue=(0,i().K8)((()=>!(0,R().KB)(j)),[j]);return(0,oe.jsxs)(oe.Fragment,{children:[v.showChatHistory?(0,oe.jsxs)("div",{style:_.header,className:se?E().sbV:void 0,children:[(0,oe.jsxs)(w().Y1,{direction:"horizontal",gap:4,children:[(0,oe.jsx)(Dt,{}),ue&&(0,oe.jsx)(W().z,{}),(0,oe.jsx)(Ot,{threadStore:n,handleThreadClick:ie,threadParentPointer:te}),b&&(0,oe.jsx)(K().K,{})]}),(0,oe.jsxs)(w().Y1,{direction:"horizontal",gap:8,align:"center-right",children:[(0,oe.jsx)(Bt,{clientStore:u}),(0,oe.jsx)(Kt,{onNewChat:()=>ie(void 0)})]})]}):null,(0,oe.jsxs)("div",{style:_.columns,children:[k&&(0,oe.jsx)("div",{style:{..._.floatingColumn,..._.debugColumn},children:(0,oe.jsx)(pt,{clientStore:u,threadStore:n})}),(0,oe.jsx)("div",{style:_.chatColumn,children:L?(0,oe.jsxs)("div",{style:_.inputWrapper,children:[(0,oe.jsxs)("div",{style:_.fullPageWelcomeContainer,children:[(0,oe.jsx)(S().o,{variant:"large"}),(0,oe.jsx)("div",{style:_.fullPageWelcomeTitle,children:(0,oe.jsx)(y().sA,{id:"aiInferenceTranscript.fullPageWelcomeTitle",defaultMessage:"How can I help you today?"})})]}),(0,oe.jsx)("div",{style:_.inputContainer,children:(0,oe.jsx)(Ne,{store:C,onSubmit:ne,clientStore:u,threadStore:n,showModePicker:le,aiChatFeatureController:v})})]}):(0,oe.jsxs)(oe.Fragment,{children:[(0,oe.jsx)("div",{style:_.contentWrapper,ref:A,children:(0,oe.jsxs)("div",{style:_.contentContainer,children:[(0,oe.jsx)(qe,{handleNewSearch:re,clientStore:u,threadStore:n}),(0,oe.jsx)(Fe().Lm,{clientStore:u,config:s,threadStore:n,preprocessTranscript:de,aiChatFeatureController:v}),(0,oe.jsx)(Tt,{clientStore:u,threadStore:n})]})}),(0,oe.jsxs)("div",{style:_.inputWrapper,children:[(0,oe.jsx)("button",{onClick:J,style:{..._.scrollToBottomButton,...!M&&_.scrollToBottomButtonVisible},children:(0,d()._)(_.chevronDownIcon)}),(0,oe.jsx)("div",{style:_.gradientMask}),(0,oe.jsx)("div",{style:_.inputContainer,children:(0,oe.jsx)(Ne,{store:C,onSubmit:ne,clientStore:u,threadStore:n,showModePicker:le,aiChatFeatureController:v})})]})]})})]})]})}function Bt(e){const{clientStore:t}=e,n=(0,i().K8)((()=>(0,J().K)()),[]),o=(0,i().K8)((()=>t.state.model),[t]),a=(0,r.useCallback)((e=>{t.setState({...t.state,model:e})}),[t]);return n?(0,oe.jsxs)(w().Y1,{width:"hug",direction:"horizontal",gap:8,align:"center-left",children:[(0,oe.jsx)(vt().Y,{model:o,setModel:a,format:"badge"}),(0,oe.jsx)(Pt,{clientStore:t})]}):null}function Dt(){const e=(0,r.useContext)(O().eh),t=(0,a().IS)((e=>({dismissButton:{height:28,width:28,padding:0}})),[]);return e?(0,oe.jsx)(P().A,{renderTooltip:()=>(0,oe.jsx)("span",{children:"Close"}),render:n=>(0,oe.jsx)(b().p,{...n,onClick:e,style:t.dismissButton,children:(0,oe.jsx)(M().I,{icon:l().O,color:"tertiary"})})}):null}function Pt(e){const t=(0,y().tz)(),{clientStore:n}=e,o=Wt(),i=(0,r.useCallback)((()=>{n.setState({...n.state,showDebug:!n.state.showDebug})}),[n]);return(0,oe.jsx)(P().A,{renderTooltip:()=>(0,oe.jsx)("span",{children:"Debug"}),render:e=>(0,oe.jsx)(C().A,{...e,icon:c().E,iconStyle:o.iconButtonIcon,style:o.iconButton,ariaLabel:t.formatMessage({id:"aiInferenceTranscript.debug",defaultMessage:"Debug"}),onClick:i})})}function Kt(e){let{onNewChat:t}=e;const n=(0,y().tz)(),r=Wt();return(0,oe.jsx)(P().A,{renderTooltip:()=>(0,oe.jsx)("span",{children:"New chat"}),render:e=>(0,oe.jsx)(C().A,{...e,icon:p().M,iconStyle:r.iconButtonIcon,style:r.iconButton,ariaLabel:n.formatMessage({id:"aiInferenceTranscript.newChat",defaultMessage:"New chat"}),onClick:t})})}function Ot(e){let{threadStore:t,handleThreadClick:n,threadParentPointer:l}=e;const c=(0,o().v3)(),p=(0,i().K8)((()=>{var e;return null==t||null===(e=t.getData())||void 0===e?void 0:e.title}),[t]),g=!!t,m=(0,a().IS)((e=>({title:{color:g?e.text.primary:e.text.secondary,maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},checkIcon:{width:14},chevronDownIcon:{width:10,marginLeft:6,fill:e.mediumIconColor,flexShrink:0},newChatButtonContainer:{padding:8},newChatButton:{width:"100%",textAlign:"center",justifyContent:"center",background:e.assistantTintedActionButtonBackground},loadingStateContainer:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",gap:8,padding:32},clockIcon:{width:24,opacity:.2}})),[g]),[x,y]=(0,r.useState)([]),[{status:S,value:w}]=(0,s().Yb)((async()=>{if(!l)return;if(!_().A.state.online)return;const e=await v().callApi({eventName:"getInferenceTranscriptsForUser",environment:c,data:{threadParentPointer:l}});return"failed"!==e.type?(y((t=>{const n=new Set(t.map((e=>e.id)));return[...t,...e.data.transcripts.filter((e=>!n.has(e.id)))]})),e.data.transcripts):void 0}),[l,c]);(0,r.useEffect)((()=>{const{currentSpaceStore:e}=U().default.state;if(!e||!w||0===w.length)return;const t=Y().Ei.createChildStore(e,{table:h().To,id:w[0].id,spaceId:e.id});void 0!==t.getCurrentInferenceId()&&n(t.id)}),[w,n]);const C=(0,i().K8)((()=>{if(t)return{id:t.id,title:t.getDataStore().getKeyStore("title").getValue(),created_at:t.getCreatedTime()}}),[t]);(0,r.useEffect)((()=>{C&&y((e=>e.find((e=>e.id===C.id))?e.map((e=>e.id===C.id?C:e)):[C,...e]))}),[C]);const M=(0,r.useCallback)((()=>(0,oe.jsx)("div",{style:m.loadingStateContainer,children:(0,oe.jsx)(I().A,{})})),[m.loadingStateContainer]),P=(0,r.useCallback)((()=>(0,oe.jsx)("div",{style:m.loadingStateContainer,children:(0,u().y)(m.clockIcon)})),[m.loadingStateContainer,m.clockIcon]),K=(0,r.useCallback)((e=>{if("pending"===S)return[{key:"loading",render:e=>(0,oe.jsx)(D().A,{...e,title:"Previous chats",shouldShowBottomDivider:!1}),items:[{key:"loading-item",action:()=>{},render:()=>(0,oe.jsx)(M,{})}]}];if(!x||0===x.length)return[{key:"empty",render:e=>(0,oe.jsx)(D().A,{...e,title:"Previous chats"}),items:[{key:"empty-item",action:()=>{},render:()=>(0,oe.jsx)(P,{})}]}];const r=[];return null!=t&&t.id&&r.push({key:"new",render:e=>(0,oe.jsx)(D().A,{...e,shouldShowBottomDivider:!1}),items:[{key:"new-item",action:()=>{n(void 0),e.close()},render:e=>(0,oe.jsx)(j().A,{...e,title:"Start a new chat"})}]}),r.push({key:"history",render:e=>(0,oe.jsx)(D().A,{...e,title:"Previous chats"}),items:x.map((r=>({key:r.id,action:()=>{n(r.id),e.close()},render:e=>(0,oe.jsx)(j().A,{...e,title:r.title||"Untitled chat",right:(null==t?void 0:t.id)===r.id?(0,f().n)(m.checkIcon):void 0})})))}),r}),[S,x,t,M,P,m.checkIcon,n]);return(0,oe.jsx)(k().Ay,{popupType:k().z7.Popup,placementToOrigin:k().sx.Bottom,alignmentToOrigin:k().yP.Start,renderOrigin:e=>(0,oe.jsxs)(b().p,{ariaLabel:"history",...e,size:"lg",children:[(0,oe.jsx)(B().D,{styleName:"UIRegular-14px/Medium",children:g?p||"Untitled chat":"New chat"}),(0,oe.jsx)(oe.Fragment,{children:(0,d()._)(m.chevronDownIcon)})]}),render:e=>(0,oe.jsx)(T().A,{menuType:F().gu.Popup,width:300,children:(0,oe.jsx)(A().Ay,{type:A().Oh.Vertical,initialFocus:0,sections:K(e)})})})}function Wt(){return(0,a().IS)((e=>({iconButton:{width:28,height:28},iconButtonIcon:{width:18,height:18,fill:e.regularIconColor}})),[])}},541235:(e,t,n)=>{n.d(t,{YD:()=>i,c$:()=>r,q_:()=>o});const r={"sprints-onboarding":{steps:[{id:"current-sprint-view-tooltip"},{id:"sprint-task-tooltip"},{id:"complete-sprint-button-tooltip"}]},"enhanced-qna-onboarding":{steps:[{id:"find-in-tooltip"},{id:"mention-tooltip"}]},"jira-sync-onboarding":{steps:[{id:"all-projects-tooltip"},{id:"all-issues-tooltip"},{id:"database-views-and-filters-tooltip"},{id:"settings-to-setup-projects-and-issues"}]},"project-management-import-onboarding":{steps:[{id:"your-teamspace-tooltip"},{id:"all-projects-tooltip"},{id:"navigate-to-project-tasks-tooltip"},{id:"project-customization-tooltip"},{id:"related-tasks-database-views-tooltip"}]},"ai-comment-onboarding":{steps:[{id:"ai-comment-onboarding-tooltip"}]}},o="completed",i="dismissed"},739135:(e,t,n)=>{n.d(t,{KD:()=>c,gt:()=>d,i9:()=>l,ll:()=>a,tb:()=>s,x$:()=>i});var r=()=>n(541235),o=()=>n(496603);function i(e,t){return a(d(e,t))}function a(e){return void 0!==e&&(e===r().q_||e===r().YD)}function s(e,t){if(a(t))return;const n=r().c$[e],o=n.steps.findIndex((e=>e.id===t));return-1===o?n.steps[0].id:o===n.steps.length-1?r().q_:n.steps[o+1].id}function l(e,t){const n=d(e,t);if(n&&!a(n))return s(t,n)}function c(e,t){const n=d(e,t);if(n)return function(e,t){const n=r().c$[e];var i;if(a(t))return null===(i=(0,o().HV)(n.steps))||void 0===i?void 0:i.id;const s=n.steps.findIndex((e=>e.id===t));return-1!==s&&0!==s?n.steps[s-1].id:void 0}(t,n)}function d(e,t){var n;if(!e)return;const o=((null===(n=e.getSettings())||void 0===n?void 0:n.tutorials)||{})[t];return void 0===o?r().c$[t].steps[0].id:o}},759113:(e,t,n)=>{n.d(t,{m:()=>d,z:()=>c});n(898992),n(672577),n(296540);var r=()=>n(56366),o=()=>n(401497),i=()=>n(959013),a=()=>n(284371),s=()=>n(310397),l=n(474848);function c(e){const{workflowValue:t,trigger:n}=e;return(0,r().K8)((()=>{var e,r;const o=null==t||null===(e=t.modules)||void 0===e?void 0:e.find((e=>e.key===n.moduleKey));if(!o||null===(r=n.state)||void 0===r||!r.type)return null;return s().y[o.type].triggers[n.state.type]}),[t,n])}function d(e){const{workflowValue:t,trigger:n,isInTranscript:r,workflowDefinitionPointer:s,saveTrigger:d}=e,u=(0,o().IS)((e=>({container:{display:"flex",gap:4,flexDirection:r?"column":"row",overflow:"hidden"},title:r?{color:e.text.tertiary,fontWeight:a().Wy.medium,fontSize:14}:{fontWeight:500}})),[r]),p=c({workflowValue:t,trigger:n}),f=(0,i().tz)();if(!n.state||!p||!s)return null;if("full"===p.configuration){const{FullConfiguration:e}=p;return(0,l.jsx)("div",{style:u.container,children:(0,l.jsx)(e,{trigger:n,isInTranscript:r,workflowDefinitionPointer:s})})}const{ConfigurationComponent:g}=p;return(0,l.jsxs)("div",{style:u.container,children:[(0,l.jsx)("div",{style:u.title,children:r&&p.transcriptDescription?p.transcriptDescription(f,n):(0,l.jsx)(i().sA,{...p.description})}),g&&(0,l.jsx)(g,{workflowValue:t,trigger:n,isInTranscript:r,workflowDefinitionPointer:s,saveTrigger:d})]})}},776690:(e,t,n)=>{n.d(t,{J:()=>c});var r=()=>n(484714),o=()=>n(56366),i=n(296540),a=()=>n(496603);var s=()=>n(363186),l=()=>n(94522);function c(){const{workflowStore:e,threadStore:t,clientStore:n}=(0,s().$O)(),c=(0,r().v3)();return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a().n4;const n=(0,i.useRef)(e);return t(n.current,e)||(n.current=e),n.current}((0,o().K8)((()=>(0,l().n2)({workflowStore:e,threadStore:t,clientStore:n,environment:c})),[e,t,n,c]))}}}]);