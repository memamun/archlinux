"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[11740,49541],{8802:(e,t,i)=>{i.d(t,{d:()=>u});i(296540);var n=()=>i(484714),s=()=>i(56366),o=()=>i(764880),r=()=>i(53528),a=()=>i(959013),l=()=>i(125565),d=i(474848);function u(e){const{getRecordModel:t,actorPointer:i,lastVerifiedDate:u}=e,c=(0,n().Y0)(),p=(0,a().tz)(),g=(0,s().K8)((()=>(0,o().lR)(p,(0,o().xC)({pointer:i,getRecordModel:t}))),[t,p,i]);return(0,d.jsxs)("div",{style:{padding:"8px 14px"},children:[(0,d.jsx)(l().A,{isSmall:!0,isSecondaryColor:!0,isMobile:c.isMobile,isMultiline:!0,style:{marginBottom:4},children:(0,d.jsx)(a().sA,{defaultMessage:"Last verified by {user}",id:"VerificationMetadata.lastVerified",values:{user:g}})}),(0,d.jsx)(l().A,{isSmall:!0,isSecondaryColor:!0,isMobile:c.isMobile,children:(0,r().OH)({dateTime:u,intl:p})})]})}},15897:(e,t,i)=>{i.d(t,{A:()=>d});i(581454),i(296540);var n=()=>i(401497),s=()=>i(962730),o=()=>i(704152),r=()=>i(859428),a=i(474848);function l(e){const{isFirst:t,isLast:i,isSelected:l,item:d,itemStyle:u,selectedItemStyle:c,innerStyle:p,children:g,colors:v,onClick:m}=e,{isDisabled:h,tooltip:y}=d,f=(0,n().IS)((e=>{const n=(null==v?void 0:v.selectedOutline)??e.blueColor,s=(null==v?void 0:v.unselectedOutline)??e.selectorBorderUnselected;return{SegmentedItem:{alignItems:"center",background:l?null==v?void 0:v.selectedBackground:void 0,borderBottomLeftRadius:t?3:0,borderBottomRightRadius:i?3:0,borderColor:l?n:s,borderStyle:"solid",borderTopLeftRadius:t?3:0,borderTopRightRadius:i?3:0,borderWidth:1,cursor:h?void 0:"pointer",display:"flex",flexBasis:"50%",marginLeft:t?0:-1,padding:0,userSelect:"none",zIndex:l?10:0,...u,...l?c:void 0},Inner:{borderBottomLeftRadius:t?2:0,borderBottomRightRadius:i?2:0,borderColor:l?n:"transparent",borderStyle:"solid",borderTopLeftRadius:t?2:0,borderTopRightRadius:i?2:0,borderWidth:1,display:"flex",flexDirection:"column",height:"100%",justifyContent:"center",padding:"12px 20px",textAlign:"center",width:"100%",...p}}}),[null==v?void 0:v.selectedBackground,null==v?void 0:v.selectedOutline,null==v?void 0:v.unselectedOutline,t,i,l,h,u,c,p]),x=()=>{m&&m(d.key)};return(0,a.jsx)(r().A,{render:e=>(0,a.jsx)(o().A,{ariaLabel:d.ariaLabel,"aria-pressed":l,onClick:x,style:f.SegmentedItem,disabled:h,...e,children:(0,a.jsx)("div",{style:f.Inner,children:g})}),renderTooltip:()=>(0,a.jsx)("div",{children:y}),disableTooltip:l||void 0===y,placement:s().W.Bottom})}function d(e){const{items:t=[],itemStyle:i,selectedItemStyle:s,innerStyle:o,outerStyle:r,value:d,onChange:u,colors:c}=e,p=(0,n().IS)((e=>({SegmentedButton:{background:e.cardContentBackground,display:"flex",width:"100%",...r}})),[r]);return 0===t.length?null:(0,a.jsx)("div",{style:p.SegmentedButton,children:t.map(((e,n)=>(0,a.jsx)(l,{isFirst:0===n,isLast:n===t.length-1,isSelected:e.key===d,item:e,itemStyle:i,selectedItemStyle:s,innerStyle:o,colors:c,onClick:u,children:e.render()},e.key)))})}},51493:(e,t,i)=>{i.d(t,{q:()=>o,y:()=>r});var n=()=>i(534177),s=()=>i(989423);function o(e){const{environment:t,blockStore:i,update:o}=e,r=function(e){switch(e){case"add":return"page_verification_enabled";case"update":return"page_verification_edited";case"remove":return"page_verification_disabled";default:(0,n().HB)(e)}}(o.metadata.action),a=i.id,l=i.getAssociatedCollectionId(),d=i.getSpaceId(),u=o.metadata.entrypoint;let c=l?"db":"non_db";if(l){const e=i.getAssociatedCollectionStore();null!=e&&e.isPageTreeCollection()&&(c="wiki")}"page_verification_enabled"===r&&(0,s().u4)({environment:t,event:{eventName:r,eventProperties:{entrypoint:u,page_type:c,page_id:a,collection_id:l,space_id:d,expiration:o.metadata.expiration??void 0,expiration_date:o.metadata.expiration_date??void 0}}}),"page_verification_edited"===r&&(0,s().u4)({environment:t,event:{eventName:r,eventProperties:{entrypoint:u,page_type:c,page_id:a,collection_id:l,space_id:d,expiration:o.metadata.expiration??void 0,expiration_date:o.metadata.expiration_date??void 0}}}),"page_verification_disabled"===r&&(0,s().u4)({environment:t,event:{eventName:r,eventProperties:{entrypoint:u,page_type:c,page_id:a,collection_id:l,space_id:d}}})}function r(e){const{environment:t,blockStore:i,entrypoint:n,action:o}=e,r=i.id,a=i.getAssociatedCollectionId(),l=i.getSpaceId();let d=a?"db":"non_db";if(a){const e=i.getAssociatedCollectionStore();null!=e&&e.isPageTreeCollection()&&(d="wiki")}(0,s().u4)({environment:t,event:{eventName:"page_verification_owner_edited",eventProperties:{entrypoint:n,page_type:d,action:o,page_id:r,collection_id:a,space_id:l}}})}},101749:(e,t,i)=>{i.d(t,{N:()=>r});i(296540);var n=()=>i(959013),s=()=>i(423657),o=i(474848);function r(e){const t=(0,s().A)(e);return t.isGuestRequestRequired?(0,o.jsx)(n().sA,{id:"contextualInvite.buttonAndTokenTooltip.guestRequestRequired",defaultMessage:"This guest must be approved by a workspace owner first"}):t.isStoreInTeam?t.teamAllowsGuests?void 0:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{children:(0,o.jsx)(n().sA,{id:"contextualInvite.buttonAndTokenTooltip.teamDisablesGuestsAlertLine1",defaultMessage:"This teamspace doesn't allow guests."})}),(0,o.jsx)("div",{children:(0,o.jsx)(n().sA,{id:"contextualInvite.buttonAndTokenTooltip.teamDisablesGuestsAlertLine2",defaultMessage:"Remove any guests to continue."})})]}):t.spaceAllowsGuests?void 0:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{children:(0,o.jsx)(n().sA,{id:"contextualInvite.buttonAndTokenTooltip.spaceDisablesGuestsAlertLine1",defaultMessage:"This workspace doesn't allow guests."})}),(0,o.jsx)("div",{children:(0,o.jsx)(n().sA,{id:"contextualInvite.buttonAndTokenTooltip.spaceDisablesGuestsAlertLine2",defaultMessage:"Remove any guests to continue."})})]})}},133507:(e,t,i)=>{i.d(t,{j:()=>l});i(296540);var n=()=>i(56366),s=()=>i(959013),o=()=>i(10984),r=()=>i(749240),a=i(474848);function l(e){let{featureAvailability:t}=e;const i=(0,n().K8)((()=>(0,o().aV)(r().subscriptionDataStoreInstance.state)),[])??0,l={type:"unavailable",limit:{type:"cumulative",total:i,current:i},upsell:{type:"product",product:"plus",limit:{type:"cumulative",current:i,total:"unlimited"}}};t??=l;const d=t.limit.total,u=t.upsell;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{children:(0,a.jsx)(s().sA,{id:"inviteUserButton.modalTooltip.guestLimitLine1",defaultMessage:"Your plan allows up to {currentLimit, plural, one {{currentLimit} unique guest} other {{currentLimit} unique guests}}.",values:{currentLimit:d}})}),"product"===u.type?(0,a.jsx)("div",{children:(0,a.jsx)(s().sA,{id:"inviteUserButton.modalTooltip.guestLimitLine2upgrade",defaultMessage:"Upgrade to get up to {upsellLimit, plural, one {{upsellLimit} guest} other {{upsellLimit} guests}}",values:{upsellLimit:u.limit.total}})}):(0,a.jsx)(s().sA,{id:"inviteUserButton.modalTooltip.guestLimitLine2contactSales",defaultMessage:"Contact sales to get more guests"})]})}},170356:(e,t,i)=>{i.d(t,{NS:()=>c,Pq:()=>v,Z3:()=>u,sw:()=>p});i(296540);var n=()=>i(484714),s=()=>i(297872),o=()=>i(928600),r=()=>i(678553),a=()=>i(45552),l=()=>i(722872),d=i(474848);const u=8,c=8,p=32,g={height:p+u-2,paddingTop:u-2};function v(e){let{title:t,helpButton:i,onCancel:r,desktopMinWidth:u,desktopMaxWidth:c,desktopWidth:p,children:g}=e;const{device:v}=(0,n().v3)();return(0,d.jsx)(s().A,{capture:!0,allowEsc:!0,allowUndo:!0,render:e=>{let n;return n=v.isMobile?{menuType:l().gu.Modal,title:t,right:(0,d.jsx)(a().DoneMenuText,{}),onClickRight:r,...e}:{menuType:l().gu.Popup,...u&&{minWidth:u},...c&&{maxWidth:c},...p&&{width:p},...e},(0,d.jsx)(o().A,{...n,header:t&&(0,d.jsx)(m,{title:t,helpButton:i}),children:g})}})}function m(e){let{title:t,helpButton:i}=e;return(0,n().v3)().device.isMobile?null:(0,d.jsx)(r().A,{style:g,title:t,right:i})}},206837:(e,t,i)=>{i.d(t,{o:()=>p});i(296540);var n=()=>i(484714),s=()=>i(401497),o=()=>i(149375),r=()=>i(959013),a=()=>i(284371),l=()=>i(115512),d=()=>i(398208),u=()=>i(285790),c=i(474848);function p(e){const{label:t,onClickBackButton:i,onClose:p,width:g,showBottomBorder:v}=e,m=(0,n().v3)(),h=(0,r().tz)(),y=(0,s().IS)((e=>({container:{display:"flex",alignItems:"center",gap:4,height:40,width:g??320,paddingLeft:8,paddingRight:8,borderBottom:v?`1px solid ${e.regularDividerColor}`:void 0},backButton:{width:24,height:24},closeButton:{position:"absolute",right:0,marginRight:8,borderRadius:"100%"},menuTitle:{flexGrow:1,fontWeight:a().Wy.semibold,fontSize:(0,l().ny)(m,"UIRegular")}})),[m,v,g]);return(0,c.jsxs)("div",{style:y.container,children:[(0,c.jsx)(u().A,{icon:o().v,ariaLabel:h.formatMessage({id:"verificationMenuHeader.backButton.ariaLabel",defaultMessage:"Back"}),onClick:()=>i(),style:y.backButton}),(0,c.jsx)("div",{style:y.menuTitle,children:t}),(0,c.jsx)(d().A,{onClose:()=>p(),style:y.closeButton})]})}},274652:(e,t,i)=>{i.d(t,{A:()=>o});var n=i(296540),s=i(474848);const o=n.forwardRef((function(e,t){const n=(0,i(401497).IS)((t=>({base:{color:e.isBlue?i(100622).Ay.blue:t.mediumTextColor},disabled:{cursor:"not-allowed"},buttonMenuItem:{...e.style,...e.disabled?{cursor:"not-allowed"}:{}}})),[e.disabled,e.isBlue,e.style]),{color:o}=n.base;return(0,s.jsx)(i(760217).A,{ref:t,...e,title:(0,s.jsx)("div",{style:{color:o,fill:o},children:e.title}),icon:(0,s.jsx)(i(8980).I,{icon:i(617668).plusIcon,style:{fill:o}}),style:n.buttonMenuItem})}))},381374:(e,t,i)=>{i.d(t,{p:()=>o});i(296540);var n=()=>i(959013),s=i(474848);function o(e){let{invalidInvites:t,showEmptyError:i,styles:o}=e;if(i)return(0,s.jsx)("div",{style:o,children:(0,s.jsx)(n().sA,{id:"inviteTargetsInput.invalidWarning.noEmails",defaultMessage:"Please enter an email address"})});if(0===t.length)return null;const r=t[0].value.text;return 1===t.length?(0,s.jsx)("div",{style:o,children:(0,s.jsx)(n().sA,{id:"inviteTargetsInput.invalidWarning.singleEmail",defaultMessage:"“{text}” is not a valid email",values:{text:r}})}):(0,s.jsx)("div",{style:o,children:(0,s.jsx)(n().sA,{id:"inviteTargetsInput.invalidWarning.multipleEmails",defaultMessage:"{additionalInvalid, plural, one {“{text}” and {additionalInvalid} other are not valid emails} other {“{text}” and {additionalInvalid} others are not valid emails}}",values:{text:r,additionalInvalid:t.length-1}})})}},401996:(e,t,i)=>{i.d(t,{P:()=>d,S:()=>u});i(898992),i(354520),i(581454);var n=()=>i(842599),s=()=>i(535279),o=()=>i(351360),r=()=>i(975971),a=()=>i(542056);const l=i(496603).sg((e=>{let{environment:t,flowId:n,billingData:s,origin:o}=e;i(134696).D2(t,{invite_flow_id:n,billingData:s,invite_origin:o})}),1e3);async function d(e){var t;const{environment:i,event:d,flowId:u,inviteTargetsStore:c,inviteOrigin:p,onInputChanged:g}=e;null==g||g();const v=null===(t=o().default.state.currentSpaceStore)||void 0===t?void 0:t.id,m=v?await r().A.awaitData(i,{spaceId:v}):void 0;c.setState({...c.state,tokenQuery:d.target.value}),l({environment:i,flowId:u,billingData:null==m?void 0:m.billingData,origin:p});const h=d.target.value,{extractedEmails:y,invalidParts:f,newInputValue:x}=(0,n().l2)(h),b=[...await a().Ah(i,y),...f.map((e=>({type:"invalidUser",value:{text:e}})))].filter((e=>!s().P4({inviteTargetsStore:c,target:e}))),S=[...c.state.inviteTargets,...b];c.setState({...c.state,inviteTargets:S,tokenQuery:x})}function u(e){const{targetToRemove:t,inviteTargetsStore:i}=e;if(0===i.state.inviteTargets.length)return;const n=i.state.inviteTargets.filter((e=>e!==t));0===n.length?i.setState({...i.state,inviteTargets:[]}):i.setState({...i.state,inviteTargets:n})}},423657:(e,t,i)=>{i.d(t,{A:()=>a});var n=()=>i(108944),s=()=>i(299545),o=()=>i(437622);function r(e,t){return(0,o().hN)(e)?{isGuestRequestRequired:!0}:t?{isStoreInTeam:!0,teamAllowsGuests:!0,spaceAllowsGuests:!0,isGuestRequestRequired:!1}:{isStoreInTeam:!1,spaceAllowsGuests:!0,isGuestRequestRequired:!1}}const a=function(e){return(0,i(56366).K8)((()=>{if((0,s().nw)(e))return{isStoreInTeam:!1,spaceAllowsGuests:!0,isGuestRequestRequired:!1};if(!(0,s()._p)(e))return(0,o().r7)(e)?r(e,void 0):{isStoreInTeam:!1,spaceAllowsGuests:!0,isGuestRequestRequired:!1};const t=(0,n().Uo)(e),a=(0,n().pp)(e),l=a||i(351360).default.state.currentSpaceStore;if((0,o().r7)(l))return r(l,t);const d=!(null!=a&&a.getDisableGuests());return t?{isStoreInTeam:!0,teamAllowsGuests:!t.getDisableGuests(),spaceAllowsGuests:d,isGuestRequestRequired:!1}:{isStoreInTeam:!1,spaceAllowsGuests:d,isGuestRequestRequired:!1}}),[e])}},583538:(e,t,i)=>{i.d(t,{Ay:()=>K,Qg:()=>V});i(944114),i(898992),i(354520),i(581454),i(737550);var n=i(296540),s=()=>i(484714),o=()=>i(56366),r=()=>i(764880),a=()=>i(798880),l=()=>i(919709),d=()=>i(959013),u=()=>i(496603),c=()=>i(886680),p=()=>i(722872),g=()=>i(401497),v=()=>i(842599),m=()=>i(906380),h=()=>i(97835),y=()=>i(966505),f=()=>i(653048),x=()=>i(760217),b=()=>i(406699),S=()=>i(811979),C=()=>i(64e3),T=()=>i(8980),w=()=>i(89924),M=()=>i(351360),A=()=>i(529183),k=()=>i(10984),I=()=>i(980270),j=()=>i(875497),_=()=>i(690490),R=i(474848);function P(e){const t=(0,o().uB)(void 0,A().Ay),i=(0,o().uB)(void 0,j().A),{store:r,inputValue:l,intl:u,propertySchemaLimit:p,isLoading:P,handlePersonPropertyMenuChange:B,format:D}=e,U=(0,s().v3)(),E=(0,g().IS)((e=>({moreBarTitleStyle:{color:e.text.secondary,fontSize:11},rightIconStyle:{width:20,height:20,fill:e.icon.secondary},desktopTitleStyle:{color:e.text.secondary,fontSize:11},messageBodyStyle:{color:e.text.tertiary,paddingLeft:2},messageTitleStyle:{color:e.text.tertiary},inviteBodyStyle:{color:e.text.primary}})),[]),{isMobile:L}=(0,s().Y0)(),q=(0,o().K8)((()=>{var e;return null===(e=M().default.state.currentSpaceStore)||void 0===e?void 0:e.getName()}),[]),F=(0,o().K8)((()=>i.state.flowId),[i]),{email:G,isEmail:O,inviteButtonTitle:W}=(0,n.useMemo)((()=>{const e=(0,v().qh)(l),t=(0,v().DT)(e),i=u.formatMessage({id:"invite.person_property.button.invite_people",defaultMessage:"Invite people"}),n=u.formatMessage({id:"invite.person_property.button.invite_email",defaultMessage:"Invite ”{email}”"},{email:e});return{email:e,isEmail:t,inviteButtonTitle:t?n:i}}),[l,u]),N=(0,n.useCallback)((()=>{O&&G&&I().handlePopupClickWithEmail({email:G,inviteTargetsStore:t}),y().TS(U,{origin:"person_property_invite",invite_flow_id:F})}),[O,F,G,U,t]),V=(0,n.useCallback)((()=>{y().F$(U,{origin:"person_property_invite",invite_flow_id:F})}),[F,U]),K=(0,o().K8)((()=>{const e=function(e){const{canAddPermissions:t,isMobile:i,format:n}=e,s="enterprise"===e.subscriptionTier;if(i||s||!t||(0,c().NN)(n))return!1;return!0}({canAddPermissions:r.canEditMembership(),isMobile:L,subscriptionTier:(0,k().AI)(),format:D});return e&&y().HJ(U,{origin:"person_property_invite",invite_flow_id:F}),e}),[r,F,L,U,D]),z=(0,o().K8)((()=>{if(!(0,c().NN)(D))return(0,f().t)(p)}),[D,p]);return K?(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(w().A,{title:(0,R.jsx)(d().sA,{defaultMessage:"People",id:"database.personPropertyValue.selectPerson.noSearchResults.resultsTitle"}),desktopTitleStyle:E.desktopTitleStyle,loading:P,desktopStyle:{paddingBottom:4},children:(0,R.jsx)(C().A,{title:(0,R.jsx)("span",{style:E.messageBodyStyle,children:(0,R.jsx)(d().sA,{defaultMessage:"No matches in {spaceName}",id:"database.personPropertyMenu.noSearchResults.messageWithSpaceName",values:{spaceName:q}})}),titleStyle:E.messageTitleStyle})}),(0,R.jsx)(w().A,{title:(0,R.jsx)(d().sA,{defaultMessage:"More",id:"database.personPropertyValue.selectPerson.noSearchResults.suggestionTitle"}),desktopTitleStyle:E.moreBarTitleStyle,topBorder:!0,desktopStyle:{marginTop:0,paddingTop:10},children:(0,R.jsx)(S().A,{focused:!1,stopClickPropagation:!0,popupType:b().z7.Popup,renderOrigin:e=>(0,R.jsx)(x().A,{...e,focused:!1,icon:(0,R.jsx)(T().I,{icon:h().x,color:"primary"}),title:W,right:(0,R.jsx)(T().I,{icon:m().arrowChevronSingleRightSmallIcon,size:"sm",color:"secondary"}),textWrapperStyle:E.inviteBodyStyle}),onClick:N,onClose:V,borderRadius:8,render:e=>(0,R.jsx)(_().A,{inviteOrigin:"person_property_invite",store:r,handleBackButtonClick:()=>e.close(),inviteTargetsStore:t,personPropertyInviteStore:i,onInviteCompleteFn:t=>{e.close();const i=(t.success?Object.values(t.invitedUsers):[]).map((e=>({table:a().oo,id:e})));B(i)}})})})]}):(0,R.jsx)(w().A,{title:z,loading:P,children:(0,R.jsx)(C().A,{title:(0,R.jsx)(d().sA,{defaultMessage:"No results",id:"database.personPropertyMenu.noSearchResults.message"})})})}var B=()=>i(106628),D=()=>i(422464),U=()=>i(928600),E=()=>i(939740),L=()=>i(448693),q=()=>i(513416),F=()=>i(252833),G=()=>i(449506);var O=()=>i(453697);function W(e){let{environment:t,intl:i,store:n,isSyncedCollection:s,inputValue:o,value:l,format:c,propertySchema:p,handlePersonPropertyMenuAddMentions:g,sectionMenuTitle:v,externalSyncedCollectionType:m}=e;const h=async e=>{if(s&&e.emailAddress){const s=await B().T.searchActions.load(),o=await s.searchSpaceActors({environment:t,query:e.emailAddress,membersOnly:!1,userLocale:i.locale});if(1===o.users.length)g([{table:a().oo,id:o.users[0].id}]);else{const i=await async function(e){let{environment:t,externalUser:i,blockPointer:n,externalSyncedCollectionType:s}=e;const o=await G().callApi({eventName:"getOrCreateNotionUserFromExternalUser",environment:t,data:{externalUser:(0,F().Vz)(i,s),blockPointer:n}});if(!(0,q().kX)(o))return"success"===o.type?o.data.notionUser:void 0}({environment:t,externalUser:e,blockPointer:n.pointer,externalSyncedCollectionType:m});i&&g([{table:a().oo,id:i.id}])}}},y={request:{query:o,actors:u().pb(l,r().Pu)},performRequest:async e=>{let{query:i,actors:s}=e;const o=await async function(e){let{environment:t,blockPointer:i,query:n}=e;const s=await G().callApi({eventName:"getExternalUsersForSyncedCollection",environment:t,data:{blockPointer:i,query:n}});return(0,q().kX)(s)?[]:"success"===s.type?s.data.externalUsers:[]}({environment:t,blockPointer:n.pointer,query:i});return{externalUsers:o,type:"externalUsers"}},render:(e,t,i)=>{if(e)return(0,R.jsx)(w().A,{title:v,loading:!i,children:(0,R.jsx)(C().A,{title:(0,R.jsx)(d().sA,{...V.searchErrorMessage})})});if(t&&"externalUsers"!==t.type)return(0,R.jsx)(w().A,{title:v,loading:!i,children:(0,R.jsx)(C().A,{title:(0,R.jsx)(d().sA,{...V.searchErrorMessage})})});const n=u().oE((t&&t.externalUsers||[]).map((e=>{const t=(0,R.jsx)(O().A,{avatar:{email:e.emailAddress,avatarUrl:"",name:e.displayName}});return{key:e.accountId,render:i=>(0,R.jsx)(x().A,{...i,title:e.displayName,caption:e.emailAddress,icon:t}),action:async()=>{await h(e)}}}))),s=u().oE([n.length>0?{key:"external user section",render:e=>(0,R.jsx)(w().A,{...e,title:(0,R.jsx)(d().sA,{defaultMessage:"Select user from Jira",id:"database.personPropertyValue.externalUsers.searchPlaceholder"}),loading:!i}),items:n}:void 0]);return(0,R.jsx)(E().Ay,{type:E().Oh.Vertical,initialFocus:o.length>0?0:void 0,sections:s})}};return{...y}}var N=()=>i(856952);const V=(0,d().YK)({searchForPerson:{defaultMessage:"Search for a person…",id:"database.personPropertyValue.searchPlaceholder"},searchErrorMessage:{defaultMessage:"Something went wrong.",id:"database.personPropertyMenu.searchErrorMessage"}});const K=function(e){const t=(0,s().v3)(),g=(0,s().Y0)(),v=(0,d().tz)(),{disabled:m,value:h,format:y,valueIsUnpersistedDefaultValue:b,onChange:S,propertySchema:T,parentStore:M,onDismiss:A,isTemplatePage:k,insertChar:I,formQuestionStore:j,collectionStore:_}=e,[q,F]=(0,n.useState)((()=>I||"")),G=(0,o().K8)((()=>{if(!(0,c().NN)(y))return(0,f().t)(T.limit)}),[y,T.limit]),O=(0,o().K8)((()=>{const e=T.limit;return(0,c().NN)(y)&&j?(0,i(31503).hm)(T,j.getModel()):e}),[j,y,T]),K=(0,o().K8)((()=>void 0!==O&&h.length>=O),[O,h]),z=(0,n.useCallback)((e=>{!function(e){let{newMentions:t,tokenLimit:i,value:n,valueIsUnpersistedDefaultValue:s,onChange:o}=e;1===i&&t.length>0?o({type:"personPropertyMenuUpdateReplacePerson",newValue:t[0]}):void 0===i?o(s?{type:"personPropertyMenuUpdateAddPerson",newValues:[...n,...t]}:{type:"personPropertyMenuUpdateAddPerson",newValues:t}):t.length+n.length<=i&&o({type:"personPropertyMenuUpdateAddPerson",newValues:t})}({newMentions:e,tokenLimit:O,value:h,valueIsUnpersistedDefaultValue:b,onChange:S}),F("")}),[S,O,h,b]),{tokens:H,selectedTemplateAnnotationVariables:$}=(0,o().K8)((()=>{const e=[];return{tokens:h.map((t=>{if((0,l().MMZ)(t))return e.push(t),(0,R.jsx)(D().W,{templateVariableType:t,showRemoveButton:!m,onRemove:()=>{S({type:"personPropertyMenuUpdateRemovePerson",removedValue:t})},style:{margin:"0px 6px 6px 0px"}},t);if((0,r().Pu)(t)){const e=(0,r().xC)({pointer:t,getRecordValue:M.getRecordValue});return(0,R.jsx)(L().Ay,{actor:e,format:g.isMobile?L().Ay.Format.Large:L().Ay.Format.Medium,showRemoveButton:!m,onClickRemove:()=>{S({type:"personPropertyMenuUpdateRemovePerson",removedValue:t})},shouldShrink:!0,isSingle:!0},t.id)}(0,i(534177).HB)(t)})),selectedTemplateAnnotationVariables:e}}),[g.isMobile,m,S,M.getRecordValue,h]),Y=l().Wov.filter((e=>!$.includes(e))),Q=(0,o().K8)((()=>{const e=Boolean(_&&_.isExternallyImportedAndSyncedCollection()&&(null==_?void 0:_.getFormat().external_collection_type)),n=null==_?void 0:_.getFormat().external_collection_type;if((0,i(504836).CS)()&&e&&n)return W({environment:t,intl:v,store:M,isSyncedCollection:e,inputValue:q,value:h,format:y,propertySchema:T,handlePersonPropertyMenuAddMentions:z,sectionMenuTitle:G,externalSyncedCollectionType:n});const s={request:{query:q,actors:u().pb(h,r().Pu)},performRequest:async e=>{let{query:i,actors:n}=e;const s=await B().T.searchActions.load(),{users:o}=await s.searchSpaceActors({environment:t,query:i,membersOnly:!1,userLocale:v.locale});return{users:o.filter((e=>!n.some((t=>t.id===e.id)))).slice(0,20),type:"notionUsers"}},render:(e,t,n)=>{if(e)return(0,R.jsx)(w().A,{title:G,loading:!n,children:(0,R.jsx)(C().A,{title:(0,R.jsx)(d().sA,{...V.searchErrorMessage})})});if(t&&"notionUsers"!==t.type)return(0,R.jsx)(w().A,{title:G,loading:!n,children:(0,R.jsx)(C().A,{title:(0,R.jsx)(d().sA,{...V.searchErrorMessage})})});if(t&&0===t.users.length)return(0,R.jsx)(P,{store:M,inputValue:q,intl:v,propertySchemaLimit:T.limit,isLoading:!n,format:y,handlePersonPropertyMenuChange:e=>{z(e)}});const s=!(K&&O&&O>1),o=u().oE((t&&t.users||[]).map((e=>{const t={key:e.id,render:t=>(0,R.jsx)(i(859428).A,{disableTooltip:s,renderTooltip:()=>(0,R.jsx)(d().sA,{defaultMessage:"To select more, remove selection above",id:"database.personPropertyMenu.limitReached"}),render:n=>(0,R.jsx)(i(457688).A,{...t,actor:(0,r().A7)(e),disabled:!s,disabledFeedback:!s,customUserTitleStyles:g.isMobile?{fontSize:16}:void 0,...n})}),action:()=>{z([{table:a().oo,id:e.id}])}};return t}))),l=u().oE([o.length>0?{key:"person section",render:e=>(0,R.jsx)(w().A,{...e,title:G,loading:!n}),items:o}:void 0]);return(0,R.jsx)(E().Ay,{type:E().Oh.Vertical,initialFocus:q.length>0?0:void 0,sections:l})}};return s}),[_,q,h,t,v,M,y,T,z,G,K,O,g.isMobile]),J=(0,R.jsx)(N().Ay,{focus:!g.isMobile||void 0,focusAfterAnimation:!0,format:N().le.Person,tokens:H,tokenWrapStyle:{padding:"4px 6px",gap:4},placeholder:v.formatMessage(V.searchForPerson),hideInput:m,onRemoveLastToken:()=>{S({type:"personPropertyMenuUpdateRemovePerson",removedValue:h[h.length-1]})},value:q,onChange:e=>F(e.target.value),dontShowBorderBottom:g.isAndroid});let Z;return Z=g.isMobile?{menuType:p().gu.Modal,title:T.name,right:(0,R.jsx)(i(45552).DoneMenuText,{}),onClickRight:A,header:J}:{menuType:p().gu.Popup,header:J,tokenInputHeader:!0,maxHeight:333},m?(0,R.jsx)(U().A,{...Z}):(0,R.jsxs)(U().A,{...Z,children:[k&&(0,R.jsx)(w().A,{title:(0,R.jsx)(d().sA,{defaultMessage:"Shortcuts",id:"PersonPropertyMenu.menuItem.shortcuts.label"}),children:Y.length>0?(0,R.jsx)(n.Fragment,{children:Y.map((e=>(0,R.jsx)(x().A,{focused:!1,title:(0,R.jsx)(D().W,{templateVariableType:e}),caption:(0,i(173979).EC)(e,v),inline:!0,onClick:()=>{z([e])}},`relative-person-shortcut-${e}`)))}):(0,R.jsx)(C().A,{title:(0,R.jsx)(d().sA,{id:"database.personPropertyMenu.noShorcuts.message",defaultMessage:"No shortcuts"})})}),(0,R.jsx)(i(251126).A,{...Q})]})}},690490:(e,t,i)=>{i.d(t,{A:()=>ae});var n=i(296540),s=()=>i(484714),o=()=>i(56366),r=()=>i(401497),a=()=>i(959013),l=()=>i(100622),d=()=>i(496603),u=()=>i(966505),c=()=>i(545805),p=()=>i(859428),g=()=>i(912913),v=()=>i(366858),m=()=>i(58293),h=()=>i(646736),y=(i(581454),()=>i(401996)),f=()=>i(856952),x=()=>i(529183),b=(i(517642),i(658004),i(733853),i(845876),i(432475),i(515024),i(731698),i(898992),i(803949),()=>i(784892)),S=()=>i(842599),C=()=>i(534177),T=()=>i(284371),w=()=>i(453697),M=()=>i(423657),A=()=>i(101749),k=()=>i(351360),I=()=>i(749240),j=i(474848);const _=function(e){const{store:t,target:n}=e,d=(0,s().Y0)(),u=(0,a().tz)(),c=function(e){const t=(0,r().IS)((()=>({verifiedDomain:{margin:2,backgroundColor:"rgba(83, 168, 63, 0.1)"},disabled:{margin:2,backgroundColor:"rgba(211, 79, 67, 0.1)",border:"dashed #D9655B 1px",paddingLeft:5},normal:{margin:2},guest:{margin:2,backgroundColor:"rgba(218, 163, 64, 0.2)"},error:{margin:2,backgroundColor:"rgba(195,90,75,0.2)",color:"#DE5550"},tokenContent:{display:"flex",alignItems:"center",maxWidth:"100%"},tokenSpan:{maxWidth:"100%"},tokenText:{marginLeft:4,...T().RC},base:e?{borderRadius:4}:{}})),[e]);return t}((0,o().K8)((()=>(0,i(663590).FI)()),[])),g=(0,o().K8)((()=>{const e=I().subscriptionDataStoreInstance.state,t=e?i(134217).Be(e):[],n={};return t.forEach((e=>{n[e.userId]=e})),n}),[]),v=(0,o().K8)((()=>{const e=k().default.state.currentSpaceStore;return new Set(null==e?void 0:e.getEmailDomains())}),[]),m=(0,M().A)(t),h=(0,A().N)(t),y=(0,o().K8)((()=>{if("invalidUser"===n.type)return"invalidUser";if(e.tokenType)return e.tokenType;if("group"===n.type)return"group";if("existingUser"===n.type&&!Boolean(n.spaceRole)){const e=g[n.value.id];n.spaceRole=e?e.role:"not_in_space"}if(!(0,i(743260).yi)(n))return"member";if(m.isGuestRequestRequired)return"guestRequestRequired";if(m.isStoreInTeam&&!m.teamAllowsGuests)return"teamGuestDisabled";if(!m.isStoreInTeam&&!m.spaceAllowsGuests||m.isStoreInTeam&&!m.teamAllowsGuests&&!m.spaceAllowsGuests)return"spaceGuestDisabled";const t=(0,S().zN)(n.value.email);return t&&v.has(t)?"verifiedDomain":"guest"}),[e.tokenType,n,g,v,m]),f=(0,o().K8)((()=>{const e=c.base;switch(y){case"member":case"group":return{...e,...c.normal};case"invalidUser":return{...e,...c.error};case"guest":case"guestRequestRequired":return{...e,...c.guest};case"verifiedDomain":return{...e,...c.verifiedDomain};case"spaceGuestDisabled":case"teamGuestDisabled":case"teamGroupOwner":return{...e,...c.disabled};default:(0,C().HB)(y)}}),[y,c]);function _(){switch(n.type){case"newUser":return n.value.email.trim();case"invalidUser":return n.value.text.trim();case"existingUser":return(0,i(695608).c6)(u,n.value);case"group":return(0,i(698449).Pf)({intl:u,groupName:n.value.name});default:(0,C().HB)(n)}}function R(){const e=(0,i(133033).$)({height:16,width:16,color:"#D34F43"});switch(y){case"member":return(0,x().ju)(n)?(0,j.jsx)(w().A,{userValue:n.value,size:16}):(0,x().rP)(n)?(0,j.jsx)(w().A,{size:16,avatar:n.value}):(0,j.jsx)(w().A,{size:16});case"guest":case"guestRequestRequired":return(0,i(328347).h)({height:16,width:16,color:"#DAA340"});case"invalidUser":return(0,i(889154).G)({height:16,width:16,color:"#DE5550"});case"verifiedDomain":return(0,i(22394).o)({height:16,width:16,color:"#53A83F"});case"group":return(0,j.jsx)("div",{style:{height:16,width:16,backgroundColor:l().Ay.whiteWithAlpha(.8),borderRadius:"50%",display:"flex",justifyContent:"center",alignItems:"center"},children:(0,i(234194).M)({height:12,width:12,color:l().Ay.mediumTextColor})});case"spaceGuestDisabled":case"teamGuestDisabled":case"teamGroupOwner":return e;default:(0,C().HB)(y)}}function P(t){const i=R();let n=_(),s=c.tokenText;return e.onlyShowTokenType&&(["guest","teamGuestDisabled","spaceGuestDisabled"].includes(t)?(n="Guest",s={...s,color:"#DAA340"}):(n="Member",s={...s,color:"#53A83F"})),(0,j.jsxs)("div",{style:c.tokenContent,children:[i,(0,j.jsx)("div",{style:s,children:n})]})}function B(t){var i;t.stopPropagation(),null===(i=e.onClickRemove)||void 0===i||i.call(e)}const D="newUser"===n.type?n.value.email:"invalidUser"===n.type?n.value.text:n.value.id,U="group"!==n.type&&"invalidUser"!==n.type?n.value.email:void 0;return(0,j.jsx)(p().A,{placement:i(962730).W.Top,renderTooltip:()=>function(e){const{tokenType:t,target:i,email:n}=e;return"guest"===t?(0,j.jsx)(a().sA,{defaultMessage:"{email} will be invited as a guest",id:"inviteTargetToken.guest.tooltip",values:{email:n}}):"spaceGuestDisabled"===t||"teamGuestDisabled"===t||"guestRequestRequired"===t?h:"invalidUser"===i.type?(0,j.jsx)(a().sA,{defaultMessage:"{text} is not a valid email",id:"inviteTargetToken.invalidUser.tooltip",values:{text:i.value.text}}):"verifiedDomain"===t&&"group"!==i.type?(0,j.jsx)(a().sA,{defaultMessage:"{email}{br}will automatically be added to the workspace{br}since @{domain} is an allowed email domain.",id:"inviteTargetToken.verifiedDomain.tooltip",values:{email:i.value.email,br:(0,j.jsx)("br",{}),domain:(0,S().zN)(i.value.email)}}):"group"===i.type?i.value.name||(0,j.jsx)(a().sA,{defaultMessage:"Untitled group",id:"inviteTargetToken.group.untitled"}):n}({tokenType:y,email:U,target:n}),render:t=>(0,j.jsx)("div",{style:c.tokenSpan,...t,children:(0,j.jsx)(i(881690).A,{isSingle:!1,format:d.isMobile?b().NY.Large:b().NY.Medium,showRemoveButton:e.showRemoveButton,onClickRemove:B,disabledFeedback:!0,value:P(y),style:f,shouldWrap:!1})})},D)};const R=function(e){const{flowId:t,store:n,disabled:a,placeholder:u,right:c,focus:p,hideIconColorAndTooltips:g,showEmptyError:v,origin:m,onFocus:h,onSubmit:b,onInputChanged:S}=e,C=(0,s().v3)(),T=(0,s().Y0)(),w=(0,o().uB)(e.inviteTargetsStore,x().Ay),M=(0,o().K8)((()=>w.state.inviteTargets),[w]),A=(0,o().K8)((()=>w.state.tokenQuery),[w]),k=M.map((e=>{const t="newUser"===e.type?e.value.email:"invalidUser"===e.type?e.value.text:e.value.id;return(0,j.jsx)(_,{store:n,target:e,showRemoveButton:!0,tokenType:g?"member":void 0,onClickRemove:()=>y().S({inviteTargetsStore:w,targetToRemove:e})},t)})),I=(0,r().IS)((e=>({tokenSpan:{maxWidth:"100%"},tokenInputMenuItem:{paddingTop:k.length>0?4:6,paddingLeft:4,paddingRight:4,paddingBottom:4,borderRadius:4,minHeight:32,...p&&{background:"none"},...a&&{background:e.inputBackground,color:e.mediumTextColor,fill:l().Ay.white,opacity:.4}},inputAndTokenWrapRight:{gap:2},inputInnerStyle:{paddingTop:0},warningMessage:{color:"#DE5550"}})),[p,a,k]);return(0,j.jsx)(f().Ay,{focus:p,focusAfterAnimation:!0,onClick:()=>{T.isMobile||null==h||h()},format:f().le.Share,value:A,onChange:e=>y().P({environment:C,event:e,inviteTargetsStore:w,inviteOrigin:m,flowId:t,onInputChanged:S}),type:"email",tokens:k,disabled:a,autoComplete:"off",placeholder:u,onRemoveLastToken:()=>{w.setState({...w.state,inviteTargets:w.state.inviteTargets.slice(0,-1)})},right:c,showBorder:!0,inputStyle:I.inputInnerStyle,inputAndTokenWrapRightStyle:I.inputAndTokenWrapRight,style:I.tokenInputMenuItem,onSubmit:b,inputFullWidth:!0,message:(0,j.jsx)(i(381374).p,{invalidInvites:(0,d().oE)(M.map((e=>"invalidUser"===e.type?e:void 0))),showEmptyError:v,styles:I.warningMessage})})};var P=()=>i(454354),B=()=>i(980270),D=()=>i(875497),U=(i(16280),i(354520),i(737550),()=>i(68263)),E=()=>i(542056),L=()=>i(204063),q=()=>i(125565),F=()=>i(133507),G=()=>i(15897),O=()=>i(535279),W=()=>i(731320),N=()=>i(274184),V=()=>i(597898);function K(e){var t;const{store:i,sudoModeStore:r,personPropertyInviteStore:l,onInviteCompleteFn:d,inviteOrigin:c}=e,g=(0,s().v3)(),v=Y(),m=(0,o().uB)(e.inviteTargetsStore,x().Ay),h=(0,o().K8)((()=>l.state.isLoading),[l]),y=(0,n.useCallback)((e=>{l.setState({...l.state,isLoading:e,focus:D().E.NoFocus})}),[l]),[f,b]=(0,n.useState)("member"),S=(0,o().K8)((()=>{const{emailMessage:e}=l.state;return e}),[l]),C=(0,o().K8)((()=>{const{role:e}=l.state;return e}),[l]),T=(0,a().tz)(),w=(0,o().K8)((()=>l.state.flowId),[l]),_=(0,o().K8)((()=>k().default.state.currentSpaceStore),[]),R=(0,o().K8)((()=>i.canEditMembership()),[i]),P=(0,o().K8)((()=>(0,O().U1)({inviteTargetsStore:m})),[m]),L=(0,n.useCallback)((async()=>{await B().handleEnterPress({environment:g,inviteTargetsStore:m,personPropertyInviteStore:l,allowShowEmptyError:!0})}),[g,m,l]),q=(0,n.useCallback)((()=>{const e=(0,O().U1)({inviteTargetsStore:m}),t=e.filter((e=>{let{type:t}=e;return"newUser"===t})).map((e=>{let{value:t}=e;return t.email})),i=e.filter((e=>{let{type:t}=e;return"existingUser"===t})).map((e=>{let{value:t}=e;return t.id}));return W().FC({subscriptionData:I().subscriptionDataStoreInstance.state,newGuestIds:[...t,...i]})}),[m]),K=(0,o().K8)((()=>q()),[q]),Q=(0,o().O$)(I().subscriptionDataStoreInstance),J=(0,N().T)(Q),Z=(0,o().K8)((()=>W().LS(Q,J)),[J,Q]),X=(0,M().A)(i),ee=(0,o().K8)((()=>{if(X.isGuestRequestRequired)return!1;const e=X.isStoreInTeam&&!X.teamAllowsGuests,t=!X.isStoreInTeam&&!X.spaceAllowsGuests||X.isStoreInTeam&&!X.teamAllowsGuests&&!X.spaceAllowsGuests,i=P.some((e=>"newUser"===e.type||("existingUser"===e.type?"none"===e.spaceRole||"not_in_space"===e.spaceRole:void 0)));return(e||t)&&i}),[P,X]),te=(0,o().K8)((()=>null==_?void 0:_.getRole()),[_]),ie=(0,o().K8)((()=>!(!te||!(0,U().NB)(te))&&!(!_||_.getDisableMembershipRequests())),[te,_]),ne=(0,V().P9)({name:"members",spaceId:null==_?void 0:_.id,userId:null===(t=g.currentUser)||void 0===t?void 0:t.id,amount:1}),se=Boolean(ne&&te&&(0,U().vp)(te));(0,n.useEffect)((()=>{b(se?"member":"guest")}),[se]);const oe=(0,A().N)(i),re=S.length>1e3,ae=(0,n.useCallback)((e=>{const{response:t,shouldDoCompleteFn:i,invitedUserEmails:n,isRequestMember:s}=e;t.success?i&&(u().cI(g,{invited_user_count:n.length,is_success:t.success,can_add_member:se,invite_option:f,origin:c,invite_flow_id:w}),B().showMessageForInviteComplete({success:t.success,invitedUserEmails:n,isRequestMember:s}),y(!1),d(t)):(B().showMessageForInviteComplete({success:t.success,invitedUserEmails:n}),u().cI(g,{invited_user_count:n.length,is_success:t.success,can_add_member:se,invite_option:f,origin:c}))}),[d,w,y,g,f,se,c]),le=(0,n.useCallback)((async e=>{const{invitedUserEmails:t,shouldDoCompleteFn:n}=e;return await B().handleGuestInvite({environment:g,inviteOrigin:c,role:C,emailMessage:S,inviteTargetsStore:m,blockStore:i,sudoModeStore:r,flowId:w,onInviteComplete:e=>{ae({response:e,shouldDoCompleteFn:n||!1,invitedUserEmails:t})}})}),[g,C,S,i,r,w,m,ae,c]),de=(0,n.useCallback)((async e=>{const{invitedUserEmails:t,disable_invite_email:i,guestInviteResponse:n,shouldDoCompleteFn:s}=e;if(!_)return null;const o=null!=n&&n.success?n.invitedUsers:void 0;await B().handleMemberInvite({environment:g,spaceStore:_,flowId:w,onInviteComplete:e=>{ae({response:e,shouldDoCompleteFn:s||!1,invitedUserEmails:t})},intl:T,invitedUsers:o,inviteTargetsStore:m,inviteOrigin:c,disable_invite_email:i})}),[_,g,w,m,T,ae,c]),ue=(0,n.useCallback)((async e=>{const{invitedUserEmails:t,guestInviteResponse:n}=e;if(!_)return null;const s=null!=n&&n.success?n.invitedUsers:void 0;s&&await B().handleMemberRequest({environment:g,spaceStore:_,originType:"person_property_invite",intl:T,invitedUsers:s,reasonMessage:void 0,originId:i.id,flowId:w,onInviteComplete:e=>{ae({response:e,shouldDoCompleteFn:!0,invitedUserEmails:t,isRequestMember:!0})},inviteOrigin:c})}),[g,w,_,T,ae,i,c]),ce=(0,n.useCallback)((async()=>{const e="member"===f,t=m.state.inviteTargets.filter((e=>"newUser"===e.type||"existingUser"===e.type)).map((e=>e.value.email));if(0===t.length)return void u().N_(g,{invite_stage:"click_invite_button",invite_flow_id:w,error:"No valid input emails"});const i=q();if(y(!0),e)if(i)await de({invitedUserEmails:t,disable_invite_email:!1,guestInviteResponse:void 0,shouldDoCompleteFn:!0});else{const e=!se&&!ie,i=await le({invitedUserEmails:t,shouldDoCompleteFn:e});se?await de({invitedUserEmails:t,disable_invite_email:!0,guestInviteResponse:i,shouldDoCompleteFn:!0}):ie&&await ue({invitedUserEmails:t,guestInviteResponse:i})}else i?u().N_(g,{invite_stage:"click_invite_button",invite_flow_id:w,error:"Invite guest with guest limitation exceed"}):await le({invitedUserEmails:t,shouldDoCompleteFn:!0});y(!1),m.reset()}),[g,se,ie,f,w,q,m,le,de,ue,y]),pe=(0,n.useCallback)((async()=>{await L();const e=(0,O().U1)({inviteTargetsStore:m}).length;u().u$(g,{invited_user_count:e,invite_option:f,can_add_member:se,origin:c,inviteTargets:m.state.inviteTargets.map((e=>e.type.toString())),inviteTokenQuery:m.state.tokenQuery,invite_flow_id:w}),await ce()}),[g,w,L,ce,f,se,m,c]);let ge;ge=ee?oe:re?(0,j.jsx)(a().sA,{id:"shareMenu.inviteButton.emailOverMaxLength.tooltip",defaultMessage:"Message exceeds the limit of 1000 characters."}):void 0;const ve=(0,n.useMemo)((()=>[{key:"member",render:()=>(0,j.jsx)(p().A,{disableTooltip:se||ie,renderTooltip:()=>(0,j.jsx)(a().sA,{id:"invite.person_property.invite_member.tooltip",defaultMessage:"You do not have permission to add or request members to this workspace"}),render:e=>(0,j.jsx)($,{isSelected:"member"===f,inviteOption:"member",events:e})}),isDisabled:!se&&!ie},{key:"guest",render:()=>(0,j.jsx)(p().A,{disableTooltip:!K&&Z,renderTooltip:()=>(0,j.jsx)(F().j,{}),render:e=>(0,j.jsx)($,{isSelected:"guest"===f,inviteOption:"guest",events:e})})}]),[f,K,Z,ie,se]);return(0,j.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[(0,j.jsx)("div",{style:v.section,children:(0,j.jsx)(G().A,{items:ve,itemStyle:v.itemStyle,innerStyle:v.innerStyle,value:f,onChange:e=>{b(e),u().ZZ(g,{invite_option:e,invite_flow_id:w,origin:c})}})}),!K&&Z||"guest"!==f?(0,j.jsx)(H,{tooltip:ge,disabled:!R||ee||re,onClick:pe,isLoading:h}):(0,j.jsx)(z,{onClick:()=>{u().j$(g,{invited_user_count:P.length,invite_flow_id:w,origin:c}),E().D6({environment:g,upgradeButtonName:"user_permission_item"})}})]})}function z(e){const{onClick:t}=e;return(0,j.jsx)(p().A,{disableTooltip:!1,renderTooltip:()=>(0,j.jsx)(F().j,{}),render:e=>(0,j.jsx)(L().A,{size:"lg",style:{margin:"0 16px 16px 16px",borderRadius:6},onClick:t,...e,children:(0,j.jsx)(a().sA,{id:"invite.person_property.upgrade",defaultMessage:"Upgrade"})})})}function H(e){const{tooltip:t,disabled:i,onClick:n,isLoading:s}=e;return(0,j.jsx)(p().A,{disableTooltip:!Boolean(t),renderTooltip:()=>t,render:e=>(0,j.jsx)(L().A,{size:"lg",style:{margin:"0 16px 16px 16px",borderRadius:6},disabled:i,onClick:n,...e,isLoading:s,children:(0,j.jsx)(a().sA,{id:"invite.person_property.invite",defaultMessage:"Invite"})})})}function $(e){const{isSelected:t,inviteOption:i,events:n}=e,s=Y(),o=t?s.mainTextSelected:s.mainTextUnselected;let r,l;switch(i){case"guest":r=(0,j.jsx)(a().sA,{id:"invite.person_property.addAsGuest.title",defaultMessage:"Add to page only"}),l=(0,j.jsx)(a().sA,{id:"invite.person_property.addAsGuest.subtitle",defaultMessage:"Invite as a Guest"});break;case"member":r=(0,j.jsx)(a().sA,{id:"invite.person_property.addAsMember.title",defaultMessage:"Add to Workspace"}),l=(0,j.jsx)(a().sA,{id:"invite.person_property.addAsMember.subtitle",defaultMessage:"Invite and bill as a Member"});break;default:throw new Error(`Unsupported invite option: ${i}`)}return(0,j.jsx)("div",{style:s.row,...n,children:(0,j.jsxs)("div",{style:o,children:[r,(0,j.jsx)(q().A,{isSmall:!0,style:s.optionSubtitle,children:l})]})})}function Y(){return(0,r().IS)((e=>({mainTextSelected:{fontWeight:T().Wy.medium,color:e.regularTextColor,fontSize:14,lineHeight:"14px"},mainTextUnselected:{color:e.mediumTextColor,fontSize:14,lineHeight:"14px"},row:{display:"flex",alignItems:"center",justifyContent:"center",gap:4,lineHeight:"14px"},section:{padding:"16px 11px 16px 11px"},itemStyle:{margin:5,borderRadius:8,borderWidth:2},innerStyle:{borderWidth:0},optionSubtitle:{whiteSpace:"pre-wrap",paddingTop:2,fontSize:12}})),[])}var Q=()=>i(149375),J=()=>i(285790);function Z(e){let{handleBackButtonClick:t}=e;const i=(0,r().IS)((()=>({container:{display:"flex",margin:"0 12px 0px",height:40}})),[]);return(0,j.jsx)("div",{style:i.container,children:(0,j.jsx)(X,{onClick:t})})}function X(e){const{onClick:t}=e,i=(0,a().tz)(),n=(0,r().IS)((()=>({topContainer:{display:"flex",alignItems:"center",width:"max-content"},iconButton:{marginRight:6,height:24,width:24},arrowIcon:{height:16,width:16,strokeWidth:T().Wy.semibold},sendInviteLabel:{fontWeight:T().Wy.medium}})),[]);return(0,j.jsxs)("div",{style:n.topContainer,children:[(0,j.jsx)(J().A,{icon:Q().v,iconStyle:n.arrowIcon,style:n.iconButton,onClick:t,ariaLabel:i.formatMessage({id:"shareMenu.backButton.iconButton",defaultMessage:"Go back to main share menu."})}),(0,j.jsx)(q().A,{style:n.sendInviteLabel,children:(0,j.jsx)(a().sA,{id:"invite.person_property.popup_title",defaultMessage:"Invite and mention"})})]})}var ee=()=>i(456328),te=()=>i(623580),ie=()=>i(250064);const ne=d().sg((e=>{let{environment:t,flowId:i,origin:n}=e;u().IT(t,{origin:n,invite_flow_id:i})}),1e3);function se(e){const{inviteTargetsStore:t,personPropertyInviteStore:i,inviteOrigin:r}=e,a=(0,s().v3)(),{focus:l,emailMessage:d}=(0,o().K8)((()=>{const{focus:e,emailMessage:t}=i.state;return{focus:e,emailMessage:t}}),[i]),u=(0,o().K8)((()=>i.state.flowId),[i]),c=(0,n.useCallback)((()=>{t.reset()}),[t]),p=(0,n.useCallback)((e=>{i.setState({...i.state,focus:l,emailMessage:e.target.value}),ne({environment:a,flowId:u,origin:r})}),[a,i,u,r,l]),g=(0,n.useCallback)((()=>{c()}),[c]),v=(0,n.useCallback)((()=>{i.setState({...i.state,focus:D().E.MessageInput,emailMessage:d})}),[i,d]);return(0,j.jsx)(oe,{focus:l===D().E.MessageInput,value:d,onFocus:v,onChange:p,onCancel:g,maxLength:1e3,inviteTargetsStore:t})}function oe(e){const{focus:t,value:i,maxLength:n,inviteTargetsStore:l,onFocus:d,onChange:u,onCancel:c}=e,p=(0,a().tz)(),g=i.length/n>=.8,v=(0,ee().BS)(i),m=g||v,h=(0,s().Y0)(),y=(0,r().IS)((e=>({container:{maxHeight:80,bottom:0,padding:"2px 16px 2px 16px",backgroundColor:e.modalBackground,pointerEvents:"all",transitionProperty:"max-height",transitionDuration:"0.3s",overflow:"hidden",zIndex:1,height:72},input:{maxHeight:80,borderTop:1,borderTopStyle:"solid",borderTopColor:e.regularDividerColor,padding:2,fontSize:14,transitionProperty:"max-height",transitionDuration:"0.3s",height:"100%"},inputBox:{padding:"0px 4px 0px 4px",boxShadow:e.inputBoxShadow,background:e.inputBackground,width:"auto",height:"100%",borderRadius:6,...t&&{background:"none",boxShadow:"rgba(35, 131, 226, 0.57) 0px 0px 0px 1px inset, rgba(35, 131, 226, 0.35) 0px 0px 0px 2px"}}})),[t]),f=(0,o().K8)((()=>l.state.inviteTargets.filter((e=>"newUser"===e.type||"existingUser"===e.type)).map((e=>e.value.email))),[l]),x=(0,o().K8)((()=>f.length>0?p.formatMessage({id:"invite.person_property.emailMessageInput.placeholder.withEmails",defaultMessage:"Add a message for {users}"},{users:(0,ie().l)(f)}):p.formatMessage({id:"invite.person_property.emailMessageInput.placeholder.noEmails",defaultMessage:"Add a message to your invite..."})),[p,f]);return(0,j.jsxs)("div",{style:y.container,children:[m&&(0,j.jsx)(re,{value:i,maxLength:n,shouldShowLengthWarning:g,shouldShowLinkWarning:v}),(0,j.jsx)(te().A,{textarea:!0,focusInitial:!1,format:te().C.Transparent,placeholder:x,maxlength:n,focus:t,value:i,onFocus:d,onChange:u,inputStyle:y.input,onCancel:c,style:y.inputBox,onClick:()=>{h.isMobile||null==d||d()}})]})}function re(e){const{shouldShowLengthWarning:t,shouldShowLinkWarning:i,value:n,maxLength:s}=e,o=(0,r().IS)((e=>({container:{position:"absolute",top:0,display:"flex",justifyContent:"center",fontSize:12,color:e.lightTextColor,width:"100%"},warning:{display:"flex",justifyContent:"center",width:"calc(100% - 36px)",backgroundColor:e.modalBackground,marginTop:1}})),[]);return(0,j.jsx)("div",{style:o.container,children:(0,j.jsxs)("div",{style:o.warning,children:[t&&(0,j.jsx)(a().sA,{defaultMessage:"{characters} / {maxCharacters} characters",id:"ContextualInvite.permissions_invites.messageLengthWarning",values:{characters:n.length,maxCharacters:s}}),t&&i&&" · ",i&&(0,j.jsx)(a().sA,{defaultMessage:"Links will be omitted from your message",id:"ContextualInvite.permissions_invites.removeLinkWarning"})]})})}function ae(e){const{store:t,handleBackButtonClick:i,onInviteCompleteFn:a,inviteTargetsStore:l,personPropertyInviteStore:u,inviteOrigin:p}=e,g=(0,o().uB)(void 0,P().A),v=(0,s().v3)(),m=(0,n.useCallback)((async()=>{await B().handleEnterPress({environment:v,inviteTargetsStore:l,personPropertyInviteStore:u,allowShowEmptyError:!1})}),[v,l,u]),h=(0,r().IS)((()=>({container:{position:"relative",width:450,transition:"all",transitionDuration:"0.3s",display:"flex",flexDirection:"column",maxHeight:500},searchBar:{paddingLeft:16,paddingRight:16,paddingBottom:16,paddingTop:16},horizontalLine:{margin:"0",color:"#E3E2E0",opacity:.3}})),[]);return(0,j.jsx)(c().A,{debugName:"PersonPropertyInvitePopup",capture:!0,onLeft:d().D_,onRight:d().D_,onSelectAll:d().D_,onRedo:d().D_,onUndo:d().D_,onCut:d().D_,onCopy:d().D_,onPaste:d().D_,onKeypress:d().D_,onDelete:d().D_,onBackspace:d().D_,onTab:d().D_,onEnter:m,children:(0,j.jsxs)("div",{style:h.container,children:[(0,j.jsx)(Z,{handleBackButtonClick:i}),(0,j.jsx)("hr",{style:h.horizontalLine}),(0,j.jsx)("div",{style:h.searchBar,children:(0,j.jsx)(le,{store:t,inviteTargetsStore:l,personPropertyInviteStore:u,inviteOrigin:p})}),(0,j.jsx)(se,{store:t,inviteTargetsStore:l,personPropertyInviteStore:u,inviteOrigin:p}),(0,j.jsx)("div",{children:(0,j.jsx)(K,{store:t,inviteTargetsStore:l,sudoModeStore:g,onInviteCompleteFn:a,personPropertyInviteStore:u,inviteOrigin:p})})]})})}function le(e){const{store:t,personPropertyInviteStore:i,inviteOrigin:n}=e,d=(0,a().tz)(),c=(0,s().v3)(),y=(0,o().uB)(e.inviteTargetsStore,x().Ay),f=(0,m().r)(),b=(0,h().HI)(),S=(0,v().A)(f),{focus:C,emailMessage:T}=(0,o().K8)((()=>{const{focus:e,emailMessage:t}=i.state;return{focus:e,emailMessage:t}}),[i]),{role:w,showEmptyError:M}=(0,o().K8)((()=>{const{role:e,showEmptyError:t}=i.state;return{role:e,showEmptyError:t}}),[i]),A=(0,o().K8)((()=>t.getType()),[t]),k=(0,o().K8)((()=>i.state.flowId),[i]),I=(0,o().K8)((()=>t.canEditMembership()),[t]),_=(0,r().IS)((()=>({permissionsRoleSelectButton:{display:"flex",whiteSpace:"nowrap",height:20,margin:0,borderRadius:4,color:l().Ay.uiGray}})),[]);return f&&b&&S?(0,j.jsx)(p().A,{disableTooltip:I,renderTooltip:()=>{if(!I)return(0,j.jsx)(a().sA,{id:"shareMenu.inviteButton.fullAccessOnlyMessage.tooltip",defaultMessage:"Only those with full access can add people."})},render:e=>(0,j.jsx)("div",{style:{display:"flex"},...e,children:(0,j.jsx)(R,{inviteTargetsStore:y,store:f,disabled:!I,origin:n,flowId:k,focus:C===D().E.InviteInput,showEmptyError:M,onFocus:()=>{i.setState({...i.state,focus:D().E.InviteInput,emailMessage:T||""})},placeholder:d.formatMessage({id:"invite.person_property.inviteTargetsInput.placeholder",defaultMessage:"Add emails..."}),onInputChanged:()=>i.setState({...i.state,showEmptyError:!1}),right:(0,j.jsx)(g().Ay,{disabled:!I,role:w,table:"block",type:"user_permission",blockType:A,isInvite:!0,upgradeButtonName:"invite_permission_block",buttonStyle:_.permissionsRoleSelectButton,isMenuItem:!1,onChange:e=>{i.setState({...i.state,role:e}),u().et(c,{invited_role:e,invite_flow_id:k,origin:n})}})})})}):null}},875497:(e,t,i)=>{i.d(t,{A:()=>o,E:()=>n});let n=function(e){return e.InviteInput="invite_input",e.MessageInput="message_input",e.NoFocus="no_focus",e}({});class s extends(()=>i(757695))().default{getInitialState(){return{flowId:i(206267).JW(),role:"editor",focus:n.InviteInput,emailMessage:"",isLoading:!1,showEmptyError:!1}}}const o=s},906380:(e,t,i)=>{i.r(t),i.d(t,{arrowChevronSingleRightSmallIcon:()=>s,iconDefinition:()=>n});i(296540);const n={viewBox:"0 0 16 16",svg:(0,i(474848).jsx)("path",{d:"M6.722 3.238a.625.625 0 1 0-.884.884L9.716 8l-3.878 3.878a.625.625 0 0 0 .884.884l4.32-4.32a.625.625 0 0 0 0-.884z"})},s=(0,i(340498).wt)("arrowChevronSingleRightSmall",n)},908671:(e,t,i)=>{i.d(t,{y:()=>W});var n=i(296540),s=()=>i(484714),o=()=>i(401497),r=()=>i(604995),a=()=>i(416504),l=()=>i(798880),d=()=>i(931075),u=()=>i(959013),c=()=>i(284371),p=()=>i(989423),g=()=>i(722872),v=()=>i(508496),m=()=>i(928600),h=()=>i(45552),y=()=>i(206837),f=()=>i(212050),x=()=>i(760217),b=()=>i(89924),S=i(474848);function C(e){const{onClick:t}=e,i=(0,s().v3)().device.isMobile,n=(0,o().IS)((e=>({buttonStyle:{color:e.text.uiRedPrimary,fontSize:i?c().J.UIRegular.mobile:c().J.UIRegular.desktop}})),[i]);return(0,S.jsx)(b().A,{topBorder:!0,children:(0,S.jsx)(x().A,{focused:!1,icon:(0,f().u)({width:14,marginLeft:0}),title:(0,S.jsx)(u().sA,{defaultMessage:"Remove verification",id:"VerificationPropertyOverlayMenu.removeVerificationButton"}),onClick:t,style:n.buttonStyle})})}var T=()=>i(244641),w=()=>i(56366),M=()=>i(186445),A=()=>i(972435),k=()=>i(712677),I=()=>i(573351);const j=(0,u().YK)({placeholder:{id:"VerificationExpiryMenu.pickSpecificDate.placeholder",defaultMessage:"Pick a date"}});function _(e){const{onChange:t,clearCustomDatePicker:i,verificationState:a,addExtraTopPadding:l}=e,d=(0,n.useRef)(e.today),u=(0,n.useRef)(e.today.plus({days:1})),[c,p]=(0,n.useState)(!1),g=(0,w().O$)(M().XX),v="verified"!==a.type||a.isIndefinite?void 0:a.dateTimeRange.end,m=(0,s().Y0)().isMobile,h=(0,o().IS)((e=>({containerStyle:{paddingTop:l?12:4,paddingBottom:12},mobileContainerStyle:{paddingBottom:10},calendar:m?{padding:"16px 14px 16px",borderBottom:`1px solid ${e.regularDividerColor}`,background:e.popoverBackground,marginTop:27,boxShadow:`0 -1px 0 ${e.regularDividerColor}`}:{},input:m?{padding:"16px 0",marginTop:0}:{}})),[l,m]);return(0,S.jsxs)(b().A,{mobileStyle:h.mobileContainerStyle,style:h.containerStyle,disableMobilePadding:!0,children:[(0,S.jsx)(k().A,{placeholder:A().A.formatMessage(j.placeholder),focused:c,value:"verified"!==e.verificationState.type||e.verificationState.isIndefinite?void 0:r().lN(e.verificationState.dateTimeRange.end),onUpdate:e=>{if(e.error)return;const n=e.value&&r().Dz(e.value);n?t({range:{start:d.current,end:n.start}}):i()},onFocus:()=>p(!0),onBlur:()=>p(!1),onClearButtonClick:i,hideClearButton:!0,style:h.input}),(0,S.jsx)("div",{style:h.calendar,children:(0,S.jsx)(I().A,{firstDayOfWeek:g,value:(null==v?void 0:v.toMillis())||u.current.toMillis(),selectValue:Boolean(v),onChange:e=>{t({range:{start:d.current,end:T().c9.fromMillis(e)},option:"custom"})},disabledDays:{before:new Date(u.current.toMillis())},className:"notion-date-property-menu"})})]})}i(581454);var R=()=>i(599987),P=()=>i(563884);const B=(0,i(340498).wt)("infinity",{viewBox:"0 0 40 19",svg:(0,S.jsx)("path",{d:"M0.297852 9.42383C0.297852 11.2695 0.65918 12.876 1.38184 14.2432C2.11426 15.6104 3.13477 16.6748 4.44336 17.4365C5.75195 18.1885 7.26562 18.5645 8.98438 18.5645C10.3613 18.5645 11.6504 18.2715 12.8516 17.6855C14.0625 17.0898 15.2881 16.1963 16.5283 15.0049L20 11.6504L23.4717 15.0049C24.7119 16.1963 25.9375 17.0898 27.1484 17.6855C28.3594 18.2715 29.6484 18.5645 31.0156 18.5645C32.7344 18.5645 34.248 18.1885 35.5566 17.4365C36.8652 16.6748 37.8809 15.6104 38.6035 14.2432C39.3359 12.876 39.7021 11.2695 39.7021 9.42383C39.7021 7.57812 39.3359 5.97168 38.6035 4.60449C37.8809 3.2373 36.8652 2.17773 35.5566 1.42578C34.248 0.664062 32.7344 0.283203 31.0156 0.283203C29.6484 0.283203 28.3594 0.581055 27.1484 1.17676C25.9375 1.7627 24.7119 2.65137 23.4717 3.84277L20 7.19727L16.5283 3.84277C15.2881 2.65137 14.0625 1.7627 12.8516 1.17676C11.6504 0.581055 10.3613 0.283203 8.98438 0.283203C7.26562 0.283203 5.75195 0.664062 4.44336 1.42578C3.13477 2.17773 2.11426 3.2373 1.38184 4.60449C0.65918 5.97168 0.297852 7.57812 0.297852 9.42383ZM3.5791 9.42383C3.5791 8.23242 3.80371 7.19727 4.25293 6.31836C4.71191 5.43945 5.34668 4.76074 6.15723 4.28223C6.96777 3.80371 7.91016 3.56445 8.98438 3.56445C9.88281 3.56445 10.752 3.78418 11.5918 4.22363C12.4316 4.66309 13.3154 5.3125 14.2432 6.17188L17.7002 9.42383L14.2285 12.6758C13.3105 13.5352 12.4316 14.1846 11.5918 14.624C10.752 15.0635 9.88281 15.2832 8.98438 15.2832C7.91016 15.2832 6.96777 15.0439 6.15723 14.5654C5.34668 14.0869 4.71191 13.4082 4.25293 12.5293C3.80371 11.6406 3.5791 10.6055 3.5791 9.42383ZM22.2998 9.42383L25.7568 6.17188C26.6846 5.3125 27.5684 4.66309 28.4082 4.22363C29.248 3.78418 30.1172 3.56445 31.0156 3.56445C32.0898 3.56445 33.0322 3.80371 33.8428 4.28223C34.6533 4.76074 35.2832 5.43945 35.7324 6.31836C36.1914 7.19727 36.4209 8.23242 36.4209 9.42383C36.4209 10.6055 36.1914 11.6406 35.7324 12.5293C35.2832 13.4082 34.6533 14.0869 33.8428 14.5654C33.0322 15.0439 32.0898 15.2832 31.0156 15.2832C30.1172 15.2832 29.248 15.0635 28.4082 14.624C27.5684 14.1846 26.6895 13.5352 25.7715 12.6758L22.2998 9.42383Z"})});var D=()=>i(53528),U=()=>i(991249),E=()=>i(595967),L=()=>i(118849),q=()=>i(704152);function F(e){const{verificationState:t,onChange:i,onCustomDateClick:r,showTitle:a,showUpsell:l}=e,p=(0,s().v3)(),g=(0,u().tz)(),v=p.device.isMobile,m=(0,n.useRef)(e.today),h=(0,o().IS)((e=>({title:{fontSize:v?c().J.UIRegular.mobile:c().J.UIRegular.desktop,color:e.regularTextColor},disabledTitle:{color:e.mediumTextColor},disabledCaption:{color:e.lightTextColor},optionsContainer:{width:"100%"},clockIconStyle:{width:14,marginLeft:0,marginTop:2},upsellContainer:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 12px",gap:8,border:`1px solid ${e.regularDividerColor}`,borderRadius:6,margin:"8px 8px 4px",height:36},upsellText:{fontSize:14,color:e.regularTextColor,fontWeight:c().Wy.medium,textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",flex:1},disabledButton:{color:e.lightTextColor}})),[v]),y="expired"===t.type||"none"===t.type?(0,S.jsx)(u().sA,{defaultMessage:"Verify page",id:"VerificationExpiryPicker.verify.header"}):(0,S.jsx)(u().sA,{defaultMessage:"Reverify page",id:"VerificationExpiryPicker.reverify.header"}),f="verified"===t.type&&t.isIndefinite,C="verified"===t.type&&!t.isIndefinite&&t.dateTimeRange.end,T=Boolean(l),w="verification_upsell_item_page_entrypoint",M=(0,n.useCallback)((()=>{(0,U().K)(p,{from:w,upsell:{type:"product",product:"business",limit:{type:"none"}}})}),[p,w]),A=(0,E().v)();return(0,S.jsxs)("div",{children:[!A&&l&&(0,S.jsxs)(q().A,{style:h.upsellContainer,onClick:M,children:[(0,S.jsx)("div",{style:h.upsellText,children:(0,S.jsx)(u().sA,{defaultMessage:"Upgrade to unlock",id:"VerificationExpiryPicker.upsellExperience"})}),(0,S.jsx)(L().A,{subscriptionTier:"business",analyticsName:w})]}),A&&(0,S.jsx)(E().c,{messageKey:"pageVerification",styleOverrides:{margin:"12px 12px 0px 12px"}}),(0,S.jsxs)(b().A,{title:a&&y,children:[d().yj.map((e=>{const t=C&&d().gj({start:m.current,end:C})===e;return(0,S.jsx)(x().A,{buttonStyle:T?h.disabledButton:void 0,disabled:T,focused:!1,icon:(0,R().P)(h.clockIconStyle),inline:!1,title:(0,S.jsx)("span",{style:T?h.disabledTitle:h.title,children:(0,S.jsx)(u().sA,{defaultMessage:"For {numDays} days",id:"VerificationExpiryMenu.preset.title",values:{numDays:e}})}),caption:g.formatMessage({defaultMessage:"Until {date}",id:"VerificationExpiryMenu.preset.subtitle"},{date:D().OH({dateTime:d().RD(e,m.current).end,intl:g,shortenDateAndRange:!0})}),captionStyle:T?h.disabledCaption:void 0,checkState:!!t,onClick:()=>{return t=e,void i({range:{start:m.current,end:m.current.plus({days:t})},option:`${t}d`});var t}},e)})),(0,S.jsx)(x().A,{buttonStyle:T?h.disabledButton:void 0,disabled:T,focused:!1,icon:B({width:14,marginLeft:0,marginTop:1}),inline:!1,title:(0,S.jsx)("span",{style:T?h.disabledTitle:h.title,children:(0,S.jsx)(u().sA,{defaultMessage:"Indefinitely",id:"VerificationExpiryPicker.option.indefinitely"})}),onClick:()=>i({option:"indefinite"}),checkState:f},"indefinite"),(0,S.jsx)(x().A,{buttonStyle:T?h.disabledButton:void 0,disabled:T,focused:!1,icon:(0,P().k)({width:14,marginLeft:0}),title:(0,S.jsx)("span",{style:T?h.disabledTitle:h.title,children:(0,S.jsx)(u().sA,{defaultMessage:"Pick a date",id:"VerificationExpiryPicker.option.customDate"})}),onClick:r},"custom")]})]})}var G=()=>i(8802),O=()=>i(880298);function W(e){const{verificationValue:t,getRecordModel:i,onChange:p,blockId:v,propertyName:f,onClose:x,showTitle:b,showRemoveVerificationButton:T,showVerificationFooter:w,showCurrentStatusHeader:M,showCustomHeader:A,customHeader:k,showUpsell:I,entrypoint:j}=e,R=(0,s().v3)(),P=(0,s().Y0)(),B=(0,u().tz)(),[D,U]=(0,n.useState)(!1),E=(0,n.useMemo)((()=>d().B2(t)),[t]),L="verified"===E.type,q=(0,n.useRef)(r().ah((0,a().P)())),W=(0,n.useRef)(r().ah((0,a().P)()).plus({days:1})),V=e=>{var t;const{range:i,option:n}=e,s=null===(t=R.currentUser)||void 0===t?void 0:t.id;if(!s)return;if(null!=i&&i.end&&i.end.toMillis()<W.current.toMillis())return;const o={table:l().oo,id:s},a=i?r().C6.toPersistedDateTimeRange(i):r().C6.toPersistedDateTime(q.current.toMillis()),d="none"===E.type?"add":"update";N(R,{action:d,verification_page_id:v,verification_expiry:i?i.end.toMillis():void 0}),p({value:[o,a],metadata:{action:d,entrypoint:j,expiration:n,expiration_date:i?i.end.toMillis():void 0}})},K=(0,o().IS)((e=>({footerStyle:{borderTop:`1px solid ${e.regularDividerColor}`},headerStyle:{padding:P.isMobile?10:7,paddingLeft:P.isMobile?20:7,background:P.isMobile?e.popoverBackground:e.tokenInputMenuItemBackground,display:"flex",alignItems:"center",borderBottom:`1px solid ${e.regularDividerColor}`}})),[P.isMobile]);let z={menuType:g().gu.Popup,footer:w&&"none"!==E.type&&!D&&(0,S.jsx)("div",{style:K.footerStyle,children:(0,S.jsx)(G().d,{lastVerifiedDate:L&&E.isIndefinite?E.startDateTime:E.dateTimeRange.start,getRecordModel:i,actorPointer:E.actorPointer})})};P.isMobile&&(z={...z,title:f,menuType:g().gu.Modal,right:(0,S.jsx)(h().DoneMenuText,{}),onClickRight:D?()=>U(!1):x});return(0,S.jsxs)(S.Fragment,{children:[A&&k&&!D?k:A&&D?(0,S.jsx)(y().o,{label:B.formatMessage({id:"verificationPropertyOverlay.verificationMenuHeader.pickDate",defaultMessage:"Pick a date"}),onClickBackButton:()=>U(!1),onClose:()=>x(),width:265,showBottomBorder:!1}):null,(0,S.jsx)(m().A,{...z,header:!D&&M&&"none"!==E.type&&(0,S.jsx)("div",{style:K.headerStyle,children:(0,S.jsx)(O().r,{verificationValue:t,fontSize:P.isMobile?c().J.UIRegular.mobile:void 0})}),children:D?(0,S.jsx)(_,{today:q.current,verificationState:E,onChange:e=>V(e),clearCustomDatePicker:()=>U(!1),addExtraTopPadding:!A}):(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(F,{today:q.current,verificationState:E,onChange:e=>V(e),onCustomDateClick:()=>U(!0),showTitle:b,showUpsell:I}),T&&(L||"expired"===E.type)&&(0,S.jsx)(C,{onClick:()=>{N(R,{action:"remove",verification_page_id:v}),p({value:void 0,metadata:{action:"remove",entrypoint:j}})}})]})})]})}function N(e,t){p().vd(e,"verification_update",t),v().default.logEvent("verification_update",t.action)}},980270:(e,t,i)=>{i.r(t),i.d(t,{handleEnterPress:()=>A,handleGuestInvite:()=>T,handleMemberInvite:()=>C,handleMemberRequest:()=>w,handlePopupClickWithEmail:()=>k,inviteToSpaceAsMembers:()=>M,showMessageForInviteComplete:()=>I});i(944114),i(898992),i(354520),i(430670),i(581454),i(737550),i(296540);var n=()=>i(842599),s=()=>i(857639),o=()=>i(206267),r=()=>i(68263),a=()=>i(959013),l=()=>i(319625),d=()=>i(229833),u=()=>i(966505),c=()=>i(449506),p=()=>i(579627),g=()=>i(542056),v=()=>i(436572),m=()=>i(250064),h=()=>i(535279),y=()=>i(731320),f=()=>i(134217),x=()=>i(10984),b=()=>i(475355),S=i(474848);async function C(e){const{environment:t,onInviteComplete:i,flowId:n,intl:o,spaceStore:r,invitedUsers:a,inviteTargetsStore:c,inviteOrigin:p,disable_invite_email:g}=e;let v={success:!1};try{v=await M({environment:t,spaceStore:r,invitedUsers:a,from:p,flowId:n,intl:o,inviteTargetsStore:c,disable_invite_email:g}),v.success?u().ke(t,{invited_user_count:Object.keys(v.invitedUsers).length,invite_flow_id:n,origin:p}):(u().N_(t,{invite_stage:"invite_member",invite_flow_id:n,error:v.error}),s().log({level:"error",from:"personPropertyInviteAction",type:"handleMemberInvite"}))}catch(m){const e=(0,l().A)(m);u().N_(t,{invite_stage:"invite_member",invite_flow_id:n,error:e}),s().log({level:"error",from:"personPropertyInviteAction",type:"handleMemberInvite",error:(0,d().n6)(m)})}finally{null==i||i(v)}}async function T(e){const{environment:t,blockStore:i,inviteTargetsStore:a,sudoModeStore:c,onInviteComplete:g,inviteOrigin:v,role:m,emailMessage:f,flowId:x}=e;let b={success:!1};try{if(b=await async function(e){const{environment:t,blockStore:i,sudoModeStore:s,inviteTargetsStore:a,role:l,inviteOrigin:d,emailMessage:u,onInviteStart:c}=e,g=e.flowId||o().JW();if(!(0,r().PW)(l))return{success:!1};const{tokenQuery:v,inviteTargets:m}=a.state;if((0,n().DT)(v.trim())&&0===m.length){const e={type:"newUser",value:{email:v.trim()},source:"email"};h().P4({target:e,inviteTargetsStore:a})||a.setState({inviteTargets:[...a.state.inviteTargets,e],tokenQuery:""})}const f=await y().hb(i,h().U1({inviteTargetsStore:a}));null==c||c();const x=await p().eP({environment:t,store:i,sudoModeStore:s,inviteTargets:f,inviteRole:l,isOnboarding:!1,invite:{inviteFlowId:g,inviteMessage:u,inviteOrigin:d}});return x}({environment:t,blockStore:i,sudoModeStore:c,inviteTargetsStore:a,role:m,emailMessage:f,inviteOrigin:v,flowId:x}),!b.success)return}catch(S){const e=(0,l().A)(S);u().N_(t,{invite_stage:"invite_guest",invite_flow_id:x,error:e}),s().log({level:"error",from:"personPropertyInviteAction",type:"handleGuestInvite",error:(0,d().n6)(S)})}finally{b.success&&u().oU(t,{invited_user_count:Object.keys(b.invitedUsers).length,origin:v,invite_flow_id:x}),null==g||g(b)}return b}async function w(e){const{environment:t,spaceStore:i,originId:n,originType:o,reasonMessage:r,intl:a,flowId:d,onInviteComplete:p,invitedUsers:g,inviteOrigin:h}=e,y=[];let f={success:!1};try{const e=Object.entries(g).map((e=>{let[s,a]=e;return c().callApi({eventName:"requestAccess",environment:t,data:{type:"actor-to-space",forActorId:a,spaceId:i.id,message:r,attributes:{origin_id:n,origin_type:o,origin_table:"block",add_permissions_on_approval:!1}}}).catch((()=>y.push([s,a])))}));await Promise.all(e),f={success:!0,invitedUsers:g,requestedUsers:{}}}catch(x){const e=(0,l().A)(x);return u().N_(t,{invite_stage:"request_member",invite_flow_id:d,error:e}),function(e,t){const i=Object.keys(t);if(0===i.length)return;v().D6({label:e.formatMessage({id:"contextual_invite.request_members_failure",defaultMessage:"Failed to request {users} to become members"},{users:(0,m().l)(i)})})}(a,g),s().log({level:"error",from:"personPropertyInviteAction",type:"handleMemberRequest",data:{miscDataToConvertToString:{inviteTargetEmailsWithErrors:y}}}),f}finally{f.success&&u().d6(t,{invited_user_count:Object.keys(f.invitedUsers).length,origin:h,invite_flow_id:d}),null==p||p(f)}return f}async function M(e){const{environment:t,spaceStore:i,from:n,invitedUsers:o,intl:r,flowId:a,onInviteStart:l,inviteTargetsStore:d,disable_invite_email:u}=e,c=function(e){const t=[];if(!e)return t;for(const[i,n]of Object.entries(e))t.push({type:"existingUser",value:{id:n,email:i,version:1}});return t}(o),g=function(e){return e.state.inviteTargets.filter((e=>"newUser"===e.type))}(d),h=[...c];for(const s of g){c.some((e=>e.value.email===s.value.email))||h.push(s)}const y=(0,x().AI)(),S=y&&(0,f().fk)(y)?"editor":e.inviteRole??"read_and_write";let C={success:!1};if(!i.isTeamsEnabled()){if(!(await b().oH({environment:t,flowId:a,trackCreateTeamComplete:!1})))return C}try{null==l||l(),C=await p().eP({environment:t,store:i,inviteTargets:h,inviteRole:S,isOnboarding:!1,invite:{inviteOrigin:n,inviteFlowId:a,disable_invite_email:u}})}catch(T){return function(e,t){0!==t.length&&v().D6({label:e.formatMessage({id:"contextual_invite.contextual_invite_failure",defaultMessage:"{userCount, plural, one {Failed to invite {users} as member} other {Failed to invite {users} as members}}"},{users:(0,m().l)(t.flatMap((e=>e.value.email||[]))),userCount:t.length})})}(r,h),s().log({level:"error",from:"contextualInviteHelpers",type:"inviteMembers.inviteTargets",data:{miscDataToConvertToString:{usersToInviteAsMembers:h}}}),C}return C}async function A(e){const{environment:t,inviteTargetsStore:i,allowShowEmptyError:s,personPropertyInviteStore:o}=e,r=i.state.tokenQuery;if(""===r)return void(0===i.state.inviteTargets.length&&s&&o.setState({...o.state,showEmptyError:!0}));const a=(0,n().C3)(r),l=await g().Ah(t,a);let d=[];0===l.length&&(d=[{type:"invalidUser",value:{text:r}}]);const u=l.filter((e=>!h().P4({inviteTargetsStore:i,target:e}))),c=[...i.state.inviteTargets,...u,...d];i.setState({...i.state,inviteTargets:c,tokenQuery:""})}function k(e){const{email:t,inviteTargetsStore:i}=e,n={type:"newUser",value:{email:t},source:"email"},s=[...i.state.inviteTargets];h().P4({inviteTargetsStore:i,target:n})||s.push(n),i.setState({...i.state,inviteTargets:s})}function I(e){const{success:t,invitedUserEmails:i,isRequestMember:n}=e;t?0!==i.length&&(n?v().D6({label:(0,S.jsx)(a().sA,{id:"shareMenu.inviteSuccess.snackbarMessage.sendMemberRequest",defaultMessage:"Successfully sent request to admin to invite {users}",values:{users:(0,m().l)(i)}})}):v().D6({label:(0,S.jsx)(a().sA,{id:"shareMenu.inviteSuccess.snackbarMessage",defaultMessage:"Successfully invited {users}",values:{users:(0,m().l)(i)}})})):v().D6({label:(0,S.jsx)(a().sA,{id:"shareMenu.inviteFailure.snackbarMessage",defaultMessage:"Failed to invite {users}",values:{users:(0,m().l)(i)}})})}}}]);