"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[89109],{7667:(e,t,n)=>{n.d(t,{A:()=>y});n(898992),n(737550),n(296540);var o=()=>n(484714),i=()=>n(56366),r=()=>n(959013),a=()=>n(534177),l=()=>n(901389),s=()=>n(317909),u=()=>n(254497),p=()=>n(312296),d=()=>n(519839),c=()=>n(175116),m=n(474848);function y(){const e=(0,c().Ks)(),t=(0,o().v3)(),n=(0,i().K8)((()=>null==e?void 0:e.settingsStore),[e]);return function(o){if(!n||!o||!e)return;const i=e.collectionStore();if((0,a().O9)(i)){const e=d().KA({deletedSchema:i.getDeletedSchema(),property:o});if(e){var c;if("verification"===(null===(c=i.getDeletedSchema()[o])||void 0===c?void 0:c.type)){const e=i.getSchema(),t=Object.keys(e).some((t=>{var n;return"verification"===(null===(n=e[t])||void 0===n?void 0:n.type)}));if(t)return void l().ui({message:(0,m.jsx)(r().sA,{id:"deletedPropertyMenu.cannotRestoreDuplicateProperty.modal.verification",defaultMessage:"You can only have one verification property."}),showCancel:!1,keepFocus:!0,items:[{label:(0,m.jsx)(r().sA,{id:"deletedPropertyMenu.cannotRestoreDuplicateProperty.modal.dismissButton",defaultMessage:"Dismiss"}),onAccept:()=>{}}]})}s().createAndCommit({userAction:"deletedPropertyMenu.handleRestoreDeletedPropertyClick",environment:t,canUndo:!0,perform:n=>{(0,p().F)({environment:t,collectionStore:i,update:e.updateSchema,transaction:n}),(0,u().E)({collectionStore:i,update:e.updateDeletedSchema,transaction:n})}})}}}}},141768:(e,t,n)=>{n.d(t,{YH:()=>s,bi:()=>a});n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(803949),n(581454),n(908872);var o=()=>n(919709),i=()=>n(496603),r=()=>n(713972);function a(e){let t="";const n=document.createElement("div");n.innerHTML=e;const o=r().zn(n);for(const r of o){const e=i().ih(r.data);if(null!==r.parentElement&&r.parentElement!==n){t+=`<span class="${l({parent:r.parentElement,root:n}).join(" ")}">${e}</span>`}else t+=e}return t}function l(e){const{parent:t,root:n}=e,o=new Set;let i=t;for(;i&&i!==n;)i.classList.forEach((e=>{o.add(e)})),i=i.parentElement??void 0;return Array.from(o)}function s(e,t){const n={text:u(e),syntax:u(t)},i=function(e){let t=0;return e.reduce(((e,n)=>(e.push([t,n]),t+=n,e)),[])}(function(e,t){const n=e.slice(),o=t.slice(),i=[];let r=0,a=0;for(;r<n.length&&a<o.length;){const e=n[r],t=o[a];e===t?(i.push(e),r+=1,a+=1):e<t?(i.push(e),r+=1,o[a]-=e):(i.push(t),n[r]-=t,a+=1)}return i}(n.text,n.syntax)),r={text:0,syntax:0},a={text:0,syntax:0},l=[],s=e.map(o().N8A).join("");for(const[o,u]of i){const e=o+u,i=t[r.syntax],d={value:s.substring(o,e),textTokenIndex:r.text,classNames:(p=i,p&&p[1])};l.push(d);const c=n.text[r.text],m=n.syntax[r.syntax];e>=a.text+c&&(r.text+=1,a.text+=c),e>=a.syntax+m&&(r.syntax+=1,a.syntax+=m)}var p;return l}function u(e){return e.map((e=>e[0].length))}},274609:(e,t,n)=>{n.d(t,{L:()=>i});n(296540);var o=n(474848);const i=(0,n(340498).wt)("historyBack",{viewBox:"0 0 14 14",svg:(0,o.jsx)("polygon",{points:"2.85893 7.74676 8.05608 12.9439 7 14 0.528042 7.52804 0 7 0.528042 6.47196 7 0 8.05608 1.05608 2.85893 6.25324 14 6.25324 14 7.74676"})})},509144:(e,t,n)=>{n.d(t,{_:()=>g});n(581454);var o=n(296540),i=()=>n(416504),r=()=>n(379632),a=()=>n(919709),l=()=>n(983650),s=()=>n(496603),u=()=>n(780054),p=()=>n(267419),d=()=>n(713972),c=()=>n(972435),m=()=>n(141768),y=()=>n(508496),f=()=>n(53137),x=n(474848);function g(e){const{currentUserId:t,errorRanges:n,getPublicBaseUrlForPage:d,isAndroid:g,isMobileNative:h,isSafariOrIOS:b,isWindows:k,parentSpaceId:C,Prism:I,store:S,theme:T,valueTypes:P,textValue:M}=e,A=a().q4_(M),F="notion",w=I.languages[F],E=document.createElement("div"),j=I.highlight(A,w,F);E.innerHTML=m().bi(j);const D=s().oE(Array.from(E.childNodes).map(v));let B=M;for(const o of n)B=a().Mwp({annotation:[a().Ifu.FormulaError],selection:o,textValue:B});const R=function(e){let{syntaxTokens:t,textValue:n,store:o,parentSpaceId:r,valueTypes:s,theme:d,isAndroid:g,isSafariOrIOS:v,isWindows:h,isMobileNative:b,currentUserId:k,getPublicBaseUrlForPage:C}=e;const I=m().YH(n,t),S=n.map(a().uPN).map(((e,t)=>l().sT({annotations:e,theme:d,getRecordModel:o.getRecordModel,spaceId:r})));return I.map(((e,t)=>{const m=n[e.textTokenIndex],I=S[e.textTokenIndex];return a().qXl(m)?(0,l().Au)({args:{textValue:{value:n,spaceId:r},getRecordModel:o.getRecordModel,getRecordRole:o.getRecordRole,disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disableSuggestionAnnotations:!1,disableLinks:!1,userTimeZone:(0,i().P)(),disabled:!1,isAndroid:g,isSafariOrIOS:v,isWindows:h,showEmojiInline:h,emojiType:"raw",highlightDiscussionId:void 0,theme:d,intl:c().A.getIntl(),renderedPageBlockId:void 0,parentBlockId:void 0,katex:void 0,isClient:!0,baseUrl:u().A.domainBaseUrl,publicDomainName:u().A.publicDomainName,currentUserId:k,getPublicBaseUrlForPage:C,externalIntegrations:f().A.integrations.state,formulaValueTypes:s,emojiData:p().A.state,isMobileNative:b,isMobileNativeExternalLinkFixEnabled:y().default.checkGate({gateName:"mobile_native_external_link_fix"}),displayInUserTimezone:!0},style:I.style,classNames:I.classNames,index:t,token:m,tokenValue:a().N8A(m),tokenAnnotations:a().uPN(m)}):(0,x.jsx)("span",{className:[e.classNames||"",...I.classNames].join(" "),style:I.style,"data-token-index":e.textTokenIndex,children:e.value},t)}))}({store:S,parentSpaceId:C,valueTypes:P,syntaxTokens:s().oE(D),textValue:M,theme:T,isAndroid:g,isSafariOrIOS:b,isWindows:k,isMobileNative:h,getPublicBaseUrlForPage:d,currentUserId:t}),Y=(0,x.jsxs)(o.Fragment,{children:[R,(0,x.jsx)("span",{children:"\n"})]});return r().A.renderToStaticMarkup(Y)}function v(e){return d().KH(e)?[e.data]:d().vq(e)?[e.textContent||"",e.className]:void 0}},633904:(e,t,n)=>{n.d(t,{l:()=>v,t:()=>h});n(16280);var o=n(296540),i=()=>n(484714),r=()=>n(56366),a=()=>n(912720),l=()=>n(534177),s=()=>n(317909),u=(n(898992),n(737550),()=>n(199378)),p=()=>n(496603),d=()=>n(630116);function c(e,t){var n,o;const i=null==e?void 0:e.getModel(),r=null==t?void 0:t.getModel();if(!t||!r)return!0;if(i&&(null===(n=i.getProperties())||void 0===n?void 0:n.name)!==(null===(o=r.getProperties())||void 0===o?void 0:o.name))return!0;return!(!i||i.getStatus()===r.getStatus())||(!!function(e,t){const n=null==e?void 0:e.getModel(),o=t.getModel();if(!o)return!0;if((0,l().O9)(n)){if(n.isEventType()&&o.isEventType()){const e=n.getEventConfiguration(),t=o.getEventConfiguration();return!(0,p().n4)(e,t)}if(n.isRecurrenceType()&&o.isRecurrenceType()){const e=n.getRecurrence(),t=o.getRecurrence();return!(0,p().n4)(e,t)}return!n.isButtonType()||!o.isButtonType()}if(o.isEventType()){const e=o.getEventConfiguration();return!1!==e.pagesAdded||"none"!==e.pagePropertiesEdited.type}if(o.isRecurrenceType())return!0;if(o.isButtonType())return!1;(0,l().HB)(o)}(e,t)||!!function(e,t){const n=t.getSpaceId();if(!n)return!1;if((0,l().O9)(e)){const o=e.getActionIds(),i=t.getActionIds();return o.length!==i.length||!(0,p().n4)(o,i)||o.some((o=>{const i={id:o,spaceId:n,table:u().SC},r=d().bx.createChildStore(e,i).getModel(),a=d().bx.createChildStore(t,i).getModel();return!(0,l().O9)(r)||!(0,l().O9)(a)||!(0,p().n4)(r.getConfig(),a.getConfig())}))}return t.getActionIds().length>0}(e,t))}var m=()=>n(186445),y=()=>n(841696),f=()=>n(246125),x=()=>n(6731),g=()=>n(351360);function v(e){const t=new(y().Z)({deadlockTimeoutMs:s().DEADLOCK_WARNING_TIMEOUT_MS});return{performResult:e.perform(t),serverCommitResult:Promise.resolve(void 0)}}function h(e){const{automationId:t,spaceId:n,defaultValue:u,persist:p}=e,y=(0,i().v3)(),v=(0,r().K8)((()=>{var e;return null===(e=g().default.state.currentUserStore)||void 0===e?void 0:e.userId}),[]),h=(0,o.useMemo)((()=>{if(t&&n)return{id:t,table:a().yB,spaceId:n}}),[t,n]),b=(0,f().l)("useUnpersistedAutomationStore",{cacheFallback:y.defaultRecordCache.inMemoryRecordCache,isTemporaryData:!0}),k=(0,o.useMemo)((()=>{if(!h)return;const e=b.getEntry({pointer:h,userId:v});if(!(0,l().O9)(e)&&v){if(!u)throw new Error("create is true but no defaultValue provided");b.setRecord({pointer:h,userId:v},{role:"editor",value:u})}return new(d().dn)(y,h,{inMemoryRecordCache:b})}),[u,y,h,b,v]),C=(0,r().K8)((()=>{const e=m().ao();if(h&&e)return d().dn.createChildStore(e,h)}),[h]),I=p?C:k,S=(0,r().K8)((()=>!p&&c(C,k)),[p,C,k]),{createAndCommit:T}=(0,x().D)({unpersistedInMemoryRecordCache:b}),P=(0,o.useCallback)((e=>p?s().createAndCommit({...e,canUndo:!0,environment:y}):T(e)),[T,y,p]);return{maybePersistedTransactionActions:{createAndCommit:P},maybePersistedAutomationStore:I,hasUnpersistedChanges:S}}},833682:(e,t,n)=>{n.d(t,{v:()=>Pt});n(944114),n(898992),n(354520),n(803949),n(581454);var o=n(296540),i=()=>n(484714),r=()=>n(56366),a=()=>n(401497),l=()=>n(563015),s=()=>n(106714),u=()=>n(977345),p=()=>n(416504),d=()=>n(591779),c=()=>n(450648),m=()=>n(919709),y=()=>n(959013),f=()=>n(496603),x=()=>n(973647),g=()=>n(534177),v=()=>n(284371),h=()=>n(884107),b=()=>n(725614),k=()=>n(862292),C=()=>n(989423),I=()=>n(847743),S=()=>n(231722),T=()=>n(645873),P=()=>n(351360),M=()=>n(24157),A=()=>n(164891),F=()=>n(545805),w=()=>n(206267),E=()=>n(386164),j=()=>n(532659),D=()=>n(449506),B=()=>n(901389),R=()=>n(606952),Y=()=>n(317909);var N=()=>n(938987),H=()=>n(84817),_=()=>n(704152),L=()=>n(805751),V=()=>n(623580),U=()=>n(554509),K=n(474848);const z=o.memo((function(e){const{formulaAssistantStore:t,onStop:n,onSubmit:i}=e,l=(0,y().tz)(),{prompt:s,inputMode:u}=(0,r().K8)((()=>{const{state:e}=t;return{prompt:e.prompt,inputMode:e.inputMode}}),[t]),p=(0,o.useCallback)((()=>{i(t.state.prompt)}),[t,i]),d=(0,o.useCallback)((e=>{t.update((t=>({...t,prompt:e})))}),[t]),c=(0,a().IS)((e=>({icon:{height:16,width:16,fill:e.icon.primary},wrapper:{borderTop:`1px solid ${e.stroke.secondary}`,background:e.popoverBackground}})),[]);return(0,K.jsx)(L().A,{capture:!0,debugName:"FormulaAssistantInput",priority:1,children:(0,K.jsxs)(H().Y1,{direction:"horizontal",align:"top-left",gap:6,padding:"9px 12px",style:c.wrapper,children:[(0,K.jsx)(H().Y1,{width:20,height:28,align:"center",children:(0,K.jsx)(N().iB,{})}),(0,K.jsx)(H().Y1,{width:"fill",children:"busy"===u?(0,K.jsx)($,{}):(0,K.jsx)(U().D,{styleName:"Body-14px/Regular",children:(0,K.jsx)(L().A,{debugName:"FormulaAssistantInput_PromptInput",capture:!0,allowMenuList:!1,allowEsc:!0,children:(0,K.jsx)(V().A,{format:V().C.Transparent,placeholder:l.formatMessage(q(u)),selectAll:!1,value:s,textarea:!0,textareaSubmitOnEnter:!0,autosize:!0,style:{minHeight:28,paddingTop:5,paddingBottom:3},onSubmit:e=>{s&&(e.stopPropagation(),p())},onChange:e=>{d(e.target.value)},focusInitial:!0})})})}),"busy"===u?(0,K.jsx)(O,{onStop:n}):(0,K.jsx)(W,{onSubmit:p,isEnabled:s.length>0})]})})}));function O(e){const{onStop:t}=e,n=(0,y().tz)(),{isPhone:o}=(0,i().Y0)(),r=(0,a().IS)((e=>({lightweightButton:{display:"flex",alignItems:"baseline",justifyContent:"center",fontSize:14,padding:"5px 8px",borderRadius:4,color:e.mediumTextColor,height:32,marginTop:2},keyboardShortcut:{textTransform:"uppercase",fontWeight:500,fontSize:11,marginLeft:6,color:e.lightTextColor,display:o?"none":void 0}})),[o]);return(0,K.jsx)(F().A,{debugName:"FormulaAssistantInput_StopButton",capture:!0,onEnter:t,onEsc:t,priority:1,children:(0,K.jsx)(H().Y1,{width:"hug",height:28,align:"center",children:(0,K.jsxs)(_().A,{style:r.lightweightButton,onClick:t,children:[n.formatMessage(G.cancel),(0,K.jsx)("span",{style:r.keyboardShortcut,children:n.formatMessage(G.cancelShortcut)})]})})})}function W(e){const{isEnabled:t,onSubmit:o}=e;return(0,K.jsx)(H().Y1,{width:"hug",height:28,align:"center",children:(0,K.jsx)(n(247345).J,{onSubmit:o,canSend:t})})}function $(){const e=(0,y().tz)();return(0,K.jsxs)(H().Y1,{direction:"horizontal",gap:6,height:28,align:"center-left",children:[(0,K.jsx)(U().D,{styleName:"Body-14px/Regular",colorName:"secondary",children:e.formatMessage(G.assistantIsBusy)}),(0,K.jsx)(n(135221).A,{isTriColored:!0})]})}function q(e){switch(e){case"initial":return G.initialPlaceholder;case"followUp":case"busy":return G.subsequentPlaceholder;default:(0,g().HB)(e)}}const G=(0,y().YK)({cancel:{id:"formulaAssistantInput.cancel",defaultMessage:"Cancel"},cancelShortcut:{id:"formulaAssistantInput.cancelShortcut",defaultMessage:"esc"},initialPlaceholder:{id:"formulaAssistantInput.initialPlaceholder",defaultMessage:"What do you want the formula to do?"},subsequentPlaceholder:{id:"formulaAssistantInput.subsequentPlaceholder",defaultMessage:"What do you want to do next?"},assistantIsBusy:{id:"formulaAssistantInput.assistantIsBusy",defaultMessage:"Notion AI is writing"}});class Q extends(()=>n(757695))().default{constructor(){super(...arguments),this.hideAssistant=()=>{this.update((e=>({...e,isAssistantVisible:!1})))},this.toggleAssistantVisible=()=>{this.update((e=>({...e,isAssistantVisible:!e.isAssistantVisible})))},this.didBeginRequest=()=>{this.update((e=>({...e,inputMode:"busy"})))},this.didFinishRequest=()=>{this.update((e=>({...e,prompt:"",inputMode:"followUp"})))}}getInitialState(){return{id:w().JW(),inputMode:"initial",isAssistantVisible:!1,prompt:""}}}var J=()=>n(743176),Z=()=>n(247331),X=()=>n(145076),ee=()=>n(307663);const te={true:{name:"true",type:{type:"checkbox"},description:X().Q$.true,examples:[{input:"true"},{input:[(0,ee().Py)("Checked"),[" == true"]]}]},false:{name:"false",type:{type:"checkbox"},description:X().Q$.false,examples:[{input:"false"},{input:[(0,ee().Py)("Checked"),[" == false"]]}]},and:{name:"and",type:{type:"checkbox"},description:X().Q$.and,examples:[{input:"3 > 2 and 2 > 3",output:"false"},{input:[(0,ee().Py)("Naughty"),[" && "],(0,ee().Py)("Nice")]}]},or:{name:"or",type:{type:"checkbox"},description:X().Q$.or,examples:[{input:"3 > 2 or 2 > 3",output:"true"},{input:[(0,ee().Py)("Naughty"),[" || "],(0,ee().Py)("Nice")]}]},not:{name:"not",type:{type:"checkbox"},description:X().Q$.not,examples:[{input:"not true",output:"false"},{input:"not (2 > 3)",output:"true"},{input:[["!"],(0,ee().Py)("Checked")]}]},"+":{name:"+",type:{type:"number"},description:X().Q$["+"],examples:[{input:"3 + 2",output:"5"},{input:"add(-1, 2)",output:"1"}]},"-":{name:"-",type:{type:"number"},description:X().Q$["-"],examples:[{input:"3 - 2",output:"1"},{input:"subtract(-1, 2)",output:"-3"}]},"*":{name:"*",type:{type:"number"},description:X().Q$["*"],examples:[{input:"3 * 2",output:"6"},{input:"multiply(-1, 2)",output:"-2"}]},"/":{name:"/",type:{type:"number"},description:X().Q$["/"],examples:[{input:"3 / 2",output:"1.5"},{input:"divide(-1, 2)",output:"-0.5"}]},"%":{name:"%",type:{type:"number"},description:X().Q$["%"],examples:[{input:"3 % 2",output:"1"},{input:"mod(-1, 2)",output:"-1"}]},"^":{name:"^",type:{type:"number"},description:X().Q$["^"],examples:[{input:"3 ^ 2",output:"9"},{input:"pow(-1, 2)",output:"1"}]},"==":{name:"==",type:{type:"checkbox"},description:X().Q$["=="],examples:[{input:"3 == 2",output:"false"},{input:'equal("A", "A")',output:"true"}]},"!=":{name:"!=",type:{type:"checkbox"},description:X().Q$["!="],examples:[{input:"3 != 2",output:"true"},{input:'unequal("A", "A")',output:"false"}]},">":{name:">",type:{type:"checkbox"},description:X().Q$[">"],examples:[{input:"3 > 2",output:"true"},{input:'now() > parseDate("2040-01-01")',output:"false"}]},"<":{name:"<",type:{type:"checkbox"},description:X().Q$["<"],examples:[{input:"3 < 2",output:"false"},{input:'now() < parseDate("2040-01-01")',output:"true"}]},">=":{name:">=",type:{type:"checkbox"},description:X().Q$[">="],examples:[{input:"3 >= 2",output:"true"},{input:'now() >= parseDate("2040-01-01")',output:"false"}]},"<=":{name:"<=",type:{type:"checkbox"},description:X().Q$["<="],examples:[{input:"3 <= 2",output:"false"},{input:'now() <= parseDate("2040-01-01")',output:"true"}]}};var ne=()=>n(972435),oe=()=>n(722872),ie=()=>n(970585),re=()=>n(736767),ae=()=>n(760217),le=()=>n(406699),se=()=>n(928600),ue=()=>n(939740),pe=()=>n(89924),de=()=>n(67657);const ce=(0,y().YK)({property:{id:"formula2Input.propertyHelper.descriptionGeneric",defaultMessage:"Database property."},titlePropertyDescription:{id:"formulaLibrary.property.title.description",defaultMessage:"Title property."},textPropertyDescription:{id:"formulaLibrary.property.text.description",defaultMessage:"Text property."},urlPropertyDescription:{id:"formulaLibrary.property.url.description",defaultMessage:"URL property."},emailPropertyDescription:{id:"formulaLibrary.property.email.description",defaultMessage:"Email property."},phoneNumberPropertyDescription:{id:"formulaLibrary.property.phoneNumber.description",defaultMessage:"Phone number property."},selectPropertyDescription:{id:"formulaLibrary.property.select.description",defaultMessage:"Select property."},multiSelectPropertyDescription:{id:"formulaLibrary.property.multiSelect.description",defaultMessage:"Multi-select property, list."},statusPropertyDescription:{id:"formulaLibrary.property.status.description",defaultMessage:"Status property."},checkboxPropertyDescription:{id:"formulaLibrary.property.checkbox.description",defaultMessage:"Checkbox property."},datePropertyDescription:{id:"formulaLibrary.property.date.description",defaultMessage:"Date property."},personPropertyDescription:{id:"formulaLibrary.property.person.description",defaultMessage:"Person property, list."},relationPropertyDescription:{id:"formulaLibrary.property.relation.description",defaultMessage:"Relation property, list."},rollupPropertyDescriptionList:{id:"formulaLibrary.property.rollup.description",defaultMessage:"Rollup property, list."},rollupPropertyDescription:{id:"formulaLibrary.property.rollup.descriptionWithList",defaultMessage:"Rollup property."},numberPropertyDescription:{id:"formulaLibrary.property.number.description",defaultMessage:"Number property."},formulaPropertyDescription:{id:"formulaLibrary.property.formula.description",defaultMessage:"Formula property."},formulaPropertyDescriptionList:{id:"formulaLibrary.property.formula.descriptionWithList",defaultMessage:"Formula property, list."},createdTimePropertyDescription:{id:"formulaLibrary.property.createdTime.description",defaultMessage:"Created time property."},lastEditedTimePropertyDescription:{id:"formulaLibrary.property.lastEditedTime.description",defaultMessage:"Last edited time property."},createdByPropertyDescription:{id:"formulaLibrary.property.createdBy.description",defaultMessage:"Created by property."},lastEditedByPropertyDescription:{id:"formulaLibrary.property.lastEditedBy.description",defaultMessage:"Last edited by property."},filePropertyDescription:{id:"formulaLibrary.property.file.description",defaultMessage:"File property, list."},autoincrementIdDescription:{id:"formulaLibrary.property.autoincrementId.description",defaultMessage:"ID property."}}),me={title:{name:"title",type:{type:"text"},description:ce.titlePropertyDescription,examples:e=>e?[{input:[(0,ee().Y2)(e)],isCopyable:!0},{input:[(0,ee().Y2)(e),['.style("b")']],isCopyable:!0},{input:[(0,ee().Py)("Full Name"),['.split(" ").at(0)']]}]:[{input:[(0,ee().Py)("Title")]},{input:[(0,ee().Py)("Title"),['.style("b")']]},{input:[(0,ee().Py)("Name"),['.split(" ").at(0)']]}]},text:{name:"text",type:{type:"text"},description:ce.textPropertyDescription,examples:e=>e?[{input:[(0,ee().Y2)(e)],isCopyable:!0},{input:[["upper("],(0,ee().Y2)(e),[")"]],isCopyable:!0},{input:[(0,ee().Y2)(e),['.style("b", "red")']],isCopyable:!0}]:[{input:[["upper("],(0,ee().Py)("Name"),[")"]]},{input:[(0,ee().Py)("Name"),['.style("b", "red")']]}]},url:{name:"url",type:{type:"text"},description:ce.urlPropertyDescription,examples:e=>e?[{input:[(0,ee().Y2)(e)],isCopyable:!0},{input:[(0,ee().Y2)(e),[' ? link("Link", '],(0,ee().Y2)(e),[').style("green") : ""']],isCopyable:!0}]:[{input:[(0,ee().Py)("URL"),[' ? link("Link", '],(0,ee().Py)("URL"),[').style("green") : ""']]}]},email:{name:"email",type:{type:"text"},description:ce.emailPropertyDescription,examples:e=>e?[{input:[(0,ee().Y2)(e)],isCopyable:!0},{input:[(0,ee().Y2)(e),[' ? link("Email", "mailto:" + '],(0,ee().Y2)(e),[').style("blue") : ""']],isCopyable:!0}]:[{input:[(0,ee().Py)("Email"),[' ? link("Email", "mailto:" + '],(0,ee().Py)("Email"),[').style("blue") : ""']]}]},phone_number:{name:"phone_number",type:{type:"text"},description:ce.phoneNumberPropertyDescription,examples:e=>e?[{input:[(0,ee().Y2)(e)],isCopyable:!0},{input:[(0,ee().Y2)(e),[' ? link("Call", "tel:" + '],(0,ee().Y2)(e),[').style("blue") : ""']],isCopyable:!0}]:[{input:[(0,ee().Py)("Email"),[' ? link("Call", "tel:" + '],(0,ee().Py)("Email"),[').style("blue") : ""']]}]},number:{name:"number",type:{type:"number"},description:ce.numberPropertyDescription,examples:e=>e?[{input:[(0,ee().Y2)(e)],isCopyable:!0},{input:[(0,ee().Y2)(e),[" / 2"]],isCopyable:!0},{input:[["pi() * "],(0,ee().Y2)(e),[" ^ 2"]],isCopyable:!0}]:[{input:[(0,ee().Py)("Cost"),[" / "],(0,ee().Py)("Total Units")]},{input:[["pi() * "],(0,ee().Py)("Radius"),[" ^ 2"]]}]},select:{name:"select",type:{type:"text"},description:ce.selectPropertyDescription,examples:e=>{const t=[{input:[(0,ee().Py)("Priority"),[' == "High"']]},{input:[['["Feature", "Bug"].includes('],(0,ee().Py)("Task Type"),[")"]]}];return e&&t.unshift({input:[(0,ee().Y2)(e)],isCopyable:!0}),t}},multi_select:{name:"select",type:{type:"array",of:{type:"text"}},description:ce.multiSelectPropertyDescription,examples:e=>e?[{input:[(0,ee().Y2)(e)],isCopyable:!0},{input:[(0,ee().Y2)(e),[".length()"]],isCopyable:!0},{input:[(0,ee().Py)("Tags"),['.includes("Finance")']]}]:[{input:[(0,ee().Py)("Tags"),[".length()"]]},{input:[(0,ee().Py)("Tags"),['.includes("Finance")']]}]},status:{name:"status",type:{type:"text"},description:ce.statusPropertyDescription,examples:e=>"Status"===(null==e?void 0:e.name)?[{input:[(0,ee().Y2)(e)],isCopyable:!0},{input:[(0,ee().Y2)(e),[' == "Done"']],isCopyable:!0},{input:[['["Not started", "In progress"].includes('],(0,ee().Y2)(e),[")"]],isCopyable:!0}]:[{input:[(0,ee().Py)("Status"),[' == "Done"']]},{input:[['["Not started", "In progress"].includes('],(0,ee().Py)("Status"),[")"]]}]},checkbox:{name:"checkbox",type:{type:"checkbox"},description:ce.checkboxPropertyDescription,examples:e=>e?[{input:[(0,ee().Y2)(e)],isCopyable:!0},{input:[["not "],(0,ee().Y2)(e)],isCopyable:!0},{input:[(0,ee().Py)("Signed"),[" and "],(0,ee().Py)("Sealed"),[" and "],(0,ee().Py)("Delivered")]}]:[{input:[["not"],(0,ee().Py)("Done")]},{input:[(0,ee().Py)("Signed"),[" and "],(0,ee().Py)("Sealed"),[" and "],(0,ee().Py)("Delivered")]}]},date:{name:"date",type:{type:"date"},description:ce.datePropertyDescription,examples:e=>e?[{input:[(0,ee().Y2)(e)],isCopyable:!0},{input:[(0,ee().Y2)(e),[" > now()"]],isCopyable:!0},{input:[(0,ee().Y2)(e),['.dateAdd(1, "weeks")']],isCopyable:!0},{input:[["dateBetween("],(0,ee().Y2)(e),[', now(), "days")']],isCopyable:!0}]:[{input:[(0,ee().Py)("Due Date"),[" > now()"]]},{input:[["formatDate("],(0,ee().Py)("Date"),[', "YYYY/MM/DD HH:mm")']]},{input:[["dateBetween("],(0,ee().Py)("Birthday"),[', now(), "days")']]}]},person:{name:"person",type:{type:"array",of:{type:"text"}},description:ce.personPropertyDescription,examples:e=>e?[{input:[(0,ee().Y2)(e)],isCopyable:!0},{input:[(0,ee().Y2)(e),[".length()"]],isCopyable:!0},{input:[(0,ee().Y2)(e),[".at(0)"]],isCopyable:!0},{input:[(0,ee().Y2)(e),[".map(current.email())"]],isCopyable:!0},{input:[(0,ee().Y2)(e),['.some(current.name() == "Alice")']]}]:[{input:[(0,ee().Py)("Participants"),[".at(0)"]]},{input:[(0,ee().Py)("Participants"),[".length()"]]},{input:[(0,ee().Py)("Participants"),['.some(current.name() == "Alice")']]}]},relation:{name:"relation",type:{type:"array",of:{type:"block"}},description:ce.relationPropertyDescription,examples:e=>e?[{input:[(0,ee().Y2)(e)],isCopyable:!0},{input:[(0,ee().Y2)(e),[".length()"]],isCopyable:!0},{input:[(0,ee().Py)("Tasks"),[".filter(current."],(0,ee().Py)("Status"),[' != "Done")']]}]:[{input:[(0,ee().Py)("Tasks"),[".length()"]]},{input:[(0,ee().Py)("Tasks"),[".filter(current."],(0,ee().Py)("Status"),[' != "Done")']]}]},rollup:{name:"rollup",type:e=>{if("rollup"===(null==e?void 0:e.type)&&("show_unique"===e.aggregation||void 0===e.aggregation))return{type:"array",of:{type:"unknown"}};if(e&&"aggregation"in e&&void 0!==e.aggregation){return{type:(0,de().ou)((0,de().ZP)(e.aggregation))}}return{type:"unknown"}},description:e=>"rollup"!==(null==e?void 0:e.type)||"show_unique"!==e.aggregation&&void 0!==e.aggregation?ce.rollupPropertyDescription:ce.rollupPropertyDescriptionList,examples:(e,t)=>{let n;return n=!t||"rollup"!==(null==t?void 0:t.type)||"show_unique"!==t.aggregation&&void 0!==t.aggregation?[{input:[(0,ee().Py)("Average cost"),[" * 12"]]},{input:[(0,ee().Py)("Sum of customers"),[" > 100"]]}]:[void 0!==e?{input:[(0,ee().Y2)(e),[".length()"]],isCopyable:!0}:{input:[(0,ee().Py)("Purchases"),[".length()"]]},{input:[["sum("],(0,ee().Py)("Purchases"),[".map(current."],(0,ee().Py)("Cost"),["))"]]}],e&&n.unshift({input:[(0,ee().Y2)(e)],isCopyable:!0}),n}},file:{name:"file",type:{type:"array",of:{type:"text"}},description:ce.filePropertyDescription,examples:e=>e?[{input:[(0,ee().Y2)(e)],isCopyable:!0},{input:[(0,ee().Y2)(e),[".length()"]],isCopyable:!0},{input:[(0,ee().Y2)(e),['.filter(current.match(".pdf$"))']],isCopyable:!0},{input:[(0,ee().Y2)(e),['.map(link("File", current))']],isCopyable:!0}]:[{input:[(0,ee().Py)("Attachments"),[".length()"]]},{input:[(0,ee().Py)("Attachments"),['.filter(current.match(".pdf$"))']]},{input:[(0,ee().Py)("Attachments"),['.map(link("File", current))']]}]},formula:{name:"formula",type:e=>{var t,n,o;return e&&"formula2"in e&&null!==(t=e.formula2)&&void 0!==t&&null!==(t=t.result_type)&&void 0!==t&&t.type?e.formula2.result_type:e&&"formula"in e&&null!==(n=e.formula)&&void 0!==n&&n.result_type?{type:null===(o=e.formula)||void 0===o?void 0:o.result_type}:{type:"unknown"}},description:e=>{var t;return e&&"formula2"in e&&"array"===(null===(t=e.formula2)||void 0===t||null===(t=t.result_type)||void 0===t?void 0:t.type)?ce.formulaPropertyDescriptionList:ce.formulaPropertyDescription},examples:(e,t)=>{var n,o;let i={type:"unknown"};if(t&&"formula2"in t&&null!==(n=t.formula2)&&void 0!==n&&null!==(n=n.result_type)&&void 0!==n&&n.type)i=t.formula2.result_type;else if(t&&"formula"in t&&null!==(o=t.formula)&&void 0!==o&&o.result_type){var r;i={type:null===(r=t.formula)||void 0===r?void 0:r.result_type}}if(!e)return[];const a=[{input:[(0,ee().Y2)(e)],isCopyable:!0}];switch(i.type){case"array":switch(a.push({input:[(0,ee().Y2)(e),[".length()"]],isCopyable:!0}),i.of.type){case"text":a.push({input:[(0,ee().Y2)(e),['.join("\\n")']],isCopyable:!0});break;case"number":a.push({input:[(0,ee().Y2)(e),[".sum()"]],isCopyable:!0});break;case"date":a.push({input:[(0,ee().Y2)(e),['.map(dateBetween(now(), current, "days"))']],isCopyable:!0});break;case"person":a.push({input:[(0,ee().Y2)(e),[".map(current.name())"]],isCopyable:!0}),a.push({input:[(0,ee().Y2)(e),[".some(current.name() == 'Alice')"]],isCopyable:!0});break;case"checkbox":a.push({input:[(0,ee().Y2)(e),[".every(current == true)"]],isCopyable:!0});break;case"block":a.push({input:[(0,ee().Py)("Primary Tasks"),[".filter(current."],(0,ee().Py)("Status"),[' == "Done")']]})}break;case"number":a.push({input:[(0,ee().Y2)(e),[" * 2 > 100"]],isCopyable:!0});break;case"text":a.push({input:[(0,ee().Y2)(e),[".upper()"]],isCopyable:!0});break;case"date":a.push({input:[(0,ee().Y2)(e),[" > now()"]],isCopyable:!0});break;case"person":a.push({input:[(0,ee().Y2)(e),[".name()"]],isCopyable:!0});break;case"checkbox":a.push({input:[["not "],(0,ee().Y2)(e)],isCopyable:!0});break;case"block":a.push({input:[(0,ee().Y2)(e),[".map(current."],(0,ee().pC)(Z().FormulaTokenSupportedBlockSystemProperty.CreatedBy),[")"]]})}return a}},created_time:{name:"created_time",type:{type:"date"},description:ce.createdTimePropertyDescription,examples:e=>e?[{input:[(0,ee().Y2)(e)],isCopyable:!0},{input:[(0,ee().Y2)(e),['.dateAdd(1, "weeks")']],isCopyable:!0},{input:[(0,ee().Y2)(e),[' > dateSubtract(now(), 1, "years")']],isCopyable:!0}]:[{input:[(0,ee().pC)(Z().FormulaTokenSupportedBlockSystemProperty.CreatedTime),['.dateAdd(1, "weeks")']]},{input:[(0,ee().pC)(Z().FormulaTokenSupportedBlockSystemProperty.CreatedTime),[' > dateSubtract(now(), 1, "years")']]}]},last_edited_time:{name:"last_edited_time",type:{type:"date"},description:ce.lastEditedTimePropertyDescription,examples:e=>e?[{input:[(0,ee().Y2)(e)],isCopyable:!0},{input:[(0,ee().Y2)(e),['.dateAdd(1, "weeks")']],isCopyable:!0},{input:[(0,ee().Y2)(e),[' > dateSubtract(now(), 1, "month")']],isCopyable:!0}]:[{input:[(0,ee().pC)(Z().FormulaTokenSupportedBlockSystemProperty.LastEditedTime),['.dateAdd(1, "weeks")']]},{input:[(0,ee().pC)(Z().FormulaTokenSupportedBlockSystemProperty.LastEditedTime),[' > dateSubtract(now(), 1, "month")']]}]},created_by:{name:"created_by",type:{type:"person"},description:ce.createdByPropertyDescription,examples:e=>e?[{input:[(0,ee().Y2)(e)],isCopyable:!0},{input:[(0,ee().Y2)(e),[".name()"]],isCopyable:!0},{input:[(0,ee().Y2)(e),[".email()"]],isCopyable:!0}]:[{input:[(0,ee().pC)(Z().FormulaTokenSupportedBlockSystemProperty.CreatedBy),[".name()"]]},{input:[(0,ee().pC)(Z().FormulaTokenSupportedBlockSystemProperty.CreatedBy),[".email()"]]}]},last_edited_by:{name:"last_edited_by",type:{type:"person"},description:ce.lastEditedByPropertyDescription,examples:e=>e?[{input:[(0,ee().Y2)(e)],isCopyable:!0},{input:[(0,ee().Y2)(e),[".name()"]],isCopyable:!0},{input:[(0,ee().Y2)(e),[".email()"]],isCopyable:!0}]:[{input:[(0,ee().pC)(Z().FormulaTokenSupportedBlockSystemProperty.LastEditedBy),[".name()"]]},{input:[(0,ee().pC)(Z().FormulaTokenSupportedBlockSystemProperty.LastEditedBy),[".email()"]]}]},auto_increment_id:{name:"auto_increment_id",type:{type:"number"},description:ce.autoincrementIdDescription,examples:e=>e?[{input:[(0,ee().Y2)(e)],isCopyable:!0},{input:[(0,ee().Y2)(e),['.split("-").first() /* Prefix */']],isCopyable:!0},{input:[(0,ee().Y2)(e),['.split("-").last().toNumber() /* ID */']],isCopyable:!0}]:[{input:[(0,ee().Py)("ID Code")]},{input:[(0,ee().Py)("Task ID"),['.split("-").first() /* Prefix */']],output:'"TASK"'},{input:[(0,ee().Py)("Task ID"),['.split("-").last().toNumber() /* ID */']],output:"123"}]},button:null,location:null,last_visited_time:null,verification:null,geo_point:null},ye={text:{examples:e=>e?[{input:[(0,ee().HH)({id:e.id})]},{input:[["upper("],(0,ee().HH)({id:e.id}),[")"]]},{input:[(0,ee().HH)({id:e.id}),['.style("b", "red")']]}]:[]},number:{examples:e=>e?[{input:[(0,ee().HH)(e)],isCopyable:!0},{input:[(0,ee().HH)(e),[" / 2"]],isCopyable:!0},{input:[["pi() * "],(0,ee().HH)(e),[" ^ 2"]],isCopyable:!0}]:[]},checkbox:{examples:e=>e?[{input:[(0,ee().HH)(e)]},{input:[["not "],(0,ee().HH)(e)]}]:[]},date:{examples:e=>e?[{input:[(0,ee().HH)(e)]},{input:[(0,ee().HH)(e),[" > now()"]]},{input:[(0,ee().HH)(e),['.dateAdd(1, "weeks")']]},{input:[["dateBetween("],(0,ee().HH)(e),[', now(), "days")']]}]:[]},block:{examples:e=>e?[{input:[(0,ee().HH)(e)]},{input:[(0,ee().HH)(e),[".format()"]]},{input:[(0,ee().HH)(e),["."],(0,ee().pC)(Z().FormulaTokenSupportedBlockSystemProperty.CreatedBy)]}]:[]},person:{examples:e=>e?[{input:[(0,ee().HH)(e)]},{input:[(0,ee().HH)(e),[".email()"]]},{input:[(0,ee().HH)(e),['.name() == "Alice"']]}]:[]},array:{examples:e=>e?[{input:[(0,ee().HH)(e)]},{input:[(0,ee().HH)(e),[".length()"]]},{input:[(0,ee().HH)(e),[".at(0).format()"]]}]:[]},select:null,function:null,unknown:null};var fe=()=>n(925907),xe=()=>n(979004),ge=()=>n(983650),ve=()=>n(780054),he=()=>n(354584),be=()=>n(712030),ke=()=>n(267419),Ce=()=>n(713972),Ie=()=>n(141768),Se=()=>n(508496),Te=()=>n(285790);const Pe=o.memo((function(e){let{infoHelper:t,getRecordModel:n,style:o,typecheckContextValues:i}=e;const r=t;if(void 0===(null==r?void 0:r.kind))return null;switch(r.kind){case Z().FormulaEditorInfoCompletionKind.Token:return(0,K.jsx)(Fe,{completion:r,getRecordModel:n,style:o,typecheckContextValues:i});case Z().FormulaEditorInfoCompletionKind.LibraryFunction:{const e=!(null==t||!t.calledFromUnifiedFunctionProperty),i=function(e,t){if(t&&void 0!==e.syntax[1])return e.syntax[1];return e.syntax[0]}(r.libraryFunction,e),a=function(e,t){if(t&&void 0!==e.examples[1])return e.examples[1];return e.examples[0]}(r.libraryFunction,e),l=r.libraryFunction.returnType;return(0,K.jsx)(Ae,{icon:Le("function"==typeof l?l([]).type:l.type),name:i,description:ne().A.formatMessage(r.libraryFunction.description),examples:a.length>0?a.map(((e,t)=>(0,K.jsx)(Me,{example:e,getRecordModel:n},t))):void 0,style:o})}case Z().FormulaEditorInfoCompletionKind.Binding:var a;return r.text===Z().CURRENT_VALUE_NAME?(0,K.jsx)(Ae,{icon:Le(r.type.type),name:r.text,description:ne().A.formatMessage(Be.currentValueDescription),style:o}):r.text===Z().CURRENT_INDEX_NAME?(0,K.jsx)(Ae,{icon:Le(r.type.type),name:r.text,description:ne().A.formatMessage(Be.currentIndexDescription),style:o}):(0,K.jsx)(Ae,{icon:Le(r.type.type),name:r.text,description:ne().A.formatMessage("array"===(null==r||null===(a=r.type)||void 0===a?void 0:a.type)?Be.listVariableType:Be.variableType),style:o});case Z().FormulaEditorInfoCompletionKind.Builtin:{const e=te[r.builtin];return(0,K.jsx)(Ae,{icon:Le(e.type.type),name:e.name,description:ne().A.formatMessage(e.description),examples:e.examples.length>0?e.examples.map(((e,t)=>(0,K.jsx)(Me,{example:e,getRecordModel:n},t))):void 0,style:o})}default:return(0,g().HB)(r)}}));function Me(e){let{example:t,getRecordModel:n,typecheckContextValues:l}=e;const s=(0,T().fJ)(he().y),u=(0,be().Ol)(),d=(0,i().v3)(),{device:x}=d,g=(0,r().K8)((()=>{var e;return null===(e=P().default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),v=(0,a().DP)(),b=(0,y().tz)(),k=(0,ke()._)(),C=(0,r().K8)((()=>{var e;const o=document.createElement("div"),i="string"!=typeof t.input?m().q4_(t.input):t.input,r=(null===(e=s.value)||void 0===e?void 0:e.highlight(`${i}`,s.value.languages[xe().PrismLanguages.notion],xe().PrismLanguages.notion))??"";o.innerHTML=Ie().bi(r);const a=f().oE(Array.from(o.childNodes).map(je)),c="string"==typeof t.input?[[t.input],[" = "]]:t.input.concat([[" = "]]),y=Ie().YH(c,f().oE(a)),h=c.map(m().uPN).map(((e,t)=>ge().sT({annotations:e,theme:v,getRecordModel:n,spaceId:g})));return y.map(((e,t)=>{const o=h[e.textTokenIndex],i=c[e.textTokenIndex];return m().qXl(i)?(0,ge().Au)({args:{textValue:{value:c,spaceId:g},getRecordModel:n,getRecordRole:()=>{},disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disableSuggestionAnnotations:!1,disableLinks:!1,userTimeZone:(0,p().P)(),disabled:!1,isAndroid:x.isAndroid,isSafariOrIOS:x.isSafari||x.isIOS,isWindows:x.isWindows,showEmojiInline:x.isWindows,emojiType:u,highlightDiscussionId:void 0,theme:v,intl:b,renderedPageBlockId:void 0,parentBlockId:void 0,katex:void 0,isClient:!0,baseUrl:ve().A.domainBaseUrl,publicDomainName:ve().A.publicDomainName,currentUserId:d.currentUser.id,getPublicBaseUrlForPage:void 0,externalIntegrations:[],formulaValueTypes:l??[],emojiData:k,isMobileNative:x.isMobileNative,isMobileNativeExternalLinkFixEnabled:Se().default.checkGate({gateName:"mobile_native_external_link_fix"}),displayInUserTimezone:!0},style:o.style,classNames:o.classNames,index:t,token:i,tokenValue:m().N8A(i),tokenAnnotations:m().uPN(i)}):(0,K.jsx)("span",{className:[e.classNames||"",...o.classNames].join(" "),style:o.style,"data-token-index":e.textTokenIndex,children:e.value},t)}))}),[t.input,s.value,v,n,g,x.isAndroid,x.isSafari,x.isIOS,x.isWindows,x.isMobileNative,u,b,d.currentUser.id,l,k]),I=(0,r().K8)((()=>Array.isArray(t.output)?(0,ge().S5)({textValue:{value:t.output,spaceId:g},getRecordModel:n,getRecordRole:()=>{},disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disableSuggestionAnnotations:!1,disableLinks:!1,userTimeZone:(0,p().P)(),disabled:!1,isAndroid:x.isAndroid,isSafariOrIOS:x.isSafari||x.isIOS,isWindows:x.isWindows,showEmojiInline:x.isWindows,emojiType:u,theme:v,intl:b,katex:void 0,isClient:!0,baseUrl:ve().A.domainBaseUrl,publicDomainName:ve().A.publicDomainName,currentUserId:d.currentUser.id,getPublicBaseUrlForPage:void 0,externalIntegrations:[],formulaValueTypes:[],emojiData:k,isMobileNative:x.isMobileNative,isMobileNativeExternalLinkFixEnabled:Se().default.checkGate({gateName:"mobile_native_external_link_fix"}),displayInUserTimezone:!0}):t.output),[x.isAndroid,x.isIOS,x.isSafari,x.isWindows,x.isMobileNative,k,u,d.currentUser.id,t.output,n,b,g,v]),S=!1!==t.isCopyable&&("string"==typeof t.input||!0===t.isCopyable),M=(0,o.useCallback)((async()=>{if(S){const e=(Array.isArray(t.input)?(0,c().r4)({intl:b,textValue:t.input,getRecordModel:n,userTimeZone:(0,p().P)()}):t.input).replaceAll(/\/\*.*\*\//g,"").trim();(await h().R.clipboardActions.load()).copyString({stringValue:e,environment:d,copiedMessage:De.copiedExampleMessage})}}),[d,t.input,n,b,S]),A=(0,a().IS)((e=>({code:{fontFamily:"monospace",whiteSpaceCollapse:"preserve",fontSize:11,borderRadius:5,border:`1px solid ${e.stroke.secondary}`,margin:"0 -4px",padding:"0 6px",pointerEvents:"none",opacity:.95,display:"flex",flexDirection:"row",alignItems:"center",tabSize:2},left:{flexGrow:1,padding:"6px 0"},right:{alignSelf:"center"},copyButton:{height:22,width:22,pointerEvents:"auto"},copyButtonIcon:{height:12,width:12}})),[]);return(0,K.jsxs)("div",{style:A.code,children:[(0,K.jsxs)("div",{style:A.left,children:[(0,K.jsx)("div",{children:C}),I?(0,K.jsxs)("div",{children:["= ",I]}):null]}),S?(0,K.jsx)("div",{style:A.right,children:(0,K.jsx)(Te().A,{ariaLabel:b.formatMessage(De.copyToClipboard),onClick:M,icon:fe().n,style:A.copyButton,iconStyle:A.copyButtonIcon,disallowTabbing:!0})}):null]})}function Ae(e){let{name:t,icon:n,description:o,examples:i,style:r}=e;const l=(0,a().IS)((e=>({helper:{display:"flex",flexDirection:"column",fontSize:12,height:"auto",width:"100%",gap:8,overflow:"auto",textWrap:"wrap",...r},name:{fontSize:14,fontWeight:600,display:"flex",alignItems:"center"},description:{color:e.mediumTextColor},iconStyle:{height:14,width:14,fill:e.mediumIconColor,display:"inline",marginRight:6},divider:{borderColor:e.stroke.secondary},examples:{display:"flex",flexDirection:"column",gap:4}})),[r]);return(0,K.jsxs)("div",{style:l.helper,children:[(0,K.jsxs)("span",{style:l.name,children:[void 0!==n&&n(l.iconStyle),t]}),void 0!==o&&(0,K.jsx)("span",{style:l.description,children:o}),void 0!==i&&(0,K.jsx)("div",{style:l.examples,children:i})]})}function Fe(e){let{completion:t,getRecordModel:n,style:o,typecheckContextValues:i}=e;const{name:a,description:l,icon:s,examples:p}=(0,r().K8)((()=>{if(!n)return{};if(t.token.type===Z().FormulaTokenType.BlockProperty){var e;if((0,u().ix)(t.token))return{};if(Z().FormulaTokenSupportedBlockSystemPropertyList.includes(t.token.property)&&!t.token.collection){var o;const e=null===(o=Z().FormulaTokenSupportedBlockSystemPropertyToType[t.token.property])||void 0===o?void 0:o.type,i=e?J().Yp[e]:void 0,r=me[t.token.property],a="function"==typeof(null==r?void 0:r.description)?r.description():null==r?void 0:r.description,l=t.name??t.token.property;return{name:l,icon:i,description:a?ne().A.formatMessage(a):void 0,examples:null!==r?we(r,n,{collection:t.token.collection,property:t.token.property,name:l},{name:l,type:t.token.property}):void 0}}if(!t.token.collection)return{};const i=(0,u().Yi)(t.token.property),r=n(t.token.collection),a=null==r||null===(e=r.getNormalizedSchema())||void 0===e?void 0:e[i];if(!a)return{};const l=me[a.type];return l?{name:t.name,icon:J().Yp[a.type],description:ne().A.formatMessage("function"==typeof l.description?l.description(a):l.description),examples:we(l,n,{collection:t.token.collection,property:i,name:t.name},a)}:{}}if(t.token.type===Z().FormulaTokenType.ContextValue){const e=(0,u()._H)(i,(0,u().GH)(t.token.valueId));if(!e||e.kind!==Z().FormulaContextValueKind.ContextValue)return{};const o=e.type.type,r=ye[o];return{name:e.name,description:e.description??e.tooltipName,icon:Le(e.type.type),examples:null!=r&&r.examples?Ee(r,n,i,e):void 0}}if(t.token.type===Z().FormulaTokenType.Block||t.token.type===Z().FormulaTokenType.Checkbox||t.token.type===Z().FormulaTokenType.Date||t.token.type===Z().FormulaTokenType.Person)return{};(0,g().HB)(t.token)}),[t.name,t.token,n,i]);return void 0===a?null:(0,K.jsx)(Ae,{name:a,icon:s,description:l,examples:p,style:o})}function we(e,t,n,o){const i=e.examples;let r=[];return r="function"==typeof i?i(n,o).map(((e,n)=>(0,K.jsx)(Me,{example:e,getRecordModel:t},n))):i.map(((e,n)=>(0,K.jsx)(Me,{example:e,getRecordModel:t},n))),r.length>0?r:void 0}function Ee(e,t,n,o){const i=e.examples;let r=[];return r="function"==typeof i?i(o).map(((e,o)=>(0,K.jsx)(Me,{example:e,getRecordModel:t,typecheckContextValues:n},o))):i.map(((e,o)=>(0,K.jsx)(Me,{example:e,getRecordModel:t,typecheckContextValues:n},o))),r.length>0?r:void 0}function je(e){return Ce().KH(e)?[e.data]:Ce().vq(e)?[e.textContent||"",e.className]:void 0}const De=(0,y().YK)({codeExamples:{id:"formula2Input.helperText.codeExamples",defaultMessage:"Examples"},copiedExampleMessage:{id:"formula2Input.helperText.copiedExampleMessage",defaultMessage:"Copied example to clipboard!"},copyToClipboard:{defaultMessage:"Copy to Clipboard",id:"database.copyButton.copyToClipboard"}}),Be=(0,y().YK)({currentValueDescription:{id:"formula2Input.helperText.currentValueDescription",defaultMessage:"Returns the value of the current item in the list function."},currentIndexDescription:{id:"formula2Input.helperText.currentIndexDescription",defaultMessage:"Returns the index of the current item in the list function, starting from 0."},variableType:{id:"formula2Input.variableHelper.description",defaultMessage:"User-defined variable."},listVariableType:{id:"formula2Input.variableHelper.descriptionWithList",defaultMessage:"User-defined variable, list."},emailForUser:{id:"formula2Input.helperText.emailForUser",defaultMessage:"Returns the email address of a provided user."},nameForUser:{id:"formula2Input.helperText.nameForUser",defaultMessage:"Returns the display name of a provided user."}});function Re(e){const{store:t,selection:n,cursorEditorInfo:l,cursorEditorInfoRef:s,context:p,onChange:d,getRecordModel:c,setInfoHelper:y}=e,x=(0,a().IS)((()=>({menu:{top:0,left:0,right:0,bottom:0,position:"absolute",marginBottom:2},menuSection:{paddingTop:6,paddingBottom:2}})),[]),v=(0,i().Y0)(),h=(0,r().uB)(void 0,ie().A),b=(0,o.useMemo)((()=>{const e=f().$z((null==l?void 0:l.completions)??[],"kind");let o=-1;return Object.entries(e).map(((e,i)=>{const[r,a]=e,l=a.map(((e,r)=>{o+=1;const a=o;return{key:`${i}-${r}`,render:t=>(0,K.jsx)(Ye,{...t,completion:e,context:p,getRecordModel:c,menuListStore:h,indexGlobal:a,cursorEditorInfoRef:s,setInfoHelper:y}),action:()=>{var o;void 0!==e&&s.current&&(y({...e,calledFromUnifiedFunctionProperty:"member dot receiver"===(null===(o=s.current.completionsInfo)||void 0===o?void 0:o.type)}),function(e){var t;const{completion:n,store:o,selection:i,onChange:r,cursorEditorInfo:a}=e,l=(null==i?void 0:i.startIndex)||0,s=(null==i?void 0:i.endIndex)||0,p=l!==s,d=(null===(t=a.completionsInfo)||void 0===t?void 0:t.prefix)||"",c="overridePrefixLength"in n?n.overridePrefixLength??0:d.length,y=p?l:s-c,f=o.getValue();if(n.kind===Z().FormulaEditorInfoCompletionKind.Token){if(n.token.type===Z().FormulaTokenType.Checkbox)return;if(n.token.type===Z().FormulaTokenType.BlockProperty){if((0,u().ix)(n.token))return;const e=(0,m().lzV)(f,y,s),t=n.token.collection?(0,u().Yi)(n.token.property):n.token.property,o=(0,m().wmz)((0,m().ESw)({collection:n.token.collection,property:t,name:n.name}));return void r({newValue:(0,m().xym)(e,[o],y),newSelection:{startIndex:y+1,endIndex:y+1}})}if(n.token.type===Z().FormulaTokenType.ContextValue){const e=(0,m().lzV)(f,y,s),t=(0,u().GH)(n.token.valueId),o=(0,m().wmz)((0,m().CA$)({id:t}));r({newValue:(0,m().xym)(e,[o],y),newSelection:{startIndex:y+1,endIndex:y+1}})}else{if(n.token.type===Z().FormulaTokenType.Date||n.token.type===Z().FormulaTokenType.Block||n.token.type===Z().FormulaTokenType.Person)return;(0,g().HB)(n.token)}}else if(n.kind===Z().FormulaEditorInfoCompletionKind.LibraryFunction){var x,v,h,b;const e=(0,m().lzV)(f,y,s),t=(0,m().Ey_)(`${n.libraryFunction.name}()`,[]),o=(0,m().xym)(e,[t],y);let i=y+n.libraryFunction.name.length+1;void 0!==(null===(x=n.libraryFunction)||void 0===x||null===(x=x.parameters)||void 0===x?void 0:x.varargs)||null!==(v=n.libraryFunction)&&void 0!==v&&null!==(v=v.parameters)&&void 0!==v&&null!==(v=v.expected)&&void 0!==v&&v.length&&(1!==(null===(h=n.libraryFunction)||void 0===h||null===(h=h.parameters)||void 0===h||null===(h=h.expected)||void 0===h?void 0:h.length)||"member dot receiver"!==(null===(b=a.completionsInfo)||void 0===b?void 0:b.type))||(i+=1);r({newValue:o,newSelection:{startIndex:i,endIndex:i}})}else if(n.kind===Z().FormulaEditorInfoCompletionKind.Binding||n.kind===Z().FormulaEditorInfoCompletionKind.Builtin){const e=(0,m().lzV)(f,y,s),t=n.kind===Z().FormulaEditorInfoCompletionKind.Binding?n.text:`${n.builtin} `,o=(0,m().Ey_)(t,[]),i=(0,m().xym)(e,[o],y),a=y+t.length;r({newValue:i,newSelection:{startIndex:a,endIndex:a}})}else(0,g().HB)(n)}({completion:e,store:t,selection:n,onChange:d,cursorEditorInfo:s.current}))}}}));return{key:r,render:e=>(0,K.jsx)(pe().A,{...e,style:x.menuSection,title:ne().A.formatMessage(Ke[r])}),items:l}}))}),[p,null==l?void 0:l.completions,s,c,h,d,n,y,t,x.menuSection]),k=(0,o.useCallback)((e=>{var t;if(v.isMobile)return;const n=void 0!==e.indexGlobal?null===(t=s.current)||void 0===t||null===(t=t.completions)||void 0===t?void 0:t[e.indexGlobal]:void 0;var o;n&&y({...n,calledFromUnifiedFunctionProperty:"member dot receiver"===(null===(o=s.current)||void 0===o||null===(o=o.completionsInfo)||void 0===o?void 0:o.type)})}),[s,v.isMobile,y]);let C;return(0,o.useEffect)((()=>{if(v.isMobile)return;const e=e=>{var t,n;if(void 0!==e.state.focus.indexGlobal&&null!==(t=s.current)&&void 0!==t&&t.completions&&(null===(n=s.current)||void 0===n?void 0:n.completions.length)>0){var o;const t=null===(o=s.current)||void 0===o||null===(o=o.completions)||void 0===o?void 0:o[e.state.focus.indexGlobal];void 0!==t&&y((e=>{var n;return void 0===e||void 0===(null===(n=s.current)||void 0===n?void 0:n.callParameter)?t:e}))}};return h.addListener(e),()=>h.removeListener(e)}),[s,h,y,v.isMobile]),(0,o.useEffect)((()=>{var e,t,n,o;if(v.isMobile)return;const i="function"===(null==l||null===(e=l.callParameter)||void 0===e||null===(e=e.expression)||void 0===e||null===(e=e.type)||void 0===e?void 0:e.type)?null===(t=l.callParameter.expression)||void 0===t?void 0:t.type:void 0;void 0!==i&&void 0!==(null==l||null===(n=l.callParameter)||void 0===n?void 0:n.parameterIndex)&&(null==l||null===(o=l.callParameter)||void 0===o?void 0:o.parameterIndex)>-1&&y({kind:Z().FormulaEditorInfoCompletionKind.LibraryFunction,libraryFunction:i.libraryFunction,calledFromUnifiedFunctionProperty:i.calledFromUnifiedFunctionProperty})}),[null==l?void 0:l.callParameter,v.isMobile,y]),(0,o.useEffect)((()=>{b.length>0&&h.update((e=>({focus:{...e,section:0,indexLocal:0,indexGlobal:0,footerFocused:!1}})))}),[b.length,h,y]),C=v.isPhone?{menuType:oe().gu.ActionSheet,disableBottomPadding:!0,maxHeight:"100%"}:{menuType:oe().gu.Popup,width:v.isPhone?180:228,minWidth:v.isPhone?180:228,maxWidth:v.isPhone?180:228},(0,K.jsx)(se().A,{...C,scrollerStyle:x.menu,children:(0,K.jsx)(ue().Ay,{type:ue().Oh.Vertical,initialFocus:0,priority:1,store:h,onKeyboardArrow:k,sections:f().oE([...b,0===b.length&&{key:"no-results",render:e=>(0,K.jsx)(pe().A,{...e,disableDesktopPadding:!0,style:x.menuSection,children:(0,K.jsx)(Ve,{})}),items:[]}])})})}const Ye=o.forwardRef((function(e,t){const{completion:l,context:s,getRecordModel:p,menuListStore:d,indexGlobal:c,cursorEditorInfoRef:m,setInfoHelper:f,onMouseEnter:x,...v}=e,h=(0,i().Y0)(),b=(0,a().IS)((e=>({icon:{width:14,fill:e.mediumIconColor},lightParens:{color:e.lightTextColor}})),[]),k=(0,o.useCallback)((e=>{if(!h.isMobile){var t;const e=null===(t=m.current)||void 0===t||null===(t=t.completions)||void 0===t?void 0:t[c];f(e)}null==x||x(e)}),[m,c,x,f,h.isMobile]),C=(0,r().K8)((()=>d.state.focus.indexGlobal===c),[d,c]),I=(0,o.useMemo)((()=>h.isMobile?(0,K.jsx)(le().Ay,{popupType:le().z7.SlideUp,renderOrigin:e=>(0,K.jsx)(_().A,{mobileFeedback:!0,style:{width:16,height:16},...e,children:(0,n(166883).x)(b.icon)}),render:e=>{var t;let o;return o=h.isMobile?{menuType:oe().gu.Modal,title:(0,K.jsx)(y().sA,{defaultMessage:"Documentation",id:"database.formulaPropertyEntryMenuItem.title"}),right:(0,K.jsx)(n(45552).DoneMenuText,{}),onClickRight:e.close}:{menuType:oe().gu.Popup},(0,K.jsx)(se().A,{...o,children:(0,K.jsx)(pe().A,{children:(0,K.jsx)(n(678553).A,{title:(0,K.jsx)(Pe,{infoHelper:{...l,calledFromUnifiedFunctionProperty:"member dot receiver"===(null==m||null===(t=m.current)||void 0===t||null===(t=t.completionsInfo)||void 0===t?void 0:t.type)},getRecordModel:p,style:{padding:4},typecheckContextValues:s.valueTypes}),style:{paddingTop:16,paddingBottom:16}})})})}}):(0,K.jsx)(Ne,{visible:C})),[l,s.valueTypes,m,h.isMobile,p,C,b.icon]),S=(0,r().K8)((()=>{var e;if(l.kind!==Z().FormulaEditorInfoCompletionKind.Token||l.token.type!==Z().FormulaTokenType.BlockProperty||!p)return;if(Z().FormulaTokenSupportedBlockSystemPropertyList.includes(l.token.property))return l.token.property;if((0,u().ix)(l.token)||!l.token.collection)return;const t=(0,u().Yi)(l.token.property),n=p(l.token.collection);return null==n||null===(e=n.getNormalizedSchema())||void 0===e||null===(e=e[t])||void 0===e?void 0:e.type}),[l,p]);if(l.kind===Z().FormulaEditorInfoCompletionKind.Token){if(l.token.type===Z().FormulaTokenType.Checkbox)return null;if(l.token.type===Z().FormulaTokenType.BlockProperty)return(0,K.jsx)(ae().A,{...v,icon:S?J().Yp[S](b.icon):(0,K.jsx)(He,{type:"unknown"}),title:l.name??l.token.property,right:I,onMouseEnter:k,ref:t});if(l.token.type===Z().FormulaTokenType.ContextValue){const e=(0,u().IV)(s.valueTypes,(0,u().GH)(l.token.valueId));return e?(0,K.jsx)(ae().A,{...v,icon:(0,K.jsx)(_e,{contextValue:e}),title:(0,K.jsx)("div",{style:{display:"flex"},children:e.name}),right:I,onMouseEnter:k,ref:t}):null}if(l.token.type===Z().FormulaTokenType.Date)return null;if(l.token.type===Z().FormulaTokenType.Block)return null;if(l.token.type===Z().FormulaTokenType.Person)return null;(0,g().HB)(l.token)}else{if(l.kind===Z().FormulaEditorInfoCompletionKind.LibraryFunction){const e=l.libraryFunction.returnType;return(0,K.jsx)(ae().A,{...v,icon:(0,K.jsx)(He,{type:"function"==typeof e?e([]).type:e.type}),title:(0,K.jsxs)(K.Fragment,{children:[l.libraryFunction.name,(0,K.jsx)("span",{style:b.lightParens,children:"()"})]}),right:I,onMouseEnter:k,ref:t})}if(l.kind===Z().FormulaEditorInfoCompletionKind.Builtin)return(0,K.jsx)(ae().A,{...v,title:l.builtin,icon:(0,K.jsx)(He,{type:te[l.builtin].type.type}),right:I,onMouseEnter:k,ref:t});if(l.kind===Z().FormulaEditorInfoCompletionKind.Binding)return(0,K.jsx)(ae().A,{...v,title:l.text,icon:(0,K.jsx)(He,{type:l.type.type}),right:I,onMouseEnter:k,ref:t});(0,g().HB)(l)}})),Ne=o.memo((function(e){let{visible:t}=e;const o=(0,a().IS)((e=>({icon:{width:14,fill:e.mediumIconColor,transition:"opacity 50ms 200ms",visibility:t?"visible":"hidden",opacity:t?1:0}})),[t]);return(0,n(356596).K)(o.icon)})),He=o.memo((function(e){var t;let{type:n}=e;const o=(0,a().IS)((e=>({icon:{width:14,fill:e.mediumIconColor,transition:"transform .3s ease"}})),[]);return null===(t=Le(n))||void 0===t?void 0:t(o.icon)}));function _e(e){const{contextValue:t}=e,o=(0,a().IS)((e=>({stepNumber:{color:e.mediumIconColor}})),[]);return(0,g().O9)(t.stepNumberForDisplay)?(0,K.jsx)(n(931077).Q,{size:n(494379).H.Small,number:t.stepNumberForDisplay,style:o.stepNumber}):(0,K.jsx)(He,{type:t.type.type})}function Le(e){return"text"===e?J().Yp.text:"number"===e?J().Yp.number:"checkbox"===e?J().Yp.checkbox:"date"===e?J().Yp.date:"block"===e?J().Yp.relation:"person"===e?J().Yp.person:"select"===e?J().Yp.select:"array"===e?J().Yp.multi_select:"function"===e||void 0===e||"unknown"===e?J().Yp.formula:void(0,g().HB)(e)}function Ve(){return(0,K.jsx)(re().A,{caption:(0,K.jsx)(y().sA,{defaultMessage:"No results",id:"FormulaAutocompleteMenu.noResults.message"})})}const Ue=(0,y().YK)({[Z().FormulaEditorInfoCompletionKind.Token]:{defaultMessage:"Properties",id:"formulaAutocompleteMenu.token.message"},[Z().FormulaEditorInfoCompletionKind.LibraryFunction]:{defaultMessage:"Functions",id:"formulaAutocompleteMenu.function.message"},[Z().FormulaEditorInfoCompletionKind.Binding]:{defaultMessage:"Variables",id:"formulaAutocompleteMenu.variables.message"},[Z().FormulaEditorInfoCompletionKind.Builtin]:{defaultMessage:"Built-ins",id:"formulaAutocompleteMenu.builtin.message"}}),Ke={[Z().FormulaEditorInfoCompletionKind.Token]:Ue[Z().FormulaEditorInfoCompletionKind.Token],[Z().FormulaEditorInfoCompletionKind.LibraryFunction]:Ue[Z().FormulaEditorInfoCompletionKind.LibraryFunction],[Z().FormulaEditorInfoCompletionKind.Binding]:Ue[Z().FormulaEditorInfoCompletionKind.Binding],[Z().FormulaEditorInfoCompletionKind.Builtin]:Ue[Z().FormulaEditorInfoCompletionKind.Builtin]};var ze=()=>n(962730),Oe=()=>n(493823),We=()=>n(204063),$e=()=>n(859428);const qe={height:24,padding:"0 8px"},Ge=(0,y().YK)({accept:{defaultMessage:"Accept",id:"database.formula.acceptFormulaInput.tooltip"},cancel:{defaultMessage:"Cancel",id:"formulas.formulaInputHeader.cancel"},close:{id:"formula2Input.close",defaultMessage:"Close"},save:{id:"formula2Input.save",defaultMessage:"Save"},formulaHeader:{id:"formula2Input.NotionFormula",defaultMessage:"Notion Formula"},learnTooltip:{id:"formula2Input.learnAboutFormulas",defaultMessage:"Learn about formulas!"},revert:{id:"formula2Input.revert",defaultMessage:"Revert"},revertTooltip:{id:"formula2Input.revertTooltip",defaultMessage:"Revert to previous formula"},askAi:{id:"formulas.formulaInputHeader.askAi",defaultMessage:"Ask AI"}}),Qe=o.memo((function(e){const{disabled:t,onClickAssistant:n,onClickCancel:o,onClickClose:i,onClickRevert:r,isAssistantVisible:l}=e,s=(0,a().IS)((e=>({headerRow:{color:e.mediumTextColor,flexWrap:"wrap",fontWeight:500,fontSize:14}})),[]),u=!t&&!l;return(0,K.jsxs)(H().Y1,{direction:"horizontal",padding:"10px 12px 0 12px",style:s.headerRow,children:[o&&!t?(0,K.jsxs)(K.Fragment,{children:[(0,K.jsx)(H().Y1,{width:"hug",children:(0,K.jsx)(Ze,{onClick:o})}),(0,K.jsx)(H().Y1,{width:"fill"})]}):(0,K.jsx)(H().Y1,{width:"fill",children:(0,K.jsx)(tt,{})}),(0,K.jsxs)(H().Y1,{width:"hug",direction:"horizontal",gap:6,align:"center",children:[r&&!t?(0,K.jsx)(nt,{onClick:r}):null,u?(0,K.jsx)(A().y,{experimentId:"formula_assistant",groups:{on:(0,K.jsx)(Je,{onClick:n}),control:null}}):null,t?(0,K.jsx)(Xe,{onClick:i}):(0,K.jsx)(et,{onClick:i})]})]})}));function Je(e){const{onClick:t}=e,n=(0,y().tz)(),o=(0,a().IS)((()=>({label:{marginLeft:6,marginRight:2}})),[]),i=n.formatMessage(Ge.askAi);return(0,K.jsxs)(Oe().p,{"aria-label":i,size:"sm",onClick:t,children:[(0,K.jsx)(N().iB,{}),(0,K.jsx)("span",{style:o.label,children:i})]})}function Ze(e){const{onClick:t}=e,n=(0,y().tz)();return(0,K.jsx)(Oe().p,{isGray:!0,size:"sm",onClick:t,children:n.formatMessage(Ge.cancel)})}function Xe(e){const{onClick:t}=e,n=(0,y().tz)();return(0,K.jsx)(We().A,{onClick:t,style:qe,children:n.formatMessage(Ge.close)})}function et(e){const{onClick:t}=e,o=(0,i().v3)(),r=(0,y().tz)(),l=(0,a().IS)((e=>({commandText:{color:e.text.contrastSecondary}})),[]);return(0,K.jsx)($e().A,{renderTooltip:()=>(0,K.jsxs)("div",{children:[(0,K.jsx)("span",{children:r.formatMessage(Ge.accept)})," ",(0,K.jsxs)("span",{style:l.commandText,children:[(0,n(251057)._w)({environment:o}).command,"+Enter"]})]}),render:e=>(0,K.jsx)(We().A,{onClick:t,style:qe,...e,children:r.formatMessage(Ge.save)})})}function tt(){const e=(0,y().tz)(),t=(0,a().IS)((()=>({headerTitle:{fontSize:12,display:"flex",alignItems:"center"},helpButton:{marginLeft:2,height:20,width:20}})),[]);return(0,K.jsxs)("span",{style:t.headerTitle,children:[e.formatMessage(Ge.formulaHeader),(0,K.jsx)($e().A,{placement:ze().W.Top,render:o=>(0,K.jsx)(Te().A,{...o,ariaLabel:e.formatMessage(Ge.learnTooltip),icon:n(133033).$,href:(0,n(836251).xS)("guides.formulas"),external:!0,style:t.helpButton}),renderTooltip:()=>e.formatMessage(Ge.learnTooltip)})]})}function nt(e){const{onClick:t}=e,n=(0,y().tz)(),o=(0,a().IS)((e=>({revertButton:{color:e.mediumIconColor}})),[]);return(0,K.jsx)($e().A,{placement:ze().W.Top,render:e=>(0,K.jsx)(Oe().p,{...e,"aria-label":n.formatMessage(Ge.revertTooltip),isGray:!0,size:"sm",style:o.revertButton,onClick:t,children:n.formatMessage(Ge.revert)}),renderTooltip:()=>n.formatMessage(Ge.revertTooltip)})}n(18107),n(967357),n(737550);var ot=()=>n(908006),it=()=>n(852507),rt=()=>n(634201),at=()=>n(558842),lt=()=>n(495262),st=()=>n(315097),ut=()=>n(659602),pt=()=>n(335722),dt=()=>n(921855),ct=()=>n(621979),mt=()=>n(792002),yt=()=>n(406792),ft=()=>n(562800),xt=()=>n(477450),gt=()=>n(89793),vt=()=>n(509144);const ht={borderRadius:4,flexGrow:1,flexShrink:1,fontFamily:v().vc(n(662303).locale).githubMono,fontSize:12,height:"100%",minHeight:"1em",paddingBlock:"11px 10px",paddingInline:"12px 13px",tabSize:2,textAlign:"left",whiteSpace:"pre-wrap",wordBreak:"break-all"},bt=(0,y().YK)({formulaPlaceholder:{id:"formulas.formulaPlaceholder",defaultMessage:"Your formula"}});function kt(e){const{analyticsContext:t,clipboardActions:n,disabled:l,errorRanges:s,focus:u,formulasModule:p,handleSave:d,markdownLinkifyIt:c,parentSpaceId:y,Prism:x,store:g,tinyMceMicrosoftWordPasteFilter:v,valueTypes:h}=e,k=(0,o.useRef)(null),C=(0,a().DP)(),I=(0,i().v3)(),T=(0,r().K8)((()=>{var e;const t=M().default.state;return"editing"===t.mode&&(null===(e=(0,S().H7)(t.multiSelection))||void 0===e?void 0:e.store)===g}),[g]),P=(0,o.useCallback)((()=>{var e;return(null===(e=k.current)||void 0===e?void 0:e.getNode())||void 0}),[k]),A=(0,r().K8)((()=>g.getValue()||[]),[g],{debugName:"FormulaInputText.textValueStore"}),F=(0,o.useCallback)((()=>{var e;return null===(e=P())||void 0===e?void 0:e.blur()}),[P]),w=(0,o.useCallback)((()=>{const e=rt().PE(m().q4_(A));return{endIndex:e.length,startIndex:e.length}}),[A]),E=(0,o.useCallback)((()=>{if(T)return(0,mt().Do)(g)}),[T,g]),j=(0,o.useCallback)((()=>{const e=window.getSelection();null!=e&&e.rangeCount&&ot().default.afterNextFlush((()=>{var t;const n=e.getRangeAt(0).getClientRects()[0],o=null===(t=P())||void 0===t||null===(t=t.parentElement)||void 0===t?void 0:t.parentElement,i=null==o?void 0:o.getBoundingClientRect();n&&o&&i&&(i.top>=n.top?o.scrollTo({top:o.scrollTop+(n.top-i.top)-6}):i.bottom<=n.bottom+n.height&&o.scrollTo({top:o.scrollTop+(n.bottom-i.bottom)+28}))}))}),[P]),D=(0,o.useCallback)((e=>{dt().HP({canEdit:!l,editorNode:P(),environment:I,event:e,store:g,textValue:A})}),[I,A,P,g,l]),B=(0,o.useCallback)((e=>{if(l)return;const t=M().default.state;"editing"===t.mode&&t.multiSelection.start.store===g&&(Y().createAndCommit({userAction:"FormulaInputText.handleDelete",environment:I,canUndo:!0,perform:n=>{st().wT({environment:I,multiSelection:t.multiSelection,deleteForwards:!0,transaction:n,event:e,editorMode:"default"})}}),j())}),[l,I,j,g]),N=(0,o.useCallback)((e=>{if(l)return;const t=M().default.state;if("editing"===t.mode&&t.multiSelection.start.store===g){if(st().CZ({device:I.device,event:e,multiSelection:t.multiSelection}))return;Y().createAndCommit({userAction:"FormulaInputText.handleBackspace",environment:I,canUndo:!0,perform:n=>{st().wT({environment:I,multiSelection:t.multiSelection,deleteForwards:!1,transaction:n,event:e,editorMode:"default"})}}),j()}}),[l,I,j,g]),H=(0,o.useCallback)((e=>{var t,n,o;if(l)return;if(null===(t=e.preventDefault)||void 0===t||t.call(e),k.current&&k.current.isComposing())return;const i=M().default.state,r="editing"===i.mode&&(0,S().H7)(i.multiSelection);if(!r)return;const a=rt().PE(m().q4_(A)),s=null===(n=a.slice(0,r.selection.startIndex).join("").split("\n"))||void 0===n?void 0:n.at(-1),u=(null==s||null===(o=s.match(/^\t*/))||void 0===o?void 0:o[0].length)||0,p=(null==s?void 0:s.split("").reverse())||[];let d=0;const c=p.some((e=>{if(")"===e)d++;else if("("===e){if(0===d)return!0;d--}return!1}))?u+1:u;let y="\t".repeat(c);const f=")"===a[r.selection.endIndex],x=!(null==s||!s.endsWith("("))&&f;x&&(y+=`\n${"\t".repeat(c-1)}`),Y().createAndCommit({userAction:"FormulaInputText.handleShiftEnter",environment:I,canUndo:!0,perform:e=>{R().$D({environment:I,editorMode:"default",store:g,string:`\n${y}`,selection:r.selection,disableMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,transaction:e}),x&&b().setSelection({store:g,selection:{startIndex:r.selection.startIndex+c+1,endIndex:r.selection.startIndex+c+1}})}}),j()}),[l,I,j,g,A]),_=(0,o.useCallback)((e=>{var t;const o=window.getSelection();null!=o&&o.anchorNode&&null!==(t=P())&&void 0!==t&&t.contains(o.anchorNode)&&n.copy({environment:I,event:e,markdownLinkifyIt:c})}),[I,P,c,n]),V=(0,o.useCallback)((e=>{l?e.preventDefault():(n.cutWithMaybeConfirmation({environment:I,event:e,markdownLinkifyIt:c}),j())}),[l,I,j,c,n]),U=(0,o.useCallback)((e=>{l?e.preventDefault():(Y().createAndCommit({userAction:"FormulaInputText.handlePaste",environment:I,canUndo:!0,perform:t=>{n.paste({environment:I,event:e,disableEmbedMenu:!0,transaction:t,onPasteFiles:n.pasteFilesForBlocks,formulasModule:p,markdownLinkifyIt:c,tinyMceMicrosoftWordPasteFilter:v})}}),j())}),[l,I,j,c,v,p,n]),z=(0,o.useCallback)((e=>{dt().sp({environment:I,event:e,textValue:A,editorNode:P(),store:g,canEdit:!l})}),[I,A,P,g,l]),O=(0,o.useCallback)((e=>{dt().W5({environment:I,event:e,textValue:A,editorNode:P(),store:g,canEdit:!l})}),[I,A,P,g,l]),W=(0,o.useCallback)((e=>{l||e.preventDefault()}),[l]),$=(0,o.useCallback)((e=>{Y().createAndCommit({userAction:"FormulaInputText.handleMoveUp",environment:I,canUndo:!0,perform:e=>{R().$P({environment:I,transaction:e,direction:"up"})}})}),[I]),q=(0,o.useCallback)((e=>{Y().createAndCommit({userAction:"FormulaInputText.handleMoveDown",environment:I,canUndo:!0,perform:e=>{R().$P({environment:I,transaction:e,direction:"down"})}})}),[I]),G=(0,o.useCallback)((e=>{var t;e.preventDefault&&e.preventDefault();const n=lt().li();(null==n||null===(t=n.getFirstStore())||void 0===t?void 0:t.id)===g.id&&lt().tN({environment:I})}),[I,g.id]),Q=(0,o.useCallback)((e=>{var t;e.preventDefault&&e.preventDefault();const n=lt().Bl();(null==n||null===(t=n.getFirstStore())||void 0===t?void 0:t.id)===g.id&&lt().ZS({environment:I})}),[I,g.id]),J=(0,o.useCallback)((e=>{if(l)return;e.preventDefault();const t=M().default.state,n="editing"===t.mode&&(0,S().H7)(t.multiSelection);n&&Y().createAndCommit({userAction:"FormulaInputText.handleTab",environment:I,canUndo:!0,perform:e=>{R().RJ({environment:I,store:g,editorMode:"default",selection:n.selection,transaction:e,shouldStripTokens:!1,disableFilters:!0})}})}),[l,I,g]),Z=(0,o.useCallback)((e=>{if(l)return;e.preventDefault();const t=M().default.state,n="editing"===t.mode&&(0,S().H7)(t.multiSelection);n&&Y().createAndCommit({userAction:"FormulaInputText.handleUntab",environment:I,canUndo:!0,perform:e=>{R().Ye({environment:I,store:g,editorMode:"default",selection:n.selection,transaction:e,shouldStripTokens:!1,disableFilters:!0})}})}),[l,I,g]),X=(0,o.useCallback)((e=>{const{newValue:o}=e;yt().default.measureAfterNextFlush({metricName:"formulas_typing_lag",startTime:performance.now()},{environment:I,getData:()=>t}),Y().createAndCommit({userAction:"FormulaInputText.handleMutation",environment:I,canUndo:!0,perform:e=>{R().dw({environment:I,editorMode:"default",store:g,newValue:o,disableMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,disableFilters:!0,transaction:e}),e.postEnqueueActions.push((()=>{Y().createAndCommit({userAction:"FormulaInputText.normalizeTextValue",environment:I,canUndo:!0,perform:e=>{R().wu({clipboardActions:n,formulasModule:p,store:g,transaction:e})}})}))}})}),[t,I,p,g,n]),ee=(0,o.useCallback)(((e,t)=>{let{leafRef:n,wrapperRef:o,...i}=e;const{device:r}=I,a=A.length>0;return(0,K.jsxs)("div",{ref:o,...i,onKeyDown:e=>{!function(e,t,n){(0,ct().A)(n,e,"command+enter")&&(t(),e.stopPropagation())}(e,d,I),null==i||i.onKeyDown(e)},style:{flexGrow:1,display:"table",position:"relative"},children:[(0,K.jsx)(It,{hasText:a}),(0,K.jsx)(xt().A,{leafRef:(0,at().Px)(k,n),style:ht,isDisabled:l,debugName:"FormulaInputText",store:g,getHtml:()=>(0,vt()._)({currentUserId:I.currentUser.id,errorRanges:s,getPublicBaseUrlForPage:ft().SN(I),isAndroid:r.isAndroid,isMobileNative:r.isMobileNative,isSafariOrIOS:r.isSafari||r.isIOS,isWindows:r.isWindows,parentSpaceId:y,Prism:x,store:g,textValue:A,theme:C,valueTypes:h}),getSelection:E,onMutation:X,spellCheck:!1,autoCorrect:"off",autoCapitalize:"off",onSelect:t,onMouseOver:z,onMouseOut:O,suppressNewlineEvents:!1,expandSelectionOnTripleClick:!0,placeholder:" "})]})}),[I,A,E,X,z,O,d,l,s,y,x,g,C,h]),te=(0,o.useCallback)((()=>{u&&b().setSelectionAtEnd({store:g})}),[u,g]);return(0,it().l)(te),(0,K.jsxs)(L().A,{debugName:"FormulaInputText",capture:!0,allowEnter:!0,allowTabUntab:!0,allowUndo:!0,allowEsc:!0,allowCopyPaste:!0,children:[" ",(0,K.jsx)(gt().F,{store:g,disabled:l,clearBrowserSelection:F,getEndSelection:w,onBlur:F,onClick:D,onDelete:B,onBackspace:N,onShiftEnter:H,onCommandShiftEnter:f().D_,onTab:J,onUntab:Z,onToggleBold:W,onToggleItalics:W,onToggleUnderline:W,onToggleStrike:W,onToggleCode:f().D_,onCopy:_,onCut:V,onPaste:U,onMoveUp:$,onMoveDown:q,onUndo:G,onRedo:Q,onEsc:d,render:ee,disableStyleAnnotations:!0,disableMentions:!0,disableSlashCommands:!0,canSelectAllBlocks:!1,canInsertText:!0,canSelectionDrag:!0,disableMobileActionBar:!0,topBottomPadding:40,pasteBehavior:"inline"})]})}function Ct(e){const{value:t}=(0,T().fJ)(he().y),{value:n}=(0,T().fJ)(ut().g),{value:o}=(0,T().fJ)(pt().S),{value:i}=(0,T().fJ)(k().T.formulas),{value:r}=(0,T().fJ)(h().R.clipboardActions);return t&&i&&r?(0,K.jsx)(kt,{...e,Prism:t,clipboardActions:r,formulasModule:i,markdownLinkifyIt:n,tinyMceMicrosoftWordPasteFilter:o}):null}function It(e){const{hasText:t}=e,n=(0,y().tz)();return(0,K.jsx)(H().Y1,{direction:"horizontal",gap:8,padding:"10px 12px",style:{position:"absolute",inset:0,pointerEvents:"none",userSelect:"none"},children:t?null:(0,K.jsx)(H().Y1,{height:20,align:"center-left",children:(0,K.jsx)(U().D,{colorName:"quaternary",styleName:"Body-14px/Regular",children:n.formatMessage(bt.formulaPlaceholder)})})})}kt.displayName="FormulaInputText";const St=!1,Tt=400;function Pt(e){const{evaluationErrors:t,initialCode:n,parentSpaceId:v,outputFooter:N,disabled:H,typecheckContext:_,formulas:L,handleCancel:V,onCodeChange:U,onTypeChange:O,parentCollectionStore:W,handleClose:$,getRecordModel:q}=e,G=(0,y().tz)(),J=(0,i().Y0)(),Z=(0,i().v3)(),{value:X}=(0,T().fJ)(k().T.formulaEditor),ee=(0,o.useMemo)((()=>W?{collection_id:[[W.id]]}:void 0),[W]),{store:te,setValue:ne}=(0,I().AI)({initialValue:n,onChange:U,source:"formula",properties:ee}),oe=(0,o.useCallback)((e=>{if(ne(e.newValue),e.newSelection){const t={start:{store:te,index:e.newSelection.startIndex},end:{store:te,index:e.newSelection.endIndex}};b().setMultiSelection({multiSelection:t})}}),[ne,te]),ie=(0,r().K8)((()=>{var e;const t=M().default.state;if("editing"===t.mode&&(null===(e=(0,S().H7)(t.multiSelection))||void 0===e?void 0:e.store)===te)return{startIndex:t.multiSelection.start.index,endIndex:t.multiSelection.end.index}}),[te],{useDeepEqual:!0}),re=(0,r().K8)((()=>te.getValue()),[te]),ae=(0,o.useMemo)((()=>!f().n4(re,n)),[re,n]),[le,se]=(0,r().K8)((()=>!re||I().Pe?[void 0,void 0]:L.processFormulaInput(re)),[re,L]),ue=(0,r().K8)((()=>{if(le)return L.parseFormulaInputToCst(le,se)}),[le,L,se]),pe=(0,r().K8)((()=>{if(ue)return L.convertFormulaCSTToAST(ue[0])}),[L,ue]),[de,ce]=(0,o.useState)(void 0);(0,o.useEffect)((()=>{!async function(){if(pe&&_&&x().Q.isSuccess(pe)){const e=await L.addTypesToFormulaASTAsync(pe.value,_,se);ce(e),null==O||O(e.node.type)}else ce(void 0)}()}),[pe,_,se,ue,L,O]);const me=(0,o.useMemo)((()=>void 0!==de?[...(0,u().KH)(de.node,!1),...de.errors]:[]),[de]),ye=(0,o.useMemo)((()=>({parseErrors:(null==ue?void 0:ue[1])??[],typeErrors:me,evaluationErrors:t})),[t,ue,me]),fe=(0,d().lW)(ye,Tt,Object.is),xe=ye.parseErrors.length+ye.typeErrors.length+ye.evaluationErrors.length>0,ge=(0,r().K8)((()=>function(e){const{errors:t,intl:n,codeLength:o,formulas:i}=e,{parseErrors:r,typeErrors:a,evaluationErrors:s}=t,u=[];a&&a.length>0?a.forEach((e=>{const t=(0,l().ew)((0,l().rA)(n,e));u.push({msg:n.formatMessage(...t),range:{startIndex:e.node.startOffset,endIndex:e.node.endOffset+1}})})):s&&s.length>0&&s.forEach((e=>{const t=(0,l().ew)((0,l().yI)(n,e));u.push({msg:n.formatMessage(...t),range:i.isUniqueFormulaEvaluatorError(e)?{startIndex:e.node.startOffset,endIndex:e.node.endOffset+1}:void 0})}));r&&r.forEach((e=>{const t=(0,l().ew)((0,l().ml)(e));u.push({msg:n.formatMessage(...t),range:"eof"===e.offset?{startIndex:o-1,endIndex:o}:{startIndex:e.offset,endIndex:e.offset+1}})}));return u}({errors:fe,codeLength:se?(0,s().sE)(se):(0,m().q4_)(re).length,formulas:L,intl:G})),[re,fe,L,G,se]),ve=(0,o.useMemo)((()=>ge.map((e=>e.range)).filter(g().O9)),[ge]),he=(0,o.useCallback)((()=>{$(H?n:te.getValue())}),[H,$,n,te]),[be,ke]=(0,o.useState)(void 0),Ce=(0,o.useRef)(void 0),[Ie,Se]=(0,o.useState)(void 0),Te=(0,o.useRef)(1);(0,o.useEffect)((()=>{Te.current++;const e=Te.current;!async function(){if(X){const t=await X.getFormulaEditorInfoAtPosition({formula:re??[],inputPosition:ie&&ie.startIndex===ie.endIndex?ie.startIndex:0,context:_,includeDeprecatedCompletions:!1});x().Q.isSuccess(t)&&Te.current===e&&(Ce.current=t.value,ke(t.value))}}()}),[ie,X,_,re]);const Me=(0,o.useCallback)((()=>{ne(n)}),[n,ne]),Ae=(0,r().uB)(void 0,Q),Fe=(0,r().K8)((()=>{var e;return null==W||null===(e=W.getSchemaStore)||void 0===e||null===(e=e.call(W))||void 0===e?void 0:e.getValue()}),[W]),we=(0,r().K8)((()=>Ae.state.isAssistantVisible),[Ae]),Ee=(0,o.useCallback)((()=>(0,c().r4)({textValue:te.getValue(),intl:G,getRecordModel:q,userTimeZone:(0,p().P)()})),[te,G,q]),je=null==W?void 0:W.id,De=ge.length>0,Be=(0,o.useCallback)((()=>{var e;we||(0,C().u4)({environment:Z,event:{eventName:"formula_assistant_open",eventProperties:{formula_assistant_session_id:Ae.state.id,has_existing_formula:(null===(e=Ee())||void 0===e?void 0:e.length)>0,has_errors:De,collection_id:je}}});Ae.toggleAssistantVisible()}),[we,Ae,Z,Ee,De,je]),Ye=(0,o.useCallback)((async()=>{var e;const t=null===(e=P().default.state.currentSpaceStore)||void 0===e?void 0:e.id,n=Ae.state.prompt;if(!t||!n)return;Ae.didBeginRequest();const o=ge.map((e=>{if("string"==typeof e.msg)return e.range?`${e.msg} [${e.range.startIndex},${e.range.endIndex}]`:e.msg})).filter(g().O9),i=function(e){const{prompt:t,collectionSchema:n,typecheckContext:o,existingFormula:i,formulaErrors:r}=e,a=[];if(n){const{sourceProperty:e}=o;for(const[t,o]of Object.entries(n))t!==e&&void 0!==o&&a.push({name:o.name,type:o.type,example:void 0})}return{type:"formula",prompt:t,properties:a,existingFormula:i,formulaErrors:r}}({prompt:n,collectionSchema:Fe,typecheckContext:_,existingFormula:Ee(),formulaErrors:o}),r=await async function(e){const{environment:t,spaceId:n,formulaInferenceContext:o}=e,i=w().JW();await D().callApi({eventName:"publishAiSession",environment:t,data:{inference_type:"formula",spaceId:n,id:i,metadata:{from:"formulaAssistant"}}});const r=w().JW(),a=await D().callStreamApi({eventName:"getCompletion",environment:t,data:{id:r,context:o,model:"openai-gpt-4o",spaceId:n,isSpacePermission:!1,aiSessionId:i,metadata:{}},headers:(0,E().WS)({spaceId:n})});if("success"!==a.type)return void B().Qg(a);let l="";if(j().hS.is(a.data))for await(const s of a.data)"success"===s.type&&(l+=s.completion);return{formula:l,inferenceId:r}}({environment:Z,spaceId:t,formulaInferenceContext:i});if(r){const e=await h().R.clipboardActions.load();!function(e){const{clipboardActions:t,environment:n,formulasModule:o,newValue:i,store:r}=e;Y().createAndCommit({userAction:"FormulaInputText.handleMutation",environment:n,canUndo:!0,perform:e=>{R().kE({environment:n,store:r,newValue:i,editorMode:"default",disableMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,disableFilters:!0,transaction:e}),e.postEnqueueActions.push((()=>{Y().createAndCommit({userAction:"FormulaInputText.normalizeTextValue",environment:n,canUndo:!0,perform:e=>{R().wu({clipboardActions:t,formulasModule:o,store:r,transaction:e})}})}))}})}({environment:Z,clipboardActions:e,formulasModule:L,newValue:r.formula,store:te}),(0,C().u4)({environment:Z,event:{eventName:"formula_assistant_prompt",eventProperties:{formula_assistant_session_id:Ae.state.id,inference_id:r.inferenceId}}})}Ae.didFinishRequest()}),[Ae,ge,Fe,_,Ee,Z,L,te]),Ne=(0,o.useCallback)((()=>{}),[]),He=(0,o.useCallback)((()=>Ae.hideAssistant()),[Ae]);St&&console.log("FormulaInput",{currentValue:re,cursorEditorInfo:be,infoHelper:Ie,errorMessagesWithRange:ge,errorRanges:ve,astWithTypes:de});const _e=(0,a().IS)((e=>({container:{display:"flex",height:"100%",paddingBottom:void 0,flexDirection:"column"},editorSection:{display:"flex",flexDirection:"column",backgroundColor:"light"===e.mode?e.cardBackground:e.accentColors.gray[30]},inputText:{display:"flex",flexGrow:1,flexShrink:1,overflow:"auto",maxHeight:"min(calc(90vh - 240px - 38px - 30px), 298px)",minHeight:"40px",cursor:"text",position:"relative"},bottomSection:{display:"flex",flexDirection:"row",height:J.isMobile?"100%":240,maxHeight:J.isMobile?void 0:"calc(90vh - 38px - 31px - 38px - 30px)",borderTop:`1px solid ${e.outlineButtonBorder}`},leftColumn:{position:"relative",borderRight:`1px solid ${e.outlineButtonBorder}`,width:J.isMobile?"100%":void 0},rightColumn:{display:"flex",flexDirection:"column",flexGrow:1},infoHelper:{padding:"12px 14px"},assistantOverlay:{position:"absolute",inset:0,background:"transparent"}})),[J.isMobile]);return(0,K.jsx)(F().A,{debugName:"FormulaInput",capture:!0,children:(0,K.jsxs)("div",{style:_e.container,children:[(0,K.jsxs)("div",{style:_e.editorSection,children:[(0,K.jsx)(Qe,{disabled:H,onClickAssistant:Be,onClickCancel:V,onClickClose:he,onClickRevert:ae?Me:void 0,isAssistantVisible:we}),(0,K.jsxs)("div",{style:_e.inputText,children:[(0,K.jsx)(Ct,{value:re,focus:!we,store:te,disabled:H||we,parentSpaceId:v,valueTypes:_.valueTypes,errorRanges:ve,handleSave:he,analyticsContext:{restrict_unaccessible_properties:_.restrictUnaccessibleProperties}},"input"),we?(0,K.jsx)("div",{style:_e.assistantOverlay,onClick:He}):null]})]}),ge.length>0&&xe?(0,K.jsx)(Mt,{errorMessagesWithRange:ge}):N,we?(0,K.jsx)(A().y,{experimentId:"formula_assistant",groups:{on:(0,K.jsx)(z,{formulaAssistantStore:Ae,onStop:Ne,onSubmit:Ye}),control:null}}):null,!H&&!we&&(0,K.jsxs)("div",{style:_e.bottomSection,children:[(0,K.jsx)("div",{style:_e.leftColumn,children:(0,K.jsx)(Re,{store:te,context:_,selection:ie,cursorEditorInfo:be,cursorEditorInfoRef:Ce,onChange:oe,getRecordModel:e.getRecordModel,setInfoHelper:Se})}),!J.isMobile&&(0,K.jsx)("div",{style:_e.rightColumn,children:(0,K.jsx)(Pe,{infoHelper:Ie,getRecordModel:e.getRecordModel,style:_e.infoHelper,typecheckContextValues:_.valueTypes})})]})]})})}const Mt=o.memo((function(e){let{errorMessagesWithRange:t}=e;const o=(0,a().IS)((e=>({errors:{display:"flex",flexDirection:"row",alignItems:"start",padding:10,fontSize:v().J.UISmall.desktop,width:"100%",borderTop:`1px solid ${e.outlineButtonBorder}`,color:e.darkTextColor,flexShrink:0},icon:{width:14,height:14,fill:e.icon.uiRedPrimary,display:"inline",marginRight:3,marginTop:2},errorMessages:{color:e.text.uiRedPrimary}})),[]);return 0===t.length?null:(0,K.jsxs)("div",{style:o.errors,children:[(0,n(750559).f)(o.icon),(0,K.jsx)("span",{style:o.errorMessages,children:t.slice(0,3).map(((e,t)=>(0,K.jsx)(At,{shouldAddLeadingSpace:t>0,errorMessageWithRange:e},t)))})]})})),At=o.memo((function(e){let{errorMessageWithRange:t,shouldAddLeadingSpace:n}=e;const{msg:o,range:i}=t,r=(0,a().IS)((()=>({errorRange:{opacity:.75}})),[]);return(0,K.jsxs)(K.Fragment,{children:[n?" ":null,o,void 0!==i&&(0,K.jsxs)(K.Fragment,{children:[" ",(0,K.jsx)("span",{style:r.errorRange,children:`[${i.startIndex},${i.endIndex}]`})]})]})}))},911724:(e,t,n)=>{n.d(t,{A:()=>d,v:()=>p});n(898992),n(354520);var o=n(296540),i=()=>n(484714),r=()=>n(56366),a=()=>n(989423),l=()=>n(546461),s=n(474848);const u=(0,o.createContext)({collectionStore:void 0,currentDraggingActionId:void 0,disabled:!0,maybePersistedTransactionActions:{createAndCommit:n(633904).l},editorPlacement:{type:"inline"},editorWidth:300,suppressActionErrors:[],collapsedActionIds:[],hideDragHandle:!1,cantSaveDueToError:!1,toggleActionIdCollapsed:()=>{}});function p(e){const t=(0,i().v3)(),{automationStore:n}=(0,l().EC)(),p=(0,r().K8)((()=>n.getActionIds()),[n]),[d,c]=(0,o.useReducer)(((e,o)=>{const i=e.includes(o);return(0,a().u4)({environment:t,event:{eventName:"automation_action_collapse_toggle",eventProperties:{collapsed:!i,automation_action_id:o,automation_id:n.id}}}),i?e.filter((e=>e!==o)):[...e,o]}),e.defaultCollapseActions?p:[]);return(0,s.jsx)(u.Provider,{value:{...e.value,collapsedActionIds:d,toggleActionIdCollapsed:c},children:e.children})}u.displayName="AutomationEditorContext";const d=u}}]);