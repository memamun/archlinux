"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[85873],{210230:(e,n,t)=>{t.r(n),t.d(n,{SlackConnectionOptions:()=>D});t(944114),t(898992),t(354520),t(581454);var s=t(296540),a=()=>t(484714),i=()=>t(852507),o=()=>t(56366),c=()=>t(401497),l=()=>t(187174),r=()=>t(685506),d=t(474848);const u=(0,t(340498).wt)("key",{viewBox:"0 0 30 30",svg:(0,d.jsx)("path",{d:"M14.757 4A5.724 5.724 0 009 9.748c0 2.364 1.389 4.456 3.586 5.335V23.6c0 .255.079.483.272.676l1.53 1.477a.578.578 0 00.808-.009l2.769-2.768a.598.598 0 000-.87l-1.591-1.574 2.232-2.232a.602.602 0 00-.017-.861l-2.171-2.18c2.628-1.116 4.087-3.13 4.087-5.511A5.733 5.733 0 0014.757 4zm0 5.344a1.55 1.55 0 01-1.547-1.547c0-.861.685-1.547 1.547-1.547a1.55 1.55 0 011.547 1.547 1.55 1.55 0 01-1.547 1.547z"})});var p=()=>t(874963),g=()=>t(385527),v=()=>t(846899),k=()=>t(735384),h=()=>t(386164),f=()=>t(959013),m=()=>t(284371),y=()=>t(449506),w=()=>t(901389),A=()=>t(705540),x=()=>t(957416),S=()=>t(576590),b=()=>t(760217),M=()=>t(331542),_=()=>t(928600),j=()=>t(939740),I=()=>t(89924),O=()=>t(21140),C=()=>t(989423),N=()=>t(722872),W=()=>t(963589),P=()=>t(176983),T=()=>t(351360),K=()=>t(508496),R=()=>t(174636);const B=(0,f().YK)({userOverwritePopupTitle:{id:"slackConnectionOptions.overwriteEmail.title",defaultMessage:"User Authorization"}});function D(e){var n;let{parent:t,from:D}=e;const z=(0,a().v3)(),[L,U]=(0,s.useState)(),Y=(0,W().X)("ingestion_mapped_child_spaces"),F=(0,P().J)(),q=(0,c().IS)((e=>({icon:{width:16,height:16},caption:{color:e.lightTextColor,fontSize:12,textWrap:"wrap"},option:{paddingTop:4,paddingBottom:4},optionLabel:{fontSize:14,marginBottom:2},disabledOptionLabel:{color:e.lightTextColor,fontSize:14,marginBottom:2},iconWrapper:{paddingTop:4}})),[]),G=(0,o().K8)((()=>T().default.state.currentSpaceStore),[]),V=(0,o().K8)((()=>R().R.state.isPublicSync),[]),H=(0,o().K8)((()=>R().R.state.isPrivateSync),[]),J=(0,o().K8)((()=>R().R.state.isSyncCompleted),[]),X=(0,o().K8)((()=>R().R.state.sessionId),[]),[Z,$]=s.useState(!0),[ee,ne]=s.useState(!1),[te,se]=s.useState([]),ae=(0,o().K8)((()=>{var e;return null===(e=T().default.getState().currentSpaceStore)||void 0===e?void 0:e.getSpaceId()}),[]),ie=(0,o().K8)((()=>R().R.state.isDisconnecting),[]),oe=(0,o().K8)((()=>R().R.state.analyticsFrom),[]),[ce,le]=(0,s.useState)(!0),re=(0,o().K8)((()=>R().R.state.isSlackGridAiConnectorEnabled),[]);(0,i().l)((async()=>{const e=null==G?void 0:G.id;if(!e)return;if(Y){const n=await y().callApi({eventName:"getMappedParentSpace",environment:z,data:{spaceId:e}});if("success"!==n.type)return;if(n.data.isMapped)return U(n.data),void $(!1)}const n=await y().callApi({eventName:"getSlackBulkIngestionStatus",environment:z,data:{spaceId:e},headers:(0,h().WS)({spaceId:e})});"success"===n.type&&R().R.setState({...R().R.state,...n.data});const t=await y().callApi({eventName:"getConnectedAppsForUniversalQna",environment:z,data:{spaceId:e},headers:(0,h().WS)({spaceId:e})});"success"===t.type&&se(t.data.connectedApps);const s=await y().callApi({eventName:"canUserQuerySlack",environment:z,data:{spaceId:e}});"success"===s.type&&(le(s.data.canQuery),R().R.setState({...R().R.state,canQuery:s.data.canQuery})),$(!1)})),(0,l().Yb)((async()=>{if(!ae)return;const e=await y().callApi({eventName:"allowPrivateSlackIngestion",environment:z,data:{spaceId:ae}});"success"===e.type&&ne(e.data.allow)}),[z,ae]);const de=(0,o().K8)((()=>te.includes("slack-admin")),[te]),ue=(0,o().K8)((()=>te.includes("slack")),[te]),pe=(0,o().K8)((()=>{const e=K().default.getConfigKey("ingestion","slack");return(null==e?void 0:e.userScopes.length)>0}),[]),ge=[{key:"slack-connection-section",render:e=>(0,d.jsx)(I().A,{...e}),items:(null!=L&&L.isMapped?[{key:"inherited-space",label:(0,d.jsx)(f().sA,{id:"assistantOverflowMenu.slackIngestion.connectionDisabled",defaultMessage:"Disabled"}),caption:(0,d.jsx)(f().sA,{id:"assistantOverflowMenu.slackIngestion.disabledDescription",defaultMessage:"Cannot connect Slack to this space. Slack connection is inherited from {parentSpaceName}",values:{parentSpaceName:(0,d.jsx)("u",{children:null===(n=L.spaceDetails)||void 0===n?void 0:n.spaceName})}}),icon:(0,p().f)(q.icon),disabled:!0,connected:!1,hidden:!1,action:()=>{}}]:[{key:"slack-ingestion-admin-auth",label:E(te,J,V,re),caption:Q(F,te,V,ie,J),icon:(0,p().f)(q.icon),disabled:!0,connected:de,hidden:!1,action:()=>{ae&&((0,S().navigateToSlackUniversalQnAOnboarding)({analyticsFrom:D||"chat_menu"}),(0,C().u4)({environment:z,event:{eventName:"universal_qna_button_click",eventProperties:{button_name:"connect_public_slack",integration_type:"slack",setup_session_id:X,from:D||oe}}}))}},{key:"slack-ingestion-user-auth",label:(0,d.jsx)(f().sA,{id:"assistantOverflowMenu.slackIngestion.userAuth",defaultMessage:"Private conversations"}),caption:H?(0,d.jsx)(f().sA,{id:"assistantOverflowMenu.slackIngestion.privateConnectionInProgress",defaultMessage:"Connecting. This can take up to 36 hours."}):ue?(0,d.jsx)(f().sA,{id:"assistantOverflowMenu.slackIngestion.connectedByYou",defaultMessage:"Connected by you"}):(0,d.jsx)(f().sA,{id:"assistantOverflowMenu.slackIngestion.userCaption",defaultMessage:"Connect to enhance your AI results"}),icon:(0,g().h)(q.icon),disabled:!1,connected:ue,hidden:!!re||Boolean(!de||Boolean(te.includes("slack-admin")&&V)||!ee||!pe||ie),action:async()=>{if(ae)if(ue){"success"===(await y().callApi({eventName:"disconnectSlackIngestion",environment:z,data:{spaceId:ae,disconnectForWorkspace:!1}})).type&&se((e=>e.filter((e=>"slack"!==e)))),(0,C().u4)({environment:z,event:{eventName:"universal_qna_button_click",eventProperties:{button_name:"disconnect_private_slack",integration_type:"slack",setup_session_id:X,from:D||oe}}})}else{const e=await y().callApi({eventName:"getSlackIngestionAuthorizeUrl",environment:z,data:{spaceId:ae,isAdminAuth:!1,isDesktopApp:z.device.isElectron}});"success"===e.type&&window.open(e.data.url,"_blank"),(0,C().u4)({environment:z,event:{eventName:"universal_qna_button_click",eventProperties:{button_name:"connect_private_slack",integration_type:"slack",setup_session_id:X,from:D||oe}}})}}},{key:"slack-overwrite-email",label:(0,d.jsx)(f().sA,{id:"assistantOverflowMenu.slackIngestion.overWriteEmail",defaultMessage:"Log in to Slack"}),caption:(0,d.jsx)(f().sA,{id:"assistantOverflowMenu.slackIngestion.overWriteEmailCaption",defaultMessage:"We couldn't verify your Slack e-mail. Click to authenticate."}),icon:u(q.icon),disabled:!1,connected:ue,hidden:!!re||(!J||ce),action:async()=>{if(!ae)return;(0,C().u4)({environment:z,event:{eventName:"universal_qna_button_click",eventProperties:{button_name:"connect_slack_user_mapping",integration_type:"slack",setup_session_id:X,from:D||oe}}});const e=await y().callApi({eventName:"getSlackIngestionAuthorizeUrl",environment:z,data:{spaceId:ae,isAdminAuth:!1,isDesktopApp:z.device.isElectron,isUserMapping:!0,sessionId:X}});"success"===e.type&&(z.device.isElectron?A().openExternalUrl(e.data.url):await x().P(z,{width:800,height:600,url:e.data.url,titleMessage:B.userOverwritePopupTitle}))}},{key:"slack-overwrite-email-logout",label:(0,d.jsx)(f().sA,{id:"assistantOverflowMenu.slackIngestion.overWriteEmailLogout",defaultMessage:"Disconnect your account"}),caption:(0,d.jsx)(d.Fragment,{}),icon:(0,k().I)(q.icon),disabled:!1,connected:!1,hidden:!!re||!te.includes("slack-user-mapping"),action:async()=>{if(!ae)return;null==t||t.close();const{accept:e}=await w().Gh({message:(0,d.jsxs)(O().wt,{gap:8,children:[(0,d.jsx)("div",{style:{fontWeight:m().Wy.semibold,fontSize:18},children:(0,d.jsx)(f().sA,{id:"universalQna.slackChannelSelection.disconnectOverwriteHeader",defaultMessage:"Are you sure?"})}),(0,d.jsx)("div",{style:{fontWeight:m().Wy.regular},children:(0,d.jsx)(f().sA,{id:"universalQna.slackChannelSelection.disconnectOverwriteNote1",defaultMessage:"Your Slack data will be permanently deleted from Notion."})}),(0,d.jsx)("div",{style:{fontWeight:m().Wy.regular},children:(0,d.jsx)(f().sA,{id:"universalQna.slackChannelSelection.disconnectOverwriteNote2",defaultMessage:"This process can take up to 3 hours, and you'll only be able to reconnect after disconnecting is complete."})})]}),acceptLabel:(0,d.jsx)(f().sA,{id:"universalQna.slackChannelSelection.disconnectButtonLabel",defaultMessage:"Disconnect Slack"})});e&&((0,C().u4)({environment:z,event:{eventName:"universal_qna_button_click",eventProperties:{button_name:"slack_user_mapping_disconnect",integration_type:"slack",setup_session_id:X,from:D||oe}}}),await y().callApi({eventName:"disconnectSlackIngestion",environment:z,data:{spaceId:ae,disconnectUserMapping:!0}}))}}]).filter((e=>!e.hidden)).map((e=>{let{key:n,label:s,caption:a,icon:i,disabled:o,connected:c,action:l}=e;return{key:n,action:async()=>{await l(),null==t||t.close()},render:e=>(0,d.jsx)(b().A,{...e,title:(0,d.jsxs)(O().Ye,{gap:4,children:[(0,d.jsx)("div",{style:q.iconWrapper,children:i}),(0,d.jsxs)("div",{style:q.option,children:[(0,d.jsx)("div",{style:o?q.disabledOptionLabel:q.optionLabel,children:s}),(0,d.jsx)("div",{style:q.caption,children:a})]})]}),right:c&&(0,r().i)({width:12,height:12}),disabled:o})}}))}];return L||!te.includes("slack-admin")||!F||V||ie||ge.push({key:"slack-settings-section",render:e=>(0,d.jsx)(I().A,{...e,topBorder:!0}),items:[{key:"slack-settings",action:()=>{ae&&(R().R.setState({...R().R.state,currentScreen:"settings"}),null==t||t.close())},render:e=>(0,d.jsx)(b().A,{...e,title:(0,d.jsxs)(O().Ye,{gap:4,children:[(0,d.jsx)("div",{style:q.iconWrapper,children:(0,v().B)(q.icon)}),(0,d.jsx)("div",{style:q.option,children:(0,d.jsx)("div",{style:q.optionLabel,children:(0,d.jsx)(f().sA,{id:"assistantOverflowMenu.slackIngestion.settings",defaultMessage:"Settings"})})})]})})}]}),(0,d.jsx)(_().A,{menuType:N().gu.Popup,width:230,children:Z?(0,d.jsx)(O().Ye,{style:{padding:8,justifyContent:"center"},children:(0,d.jsx)(M().A,{})}):(0,d.jsx)(j().Ay,{type:j().Oh.Vertical,sections:ge,initialFocus:void 0})})}function E(e,n,t,s){return t||n||!e.includes("slack-admin")?(0,d.jsx)(f().sA,{id:"assistantOverflowMenu.slackIngestion.adminAuth",defaultMessage:"Public conversations"}):s?(0,d.jsx)(f().sA,{id:"assistantOverflowMenu.slackIngestion.noWorkspacesSelected",defaultMessage:"No workspaces selected"}):(0,d.jsx)(f().sA,{id:"assistantOverflowMenu.slackIngestion.noChannelsSelected",defaultMessage:"No channels selected"})}function Q(e,n,t,s,a){return e?s?(0,d.jsx)(f().sA,{id:"assistantOverflowMenu.slackIngestion.disconnectingPublicSlack",defaultMessage:"Disconnecting. This can take up to 3 hours."}):t?(0,d.jsx)(f().sA,{id:"assistantOverflowMenu.slackIngestion.connectingPublicSlack",defaultMessage:"Connecting. This can take up to 36 hours."}):n.includes("slack-admin")?a?(0,d.jsx)(f().sA,{id:"assistantOverflowMenu.slackIngestion.connectedByWorkspaceOwner",defaultMessage:"Connected by workspace owner"}):(0,d.jsx)(f().sA,{id:"assistantOverflowMenu.slackIngestion.selectChannels",defaultMessage:"Your workspace owner hasn't completed the setup."}):(0,d.jsx)(f().sA,{id:"assistantOverflowMenu.slackIngestion.connectSlackToEnhanceResults",defaultMessage:"Connect to enhance your AI results"}):n.includes("slack-admin")?a?(0,d.jsx)(f().sA,{id:"assistantOverflowMenu.slackIngestion.connectedByWorkspaceOwner",defaultMessage:"Connected by workspace owner"}):t?(0,d.jsx)(f().sA,{id:"assistantOverflowMenu.slackIngestion.connectingPublicSlack",defaultMessage:"Connecting. This can take up to 36 hours."}):(0,d.jsx)(f().sA,{id:"assistantOverflowMenu.slackIngestion.selectChannels",defaultMessage:"Your workspace owner hasn't completed the setup."}):(0,d.jsx)(f().sA,{id:"assistantOverflowMenu.slackIngestion.contactAdmin",defaultMessage:"Contact your workspace owner to connect"})}}}]);