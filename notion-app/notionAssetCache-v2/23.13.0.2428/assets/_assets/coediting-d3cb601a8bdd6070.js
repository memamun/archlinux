"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[53095],{173019:(e,t,n)=>{n.d(t,{r:()=>r});n(296540);var o=n(474848);const r=(0,n(340498).wt)("pencil",{viewBox:"0 0 16 16",svg:(0,o.jsx)("path",{d:"M3.926 13.307H14.11c.183 0 .34-.066.472-.199a.644.644 0 00.198-.471.652.652 0 00-.198-.479.644.644 0 00-.472-.198H5.272l-1.346 1.347zm-.704-.636l7.683-7.684-1.312-1.319-7.69 7.684-.67 1.606c-.037.1-.017.191.06.273.083.082.174.105.274.069l1.655-.63zm8.34-8.326l.738-.732c.182-.187.278-.376.287-.567.009-.192-.068-.374-.232-.547l-.267-.267c-.169-.168-.351-.246-.547-.232-.196.014-.385.11-.567.287l-.739.732 1.327 1.326z"})})},438632:(e,t,n)=>{n.d(t,{PD:()=>l,cb:()=>d,yR:()=>u});n(16280),n(944114),n(898992),n(354520),n(803949),n(581454);var o=n.n(n(625473)),r=n.n(n(716471)),i=()=>n(496603),a=()=>n(534177),s=()=>n(634201),c=()=>n(919709);let d=function(e){return e[e.removed=-1]="removed",e[e.added=1]="added",e[e.same=0]="same",e}({});function l(e,t){const n=new(r())({timeout:2,editCost:6}),o=n.main(t,e);return n.cleanupSemantic(o),o}function u(e){const{before:t,after:n,isIncompleteAfter:r,insertCursor:u}=e,p={count:0,encoding:{},decoding:{},annotationEncoding:{},annotationDecoding:{}},f=e=>{const t=p.encoding[e];if(t)return t;{const t=String.fromCharCode(p.count);return p.count++,p.encoding[e]=t,p.decoding[t]=e,t}},g=e=>{const t=o()(e),n=p.annotationEncoding[t];if(n)return n;{const n=String.fromCharCode(p.count);return p.count++,p.annotationEncoding[t]=n,p.annotationDecoding[n]=e,n}},m=t=>i().Bq(c().RQ(t).map((t=>{let n=[];n="word"===e.mode||"wordUnderlineFinal"===e.mode?t[0].split(" ").map(((e,t)=>`${0===t?"":" "}${e}`)):s().PE(t[0]);const o=n.map(f);if(c().qXl(t)){const e=c().uPN(t),n=c().jhx(e);n&&(o[0]=g({type:"mention",value:n}),e.forEach((e=>{c().iGj(e)||c().gir(e)||c().lfl(e)||(o.unshift(g({type:"start",value:e})),o.push(g({type:"end",value:e})))})))}else if(c().GiG(t)){const e=c().uPN(t),n=c().j1D(e);if(n){o[0]=g({type:"equation",value:n});for(const t of e)c().iGj(t)||c().gir(t)||c().lfl(t)||(o.unshift(g({type:"start",value:t})),o.push(g({type:"end",value:t})))}}else if(c().BEe(t)){c().uPN(t).forEach((e=>{o.unshift(g({type:"start",value:e})),o.push(g({type:"end",value:e}))}))}return o}))).join("");if(p.count>65535)throw new Error("This string has way too many different characters.");const h=l(m(n),m(t)),v=[];let y=[],k=0;const C=r?i().Kl(h,(e=>0===e[0]||1===e[0])):0;let S=!1;const B=e.insertionAnnotation,x=e.deletionAnnotation;return h.forEach((t=>{let[n,o]=t;o.split("").forEach((t=>{if(p.decoding[t]){const o=p.decoding[t];n===d.added?v.push([o,[...y,"wordUnderlineFinal"===e.mode?e.underlineAnnotation:B]]):n===d.removed&&(!r||k<=C)?"wordUnderlineFinal"!==e.mode&&v.push([o,[...y,x]]):(r&&u&&!S&&k===C+1&&(S=!0,v.push(["",[["tc"]]])),v.push([o,y]))}else{const o=p.annotationDecoding[t];if(n===d.added)if("mention"===o.type)v.push([c().Sj,[...y,"wordUnderlineFinal"===e.mode?e.underlineAnnotation:B,o.value]]);else if("start"===o.type)y=[...y,o.value];else if("end"===o.type)y=y.filter((e=>!i().n4(e,o.value)));else if("equation"===o.type){const e=c().U35(o.value),t=c().G0H(e,[...y,B]);v.push(t)}else(0,a().HB)(o);else if(n===d.removed){if("mention"===o.type)"wordUnderlineFinal"!==e.mode&&v.push([c().Sj,[...y,x,o.value]]);else if("equation"===o.type){const e=c().U35(o.value),t=c().G0H(e,[...y,x]);v.push(t)}}else if(n===d.same)if("mention"===o.type)v.push([c().Sj,[...y,o.value]]);else if("start"===o.type)y=[...y,o.value];else if("end"===o.type)y=y.filter((e=>!i().n4(e,o.value)));else if("equation"===o.type){const e=c().U35(o.value),t=c().G0H(e,y);v.push(t)}else(0,a().HB)(o)}})),r&&(k+=1)})),c().__s(v)}},643852:(e,t,n)=>{n.r(t),n.d(t,{CoEditingTasksManager:()=>X,HoverCoEditingOverlayRenderer:()=>z,autoCorrectActions:()=>o,coEditingSuggestionActions:()=>r()});var o={};n.r(o),n.d(o,{applyAutoCorrectUnderlines:()=>T,applyAutoCorrectUnderlinesCrdt:()=>A,assignEditIdsAndDeriveContext:()=>w,getAutoCorrectInference:()=>I,getContextForEdits:()=>E,logAutoCorrectFeedback:()=>Q,modifyDiffWithEditIds:()=>P});var r=()=>n(90881),i=(n(16280),n(944114),n(898992),n(354520),n(803949),n(581454),()=>n(221844)),a=()=>n(438632),s=()=>n(386164),c=()=>n(919709),d=()=>n(439180),l=()=>n(532659),u=()=>n(498212),p=()=>n(449506),f=()=>n(884107),g=()=>n(606952),m=()=>n(317909),h=()=>n(108184),v=()=>n(659602),y=()=>n(335722),k=()=>n(496879);const C="initial-edit-id";n(672577);var S=()=>n(220719),B=()=>n(534177);var x=()=>n(780942);async function b(e){const{environment:t,completion:n,traceId:o,spaceId:r}=e,[a,s,c]=await Promise.all([f().R.clipboardActions.load(),v().g.load(),y().S.load()]);if(!a||!s||!c)throw new Error("Required dependencies not loaded for markdown conversion");const d=new(i().A)({name:"AutocorrectMarkdownConversion",isTemporaryData:!0}),l=m().createAndCommit({userAction:"blockActionRegistry.autoCorrectAction.convertMarkdown",environment:t,canUndo:!1,perform:e=>{const i=a.markdownToBlocks({environment:t,text:n,inMemoryRecordCache:d,transaction:e,markdownOptions:{},markdownLinkifyIt:s,tinyMceMicrosoftWordPasteFilter:c});return i?((0,h().postProcessAICreatedStores)(t,i),i[0].getTitleValue()):(r&&o&&Q({environment:t,spaceId:r,traceId:o,feedback:"rejected",textContext:`Failed to convert markdown to blocks:\n ${n}`}),[])}}).performResult;if(!l)throw new Error("Failed to convert markdown to blocks");return d.addCacheFallback(t.defaultRecordCache.inMemoryRecordCache),l}async function I(e,t,n,o,r){const i=new AbortController,a=[{id:(0,u().Ay)(),type:"autocorrect",selectedText:n,navigableBlockPointer:r},{id:(0,u().Ay)(),type:"config",value:{type:"autocorrect"}}],c=await p().callStreamApi({eventName:"runInferenceTranscript",environment:e,data:{traceId:o,spaceId:t,transcript:a,generateTitle:!1},abortSignal:i.signal,headers:(0,s().WS)({spaceId:t})});if("success"!==c.type)throw c.error;let d="";if(l().hS.is(c.data))for await(const s of c.data){if("error"===s.type)throw new Error(`Failed to get inference ${s.errorCode}${s.message}`);"markdown-chat"===s.type&&(d+=s.value)}return d}async function T(e,t,n,o,i){const s=await b({environment:e,completion:o,traceId:i,spaceId:t.getSpaceId()});if((0,c().w9s)(s))return;const d=t.getTitleValue();m().createAndCommit({userAction:"aiCoEditing.applyAutocorrect",environment:e,canUndo:!0,perform:n=>{g().KY({environment:e,store:t.getBlockTitleStore(),value:s,transaction:n})}});const l=C,u=(0,a().yR)({mode:"wordUnderlineFinal",before:n,after:s,isIncompleteAfter:!1,insertCursor:!1,insertionAnnotation:[c().Ifu.Inserted],deletionAnnotation:[c().Ifu.Deleted],underlineAnnotation:[c().Ifu.TemporarySuggestionUnderline,l]}),p=(0,a().yR)({mode:"word",before:n,after:s,isIncompleteAfter:!1,insertCursor:!1,insertionAnnotation:[c().Ifu.Inserted,l],deletionAnnotation:[c().Ifu.Deleted,l]}),{modifiedDiff:f,edits:h}=w({diff:u,diffForContext:p,originalText:d,traceId:i});(0,r().setBlockSuggestion)(x().T,t,{type:"textValue",titleTextValue:f,edits:h})}async function A(e){const{environment:t,blockStore:n,completion:o,traceId:i}=e,s=await b({environment:t,completion:o,traceId:i,spaceId:n.getSpaceId()});if((0,c().w9s)(s))return;const l=function(e){const{blockStore:t,newBlockTitleTextValue:n,editIdGenerator:o,traceId:r}=e,i=(0,S().o9)(t.getBlockTitleTextSliceTree()),s=(0,S().o9)(t.getBlockTitleStore().getValue()),d=o(),l=(0,a().yR)({mode:"word",before:s,after:n,insertionAnnotation:["+",d],deletionAnnotation:["-",d]}),u=[],p=[],f={};let g=0,m=!1,h=d;for(const a of l){const e=a[0].length;if(2!==a.length){m=!1,g+=e;continue}const[t,n]=a;if(n.find((e=>e[0]===c().BQP.Inserted&&e[1]===d))){m||(h=o()),f[h]||(f[h]={type:"crdt",editId:h,traceId:r,context:[],undoOperations:[],underlineOperations:[]});const t=f[h],n=i.getOperationsForInsertTextValue(g,[[a[0]]]);n.operations.forEach((e=>{switch(e.type){case"insertText":i.applyInsertTextOperation(e);break;case"addAnnotation":case"removeAnnotation":i.applyAnnotationOperation(e);break;default:(0,B().HB)(e)}})),u.push(...n.operations),p.push(...n.invertedOperations),t.underlineOperations.push(...i.getOperationsForAddAnnotation(g,g+e-1,[c().BQP.TemporarySuggestionUnderline,h]).operations),t.undoOperations.push(...n.invertedOperations),t.context.push([a[0],[[c().BQP.Inserted,h]]]),m=!0,g+=e}else if(n.find((e=>e[0]===c().BQP.Deleted&&e[1]===d))){m||(h=o()),f[h]||(f[h]={type:"crdt",editId:h,traceId:r,context:[],undoOperations:[],underlineOperations:[]});const t=f[h],n=i.getOperationsForDeleteText(g,g+e-1);u.push(...n.operations),n.operations.forEach((e=>i.applyDeleteOperation(e))),p.push(...n.invertedOperations),t.undoOperations.push(...n.invertedOperations),t.context.push([a[0],[[c().BQP.Deleted,h]]]),m=!0}else m=!1,g+=e}for(const a of Object.values(f))for(const e of a.underlineOperations)i.applyAnnotationOperation(e);return{type:"crdt",operations:u,invertedOperations:p,edits:f,titleTextValue:i.getTextValue()}}({blockStore:n,newBlockTitleTextValue:s,editIdGenerator:()=>(0,u().Ay)(),traceId:i});m().createAndCommit({userAction:"aiCoEditing.applyAutocorrectCrdt",environment:t,canUndo:!1,perform:e=>{const t=l.operations.map((e=>(0,d().qA)({pointer:n.pointer,crdtOperation:e,fullTextValue:s}))),o=l.invertedOperations.map((e=>(0,k().c)({pointer:n.pointer,invertedCrdtOperation:e,previousTextValue:n.getTitleValue()})));m().applyCrdtTextOperations({store:n,operations:t,invertedOperations:o,transaction:e})}});const p=(0,r().getBlockSuggestion)(x().T,n.id);if(p&&"crdt"===p.type){const e={type:"crdt",operations:[...p.operations,...l.operations],invertedOperations:[...p.invertedOperations,...l.invertedOperations],titleTextValue:l.titleTextValue,edits:{...p.edits,...l.edits}},t=n.getBlockTitleTextSliceTree();if(!t)return;return Object.values(e.edits).forEach((e=>null==e?void 0:e.underlineOperations.forEach((e=>t.applyAnnotationOperation(e))))),e.titleTextValue=t.getTextValue(),void(0,r().setBlockSuggestion)(x().T,n,e)}(0,r().setBlockSuggestion)(x().T,n,l)}function w(e){const{diff:t,diffForContext:n,originalText:o,traceId:r}=e,{modifiedDiff:i,editIds:a}=P({diff:t});return{modifiedDiff:i,edits:E({diffForContext:n,editIds:a,originalText:o,traceId:r})}}function P(e){const{diff:t}=e,n=[];return{modifiedDiff:t.map((e=>{const[t,o]=e,r=(0,c().i54)(o??[]);if(o&&r){const e=(0,u().Ay)();n.push(e);const r=o.map((t=>(0,c().n5B)(t)?[c().Ifu.TemporarySuggestionUnderline,e]:t));return(0,c().Ey_)(t,r)}return e})),editIds:n}}function E(e){const{diffForContext:t,editIds:n,originalText:o,traceId:r}=e,i={};let a=null,s=[],d=0;function l(){i[n[d]]={type:"textValue",editId:n[d],context:s,originalText:o,traceId:r},d++,s=[]}if(t.forEach(((e,n)=>{if(s.length>0&&(0,c().byt)(s[s.length-1][1]??[])){const t=e[0].split(" ").filter(Boolean).slice(0,1)[0];s.push((0,c().Ey_)(t,e[1]??[])),l()}if((0,c().azZ)(e[1]??[])){if(a){var o;const e=(null===(o=a[0].match(/\S+\s*$/))||void 0===o?void 0:o[0])??"";s.push((0,c().Ey_)(e,a[1]??[]))}s.push(e)}(0,c().byt)(e[1]??[])&&(s.push(e),n===t.length-1&&l()),a=e})),s.length>0&&l(),d!==n.length)throw new Error("Edits length mismatch");return i}function Q(e){const{environment:t,spaceId:n,traceId:o,feedback:r,textContext:i}=e;p().callApi({eventName:"saveInferenceTranscriptFeedback",environment:t,data:{type:"autocorrect",traceId:o,spaceId:n,feedbackType:"accepted"===r?"thumbs_up":"thumbs_down",userComment:i},headers:(0,s().WS)({spaceId:n})})}n(296540);var _=()=>n(484714),O=()=>n(56366),R=()=>n(551864),U=()=>n(401497),j=()=>n(949306),q=()=>n(454503),V=()=>n(701545),F=()=>n(959013),D=()=>n(284371),M=()=>n(285790),H=()=>n(460292),G=()=>n(712030),L=()=>n(921855),N=n(474848);function K(e){let{textValue:t,parentStore:n,mode:o,onAccept:r,onReject:i}=e;const a=(0,F().tz)(),s=(0,_().v3)(),c=(0,U().DP)(),d=(0,O().K8)((()=>{const e=(0,L().S5)({environment:s,textValue:{value:t,spaceId:n.getSpaceId()},parentStore:n,disableHover:!0,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disableSuggestionAnnotations:!1,disabled:!0,theme:c,emojiType:(0,G().FN)(s),katex:s.KatexStore.getKatex(),formulaValueTypes:[]});return(0,N.jsx)("span",{children:e})}),[s,t,c,n]),l=(0,U().IS)((e=>({container:{display:"grid",gridTemplateColumns:"auto 1fr",gap:5,alignItems:"center",padding:"5px 12px",width:"fit-content",minWidth:"min-content"},actionContainer:{display:"flex",alignItems:"center",gap:5},textContainer:{...D().RC,fontSize:14,lineHeight:"22px",minWidth:"fit-content"}})),[]);return(0,N.jsxs)("div",{style:l.container,children:[(0,N.jsx)("div",{style:l.actionContainer,children:"auto_accept"===o?(0,N.jsx)(M().A,{style:{width:16,height:16},icon:e=>(0,q().D)({...e}),onClick:i,ariaLabel:a.formatMessage({id:"autoCorrectCard.undoAutoCorrection",defaultMessage:"Undo auto-correction"})}):(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(M().A,{style:{width:16,height:16},icon:e=>(0,V().p)({width:16,height:16,...e}),onClick:r,ariaLabel:a.formatMessage({id:"autoCorrectCard.acceptCorrection",defaultMessage:"Accept correction"})}),(0,N.jsx)(M().A,{style:{width:16,height:16},icon:e=>(0,N.jsx)(H().Q,{iconGroup:j().Q,variantName:"default",style:{width:16,height:16,...e}}),onClick:i,ariaLabel:a.formatMessage({id:"autoCorrectCard.rejectCorrection",defaultMessage:"Reject correction"})})]})}),(0,N.jsx)("div",{style:l.textContainer,children:d})]})}function z(e){let{store:t,annotation:n,onDismiss:o}=e;const i=(0,_().v3)(),{suggestion:a,editId:s,parentStore:d}=(0,O().K8)((()=>{const e=t.getAncestorBlockStoreAtRootPath();if(!e)return{textValue:void 0,editId:void 0,parentStore:void 0};const o=c().JJX(n);if(!o)return{suggestion:void 0,editId:void 0,parentStore:void 0};const i=(0,r().getBlockSuggestion)(x().T,e.id);return i?{suggestion:i,editId:o,parentStore:e}:{suggestion:void 0,editId:void 0,parentStore:void 0}}),[t,n]);if(!a||!d||!s)return null;const l=a.edits[s];if(!l)return null;return(0,N.jsx)(K,{textValue:l.context,parentStore:d,mode:"auto_accept",onAccept:()=>{},onReject:()=>{switch(l.type){case"textValue":m().createAndCommit({userAction:"aiCoEditing.undoUnderlineCorrection",environment:i,canUndo:!1,perform:e=>{g().KY({environment:i,store:d.getBlockTitleStore(),value:l.originalText,transaction:e})}});break;case"crdt":m().createAndCommit({userAction:"aiCoEditing.undoUnderlineCorrectionCrdt",environment:i,canUndo:!1,perform:e=>{l.undoOperations.map((t=>(0,R().e)({environment:i,store:d,transaction:e,operation:(0,k().c)({pointer:d.pointer,invertedCrdtOperation:t,previousTextValue:d.getTitleValue()})})))}}),(0,r().removeBlockSuggestionEdit)(x().T,d,l.editId);break;default:(0,B().HB)(l)}null==o||o(),Q({environment:i,spaceId:d.getSpaceId(),traceId:l.traceId,feedback:"rejected",textContext:JSON.stringify(l.context)})}})}n(737550);var W=()=>n(229833),$=()=>n(77246);const J={text:!0,bulleted_list:!0,numbered_list:!0,toggle:!0,quote:!0,header:!0,sub_header:!0,sub_sub_header:!0,callout:!0,post:!0,to_do:!0,table:!1,table_row:!1,page:!1,personal_home_page:!1,person_profile:!1,encrypted_text:!1,factory:!1,button:!1,column_list:!1,column:!1,embed:!1,framer:!1,tweet:!1,gist:!1,drive:!1,audio:!1,maps:!1,invision:!1,mixpanel:!1,image:!1,video:!1,file:!1,bookmark:!1,equation:!1,code:!1,collection_view:!1,collection_view_page:!1,form:!1,breadcrumb:!1,copy_indicator:!1,divider:!1,link_to_page:!1,link_to_collection:!1,figma:!1,loom:!1,typeform:!1,codepen:!1,pdf:!1,table_of_contents:!1,whimsical:!1,miro:!1,abstract:!1,sketch:!1,excalidraw:!1,replit:!1,alias:!1,transclusion_container:!1,transclusion_reference:!1,external_object_instance:!1,tab:!1,external_object_instance_page:!1,hex:!1,deepnote:!1,ai_block:!1,drawing:!1,slide:!1,workflow:!1,transcription:!1},Z={[c().BQP.Bold]:!0,[c().BQP.Italic]:!0,[c().BQP.Strike]:!0,[c().BQP.Code]:!0,[c().BQP.Underline]:!0,[c().BQP.Link]:!0,[c().BQP.Discussion]:!1,[c().BQP.Highlight]:!1,[c().BQP.Date]:!1,[c().BQP.User]:!1,[c().BQP.Bot]:!1,[c().BQP.Page]:!1,[c().BQP.ExternalObjectInstance]:!1,[c().BQP.Group]:!1,[c().BQP.Team]:!1,[c().BQP.CustomEmoji]:!1,[c().BQP.LinkMention]:!1,[c().BQP.Equation]:!1,[c().BQP.FormulaError]:!1,[c().BQP.Inserted]:!1,[c().BQP.Deleted]:!1,[c().BQP.TemporaryComment]:!1,[c().BQP.TemporaryPage]:!1,[c().BQP.TemplateVariable]:!1,[c().BQP.Comment]:!1,[c().BQP.Citation]:!1,[c().BQP.TemporaryEquation]:!1,[c().BQP.TemporaryInput]:!1,[c().BQP.TemporarySelection]:!1,[c().BQP.TemporaryCommentHighlight]:!1,[c().BQP.TemporarySuggestionUnderline]:!1,[c().BQP.FormulaPageProperty]:!1,[c().BQP.FormulaContextValue]:!1,[c().BQP.TemporaryFindHighlight]:!1,[c().BQP.TemporarySelectedFindHighlight]:!1,[c().BQP.TemporaryCursor]:!1,[c().BQP.SuggestionInsertText]:!1,[c().BQP.SuggestionRemoveText]:!1,[c().BQP.SuggestionAnnotate]:!1,[c().BQP.SuggestionUnannotate]:!1,[c().BQP.TemporaryHighlight]:!1,[c().BQP.TemporaryNativeMABFilter]:!1,[c().BQP.TemporaryDictation]:!1,[c().BQP.AssistantInstructionsCollection]:!1,[c().BQP.GeoPoint]:!1};class X{constructor(){this.requests=[],this.currentRequest=null,this.currentRequestCancelled=!1,this.currentEnvironment=void 0,this.currentBlockStore=void 0,this.handleTextSelectionStoreChange=e=>{const t=e.getState();switch(t.mode){case"readOnly":case"empty":this.submitEvent({type:"textSelectionCleared"});break;case"editing":{var n;const e=t.multiSelection.start.store.getAncestorBlockStoreAtRootPath();if(!e)return void this.submitEvent({type:"textSelectionCleared"});e.id!==(null===(n=this.currentBlockStore)||void 0===n?void 0:n.id)&&this.submitEvent({type:"blockEntered",blockStore:e});break}default:(0,B().HB)(t)}},n(24157).default.addListener(this.handleTextSelectionStoreChange)}submitEvent(e){switch(e.type){case"textSelectionCleared":case"blockEntered":this.currentBlockStore&&this.currentEnvironment&&Y(this.currentBlockStore)&&this.addRequest({type:"blockAutoCorrectUnderlines",environment:this.currentEnvironment,blockStore:this.currentBlockStore}),this.currentBlockStore=void 0,this.currentEnvironment=void 0;break;case"blockUpdated":this.currentBlockStore||(this.currentBlockStore=e.blockStore,this.currentEnvironment=e.environment),this.currentBlockStore&&this.currentBlockStore.id!==e.blockStore.id&&this.currentEnvironment&&Y(this.currentBlockStore)&&(this.addRequest({type:"blockAutoCorrectUnderlines",environment:this.currentEnvironment,blockStore:this.currentBlockStore}),this.currentBlockStore=e.blockStore,this.currentEnvironment=e.environment);break;default:(0,B().HB)(e)}}addRequest(e){var t,n;e.blockStore.id===(null===(t=this.currentRequest)||void 0===t?void 0:t.blockStore.id)&&e.type===(null===(n=this.currentRequest)||void 0===n?void 0:n.type)&&(this.currentRequestCancelled=!0),this.requests.some((t=>t.blockStore.id===e.blockStore.id&&t.type===e.type))||$().Uv.isStoreInAiCoEditing(e.blockStore)&&(this.requests.push(e),this.triggerRun())}triggerRun(){this.currentRequest||this.run()}async run(){if(this.currentRequest)throw new Error("CoEditingTasksManager.run called while a request is already in progress");if(!this.currentBlockStore||!$().Uv.isStoreInAiCoEditing(this.currentBlockStore))return;if(this.currentEnvironment&&!n(763884).A.get({userId:this.currentEnvironment.currentUser.id,key:"ai_co_editing_always_on"}))return;const e=this.requests.shift();if(e){this.currentRequest=e;try{const t=e.type;if("blockAutoCorrectUnderlines"===t)await this.runBlockAutoCorrectUnderlines(e);else(0,B().HB)(t)}catch(t){!function(e,t){const o=n(449412).Fg(t,{tags:{from:"coEditingTaskManager"}});n(857639).log({level:"error",from:"coEditingTaskManager",type:e,error:(0,W().n6)(t),data:{},sentryEventId:o})}(e.type,t)}finally{this.currentRequest=null,this.currentRequestCancelled=!1}this.run()}}async runBlockAutoCorrectUnderlines(e){const{environment:t,blockStore:o}=e,r=o.getTitleValue(),i=o.getNavigableBlockStore();if(!i)return;const a=(0,u().lZ)(),s=await I(t,o.getSpaceId(),r,a,i.pointer);if(!s||this.currentRequestCancelled)return;const d=(0,c().q4_)(r);if(d===(0,c().q4_)(o.getTitleValue())&&d!==s){const e=n(508496).default.getEligibleGroup({experimentId:"ai_co_editing_mode"});o.useCrdt()&&"crdt"===e?await A({environment:t,blockStore:o,completion:s,traceId:a}):await T(t,o,r,s,a)}}}function Y(e){var t;if(e.isNavigableBlock()||e.isLocked()||!e.canEdit())return!1;const n=e.getType();if(!n)return!1;if(!J[n])return!1;if(e.getDiscussionStores().filter((e=>!e.getResolved())).length>0)return!1;const o=null===(t=e.getTitleStore())||void 0===t?void 0:t.getValue();if(!o)return!1;return!o.some((e=>{if(2!==e.length)return!1;return e[1].some((e=>!Z[e[0]]))}))}},701545:(e,t,n)=>{n.d(t,{p:()=>r});n(296540);var o=n(474848);const r=(0,n(340498).wt)("checkMarkLine",{viewBox:"0 0 16 16",svg:(0,o.jsx)("path",{d:"M6.79297 13.2871C6.48047 13.2871 6.21484 13.1523 5.99609 12.8828L2.96094 9.14453C2.875 9.04297 2.8125 8.94336 2.77344 8.8457C2.73828 8.74805 2.7207 8.64648 2.7207 8.54102C2.7207 8.30664 2.79883 8.11328 2.95508 7.96094C3.11133 7.80859 3.30859 7.73242 3.54688 7.73242C3.81641 7.73242 4.04297 7.84766 4.22656 8.07812L6.76953 11.3008L11.7324 3.4375C11.834 3.28125 11.9395 3.17188 12.0488 3.10938C12.1582 3.04297 12.2949 3.00977 12.459 3.00977C12.6973 3.00977 12.8926 3.08398 13.0449 3.23242C13.1973 3.38086 13.2734 3.57031 13.2734 3.80078C13.2734 3.89453 13.2578 3.98828 13.2266 4.08203C13.1953 4.17578 13.1465 4.27344 13.0801 4.375L7.5957 12.8594C7.4082 13.1445 7.14062 13.2871 6.79297 13.2871Z"})})}}]);