"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[99314],{456116:(e,t,r)=>{r.r(t),r.d(t,{fixLegacyTransclusion:()=>v,maybeAutofixLegacyTransclusionProperty:()=>C});r(944114),r(517642),r(658004),r(733853),r(845876),r(432475),r(515024),r(731698);var o=()=>r(857639),n=()=>r(179034),a=()=>r(161479),c=()=>r(229833),i=()=>r(780054),s=()=>r(71584),l=()=>r(594794),u=()=>r(611191),p=()=>r(299545),d=()=>r(589994),g=()=>r(630116),m=()=>r(679156),y=()=>r(722101),b=()=>r(797265),S=()=>r(778417),f=()=>r(317909);const h=new Set(["text","table_row","header","sub_header","sub_sub_header","to_do","bulleted_list","numbered_list","toggle"]);function C(e){const{parentStore:t,transaction:r,store:a,environment:i}=e,p=a.path[1];if(2!==a.path.length||"properties"!==a.path[0]||"string"!=typeof p)return;const b=a.getRecordStoreAtRootPath();if(!(b instanceof g().Bv))return;const S=b.getType();if(!S||!h.has(S))return;const f=function(e){var t;const{environment:r,store:o,parentStore:a,transaction:c}=e;if(o.getSpaceId()!==a.getSpaceId())return;const i=null===(t=a.getModel())||void 0===t?void 0:t.getContentIds();if(null==i||!i.includes(o.id))return;if(d().transactionQueue.isPendingTransactionForRecord(a.pointer)||d().transactionQueue.isPendingTransactionForRecord(o.pointer))return;const p=(0,u().$J)(),g=s().loadLocalSubtree(r,{blockId:o.id,inMemoryRecordCache:o.inMemoryRecordCache,allowCopyCollections:!1,requireFullSubtree:!0,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0,includeLegacyTransclusionBlockValues:p}).recordMap;if(!g)return;const m=s().localDuplicate({environment:r,sourceBlockId:o.id,targetBlockPointer:(0,l().zP)({environment:r,table:n().ev,spaceId:o.pointer.spaceId}),sourceBlockSubtree:g,targetInMemoryRecordCache:o.inMemoryRecordCache,deepCopyTransclusionContainers:!1,resolveTemplateVariables:!1,transaction:c,preventLegacyTransclusions:p});return y().Br({parentStore:a.getContentStore(),oldChildStore:o,newChildStore:m.targetBlockStore,transaction:c}),m.targetBlockStore}({environment:i,store:b,parentStore:t,transaction:r});if(!f)return;const C=f.getPropertyStore(p);if(C)return r.postSubmitCallbacks.push((e=>{e&&o().log({from:"legacyTransclusionActions",level:"error",type:"maybeAutofixLegacyTransclusionProperty",error:{miscErrorString:(0,c().WS)(e)}}),m().Yr(i,{block_type:S,successful:!e})})),C;o().log({from:"legacyTransclusionActions",level:"error",type:"maybeAutofixLegacyTransclusionProperty",error:{message:"copied transclusion block does not have expected property"}})}function v(e){const{environment:t,store:r}=e,o=r.getRecordStoreUIParent();o&&(0,p().iU)(o)&&f().createAndCommit({userAction:"legacyTransclusionActions.fixLegacyTransclusion",environment:t,canUndo:!0,perform:e=>{const[n]=s().duplicateBlock({environment:t,stores:[r],addCopyName:!1,transaction:e,deepCopyTransclusionContainers:!0,resolveTemplateVariables:!1,targetSpaceId:(0,a().e)(r.pointer.spaceId),baseUrl:i().A.domainBaseUrl,publicDomainName:i().A.publicDomainName,preferDuplicateLocation:"local"}),c=n[0],{childStore:l}=y().WH({parentStore:o,insertStore:c,afterStore:r,transaction:e});b().TF({store:r,transaction:e}),S().td({environment:t,stores:[l]})}})}}}]);